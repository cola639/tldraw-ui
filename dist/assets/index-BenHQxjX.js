var OA=Object.defineProperty;var RA=(n,t,e)=>t in n?OA(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var g=(n,t,e)=>RA(n,typeof t!="symbol"?t+"":t,e);import{h as ur,j as u,r as v,N as qt,R as me,c as se,O as LA,k as Ic,P as $A,Q as FA,S as kr,i as e0,T as NA,A as t0}from"./index-BhENibtW.js";import{c as BA,o as zA,s as UA,l as HA,f as KA,j as GA,h as WA,b as sw,a as VA,k as YA}from"./tldraw-Bh4QPsuU.js";import{p as XA}from"./index-BjdCzPb6.js";var qA=typeof Element<"u",ZA=typeof Map=="function",JA=typeof Set=="function",QA=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Zl(n,t){if(n===t)return!0;if(n&&t&&typeof n=="object"&&typeof t=="object"){if(n.constructor!==t.constructor)return!1;var e,s,r;if(Array.isArray(n)){if(e=n.length,e!=t.length)return!1;for(s=e;s--!==0;)if(!Zl(n[s],t[s]))return!1;return!0}var i;if(ZA&&n instanceof Map&&t instanceof Map){if(n.size!==t.size)return!1;for(i=n.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;for(i=n.entries();!(s=i.next()).done;)if(!Zl(s.value[1],t.get(s.value[0])))return!1;return!0}if(JA&&n instanceof Set&&t instanceof Set){if(n.size!==t.size)return!1;for(i=n.entries();!(s=i.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(QA&&ArrayBuffer.isView(n)&&ArrayBuffer.isView(t)){if(e=n.length,e!=t.length)return!1;for(s=e;s--!==0;)if(n[s]!==t[s])return!1;return!0}if(n.constructor===RegExp)return n.source===t.source&&n.flags===t.flags;if(n.valueOf!==Object.prototype.valueOf&&typeof n.valueOf=="function"&&typeof t.valueOf=="function")return n.valueOf()===t.valueOf();if(n.toString!==Object.prototype.toString&&typeof n.toString=="function"&&typeof t.toString=="function")return n.toString()===t.toString();if(r=Object.keys(n),e=r.length,e!==Object.keys(t).length)return!1;for(s=e;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[s]))return!1;if(qA&&n instanceof Element)return!1;for(s=e;s--!==0;)if(!((r[s]==="_owner"||r[s]==="__v"||r[s]==="__o")&&n.$$typeof)&&!Zl(n[r[s]],t[r[s]]))return!1;return!0}return n!==n&&t!==t}var ej=function(t,e){try{return Zl(t,e)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}};const tj=ur(ej),nj="_custom_btn_1z1rr_3",sj="_btn_15_1z1rr_21",rw={custom_btn:nj,btn_15:sj,"btn-15":"_btn-15_1z1rr_26"},rj=({className:n,children:t,onClick:e})=>u.jsx("button",{className:`${rw.custom_btn} ${rw.btn_15} ${n}`,onClick:e,children:t}),ij=(n,t)=>{v.useEffect(()=>{const e=document.querySelector(`link[href="${n}"]`);return e&&e.parentNode.removeChild(e),()=>{if(e){const s=document.createElement("link");s.rel="stylesheet",s.href="/normalize.css",document.head.appendChild(s)}}},[])},oj=ij;var ya=function(n){return n&&n.Math===Math&&n},vn=ya(typeof globalThis=="object"&&globalThis)||ya(typeof window=="object"&&window)||ya(typeof self=="object"&&self)||ya(typeof qt=="object"&&qt)||ya(typeof qt=="object"&&qt)||function(){return this}()||Function("return this")(),om={},sn=function(n){try{return!!n()}catch{return!0}},aj=sn,Zr=!aj(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),cj=sn,Bu=!cj(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),lj=Bu,ll=Function.prototype.call,hr=lj?ll.bind(ll):function(){return ll.apply(ll,arguments)},n0={},s0={}.propertyIsEnumerable,r0=Object.getOwnPropertyDescriptor,dj=r0&&!s0.call({1:2},1);n0.f=dj?function(t){var e=r0(this,t);return!!e&&e.enumerable}:s0;var i0=function(n,t){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:t}},o0=Bu,a0=Function.prototype,Ff=a0.call,uj=o0&&a0.bind.bind(Ff,Ff),_t=o0?uj:function(n){return function(){return Ff.apply(n,arguments)}},c0=_t,hj=c0({}.toString),pj=c0("".slice),Jo=function(n){return pj(hj(n),8,-1)},fj=_t,gj=sn,mj=Jo,Kh=Object,yj=fj("".split),Sj=gj(function(){return!Kh("z").propertyIsEnumerable(0)})?function(n){return mj(n)==="String"?yj(n,""):Kh(n)}:Kh,zu=function(n){return n==null},wj=zu,xj=TypeError,Qo=function(n){if(wj(n))throw new xj("Can't call method on "+n);return n},bj=Sj,vj=Qo,Uu=function(n){return bj(vj(n))},Gh=typeof document=="object"&&document.all,rn=typeof Gh>"u"&&Gh!==void 0?function(n){return typeof n=="function"||n===Gh}:function(n){return typeof n=="function"},Cj=rn,Gi=function(n){return typeof n=="object"?n!==null:Cj(n)},Wh=vn,Ij=rn,Pj=function(n){return Ij(n)?n:void 0},Hu=function(n,t){return arguments.length<2?Pj(Wh[n]):Wh[n]&&Wh[n][t]},Ej=_t,l0=Ej({}.isPrototypeOf),_j=typeof navigator<"u"&&String(navigator.userAgent)||"",d0=vn,Vh=_j,iw=d0.process,ow=d0.Deno,aw=iw&&iw.versions||ow&&ow.version,cw=aw&&aw.v8,rs,Vd;cw&&(rs=cw.split("."),Vd=rs[0]>0&&rs[0]<4?1:+(rs[0]+rs[1]));!Vd&&Vh&&(rs=Vh.match(/Edge\/(\d+)/),(!rs||rs[1]>=74)&&(rs=Vh.match(/Chrome\/(\d+)/),rs&&(Vd=+rs[1])));var Tj=Vd,lw=Tj,kj=sn,Mj=vn,Aj=Mj.String,u0=!!Object.getOwnPropertySymbols&&!kj(function(){var n=Symbol("symbol detection");return!Aj(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&lw&&lw<41}),jj=u0,h0=jj&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Dj=Hu,Oj=rn,Rj=l0,Lj=h0,$j=Object,p0=Lj?function(n){return typeof n=="symbol"}:function(n){var t=Dj("Symbol");return Oj(t)&&Rj(t.prototype,$j(n))},Fj=String,Nj=function(n){try{return Fj(n)}catch{return"Object"}},Bj=rn,zj=Nj,Uj=TypeError,am=function(n){if(Bj(n))return n;throw new Uj(zj(n)+" is not a function")},Hj=am,Kj=zu,cm=function(n,t){var e=n[t];return Kj(e)?void 0:Hj(e)},Yh=hr,Xh=rn,qh=Gi,Gj=TypeError,Wj=function(n,t){var e,s;if(t==="string"&&Xh(e=n.toString)&&!qh(s=Yh(e,n))||Xh(e=n.valueOf)&&!qh(s=Yh(e,n))||t!=="string"&&Xh(e=n.toString)&&!qh(s=Yh(e,n)))return s;throw new Gj("Can't convert object to primitive value")},f0={exports:{}},dw=vn,Vj=Object.defineProperty,lm=function(n,t){try{Vj(dw,n,{value:t,configurable:!0,writable:!0})}catch{dw[n]=t}return t},Yj=vn,Xj=lm,uw="__core-js_shared__",hw=f0.exports=Yj[uw]||Xj(uw,{});(hw.versions||(hw.versions=[])).push({version:"3.37.1",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"});var dm=f0.exports,pw=dm,um=function(n,t){return pw[n]||(pw[n]=t||{})},qj=Qo,Zj=Object,Pc=function(n){return Zj(qj(n))},Jj=_t,Qj=Pc,eD=Jj({}.hasOwnProperty),Jr=Object.hasOwn||function(t,e){return eD(Qj(t),e)},tD=_t,nD=0,sD=Math.random(),rD=tD(1 .toString),g0=function(n){return"Symbol("+(n===void 0?"":n)+")_"+rD(++nD+sD,36)},iD=vn,oD=um,fw=Jr,aD=g0,cD=u0,lD=h0,yo=iD.Symbol,Zh=oD("wks"),dD=lD?yo.for||yo:yo&&yo.withoutSetter||aD,pr=function(n){return fw(Zh,n)||(Zh[n]=cD&&fw(yo,n)?yo[n]:dD("Symbol."+n)),Zh[n]},uD=hr,gw=Gi,mw=p0,hD=cm,pD=Wj,fD=pr,gD=TypeError,mD=fD("toPrimitive"),yD=function(n,t){if(!gw(n)||mw(n))return n;var e=hD(n,mD),s;if(e){if(t===void 0&&(t="default"),s=uD(e,n,t),!gw(s)||mw(s))return s;throw new gD("Can't convert object to primitive value")}return t===void 0&&(t="number"),pD(n,t)},SD=yD,wD=p0,m0=function(n){var t=SD(n,"string");return wD(t)?t:t+""},xD=vn,yw=Gi,Nf=xD.document,bD=yw(Nf)&&yw(Nf.createElement),y0=function(n){return bD?Nf.createElement(n):{}},vD=Zr,CD=sn,ID=y0,S0=!vD&&!CD(function(){return Object.defineProperty(ID("div"),"a",{get:function(){return 7}}).a!==7}),PD=Zr,ED=hr,_D=n0,TD=i0,kD=Uu,MD=m0,AD=Jr,jD=S0,Sw=Object.getOwnPropertyDescriptor;om.f=PD?Sw:function(t,e){if(t=kD(t),e=MD(e),jD)try{return Sw(t,e)}catch{}if(AD(t,e))return TD(!ED(_D.f,t,e),t[e])};var ea={},DD=Zr,OD=sn,w0=DD&&OD(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),RD=Gi,LD=String,$D=TypeError,Wi=function(n){if(RD(n))return n;throw new $D(LD(n)+" is not an object")},FD=Zr,ND=S0,BD=w0,dl=Wi,ww=m0,zD=TypeError,Jh=Object.defineProperty,UD=Object.getOwnPropertyDescriptor,Qh="enumerable",ep="configurable",tp="writable";ea.f=FD?BD?function(t,e,s){if(dl(t),e=ww(e),dl(s),typeof t=="function"&&e==="prototype"&&"value"in s&&tp in s&&!s[tp]){var r=UD(t,e);r&&r[tp]&&(t[e]=s.value,s={configurable:ep in s?s[ep]:r[ep],enumerable:Qh in s?s[Qh]:r[Qh],writable:!1})}return Jh(t,e,s)}:Jh:function(t,e,s){if(dl(t),e=ww(e),dl(s),ND)try{return Jh(t,e,s)}catch{}if("get"in s||"set"in s)throw new zD("Accessors not supported");return"value"in s&&(t[e]=s.value),t};var HD=Zr,KD=ea,GD=i0,hm=HD?function(n,t,e){return KD.f(n,t,GD(1,e))}:function(n,t,e){return n[t]=e,n},x0={exports:{}},Bf=Zr,WD=Jr,b0=Function.prototype,VD=Bf&&Object.getOwnPropertyDescriptor,pm=WD(b0,"name"),YD=pm&&(function(){}).name==="something",XD=pm&&(!Bf||Bf&&VD(b0,"name").configurable),qD={EXISTS:pm,PROPER:YD,CONFIGURABLE:XD},ZD=_t,JD=rn,zf=dm,QD=ZD(Function.toString);JD(zf.inspectSource)||(zf.inspectSource=function(n){return QD(n)});var v0=zf.inspectSource,e2=vn,t2=rn,xw=e2.WeakMap,n2=t2(xw)&&/native code/.test(String(xw)),s2=um,r2=g0,bw=s2("keys"),C0=function(n){return bw[n]||(bw[n]=r2(n))},fm={},i2=n2,I0=vn,o2=Gi,a2=hm,np=Jr,sp=dm,c2=C0,l2=fm,vw="Object already initialized",Uf=I0.TypeError,d2=I0.WeakMap,Yd,Qa,Xd,u2=function(n){return Xd(n)?Qa(n):Yd(n,{})},h2=function(n){return function(t){var e;if(!o2(t)||(e=Qa(t)).type!==n)throw new Uf("Incompatible receiver, "+n+" required");return e}};if(i2||sp.state){var Ss=sp.state||(sp.state=new d2);Ss.get=Ss.get,Ss.has=Ss.has,Ss.set=Ss.set,Yd=function(n,t){if(Ss.has(n))throw new Uf(vw);return t.facade=n,Ss.set(n,t),t},Qa=function(n){return Ss.get(n)||{}},Xd=function(n){return Ss.has(n)}}else{var Qi=c2("state");l2[Qi]=!0,Yd=function(n,t){if(np(n,Qi))throw new Uf(vw);return t.facade=n,a2(n,Qi,t),t},Qa=function(n){return np(n,Qi)?n[Qi]:{}},Xd=function(n){return np(n,Qi)}}var P0={set:Yd,get:Qa,has:Xd,enforce:u2,getterFor:h2},gm=_t,p2=sn,f2=rn,ul=Jr,Hf=Zr,g2=qD.CONFIGURABLE,m2=v0,E0=P0,y2=E0.enforce,S2=E0.get,Cw=String,Jl=Object.defineProperty,w2=gm("".slice),x2=gm("".replace),b2=gm([].join),v2=Hf&&!p2(function(){return Jl(function(){},"length",{value:8}).length!==8}),C2=String(String).split("String"),I2=x0.exports=function(n,t,e){w2(Cw(t),0,7)==="Symbol("&&(t="["+x2(Cw(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!ul(n,"name")||g2&&n.name!==t)&&(Hf?Jl(n,"name",{value:t,configurable:!0}):n.name=t),v2&&e&&ul(e,"arity")&&n.length!==e.arity&&Jl(n,"length",{value:e.arity});try{e&&ul(e,"constructor")&&e.constructor?Hf&&Jl(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var s=y2(n);return ul(s,"source")||(s.source=b2(C2,typeof t=="string"?t:"")),n};Function.prototype.toString=I2(function(){return f2(this)&&S2(this).source||m2(this)},"toString");var P2=x0.exports,E2=rn,_2=ea,T2=P2,k2=lm,_0=function(n,t,e,s){s||(s={});var r=s.enumerable,i=s.name!==void 0?s.name:t;if(E2(e)&&T2(e,i,s),s.global)r?n[t]=e:k2(t,e);else{try{s.unsafe?n[t]&&(r=!0):delete n[t]}catch{}r?n[t]=e:_2.f(n,t,{value:e,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return n},T0={},M2=Math.ceil,A2=Math.floor,j2=Math.trunc||function(t){var e=+t;return(e>0?A2:M2)(e)},D2=j2,Vi=function(n){var t=+n;return t!==t||t===0?0:D2(t)},O2=Vi,R2=Math.max,L2=Math.min,$2=function(n,t){var e=O2(n);return e<0?R2(e+t,0):L2(e,t)},F2=Vi,N2=Math.min,k0=function(n){var t=F2(n);return t>0?N2(t,9007199254740991):0},B2=k0,Ec=function(n){return B2(n.length)},z2=Uu,U2=$2,H2=Ec,Iw=function(n){return function(t,e,s){var r=z2(t),i=H2(r);if(i===0)return!n&&-1;var o=U2(s,i),a;if(n&&e!==e){for(;i>o;)if(a=r[o++],a!==a)return!0}else for(;i>o;o++)if((n||o in r)&&r[o]===e)return n||o||0;return!n&&-1}},K2={includes:Iw(!0),indexOf:Iw(!1)},G2=_t,rp=Jr,W2=Uu,V2=K2.indexOf,Y2=fm,Pw=G2([].push),M0=function(n,t){var e=W2(n),s=0,r=[],i;for(i in e)!rp(Y2,i)&&rp(e,i)&&Pw(r,i);for(;t.length>s;)rp(e,i=t[s++])&&(~V2(r,i)||Pw(r,i));return r},mm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],X2=M0,q2=mm,Z2=q2.concat("length","prototype");T0.f=Object.getOwnPropertyNames||function(t){return X2(t,Z2)};var A0={};A0.f=Object.getOwnPropertySymbols;var J2=Hu,Q2=_t,eO=T0,tO=A0,nO=Wi,sO=Q2([].concat),rO=J2("Reflect","ownKeys")||function(t){var e=eO.f(nO(t)),s=tO.f;return s?sO(e,s(t)):e},Ew=Jr,iO=rO,oO=om,aO=ea,cO=function(n,t,e){for(var s=iO(t),r=aO.f,i=oO.f,o=0;o<s.length;o++){var a=s[o];!Ew(n,a)&&!(e&&Ew(e,a))&&r(n,a,i(t,a))}},lO=sn,dO=rn,uO=/#|\.prototype\./,_c=function(n,t){var e=pO[hO(n)];return e===gO?!0:e===fO?!1:dO(t)?lO(t):!!t},hO=_c.normalize=function(n){return String(n).replace(uO,".").toLowerCase()},pO=_c.data={},fO=_c.NATIVE="N",gO=_c.POLYFILL="P",mO=_c,hl=vn,yO=om.f,SO=hm,wO=_0,xO=lm,bO=cO,vO=mO,ta=function(n,t){var e=n.target,s=n.global,r=n.stat,i,o,a,c,l,d;if(s?o=hl:r?o=hl[e]||xO(e,{}):o=hl[e]&&hl[e].prototype,o)for(a in t){if(l=t[a],n.dontCallGetSet?(d=yO(o,a),c=d&&d.value):c=o[a],i=vO(s?a:e+(r?".":"#")+a,n.forced),!i&&c!==void 0){if(typeof l==typeof c)continue;bO(l,c)}(n.sham||c&&c.sham)&&SO(l,"sham",!0),wO(o,a,l,n)}},j0={},CO=M0,IO=mm,PO=Object.keys||function(t){return CO(t,IO)},EO=Zr,_O=w0,TO=ea,kO=Wi,MO=Uu,AO=PO;j0.f=EO&&!_O?Object.defineProperties:function(t,e){kO(t);for(var s=MO(e),r=AO(e),i=r.length,o=0,a;i>o;)TO.f(t,a=r[o++],s[a]);return t};var jO=Hu,DO=jO("document","documentElement"),OO=Wi,RO=j0,_w=mm,LO=fm,$O=DO,FO=y0,NO=C0,Tw=">",kw="<",Kf="prototype",Gf="script",D0=NO("IE_PROTO"),ip=function(){},O0=function(n){return kw+Gf+Tw+n+kw+"/"+Gf+Tw},Mw=function(n){n.write(O0("")),n.close();var t=n.parentWindow.Object;return n=null,t},BO=function(){var n=FO("iframe"),t="java"+Gf+":",e;return n.style.display="none",$O.appendChild(n),n.src=String(t),e=n.contentWindow.document,e.open(),e.write(O0("document.F=Object")),e.close(),e.F},pl,Ql=function(){try{pl=new ActiveXObject("htmlfile")}catch{}Ql=typeof document<"u"?document.domain&&pl?Mw(pl):BO():Mw(pl);for(var n=_w.length;n--;)delete Ql[Kf][_w[n]];return Ql()};LO[D0]=!0;var R0=Object.create||function(t,e){var s;return t!==null?(ip[Kf]=OO(t),s=new ip,ip[Kf]=null,s[D0]=t):s=Ql(),e===void 0?s:RO.f(s,e)},zO=pr,UO=R0,HO=ea.f,Wf=zO("unscopables"),Vf=Array.prototype;Vf[Wf]===void 0&&HO(Vf,Wf,{configurable:!0,value:UO(null)});var ym=function(n){Vf[Wf][n]=!0},KO=ta,GO=Pc,WO=Ec,VO=Vi,YO=ym;KO({target:"Array",proto:!0},{at:function(t){var e=GO(this),s=WO(e),r=VO(t),i=r>=0?r:s+r;return i<0||i>=s?void 0:e[i]}});YO("at");var XO=vn,qO=_t,Tc=function(n,t){return qO(XO[n].prototype[t])},ZO=Tc;ZO("Array","at");var JO=Jo,L0=Array.isArray||function(t){return JO(t)==="Array"},QO=TypeError,eR=9007199254740991,tR=function(n){if(n>eR)throw QO("Maximum allowed index exceeded");return n},nR=Jo,sR=_t,rR=function(n){if(nR(n)==="Function")return sR(n)},Aw=rR,iR=am,oR=Bu,aR=Aw(Aw.bind),cR=function(n,t){return iR(n),t===void 0?n:oR?aR(n,t):function(){return n.apply(t,arguments)}},lR=L0,dR=Ec,uR=tR,hR=cR,$0=function(n,t,e,s,r,i,o,a){for(var c=r,l=0,d=o?hR(o,a):!1,h,p;l<s;)l in e&&(h=d?d(e[l],l,t):e[l],i>0&&lR(h)?(p=dR(h),c=$0(n,t,h,p,c,i-1)-1):(uR(c+1),n[c]=h),c++),l++;return c},F0=$0,pR=pr,fR=pR("toStringTag"),N0={};N0[fR]="z";var gR=String(N0)==="[object z]",mR=gR,yR=rn,ed=Jo,SR=pr,wR=SR("toStringTag"),xR=Object,bR=ed(function(){return arguments}())==="Arguments",vR=function(n,t){try{return n[t]}catch{}},B0=mR?ed:function(n){var t,e,s;return n===void 0?"Undefined":n===null?"Null":typeof(e=vR(t=xR(n),wR))=="string"?e:bR?ed(t):(s=ed(t))==="Object"&&yR(t.callee)?"Arguments":s},CR=_t,IR=sn,z0=rn,PR=B0,ER=Hu,_R=v0,U0=function(){},H0=ER("Reflect","construct"),Sm=/^\s*(?:class|function)\b/,TR=CR(Sm.exec),kR=!Sm.test(U0),Sa=function(t){if(!z0(t))return!1;try{return H0(U0,[],t),!0}catch{return!1}},K0=function(t){if(!z0(t))return!1;switch(PR(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kR||!!TR(Sm,_R(t))}catch{return!0}};K0.sham=!0;var MR=!H0||IR(function(){var n;return Sa(Sa.call)||!Sa(Object)||!Sa(function(){n=!0})||n})?K0:Sa,jw=L0,AR=MR,jR=Gi,DR=pr,OR=DR("species"),Dw=Array,RR=function(n){var t;return jw(n)&&(t=n.constructor,AR(t)&&(t===Dw||jw(t.prototype))?t=void 0:jR(t)&&(t=t[OR],t===null&&(t=void 0))),t===void 0?Dw:t},LR=RR,G0=function(n,t){return new(LR(n))(t===0?0:t)},$R=ta,FR=F0,NR=am,BR=Pc,zR=Ec,UR=G0;$R({target:"Array",proto:!0},{flatMap:function(t){var e=BR(this),s=zR(e),r;return NR(t),r=UR(e,0),r.length=FR(r,e,e,s,0,1,t,arguments.length>1?arguments[1]:void 0),r}});var HR=ym;HR("flatMap");var KR=Tc;KR("Array","flatMap");var GR=ta,WR=F0,VR=Pc,YR=Ec,XR=Vi,qR=G0;GR({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=VR(this),s=YR(e),r=qR(e,0);return r.length=WR(r,e,e,s,0,t===void 0?1:XR(t)),r}});var ZR=ym;ZR("flat");var JR=Tc;JR("Array","flat");var QR=B0,eL=String,kc=function(n){if(QR(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return eL(n)},tL=ta,nL=_t,sL=Qo,rL=Vi,iL=kc,oL=sn,aL=nL("".charAt),cL=oL(function(){return"ð ®·".at(-2)!=="\uD842"});tL({target:"String",proto:!0,forced:cL},{at:function(t){var e=iL(sL(this)),s=e.length,r=rL(t),i=r>=0?r:s+r;return i<0||i>=s?void 0:aL(e,i)}});var lL=Tc;lL("String","at");var dL=Wi,W0=function(){var n=dL(this),t="";return n.hasIndices&&(t+="d"),n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),n.dotAll&&(t+="s"),n.unicode&&(t+="u"),n.unicodeSets&&(t+="v"),n.sticky&&(t+="y"),t},wm=sn,uL=vn,xm=uL.RegExp,bm=wm(function(){var n=xm("a","y");return n.lastIndex=2,n.exec("abcd")!==null}),hL=bm||wm(function(){return!xm("a","y").sticky}),pL=bm||wm(function(){var n=xm("^r","gy");return n.lastIndex=2,n.exec("str")!==null}),fL={BROKEN_CARET:pL,MISSED_STICKY:hL,UNSUPPORTED_Y:bm},gL=sn,mL=vn,yL=mL.RegExp,SL=gL(function(){var n=yL(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),wL=sn,xL=vn,bL=xL.RegExp,vL=wL(function(){var n=bL("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),So=hr,Ku=_t,CL=kc,IL=W0,PL=fL,EL=um,_L=R0,TL=P0.get,kL=SL,ML=vL,AL=EL("native-string-replace",String.prototype.replace),qd=RegExp.prototype.exec,Yf=qd,jL=Ku("".charAt),DL=Ku("".indexOf),OL=Ku("".replace),op=Ku("".slice),Xf=function(){var n=/a/,t=/b*/g;return So(qd,n,"a"),So(qd,t,"a"),n.lastIndex!==0||t.lastIndex!==0}(),V0=PL.BROKEN_CARET,qf=/()??/.exec("")[1]!==void 0,RL=Xf||qf||V0||kL||ML;RL&&(Yf=function(t){var e=this,s=TL(e),r=CL(t),i=s.raw,o,a,c,l,d,h,p;if(i)return i.lastIndex=e.lastIndex,o=So(Yf,i,r),e.lastIndex=i.lastIndex,o;var f=s.groups,y=V0&&e.sticky,m=So(IL,e),x=e.source,w=0,b=r;if(y&&(m=OL(m,"y",""),DL(m,"g")===-1&&(m+="g"),b=op(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&jL(r,e.lastIndex-1)!==`
`)&&(x="(?: "+x+")",b=" "+b,w++),a=new RegExp("^(?:"+x+")",m)),qf&&(a=new RegExp("^"+x+"$(?!\\s)",m)),Xf&&(c=e.lastIndex),l=So(qd,y?a:e,b),y?l?(l.input=op(l.input,w),l[0]=op(l[0],w),l.index=e.lastIndex,e.lastIndex+=l[0].length):e.lastIndex=0:Xf&&l&&(e.lastIndex=e.global?l.index+l[0].length:c),qf&&l&&l.length>1&&So(AL,l[0],a,function(){for(d=1;d<arguments.length-2;d++)arguments[d]===void 0&&(l[d]=void 0)}),l&&f)for(l.groups=h=_L(null),d=0;d<f.length;d++)p=f[d],h[p[0]]=l[p[1]];return l});var vm=Yf,LL=ta,Ow=vm;LL({target:"RegExp",proto:!0,forced:/./.exec!==Ow},{exec:Ow});var $L=Bu,Y0=Function.prototype,Rw=Y0.apply,Lw=Y0.call,FL=typeof Reflect=="object"&&Reflect.apply||($L?Lw.bind(Rw):function(){return Lw.apply(Rw,arguments)}),$w=hr,Fw=_0,NL=vm,Nw=sn,X0=pr,BL=hm,zL=X0("species"),ap=RegExp.prototype,UL=function(n,t,e,s){var r=X0(n),i=!Nw(function(){var l={};return l[r]=function(){return 7},""[n](l)!==7}),o=i&&!Nw(function(){var l=!1,d=/a/;return n==="split"&&(d={},d.constructor={},d.constructor[zL]=function(){return d},d.flags="",d[r]=/./[r]),d.exec=function(){return l=!0,null},d[r](""),!l});if(!i||!o||e){var a=/./[r],c=t(r,""[n],function(l,d,h,p,f){var y=d.exec;return y===NL||y===ap.exec?i&&!f?{done:!0,value:$w(a,d,h,p)}:{done:!0,value:$w(l,h,d,p)}:{done:!1}});Fw(String.prototype,n,c[0]),Fw(ap,r,c[1])}s&&BL(ap[r],"sham",!0)},Cm=_t,HL=Vi,KL=kc,GL=Qo,WL=Cm("".charAt),Bw=Cm("".charCodeAt),VL=Cm("".slice),zw=function(n){return function(t,e){var s=KL(GL(t)),r=HL(e),i=s.length,o,a;return r<0||r>=i?n?"":void 0:(o=Bw(s,r),o<55296||o>56319||r+1===i||(a=Bw(s,r+1))<56320||a>57343?n?WL(s,r):o:n?VL(s,r,r+2):(o-55296<<10)+(a-56320)+65536)}},YL={codeAt:zw(!1),charAt:zw(!0)},XL=YL.charAt,qL=function(n,t,e){return t+(e?XL(n,t).length:1)},Im=_t,ZL=Pc,JL=Math.floor,cp=Im("".charAt),QL=Im("".replace),lp=Im("".slice),e$=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,t$=/\$([$&'`]|\d{1,2})/g,q0=function(n,t,e,s,r,i){var o=e+n.length,a=s.length,c=t$;return r!==void 0&&(r=ZL(r),c=e$),QL(i,c,function(l,d){var h;switch(cp(d,0)){case"$":return"$";case"&":return n;case"`":return lp(t,0,e);case"'":return lp(t,o);case"<":h=r[lp(d,1,-1)];break;default:var p=+d;if(p===0)return l;if(p>a){var f=JL(p/10);return f===0?l:f<=a?s[f-1]===void 0?cp(d,1):s[f-1]+cp(d,1):l}h=s[p-1]}return h===void 0?"":h})},Uw=hr,n$=Wi,s$=rn,r$=Jo,i$=vm,o$=TypeError,a$=function(n,t){var e=n.exec;if(s$(e)){var s=Uw(e,n,t);return s!==null&&n$(s),s}if(r$(n)==="RegExp")return Uw(i$,n,t);throw new o$("RegExp#exec called on incompatible receiver")},c$=FL,Hw=hr,Gu=_t,l$=UL,d$=sn,u$=Wi,h$=rn,p$=zu,f$=Vi,g$=k0,eo=kc,m$=Qo,y$=qL,S$=cm,w$=q0,x$=a$,b$=pr,Zf=b$("replace"),v$=Math.max,C$=Math.min,I$=Gu([].concat),dp=Gu([].push),Kw=Gu("".indexOf),Gw=Gu("".slice),P$=function(n){return n===void 0?n:String(n)},E$=function(){return"a".replace(/./,"$0")==="$0"}(),Ww=function(){return/./[Zf]?/./[Zf]("a","$0")==="":!1}(),_$=!d$(function(){var n=/./;return n.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(n,"$<a>")!=="7"});l$("replace",function(n,t,e){var s=Ww?"$":"$0";return[function(i,o){var a=m$(this),c=p$(i)?void 0:S$(i,Zf);return c?Hw(c,i,a,o):Hw(t,eo(a),i,o)},function(r,i){var o=u$(this),a=eo(r);if(typeof i=="string"&&Kw(i,s)===-1&&Kw(i,"$<")===-1){var c=e(t,o,a,i);if(c.done)return c.value}var l=h$(i);l||(i=eo(i));var d=o.global,h;d&&(h=o.unicode,o.lastIndex=0);for(var p=[],f;f=x$(o,a),!(f===null||(dp(p,f),!d));){var y=eo(f[0]);y===""&&(o.lastIndex=y$(a,g$(o.lastIndex),h))}for(var m="",x=0,w=0;w<p.length;w++){f=p[w];for(var b=eo(f[0]),I=v$(C$(f$(f.index),a.length),0),E=[],P,C=1;C<f.length;C++)dp(E,P$(f[C]));var _=f.groups;if(l){var k=I$([b],E,I,a);_!==void 0&&dp(k,_),P=eo(c$(i,void 0,k))}else P=w$(b,a,I,E,_,i);I>=x&&(m+=Gw(a,x,I)+P,x=I+b.length)}return m+Gw(a,x)}]},!_$||!E$||Ww);var T$=Gi,k$=Jo,M$=pr,A$=M$("match"),j$=function(n){var t;return T$(n)&&((t=n[A$])!==void 0?!!t:k$(n)==="RegExp")},D$=hr,O$=Jr,R$=l0,L$=W0,Vw=RegExp.prototype,$$=function(n){var t=n.flags;return t===void 0&&!("flags"in Vw)&&!O$(n,"flags")&&R$(Vw,n)?D$(L$,n):t},F$=ta,N$=hr,Pm=_t,Yw=Qo,B$=rn,z$=zu,U$=j$,wa=kc,H$=cm,K$=$$,G$=q0,W$=pr,V$=W$("replace"),Y$=TypeError,up=Pm("".indexOf);Pm("".replace);var Xw=Pm("".slice),X$=Math.max;F$({target:"String",proto:!0},{replaceAll:function(t,e){var s=Yw(this),r,i,o,a,c,l,d,h,p,f=0,y=0,m="";if(!z$(t)){if(r=U$(t),r&&(i=wa(Yw(K$(t))),!~up(i,"g")))throw new Y$("`.replaceAll` does not allow non-global regexes");if(o=H$(t,V$),o)return N$(o,t,s,e)}for(a=wa(s),c=wa(t),l=B$(e),l||(e=wa(e)),d=c.length,h=X$(1,d),f=up(a,c);f!==-1;)p=l?wa(e(c,f,a)):G$(c,a,f,[],void 0,e),m+=Xw(a,y,f)+p,y=f+d,f=f+h>a.length?-1:up(a,c,f+h);return y<a.length&&(m+=Xw(a,y)),m}});var q$=Tc;q$("String","replaceAll");class td{constructor(t){g(this,"nextValue");g(this,"diff");this.previousValue=t}get(){var s,r,i,o;const t=((r=(s=this.diff)==null?void 0:s.removed)==null?void 0:r.size)??0,e=((o=(i=this.diff)==null?void 0:i.added)==null?void 0:o.size)??0;if(!(t===0&&e===0))return{value:this.nextValue,diff:this.diff}}_add(t,e){var s,r;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(t),this.diff??(this.diff={}),e?(s=this.diff.removed)==null||s.delete(t):((r=this.diff).added??(r.added=new Set),this.diff.added.add(t))}add(t){var r,i,o;const e=this.previousValue.has(t);if(e)return((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.has(t))?this._add(t,e):void 0;(o=this.nextValue)!=null&&o.has(t)||this._add(t,e)}_remove(t,e){var s,r;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(t),this.diff??(this.diff={}),e?((s=this.diff).removed??(s.removed=new Set),this.diff.removed.add(t)):(r=this.diff.added)==null||r.delete(t)}remove(t){var r,i,o,a;const e=this.previousValue.has(t);if(!e)return((i=(r=this.diff)==null?void 0:r.added)==null?void 0:i.has(t))?this._remove(t,e):void 0;(a=(o=this.diff)==null?void 0:o.removed)!=null&&a.has(t)||this._remove(t,e)}}var Z0="Expected a function",qw=NaN,Z$="[object Symbol]",J$=/^\s+|\s+$/g,Q$=/^[-+]0x[0-9a-f]+$/i,eF=/^0b[01]+$/i,tF=/^0o[0-7]+$/i,nF=parseInt,sF=typeof qt=="object"&&qt&&qt.Object===Object&&qt,rF=typeof self=="object"&&self&&self.Object===Object&&self,iF=sF||rF||Function("return this")(),oF=Object.prototype,aF=oF.toString,cF=Math.max,lF=Math.min,hp=function(){return iF.Date.now()};function dF(n,t,e){var s,r,i,o,a,c,l=0,d=!1,h=!1,p=!0;if(typeof n!="function")throw new TypeError(Z0);t=Zw(t)||0,Zd(e)&&(d=!!e.leading,h="maxWait"in e,i=h?cF(Zw(e.maxWait)||0,t):i,p="trailing"in e?!!e.trailing:p);function f(C){var _=s,k=r;return s=r=void 0,l=C,o=n.apply(k,_),o}function y(C){return l=C,a=setTimeout(w,t),d?f(C):o}function m(C){var _=C-c,k=C-l,D=t-_;return h?lF(D,i-k):D}function x(C){var _=C-c,k=C-l;return c===void 0||_>=t||_<0||h&&k>=i}function w(){var C=hp();if(x(C))return b(C);a=setTimeout(w,m(C))}function b(C){return a=void 0,p&&s?f(C):(s=r=void 0,o)}function I(){a!==void 0&&clearTimeout(a),l=0,s=c=r=a=void 0}function E(){return a===void 0?o:b(hp())}function P(){var C=hp(),_=x(C);if(s=arguments,r=this,c=C,_){if(a===void 0)return y(c);if(h)return a=setTimeout(w,t),f(c)}return a===void 0&&(a=setTimeout(w,t)),o}return P.cancel=I,P.flush=E,P}function uF(n,t,e){var s=!0,r=!0;if(typeof n!="function")throw new TypeError(Z0);return Zd(e)&&(s="leading"in e?!!e.leading:s,r="trailing"in e?!!e.trailing:r),dF(n,t,{leading:s,maxWait:t,trailing:r})}function Zd(n){var t=typeof n;return!!n&&(t=="object"||t=="function")}function hF(n){return!!n&&typeof n=="object"}function pF(n){return typeof n=="symbol"||hF(n)&&aF.call(n)==Z$}function Zw(n){if(typeof n=="number")return n;if(pF(n))return qw;if(Zd(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Zd(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=n.replace(J$,"");var e=eF.test(n);return e||tF.test(n)?nF(n.slice(2),e?2:8):Q$.test(n)?qw:+n}var fF=uF;const J0=ur(fF);var gF=200,Em="__lodash_hash_undefined__",mF=1/0,yF="[object Function]",SF="[object GeneratorFunction]",wF=/[\\^$.*+?()[\]{}|]/g,xF=/^\[object .+?Constructor\]$/,bF=typeof qt=="object"&&qt&&qt.Object===Object&&qt,vF=typeof self=="object"&&self&&self.Object===Object&&self,_m=bF||vF||Function("return this")();function CF(n,t){var e=n?n.length:0;return!!e&&PF(n,t,0)>-1}function IF(n,t,e,s){for(var r=n.length,i=e+-1;++i<r;)if(t(n[i],i,n))return i;return-1}function PF(n,t,e){if(t!==t)return IF(n,EF,e);for(var s=e-1,r=n.length;++s<r;)if(n[s]===t)return s;return-1}function EF(n){return n!==n}function _F(n,t){return n.has(t)}function TF(n,t){return n==null?void 0:n[t]}function kF(n){var t=!1;if(n!=null&&typeof n.toString!="function")try{t=!!(n+"")}catch{}return t}function Q0(n){var t=-1,e=Array(n.size);return n.forEach(function(s){e[++t]=s}),e}var MF=Array.prototype,AF=Function.prototype,eC=Object.prototype,pp=_m["__core-js_shared__"],Jw=function(){var n=/[^.]+$/.exec(pp&&pp.keys&&pp.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),tC=AF.toString,Tm=eC.hasOwnProperty,jF=eC.toString,DF=RegExp("^"+tC.call(Tm).replace(wF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),OF=MF.splice,RF=km(_m,"Map"),fp=km(_m,"Set"),ec=km(Object,"create");function Ti(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var s=n[t];this.set(s[0],s[1])}}function LF(){this.__data__=ec?ec(null):{}}function $F(n){return this.has(n)&&delete this.__data__[n]}function FF(n){var t=this.__data__;if(ec){var e=t[n];return e===Em?void 0:e}return Tm.call(t,n)?t[n]:void 0}function NF(n){var t=this.__data__;return ec?t[n]!==void 0:Tm.call(t,n)}function BF(n,t){var e=this.__data__;return e[n]=ec&&t===void 0?Em:t,this}Ti.prototype.clear=LF;Ti.prototype.delete=$F;Ti.prototype.get=FF;Ti.prototype.has=NF;Ti.prototype.set=BF;function na(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var s=n[t];this.set(s[0],s[1])}}function zF(){this.__data__=[]}function UF(n){var t=this.__data__,e=Wu(t,n);if(e<0)return!1;var s=t.length-1;return e==s?t.pop():OF.call(t,e,1),!0}function HF(n){var t=this.__data__,e=Wu(t,n);return e<0?void 0:t[e][1]}function KF(n){return Wu(this.__data__,n)>-1}function GF(n,t){var e=this.__data__,s=Wu(e,n);return s<0?e.push([n,t]):e[s][1]=t,this}na.prototype.clear=zF;na.prototype.delete=UF;na.prototype.get=HF;na.prototype.has=KF;na.prototype.set=GF;function sa(n){var t=-1,e=n?n.length:0;for(this.clear();++t<e;){var s=n[t];this.set(s[0],s[1])}}function WF(){this.__data__={hash:new Ti,map:new(RF||na),string:new Ti}}function VF(n){return Vu(this,n).delete(n)}function YF(n){return Vu(this,n).get(n)}function XF(n){return Vu(this,n).has(n)}function qF(n,t){return Vu(this,n).set(n,t),this}sa.prototype.clear=WF;sa.prototype.delete=VF;sa.prototype.get=YF;sa.prototype.has=XF;sa.prototype.set=qF;function Jd(n){var t=-1,e=n?n.length:0;for(this.__data__=new sa;++t<e;)this.add(n[t])}function ZF(n){return this.__data__.set(n,Em),this}function JF(n){return this.__data__.has(n)}Jd.prototype.add=Jd.prototype.push=ZF;Jd.prototype.has=JF;function Wu(n,t){for(var e=n.length;e--;)if(oN(n[e][0],t))return e;return-1}function QF(n){if(!nC(n)||sN(n))return!1;var t=aN(n)||kF(n)?DF:xF;return t.test(rN(n))}function eN(n,t,e){var s=-1,r=CF,i=n.length,o=!0,a=[],c=a;if(i>=gF){var l=tN(n);if(l)return Q0(l);o=!1,r=_F,c=new Jd}else c=a;e:for(;++s<i;){var d=n[s],h=d;if(d=d!==0?d:0,o&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue e;a.push(d)}else r(c,h,e)||(c!==a&&c.push(h),a.push(d))}return a}var tN=fp&&1/Q0(new fp([,-0]))[1]==mF?function(n){return new fp(n)}:cN;function Vu(n,t){var e=n.__data__;return nN(t)?e[typeof t=="string"?"string":"hash"]:e.map}function km(n,t){var e=TF(n,t);return QF(e)?e:void 0}function nN(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function sN(n){return!!Jw&&Jw in n}function rN(n){if(n!=null){try{return tC.call(n)}catch{}try{return n+""}catch{}}return""}function iN(n){return n&&n.length?eN(n):[]}function oN(n,t){return n===t||n!==n&&t!==t}function aN(n){var t=nC(n)?jF.call(n):"";return t==yF||t==SF}function nC(n){var t=typeof n;return!!n&&(t=="object"||t=="function")}function cN(){}var lN=iN;const dN=ur(lN),Ra={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},uN=Ra.Good;class sC{constructor(){g(this,"startTime",0);g(this,"name","");g(this,"frames",0);g(this,"started",!1);g(this,"frame",null);g(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(t){this.name=t,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const t=(performance.now()-this.startTime)/1e3,e=t===0?0:Math.floor(this.frames/t),s=e>55?Ra.Good:e>30?Ra.Mid:Ra.Poor,r=s===Ra.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${e}%c fps`,`color: white; background: ${uN};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${s};color: ${r};`,"font-weight: normal")}isStarted(){return this.started}}function Mm(n,t){const e=[];e:for(const s of n){for(const r of e)if(t?t(s,r):s===r)continue e;e.push(s)}return e}function ge(n){return n.filter(t=>t!=null)}function At(n){return n[n.length-1]}function hN(n,t){let e,s=1/0;for(const r of n){const i=t(r);i<s&&(e=r,s=i)}return e}function pN(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(!Object.is(n[e],t[e]))return!1;return!0}class or{constructor(){g(this,"items",new WeakMap)}get(t,e){return this.items.has(t)||this.items.set(t,e(t)),this.items.get(t)}}function rC(n){const t=(...e)=>{try{return n(...e)}catch(s){throw s instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(s,t),s}};return t}const Qd=()=>{},Lr={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function Zt(n,t){const e=t&&n&&typeof n=="object"&&t in n?n[t]:n;throw new Error(`Unknown switch case ${e}`)}const et=rC((n,t)=>{if(!n)throw new Error(t||"Assertion Error")}),Gn=rC((n,t)=>{if(n==null)throw new Error(t??"value must be defined");return n});function iC(n,t){let e;const s=(...r)=>(e||(e={},e.promise=new Promise((i,o)=>{e.resolve=i,e.reject=o})),clearTimeout(e.timeout),e.latestArgs=r,e.timeout=setTimeout(()=>{const i=e;e=void 0;try{i.resolve(n(...i.latestArgs))}catch(o){i.reject(o)}},t),e.promise);return s.cancel=()=>{e&&clearTimeout(e.timeout)},s}const Qw=new WeakMap;function Am(n,t){if(typeof n!="object"||n===null)return;let e=Qw.get(n);e||(e={tags:{},extras:{}},Qw.set(n,e)),t.tags&&(e.tags={...e.tags,...t.tags}),t.extras&&(e.extras={...e.extras,...t.extras})}async function Ms(n,t){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...t})}const Lo=(n,t)=>{const e=new window.Image(n,t);return e.referrerPolicy="strict-origin-when-cross-origin",e};class vi{static async dataUrlToArrayBuffer(t){return Ms(t).then(function(e){return e.arrayBuffer()})}static async blobToDataUrl(t){return await new Promise((e,s)=>{if(t){const r=new FileReader;r.onload=()=>e(r.result),r.onerror=i=>s(i),r.onabort=i=>s(i),r.readAsDataURL(t)}})}static async blobToText(t){return await new Promise((e,s)=>{if(t){const r=new FileReader;r.onload=()=>e(r.result),r.onerror=i=>s(i),r.onabort=i=>s(i),r.readAsText(t)}})}}function Jf(n){let t=0;for(let e=0;e<n.length;e++)t=(t<<5)-t+n.charCodeAt(e),t|=0;return t+""}function fN(n){const t=new DataView(n);let e=0;for(let s=0;s<t.byteLength;s++)e=(e<<5)-e+t.getUint8(s),e|=0;return e+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function gN(n){const t=new Uint8Array(n);if(!t||!(typeof Buffer<"u"&&Buffer.isBuffer(t)||t instanceof Uint8Array)||t.length<16||!(t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71&&t[4]===13&&t[5]===10&&t[6]===26&&t[7]===10))return!1;function s(i,o,a,c,l=1024){if(!o)return-1;o=new RegExp(o,"g");const d=o.source.length,h=new TextDecoder,p=i.length;if(typeof c>"u"&&(c=p),a>=p||c<=0||a>=c)return-1;i=i.subarray(a,c);let f=-1,y=0,m=0,x="";e:for(;y<i.length;){const w=y+l,b=i.subarray(y,w),I=h.decode(b,{stream:!0}),E=x+I;let P,C=-1;for(;(P=o.exec(E))!==null;){C=P.index-x.length,f=m+C;break e}y=w,m+=I.length;const _=C>-1?C+d:I.length-d;x=I.slice(_)}return f>=0&&(f+=a>=0?a:p+a),f}const r=s(t,"IDAT",12);return r>=12?s(t,"acTL",8,r)>=8:!1}const mN=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 JÃ³zef SokoÅowski <j.k.sokolowski@gmail.com>
 */function ex(n,t){let e=0;for(;n[t+e];)e+=n[t+e]+1;return e+1}function yN(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function SN(n){const t=new Uint8Array(n);let e,s,r=0,i=0;if(!yN(n))return!1;for(e=t[10]&128,s=t[10]&7,r+=6,r+=7,r+=e?3*Math.pow(2,s+1):0;i<2&&r<t.length;)switch(t[r]){case 44:i+=1,e=t[r+9]&128,s=t[r+9]&7,r+=10,r+=e?3*Math.pow(2,s+1):0,r+=ex(t,r+1)+1;break;case 33:r+=2,r+=ex(t,r);break;case 59:r=t.length;break;default:r=t.length;break}return i>1}let Qf=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(Qf=new Int32Array(Qf));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const wN=(n,t)=>{let e=~~t^-1;for(let s=0;s<n.length;s++)e=Qf[(e^n[s])&255]^e>>>8;return e^-1},tx=4,nx=4;class Cs{static isPng(t,e){return t.getUint8(e+0)===137&&t.getUint8(e+1)===80&&t.getUint8(e+2)===78&&t.getUint8(e+3)===71&&t.getUint8(e+4)===13&&t.getUint8(e+5)===10&&t.getUint8(e+6)===26&&t.getUint8(e+7)===10}static getChunkType(t,e){return[String.fromCharCode(t.getUint8(e)),String.fromCharCode(t.getUint8(e+1)),String.fromCharCode(t.getUint8(e+2)),String.fromCharCode(t.getUint8(e+3))].join("")}static readChunks(t,e=0){const s={};if(!Cs.isPng(t,e))throw new Error("Not a PNG");for(e+=8;e<=t.buffer.byteLength;){const r=e,i=t.getInt32(e);e+=4;const o=Cs.getChunkType(t,e);if(o==="IDAT"&&s[o]){e+=i+tx+nx;continue}if(o==="IEND")break;s[o]={start:r,dataOffset:e+4,size:i},e+=i+tx+nx}return s}static parsePhys(t,e){return{ppux:t.getUint32(e),ppuy:t.getUint32(e+4),unit:t.getUint8(e+4)}}static findChunk(t,e){return Cs.readChunks(t)[e]}static setPhysChunk(t,e=1,s){let r=46,i=0;const o=Cs.findChunk(t,"pHYs");o&&(r=o.start,i=o.size);const a=Cs.findChunk(t,"IDAT");a&&(r=a.start,i=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const d=2835.5;l.setInt32(8,d*e),l.setInt32(12,d*e),l.setInt8(16,1);const h=new Uint8Array(c.slice(4,17));l.setInt32(17,wN(h));const p=t.buffer.slice(0,r),f=t.buffer.slice(r+i);return new Blob([p,c,f],s)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function xN(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function bN(n){const t=new Uint8Array(n);return!xN(t)||!t||t.length<21?!1:(t[20]>>1&1)===1}const oC=Object.freeze(["image/svg+xml"]),aC=Object.freeze(["image/jpeg","image/png","image/webp"]),cC=Object.freeze(["image/gif","image/apng","image/avif"]),jm=Object.freeze([...aC,...oC,...cC]),lC=Object.freeze(["video/mp4","video/webm","video/quicktime"]),vN=[...jm,...lC].join(",");class Is{static loadVideo(t){return new Promise((e,s)=>{const r=document.createElement("video");r.onloadeddata=()=>e(r),r.onerror=i=>{console.error(i),s(new Error("Could not load video"))},r.crossOrigin="anonymous",r.src=t})}static loadImage(t){return new Promise((e,s)=>{const r=Lo();r.onload=()=>e(r),r.onerror=i=>{console.error(i),s(new Error("Could not load image"))},r.crossOrigin="anonymous",r.referrerPolicy="strict-origin-when-cross-origin",r.src=t})}static async getVideoSize(t){return Is.usingObjectURL(t,async e=>{const s=await Is.loadVideo(e);return{w:s.videoWidth,h:s.videoHeight}})}static async getImageSize(t){const e=await Is.usingObjectURL(t,Is.loadImage);try{if(t.type==="image/png"){const s=new DataView(await t.arrayBuffer());if(Cs.isPng(s,0)){const r=Cs.findChunk(s,"pHYs");if(r){const i=Cs.parsePhys(s,r.dataOffset);if(i.unit===0&&i.ppux===i.ppuy){const o=Math.max(i.ppux/2834.5,1);return{w:Math.round(e.naturalWidth/o),h:Math.round(e.naturalHeight/o)}}}}}}catch(s){return console.error(s),{w:e.naturalWidth,h:e.naturalHeight}}return{w:e.naturalWidth,h:e.naturalHeight}}static async isAnimated(t){return t.type==="image/gif"?SN(await t.arrayBuffer()):t.type==="image/avif"?mN(await t.arrayBuffer()):t.type==="image/webp"?bN(await t.arrayBuffer()):t.type==="image/apng"?gN(await t.arrayBuffer()):!1}static isAnimatedImageType(t){return cC.includes(t||"")}static isStaticImageType(t){return aC.includes(t||"")}static isVectorImageType(t){return oC.includes(t||"")}static isImageType(t){return jm.includes(t)}static async usingObjectURL(t,e){const s=URL.createObjectURL(t);try{return await e(s)}finally{URL.revokeObjectURL(s)}}}function fl(n,t,e){return n+(t-n)*e}function ds(n=""){let t=0,e=0,s=0,r=0;function i(){const o=t^t<<11;return t=e,e=s,s=r,r^=(r>>>19^o^o>>>8)>>>0,r/4294967296*2}for(let o=0;o<n.length+64;o++)t^=n.charCodeAt(o)|0,i();return i}function $o(n,t,e,s=!1){const[r,i]=t,[o,a]=e,c=o+(n-r)/(i-r)*(a-o);return s?o<a?Math.max(Math.min(c,a),o):Math.max(Math.min(c,o),a):c}function Es(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function mn(n,t){if(Es(n,t))return n[t]}function sx(n){return Object.keys(n)}function lt(n){return Object.values(n)}function wn(n){return Object.entries(n)}function dC(n){return Object.fromEntries(n)}function Ha(n,t){const e={};let s=!1;for(const[r,i]of wn(n))t(r,i)?e[r]=i:s=!0;return s?e:n}function Mc(n,t){const e={};for(const[s,r]of wn(n)){const i=t(s,r);e[s]=i}return e}function uC(n,t){if(n===t)return!0;const e=new Set(Object.keys(n)),s=new Set(Object.keys(t));if(e.size!==s.size)return!1;for(const r of e)if(!s.has(r)||!Object.is(n[r],t[r]))return!1;return!0}const An="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",hC="a0",pC="A00000000000000000000000000";function fC(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-97+2;if(n>="A"&&n<="Z")return 90-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function gC(n){if(n.length!==fC(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function rx(n){if(n===void 0)throw Error("n is undefined")}function ix(n){gC(n);const[t,...e]=n.split("");let s=!0;for(let r=e.length-1;s&&r>=0;r--){const i=An.indexOf(e[r])+1;i===An.length?e[r]="0":(e[r]=An.charAt(i),s=!1)}if(s){if(t==="Z")return"a0";if(t==="z")return;const r=String.fromCharCode(t.charCodeAt(0)+1);return r>"a"?e.push("0"):e.pop(),r+e.join("")}else return t+e.join("")}function CN(n){gC(n);const[t,...e]=n.split("");let s=!0;for(let r=e.length-1;s&&r>=0;r--){const i=An.indexOf(e[r])-1;i===-1?e[r]=An.slice(-1):(e[r]=An.charAt(i),s=!1)}if(s){if(t==="a")return"Z"+An.slice(-1);if(t==="A")return;const r=String.fromCharCode(t.charCodeAt(0)-1);return r<"Z"?e.push(An.slice(-1)):e.pop(),r+e.join("")}else return t+e.join("")}function wo(n,t){if(t!==void 0&&n>=t)throw new Error(n+" >= "+t);if(n.slice(-1)==="0"||t&&t.slice(-1)==="0")throw new Error("trailing zero");if(t){let r=0;for(;(n.charAt(r)||"0")===t.charAt(r);)r++;if(r>0)return t.slice(0,r)+wo(n.slice(r),t.slice(r))}const e=n?An.indexOf(n.charAt(0)):0,s=t!==void 0?An.indexOf(t.charAt(0)):An.length;if(s-e>1){const r=Math.round(.5*(e+s));return An.charAt(r)}else return t&&t.length>1?t.slice(0,1):An.charAt(e)+wo(n.slice(1),void 0)}function La(n){const t=fC(n.charAt(0));if(t>n.length)throw new Error("invalid index: "+n);return n.slice(0,t)}function eg(n){if(n===pC)throw new Error("invalid index: "+n);const t=La(n);if(n.slice(t.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function to(n,t){if(n!==void 0&&eg(n),t!==void 0&&eg(t),n!==void 0&&t!==void 0&&n>=t)throw new Error(n+" >= "+t);if(n===void 0&&t===void 0)return hC;if(n===void 0){if(t===void 0)throw Error("b is undefined");const a=La(t),c=t.slice(a.length);if(a===pC)return a+wo("",c);if(a<t)return a;const l=CN(a);return rx(l),l}if(t===void 0){const a=La(n),c=n.slice(a.length),l=ix(a);return l===void 0?a+wo(c,void 0):l}const e=La(n),s=n.slice(e.length),r=La(t),i=t.slice(r.length);if(e===r)return e+wo(s,i);const o=ix(e);return rx(o),o<t?o:e+wo(s,void 0)}function Ur(n,t,e){if(e===0)return[];if(e===1)return[to(n,t)];if(t===void 0){let i=to(n,t);const o=[i];for(let a=0;a<e-1;a++)i=to(i,t),o.push(i);return o}if(n===void 0){let i=to(n,t);const o=[i];for(let a=0;a<e-1;a++)i=to(n,i),o.push(i);return o.reverse(),o}const s=Math.floor(e/2),r=to(n,t);return[...Ur(n,r,s),r,...Ur(r,t,e-s-1)]}const IN=hC;function PN(n){eg(n)}function Fo(n,t,e){return Ur(n,t,e)}function gp(n,t){return Ur(n,void 0,t)}function tc(n,t){return Ur(n,t,1)[0]}function Zs(n){return Ur(n,void 0,1)[0]}function EN(n){return Ur(void 0,n,1)[0]}function nc(n,t="a1"){return[t,...Ur(t,void 0,n)]}function Xt(n,t){return n.index<t.index?-1:n.index>t.index?1:0}function _N(n,t){return n.id>t.id?1:-1}function Dm(n){try{return localStorage.getItem(n)}catch{return null}}function Om(n,t){try{localStorage.setItem(n,t)}catch{}}function TN(){try{localStorage.clear()}catch{}}function mC(n){try{return sessionStorage.getItem(n)}catch{return null}}function Rm(n,t){try{sessionStorage.setItem(n,t)}catch{}}function yC(n){try{sessionStorage.removeItem(n)}catch{}}function kN(){try{sessionStorage.clear()}catch{}}const MN=()=>typeof process<"u"&&!1,xo=[],AN=60,nd=Math.ceil(1e3/AN);let xa,mp=0,tg=0;const jN=()=>{const n=xo.splice(0,xo.length);for(const t of n)t()};function SC(){if(xa)return;const n=Date.now(),t=n-tg;if(mp+t<nd){xa=requestAnimationFrame(()=>{xa=void 0,SC()});return}xa=requestAnimationFrame(()=>{xa=void 0,tg=n,mp=Math.min(mp+t-nd,nd*10),jN()})}let ox=!1;function wC(n){return MN()?(n(),()=>{}):(xo.includes(n)||(xo.push(n),ox||(ox=!0,tg=Date.now()-nd-1),SC()),()=>{const t=xo.indexOf(n);t>-1&&xo.splice(t,1)})}class DN{constructor(){g(this,"timeouts",[]);g(this,"intervals",[]);g(this,"rafs",[])}setTimeout(t,e,...s){const r=window.setTimeout(t,e,s);return this.timeouts.push(r),r}setInterval(t,e,...s){const r=window.setInterval(t,e,s);return this.intervals.push(r),r}requestAnimationFrame(t){const e=window.requestAnimationFrame(t);return this.rafs.push(e),e}dispose(){this.timeouts.forEach(t=>clearTimeout(t)),this.intervals.forEach(t=>clearInterval(t)),this.rafs.forEach(t=>cancelAnimationFrame(t)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function ON(n){return n!==null}function RN(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const xC=RN(),Je=xC[0];xC[1];const LN=Object.getPrototypeOf(Je({}));let Ac=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((t,e)=>(e&=63,e<36?t+=e.toString(36):e<62?t+=(e-26).toString(36).toUpperCase():e>62?t+="-":t+="_",t),"");class Yu{constructor(t,e){g(this,"createDefaultProperties");g(this,"validator");g(this,"ephemeralKeys");g(this,"ephemeralKeySet");g(this,"scope");g(this,"isInstance",t=>(t==null?void 0:t.typeName)===this.typeName);this.typeName=t,this.createDefaultProperties=e.createDefaultProperties,this.validator=e.validator??{validate:r=>r},this.scope=e.scope??"document",this.ephemeralKeys=e.ephemeralKeys;const s=new Set;if(e.ephemeralKeys)for(const[r,i]of wn(e.ephemeralKeys))i&&s.add(r);this.ephemeralKeySet=s}create(t){const e={...this.createDefaultProperties(),id:this.createId()};for(const[s,r]of Object.entries(t))r!==void 0&&(e[s]=r);return e.typeName=this.typeName,e}clone(t){return{...Je(t),id:this.createId()}}createId(t){return this.typeName+":"+(t??Ac())}createCustomId(t){return this.typeName+":"+t}parseId(t){if(!this.isId(t))throw new Error(`ID "${t}" is not a valid ID for type "${this.typeName}"`);return t.slice(this.typeName.length+1)}isId(t){if(!t)return!1;for(let e=0;e<this.typeName.length;e++)if(t[e]!==this.typeName[e])return!1;return t[this.typeName.length]===":"}withDefaultProperties(t){return new Yu(this.typeName,{createDefaultProperties:t,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(t,e){return e&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(e,t):this.validator.validate(t)}}function Fs(n,t){return new Yu(n,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}function eu(){return{added:{},updated:{},removed:{}}}function ng(n){const t={added:n.removed,removed:n.added,updated:{}};for(const[e,s]of Object.values(n.updated))t.updated[e.id]=[s,e];return t}function bC(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function Lm(n){const t={added:{},removed:{},updated:{}};return Ka(t,n),t}function Ka(n,t){for(const e of t){for(const[s,r]of wn(e.added))if(n.removed[s]){const i=n.removed[s];delete n.removed[s],i!==r&&(n.updated[s]=[i,r])}else n.added[s]=r;for(const[s,[r,i]]of wn(e.updated)){if(n.added[s]){n.added[s]=i,delete n.updated[s],delete n.removed[s];continue}if(n.updated[s]){n.updated[s]=[n.updated[s][0],i],delete n.removed[s];continue}n.updated[s]=e.updated[s],delete n.removed[s]}for(const[s,r]of wn(e.removed))n.added[s]?delete n.added[s]:n.updated[s]?(n.removed[s]=n.updated[s][0],delete n.updated[s]):n.removed[s]=r}}function vC(n){return n&&typeof n=="object"&&"parents"in n}function CC(n){for(let t=0,e=n.parents.length;t<e;t++)if(n.parents[t].__unsafe__getWithoutCapture(!0),n.parents[t].lastChangedEpoch!==n.parentEpochs[t])return!0;return!1}const tu=(n,t)=>{if(n.children.remove(t)&&n.children.isEmpty&&vC(n))for(let e=0,s=n.parents.length;e<s;e++)tu(n.parents[e],n)},$m=(n,t)=>{if(n.children.add(t)&&vC(n))for(let e=0,s=n.parents.length;e<s;e++)$m(n.parents[e],n)};function IC(n,t){return n===t||Object.is(n,t)||!!(n&&t&&typeof n.equals=="function"&&n.equals(t))}function Qr(n,t){const e=Symbol.for(`com.tldraw.state/${n}`),s=globalThis;return s[e]??(s[e]=t()),s[e]}const tr=Qr("empty_array",()=>Object.freeze([])),ax=8;class nu{constructor(){g(this,"arraySize",0);g(this,"array",Array(ax));g(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(t){if(this.array)return this.array.indexOf(t)!==-1?!1:this.arraySize<ax?(this.array[this.arraySize]=t,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(t),!0);if(this.set)return this.set.has(t)?!1:(this.set.add(t),!0);throw new Error("no set or array")}remove(t){if(this.array){const e=this.array.indexOf(t);return e===-1?!1:(this.array[e]=void 0,this.arraySize--,e!==this.arraySize&&(this.array[e]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(t)?(this.set.delete(t),!0):!1;throw new Error("no set or array")}visit(t){if(this.array){for(let e=0;e<this.arraySize;e++){const s=this.array[e];typeof s<"u"&&t(s)}return}if(this.set){this.set.forEach(t);return}throw new Error("no set or array")}has(t){return this.array?this.array.indexOf(t)!==-1:this.set.has(t)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const jn=Symbol.for("com.tldraw.state/RESET_VALUE");class PC{constructor(t){g(this,"index",0);g(this,"buffer");this.capacity=t,this.buffer=new Array(t)}pushEntry(t,e,s){if(s!==void 0){if(s===jn){this.clear();return}this.buffer[this.index]=[t,e,s],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(t){const{index:e,capacity:s,buffer:r}=this;for(let i=0;i<s;i++){const o=(e-1+s-i)%s,a=r[o];if(!a)return jn;const[c,l]=a;if(i===0&&t>=l)return[];if(c<=t&&t<l){const d=i+1,h=new Array(d);for(let p=0;p<d;p++)h[p]=r[(o+p)%s][2];return h}}return jn}}class $N{constructor(t,e){g(this,"offset",0);g(this,"maybeRemoved");this.below=t,this.child=e}}const qe=Qr("capture",()=>({stack:null}));function yp(n){const t=qe.stack;qe.stack=null;try{return n()}finally{qe.stack=t}}function EC(n){qe.stack=new $N(qe.stack,n),n.parentSet.clear()}function _C(){const n=qe.stack;if(qe.stack=n.below,n.offset<n.child.parents.length){for(let t=n.offset;t<n.child.parents.length;t++){const e=n.child.parents[t];n.child.parentSet.has(e)||tu(e,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let t=0;t<n.maybeRemoved.length;t++){const e=n.maybeRemoved[t];n.child.parentSet.has(e)||tu(e,n.child)}}function su(n){if(qe.stack){if(qe.stack.child.parentSet.has(n))return;if(qe.stack.child.parentSet.add(n),qe.stack.child.isActivelyListening&&$m(n,qe.stack.child),qe.stack.offset<qe.stack.child.parents.length){const e=qe.stack.child.parents[qe.stack.offset];e!==n&&(qe.stack.maybeRemoved?qe.stack.maybeRemoved.push(e):qe.stack.maybeRemoved=[e])}qe.stack.child.parents[qe.stack.offset]=n,qe.stack.child.parentEpochs[qe.stack.offset]=n.lastChangedEpoch,qe.stack.offset++}}const jr=-1;class FN{constructor(t,e,s){g(this,"_isActivelyListening",!1);g(this,"lastTraversedEpoch",jr);g(this,"lastReactedEpoch",jr);g(this,"_scheduleCount",0);g(this,"parentSet",new nu);g(this,"parentEpochs",[]);g(this,"parents",[]);g(this,"_scheduleEffect");g(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=t,this.runEffect=e,this._scheduleEffect=s==null?void 0:s.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==hn()){if(this.parents.length&&!CC(this)){this.lastReactedEpoch=hn();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let t=0,e=this.parents.length;t<e;t++)$m(this.parents[t],this)}detach(){this._isActivelyListening=!1;for(let t=0,e=this.parents.length;t<e;t++)tu(this.parents[t],this)}execute(){try{EC(this);const t=hn(),e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=t,e}finally{_C()}}}const ra=Qr("EffectScheduler",()=>FN);function ei(n,t,e){const s=new ra(n,t,e);return s.attach(),s.scheduleEffect(),()=>{s.detach()}}function NN(n,t,e){const s=new ra(n,t,e);return{scheduler:s,start:r=>{const i=(r==null?void 0:r.force)??!1;s.attach(),i?s.scheduleEffect():s.maybeScheduleEffect()},stop:()=>{s.detach()}}}let BN=class{constructor(t){g(this,"initialAtomValues",new Map);this.parent=t}get isRoot(){return this.parent===null}commit(){this.isRoot?TC(this.initialAtomValues.keys()):this.initialAtomValues.forEach((t,e)=>{this.parent.initialAtomValues.has(e)||this.parent.initialAtomValues.set(e,t)})}abort(){Le.globalEpoch++,this.initialAtomValues.forEach((t,e)=>{var s;e.set(t),(s=e.historyBuffer)==null||s.clear()}),this.commit()}};const Le=Qr("transactions",()=>({globalEpoch:jr+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:jr+1}));function zN(){return Le.reactionEpoch}function hn(){return Le.globalEpoch}function UN(){return Le.globalIsReacting}function Fm(n,t){t.lastTraversedEpoch!==Le.globalEpoch&&(t.lastTraversedEpoch=Le.globalEpoch,t instanceof ra?n.add(t):t.children.visit(e=>Fm(n,e)))}function TC(n){var t;if(Le.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{Le.globalIsReacting=!0,Le.reactionEpoch=Le.globalEpoch;const e=new Set;for(const r of n)r.children.visit(i=>Fm(e,i));for(const r of e)r.maybeScheduleEffect();let s=0;for(;(t=Le.cleanupReactors)!=null&&t.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const r=Le.cleanupReactors;Le.cleanupReactors=null;for(const i of r)i.maybeScheduleEffect()}}finally{Le.cleanupReactors=null,Le.globalIsReacting=!1}}function HN(n,t){if(Le.globalIsReacting){const e=Le.cleanupReactors??(Le.cleanupReactors=new Set);n.children.visit(s=>Fm(e,s))}else Le.currentTransaction?Le.currentTransaction.initialAtomValues.has(n)||Le.currentTransaction.initialAtomValues.set(n,t):TC([n])}function KN(){Le.globalEpoch++}function GN(n){const t=new BN(Le.currentTransaction);Le.currentTransaction=t;try{let e,s=!1;try{e=n(()=>s=!0)}catch(r){throw t.abort(),r}return s?t.abort():t.commit(),e}finally{Le.currentTransaction=Le.currentTransaction.parent}}function $r(n){return Le.currentTransaction?n():GN(n)}class WN{constructor(t,e,s){g(this,"isEqual");g(this,"computeDiff");g(this,"lastChangedEpoch",hn());g(this,"children",new nu);g(this,"historyBuffer");this.name=t,this.current=e,this.isEqual=(s==null?void 0:s.isEqual)??null,s&&(s.historyLength&&(this.historyBuffer=new PC(s.historyLength)),this.computeDiff=s.computeDiff)}__unsafe__getWithoutCapture(t){return this.current}get(){return su(this),this.current}set(t,e){var r,i;if(((r=this.isEqual)==null?void 0:r.call(this,this.current,t))??IC(this.current,t))return this.current;KN(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,hn(),e??((i=this.computeDiff)==null?void 0:i.call(this,this.current,t,this.lastChangedEpoch,hn()))??jn),this.lastChangedEpoch=hn();const s=this.current;return this.current=t,HN(this,s),t}update(t){return this.set(t(this.current))}getDiffSince(t){var e;return su(this),t>=this.lastChangedEpoch?tr:((e=this.historyBuffer)==null?void 0:e.getChangesSince(t))??jn}}const VN=Qr("Atom",()=>WN);function Ct(n,t,e){return new VN(n,t,e)}let cx=!1;function YN(){cx||(cx=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const $a=Symbol.for("com.tldraw.state/UNINITIALIZED"),Ci=n=>n===$a,sg=Qr("WithDiff",()=>class{constructor(t,e){this.value=t,this.diff=e}});function Fa(n,t){return new sg(n,t)}class XN{constructor(t,e,s){g(this,"lastChangedEpoch",jr);g(this,"lastTraversedEpoch",jr);g(this,"lastCheckedEpoch",jr);g(this,"parentSet",new nu);g(this,"parents",[]);g(this,"parentEpochs",[]);g(this,"children",new nu);g(this,"historyBuffer");g(this,"state",$a);g(this,"error",null);g(this,"computeDiff");g(this,"isEqual");this.name=t,this.derive=e,s!=null&&s.historyLength&&(this.historyBuffer=new PC(s.historyLength)),this.computeDiff=s==null?void 0:s.computeDiff,this.isEqual=(s==null?void 0:s.isEqual)??IC}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(t){var r;const e=this.lastChangedEpoch===jr,s=hn();if(!e&&(this.lastCheckedEpoch===s||this.isActivelyListening&&UN()&&this.lastTraversedEpoch<zN()||!CC(this)))if(this.lastCheckedEpoch=s,this.error){if(t)return this.state;throw this.error.thrownValue}else return this.state;try{EC(this);const i=this.derive(this.state,this.lastCheckedEpoch),o=i instanceof sg?i.value:i,a=this.state===$a;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const c=i instanceof sg?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,hn(),c??((r=this.computeDiff)==null?void 0:r.call(this,this.state,o,this.lastCheckedEpoch,hn()))??jn)}this.lastChangedEpoch=hn(),this.state=o}return this.error=null,this.lastCheckedEpoch=hn(),this.state}catch(i){if(this.state!==$a&&(this.state=$a,this.lastChangedEpoch=hn()),this.lastCheckedEpoch=hn(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!t)throw i;return this.state}finally{_C()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{su(this)}}getDiffSince(t){var e;return this.__unsafe__getWithoutCapture(!0),su(this),t>=this.lastChangedEpoch?tr:((e=this.historyBuffer)==null?void 0:e.getChangesSince(t))??jn}}const Nm=Qr("Computed",()=>XN);function qN(n={},t,e,s){const r=s.value,i=Symbol.for("__@tldraw/state__computed__"+e);return s.value=function(){let o=this[i];return o||(o=new Nm(e,r.bind(this),n),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s.value[JN]=!0,s}function lx(n={},t,e,s){return s.get?(YN(),ZN(n,t,e,s)):qN(n,t,e,s)}function ZN(n={},t,e,s){const r=s.get,i=Symbol.for("__@tldraw/state__computed__"+e);return s.get=function(){let o=this[i];return o||(o=new Nm(e,r.bind(this),n),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s}const JN="@@__isComputedMethod__@@";function K(){if(arguments.length===1){const n=arguments[0];return(t,e,s)=>lx(n,t,e,s)}else return typeof arguments[0]=="string"?new Nm(arguments[0],arguments[1],arguments[2]):lx(void 0,arguments[0],arguments[1],arguments[2])}const kC=1,QN=Qr("apiVersion",()=>kC);if(QN!==kC)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function Xu(n,t){const e=me.useRef(t);e.current=t;const[s,r,i]=me.useMemo(()=>{let o=null;const a=d=>(o=d,()=>{o=null}),c=new ra(`useStateTracking(${n})`,()=>{var d;return(d=e.current)==null?void 0:d.call(e)},{scheduleEffect(){o==null||o()}});return[c,a,()=>c.scheduleCount]},[n]);return me.useSyncExternalStore(r,i,i),me.useEffect(()=>(s.attach(),s.maybeScheduleEffect(),()=>{s.detach()}),[s]),s.execute()}const dx={apply(n,t,e){return Xu(n.displayName??n.name??"tracked(???)",()=>n.apply(t,e))}},eB=Symbol.for("react.memo"),tB=Symbol.for("react.forward_ref");function Cn(n){let t=null;const e=n.$$typeof;return e===eB&&(n=n.type,t=n.compare),e===tB?v.memo(v.forwardRef(new Proxy(n.render,dx))):v.memo(new Proxy(n,dx),t)}function nB(){const n=arguments[0],t=arguments[1],e=arguments.length===3?void 0:arguments[2],s=arguments.length===3?arguments[2]:arguments[3];return v.useMemo(()=>K(`useComputed(${n})`,t,e),s)}function Fr(n,t,e=tr){v.useEffect(()=>{const s=new ra(n,t);return s.attach(),s.execute(),()=>{s.detach()}},e)}function z(){const n=arguments,t=n.length===3?n[2]:[n[0]],e=n.length===3?n[0]:`useValue(${n[0].name})`,s=v.useRef(!0);s.current=!0;const r=v.useMemo(()=>n.length===1?n[0]:K(e,()=>{if(s.current)return n[1]();try{return n[1]()}catch{return{}}}),t);try{const{subscribe:i,getSnapshot:o}=v.useMemo(()=>({subscribe:a=>ei(`useValue(${e})`,()=>{r.get(),a()}),getSnapshot:()=>r.get()}),[r]);return v.useSyncExternalStore(i,o,o)}finally{s.current=!1}}var ru={exports:{}};ru.exports;(function(n,t){var e=200,s="__lodash_hash_undefined__",r=1,i=2,o=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",d="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",y="[object GeneratorFunction]",m="[object Map]",x="[object Number]",w="[object Null]",b="[object Object]",I="[object Promise]",E="[object Proxy]",P="[object RegExp]",C="[object Set]",_="[object String]",k="[object Symbol]",D="[object Undefined]",T="[object WeakMap]",A="[object ArrayBuffer]",L="[object DataView]",j="[object Float32Array]",R="[object Float64Array]",F="[object Int8Array]",H="[object Int16Array]",U="[object Int32Array]",V="[object Uint8Array]",W="[object Uint8ClampedArray]",te="[object Uint16Array]",le="[object Uint32Array]",Se=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,nt=/^(?:0|[1-9]\d*)$/,ie={};ie[j]=ie[R]=ie[F]=ie[H]=ie[U]=ie[V]=ie[W]=ie[te]=ie[le]=!0,ie[a]=ie[c]=ie[A]=ie[d]=ie[L]=ie[h]=ie[p]=ie[f]=ie[m]=ie[x]=ie[b]=ie[P]=ie[C]=ie[_]=ie[T]=!1;var yt=typeof qt=="object"&&qt&&qt.Object===Object&&qt,Ke=typeof self=="object"&&self&&self.Object===Object&&self,Ye=yt||Ke||Function("return this")(),ke=t&&!t.nodeType&&t,st=ke&&!0&&n&&!n.nodeType&&n,Re=st&&st.exports===ke,_n=Re&&yt.process,Tt=function(){try{return _n&&_n.binding&&_n.binding("util")}catch{}}(),cn=Tt&&Tt.isTypedArray;function ut(M,O){for(var G=-1,q=M==null?0:M.length,Ge=0,pe=[];++G<q;){var ct=M[G];O(ct,G,M)&&(pe[Ge++]=ct)}return pe}function Bt(M,O){for(var G=-1,q=O.length,Ge=M.length;++G<q;)M[Ge+G]=O[G];return M}function Us(M,O){for(var G=-1,q=M==null?0:M.length;++G<q;)if(O(M[G],G,M))return!0;return!1}function ha(M,O){for(var G=-1,q=Array(M);++G<M;)q[G]=O(G);return q}function xr(M){return function(O){return M(O)}}function kM(M,O){return M.has(O)}function MM(M,O){return M==null?void 0:M[O]}function AM(M){var O=-1,G=Array(M.size);return M.forEach(function(q,Ge){G[++O]=[Ge,q]}),G}function jM(M,O){return function(G){return M(O(G))}}function DM(M){var O=-1,G=Array(M.size);return M.forEach(function(q){G[++O]=q}),G}var OM=Array.prototype,RM=Function.prototype,tl=Object.prototype,$h=Ye["__core-js_shared__"],NS=RM.toString,ys=tl.hasOwnProperty,BS=function(){var M=/[^.]+$/.exec($h&&$h.keys&&$h.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""}(),zS=tl.toString,LM=RegExp("^"+NS.call(ys).replace(Se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),US=Re?Ye.Buffer:void 0,nl=Ye.Symbol,HS=Ye.Uint8Array,KS=tl.propertyIsEnumerable,$M=OM.splice,li=nl?nl.toStringTag:void 0,GS=Object.getOwnPropertySymbols,FM=US?US.isBuffer:void 0,NM=jM(Object.keys,Object),Fh=Ji(Ye,"DataView"),pa=Ji(Ye,"Map"),Nh=Ji(Ye,"Promise"),Bh=Ji(Ye,"Set"),zh=Ji(Ye,"WeakMap"),fa=Ji(Object,"create"),BM=hi(Fh),zM=hi(pa),UM=hi(Nh),HM=hi(Bh),KM=hi(zh),WS=nl?nl.prototype:void 0,Uh=WS?WS.valueOf:void 0;function di(M){var O=-1,G=M==null?0:M.length;for(this.clear();++O<G;){var q=M[O];this.set(q[0],q[1])}}function GM(){this.__data__=fa?fa(null):{},this.size=0}function WM(M){var O=this.has(M)&&delete this.__data__[M];return this.size-=O?1:0,O}function VM(M){var O=this.__data__;if(fa){var G=O[M];return G===s?void 0:G}return ys.call(O,M)?O[M]:void 0}function YM(M){var O=this.__data__;return fa?O[M]!==void 0:ys.call(O,M)}function XM(M,O){var G=this.__data__;return this.size+=this.has(M)?0:1,G[M]=fa&&O===void 0?s:O,this}di.prototype.clear=GM,di.prototype.delete=WM,di.prototype.get=VM,di.prototype.has=YM,di.prototype.set=XM;function Hs(M){var O=-1,G=M==null?0:M.length;for(this.clear();++O<G;){var q=M[O];this.set(q[0],q[1])}}function qM(){this.__data__=[],this.size=0}function ZM(M){var O=this.__data__,G=rl(O,M);if(G<0)return!1;var q=O.length-1;return G==q?O.pop():$M.call(O,G,1),--this.size,!0}function JM(M){var O=this.__data__,G=rl(O,M);return G<0?void 0:O[G][1]}function QM(M){return rl(this.__data__,M)>-1}function eA(M,O){var G=this.__data__,q=rl(G,M);return q<0?(++this.size,G.push([M,O])):G[q][1]=O,this}Hs.prototype.clear=qM,Hs.prototype.delete=ZM,Hs.prototype.get=JM,Hs.prototype.has=QM,Hs.prototype.set=eA;function ui(M){var O=-1,G=M==null?0:M.length;for(this.clear();++O<G;){var q=M[O];this.set(q[0],q[1])}}function tA(){this.size=0,this.__data__={hash:new di,map:new(pa||Hs),string:new di}}function nA(M){var O=il(this,M).delete(M);return this.size-=O?1:0,O}function sA(M){return il(this,M).get(M)}function rA(M){return il(this,M).has(M)}function iA(M,O){var G=il(this,M),q=G.size;return G.set(M,O),this.size+=G.size==q?0:1,this}ui.prototype.clear=tA,ui.prototype.delete=nA,ui.prototype.get=sA,ui.prototype.has=rA,ui.prototype.set=iA;function sl(M){var O=-1,G=M==null?0:M.length;for(this.__data__=new ui;++O<G;)this.add(M[O])}function oA(M){return this.__data__.set(M,s),this}function aA(M){return this.__data__.has(M)}sl.prototype.add=sl.prototype.push=oA,sl.prototype.has=aA;function br(M){var O=this.__data__=new Hs(M);this.size=O.size}function cA(){this.__data__=new Hs,this.size=0}function lA(M){var O=this.__data__,G=O.delete(M);return this.size=O.size,G}function dA(M){return this.__data__.get(M)}function uA(M){return this.__data__.has(M)}function hA(M,O){var G=this.__data__;if(G instanceof Hs){var q=G.__data__;if(!pa||q.length<e-1)return q.push([M,O]),this.size=++G.size,this;G=this.__data__=new ui(q)}return G.set(M,O),this.size=G.size,this}br.prototype.clear=cA,br.prototype.delete=lA,br.prototype.get=dA,br.prototype.has=uA,br.prototype.set=hA;function pA(M,O){var G=ol(M),q=!G&&TA(M),Ge=!G&&!q&&Hh(M),pe=!G&&!q&&!Ge&&tw(M),ct=G||q||Ge||pe,xt=ct?ha(M.length,String):[],kt=xt.length;for(var rt in M)ys.call(M,rt)&&!(ct&&(rt=="length"||Ge&&(rt=="offset"||rt=="parent")||pe&&(rt=="buffer"||rt=="byteLength"||rt=="byteOffset")||CA(rt,kt)))&&xt.push(rt);return xt}function rl(M,O){for(var G=M.length;G--;)if(ZS(M[G][0],O))return G;return-1}function fA(M,O,G){var q=O(M);return ol(M)?q:Bt(q,G(M))}function ga(M){return M==null?M===void 0?D:w:li&&li in Object(M)?bA(M):_A(M)}function VS(M){return ma(M)&&ga(M)==a}function YS(M,O,G,q,Ge){return M===O?!0:M==null||O==null||!ma(M)&&!ma(O)?M!==M&&O!==O:gA(M,O,G,q,YS,Ge)}function gA(M,O,G,q,Ge,pe){var ct=ol(M),xt=ol(O),kt=ct?c:vr(M),rt=xt?c:vr(O);kt=kt==a?b:kt,rt=rt==a?b:rt;var Tn=kt==b,ts=rt==b,zt=kt==rt;if(zt&&Hh(M)){if(!Hh(O))return!1;ct=!0,Tn=!1}if(zt&&!Tn)return pe||(pe=new br),ct||tw(M)?XS(M,O,G,q,Ge,pe):wA(M,O,kt,G,q,Ge,pe);if(!(G&r)){var Bn=Tn&&ys.call(M,"__wrapped__"),zn=ts&&ys.call(O,"__wrapped__");if(Bn||zn){var Cr=Bn?M.value():M,Ks=zn?O.value():O;return pe||(pe=new br),Ge(Cr,Ks,G,q,pe)}}return zt?(pe||(pe=new br),xA(M,O,G,q,Ge,pe)):!1}function mA(M){if(!ew(M)||PA(M))return!1;var O=JS(M)?LM:be;return O.test(hi(M))}function yA(M){return ma(M)&&QS(M.length)&&!!ie[ga(M)]}function SA(M){if(!EA(M))return NM(M);var O=[];for(var G in Object(M))ys.call(M,G)&&G!="constructor"&&O.push(G);return O}function XS(M,O,G,q,Ge,pe){var ct=G&r,xt=M.length,kt=O.length;if(xt!=kt&&!(ct&&kt>xt))return!1;var rt=pe.get(M);if(rt&&pe.get(O))return rt==O;var Tn=-1,ts=!0,zt=G&i?new sl:void 0;for(pe.set(M,O),pe.set(O,M);++Tn<xt;){var Bn=M[Tn],zn=O[Tn];if(q)var Cr=ct?q(zn,Bn,Tn,O,M,pe):q(Bn,zn,Tn,M,O,pe);if(Cr!==void 0){if(Cr)continue;ts=!1;break}if(zt){if(!Us(O,function(Ks,pi){if(!kM(zt,pi)&&(Bn===Ks||Ge(Bn,Ks,G,q,pe)))return zt.push(pi)})){ts=!1;break}}else if(!(Bn===zn||Ge(Bn,zn,G,q,pe))){ts=!1;break}}return pe.delete(M),pe.delete(O),ts}function wA(M,O,G,q,Ge,pe,ct){switch(G){case L:if(M.byteLength!=O.byteLength||M.byteOffset!=O.byteOffset)return!1;M=M.buffer,O=O.buffer;case A:return!(M.byteLength!=O.byteLength||!pe(new HS(M),new HS(O)));case d:case h:case x:return ZS(+M,+O);case p:return M.name==O.name&&M.message==O.message;case P:case _:return M==O+"";case m:var xt=AM;case C:var kt=q&r;if(xt||(xt=DM),M.size!=O.size&&!kt)return!1;var rt=ct.get(M);if(rt)return rt==O;q|=i,ct.set(M,O);var Tn=XS(xt(M),xt(O),q,Ge,pe,ct);return ct.delete(M),Tn;case k:if(Uh)return Uh.call(M)==Uh.call(O)}return!1}function xA(M,O,G,q,Ge,pe){var ct=G&r,xt=qS(M),kt=xt.length,rt=qS(O),Tn=rt.length;if(kt!=Tn&&!ct)return!1;for(var ts=kt;ts--;){var zt=xt[ts];if(!(ct?zt in O:ys.call(O,zt)))return!1}var Bn=pe.get(M);if(Bn&&pe.get(O))return Bn==O;var zn=!0;pe.set(M,O),pe.set(O,M);for(var Cr=ct;++ts<kt;){zt=xt[ts];var Ks=M[zt],pi=O[zt];if(q)var nw=ct?q(pi,Ks,zt,O,M,pe):q(Ks,pi,zt,M,O,pe);if(!(nw===void 0?Ks===pi||Ge(Ks,pi,G,q,pe):nw)){zn=!1;break}Cr||(Cr=zt=="constructor")}if(zn&&!Cr){var al=M.constructor,cl=O.constructor;al!=cl&&"constructor"in M&&"constructor"in O&&!(typeof al=="function"&&al instanceof al&&typeof cl=="function"&&cl instanceof cl)&&(zn=!1)}return pe.delete(M),pe.delete(O),zn}function qS(M){return fA(M,AA,vA)}function il(M,O){var G=M.__data__;return IA(O)?G[typeof O=="string"?"string":"hash"]:G.map}function Ji(M,O){var G=MM(M,O);return mA(G)?G:void 0}function bA(M){var O=ys.call(M,li),G=M[li];try{M[li]=void 0;var q=!0}catch{}var Ge=zS.call(M);return q&&(O?M[li]=G:delete M[li]),Ge}var vA=GS?function(M){return M==null?[]:(M=Object(M),ut(GS(M),function(O){return KS.call(M,O)}))}:jA,vr=ga;(Fh&&vr(new Fh(new ArrayBuffer(1)))!=L||pa&&vr(new pa)!=m||Nh&&vr(Nh.resolve())!=I||Bh&&vr(new Bh)!=C||zh&&vr(new zh)!=T)&&(vr=function(M){var O=ga(M),G=O==b?M.constructor:void 0,q=G?hi(G):"";if(q)switch(q){case BM:return L;case zM:return m;case UM:return I;case HM:return C;case KM:return T}return O});function CA(M,O){return O=O??o,!!O&&(typeof M=="number"||nt.test(M))&&M>-1&&M%1==0&&M<O}function IA(M){var O=typeof M;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?M!=="__proto__":M===null}function PA(M){return!!BS&&BS in M}function EA(M){var O=M&&M.constructor,G=typeof O=="function"&&O.prototype||tl;return M===G}function _A(M){return zS.call(M)}function hi(M){if(M!=null){try{return NS.call(M)}catch{}try{return M+""}catch{}}return""}function ZS(M,O){return M===O||M!==M&&O!==O}var TA=VS(function(){return arguments}())?VS:function(M){return ma(M)&&ys.call(M,"callee")&&!KS.call(M,"callee")},ol=Array.isArray;function kA(M){return M!=null&&QS(M.length)&&!JS(M)}var Hh=FM||DA;function MA(M,O){return YS(M,O)}function JS(M){if(!ew(M))return!1;var O=ga(M);return O==f||O==y||O==l||O==E}function QS(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=o}function ew(M){var O=typeof M;return M!=null&&(O=="object"||O=="function")}function ma(M){return M!=null&&typeof M=="object"}var tw=cn?xr(cn):yA;function AA(M){return kA(M)?pA(M):SA(M)}function jA(){return[]}function DA(){return!1}n.exports=MA})(ru,ru.exports);var sB=ru.exports;const rB=ur(sB);function iB(n){if(n.length===0)return new Set;const t=n[0],e=n.slice(1),s=new Set;for(const r of t)e.every(i=>i.has(r))&&s.add(r);return s}function oB(n,t){const e={};for(const s of t)n.has(s)||(e.added??(e.added=new Set),e.added.add(s));for(const s of n)t.has(s)||(e.removed??(e.removed=new Set),e.removed.add(s));return e.added||e.removed?e:void 0}function ux(n,t){for(const[e,s]of Object.entries(n)){const r=s,i=t[e];if("eq"in r&&i!==r.eq||"neq"in r&&i===r.neq||"gt"in r&&(typeof i!="number"||i<=r.gt))return!1}return!0}function hx(n,t,e){const s=Object.fromEntries(Object.keys(e).map(r=>[r,new Set]));for(const[r,i]of Object.entries(e))if("eq"in i){const a=n.index(t,r).get().get(i.eq);if(a)for(const c of a)s[r].add(c)}else if("neq"in i){const o=n.index(t,r);for(const[a,c]of o.get())if(a!==i.neq)for(const l of c)s[r].add(l)}else if("gt"in i){const o=n.index(t,r);for(const[a,c]of o.get())if(a>i.gt)for(const l of c)s[r].add(l)}return iB(Object.values(s))}class aB{constructor(t,e){g(this,"indexCache",new Map);g(this,"historyCache",new Map);this.atoms=t,this.history=e}filterHistory(t){if(this.historyCache.has(t))return this.historyCache.get(t);const e=K("filterHistory:"+t,(s,r)=>{if(Ci(s))return this.history.get();const i=this.history.getDiffSince(r);if(i===jn)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const d of i){for(const h of lt(d.added))if(h.typeName===t)if(o.removed[h.id]){const p=o.removed[h.id];delete o.removed[h.id],c--,p!==h&&(o.updated[h.id]=[p,h],l++)}else o.added[h.id]=h,a++;for(const[h,p]of lt(d.updated))p.typeName===t&&(o.added[p.id]?o.added[p.id]=p:o.updated[p.id]?o.updated[p.id]=[o.updated[p.id][0],p]:(o.updated[p.id]=[h,p],l++));for(const h of lt(d.removed))h.typeName===t&&(o.added[h.id]?(delete o.added[h.id],a--):o.updated[h.id]?(o.removed[h.id]=o.updated[h.id][0],delete o.updated[h.id],l--,c++):(o.removed[h.id]=h,c++))}return a||c||l?Fa(this.history.get(),o):s},{historyLength:100});return this.historyCache.set(t,e),e}index(t,e){const s=t+":"+e;if(this.indexCache.has(s))return this.indexCache.get(s);const r=this.__uncached_createIndex(t,e);return this.indexCache.set(s,r),r}__uncached_createIndex(t,e){const s=this.filterHistory(t),r=()=>{s.get();const i=new Map;for(const o of lt(this.atoms.get())){const a=o.get();if(a.typeName===t){const c=a[e];i.has(c)||i.set(c,new Set),i.get(c).add(a.id)}}return i};return K("index:"+t+":"+e,(i,o)=>{if(Ci(i))return r();const a=s.getDiffSince(o);if(a===jn)return r();const c=new Map,l=(f,y)=>{let m=c.get(f);m||(m=new td(i.get(f)??new Set)),m.add(y),c.set(f,m)},d=(f,y)=>{let m=c.get(f);m||(m=new td(i.get(f)??new Set)),m.remove(y),c.set(f,m)};for(const f of a){for(const y of lt(f.added))if(y.typeName===t){const m=y[e];l(m,y.id)}for(const[y,m]of lt(f.updated))if(m.typeName===t){const x=y[e],w=m[e];x!==w&&(d(x,m.id),l(w,m.id))}for(const y of lt(f.removed))if(y.typeName===t){const m=y[e];d(m,y.id)}}let h,p;for(const[f,y]of c){const m=y.get();m&&(h||(h=new Map(i)),p||(p=new Map),m.value.size===0?h.delete(f):h.set(f,m.value),p.set(f,m.diff))}return h&&p?Fa(h,p):i},{historyLength:100})}record(t,e=()=>({}),s="record:"+t+(e?":"+e.toString():"")){const r=this.ids(t,e,s);return K(s,()=>{var i;for(const o of r.get())return(i=this.atoms.get()[o])==null?void 0:i.get()})}records(t,e=()=>({}),s="records:"+t+(e?":"+e.toString():"")){const r=this.ids(t,e,"ids:"+s);return K(s,()=>[...r.get()].map(i=>{const o=this.atoms.get()[i];if(!o)throw new Error("no atom found for record id: "+i);return o.get()}))}ids(t,e=()=>({}),s="ids:"+t+(e?":"+e.toString():"")){const r=this.filterHistory(t),i=()=>{r.get();const c=e();return Object.keys(c).length===0?new Set(lt(this.atoms.get()).flatMap(l=>{const d=l.get();return d.typeName===t?d.id:[]})):hx(this,t,c)},o=c=>{const l=i(),d=oB(c,l);return d?Fa(l,d):c},a=K("ids_query:"+s,e,{isEqual:rB});return K("query:"+s,(c,l)=>{const d=a.get();if(Ci(c))return i();if(l<a.lastChangedEpoch)return o(c);const h=r.getDiffSince(l);if(h===jn)return o(c);const p=new td(c);for(const y of h){for(const m of lt(y.added))m.typeName===t&&ux(d,m)&&p.add(m.id);for(const[m,x]of lt(y.updated))x.typeName===t&&(ux(d,x)?p.add(x.id):p.remove(x.id));for(const m of lt(y.removed))m.typeName===t&&p.remove(m.id)}const f=p.get();return f?Fa(f.value,f.diff):c},{historyLength:50})}exec(t,e){const s=hx(this,t,e);if(s.size===0)return tr;const r=this.atoms.get();return[...s].map(i=>r[i].get())}}class cB{constructor(t){g(this,"_beforeCreateHandlers",{});g(this,"_afterCreateHandlers",{});g(this,"_beforeChangeHandlers",{});g(this,"_afterChangeHandlers",{});g(this,"_beforeDeleteHandlers",{});g(this,"_afterDeleteHandlers",{});g(this,"_operationCompleteHandlers",[]);g(this,"_isEnabled",!0);this.store=t}isEnabled(){return this._isEnabled}setIsEnabled(t){this._isEnabled=t}handleBeforeCreate(t,e){if(!this._isEnabled)return t;const s=this._beforeCreateHandlers[t.typeName];if(s){let r=t;for(const i of s)r=i(r,e);return r}return t}handleAfterCreate(t,e){if(!this._isEnabled)return;const s=this._afterCreateHandlers[t.typeName];if(s)for(const r of s)r(t,e)}handleBeforeChange(t,e,s){if(!this._isEnabled)return e;const r=this._beforeChangeHandlers[e.typeName];if(r){let i=e;for(const o of r)i=o(t,i,s);return i}return e}handleAfterChange(t,e,s){if(!this._isEnabled)return;const r=this._afterChangeHandlers[e.typeName];if(r)for(const i of r)i(t,e,s)}handleBeforeDelete(t,e){if(!this._isEnabled)return!0;const s=this._beforeDeleteHandlers[t.typeName];if(s){for(const r of s)if(r(t,e)===!1)return!1}return!0}handleAfterDelete(t,e){if(!this._isEnabled)return;const s=this._afterDeleteHandlers[t.typeName];if(s)for(const r of s)r(t,e)}handleOperationComplete(t){if(this._isEnabled)for(const e of this._operationCompleteHandlers)e(t)}register(t){const e=[];for(const[s,r]of Object.entries(t))r!=null&&r.beforeCreate&&e.push(this.registerBeforeCreateHandler(s,r.beforeCreate)),r!=null&&r.afterCreate&&e.push(this.registerAfterCreateHandler(s,r.afterCreate)),r!=null&&r.beforeChange&&e.push(this.registerBeforeChangeHandler(s,r.beforeChange)),r!=null&&r.afterChange&&e.push(this.registerAfterChangeHandler(s,r.afterChange)),r!=null&&r.beforeDelete&&e.push(this.registerBeforeDeleteHandler(s,r.beforeDelete)),r!=null&&r.afterDelete&&e.push(this.registerAfterDeleteHandler(s,r.afterDelete));return()=>{for(const s of e)s()}}registerBeforeCreateHandler(t,e){return this._beforeCreateHandlers[t]||(this._beforeCreateHandlers[t]=[]),this._beforeCreateHandlers[t].push(e),()=>fi(this._beforeCreateHandlers[t],e)}registerAfterCreateHandler(t,e){return this._afterCreateHandlers[t]||(this._afterCreateHandlers[t]=[]),this._afterCreateHandlers[t].push(e),()=>fi(this._afterCreateHandlers[t],e)}registerBeforeChangeHandler(t,e){return this._beforeChangeHandlers[t]||(this._beforeChangeHandlers[t]=[]),this._beforeChangeHandlers[t].push(e),()=>fi(this._beforeChangeHandlers[t],e)}registerAfterChangeHandler(t,e){return this._afterChangeHandlers[t]||(this._afterChangeHandlers[t]=[]),this._afterChangeHandlers[t].push(e),()=>fi(this._afterChangeHandlers[t],e)}registerBeforeDeleteHandler(t,e){return this._beforeDeleteHandlers[t]||(this._beforeDeleteHandlers[t]=[]),this._beforeDeleteHandlers[t].push(e),()=>fi(this._beforeDeleteHandlers[t],e)}registerAfterDeleteHandler(t,e){return this._afterDeleteHandlers[t]||(this._afterDeleteHandlers[t]=[]),this._afterDeleteHandlers[t].push(e),()=>fi(this._afterDeleteHandlers[t],e)}registerOperationCompleteHandler(t){return this._operationCompleteHandlers.push(t),()=>fi(this._operationCompleteHandlers,t)}}function fi(n,t){const e=n.indexOf(t);e>=0&&n.splice(e,1)}class Bm{constructor(t){g(this,"id");g(this,"atoms",Ct("store_atoms",{}));g(this,"history",Ct("history",0,{historyLength:1e3}));g(this,"query",new aB(this.atoms,this.history));g(this,"listeners",new Set);g(this,"historyAccumulator",new dB);g(this,"historyReactor");g(this,"cancelHistoryReactor",()=>{});g(this,"schema");g(this,"props");g(this,"scopedTypes");g(this,"sideEffects",new cB(this));g(this,"put",(t,e)=>{this.atomic(()=>{const s={},r={},i=this.atoms.__unsafe__getWithoutCapture();let o=null,a,c=!1;const l=this.isMergingRemoteChanges?"remote":"user";for(let d=0,h=t.length;d<h;d++){a=t[d];const p=(o??i)[a.id];if(p){const f=p.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(f,a,l),this.schema.validateRecord(this,a,e??"updateRecord",f)===f)continue;p.set(a),c=!0;const m=p.__unsafe__getWithoutCapture();s[a.id]=[f,m],this.addDiffForAfterEvent(f,m)}else a=this.sideEffects.handleBeforeCreate(a,l),c=!0,a=this.schema.validateRecord(this,a,e??"createRecord",null),r[a.id]=a,this.addDiffForAfterEvent(null,a),o||(o={...i}),o[a.id]=Ct("atom:"+a.id,a)}o&&this.atoms.set(o),c&&this.updateHistory({added:r,updated:s,removed:{}})})});g(this,"remove",t=>{this.atomic(()=>{const e=new Set,s=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const i of t){const o=this.atoms.__unsafe__getWithoutCapture()[i];o&&this.sideEffects.handleBeforeDelete(o.get(),s)===!1&&e.add(i)}let r;this.atoms.update(i=>{let o;for(const a of t){if(e.has(a)||!(a in i))continue;o||(o={...i}),r||(r={}),delete o[a];const c=i[a].get();r[a]=c,this.addDiffForAfterEvent(c,null)}return o??i}),r&&this.updateHistory({added:{},updated:{},removed:r})})});g(this,"get",t=>{var e;return(e=this.atoms.get()[t])==null?void 0:e.get()});g(this,"unsafeGetWithoutCapture",t=>{var e;return(e=this.atoms.get()[t])==null?void 0:e.__unsafe__getWithoutCapture()});g(this,"serialize",(t="document")=>{const e={};for(const[s,r]of wn(this.atoms.get())){const i=r.get();(t==="all"||this.scopedTypes[t].has(i.typeName))&&(e[s]=i)}return e});g(this,"allRecords",()=>lt(this.atoms.get()).map(t=>t.get()));g(this,"clear",()=>{this.remove(sx(this.atoms.get()))});g(this,"update",(t,e)=>{const s=this.atoms.get()[t];if(!s){console.error(`Record ${t} not found. This is probably an error`);return}this.put([e(s.__unsafe__getWithoutCapture())])});g(this,"has",t=>!!this.atoms.get()[t]);g(this,"listen",(t,e)=>{this._flushHistory();const s={onHistory:t,filters:{source:(e==null?void 0:e.source)??"all",scope:(e==null?void 0:e.scope)??"all"}};return this.listeners.add(s),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(s),this.listeners.size===0&&this.historyReactor.stop()}});g(this,"isMergingRemoteChanges",!1);g(this,"mergeRemoteChanges",t=>{if(this.isMergingRemoteChanges)return t();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,$r(t)}finally{this.isMergingRemoteChanges=!1}});g(this,"createComputedCache",(t,e,s)=>{const r=new or;return{get:i=>{const o=this.atoms.get()[i];if(o)return r.get(o,()=>{const a=s?K(o.name+":equals",()=>o.get(),{isEqual:s}):o;return K(t+":"+i,()=>e(a.get()))}).get()}}});g(this,"createSelectedComputedCache",(t,e,s)=>{const r=new or;return{get:i=>{const o=this.atoms.get()[i];if(o)return r.get(o,()=>{const a=K(t+":"+i+":selector",()=>e(o.get()));return K(t+":"+i,()=>s(a.get()))}).get()}}});g(this,"_integrityChecker");g(this,"_isPossiblyCorrupted",!1);g(this,"pendingAfterEvents",null);g(this,"_isInAtomicOp",!1);const{initialData:e,schema:s,id:r}=t;this.id=r??Ac(),this.schema=s,this.props=t.props,e&&this.atoms.set(dC(wn(e).map(([i,o])=>[i,Ct("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=NN("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>this.cancelHistoryReactor=wC(i)}),this.scopedTypes={document:new Set(lt(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(lt(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(lt(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const t=this.historyAccumulator.flush();for(const{changes:e,source:s}of t){let r=null,i=null,o=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==s))if(c.scope!=="all")if(c.scope==="document"){if(i??(i=this.filterChangesByScope(e,"document")),!i)continue;a({changes:i,source:s})}else if(c.scope==="session"){if(r??(r=this.filterChangesByScope(e,"session")),!r)continue;a({changes:r,source:s})}else{if(o??(o=this.filterChangesByScope(e,"presence")),!o)continue;a({changes:o,source:s})}else a({changes:e,source:s})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(t,e){const s={added:Ha(t.added,(r,i)=>this.scopedTypes[e].has(i.typeName)),updated:Ha(t.updated,(r,i)=>this.scopedTypes[e].has(i[1].typeName)),removed:Ha(t.removed,(r,i)=>this.scopedTypes[e].has(i.typeName))};return Object.keys(s.added).length===0&&Object.keys(s.updated).length===0&&Object.keys(s.removed).length===0?null:s}updateHistory(t){this.historyAccumulator.add({changes:t,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,t)}validate(t){this.allRecords().forEach(e=>this.schema.validateRecord(this,e,t,null))}getStoreSnapshot(t="document"){return{store:this.serialize(t),schema:this.schema.serialize()}}getSnapshot(t="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(t)}migrateSnapshot(t){const e=this.schema.migrateStoreSnapshot(t);if(e.type==="error")throw new Error(`Failed to migrate snapshot: ${e.reason}`);return{store:e.value,schema:this.schema.serialize()}}loadStoreSnapshot(t){const e=this.schema.migrateStoreSnapshot(t);if(e.type==="error")throw new Error(`Failed to migrate snapshot: ${e.reason}`);const s=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(e.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(s)}}loadSnapshot(t){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(t)}extractingChanges(t){const e=[],s=this.historyAccumulator.addInterceptor(r=>e.push(r.changes));try{return $r(t),Lm(e)}finally{s()}}applyDiff(t,{runCallbacks:e=!0,ignoreEphemeralKeys:s=!1}={}){this.atomic(()=>{const r=lt(t.added);for(const[o,a]of lt(t.updated)){const c=this.schema.getType(a.typeName);if(s&&c.ephemeralKeySet.size){const l=this.get(a.id);if(!l){r.push(a);continue}let d=null;for(const[h,p]of Object.entries(a))c.ephemeralKeySet.has(h)||Object.is(p,mn(l,h))||(d||(d={...l}),d[h]=p);d&&r.push(d)}else r.push(a)}const i=sx(t.removed);r.length&&this.put(r),i.length&&this.remove(i)},e)}ensureStoreIsUsable(){this.atomic(()=>{var t;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(t=this._integrityChecker)==null||t.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(t,e){if(et(this.pendingAfterEvents,"must be in event operation"),t===e||(t&&e&&et(t.id===e.id),!t&&!e))return;const s=(t||e).id,r=this.pendingAfterEvents.get(s);r?r.after=e:this.pendingAfterEvents.set(s,{before:t,after:e})}flushAtomicCallbacks(){let t=0;const e=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const s=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(t++,t>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:r,after:i}of s.values())r&&i?this.sideEffects.handleAfterChange(r,i,e):r&&!i?this.sideEffects.handleAfterDelete(r,e):!r&&i&&this.sideEffects.handleAfterCreate(i,e);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(e)}}}atomic(t,e=!0){return $r(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),t();this.pendingAfterEvents=new Map;const s=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(e??s),this._isInAtomicOp=!0;try{const r=t();return this.flushAtomicCallbacks(),r}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(s),this._isInAtomicOp=!1}})}addHistoryInterceptor(t){return this.historyAccumulator.addInterceptor(e=>t(e,this.isMergingRemoteChanges?"remote":"user"))}}function lB(n){if(n.length===0)return[];const t=[];let e=[n[0]],s;for(let r=1,i=n.length;r<i;r++)s=n[r],e[0].source!==s.source&&(t.push(e),e=[]),e.push(s);return t.push(e),t.map(r=>({source:r[0].source,changes:Lm(r.map(i=>i.changes))}))}class dB{constructor(){g(this,"_history",[]);g(this,"_interceptors",new Set)}addInterceptor(t){return this._interceptors.add(t),()=>{this._interceptors.delete(t)}}add(t){this._history.push(t);for(const e of this._interceptors)e(t)}flush(){const t=lB(this._history);return this._history=[],t}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function uB(n,t,e){const s=new or;return{get(r,i){return s.get(r,()=>(r instanceof Bm?r:r.store).createComputedCache(n,c=>t(r,c),e)).get(i)}}}function hB(n){const t=[];for(let e=n.length-1;e>=0;e--){const s=n[e];if("id"in s)t.unshift(s);else{const r=s.dependsOn,i=t[0];i&&(t[0]={...i,dependsOn:r.concat(i.dependsOn??[])})}}return t}function _o({sequence:n,sequenceId:t,retroactive:e=!0}){const s={sequenceId:t,retroactive:e,sequence:hB(n)};return MC(s),s}function In(n,t){return Object.fromEntries(wn(t).map(([e,s])=>[e,`${n}/${s}`]))}function Fn(n){const t=n.sequenceId;return _o({sequenceId:t,retroactive:n.retroactive??!0,sequence:n.sequence.map(e=>"id"in e?{...e,scope:"record",filter:s=>{var r,i;return s.typeName===n.recordType&&(((r=e.filter)==null?void 0:r.call(e,s))??!0)&&(((i=n.filter)==null?void 0:i.call(n,s))??!0)}}:e)})}function pB(n){const t=new Map(n.map(i=>[i.id,i])),e=new Set,s=[];function r(i){et(!e.has(i.id),`Circular dependency in migrations: ${i.id}`),e.add(i.id);const{version:o,sequenceId:a}=iu(i.id),c=t.get(`${a}/${o-1}`);if(c&&r(c),i.dependsOn)for(const l of i.dependsOn){const d=t.get(l);d&&r(d)}t.delete(i.id),s.push(i)}for(const i of t.values())r(i);return s}function iu(n){const[t,e]=n.split("/");return{sequenceId:t,version:parseInt(e)}}function px(n,t){t&&et(n.startsWith(t+"/"),`Every migration in sequence '${t}' must have an id starting with '${t}/'. Got invalid id: '${n}'`),et(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function MC(n){if(et(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),et(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;px(n.sequence[0].id,n.sequenceId);let t=iu(n.sequence[0].id).version;et(t===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let e=1;e<n.sequence.length;e++){const s=n.sequence[e].id;px(s,n.sequenceId);const r=iu(s).version;et(r===t+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${t+1} but got '${n.sequence[e].id}'`),t=r}}var Er=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Er||{});function fB(n){if(n.schemaVersion>2||n.schemaVersion<1)return Lr.err("Bad schema version");if(n.schemaVersion===2)return Lr.ok(n);const t={schemaVersion:2,sequences:{}};for(const[e,s]of Object.entries(n.recordVersions))if(t.sequences[`com.tldraw.${e}`]=s.version,"subTypeKey"in s)for(const[r,i]of Object.entries(s.subTypeVersions))t.sequences[`com.tldraw.${e}.${r}`]=i;return Lr.ok(t)}class zm{constructor(t,e){g(this,"migrations",{});g(this,"sortedMigrations");var r;this.types=t,this.options=e;for(const i of e.migrations??[])et(!this.migrations[i.sequenceId],`Duplicate migration sequenceId ${i.sequenceId}`),MC(i),this.migrations[i.sequenceId]=i;const s=Object.values(this.migrations).flatMap(i=>i.sequence);this.sortedMigrations=pB(s);for(const i of this.sortedMigrations)if((r=i.dependsOn)!=null&&r.length)for(const o of i.dependsOn){const a=s.find(c=>c.id===o);et(a,`Migration '${i.id}' depends on missing migration '${o}'`)}}static create(t,e){return new zm(t,e??{})}validateRecord(t,e,s,r){try{const i=mn(this.types,e.typeName);if(!i)throw new Error(`Missing definition for record type ${e.typeName}`);return i.validate(e,r??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:t,record:e,phase:s,recordBefore:r,error:i});throw i}}getMigrationsSince(t){const e=fB(t);if(!e.ok)return e;const s=e.value,r=new Set(Object.keys(s.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)s.sequences[o]===void 0&&this.migrations[o].retroactive&&r.add(o);if(r.size===0)return Lr.ok([]);const i=new Set;for(const o of r){const a=s.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const d of this.migrations[o].sequence)i.add(d.id);continue}const c=`${o}/${a}`,l=this.migrations[o].sequence.findIndex(d=>d.id===c);if(l===-1)return Lr.err("Incompatible schema?");for(const d of this.migrations[o].sequence.slice(l+1))i.add(d.id)}return Lr.ok(this.sortedMigrations.filter(({id:o})=>i.has(o)))}migratePersistedRecord(t,e,s="up"){const r=this.getMigrationsSince(e);if(!r.ok)return console.error("Error migrating record",r.error),{type:"error",reason:Er.MigrationError};let i=r.value;if(i.length===0)return{type:"success",value:t};if(i.some(o=>o.scope==="store"))return{type:"error",reason:s==="down"?Er.TargetVersionTooOld:Er.TargetVersionTooNew};if(s==="down"){if(!i.every(o=>o.down))return{type:"error",reason:Er.TargetVersionTooOld};i=i.slice().reverse()}t=Je(t);try{for(const o of i){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(t):!0))continue;const c=o[s](t);c&&(t=Je(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Er.MigrationError}}return{type:"success",value:t}}migrateStoreSnapshot(t){let{store:e}=t;const s=this.getMigrationsSince(t.schema);if(!s.ok)return console.error("Error migrating store",s.error),{type:"error",reason:Er.MigrationError};const r=s.value;if(r.length===0)return{type:"success",value:e};e=Je(e);try{for(const i of r)if(i.scope==="record")for(const[o,a]of Object.entries(e)){if(!(i.filter?i.filter(a):!0))continue;const l=i.up(a);l&&(e[o]=Je(l))}else if(i.scope==="store"){const o=i.up(e);o&&(e=Je(o))}else Zt(i)}catch(i){return console.error("Error migrating store",i),{type:"error",reason:Er.MigrationError}}return{type:"success",value:e}}createIntegrityChecker(t){var e,s;return((s=(e=this.options).createIntegrityChecker)==null?void 0:s.call(e,t))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:t,sequence:e})=>[t,e.length?iu(e.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:t})=>[t,0]))}}getType(t){const e=mn(this.types,t);return et(e,"record type does not exists"),e}}function gB(n){if(!n.length)return null;let t="";for(const e of n)typeof e=="number"?t+=`.${e}`:e.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${e.slice(1)}`:t+=e:t+=`.${e}`;return t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),t.startsWith(".")?t.slice(1):t}class Ce extends Error{constructor(e,s=[]){const r=gB(s),i=e.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(s?`At ${r}: ${i}`:i);g(this,"name","ValidationError");this.rawMessage=e,this.path=s}}function xn(n,t){try{return t()}catch(e){throw e instanceof Ce?new Ce(e.rawMessage,[n,...e.path]):new Ce(e.toString(),[n])}}function Hr(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const t=typeof n;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:Zt(t)}}class on{constructor(t,e){this.validationFn=t,this.validateUsingKnownGoodVersionFn=e}validate(t){return this.validationFn(t)}validateUsingKnownGoodVersion(t,e){return Object.is(t,e)?t:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(t,e):this.validate(e)}isValid(t){try{return this.validate(t),!0}catch{return!1}}nullable(){return bB(this)}optional(){return jC(this)}refine(t){return new on(e=>t(this.validate(e)),(e,s)=>{const r=this.validateUsingKnownGoodVersion(e,s);return Object.is(e,r)?e:t(r)})}check(t,e){return typeof t=="string"?this.refine(s=>(xn(`(check ${t})`,()=>e(s)),s)):this.refine(s=>(t(s),s))}}class mB extends on{constructor(t){super(e=>{const s=fx.validate(e);for(let r=0;r<s.length;r++)xn(r,()=>t.validate(s[r]));return s},(e,s)=>{if(!t.validateUsingKnownGoodVersion)return this.validate(s);const r=fx.validate(s);let i=e.length!==r.length;for(let o=0;o<r.length;o++){const a=r[o];if(o>=e.length){i=!0,xn(o,()=>t.validate(a));continue}if(Object.is(e[o],a))continue;const c=xn(o,()=>t.validateUsingKnownGoodVersion(e[o],a));Object.is(c,e[o])||(i=!0)}return i?s:e}),this.itemValidator=t}nonEmpty(){return this.check(t=>{if(t.length===0)throw new Ce("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(t=>{if(t.length<=1)throw new Ce("Expected an array with length greater than 1")})}}class ou extends on{constructor(t,e=!1){super(s=>{if(typeof s!="object"||s===null)throw new Ce(`Expected object, got ${Hr(s)}`);for(const[r,i]of Object.entries(t))xn(r,()=>{i.validate(mn(s,r))});if(!e){for(const r of Object.keys(s))if(!Es(t,r))throw new Ce("Unexpected property",[r])}return s},(s,r)=>{if(typeof r!="object"||r===null)throw new Ce(`Expected object, got ${Hr(r)}`);let i=!1;for(const[o,a]of Object.entries(t)){const c=mn(s,o),l=mn(r,o);if(Object.is(c,l))continue;const d=xn(o,()=>{const h=a;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(c,l):h.validate(l)});Object.is(d,c)||(i=!0)}if(!e){for(const o of Object.keys(r))if(!Es(t,o))throw new Ce("Unexpected property",[o])}for(const o of Object.keys(s))if(!Es(r,o)){i=!0;break}return i?r:s}),this.config=t,this.shouldAllowUnknownProperties=e}allowUnknownProperties(){return new ou(this.config,!0)}extend(t){return new ou({...this.config,...t})}}class qu extends on{constructor(t,e,s,r){super(i=>{this.expectObject(i);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(i);return o===void 0?this.unknownValueValidation(i,a):xn(`(${t} = ${a})`,()=>o.validate(i))},(i,o)=>{this.expectObject(o),this.expectObject(i);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,c):mn(i,t)!==mn(o,t)?xn(`(${t} = ${c})`,()=>a.validate(o)):xn(`(${t} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(i,o):a.validate(o))}),this.key=t,this.config=e,this.unknownValueValidation=s,this.useNumberKeys=r}expectObject(t){if(typeof t!="object"||t===null)throw new Ce(`Expected an object, got ${Hr(t)}`,[])}getMatchingSchemaAndVariant(t){const e=mn(t,this.key);if(!this.useNumberKeys&&typeof e!="string")throw new Ce(`Expected a string for key "${this.key}", got ${Hr(e)}`);if(this.useNumberKeys&&!Number.isFinite(Number(e)))throw new Ce(`Expected a number for key "${this.key}", got "${e}"`);return{matchingSchema:Es(this.config,e)?this.config[e]:void 0,variant:e}}validateUnknownVariants(t){return new qu(this.key,this.config,t,this.useNumberKeys)}}class yB extends on{constructor(t,e){super(s=>{if(typeof s!="object"||s===null)throw new Ce(`Expected object, got ${Hr(s)}`);for(const[r,i]of Object.entries(s))xn(r,()=>{t.validate(r),e.validate(i)});return s},(s,r)=>{if(typeof r!="object"||r===null)throw new Ce(`Expected object, got ${Hr(r)}`);let i=!1;for(const[o,a]of Object.entries(r)){if(!Es(s,o)){i=!0,xn(o,()=>{t.validate(o),e.validate(a)});continue}const c=mn(s,o),l=a;if(Object.is(c,l))continue;const d=xn(o,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(c,l):e.validate(l));Object.is(d,c)||(i=!0)}for(const o of Object.keys(s))if(!Es(r,o)){i=!0;break}return i?r:s}),this.keyValidator=t,this.valueValidator=e}}function Um(n){return new on(t=>{if(typeof t!==n)throw new Ce(`Expected ${n}, got ${Hr(t)}`);return t})}const SB=new on(n=>n),he=Um("string"),ae=Um("number").check(n=>{if(Number.isNaN(n))throw new Ce("Expected a number, got NaN");if(!Number.isFinite(n))throw new Ce(`Expected a finite number, got ${n}`)}),au=ae.check(n=>{if(n<0)throw new Ce(`Expected a positive number, got ${n}`)}),mt=ae.check(n=>{if(n<=0)throw new Ce(`Expected a non-zero positive number, got ${n}`)}),AC=ae.check(n=>{if(!Number.isInteger(n))throw new Ce(`Expected an integer, got ${n}`)}),sd=AC.check(n=>{if(n<0)throw new Ce(`Expected a positive integer, got ${n}`)}),wB=AC.check(n=>{if(n<=0)throw new Ce(`Expected a non-zero positive integer, got ${n}`)}),we=Um("boolean");function Jt(n){return new on(t=>{if(t!==n)throw new Ce(`Expected ${n}, got ${JSON.stringify(t)}`);return n})}const fx=new on(n=>{if(!Array.isArray(n))throw new Ce(`Expected an array, got ${Hr(n)}`);return n});function jt(n){return new mB(n)}function ye(n){return new ou(n)}function rg(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===LN)}function ig(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(ig):rg(n)?Object.values(n).every(ig):!1}const Dt=new on(n=>{if(ig(n))return n;throw new Ce(`Expected json serializable value, got ${typeof n}`)},(n,t)=>{if(Array.isArray(n)&&Array.isArray(t)){let e=n.length!==t.length;for(let s=0;s<t.length;s++){if(s>=n.length){e=!0,Dt.validate(t[s]);continue}const r=n[s],i=t[s];if(Object.is(r,i))continue;const o=Dt.validateUsingKnownGoodVersion(r,i);Object.is(o,r)||(e=!0)}return e?t:n}else if(rg(n)&&rg(t)){let e=!1;for(const s of Object.keys(t)){if(!Es(n,s)){e=!0,Dt.validate(t[s]);continue}const r=n[s],i=t[s];if(Object.is(r,i))continue;const o=Dt.validateUsingKnownGoodVersion(r,i);Object.is(o,r)||(e=!0)}for(const s of Object.keys(n))if(!Es(t,s)){e=!0;break}return e?t:n}else return Dt.validate(t)});function cu(n,t){return new yB(n,t)}function Hm(n,t){return new qu(n,t,(e,s)=>{throw new Ce(`Expected one of ${Object.keys(t).map(r=>JSON.stringify(r)).join(" or ")}, got ${JSON.stringify(s)}`,[n])},!1)}function xB(n,t){return new qu(n,t,(e,s)=>{throw new Ce(`Expected one of ${Object.keys(t).map(r=>JSON.stringify(r)).join(" or ")}, got ${JSON.stringify(s)}`,[n])},!0)}function Ns(n,t){return new on(e=>xn(n,()=>t.validate(e)),(e,s)=>xn(n,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(e,s):t.validate(s)))}function Zu(n){return new on(t=>{if(!n.has(t)){const e=Array.from(n,s=>JSON.stringify(s)).join(" or ");throw new Ce(`Expected ${e}, got ${t}`)}return t})}function jC(n){return new on(t=>{if(t!==void 0)return n.validate(t)},(t,e)=>{if(!(t===void 0&&e===void 0)&&e!==void 0)return n.validateUsingKnownGoodVersion&&t!==void 0?n.validateUsingKnownGoodVersion(t,e):n.validate(e)})}function bB(n){return new on(t=>t===null?null:n.validate(t),(t,e)=>e===null?null:n.validateUsingKnownGoodVersion&&t!==null?n.validateUsingKnownGoodVersion(t,e):n.validate(e))}function Ju(...n){return Zu(new Set(n))}function DC(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new Ce(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new Ce(`Expected a valid url, got ${JSON.stringify(n)}`)}}const vB=new Set(["http:","https:","mailto:"]),Ln=he.check(n=>{if(n==="")return;const t=DC(n);if(!vB.has(t.protocol.toLowerCase()))throw new Ce(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),CB=new Set(["http:","https:","data:","asset:"]),ki=he.check(n=>{if(n==="")return;const t=DC(n);if(!CB.has(t.protocol.toLowerCase()))throw new Ce(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),Km=he.refine(n=>{try{return PN(n),n}catch{throw new Ce(`Expected an index key, got ${JSON.stringify(n)}`)}});function Dn(n){return he.refine(t=>{if(!t.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return t})}const Qu=Dn("asset");function Gm(n,t){return ye({id:Qu,typeName:Jt("asset"),type:Jt(n),props:t,meta:Dt})}const Mi=ye({x:ae,y:ae,z:ae.optional()}),Ga=ye({x:ae,y:ae,w:ae,h:ae}),OC=ae.check(n=>{if(n<0||n>1)throw new Ce("Opacity must be between 0 and 1")}),IB=he.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),Kn=Dn("shape");function PB(n,t,e){return ye({id:Kn,typeName:Jt("shape"),x:ae,y:ae,rotation:ae,index:Km,parentId:IB,type:Jt(n),isLocked:we,opacity:OC,props:t?ye(t):Dt,meta:e?ye(e):Dt})}const EB=Dn("binding");function _B(n,t,e){return ye({id:EB,typeName:Jt("binding"),type:Jt(n),fromId:Kn,toId:Kn,props:t?ye(t):Dt,meta:e?ye(e):Dt})}In("com.tldraw.binding",{});Fn({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Ii(n){return`binding:${Ac()}`}function TB(n){return Fs("binding",{scope:"document",validator:Ns("binding",Hm("type",Mc(n,(t,{props:e,meta:s})=>_B(t,e,s))))}).withDefaultProperties(()=>({meta:{}}))}class Nt{constructor(t,e,s){this.id=t,this.defaultValue=e,this.type=s}static define(t,e){const{defaultValue:s,type:r=SB}=e;return new Nt(t,s,r)}static defineEnum(t,e){const{defaultValue:s,values:r}=e;return new kB(t,s,r)}validate(t){return this.type.validate(t)}validateUsingKnownGoodVersion(t,e){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(t,e):this.validate(e)}}class kB extends Nt{constructor(t,e,s){super(t,e,Ju(...s)),this.values=s}}const gl=In("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),MB=Fn({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:gl.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:gl.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const t=n.opacity;delete n.opacity,n.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:gl.AddMeta,up:n=>{n.meta={}}},{id:gl.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function bo(n){return n?n.typeName==="shape":!1}function pn(n){return n?n.startsWith("shape:"):!1}function Oe(n){return`shape:${n??Ac()}`}function RC(n){const t=new Map;for(const[e,s]of Object.entries(n))if(s instanceof Nt){if(t.has(s))throw new Error(`Duplicate style prop ${s.id}. Each style prop can only be used once within a shape.`);t.set(s,e)}return t}function us(n,t){return Mc(t,(e,s)=>`com.tldraw.shape.${n}/${s}`)}function AB(n){return Fs("shape",{scope:"document",validator:Ns("shape",Hm("type",Mc(n,(t,{props:e,meta:s})=>PB(t,e,s))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function gx(n,t){const e=[];for(const[s,{migrations:r}]of Object.entries(t)){const i=`com.tldraw.${n}.${s}`;r?"sequenceId"in r?(et(i===r.sequenceId,`sequenceId mismatch for ${s} ${Yu} migrations. Expected '${i}', got '${r.sequenceId}'`),e.push(r)):"sequence"in r?e.push(_o({sequenceId:i,retroactive:!1,sequence:r.sequence.map(o=>"id"in o?LC(n,s,o):o)})):e.push(_o({sequenceId:i,retroactive:!1,sequence:Object.keys(r.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${i}/${o}`,scope:"record",filter:a=>a.typeName===n&&a.type===s,up:a=>{const c=r.migrators[o].up(a);if(c)return c},down:a=>{const c=r.migrators[o].down(a);if(c)return c}}))})):e.push(_o({sequenceId:i,retroactive:!1,sequence:[]}))}return e}function LC(n,t,e){return{id:e.id,dependsOn:e.dependsOn,scope:"record",filter:s=>s.typeName===n&&s.type===t,up:s=>{const r=e.up(s.props);r&&(s.props=r)},down:typeof e.down=="function"?s=>{const r=e.down(s.props);r&&(s.props=r)}:void 0}}const $C=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],lu={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function fr(n){return n.isDarkMode?lu.darkMode:lu.lightMode}const $n=Nt.defineEnum("tldraw:color",{defaultValue:"black",values:$C}),FC=Nt.defineEnum("tldraw:labelColor",{defaultValue:"black",values:$C}),Ai=Nt.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),ji=Nt.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),As=Nt.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),NC={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},js=Nt.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),BC=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],du=Nt.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:BC}),uu=Nt.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:BC}),zC={labelColor:FC,color:$n,fill:ji,dash:Ai,size:js,arrowheadStart:du,arrowheadEnd:uu,font:As,start:Mi,end:Mi,bend:ae,text:he,labelPosition:ae,scale:mt},ho=us("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function ml(n){return LC("shape","arrow",n)}const UC=_o({sequenceId:"com.tldraw.shape.arrow",sequence:[ml({id:ho.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),ml({id:ho.AddIsPrecise,up:({start:n,end:t})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5))},down:({start:n,end:t})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise)}}),ml({id:ho.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:ho.ExtractBindings,scope:"store",up:n=>{const t=Object.values(n).filter(e=>e.typeName==="shape"&&e.type==="arrow");for(const e of t){const{start:s,end:r}=e.props;if(s.type==="binding"){const i=Ii(),o={typeName:"binding",id:i,type:"arrow",fromId:e.id,toId:s.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};n[i]=o,e.props.start={x:0,y:0}}else delete e.props.start.type;if(r.type==="binding"){const i=Ii(),o={typeName:"binding",id:i,type:"arrow",fromId:e.id,toId:r.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[i]=o,e.props.end={x:0,y:0}}else delete e.props.end.type}}},ml({id:ho.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),HC={terminal:Ju("start","end"),normalizedAnchor:Mi,isExact:we,isPrecise:we},KC={sequence:[{dependsOn:[ho.ExtractBindings]}]},jB=Ns("camera",ye({typeName:Jt("camera"),id:Dn("camera"),x:ae,y:ae,z:ae,meta:Dt})),DB=In("com.tldraw.camera",{AddMeta:1}),OB=Fn({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:DB.AddMeta,up:n=>{n.meta={}}}]}),is=Fs("camera",{validator:jB,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),RB=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),GC=Zu(RB),LB=ye({type:GC,rotation:ae}),$B=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),FB=Zu($B),NB=new Set(["starting","paused","active","stopping"]),WC=ye({id:he,points:jt(Mi),size:au,color:FB,opacity:ae,state:Zu(NB),delay:ae,shrink:ae,taper:we}),sc=Dn("page"),BB=Ns("page",ye({typeName:Jt("page"),id:sc,name:he,index:Km,meta:Dt})),zB=In("com.tldraw.page",{AddMeta:1}),UB=Fn({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:zB.AddMeta,up:n=>{n.meta={}}}]}),ar=Fs("page",{validator:BB,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function un(n){return ar.isId(n)}const HB={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},VC=n=>n?Ha(n,t=>HB[t]):null;Dn("instance");function KB(n){const t={};for(const[s,r]of n)t[s]=jC(r);const e=Ns("instance",ye({typeName:Jt("instance"),id:Dn("instance"),currentPageId:sc,followingUserId:he.nullable(),brush:Ga.nullable(),opacityForNextShape:OC,stylesForNextShape:ye(t),cursor:LB,scribbles:jt(WC),isFocusMode:we,isDebugMode:we,isToolLocked:we,exportBackground:we,screenBounds:Ga,insets:jt(we),zoomBrush:Ga.nullable(),isPenMode:we,isGridMode:we,chatMessage:he,isChatting:we,highlightedUserIds:jt(he),isFocused:we,devicePixelRatio:ae,isCoarsePointer:we,isHoveringCanvas:we.nullable(),openMenus:jt(he),isChangingStyle:we,isReadonly:we,meta:Dt,duplicateProps:ye({shapeIds:jt(Dn("shape")),offset:ye({x:ae,y:ae})}).nullable()}));return Fs("instance",{validator:e,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const We=In("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),GB=Fn({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:We.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:We.RemoveDialog,up:({dialog:n,...t})=>t},{id:We.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:We.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))})},{id:We.AddLabelColor,up:({propsForNextShape:n,...t})=>({...t,propsForNextShape:{...n,labelColor:"black"}})},{id:We.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:We.RemoveAlignJustify,up:n=>{let t=n.propsForNextShape.align;return t==="justify"&&(t="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:t}}}},{id:We.AddZoom,up:n=>({...n,zoomBrush:null})},{id:We.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:We.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:We.RemoveUserId,up:({userId:n,...t})=>t},{id:We.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:We.HoistOpacity,up:({propsForNextShape:{opacity:n,...t},...e})=>({...e,opacityForNextShape:Number(n??"1"),propsForNextShape:t})},{id:We.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:We.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:We.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...t})=>({...t,stylesForNextShape:{}})},{id:We.AddMeta,up:n=>({...n,meta:{}})},{id:We.RemoveCursorColor,up:n=>{const{color:t,...e}=n.cursor;return{...n,cursor:e}}},{id:We.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:We.ReadOnlyReadonly,up:({isReadOnly:n,...t})=>({...t,isReadonly:n})},{id:We.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:We.AddScribbles,up:({scribble:n,...t})=>({...t,scribbles:[]})},{id:We.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...t})=>({...t})},{id:We.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...t})=>({...t})},{id:We.RemoveCanMoveCamera,up:({canMoveCamera:n,...t})=>({...t}),down:n=>({...n,canMoveCamera:!0})}]}),Yt="instance:instance",WB=Ns("instance_page_state",ye({typeName:Jt("instance_page_state"),id:Dn("instance_page_state"),pageId:sc,selectedShapeIds:jt(Kn),hintingShapeIds:jt(Kn),erasingShapeIds:jt(Kn),hoveredShapeId:Kn.nullable(),editingShapeId:Kn.nullable(),croppingShapeId:Kn.nullable(),focusedGroupId:Kn.nullable(),meta:Dt})),ba=In("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),VB=Fn({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:ba.AddCroppingId,up(n){n.croppingShapeId=null}},{id:ba.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:ba.AddMeta,up:n=>{n.meta={}}},{id:ba.RenameProperties,up:n=>{},down:n=>{}},{id:ba.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Xn=Fs("instance_page_state",{validator:WB,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),YB=Ns("pointer",ye({typeName:Jt("pointer"),id:Dn("pointer"),x:ae,y:ae,lastActivityTimestamp:ae,meta:Dt})),XB=In("com.tldraw.pointer",{AddMeta:1}),qB=Fn({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:XB.AddMeta,up:n=>{n.meta={}}}]}),Wm=Fs("pointer",{validator:YB,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),rc=Wm.createId("pointer"),ZB=Ns("instance_presence",ye({typeName:Jt("instance_presence"),id:Dn("instance_presence"),userId:he,userName:he,lastActivityTimestamp:ae,followingUserId:he.nullable(),cursor:ye({x:ae,y:ae,type:GC,rotation:ae}),color:he,camera:ye({x:ae,y:ae,z:ae}),screenBounds:Ga,selectedShapeIds:jt(Dn("shape")),currentPageId:Dn("page"),brush:Ga.nullable(),scribbles:jt(WC),chatMessage:he,meta:Dt})),va=In("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),JB=Fn({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:va.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:va.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:va.AddChatMessage,up:n=>{n.chatMessage=""}},{id:va.AddMeta,up:n=>{n.meta={}}},{id:va.RenameSelectedShapeIds,up:n=>{}}]}),ic=Fs("instance_presence",{validator:ZB,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),QB=(n,t)=>e=>K("instancePresence",()=>{const s=e.get(Yt),r=e.get(Xn.createId(s==null?void 0:s.currentPageId)),i=e.get(is.createId(s==null?void 0:s.currentPageId)),o=e.get(rc),a=n.get();return!r||!s||!i||!o||!a?null:ic.create({id:t??ic.createId(e.id),selectedShapeIds:r.selectedShapeIds,brush:s.brush,scribbles:s.scribbles,userId:a.id,userName:a.name,followingUserId:s.followingUserId,camera:{x:i.x,y:i.y,z:i.z},color:a.color,currentPageId:s.currentPageId,cursor:{x:o.x,y:o.y,rotation:s.cursor.rotation,type:s.cursor.type},lastActivityTimestamp:o.lastActivityTimestamp,screenBounds:s.screenBounds,chatMessage:s.chatMessage,meta:{}})}),ez=Ns("document",ye({typeName:Jt("document"),id:Jt("document:document"),gridSize:ae,name:he,meta:Dt})),mx=In("com.tldraw.document",{AddName:1,AddMeta:2}),tz=Fn({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:mx.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:mx.AddMeta,up:n=>{n.meta={}}}]}),Vm=Fs("document",{validator:ez,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),og=Vm.createId("document");function nz(n,t){return n.index<t.index?-1:n.index>t.index?1:0}function yx(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const sz=({error:n,phase:t,record:e,recordBefore:s})=>{throw Am(n,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:t==="initialize"},extras:{recordBefore:s?yx(Je(s)):void 0,recordAfter:yx(Je(e))}}),n};function rz(){return[ar.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function iz(n){const t=n.query.ids("page"),e=()=>{if(!n.has(og))return n.put([Vm.create({id:og,name:n.props.defaultName})]),e();if(!n.has(rc))return n.put([Wm.create({id:rc})]),e();const s=t.get();if(s.size===0)return n.put(rz()),e();const r=()=>[...s].map(c=>n.get(c)).sort(nz)[0].id,i=n.get(Yt);if(i){if(!s.has(i.currentPageId))return n.put([{...i,currentPageId:r()}]),e()}else return n.put([n.schema.types.instance.create({id:Yt,currentPageId:r(),exportBackground:!0})]),e();const o=new Set,a=new Set;for(const c of s){const l=Xn.createId(c);n.has(l)||o.add(l);const d=is.createId(c);n.has(d)||a.add(d)}o.size>0&&n.put([...o].map(c=>Xn.create({id:c,pageId:Xn.parseId(c)}))),a.size>0&&n.put([...a].map(c=>is.create({id:c})))};return e}const oz=Gm("bookmark",ye({title:he,description:he,image:he,favicon:he,src:ki.nullable()})),Sx=In("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),az=Fn({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:Sx.MakeUrlsValid,up:n=>{ki.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Sx.AddFavicon,up:n=>{ki.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),cz=Gm("image",ye({w:ae,h:ae,fileSize:ae,name:he,isAnimated:we,mimeType:he.nullable(),src:ki.nullable()})),yl=In("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4}),lz=Fn({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:yl.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:yl.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:yl.MakeUrlsValid,up:n=>{ki.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:yl.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}}]}),dz=Gm("video",ye({w:ae,h:ae,fileSize:ae,name:he,isAnimated:we,mimeType:he.nullable(),src:ki.nullable()})),Sl=In("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4}),uz=Fn({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:Sl.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Sl.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Sl.MakeUrlsValid,up:n=>{ki.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Sl.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}}]}),hz=Ns("asset",Hm("type",{image:cz,video:dz,bookmark:oz})),pz=In("com.tldraw.asset",{AddMeta:1}),fz=Fn({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:pz.AddMeta,up:n=>{n.meta={}}}]}),yi=Fs("asset",{validator:hz,scope:"document"}).withDefaultProperties(()=>({meta:{}})),YC={w:mt,h:mt,assetId:Qu.nullable(),url:Ln},wx=us("bookmark",{NullAssetId:1,MakeUrlsValid:2}),XC={sequence:[{id:wx.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:wx.MakeUrlsValid,up:n=>{Ln.isValid(n.url)||(n.url="")},down:n=>{}}]},qC=ye({type:Ju("free","straight"),points:jt(Mi)}),ZC={color:$n,fill:ji,dash:Ai,size:js,segments:jt(qC),isComplete:we,isClosed:we,isPen:we,scale:mt},xx=us("draw",{AddInPen:1,AddScale:2}),JC={sequence:[{id:xx.AddInPen,up:n=>{const{points:t}=n.segments[0];if(t.length===0){n.isPen=!1;return}let e=!(t[0].z===0||t[0].z===.5);t[1]&&(e=e&&!(t[1].z===0||t[1].z===.5)),n.isPen=e},down:"retired"},{id:xx.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]};var gz={};const bx=/(^\/r\/[^/]+\/?$)/,Me=n=>{try{return new URL(n)}catch{return}},jc=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(bx))return n},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(bx))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/embed\/?$/)){const e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const t=n.match(/@(.*),(.*),(.*)z/);let e;if(t){const[,s,r,i]=t;e=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${gz.NEXT_PUBLIC_GC_API_KEY}&center=${s},${r}&zoom=${i}`}else e="";return e}},fromEmbedUrl:n=>{const t=Me(n);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const s=t.searchParams.get("zoom"),[r,i]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${i},${s}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const t=Me(n),e=t&&t.pathname.match(/\/v\/(.+)\/?/);if(e)return`https://www.val.town/embed/${e[1]}`},fromEmbedUrl:n=>{const t=Me(n),e=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(e)return`https://www.val.town/v/${e[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const t=Me(n),e=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(e)return`https://codesandbox.io/embed/${e[1]}`},fromEmbedUrl:n=>{const t=Me(n),e=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(e)return`https://codesandbox.io/s/${e[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const t=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,e=n.match(t);if(e){const[s,r,i]=e;return`https://codepen.io/${r}/embed/${i}`}},fromEmbedUrl:n=>{const t=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,e=n.match(t);if(e){const[s,r,i]=e;return`https://codepen.io/${r}/pen/${i}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const t=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,e=n.match(t);if(e){const[s,r]=e;return`https://scratch.mit.edu/projects/embed/${r}`}},fromEmbedUrl:n=>{const t=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,e=n.match(t);if(e){const[s,r]=e;return`https://scratch.mit.edu/projects/${r}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const t=Me(n);if(!t)return;const e=t.hostname.replace(/^www./,"");if(e==="youtu.be")return`https://www.youtube.com/embed/${t.pathname.split("/").filter(Boolean)[0]}`;if((e==="youtube.com"||e==="m.youtube.com")&&t.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${t.searchParams.get("v")}`},fromEmbedUrl:n=>{const t=Me(n);if(!t)return;if(t.hostname.replace(/^www./,"")==="youtube.com"){const s=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(s)return`https://www.youtube.com/watch?v=${s[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const t=Me(n),e=t==null?void 0:t.searchParams.get("cid");if(t!=null&&t.pathname.match(/\/calendar\/u\/0/)&&e){t.pathname="/calendar/embed";const s=Array.from(t.searchParams.keys());for(const r of s)t.searchParams.delete(r);return t.searchParams.set("src",e),t.href}},fromEmbedUrl:n=>{const t=Me(n),e=t==null?void 0:t.searchParams.get("src");if(t!=null&&t.pathname.match(/\/calendar\/embed/)&&e){t.pathname="/calendar/u/0";const s=Array.from(t.searchParams.keys());for(const r of s)t.searchParams.delete(r);return t.searchParams.set("cid",e),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const t=Me(n);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/pub\/?$/))){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const e=Array.from(t.searchParams.keys());for(const s of e)t.searchParams.delete(s);return t.href}},fromEmbedUrl:n=>{const t=Me(n);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/embed\/?$/))){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const e=Array.from(t.searchParams.keys());for(const s of e)t.searchParams.delete(s);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.hostname==="vimeo.com"&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.hostname==="player.vimeo.com"){const e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","")}#cell-*`;if(t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const t=Me(n);if(t&&t.hostname==="www.desmos.com"&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&t.search===""&&t.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const t=Me(n);if(t&&t.hostname==="www.desmos.com"&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&t.search==="?embed"&&t.hash==="")return n.replace("?embed","")}}],mz={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},QC={w:mt,h:mt,url:he},wl=us("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),eI={sequence:[{id:wl.GenOriginalUrlInEmbed,up:n=>{try{const t=n.url,e=new URL(t).host.replace("www.","");let s;for(const r of jc)if(r.hostnames.includes(e))try{s=r.fromEmbedUrl(t)}catch(i){console.warn(i)}n.tmpOldUrl=n.url,n.url=s??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:wl.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:wl.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:wl.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},tI={w:mt,h:mt,name:he},nI={sequence:[]},hu=Nt.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),pu=Nt.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),os=Nt.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),sI={geo:os,labelColor:FC,color:$n,fill:ji,dash:Ai,size:js,font:As,align:hu,verticalAlign:pu,url:Ln,w:mt,h:mt,growY:au,text:he,scale:mt},Gs=us("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),rI={sequence:[{id:Gs.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Gs.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:Gs.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Gs.AddCheckBox,up:n=>{},down:"retired"},{id:Gs.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Gs.MigrateLegacyAlign,up:n=>{let t;switch(n.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}n.align=t},down:"retired"},{id:Gs.AddCloud,up:n=>{},down:"retired"},{id:Gs.MakeUrlsValid,up:n=>{Ln.isValid(n.url)||(n.url="")},down:n=>{}},{id:Gs.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},iI={},oI={sequence:[]},aI={color:$n,size:js,segments:jt(qC),isComplete:we,isPen:we,scale:mt},yz=us("highlight",{AddScale:1}),cI={sequence:[{id:yz.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},Sz=ye({topLeft:Mi,bottomRight:Mi}),lI={w:mt,h:mt,playing:we,url:Ln,assetId:Qu.nullable(),crop:Sz.nullable()},Sp=us("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3}),dI={sequence:[{id:Sp.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Sp.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:Sp.MakeUrlsValid,up:n=>{Ln.isValid(n.url)||(n.url="")},down:n=>{}}]},fu=Nt.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),wz=ye({id:he,index:Km,x:ae,y:ae}),uI={color:$n,dash:Ai,size:js,spline:fu,points:cu(he,wz),scale:mt},Ca=us("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),hI={sequence:[{id:Ca.AddSnapHandles,up:n=>{for(const t of Object.values(n.handles))t.canSnap=!0},down:"retired"},{id:Ca.RemoveExtraHandleProps,up:n=>{n.handles=dC(Object.values(n.handles).map(t=>[t.index,{x:t.x,y:t.y}]))},down:n=>{const t=Object.entries(n.handles).map(([e,s])=>({index:e,...s})).sort(Xt);n.handles=Object.fromEntries(t.map((e,s)=>{const r=s===0?"start":s===t.length-1?"end":`handle:${e.index}`;return[r,{id:r,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]}))}},{id:Ca.HandlesToPoints,up:n=>{const t=Object.entries(n.handles).map(([e,{x:s,y:r}])=>({x:s,y:r,index:e})).sort(Xt);n.points=t.map(({x:e,y:s})=>({x:e,y:s})),delete n.handles},down:n=>{const t=nc(n.points.length);n.handles=Object.fromEntries(n.points.map((e,s)=>[t[s],{x:e.x,y:e.y}])),delete n.points}},{id:Ca.PointIndexIds,up:n=>{const t=nc(n.points.length);n.points=Object.fromEntries(n.points.map((e,s)=>{const r=t[s];return[r,{id:r,index:r,x:e.x,y:e.y}]}))},down:n=>{const t=Object.values(n.points).sort(Xt);n.points=t.map(({x:e,y:s})=>({x:e,y:s}))}},{id:Ca.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},pI={color:$n,size:js,font:As,fontSizeAdjustment:au,align:hu,verticalAlign:pu,growY:au,url:Ln,text:he,scale:mt},gi=us("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),fI={sequence:[{id:gi.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:gi.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:gi.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:gi.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:gi.MakeUrlsValid,up:n=>{Ln.isValid(n.url)||(n.url="")},down:n=>{}},{id:gi.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:gi.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},ag=Nt.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),gI={color:$n,size:js,font:As,textAlign:ag,w:mt,text:he,scale:mt,autoSize:we},vx=us("text",{RemoveJustify:1,AddTextAlign:2}),mI={sequence:[{id:vx.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:vx.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},yI={w:mt,h:mt,time:ae,playing:we,url:Ln,assetId:Qu.nullable()},Cx=us("video",{AddUrlProp:1,MakeUrlsValid:2}),SI={sequence:[{id:Cx.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Cx.MakeUrlsValid,up:n=>{Ln.isValid(n.url)||(n.url="")},down:n=>{}}]},xl=In("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),xz=_o({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:xl.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[t,e]of wn(n))e.typeName==="shape"&&(e.type==="icon"||e.type==="code")&&delete n[t]}},{id:xl.AddInstancePresenceType,scope:"store",up(n){}},{id:xl.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[t,e]of wn(n))e.typeName.match(/^(user|user_presence)$/)&&delete n[t]}},{id:xl.RemoveUserDocument,scope:"store",up:n=>{for(const[t,e]of wn(n))e.typeName.match("user_document")&&delete n[t]}}]}),bz={arrow:{migrations:UC,props:zC},bookmark:{migrations:XC,props:YC},draw:{migrations:JC,props:ZC},embed:{migrations:eI,props:QC},frame:{migrations:nI,props:tI},geo:{migrations:rI,props:sI},group:{migrations:oI,props:iI},highlight:{migrations:cI,props:aI},image:{migrations:dI,props:lI},line:{migrations:hI,props:uI},note:{migrations:fI,props:pI},text:{migrations:mI,props:gI},video:{migrations:SI,props:yI}},vz={arrow:{migrations:KC,props:HC}};function Cz({shapes:n=bz,bindings:t=vz,migrations:e}={}){const s=new Map;for(const a of lt(n))for(const c of RC(a.props??{}).keys()){if(s.has(c.id)&&s.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);s.set(c.id,c)}const r=AB(n),i=TB(t),o=KB(s);return zm.create({asset:yi,binding:i,camera:is,document:Vm,instance:o,instance_page_state:Xn,page:ar,instance_presence:ic,pointer:Wm,shape:r},{migrations:[xz,fz,OB,tz,GB,VB,UB,JB,qB,MB,az,lz,uz,...gx("shape",n),...gx("binding",t),...e??[]],onValidationFailure:sz,createIntegrityChecker:iz})}const oc=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"CatalÃ "},{locale:"cs",label:"ÄeÅ¡tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"EspaÃ±ol"},{locale:"fr",label:"FranÃ§ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"PortuguÃªs - Brasil"},{locale:"pt-pt",label:"PortuguÃªs - Europeu"},{locale:"ro",label:"RomÃ¢nÄ"},{locale:"ru",label:"Russian"},{locale:"sl",label:"SlovenÅ¡Äina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiáº¿ng Viá»t"},{locale:"tr",label:"TÃ¼rkÃ§e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"×¢××¨××ª"},{locale:"ar",label:"Ø¹Ø±Ø¨Ù"},{locale:"fa",label:"ÙØ§Ø±Ø³Û"},{locale:"ku",label:"Ú©ÙØ±Ø¯Û"},{locale:"ne",label:"à¤¨à¥à¤ªà¤¾à¤²à¥"},{locale:"hi-in",label:"à¤¹à¤¿à¤¨à¥à¤¦à¥"},{locale:"te",label:"à°¤à±à°²à±à°à±"},{locale:"th",label:"à¸ à¸²à¸©à¸²à¹à¸à¸¢"},{locale:"my",label:"áá¼ááºáá¬áá¬"},{locale:"ko-kr",label:"íêµ­ì´"},{locale:"ja",label:"æ¥æ¬èª"},{locale:"zh-cn",label:"ç®ä½ä¸­æ"},{locale:"zh-tw",label:"ç¹é«ä¸­æ (å°ç£)"}];function Iz(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return Pz(n)}function Pz(n){for(const t of n){const e=Ez(t);if(e)return e}return"en"}const Ix={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Ez(n){const t=oc.find(r=>r.locale===n.toLowerCase());if(t)return t.locale;const[e,s]=n.split(/[-_]/).map(r=>r.toLowerCase());if(s){const r=oc.find(i=>i.locale===e);if(r)return r.locale}return e in Ix?Ix[e]:null}const _z={error:null};class wI extends v.Component{constructor(){super(...arguments);g(this,"state",_z)}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){var s,r;(r=(s=this.props).onError)==null||r.call(s,e)}render(){const{error:e}=this.state;if(e!==null){const{fallback:s}=this.props;return u.jsx(s,{error:e})}return this.props.children}}function ac({children:n,fallback:t,...e}){return t===null?u.jsx(u.Fragment,{children:n}):u.jsx(wI,{fallback:t,...e,children:n})}const eh=me.createContext(null);function N(){const n=me.useContext(eh);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function Tz(){return u.jsx("div",{className:"tl-background"})}function ia(n,t,e,s,r,i){v.useLayoutEffect(()=>{const o=n.current;if(!o||t===void 0)return;let a=`translate(${t}px, ${e}px)`;s!==void 0&&(a+=` scale(${s})`),r!==void 0&&(a+=` rotate(${r}rad)`),i&&(a+=` translate(${i.x}px, ${i.y}px)`),o.style.transform=a})}const It={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class S{constructor(t=0,e=0,s=1){this.x=t,this.y=e,this.z=s}get pressure(){return this.z}set(t=this.x,e=this.y,s=this.z){return this.x=t,this.y=e,this.z=s,this}setTo({x:t=0,y:e=0,z:s=1}){return this.x=t,this.y=e,this.z=s,this}rot(t){if(t===0)return this;const{x:e,y:s}=this,r=Math.sin(t),i=Math.cos(t);return this.x=e*i-s*r,this.y=e*r+s*i,this}rotWith(t,e){if(e===0)return this;const s=this.x-t.x,r=this.y-t.y,i=Math.sin(e),o=Math.cos(e);return this.x=t.x+(s*o-r*i),this.y=t.y+(s*i+r*o),this}clone(){const{x:t,y:e,z:s}=this;return new S(t,e,s)}sub(t){return this.x-=t.x,this.y-=t.y,this}subXY(t,e){return this.x-=t,this.y-=e,this}subScalar(t){return this.x-=t,this.y-=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,e){return this.x+=t,this.y+=e,this}addScalar(t){return this.x+=t,this.y+=t,this}clamp(t,e){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),e!==void 0&&(this.x=Math.min(this.x,e),this.y=Math.min(this.y,e)),this}div(t){return this.x/=t,this.y/=t,this}divV(t){return this.x/=t.x,this.y/=t.y,this}mul(t){return this.x*=t,this.y*=t,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(t,e){const s=S.Tan(t,this);return this.add(s.mul(e))}neg(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this}dpr(t){return S.Dpr(this,t)}cpr(t){return S.Cpr(this,t)}len2(){return S.Len2(this)}len(){return S.Len(this)}pry(t){return S.Pry(this,t)}per(){const{x:t,y:e}=this;return this.x=e,this.y=-t,this}uni(){return S.Uni(this)}tan(t){return S.Tan(this,t)}dist(t){return S.Dist(this,t)}distanceToLineSegment(t,e){return S.DistanceToLineSegment(t,e,this)}slope(t){return S.Slope(this,t)}snapToGrid(t){return this.x=Math.round(this.x/t)*t,this.y=Math.round(this.y/t)*t,this}angle(t){return S.Angle(this,t)}toAngle(){return S.ToAngle(this)}lrp(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this}equals(t){return S.Equals(this,t)}equalsXY(t,e){return S.EqualsXY(this,t,e)}norm(){const t=this.len();return this.x=t===0?0:this.x/t,this.y=t===0?0:this.y/t,this}toFixed(){return S.ToFixed(this)}toString(){return S.ToString(S.ToFixed(this))}toJson(){return S.ToJson(this)}toArray(){return S.ToArray(this)}static Add(t,e){return new S(t.x+e.x,t.y+e.y)}static AddXY(t,e,s){return new S(t.x+e,t.y+s)}static Sub(t,e){return new S(t.x-e.x,t.y-e.y)}static SubXY(t,e,s){return new S(t.x-e,t.y-s)}static AddScalar(t,e){return new S(t.x+e,t.y+e)}static SubScalar(t,e){return new S(t.x-e,t.y-e)}static Div(t,e){return new S(t.x/e,t.y/e)}static Mul(t,e){return new S(t.x*e,t.y*e)}static DivV(t,e){return new S(t.x/e.x,t.y/e.y)}static MulV(t,e){return new S(t.x*e.x,t.y*e.y)}static Neg(t){return new S(-t.x,-t.y)}static Per(t){return new S(t.y,-t.x)}static Abs(t){return new S(Math.abs(t.x),Math.abs(t.y))}static Dist(t,e){return((t.y-e.y)**2+(t.x-e.x)**2)**.5}static DistMin(t,e,s){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)<s**2}static Dist2(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}static Dpr(t,e){return t.x*e.x+t.y*e.y}static Cross(t,e){return new S(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z)}static Cpr(t,e){return t.x*e.y-e.x*t.y}static Len2(t){return t.x*t.x+t.y*t.y}static Len(t){return(t.x*t.x+t.y*t.y)**.5}static Pry(t,e){return S.Dpr(t,e)/S.Len(e)}static Uni(t){return S.Div(t,S.Len(t))}static Tan(t,e){return S.Uni(S.Sub(t,e))}static Min(t,e){return new S(Math.min(t.x,e.x),Math.min(t.y,e.y))}static Max(t,e){return new S(Math.max(t.x,e.x),Math.max(t.y,e.y))}static From({x:t,y:e,z:s=1}){return new S(t,e,s)}static FromArray(t){return new S(t[0],t[1])}static Rot(t,e=0){const s=Math.sin(e),r=Math.cos(e);return new S(t.x*r-t.y*s,t.x*s+t.y*r)}static RotWith(t,e,s){const r=t.x-e.x,i=t.y-e.y,o=Math.sin(s),a=Math.cos(s);return new S(e.x+(r*a-i*o),e.y+(r*o+i*a))}static NearestPointOnLineThroughPoint(t,e,s){return S.Mul(e,S.Sub(s,t).pry(e)).add(t)}static NearestPointOnLineSegment(t,e,s,r=!0){if(S.Equals(t,s)||S.Equals(e,s))return S.From(s);const i=S.Tan(e,t),o=S.Add(t,S.Mul(i,S.Sub(s,t).pry(i)));if(r){if(o.x<Math.min(t.x,e.x))return S.Cast(t.x<e.x?t:e);if(o.x>Math.max(t.x,e.x))return S.Cast(t.x>e.x?t:e);if(o.y<Math.min(t.y,e.y))return S.Cast(t.y<e.y?t:e);if(o.y>Math.max(t.y,e.y))return S.Cast(t.y>e.y?t:e)}return o}static DistanceToLineThroughPoint(t,e,s){return S.Dist(s,S.NearestPointOnLineThroughPoint(t,e,s))}static DistanceToLineSegment(t,e,s,r=!0){return S.Dist(s,S.NearestPointOnLineSegment(t,e,s,r))}static Snap(t,e=1){return new S(Math.round(t.x/e)*e,Math.round(t.y/e)*e)}static Cast(t){return t instanceof S?t:S.From(t)}static Slope(t,e){return t.x===e.y?NaN:(t.y-e.y)/(t.x-e.x)}static IsNaN(t){return isNaN(t.x)||isNaN(t.y)}static Angle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static Lrp(t,e,s){return S.Sub(e,t).mul(s).add(t)}static Med(t,e){return new S((t.x+e.x)/2,(t.y+e.y)/2)}static Equals(t,e){return Math.abs(t.x-e.x)<1e-4&&Math.abs(t.y-e.y)<1e-4}static EqualsXY(t,e,s){return t.x===e&&t.y===s}static Clockwise(t,e,s){return(s.x-t.x)*(e.y-t.y)-(e.x-t.x)*(s.y-t.y)<0}static Rescale(t,e){const s=S.Len(t);return new S(e*t.x/s,e*t.y/s)}static ScaleWithOrigin(t,e,s){return S.Sub(t,s).mul(e).add(s)}static ToFixed(t){return new S(Js(t.x),Js(t.y))}static ToInt(t){return new S(parseInt(t.x.toFixed(0)),parseInt(t.y.toFixed(0)),parseInt((t.z??0).toFixed(0)))}static ToCss(t){return`${t.x},${t.y}`}static Nudge(t,e,s){return S.Add(t,S.Tan(e,t).mul(s))}static ToString(t){return`${t.x}, ${t.y}`}static ToAngle(t){let e=Math.atan2(t.y,t.x);return e<0&&(e+=Math.PI*2),e}static FromAngle(t,e=1){return new S(Math.cos(t)*e,Math.sin(t)*e)}static ToArray(t){return[t.x,t.y,t.z]}static ToJson(t){const{x:e,y:s,z:r}=t;return{x:e,y:s,z:r}}static Average(t){const e=t.length,s=new S(0,0);if(e===0)return s;for(let r=0;r<e;r++)s.add(t[r]);return s.div(e)}static Clamp(t,e,s){return s===void 0?new S(Math.min(Math.max(t.x,e)),Math.min(Math.max(t.y,e))):new S(Math.min(Math.max(t.x,e),s),Math.min(Math.max(t.y,e),s))}static PointsBetween(t,e,s=6){const r=[];for(let i=0;i<s;i++){const o=It.easeInQuad(i/(s-1)),a=S.Lrp(t,e,o);a.z=Math.min(1,.5+Math.abs(.5-kz(o))*.65),r.push(a)}return r}static SnapToGrid(t,e=8){return new S(Math.round(t.x/e)*e,Math.round(t.y/e)*e)}}const kz=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Pe(n){return`${$(n.x)},${$(n.y)} `}function fn(n,t){return`${$((n.x+t.x)/2)},${$((n.y+t.y)/2)} `}const _e=Math.PI,Ue=_e/2,je=_e*2,Mz=Math.sin;function bt(n,t,e){return Math.max(t,typeof e<"u"?Math.min(n,e):n)}function bl(n,t=1e10){return n?Math.round(n*t)/t:0}function Nr(n,t,e=1e-6){return Math.abs(n-t)<=e}function xI(n,t){const e=Math.pow(n-t,2)/Math.pow(n+t,2);return _e*(n+t)*(1+3*e/(10+Math.sqrt(4-3*e)))}function Br(n){return n=n%je,n<0?n=n+je:n===0&&(n=0),n}function Dc(n,t){return n=Br(n),t=Br(t),n>t&&(t+=je),t-n}function bI(n,t){return je-Dc(n,t)}function rd(n,t){const e=(t-n)%je;return 2*e%je-e}function cg(n){return(je+n)%je}function gu(n,t){const e=je/t;let s=Math.floor((cg(n)+e/2)/e)*e%je;return s<_e&&(s+=je),s>_e&&(s-=je),s}function vI(n,t){return n===t||Nr(n%(Math.PI/2)-t%(Math.PI/2),0)}function Az(n){return n*_e/180}function jz(n){return n*180/_e}function Di(n,t,e){return new S(n.x,n.y).add(S.FromAngle(e,t))}function wp(n,t,e){const s=n/2,r=t/2,i=[];let o=1/0,a=-1/0,c=1/0,l=-1/0;for(let y=0;y<e;y++){const m=je/e,x=-Ue+y*m,w=s+s*Math.cos(x),b=r+r*Math.sin(x);w<o&&(o=w),b<c&&(c=b),w>a&&(a=w),b>l&&(l=b),i.push(new S(w,b))}const d=a-o,h=l-c,p=n-d,f=t-h;if(p!==0||f!==0)for(let y=0;y<i.length;y++){const m=i[y];m.x=(m.x-o)/d*n,m.y=(m.y-c)/h*t}return i}function Ia(n,t,e,s){return n<s&&e<t}function ns(n,t,e,s){const r=Math.max(n,e),i=Math.min(t,s);return r<=i?[r,i]:null}function Px(n,t,e){return(t.x-n.x)*(e.y-n.y)-(e.x-n.x)*(t.y-n.y)}function On(n,t){let e=0,s,r;for(let i=0;i<t.length;i++){if(s=t[i],s.x===n.x&&s.y===n.y||(r=t[(i+1)%t.length],S.Dist(n,s)+S.Dist(n,r)===S.Dist(s,r)))return!0;s.y<=n.y?r.y>n.y&&Px(s,r,n)>0&&(e+=1):r.y<=n.y&&Px(s,r,n)<0&&(e-=1)}return e!==0}function $(n){return Math.round(n*1e4)/1e4}function Js(n){return Math.round(n*100)/100}const Ex=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function Mr(n,t,e){return e<0?Dc(n,t):bI(n,t)}function lg(n,t,e,s){let r;if(Math.abs(n)>_e){r=rd(t,s);const i=rd(s,e);return Math.abs(r)<Math.abs(i)?r/n:(n-i)/n}else{r=rd(t,s);const i=r/n;return Math.sign(r)!==Math.sign(n)?Math.abs(i)>.5?1:0:i}}function Dz(n,t,e,s){const r=2*((t-n)%je)%je-(t-n)%je;return s?(je-Math.abs(r))*(e?1:-1):r}function Ym(n,t,e){const s=-2*(n.x*(t.y-e.y)-n.y*(t.x-e.x)+t.x*e.y-e.x*t.y);return new S(((n.x*n.x+n.y*n.y)*(e.y-t.y)+(t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y))/s,((n.x*n.x+n.y*n.y)*(t.x-e.x)+(t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x))/s)}function Oz(n,t,e,s,r){if(e===null)return[S.From(n),S.From(t)];const i=[],o=S.Angle(e,n),a=S.Angle(e,t),c=Dc(o,a);for(let l=0;l<r;l++){const d=l/(r-1),h=o+c*d,p=Di(e,s,h);i.push(p)}return i}const xp=({brush:n,color:t,opacity:e,className:s})=>{const r=v.useRef(null);ia(r,n.x,n.y);const i=$(Math.max(1,n.w)),o=$(Math.max(1,n.h));return u.jsx("svg",{className:"tl-overlays__item",ref:r,children:t?u.jsxs("g",{className:"tl-brush",opacity:e,children:[u.jsx("rect",{width:i,height:o,fill:t,opacity:.75}),u.jsx("rect",{width:i,height:o,fill:"none",stroke:t,opacity:.1})]}):u.jsx("rect",{className:`tl-brush tl-brush__default ${s}`,width:i,height:o})})},_x={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},Tx={onResolveAsset:async n=>(n==null?void 0:n.props.src)||""},bp={duration:0,easing:It.easeInOutCubic},kx={CAMERA_MOVE:-10},Rz=["top","right","bottom","left"],Mx=0,Xm=2,vl=1,Ax=5,Lz=128;var vp={};const $z={},CI=ln("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),ft={logPreventDefaults:ln("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:ln("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:ln("logElementRemoves",{defaults:{all:!1}}),debugSvg:ln("debugSvg",{defaults:{all:!1}}),showFps:ln("showFps",{defaults:{all:!1}}),measurePerformance:ln("measurePerformance",{defaults:{all:!1}}),throwToBlob:ln("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:ln("reconnectOnPing",{defaults:{all:!1}}),debugCursors:ln("debugCursors",{defaults:{all:!1}}),forceSrgb:ln("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ln("debugGeometry",{defaults:{all:!1}}),hideShapes:ln("hideShapes",{defaults:{all:!1}}),editOnType:ln("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;ei("element removal logging",()=>{ft.logElementRemoves.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),n.call(this,t)}:Element.prototype.removeChild=n})}function ln(n,{defaults:t,shouldStoreForSession:e=!0}){return Fz({name:n,defaults:t,shouldStoreForSession:e})}function Fz(n){const t=Bz(n),e=n.shouldStoreForSession?Nz(n.name):null,s=Ct(`debug:${n.name}`,e??t);return typeof window<"u"&&(n.shouldStoreForSession&&ei(`debug:${n.name}`,()=>{const r=s.get();r===t?yC(`tldraw_debug:${n.name}`):Rm(`tldraw_debug:${n.name}`,JSON.stringify(r))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,r=>r.toUpperCase())}`,{get(){return s.get()},set(r){s.set(r)},configurable:!0})),Object.assign(s,n)}function Nz(n){try{return JSON.parse(mC(`tldraw_debug:${n}`)??"null")}catch{return null}}function Cp(n){try{return n()}catch{return null}}function Bz(n){switch(Cp(()=>vp.TLDRAW_ENV)??Cp(()=>vp.VERCEL_PUBLIC_TLDRAW_ENV)??Cp(()=>vp.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function mu(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return mu(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ee(n){n.preventDefault(),ft.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Oc(n,t){if(n.setPointerCapture(t.pointerId),ft.logPointerCaptures.get()){const e=CI.get();e.set(n,(e.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,t)}}function Rc(n,t){if(n.hasPointerCapture(t.pointerId)&&(n.releasePointerCapture(t.pointerId),ft.logPointerCaptures.get())){const e=CI.get();e.get(n)===1?e.delete(n):e.has(n)?e.set(n,e.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,t)}}const Rt=n=>n.stopPropagation(),Ut=(n,t,e)=>{n&&n.style.setProperty(t,e)};function yn(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function zz(){const n=N();return v.useMemo(function(){let s,r;function i(m){if(!m.isKilled){if(m.button===Xm){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...yn(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(Oc(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...yn(m)}))}}function o(m){m.isKilled||m.clientX===s&&m.clientY===r||(s=m.clientX,r=m.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...yn(m)}))}function a(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(s=m.clientX,r=m.clientY,Rc(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...yn(m)}))}function c(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!0:null})}function l(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!1:null})}function d(m){m.isKilled=!0,Ee(m)}function h(m){m.isKilled=!0,m.target instanceof HTMLElement&&m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&m.target.className.includes("tl-text-content"))&&Ee(m)}function p(m){Ee(m)}async function f(m){var w,b;if(Ee(m),!((b=(w=m.dataTransfer)==null?void 0:w.files)!=null&&b.length))return;const x=Array.from(m.dataTransfer.files);await n.putExternalContent({type:"files",files:x,point:n.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function y(m){Rt(m)}return{onPointerDown:i,onPointerMove:o,onPointerUp:a,onPointerEnter:c,onPointerLeave:l,onDragOver:p,onDrop:f,onTouchStart:d,onTouchEnd:h,onClick:y}},[n])}function Uz(){const n=N();v.useEffect(()=>{let t=n.getInstanceState().isCoarsePointer;const e=o=>{const a=o.pointerType!=="mouse";t!==a&&(t=a,n.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",e,{capture:!0});const s=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),r=n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos,i=()=>{const o=r?!1:s.matches;t===o&&(t=o,n.updateInstanceState({isCoarsePointer:o}))};return s&&(s.addEventListener("change",i),i()),()=>{window.removeEventListener("pointerdown",e,{capture:!0}),s&&s.removeEventListener("change",i)}},[n])}const II=v.createContext(null);function Hz({container:n,children:t}){return u.jsx(II.Provider,{value:n,children:t})}function Qt(){return Gn(v.useContext(II),"useContainer used outside of <Tldraw />")}function Kz(){const n=N(),t=Qt(),e=z("isFocused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(typeof matchMedia===void 0)return;let s=null;const r=()=>{s!=null&&s();const i=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(i),a=c=>{c.type==="change"&&r()};o.addEventListener?o.addEventListener("change",r):o.addListener&&o.addListener(a),s=()=>{o.removeEventListener?o.removeEventListener("change",r):o.removeListener&&o.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return r(),()=>{s==null||s()}},[n]),v.useEffect(()=>{if(!e)return;const s=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!Cl()&&Ee(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Ee(a);return}break}case"Tab":{if(Cl()||n.getIsMenuOpen())return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&a.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),n.focus());return}default:if(Cl()||n.getIsMenuOpen())return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(c)},r=a=>{if(a.isKilled||(a.isKilled=!0,Cl()||n.getIsMenuOpen())||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(c)};function i(a){var c,l;if(t.contains(a.target)){const d=a.touches[0].pageX,h=a.touches[0].radiusX||0;(d-h<10||d+h>n.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((l=a.target)==null||l.click()),Ee(a))}}const o=a=>{t.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Ee(a)};return t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",Ee),document.addEventListener("gesturechange",Ee),document.addEventListener("gestureend",Ee),t.addEventListener("keydown",s),t.addEventListener("keyup",r),()=>{t.removeEventListener("touchstart",i),t.removeEventListener("wheel",o),document.removeEventListener("gesturestart",Ee),document.removeEventListener("gesturechange",Ee),document.removeEventListener("gestureend",Ee),t.removeEventListener("keydown",s),t.removeEventListener("keyup",r)}},[n,t,e])}const Gz=["input","select","button","textarea"];function Cl(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||Gz.indexOf(n.tagName.toLowerCase())>-1))}const Wz=["textarea","input"];function Vz(n){const t=N();v.useEffect(()=>{const e=n.current;if(!e)return;const s=r=>{var i;if(r instanceof PointerEvent&&r.pointerType==="pen"){r.isKilled=!0;const{target:o}=r;if(Wz.includes((i=o.tagName)==null?void 0:i.toLocaleLowerCase())||t.isIn("select.editing_shape"))return;Ee(r)}};return e.addEventListener("touchstart",s),e.addEventListener("touchend",s),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("touchend",s)}},[t,n])}function Yz(n,t,e){return Math.max(t,Math.min(n,e))}const Ot={toVector(n,t){return n===void 0&&(n=t),Array.isArray(n)?n:[n,n]},add(n,t){return[n[0]+t[0],n[1]+t[1]]},sub(n,t){return[n[0]-t[0],n[1]-t[1]]},addTo(n,t){n[0]+=t[0],n[1]+=t[1]},subTo(n,t){n[0]-=t[0],n[1]-=t[1]}};function jx(n,t,e){return t===0||Math.abs(t)===1/0?Math.pow(n,e*5):n*t*e/(t+e*n)}function Dx(n,t,e,s=.15){return s===0?Yz(n,t,e):n<t?-jx(t-n,e-t,s)+t:n>e?+jx(n-e,e-t,s)+e:n}function Xz(n,[t,e],[s,r]){const[[i,o],[a,c]]=n;return[Dx(t,i,o,s),Dx(e,a,c,r)]}function qz(n,t){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Zz(n){var t=qz(n,"string");return typeof t=="symbol"?t:String(t)}function Gt(n,t,e){return t=Zz(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function Ox(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,s)}return e}function ot(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ox(Object(e),!0).forEach(function(s){Gt(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Ox(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const PI={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Rx(n){return n?n[0].toUpperCase()+n.slice(1):""}const Jz=["enter","leave"];function Qz(n=!1,t){return n&&!Jz.includes(t)}function eU(n,t="",e=!1){const s=PI[n],r=s&&s[t]||t;return"on"+Rx(n)+Rx(r)+(Qz(e,r)?"Capture":"")}const tU=["gotpointercapture","lostpointercapture"];function nU(n){let t=n.substring(2).toLowerCase();const e=!!~t.indexOf("passive");e&&(t=t.replace("passive",""));const s=tU.includes(t)?"capturecapture":"capture",r=!!~t.indexOf(s);return r&&(t=t.replace("capture","")),{device:t,capture:r,passive:e}}function sU(n,t=""){const e=PI[n],s=e&&e[t]||t;return n+s}function EI(n){return"touches"in n}function rU(n){return EI(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function iU(n){return Array.from(n.touches).filter(t=>{var e,s;return t.target===n.currentTarget||((e=n.currentTarget)===null||e===void 0||(s=e.contains)===null||s===void 0?void 0:s.call(e,t.target))})}function dg(n,t){try{const e=t.clientX-n.clientX,s=t.clientY-n.clientY,r=(t.clientX+n.clientX)/2,i=(t.clientY+n.clientY)/2,o=Math.hypot(e,s);return{angle:-(Math.atan2(e,s)*180)/Math.PI,distance:o,origin:[r,i]}}catch{}return null}function oU(n){return iU(n).map(t=>t.identifier)}function Lx(n,t){const[e,s]=Array.from(n.touches).filter(r=>t.includes(r.identifier));return dg(e,s)}const $x=40,Fx=800;function _I(n){let{deltaX:t,deltaY:e,deltaMode:s}=n;return s===1?(t*=$x,e*=$x):s===2&&(t*=Fx,e*=Fx),[t,e]}function aU(n){const t={};if("buttons"in n&&(t.buttons=n.buttons),"shiftKey"in n){const{shiftKey:e,altKey:s,metaKey:r,ctrlKey:i}=n;Object.assign(t,{shiftKey:e,altKey:s,metaKey:r,ctrlKey:i})}return t}function yu(n,...t){return typeof n=="function"?n(...t):n}function cU(){}function lU(...n){return n.length===0?cU:n.length===1?n[0]:function(){let t;for(const e of n)t=e.apply(this,arguments)||t;return t}}function Nx(n,t){return Object.assign({},t,n||{})}const dU=32;class TI{constructor(t,e,s){this.ctrl=t,this.args=e,this.key=s,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:s,args:r}=this;e[s]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=r,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,s=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=s.from?yu(s.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:s,shared:r}=this;e.args=this.args;let i=0;if(t&&(e.event=t,s.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,aU(t)),r.down=r.pressed=r.buttons%2===1||r.touches>0,i=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const C=e._delta.map(Math.abs);Ot.addTo(e._distance,C)}this.axisIntent&&this.axisIntent(t);const[o,a]=e._movement,[c,l]=s.threshold,{_step:d,values:h}=e;if(s.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&h[0]),d[1]===!1&&(d[1]=Math.abs(a)>=l&&h[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(a)>=l&&Math.sign(a)*l)),e.intentional=d[0]!==!1||d[1]!==!1,!e.intentional)return;const p=[0,0];if(s.hasCustomTransform){const[C,_]=h;p[0]=d[0]!==!1?C-d[0]:0,p[1]=d[1]!==!1?_-d[1]:0}else p[0]=d[0]!==!1?o-d[0]:0,p[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(p);const f=e.offset,y=e._active&&!e._blocked||e.active;y&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=r[this.ingKey]=e._active,t&&(e.first&&("bounds"in s&&(e._bounds=yu(s.bounds,e)),this.setup&&this.setup()),e.movement=p,this.computeOffset()));const[m,x]=e.offset,[[w,b],[I,E]]=e._bounds;e.overflow=[m<w?-1:m>b?1:0,x<I?-1:x>E?1:0],e._movementBound[0]=e.overflow[0]?e._movementBound[0]===!1?e._movement[0]:e._movementBound[0]:!1,e._movementBound[1]=e.overflow[1]?e._movementBound[1]===!1?e._movement[1]:e._movementBound[1]:!1;const P=e._active?s.rubberband||[0,0]:[0,0];if(e.offset=Xz(e._bounds,e.offset,P),e.delta=Ot.sub(e.offset,f),this.computeMovement(),y&&(!e.last||i>dU)){e.delta=Ot.sub(e.offset,f);const C=e.delta.map(Math.abs);Ot.addTo(e.distance,C),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&i>0&&(e.velocity=[C[0]/i,C[1]/i],e.timeDelta=i)}}emit(){const t=this.state,e=this.shared,s=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!s.triggerAllEvents)return;const r=this.handler(ot(ot(ot({},e),t),{},{[this.aliasKey]:t.values}));r!==void 0&&(t.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function uU([n,t],e){const s=Math.abs(n),r=Math.abs(t);if(s>r&&s>e)return"x";if(r>s&&r>e)return"y"}class hU extends TI{constructor(...t){super(...t),Gt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Ot.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Ot.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,s=this.config;if(!e.axis&&t){const r=typeof s.axisThreshold=="object"?s.axisThreshold[rU(t)]:s.axisThreshold;e.axis=uU(e._movement,r)}e._blocked=(s.lockDirection||!!s.axis)&&!e.axis||!!s.axis&&s.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const pU=n=>n,Bx=.15,kI={enabled(n=!0){return n},eventOptions(n,t,e){return ot(ot({},e.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[Bx,Bx];case!1:return[0,0];default:return Ot.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Ot.toVector(n)},transform(n,t,e){const s=n||e.shared.transform;return this.hasCustomTransform=!!s,s||pU},threshold(n){return Ot.toVector(n,0)}},fU=0,Lc=ot(ot({},kI),{},{axis(n,t,{axis:e}){if(this.lockDirection=e==="lock",!this.lockDirection)return e},axisThreshold(n=fU){return n},bounds(n={}){if(typeof n=="function")return i=>Lc.bounds(n(i));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:t=-1/0,right:e=1/0,top:s=-1/0,bottom:r=1/0}=n;return[[t,e],[s,r]]}}),$c=typeof window<"u"&&window.document&&window.document.createElement;function MI(){return $c&&"ontouchstart"in window}function gU(){return MI()||$c&&window.navigator.maxTouchPoints>1}function mU(){return $c&&"onpointerdown"in window}function yU(){return $c&&"exitPointerLock"in window.document}function SU(){try{return"constructor"in GestureEvent}catch{return!1}}const Wn={isBrowser:$c,gesture:SU(),touch:MI(),touchscreen:gU(),pointer:mU(),pointerLock:yU()},wU=250,xU=180,bU=.5,vU=50,CU=250,IU=10,zx={mouse:0,touch:0,pen:8};ot(ot({},Lc),{},{device(n,t,{pointer:{touch:e=!1,lock:s=!1,mouse:r=!1}={}}){return this.pointerLock=s&&Wn.pointerLock,Wn.touch&&e?"touch":this.pointerLock?"mouse":Wn.pointer&&!r?"pointer":Wn.touch?"touch":"mouse"},preventScrollAxis(n,t,{preventScroll:e}){if(this.preventScrollDelay=typeof e=="number"?e:e||e===void 0&&n?wU:void 0,!(!Wn.touchscreen||e===!1))return n||(e!==void 0?"y":void 0)},pointerCapture(n,t,{pointer:{capture:e=!0,buttons:s=1,keys:r=!0}={}}){return this.pointerButtons=s,this.keys=r,!this.pointerLock&&this.device==="pointer"&&e},threshold(n,t,{filterTaps:e=!1,tapsThreshold:s=3,axis:r=void 0}){const i=Ot.toVector(n,e?s:r?1:0);return this.filterTaps=e,this.tapsThreshold=s,i},swipe({velocity:n=bU,distance:t=vU,duration:e=CU}={}){return{velocity:this.transform(Ot.toVector(n)),distance:this.transform(Ot.toVector(t)),duration:e}},delay(n=0){switch(n){case!0:return xU;case!1:return 0;default:return n}},axisThreshold(n){return n?ot(ot({},zx),n):zx},keyboardDisplacement(n=IU){return n}});function AI(n){const[t,e]=n.overflow,[s,r]=n._delta,[i,o]=n._direction;(t<0&&s>0&&i<0||t>0&&s<0&&i>0)&&(n._movement[0]=n._movementBound[0]),(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(n._movement[1]=n._movementBound[1])}const PU=30,EU=100;class _U extends TI{constructor(...t){super(...t),Gt(this,"ingKey","pinching"),Gt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:s}=this.state;t==="wheel"?this.state.offset=Ot.add(e,s):this.state.offset=[(1+e[0])*s[0],e[1]+s[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,s]=t._movement;if(!t.axis){const r=Math.abs(e)*PU-Math.abs(s);r<0?t.axis="angle":r>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,s=this.ctrl.touchIds;if(e._active&&e._touchIds.every(i=>s.has(i))||s.size<2)return;this.start(t),e._touchIds=Array.from(s).slice(0,2);const r=Lx(t,e._touchIds);r&&this.pinchStart(t,r)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,s=e._pointerEvents,r=this.ctrl.pointerIds;if(e._active&&Array.from(s.keys()).every(o=>r.has(o))||(s.size<2&&s.set(t.pointerId,t),e._pointerEvents.size<2))return;this.start(t);const i=dg(...Array.from(s.values()));i&&this.pinchStart(t,i)}pinchStart(t,e){const s=this.state;s.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=Lx(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const s=dg(...Array.from(e.values()));s&&this.pinchMove(t,s)}pinchMove(t,e){const s=this.state,r=s._values[1],i=e.angle-r;let o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([e.distance,e.angle-360*o]),s.origin=e.origin,s.turns=o,s._movement=[s._values[0]/s._initial[0]-1,s._values[1]-s._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const s=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=Ot.sub(e._movement,s),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&(Array.isArray(e)?!e.find(s=>t[s]):!t[e])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const s=this.state;s._delta=[-_I(t)[1]/EU*s.offset[0],0],Ot.addTo(s._movement,s._delta),AI(s),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this)),t("lostPointerCapture","",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const TU=ot(ot({},kI),{},{device(n,t,{shared:e,pointer:{touch:s=!1}={}}){if(e.target&&!Wn.touch&&Wn.gesture)return"gesture";if(Wn.touch&&s)return"touch";if(Wn.touchscreen){if(Wn.pointer)return"pointer";if(Wn.touch)return"touch"}},bounds(n,t,{scaleBounds:e={},angleBounds:s={}}){const r=o=>{const a=Nx(yu(e,o),{min:-1/0,max:1/0});return[a.min,a.max]},i=o=>{const a=Nx(yu(s,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof e!="function"&&typeof s!="function"?[r(),i()]:o=>[r(o),i(o)]},threshold(n,t,e){return this.lockDirection=e.axis==="lock",Ot.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});ot(ot({},Lc),{},{mouseOnly:(n=!0)=>n});class kU extends hU{constructor(...t){super(...t),Gt(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=_I(t),Ot.addTo(e._movement,e._delta),AI(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const MU=Lc;ot(ot({},Lc),{},{mouseOnly:(n=!0)=>n});const qm=new Map,ug=new Map;function AU(n){qm.set(n.key,n.engine),ug.set(n.key,n.resolver)}const jU={key:"pinch",engine:_U,resolver:TU},DU={key:"wheel",engine:kU,resolver:MU};function OU(n,t){if(n==null)return{};var e={},s=Object.keys(n),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(e[r]=n[r]);return e}function RU(n,t){if(n==null)return{};var e=OU(n,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(e[s]=n[s])}return e}const LU={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Wn.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:t=!1}={}){return{passive:n,capture:t}},transform(n){return n}},$U=["target","eventOptions","window","enabled","transform"];function id(n={},t){const e={};for(const[s,r]of Object.entries(t))switch(typeof r){case"function":e[s]=r.call(e,n[s],s,n);break;case"object":e[s]=id(n[s],r);break;case"boolean":r&&(e[s]=n[s]);break}return e}function FU(n,t,e={}){const s=n,{target:r,eventOptions:i,window:o,enabled:a,transform:c}=s,l=RU(s,$U);if(e.shared=id({target:r,eventOptions:i,window:o,enabled:a,transform:c},LU),t){const d=ug.get(t);e[t]=id(ot({shared:e.shared},l),d)}else for(const d in l){const h=ug.get(d);h&&(e[d]=id(ot({shared:e.shared},l[d]),h))}return e}class jI{constructor(t,e){Gt(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,s,r,i){const o=this._listeners,a=sU(e,s),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=ot(ot({},c),i);t.addEventListener(a,r,l);const d=()=>{t.removeEventListener(a,r,l),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class NU{constructor(){Gt(this,"_timeouts",new Map)}add(t,e,s=140,...r){this.remove(t),this._timeouts.set(t,window.setTimeout(e,s,...r))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class BU{constructor(t){Gt(this,"gestures",new Set),Gt(this,"_targetEventStore",new jI(this)),Gt(this,"gestureEventStores",{}),Gt(this,"gestureTimeoutStores",{}),Gt(this,"handlers",{}),Gt(this,"config",{}),Gt(this,"pointerIds",new Set),Gt(this,"touchIds",new Set),Gt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),zU(this,t)}setEventIds(t){if(EI(t))return this.touchIds=new Set(oU(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=FU(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,s={};let r;if(!(e.target&&(r=e.target(),!r))){if(e.enabled){for(const o of this.gestures){const a=this.config[o],c=Ux(s,a.eventOptions,!!r);if(a.enabled){const l=qm.get(o);new l(this,t,o).bind(c)}}const i=Ux(s,e.eventOptions,!!r);for(const o in this.nativeHandlers)i(o,"",a=>this.nativeHandlers[o](ot(ot({},this.state.shared),{},{event:a,args:t})),void 0,!0)}for(const i in s)s[i]=lU(...s[i]);if(!r)return s;for(const i in s){const{device:o,capture:a,passive:c}=nU(i);this._targetEventStore.add(r,o,"",s[i],{capture:a,passive:c})}}}}function no(n,t){n.gestures.add(t),n.gestureEventStores[t]=new jI(n,t),n.gestureTimeoutStores[t]=new NU}function zU(n,t){t.drag&&no(n,"drag"),t.wheel&&no(n,"wheel"),t.scroll&&no(n,"scroll"),t.move&&no(n,"move"),t.pinch&&no(n,"pinch"),t.hover&&no(n,"hover")}const Ux=(n,t,e)=>(s,r,i,o={},a=!1)=>{var c,l;const d=(c=o.capture)!==null&&c!==void 0?c:t.capture,h=(l=o.passive)!==null&&l!==void 0?l:t.passive;let p=a?s:eU(s,r,d);e&&h&&(p+="Passive"),n[p]=n[p]||[],n[p].push(i)},UU=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function HU(n){const t={},e={},s=new Set;for(let r in n)UU.test(r)?(s.add(RegExp.lastMatch),e[r]=n[r]):t[r]=n[r];return[e,t,s]}function so(n,t,e,s,r,i){if(!n.has(e)||!qm.has(s))return;const o=e+"Start",a=e+"End",c=l=>{let d;return l.first&&o in t&&t[o](l),e in t&&(d=t[e](l)),l.last&&a in t&&t[a](l),d};r[s]=c,i[s]=i[s]||{}}function KU(n,t){const[e,s,r]=HU(n),i={};return so(r,e,"onDrag","drag",i,t),so(r,e,"onWheel","wheel",i,t),so(r,e,"onScroll","scroll",i,t),so(r,e,"onPinch","pinch",i,t),so(r,e,"onMove","move",i,t),so(r,e,"onHover","hover",i,t),{handlers:i,config:t,nativeHandlers:s}}function GU(n,t={},e,s){const r=me.useMemo(()=>new BU(n),[]);if(r.applyHandlers(n,s),r.applyConfig(t,e),me.useEffect(r.effect.bind(r)),me.useEffect(()=>r.clean.bind(r),[]),t.target===void 0)return r.bind.bind(r)}function WU(n){return n.forEach(AU),function(e,s){const{handlers:r,nativeHandlers:i,config:o}=KU(e,s||{});return GU(r,o,void 0,i)}}const Hx=10,VU=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function DI(n){let{deltaY:t,deltaX:e}=n,s=0;return n.ctrlKey||n.altKey||n.metaKey?s=(Math.abs(t)>Hx?Hx*Math.sign(t):t)/100:n.shiftKey&&!VU&&(e=t,t=0),{x:-e,y:-t,z:-s}}const YU=WU([DU,jU]);let ro;const XU=n=>ro===void 0?(ro=n,!1):n-ro>120&&n-ro<160?(ro=n,!0):(ro=n,!1);function qU(n){const t=N(),e=v.useMemo(()=>{let s="not sure";const r=({event:m})=>{if(!t.getInstanceState().isFocused||(s="not sure",XU(Date.now())))return;const x=t.getEditingShapeId();if(x){const I=t.getShape(x);if(I&&t.getShapeUtil(I).canScroll(I)){const P=t.getShapePageBounds(x);if(P!=null&&P.containsPoint(t.inputs.currentPagePoint))return}}Ee(m),Rt(m);const w=DI(m);if(w.x===0&&w.y===0)return;const b={type:"wheel",name:"wheel",delta:w,point:new S(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey};t.dispatch(b)};let i=1,o=1,a=1,c=0;const l=new S,d=new S,h=m=>{const x=n.current;s="not sure";const{event:w,origin:b,da:I}=m;w instanceof WheelEvent||(w.target===x||x!=null&&x.contains(w.target))&&(d.x=b[0],d.y=b[1],l.x=b[0],l.y=b[1],i=I[0],o=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:b[0],y:b[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey}))},p=m=>{if(m&&(s="zooming"),s==="zooming")return;const x=Math.abs(c-i),w=S.Dist(l,d);switch(s){case"not sure":{x>24?s="zooming":w>16&&(s="panning");break}case"panning":{x>64&&(s="zooming");break}}};return{onWheel:r,onPinchStart:h,onPinchEnd:m=>{const x=n.current,{event:w,origin:b,offset:I}=m;if(w instanceof WheelEvent||!(w.target===x||x!=null&&x.contains(w.target)))return;const E=I[0];s="not sure",t.timers.requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:b[0],y:b[1],z:E},delta:{x:b[0],y:b[1]},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey})})},onPinch:m=>{const x=n.current,{event:w,origin:b,offset:I,da:E}=m;if(w instanceof WheelEvent||!(w.target===x||x!=null&&x.contains(w.target)))return;const P=m.type==="gesturechange"||m.type==="gestureend";c=E[0];const C=b[0]-d.x,_=b[1]-d.y;switch(d.x=b[0],d.y=b[1],p(P),s){case"zooming":{a=I[0],t.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:a},delta:{x:C,y:_},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey});break}case"panning":{t.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:o},delta:{x:C,y:_},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey});break}}}}},[t,n]);YU(e,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}function Ip(n,t,e){const s=n.getShape(t),r=n.getShapeHandles(s);return{shape:s,handle:r.find(i=>i.id===e)}}function ZU(n,t){const e=N();return v.useMemo(()=>{const s=c=>{if(c.isKilled)return;const l=mu(c.currentTarget);Oc(l,c);const{shape:d,handle:h}=Ip(e,n,t);h&&e.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_down",...yn(c)})};let r,i;return{onPointerDown:s,onPointerMove:c=>{if(c.isKilled||c.clientX===r&&c.clientY===i)return;r=c.clientX,i=c.clientY;const{shape:l,handle:d}=Ip(e,n,t);d&&e.dispatch({type:"pointer",target:"handle",handle:d,shape:l,name:"pointer_move",...yn(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=mu(c.currentTarget);Rc(l,c);const{shape:d,handle:h}=Ip(e,n,t);h&&e.dispatch({type:"pointer",target:"handle",handle:h,shape:d,name:"pointer_up",...yn(c)})}}},[e,n,t])}const Ve=class Ve{constructor(t=0,e=0,s=0,r=0){g(this,"x",0);g(this,"y",0);g(this,"w",0);g(this,"h",0);this.x=t,this.y=e,this.w=s,this.h=r}get point(){return new S(this.x,this.y)}set point(t){this.x=t.x,this.y=t.y}get minX(){return this.x}set minX(t){this.x=t}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(t){this.y=t}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(t){this.w=t}get height(){return this.h}set height(t){this.h=t}get aspectRatio(){return this.width/this.height}get center(){return new S(this.midX,this.midY)}set center(t){this.minX=t.x-this.width/2,this.minY=t.y-this.height/2}get corners(){return[new S(this.minX,this.minY),new S(this.maxX,this.minY),new S(this.maxX,this.maxY),new S(this.minX,this.maxY)]}get cornersAndCenter(){return[new S(this.minX,this.minY),new S(this.maxX,this.minY),new S(this.maxX,this.maxY),new S(this.minX,this.maxY),this.center]}get sides(){const{corners:t}=this;return[[t[0],t[1]],[t[1],t[2]],[t[2],t[3]],[t[3],t[0]]]}get size(){return new S(this.w,this.h)}toFixed(){return this.x=bl(this.x),this.y=bl(this.y),this.w=bl(this.w),this.h=bl(this.h),this}setTo(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this}set(t=0,e=0,s=0,r=0){return this.x=t,this.y=e,this.w=s,this.h=r,this}expand(t){const e=Math.min(this.minX,t.minX),s=Math.min(this.minY,t.minY),r=Math.max(this.maxX,t.maxX),i=Math.max(this.maxY,t.maxY);return this.x=e,this.y=s,this.w=r-e,this.h=i-s,this}expandBy(t){return this.x-=t,this.y-=t,this.w+=t*2,this.h+=t*2,this}scale(t){return this.x/=t,this.y/=t,this.w/=t,this.h/=t,this}clone(){const{x:t,y:e,w:s,h:r}=this;return new Ve(t,e,s,r)}translate(t){return this.x+=t.x,this.y+=t.y,this}snapToGrid(t){const e=Math.round(this.minX/t)*t,s=Math.round(this.minY/t)*t,r=Math.round(this.maxX/t)*t,i=Math.round(this.maxY/t)*t;this.minX=e,this.minY=s,this.width=Math.max(1,r-e),this.height=Math.max(1,i-s)}collides(t){return Ve.Collides(this,t)}contains(t){return Ve.Contains(this,t)}includes(t){return Ve.Includes(this,t)}containsPoint(t,e=0){return Ve.ContainsPoint(this,t,e)}getHandlePoint(t){switch(t){case"top_left":return new S(this.minX,this.minY);case"top_right":return new S(this.maxX,this.minY);case"bottom_left":return new S(this.minX,this.maxY);case"bottom_right":return new S(this.maxX,this.maxY);case"top":return new S(this.midX,this.minY);case"right":return new S(this.maxX,this.midY);case"bottom":return new S(this.midX,this.maxY);case"left":return new S(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(t,e,s){const{minX:r,minY:i,maxX:o,maxY:a}=this;let{minX:c,minY:l,maxX:d,maxY:h}=this;switch(t){case"left":case"top_left":case"bottom_left":{c+=e;break}case"right":case"top_right":case"bottom_right":{d+=e;break}}switch(t){case"top":case"top_left":case"top_right":{l+=s;break}case"bottom":case"bottom_left":case"bottom_right":{h+=s;break}}const p=(d-c)/(o-r),f=(h-l)/(a-i),y=p<0,m=f<0;if(y){const x=d;d=c,c=x}if(m){const x=h;h=l,l=x}this.minX=c,this.minY=l,this.width=Math.abs(d-c),this.height=Math.abs(h-l)}union(t){const e=Math.min(this.minX,t.x),s=Math.min(this.minY,t.y),r=Math.max(this.maxX,t.w+t.x),i=Math.max(this.maxY,t.h+t.y);return this.x=e,this.y=s,this.width=r-e,this.height=i-s,this}static From(t){return new Ve(t.x,t.y,t.w,t.h)}static FromCenter(t,e){return new Ve(t.x-e.x/2,t.y-e.y/2,e.x,e.y)}static FromPoints(t){if(t.length===0)return new Ve;let e=1/0,s=1/0,r=-1/0,i=-1/0,o;for(let a=0,c=t.length;a<c;a++)o=t[a],e=Math.min(o.x,e),s=Math.min(o.y,s),r=Math.max(o.x,r),i=Math.max(o.y,i);return new Ve(e,s,r-e,i-s)}static Expand(t,e){const s=Math.min(e.minX,t.minX),r=Math.min(e.minY,t.minY),i=Math.max(e.maxX,t.maxX),o=Math.max(e.maxY,t.maxY);return new Ve(s,r,i-s,o-r)}static ExpandBy(t,e){return new Ve(t.minX-e,t.minY-e,t.width+e*2,t.height+e*2)}static Resize(t,e,s,r,i=!1){const{minX:o,minY:a,maxX:c,maxY:l}=t;let{minX:d,minY:h,maxX:p,maxY:f}=t;switch(e){case"left":case"top_left":case"bottom_left":{d+=s;break}case"right":case"top_right":case"bottom_right":{p+=s;break}}switch(e){case"top":case"top_left":case"top_right":{h+=r;break}case"bottom":case"bottom_left":case"bottom_right":{f+=r;break}}const y=(p-d)/(c-o),m=(f-h)/(l-a),x=y<0,w=m<0;if(i){const I=(c-o)/(l-a),E=Math.abs(p-d),P=Math.abs(f-h),C=E*(m<0?1:-1)*(1/I),_=P*(y<0?1:-1)*I,k=I<E/P;switch(e){case"top_left":{k?h=f+C:d=p+_;break}case"top_right":{k?h=f+C:p=d-_;break}case"bottom_right":{k?f=h-C:p=d-_;break}case"bottom_left":{k?f=h-C:d=p+_;break}case"bottom":case"top":{const D=(d+p)/2,T=P*I;d=D-T/2,p=D+T/2;break}case"left":case"right":{const D=(h+f)/2,T=E/I;h=D-T/2,f=D+T/2;break}}}if(x){const I=p;p=d,d=I}if(w){const I=f;f=h,h=I}const b=new Ve(d,h,Math.abs(p-d),Math.abs(f-h));return{box:b,scaleX:+(b.width/t.width*(y>0?1:-1)).toFixed(5),scaleY:+(b.height/t.height*(m>0?1:-1)).toFixed(5)}}equals(t){return Ve.Equals(this,t)}static Equals(t,e){return e.x===t.x&&e.y===t.y&&e.w===t.w&&e.h===t.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(t){return new Ve(t.x,t.y,Math.max(1,t.w),Math.max(1,t.h))}};g(Ve,"Collides",(t,e)=>!(t.maxX<e.minX||t.minX>e.maxX||t.maxY<e.minY||t.minY>e.maxY)),g(Ve,"Contains",(t,e)=>t.minX<e.minX&&t.minY<e.minY&&t.maxY>e.maxY&&t.maxX>e.maxX),g(Ve,"Includes",(t,e)=>Ve.Collides(t,e)||Ve.Contains(t,e)),g(Ve,"ContainsPoint",(t,e,s=0)=>!(e.x<t.minX-s||e.y<t.minY-s||e.x>t.maxX+s||e.y>t.maxY+s)),g(Ve,"Common",t=>{let e=1/0,s=1/0,r=-1/0,i=-1/0;for(let o=0;o<t.length;o++){const a=t[o];e=Math.min(e,a.minX),s=Math.min(s,a.minY),r=Math.max(r,a.maxX),i=Math.max(i,a.maxY)}return new Ve(e,s,r-e,i-s)}),g(Ve,"Sides",(t,e=0)=>{const{corners:s}=t;return[[s[0],s[1]],[s[1],s[2]],[s[2],s[3]],[s[3],s[0]]]});let Y=Ve;function JU(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function QU(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function e3(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}function t3(n){const t=N();v.useLayoutEffect(()=>{let e=new Y;function s(){const l=n.current;if(!l)return null;const d=l.getBoundingClientRect(),h=new Y(d.left||d.x,d.top||d.y,Math.max(d.width,1),Math.max(d.height,1));e.equals(h)||(t.updateViewportScreenBounds(h),e=h)}s();const r=J0(s,200,{trailing:!0}),i=t.timers.setInterval(r,1e3);window.addEventListener("resize",r);const o=new ResizeObserver(l=>{l[0].contentRect&&r()}),a=n.current;let c=null;return a&&(o.observe(a),c=n3(a),c.addEventListener("scroll",r)),()=>{clearInterval(i),window.removeEventListener("resize",r),o.disconnect(),c==null||c.removeEventListener("scroll",r),r.cancel()}},[t,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const n3=n=>{let t=n.parentElement;for(;t;){if(t===document.body)return document;const{overflowY:e}=window.getComputedStyle(t);if(t.scrollHeight>t.clientHeight&&(e==="auto"||e==="scroll"||e==="overlay"))return t;t=t.parentElement}return document},Ae=class Ae{constructor(t,e,s,r,i,o){g(this,"a",1);g(this,"b",0);g(this,"c",0);g(this,"d",1);g(this,"e",0);g(this,"f",0);this.a=t,this.b=e,this.c=s,this.d=r,this.e=i,this.f=o}equals(t){return this===t||this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(t){const e=t,{a:s,b:r,c:i,d:o,e:a,f:c}=this;return this.a=s*e.a+i*e.b,this.c=s*e.c+i*e.d,this.e=s*e.e+i*e.f+a,this.b=r*e.a+o*e.b,this.d=r*e.c+o*e.d,this.f=r*e.e+o*e.f+c,this}rotate(t,e,s){return t===0?this:e===void 0?this.multiply(Ae.Rotate(t)):this.translate(e,s).multiply(Ae.Rotate(t)).translate(-e,-s)}translate(t,e){return this.multiply(Ae.Translate(t,e))}scale(t,e){return this.multiply(Ae.Scale(t,e))}invert(){const{a:t,b:e,c:s,d:r,e:i,f:o}=this,a=t*r-e*s;return this.a=r/a,this.b=e/-a,this.c=s/-a,this.d=t/a,this.e=(r*i-s*o)/-a,this.f=(e*i-t*o)/a,this}applyToPoint(t){return Ae.applyToPoint(this,t)}applyToPoints(t){return Ae.applyToPoints(this,t)}rotation(){return Ae.Rotation(this)}point(){return Ae.Point(this)}decomposed(){return Ae.Decompose(this)}toCssString(){return Ae.toCssString(this)}setTo(t){return Object.assign(this,t),this}decompose(){return Ae.Decompose(this)}clone(){return new Ae(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Ae(1,0,0,1,0,0)}static Translate(t,e){return new Ae(1,0,0,1,t,e)}static Rotate(t,e,s){if(t===0)return Ae.Identity();const r=Math.cos(t),i=Math.sin(t),o=new Ae(r,i,-i,r,0,0);return e===void 0?o:Ae.Compose(Ae.Translate(e,s),o,Ae.Translate(-e,-s))}static Multiply(t,e){return{a:t.a*e.a+t.c*e.b,c:t.a*e.c+t.c*e.d,e:t.a*e.e+t.c*e.f+t.e,b:t.b*e.a+t.d*e.b,d:t.b*e.c+t.d*e.d,f:t.b*e.e+t.d*e.f+t.f}}static Inverse(t){const e=t.a*t.d-t.b*t.c;return{a:t.d/e,b:t.b/-e,c:t.c/-e,d:t.a/e,e:(t.d*t.e-t.c*t.f)/-e,f:(t.b*t.e-t.a*t.f)/e}}static Absolute(t){const e=t.a*t.d-t.b*t.c;return{a:t.d/e,b:t.b/-e,c:t.c/-e,d:t.a/e,e:(t.d*t.e-t.c*t.f)/e,f:(t.b*t.e-t.a*t.f)/-e}}static Compose(...t){const e=Ae.Identity();for(let s=0,r=t.length;s<r;s++)e.multiply(t[s]);return e}static Point(t){return new S(t.e,t.f)}static Rotation(t){let e;if(t.a!==0||t.c!==0){const s=(t.a*t.a+t.c*t.c)**.5;e=Math.acos(t.a/s)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const s=(t.b*t.b+t.d*t.d)**.5;e=Ue+Math.acos(t.b/s)*(t.d>0?-1:1)}else e=0;return cg(e)}static Decompose(t){let e,s,r;if(t.a!==0||t.c!==0){const i=(t.a*t.a+t.c*t.c)**.5;e=i,s=(t.a*t.d-t.b*t.c)/i,r=Math.acos(t.a/i)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const i=(t.b*t.b+t.d*t.d)**.5;e=(t.a*t.d-t.b*t.c)/i,s=i,r=Ue+Math.acos(t.b/i)*(t.d>0?-1:1)}else e=0,s=0,r=0;return{x:t.e,y:t.f,scaleX:e,scaleY:s,rotation:cg(r)}}static Smooth(t,e=1e10){return t.a=Math.round(t.a*e)/e,t.b=Math.round(t.b*e)/e,t.c=Math.round(t.c*e)/e,t.d=Math.round(t.d*e)/e,t.e=Math.round(t.e*e)/e,t.f=Math.round(t.f*e)/e,t}static toCssString(t){return`matrix(${$(t.a)}, ${$(t.b)}, ${$(t.c)}, ${$(t.d)}, ${$(t.e)}, ${$(t.f)})`}static applyToPoint(t,e){return new S(t.a*e.x+t.c*e.y+t.e,t.b*e.x+t.d*e.y+t.f,e.z)}static applyToXY(t,e,s){return[t.a*e+t.c*s+t.e,t.b*e+t.d*s+t.f]}static applyToPoints(t,e){return e.map(s=>new S(t.a*s.x+t.c*s.y+t.e,t.b*s.x+t.d*s.y+t.f,s.z))}static applyToBounds(t,e){return new Y(t.e+e.minX,t.f+e.minY,e.width,e.height)}static From(t){return new Ae(t.a,t.b,t.c,t.d,t.e,t.f)}static Cast(t){return t instanceof Ae?t:Ae.From(t)}};g(Ae,"Scale",(t,e,s,r)=>{const i=new Ae(t,0,0,e,0,0);return s===void 0?i:Ae.Compose(Ae.Translate(s,r),i,Ae.Translate(-s,-r))});let Q=Ae;function OI(n,t){return t===0?n:OI(t,n%t)}function RI(n){const t=n.toString().split(".")[1];if(!t)return 1;const e=Math.pow(10,t.length),s=parseInt(t,10);return e/OI(s,e)}class ti{constructor(t){g(this,"isFilled",!1);g(this,"isClosed",!0);g(this,"isLabel",!1);g(this,"debugColor");g(this,"ignore");g(this,"_vertices");g(this,"_bounds");g(this,"_area");g(this,"_length");this.isFilled=t.isFilled,this.isClosed=t.isClosed,this.isLabel=t.isLabel??!1,this.debugColor=t.debugColor,this.ignore=t.ignore}hitTestPoint(t,e=0,s=!1){return this.isClosed&&(this.isFilled||s)&&On(t,this.vertices)?!0:S.Dist2(t,this.nearestPoint(t))<=e*e}distanceToPoint(t,e=!1){return t.dist(this.nearestPoint(t))*(this.isClosed&&(this.isFilled||e)&&On(t,this.vertices)?-1:1)}distanceToLineSegment(t,e){if(t.equals(e))return this.distanceToPoint(t);const{vertices:s}=this;let r,i=1/0,o,a,c;for(let l=0;l<s.length;l++)a=s[l],c=S.NearestPointOnLineSegment(t,e,a,!0),o=S.Dist2(a,c),o<i&&(i=o,r=c);if(!r)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&On(r,this.vertices)?-i:i}hitTestLineSegment(t,e,s=0){return this.distanceToLineSegment(t,e)<=s}nearestPointOnLineSegment(t,e){const{vertices:s}=this;let r,i=1/0,o,a,c;for(let l=0;l<s.length;l++)a=s[l],c=S.NearestPointOnLineSegment(t,e,a,!0),o=S.Dist2(a,c),o<i&&(i=o,r=c);if(!r)throw Error("nearest point not found");return r}isPointInBounds(t,e=0){const{bounds:s}=this;return!(t.x<s.minX-e||t.y<s.minY-e||t.x>s.maxX+e||t.y>s.maxY+e)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return Y.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:t}=this;let e=0;for(let s=0,r=t.length;s<r;s++){const i=t[s],o=t[(s+1)%r];e+=i.x*o.y-o.x*i.y}return e/2}toSimpleSvgPath(){let t="";const{vertices:e}=this,s=e.length;if(s===0)return t;t+=`M${e[0].x},${e[0].y}`;for(let r=1;r<s;r++)t+=`L${e[r].x},${e[r].y}`;return this.isClosed&&(t+="Z"),t}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:t}=this;let e,s=t[0],r=0;for(let i=1;i<t.length;i++)e=t[i],r+=S.Dist2(s,e),s=e;return Math.sqrt(r)}}class ls extends ti{constructor(e){super({...e,isClosed:!0,isFilled:!1});g(this,"children",[]);g(this,"ignoredChildren",[]);for(const s of e.children)s.ignore?this.ignoredChildren.push(s):this.children.push(s);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let s=1/0,r;const{children:i}=this;if(i.length===0)throw Error("no children");let o,a;for(const c of i)o=c.nearestPoint(e),a=S.Dist2(o,e),a<s&&(s=a,r=o);if(!r)throw Error("nearest point not found");return r}distanceToPoint(e,s=!1){return Math.min(...this.children.map((r,i)=>r.distanceToPoint(e,s||i>0)))}hitTestPoint(e,s,r){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestPoint(e,s,r))}hitTestLineSegment(e,s,r){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestLineSegment(e,s,r))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const r of this.children)e+=r.toSimpleSvgPath();const s=Y.FromPoints(this.vertices).corners;for(let r=0,i=s.length;r<i;r++){const o=s[r],a=s[(r-1+i)%i],c=o.dist(a),l=s[(r+1)%i],d=o.dist(l),h=o.clone().lrp(a,4/c),p=o,f=o.clone().lrp(l,4/d);e+=`M${h.x},${h.y} L${p.x},${p.y} L${f.x},${f.y} `}return e}getLength(){return this.children.reduce((e,s)=>s.isLabel?e:e+s.length,0)}getSvgPathData(){return this.children.map((e,s)=>e.isLabel?"":e.getSvgPathData(s===0)).join(" ")}}function s3(n=!0){const[t,e]=v.useState(0),s=N();v.useEffect(()=>{if(!n)return;const r=()=>e(i=>i+1);return s.on("tick",r),()=>{s.off("tick",r)}},[s,n])}const r3=Cn(function({showStroke:t=!0,showVertices:e=!0,showClosestPointOnOutline:s=!0}){const r=N();s3(s);const i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:a}}=r;return u.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const l=r.getShape(c.id);if(l.type==="group")return null;const d=r.getShapeGeometry(l),h=r.getShapePageTransform(l),p=r.getPointInShapeSpace(l,a),f=d.nearestPoint(p),y=d.distanceToPoint(p,!0),m=Math.abs(y)*i,x=y<0,{vertices:w}=d;return u.jsxs("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[t&&u.jsx("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/i,fill:"none",children:u.jsx(LI,{geometry:d})}),e&&w.map((b,I)=>u.jsx("circle",{cx:b.x,cy:b.y,r:2/i,fill:`hsl(${$o(I,[0,w.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/i},`v${I}`)),s&&m<150&&u.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-m/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/i})]},c.id+"_outline")})})});function LI({geometry:n}){return n instanceof ls?u.jsx(u.Fragment,{children:[...n.children,...n.ignoredChildren].map((t,e)=>u.jsx(LI,{geometry:t},e))}):u.jsx("path",{d:n.toSimpleSvgPath()})}function $I(n){return dN(n)}function i3(){const n=N(),t=nB("userIds",()=>$I(n.getCollaborators().map(e=>e.userId)).sort(),{isEqual:(e,s)=>{var r;return e.join(",")===((r=s.join)==null?void 0:r.call(s,","))}},[n]);return z(t)}function FI(n){const t=N();return z(`latestPresence:${n}`,()=>t.getCollaborators().find(s=>s.userId===n),[t,n])??null}const o3=Cn(function(){const t=i3();return u.jsx(u.Fragment,{children:t.map(e=>u.jsx(a3,{collaboratorId:e},e))})}),a3=Cn(function({collaboratorId:t}){const e=N(),s=FI(t),r=l3(e,s);if(!(s&&s.currentPageId===e.getCurrentPageId()))return null;switch(r){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=e.getInstanceState();if(!(i===s.userId||o.includes(s.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=e.getInstanceState();if(s.followingUserId===e.user.getId()&&!(s.chatMessage||i.includes(s.userId)))return null;break}}return u.jsx(c3,{latestPresence:s})}),c3=Cn(function({latestPresence:t}){const e=N(),{CollaboratorBrush:s,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:a}=tt(),c=e.getZoomLevel(),l=e.getViewportPageBounds(),{userId:d,chatMessage:h,brush:p,scribbles:f,selectedShapeIds:y,userName:m,cursor:x,color:w}=t,b=!(x.x<l.minX-12/c||x.y<l.minY-16/c||x.x>l.maxX-12/c||x.y>l.maxY-16/c);return u.jsxs(u.Fragment,{children:[p&&s?u.jsx(s,{className:"tl-collaborator__brush",brush:p,color:w,opacity:.1},d+"_brush"):null,b&&i?u.jsx(i,{className:"tl-collaborator__cursor",point:x,color:w,zoom:c,name:m!=="New User"?m:null,chatMessage:h},d+"_cursor"):o?u.jsx(o,{className:"tl-collaborator__cursor-hint",point:x,color:w,zoom:c,viewport:l},d+"_cursor_hint"):null,r&&f.length?u.jsx(u.Fragment,{children:f.map(I=>u.jsx(r,{className:"tl-collaborator__scribble",scribble:I,color:w,zoom:c,opacity:I.color==="laser"?.5:.1},d+"_scribble_"+I.id))}):null,a&&y.map(I=>u.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:I,color:w,opacity:.5},d+"_"+I))]})});function Kx(n,t){return t>n.options.collaboratorInactiveTimeoutMs?"inactive":t>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function l3(n,t){const e=v.useRef((t==null?void 0:t.lastActivityTimestamp)??-1),[s,r]=v.useState(()=>Kx(n,Date.now()-e.current));return v.useEffect(()=>{const i=n.timers.setInterval(()=>{r(Kx(n,Date.now()-e.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(i)},[n]),t&&(e.current=t.lastActivityTimestamp),s}const NI=v.memo(function({id:t,shape:e,util:s,index:r,backgroundIndex:i,opacity:o,dprMultiple:a}){const c=N(),{ShapeErrorFallback:l}=tt(),d=v.useRef(null),h=v.useRef(null),p=v.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Fr("set shape stuff",()=>{const m=c.getShape(t);if(!m)return;const x=p.current,w=c.getShapeClipPath(t)??"none";w!==x.clipPath&&(Ut(d.current,"clip-path",w),Ut(h.current,"clip-path",w),x.clipPath=w);const b=c.getShapePageTransform(t),I=Q.toCssString(b),E=c.getShapeGeometry(m).bounds;I!==x.transform&&(Ut(d.current,"transform",I),Ut(h.current,"transform",I),x.transform=I);const P=E.w%a,C=E.h%a,_=P===0?E.w:E.w+(a-P),k=C===0?E.h:E.h+(a-C);(_!==x.width||k!==x.height)&&(Ut(d.current,"width",Math.max(_,a)+"px"),Ut(d.current,"height",Math.max(k,a)+"px"),Ut(h.current,"width",Math.max(_,a)+"px"),Ut(h.current,"height",Math.max(k,a)+"px"),x.width=_,x.height=k)},[c]),Fr("set opacity and z-index",()=>{const m=d.current,x=h.current;Ut(m,"opacity",o),Ut(x,"opacity",o),Ut(m,"z-index",r),Ut(x,"z-index",i)},[o,r,i]),Fr("set display",()=>{if(!c.getShape(t))return;const w=c.getCulledShapes().has(t);w!==p.current.isCulled&&(Ut(d.current,"display",w?"none":"block"),Ut(h.current,"display",w?"none":"block"),p.current.isCulled=w)},[c]);const f=v.useCallback(m=>c.annotateError(m,{origin:"shape",willCrashApp:!1}),[c]);if(!e)return null;const y="fill"in e.props&&e.props.fill!=="none";return u.jsxs(u.Fragment,{children:[s.backgroundComponent&&u.jsx("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":e.type,draggable:!1,children:u.jsx(ac,{fallback:l,onError:f,children:u.jsx(u3,{shape:e,util:s})})}),u.jsx("div",{ref:d,className:"tl-shape","data-shape-type":e.type,"data-shape-is-filled":y,draggable:!1,children:u.jsx(ac,{fallback:l,onError:f,children:u.jsx(d3,{shape:e,util:s})})})]})}),d3=v.memo(function({shape:t,util:e}){return Xu("InnerShape:"+t.type,()=>e.component(e.editor.store.unsafeGetWithoutCapture(t.id)))},(n,t)=>n.shape.props===t.shape.props&&n.shape.meta===t.shape.meta),u3=v.memo(function({shape:t,util:e}){return Xu("InnerShape:"+t.type,()=>{var s;return(s=e.backgroundComponent)==null?void 0:s.call(e,e.editor.store.unsafeGetWithoutCapture(t.id))})},(n,t)=>n.shape.props===t.shape.props&&n.shape.meta===t.shape.meta);function h3({className:n}){const t=N(),{Background:e,SvgDefs:s}=tt(),r=v.useRef(null),i=v.useRef(null),o=v.useRef(null),a=Qt();t3(r),Kz(),Uz(),qU(r),Vz(r);const c=v.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Fr("position layers",function(){const{x:w,y:b,z:I}=t.getCamera();if(c.current.allowTextOutline&&t.environment.isSafari&&(a.style.setProperty("--tl-text-outline","none"),c.current.allowTextOutline=!1),c.current.allowTextOutline&&I<t.options.textShadowLod!==c.current.lodDisableTextOutline){const C=I<t.options.textShadowLod;a.style.setProperty("--tl-text-outline",C?"none":"var(--tl-text-outline-reference)"),c.current.lodDisableTextOutline=C}const E=I>=1?$o(I,[1,8],[.125,.5],!0):$o(I,[.1,1],[-2,.125],!0),P=`scale(${$(I)}) translate(${$(w+E)}px,${$(b+E)}px)`;Ut(i.current,"transform",P),Ut(o.current,"transform",P)},[t,a]);const l=zz(),d=z("shapeSvgDefs",()=>{const x=new Map;for(const w of lt(t.shapeUtils)){if(!w)return;const b=w.getCanvasSvgDefs();for(const{key:I,component:E}of b)x.has(I)||x.set(I,u.jsx(E,{},I))}return[...x.values()]},[t]),h=z("debug_shapes",()=>ft.hideShapes.get(),[ft]),p=z("debug_svg",()=>ft.debugSvg.get(),[ft]),f=z("debug_geometry",()=>ft.debugGeometry.get(),[ft]),y=z("isEditingAnything",()=>t.getEditingShapeId()!==null,[t]),m=z("isSelectingAnything",()=>!!t.getSelectedShapeIds().length,[t]);return u.jsxs("div",{ref:r,draggable:!1,"data-iseditinganything":y,"data-isselectinganything":m,className:se("tl-canvas",n),"data-testid":"canvas",...l,children:[u.jsx("svg",{className:"tl-svg-context",children:u.jsxs("defs",{children:[d,u.jsx(E3,{}),u.jsx(_3,{}),s&&u.jsx(s,{})]})}),e&&u.jsx("div",{className:"tl-background__wrapper",children:u.jsx(e,{})}),u.jsx(p3,{}),u.jsxs("div",{ref:i,className:"tl-html-layer tl-shapes",draggable:!1,children:[u.jsx(A3,{}),u.jsx(M3,{}),h?null:p?u.jsx(b3,{}):u.jsx(C3,{})]}),u.jsx("div",{className:"tl-overlays",children:u.jsxs("div",{ref:o,className:"tl-html-layer",children:[f?u.jsx(r3,{}):null,u.jsx(S3,{}),u.jsx(g3,{}),u.jsx(f3,{}),u.jsx(m3,{}),u.jsx(I3,{}),u.jsx(P3,{}),u.jsx(y3,{}),u.jsx(k3,{}),u.jsx(o3,{})]})}),u.jsx(j3,{})]})}function p3(){const n=N(),t=z("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:e,y:s,z:r}=z("camera",()=>n.getCamera(),[n]),i=z("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:o}=tt();return o&&i?u.jsx(o,{x:e,y:s,z:r,size:t}):null}function f3(){const n=N(),t=z("scribbles",()=>n.getInstanceState().scribbles,[n]),e=z("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:s}=tt();return s&&t.length?u.jsx(u.Fragment,{children:t.map(r=>u.jsx(s,{className:"tl-user-scribble",scribble:r,zoom:e},r.id))}):null}function g3(){const n=N(),t=z("brush",()=>n.getInstanceState().brush,[n]),{Brush:e}=tt();return e&&t?u.jsx(e,{className:"tl-user-brush",brush:t}):null}function m3(){const n=N(),t=z("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:e}=tt();return e&&t?u.jsx(e,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function y3(){const n=N(),t=z("snapLines",()=>n.snaps.getIndicators(),[n]),e=z("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:s}=tt();return s&&t.length>0?u.jsx(u.Fragment,{children:t.map(r=>u.jsx(s,{className:"tl-user-snapline",line:r,zoom:e},r.id))}):null}function S3(){const n=N(),t=z("handles shapeIdWithHandles",()=>{const{isReadonly:e,isChangingStyle:s}=n.getInstanceState();if(e||s)return!1;const r=n.getOnlySelectedShape();return!r||!n.getShapeHandles(r)?!1:r.id},[n]);return t?u.jsx(w3,{shapeId:t}):null}function w3({shapeId:n}){const t=N(),{Handles:e}=tt(),s=z("zoomLevel",()=>t.getZoomLevel(),[t]),r=z("coarse pointer",()=>t.getInstanceState().isCoarsePointer,[t]),i=z("handles transform",()=>t.getShapePageTransform(n),[t,n]),o=z("handles",()=>{const a=t.getShapeHandles(n);if(!a)return null;const c=(r?t.options.coarseHandleRadius:t.options.handleRadius)/s*2;return a.filter(l=>l.type!=="virtual"||!a.some(d=>d!==l&&d.type==="vertex"&&S.Dist(l,d)<c)).sort(l=>l.type==="vertex"?1:-1)},[t,s,r,n]);return!e||!o||!i?null:u.jsx(e,{children:u.jsx("g",{transform:Q.toCssString(i),children:o.map(a=>u.jsx(x3,{shapeId:n,handle:a,zoom:s,isCoarse:r},a.id))})})}function x3({shapeId:n,handle:t,zoom:e,isCoarse:s}){const r=ZU(n,t.id),{Handle:i}=tt();return i?u.jsx("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...r,children:u.jsx(i,{shapeId:n,handle:t,zoom:e,isCoarse:s})}):null}function b3(){const n=N(),t=z("rendering shapes",()=>n.getRenderingShapes(),[n]),e=z("dpr multiple",()=>RI(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return u.jsx(u.Fragment,{children:t.map(s=>u.jsxs(v.Fragment,{children:[u.jsx(NI,{...s,dprMultiple:e}),u.jsx(T3,{id:s.id})]},s.id+"_fragment"))})}function v3(){const n=N(),t=v.useRef(new Set);return Fr("reflow for culled shapes",()=>{const e=n.getCulledShapes();if(t.current.size===e.size&&[...e].every(r=>t.current.has(r)))return;t.current=e;const s=document.getElementsByClassName("tl-canvas");s.length!==0&&s[0].offsetHeight},[n]),null}function C3(){const n=N(),t=z("rendering shapes",()=>n.getRenderingShapes(),[n]),e=z("dpr multiple",()=>RI(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return u.jsxs(u.Fragment,{children:[t.map(s=>u.jsx(NI,{...s,dprMultiple:e},s.id+"_shape")),n.environment.isSafari&&u.jsx(v3,{})]})}function I3(){const n=N(),t=z("rendering shapes",()=>n.getRenderingShapes(),[n]),e=v.useRef(new Set),s=z("should display selected ids",()=>{const i=e.current,o=new Set;if(n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!n.getInstanceState().isChangingStyle){const a=n.getSelectedShapeIds();for(const c of a)o.add(c);if(n.isInAny("select.idle","select.editing_shape")){const c=n.getInstanceState();if(c.isHoveringCanvas&&!c.isCoarsePointer){const l=n.getHoveredShapeId();l&&o.add(l)}}}if(i.size!==o.size)return e.current=o,o;for(const a of o)if(!i.has(a))return e.current=o,o;return i},[n]),{ShapeIndicator:r}=tt();return r?u.jsx(u.Fragment,{children:t.map(({id:i})=>u.jsx(r,{shapeId:i,hidden:!s.has(i)},i+"_indicator"))}):null}function P3(){const n=N(),{ShapeIndicator:t}=tt(),e=z("hinting shape ids",()=>Mm(n.getHintingShapeIds()),[n]);return!e.length||!t?null:u.jsx(u.Fragment,{children:e.map(s=>u.jsx(t,{className:"tl-user-indicator__hint",shapeId:s},s+"_hinting"))})}function E3(){return u.jsxs("g",{id:"cursor",children:[u.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[u.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),u.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),u.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[u.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),u.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),u.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[u.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),u.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function _3(){return u.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function T3({id:n}){const t=N(),[e,s]=v.useState(null),r=z("is in root",()=>{const i=t.getShape(n);return(i==null?void 0:i.parentId)===t.getCurrentPageId()},[t,n]);return v.useEffect(()=>{if(!r)return;let i=null;const o=ei("shape to svg",async()=>{const a=Math.random();i=a;const l=t.isShapeOfType(n,"frame")?0:10;let d=t.getShapePageBounds(n);if(!d)return;d=d.clone().expandBy(l);const h=await t.getSvgString([n],{padding:l,background:t.getInstanceState().exportBackground});if(i!==a||!h)return;const p=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;s({src:p,bounds:d})});return()=>{i=null,o()}},[t,n,r]),!r||!e?null:u.jsx("img",{src:e.src,width:e.bounds.width,height:e.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${e.bounds.x}px, ${e.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function k3(){const n=N(),t=z("selection rotation",()=>n.getSelectionRotation(),[n]),e=z("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:s}=tt();return!e||!s?null:u.jsx(s,{bounds:e,rotation:t})}function M3(){const n=N(),t=z("selection rotation",()=>n.getSelectionRotation(),[n]),e=z("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:s}=tt();return!e||!s?null:u.jsx(s,{bounds:e,rotation:t})}function A3(){const{OnTheCanvas:n}=tt();return n?u.jsx(n,{}):null}function j3(){const n=N(),t=z("camera state",()=>n.getCameraState(),[n]);return u.jsx("div",{className:se("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":t==="idle"})})}function D3({className:n,zoom:t,point:e,color:s,viewport:r,opacity:i=1}){const o=v.useRef(null);return ia(o,bt(e.x,r.minX+5/t,r.maxX-5/t),bt(e.y,r.minY+5/t,r.maxY-5/t),1/t,S.Angle(r.center,e)),u.jsxs("svg",{ref:o,className:se("tl-overlays__item",n),children:[u.jsx("use",{href:"#cursor_hint",color:s,strokeWidth:3,stroke:"var(--color-background)"}),u.jsx("use",{href:"#cursor_hint",color:s,opacity:i})]})}const Gx=v.memo(function({className:t,zoom:e,point:s,color:r,name:i,chatMessage:o}){const a=v.useRef(null);return ia(a,s==null?void 0:s.x,s==null?void 0:s.y,1/e),s?u.jsxs("div",{ref:a,className:se("tl-overlays__item",t),children:[u.jsx("svg",{className:"tl-cursor",children:u.jsx("use",{href:"#cursor",color:r})}),o?u.jsxs(u.Fragment,{children:[i&&u.jsx("div",{className:"tl-nametag-title",style:{color:r},children:i}),u.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&u.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null});function O3({x:n,y:t,z:e,size:s}){const r=N(),{gridSteps:i}=r.options;return u.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[u.jsx("defs",{children:i.map(({min:o,mid:a,step:c},l)=>{const d=c*s*e,h=.5+n*e,p=.5+t*e,f=h>0?h%d:d+h%d,y=p>0?p%d:d+p%d,m=e<a?$o(e,[o,a],[0,1]):1;return u.jsx("pattern",{id:`grid-${c}`,width:d,height:d,patternUnits:"userSpaceOnUse",children:u.jsx("circle",{className:"tl-grid-dot",cx:f,cy:y,r:1,opacity:m})},`grid-pattern-${l}`)})}),i.map(({step:o},a)=>u.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${o})`},`grid-rect-${a}`))]})}function R3({handle:n,isCoarse:t,className:e,zoom:s}){const r=N(),i=(t?r.options.coarseHandleRadius:r.options.handleRadius)/s;if(n.type==="clone"){const a=3/s,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,l=Rz.indexOf(n.id);return u.jsxs("g",{className:se(`tl-handle tl-handle__${n.type}`,e),children:[u.jsx("circle",{className:"tl-handle__bg",r:i}),u.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*l})`})]})}const o=(n.type==="create"&&t?3:4)/Math.max(s,.25);return u.jsxs("g",{className:se(`tl-handle tl-handle__${n.type}`,e),children:[u.jsx("circle",{className:"tl-handle__bg",r:i}),u.jsx("circle",{className:"tl-handle__fg",r:o})]})}const L3=({children:n})=>u.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),$3=()=>{const{Spinner:n}=tt();return u.jsx(uy,{children:n?u.jsx(n,{}):null})};function Zm(n,t=!0){const e=n.length;if(e<2)return"";let s=n[0],r=n[1];if(e===2)return`M${Pe(s)}L${Pe(r)}`;let i="";for(let o=2,a=e-1;o<a;o++)s=n[o],r=n[o+1],i+=fn(s,r);return t?`M${fn(n[0],n[1])}Q${Pe(n[1])}${fn(n[1],n[2])}T${i}${fn(n[e-1],n[0])}${fn(n[0],n[1])}Z`:`M${Pe(n[0])}Q${Pe(n[1])}${fn(n[1],n[2])}${n.length>3?"T":""}${i}L${Pe(n[e-1])}`}function Wx({scribble:n,zoom:t,color:e,opacity:s,className:r}){return n.points.length?u.jsx("svg",{className:r&&se("tl-overlays__item",r),children:u.jsx("path",{className:"tl-scribble",d:Zm(n.points,!1),stroke:e??`var(--color-${n.color})`,fill:"none",strokeWidth:8/t,opacity:s??n.opacity})}):null}function BI({bounds:n,rotation:t}){const e=v.useRef(null);return ia(e,n.x,n.y,1,t),v.useLayoutEffect(()=>{const s=e.current;s&&(s.style.width=$(Math.max(1,n.width))+"px",s.style.height=$(Math.max(1,n.height))+"px")},[n.width,n.height]),u.jsx("div",{ref:e,className:"tl-selection__bg",draggable:!1})}function F3({bounds:n,rotation:t}){const e=N(),s=v.useRef(null),r=z("only selected shape",()=>e.getOnlySelectedShape(),[e]),i=r?e.getShapeUtil(r).expandSelectionOutlinePx(r):0;return ia(s,n==null?void 0:n.x,n==null?void 0:n.y,1,t,{x:-i,y:-i}),n=n.clone().expandBy(i).zeroFix(),u.jsx("svg",{ref:s,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:u.jsx("rect",{className:se("tl-selection__fg__outline"),width:$(n.width),height:$(n.height)})})}const N3=()=>u.jsx("div",{className:"tl-shape-error-boundary"}),B3=({shape:n,util:t})=>Xu("Indicator: "+n.type,()=>t.indicator(t.editor.store.unsafeGetWithoutCapture(n.id))),z3=({editor:n,id:t})=>{const e=z("shape for indicator",()=>n.store.get(t),[n,t]),{ShapeIndicatorErrorFallback:s}=tt();return!e||e.isLocked?null:u.jsx(ac,{fallback:s,onError:r=>n.annotateError(r,{origin:"react.shapeIndicator",willCrashApp:!1}),children:u.jsx(B3,{shape:e,util:n.getShapeUtil(e)},e.id)})},Vx=v.memo(function({shapeId:t,className:e,color:s,hidden:r,opacity:i}){const o=N(),a=v.useRef(null);return Fr("indicator transform",()=>{const c=a.current;if(!c)return;const l=o.getShapePageTransform(t);l&&c.style.setProperty("transform",l.toCssString())},[o,t]),v.useLayoutEffect(()=>{const c=a.current;c&&c.style.setProperty("display",r?"none":"block")},[r]),u.jsx("svg",{ref:a,className:se("tl-overlays__item",e),children:u.jsx("g",{className:"tl-shape-indicator",stroke:s??"var(--color-selected)",opacity:i,children:u.jsx(z3,{editor:o,id:t})})})}),U3=()=>u.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function H3({points:n,zoom:t}){const e=2.5/t,s=n.reduce((p,f)=>Math.min(p,f.x),1/0),r=n.reduce((p,f)=>Math.max(p,f.x),-1/0),i=n.reduce((p,f)=>Math.min(p,f.y),1/0),o=n.reduce((p,f)=>Math.max(p,f.y),-1/0),a=n.some(p=>p.x===s&&p.y===i);let c,l,d,h;return a?(c=s,l=i,d=r,h=o):(c=s,l=o,d=r,h=i),u.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[u.jsx("line",{x1:c,y1:l,x2:d,y2:h}),n.map((p,f)=>u.jsx("g",{transform:`translate(${p.x},${p.y})`,children:u.jsx("path",{className:"tl-snap-point",d:`M ${-e},${-e} L ${e},${e} M ${-e},${e} L ${e},${-e}`})},f))]})}function K3({gaps:n,direction:t,zoom:e}){const s=3.5/e;let r=[-1/0,1/0],i=null;const o=t==="horizontal";for(const c of n){if(i=ns(r[0],r[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),i)r=i;else continue;if(i=ns(r[0],r[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),i)r=i;else continue}if(r===null)return null;const a=(r[0]+r[1])/2;return u.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:c,endEdge:l},d)=>u.jsx(v.Fragment,{children:o?u.jsxs(u.Fragment,{children:[u.jsx("line",{x1:c[0].x,y1:a-2*s,x2:c[1].x,y2:a+2*s}),u.jsx("line",{x1:l[0].x,y1:a-2*s,x2:l[1].x,y2:a+2*s}),u.jsx("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),u.jsx("line",{x1:(c[0].x+l[0].x)/2,y1:a-s,x2:(c[0].x+l[0].x)/2,y2:a+s})]}):u.jsxs(u.Fragment,{children:[u.jsx("line",{x1:a-2*s,y1:c[0].y,x2:a+2*s,y2:c[1].y}),u.jsx("line",{x1:a-2*s,y1:l[0].y,x2:a+2*s,y2:l[1].y}),u.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),u.jsx("line",{x1:a-s,y1:(c[0].y+l[0].y)/2,x2:a+s,y2:(c[0].y+l[0].y)/2})]})},d))})}function G3({className:n,line:t,zoom:e}){return u.jsx("svg",{className:se("tl-overlays__item",n),children:t.type==="points"?u.jsx(H3,{...t,zoom:e}):t.type==="gaps"?u.jsx(K3,{...t,zoom:e}):null})}function Jm(){return u.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:u.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[u.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),u.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:u.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const W3=()=>null;function zI(n,t){const e=v.useRef(n);return t(n,e.current)?e.current:(e.current=n,n)}function Wa(n){return zI(n,pN)}function Qm(n){return zI(n,uC)}const UI=v.createContext(null);function V3({overrides:n={},children:t}){const e=Qm(n);return u.jsx(UI.Provider,{value:v.useMemo(()=>({Background:Tz,SvgDefs:W3,Brush:xp,ZoomBrush:xp,CollaboratorBrush:xp,Cursor:Gx,CollaboratorCursor:Gx,CollaboratorHint:D3,CollaboratorShapeIndicator:Vx,Grid:O3,Scribble:Wx,SnapIndicator:G3,Handles:L3,Handle:R3,CollaboratorScribble:Wx,ErrorFallback:KI,ShapeErrorFallback:N3,ShapeIndicatorErrorFallback:U3,Spinner:Jm,SelectionBackground:BI,SelectionForeground:F3,ShapeIndicator:Vx,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:h3,LoadingScreen:$3,...e}),[e]),children:t})}function tt(){const n=v.useContext(UI);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const ey={openWindow:(n,t)=>window.open(n,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function HI(){ey.hardReset()}function Y3(){ey.refreshPage()}const X3="https://github.com/tldraw/tldraw/issues/new",KI=({error:n,editor:t})=>{const e=v.useRef(null),[s,r]=v.useState(!1),[i,o]=v.useState(!1),[a,c]=v.useState(!1);let l=null;try{l=tt().Canvas??null}catch{}const d=n instanceof Error?n.message:String(n),h=n instanceof Error?n.stack:null,p=z("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[f,y]=v.useState(null);v.useLayoutEffect(()=>{var P;p!==null&&y(p);let I=(P=e.current)==null?void 0:P.parentElement,E=!1;for(;I;){if(I.classList.contains("tl-theme__dark")||I.classList.contains("tl-theme__light")){E=!0;break}I=I.parentElement}if(E){y(null);return}y(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),v.useEffect(()=>{if(i){const I=t==null?void 0:t.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(I)}},[i,t]);const m=()=>{const I=document.createElement("textarea");I.value=h??d,document.body.appendChild(I),I.select(),document.execCommand("copy"),I.remove(),o(!0)},x=()=>{Y3()},w=async()=>{HI()},b=new URL(X3);return b.searchParams.set("title",d),b.searchParams.set("labels","bug"),b.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??d}
\`\`\`

My browser: ${navigator.userAgent}`),u.jsxs("div",{ref:e,className:se("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[u.jsx("div",{className:"tl-error-boundary__overlay"}),t&&u.jsx(wI,{onError:Qd,fallback:()=>null,children:u.jsx(eh.Provider,{value:t,children:u.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:l?u.jsx(l,{}):null})})}),u.jsx("div",{className:se("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":s&&!a}),children:a?u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Are you sure?"}),u.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),u.jsxs("div",{className:"tl-error-boundary__content__actions",children:[u.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),u.jsx("button",{className:"tl-error-boundary__reset",onClick:w,children:"Reset data"})]})]}):u.jsxs(u.Fragment,{children:[u.jsx("h2",{children:"Something's gone wrong."}),u.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",u.jsx("a",{href:b.toString(),children:"create a GitHub issue"})," or"," ",u.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),s&&u.jsxs(u.Fragment,{children:["Message:",u.jsx("h4",{children:u.jsx("code",{children:d})}),"Stack trace:",u.jsxs("div",{className:"tl-error-boundary__content__error",children:[u.jsx("pre",{children:u.jsx("code",{children:h??d})}),u.jsx("button",{onClick:m,children:i?"Copied!":"Copy"})]})]}),u.jsxs("div",{className:"tl-error-boundary__content__actions",children:[u.jsx("button",{onClick:()=>r(!s),children:s?"Hide details":"Show details"}),u.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[u.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),u.jsx("button",{className:"tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})};function Qe(){return Ac()}const GI="TLDRAW_USER_DATA_v3",WI=ye({id:he,name:he.nullable().optional(),locale:he.nullable().optional(),color:he.nullable().optional(),colorScheme:Ju("light","dark","system").optional(),animationSpeed:ae.nullable().optional(),edgeScrollSpeed:ae.nullable().optional(),isSnapMode:we.nullable().optional(),isWrapMode:we.nullable().optional(),isDynamicSizeMode:we.nullable().optional()}),_r={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7},ty=Math.max(...Object.values(_r));function q3(n){n.version<_r.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<_r.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<_r.MakeFieldsNullable,n.version<_r.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<_r.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<_r.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<_r.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version=ty}const Yx=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function Z3(){return Yx[Math.floor(Math.random()*Yx.length)]}function J3(){var n,t;return typeof window>"u"?!1:((t=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:t.matches)??!1}const xs=Object.freeze({name:"New User",locale:Iz(),color:Z3(),edgeScrollSpeed:1,animationSpeed:J3()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1});function Pp(){return{id:Qe()}}function VI(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return Pp();const t=Je(n);q3(t);try{return WI.validate(t.user)}catch{return Pp()}}function Q3(){const n=JSON.parse(Dm(GI)||"null")??null;return VI(n)}const cc=Ct("globalUserData",null);function e5(){Om(GI,JSON.stringify({version:ty,user:cc.get()}))}function YI(n){WI.validate(n),cc.set(n),e5(),n5()}const t5=typeof process<"u"&&!1,To=typeof BroadcastChannel<"u"&&!t5?new BroadcastChannel("tldraw-user-sync"):null;To==null||To.addEventListener("message",n=>{const t=n.data;(t==null?void 0:t.type)===qI&&(t==null?void 0:t.origin)!==XI()&&cc.set(VI(t.data))});let Ep=null;function XI(){return Ep===null&&(Ep=Qe()),Ep}const qI="tldraw-user-preferences-change";function n5(){To==null||To.postMessage({type:qI,origin:XI(),data:{user:ny(),version:ty}})}function ny(){let n=cc.get();return n||(n=Q3(),cc.set(n)),n}function ZI(n={}){return{derivePresenceState:n.derivePresenceState??(()=>K("presence",()=>null)),userPreferences:n.userPreferences??K("userPreferences",()=>ny()),setUserPreferences:n.setUserPreferences??YI}}var JI={exports:{}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function i(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new r(d,h||c,p),y=e?e+l:l;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],f]:c._events[y].push(f):(c._events[y]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new s:delete c._events[l]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)t.call(d,h)&&l.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=e?e+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,y=new Array(f);p<f;p++)y[p]=h[p].fn;return y},a.prototype.listenerCount=function(l){var d=e?e+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,f,y){var m=e?e+l:l;if(!this._events[m])return!1;var x=this._events[m],w=arguments.length,b,I;if(x.fn){switch(x.once&&this.removeListener(l,x.fn,void 0,!0),w){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,h),!0;case 4:return x.fn.call(x.context,d,h,p),!0;case 5:return x.fn.call(x.context,d,h,p,f),!0;case 6:return x.fn.call(x.context,d,h,p,f,y),!0}for(I=1,b=new Array(w-1);I<w;I++)b[I-1]=arguments[I];x.fn.apply(x.context,b)}else{var E=x.length,P;for(I=0;I<E;I++)switch(x[I].once&&this.removeListener(l,x[I].fn,void 0,!0),w){case 1:x[I].fn.call(x[I].context);break;case 2:x[I].fn.call(x[I].context,d);break;case 3:x[I].fn.call(x[I].context,d,h);break;case 4:x[I].fn.call(x[I].context,d,h,p);break;default:if(!b)for(P=1,b=new Array(w-1);P<w;P++)b[P-1]=arguments[P];x[I].fn.apply(x[I].context,b)}}return!0},a.prototype.on=function(l,d,h){return i(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return i(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var f=e?e+l:l;if(!this._events[f])return this;if(!d)return o(this,f),this;var y=this._events[f];if(y.fn)y.fn===d&&(!p||y.once)&&(!h||y.context===h)&&o(this,f);else{for(var m=0,x=[],w=y.length;m<w;m++)(y[m].fn!==d||p&&!y[m].once||h&&y[m].context!==h)&&x.push(y[m]);x.length?this._events[f]=x.length===1?x[0]:x:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=e?e+l:l,this._events[d]&&o(this,d)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a})(JI);var s5=JI.exports;const r5=ur(s5),ko="TLDRAW_TAB_ID_v2",_s=globalThis.window;function i5(){return _s?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(_s.navigator.platform)||_s.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const Su=_s?_s[ko]??mC(ko)??"TLDRAW_INSTANCE_STATE_V1_"+Qe():"<error>";_s&&(_s[ko]=Su,i5()?Rm(ko,Su):yC(ko));_s==null||_s.addEventListener("beforeunload",()=>{Rm(ko,Su)});const QI={Initial:0},th=Math.max(...Object.values(QI));function o5(n){n.version<QI.Initial,n.version=th}const eP=ye({version:ae,currentPageId:sc,isFocusMode:we,exportBackground:we,isDebugMode:we,isToolLocked:we,isGridMode:we,pageStates:jt(ye({pageId:sc,camera:ye({x:ae,y:ae,z:ae}),selectedShapeIds:jt(Kn),focusedGroupId:Kn.nullable()}))});function a5(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==th&&(n=Je(n),o5(n));try{return eP.validate(n)}catch(t){return console.warn(t),null}}function tP(n){const t=n.query.ids("page");return K("sessionStateSnapshot",()=>{const e=n.get(Yt);if(!e)return null;const s=[...t.get()];return{version:th,currentPageId:e.currentPageId,exportBackground:e.exportBackground,isFocusMode:e.isFocusMode,isDebugMode:e.isDebugMode,isToolLocked:e.isToolLocked,isGridMode:e.isGridMode,pageStates:s.map(r=>{const i=n.get(Xn.createId(r)),o=n.get(is.createId(r));return{pageId:r,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(i==null?void 0:i.selectedShapeIds)??[],focusedGroupId:(i==null?void 0:i.focusedGroupId)??null}})}})}function nP(n,t){const e=a5(t);if(!e)return;const s=n.schema.types.instance.create({id:Yt,...VC(n.get(Yt)),currentPageId:e.currentPageId,isDebugMode:e.isDebugMode,isFocusMode:e.isFocusMode,isToolLocked:e.isToolLocked,isGridMode:e.isGridMode,exportBackground:e.exportBackground}),r=n.allRecords().filter(i=>i.typeName==="instance_page_state"||i.typeName==="camera");n.atomic(()=>{n.remove(r.map(i=>i.id));for(const i of e.pageStates)n.put([is.create({id:is.createId(i.pageId),x:i.camera.x,y:i.camera.y,z:i.camera.z}),Xn.create({id:Xn.createId(i.pageId),pageId:i.pageId,selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId})]);n.put([s]),n.ensureStoreIsUsable()})}function c5(n){var r;const t=[];for(const i of Object.values(n))(r=i.typeName)!=null&&r.match(/^(instance.*|pointer|camera)$/)&&t.push(i);const e=t.filter(i=>i.typeName==="instance"&&i.id!==Yt)[0];if(!e)return null;const s={version:th,currentPageId:e.currentPageId,exportBackground:!!e.exportBackground,isFocusMode:!!e.isFocusMode,isDebugMode:!!e.isDebugMode,isToolLocked:!!e.isToolLocked,isGridMode:!1,pageStates:t.filter(i=>i.typeName==="instance_page_state"&&i.instanceId===e.id).map(i=>{const o=n[i.cameraId]??{x:0,y:0,z:1};return{pageId:i.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId}})};try{return eP.validate(s),s}catch{return null}}function sP(n,t){let e={};if("store"in t){const r=n.schema.migrateStoreSnapshot(t);if(r.type!=="success")throw new Error("Failed to migrate store snapshot: "+r.reason);e.document={schema:n.schema.serialize(),store:Ha(r.value,(i,{typeName:o})=>n.scopedTypes.document.has(o))}}else e=t;const s=VC(n.get(Yt));n.atomic(()=>{e.document&&n.loadStoreSnapshot(e.document),s&&n.update(Yt,r=>({...r,...s})),e.session&&nP(n,e.session)})}const l5=new or;function d5(n){const e=l5.get(n,tP).get();if(!e)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:e}}function rP(n){const t=[],e=new Set;for(const s of n){if(e.has(s.type))throw new Error(`Binding type "${s.type}" is defined more than once`);t.push(s),e.add(s.type)}return t}function Kr({children:n,className:t="",...e}){return u.jsx("svg",{...e,className:se("tl-svg-container",t),children:n})}function sy(n,t,e,s){const r=n.x-e.x,i=n.y-e.y,o=s.x-e.x,a=s.y-e.y,c=t.x-n.x,l=t.y-n.y,d=o*i-a*r,h=c*i-l*r,p=a*c-o*l;if(d===0||h===0||p===0)return null;if(p!==0){const f=d/p,y=h/p;if(0<=f&&f<=1&&0<=y&&y<=1)return S.AddXY(n,f*c,f*l)}return null}function Fc(n,t,e,s){const r=(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y),i=2*((t.x-n.x)*(n.x-e.x)+(t.y-n.y)*(n.y-e.y)),o=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-s*s,a=i*i-4*r*o;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-i+c)/(2*r),d=(-i-c)/(2*r);if((l<0||l>1)&&(d<0||d>1))return null;const h=[];return 0<=l&&l<=1&&h.push(S.Lrp(n,t,l)),0<=d&&d<=1&&h.push(S.Lrp(n,t,d)),h.length===0?null:h}function u5(n,t,e){const s=[];let r;for(let i=0,o=e.length-1;i<o;i++)r=sy(n,t,e[i],e[i+1]),r&&s.push(r);return s.length===0?null:s}function ry(n,t,e){const s=[];let r;for(let i=1,o=e.length;i<o+1;i++)r=sy(n,t,e[i-1],e[i%e.length]),r&&s.push(r);return s.length===0?null:s}function h5(n,t,e,s){let r=e.x-n.x,i=e.y-n.y;const o=Math.sqrt(r*r+i*i),a=(o*o-s*s+t*t)/(2*o),c=Math.sqrt(t*t-a*a);return r/=o,i/=o,[new S(n.x+r*a-i*c,n.y+i*a+r*c),new S(n.x+r*a+i*c,n.y+i*a-r*c)]}function hg(n,t,e){const s=[];let r,i,o;for(let a=0,c=e.length;a<c;a++)r=e[a],i=e[(a+1)%e.length],o=Fc(r,i,n,t),o&&s.push(...o);return s.length===0?null:s}function Xx(n,t,e){const s=[];let r,i,o;for(let a=1,c=e.length;a<c;a++)r=e[a-1],i=e[a],o=Fc(r,i,n,t),o&&s.push(...o);return s.length===0?null:s}function Il(n,t,e){return(e.y-n.y)*(t.x-n.x)>(t.y-n.y)*(e.x-n.x)}function iy(n,t,e,s){return Il(n,e,s)!==Il(t,e,s)&&Il(n,t,e)!==Il(n,t,s)}function qx(n,t){const e=new Map;let s,r,i,o;for(let a=0,c=n.length;a<c;a++)if(s=n[a],On(s,t)){const l=_p(s);e.has(l)||e.set(l,s)}for(let a=0,c=t.length;a<c;a++)if(s=t[a],On(s,n)){const l=_p(s);e.has(l)||e.set(l,s)}for(let a=0,c=n.length;a<c;a++){s=n[a],r=n[(a+1)%n.length];for(let l=0,d=t.length;l<d;l++){i=t[l],o=t[(l+1)%t.length];const h=sy(s,r,i,o);if(h!==null){const p=_p(h);e.has(p)||e.set(p,h)}}}return e.size===0?null:p5([...e.values()])}function _p(n){return`${n.x},${n.y}`}function p5(n){const t=S.Average(n);return n.sort((e,s)=>S.Angle(t,e)-S.Angle(t,s))}function iP(n,t){let e,s,r,i;for(let o=0,a=n.length;o<a;o++){e=n[o],s=n[(o+1)%a];for(let c=0,l=t.length;c<l;c++)if(r=t[c],i=t[(c+1)%l],iy(e,s,r,i))return!0}return!1}function f5(n,t){let e,s,r,i;for(let o=0,a=n.length;o<a;o++){e=n[o],s=n[(o+1)%a];for(let c=1,l=t.length;c<l;c++)if(r=t[c-1],i=t[c],iy(e,s,r,i))return!0}return!1}class Qs extends ti{constructor(e){super({...e,isClosed:!1,isFilled:!1});g(this,"start");g(this,"end");g(this,"d");g(this,"u");g(this,"ul");const{start:s,end:r}=e;this.start=s,this.end=r,this.d=s.clone().sub(r),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:s,end:r,u:i,ul:o}=this;if(o===0)return s;const a=S.Sub(e,s).dpr(i)/o,c=s.x+i.x*a;if(c<Math.min(s.x,r.x))return s.x<r.x?s:r;if(c>Math.max(s.x,r.x))return s.x>r.x?s:r;const l=s.y+i.y*a;return l<Math.min(s.y,r.y)?s.y<r.y?s:r:l>Math.max(s.y,r.y)?s.y>r.y?s:r:new S(c,l)}hitTestLineSegment(e,s,r=0){return iy(e,s,this.start,this.end)||this.distanceToLineSegment(e,s)<=r}getSvgPathData(e=!0){const{start:s,end:r}=this;return`${e?`M${s.toFixed()}`:""} L${r.toFixed()}`}}class oa extends ti{constructor(e){super({isClosed:!1,isFilled:!1,...e});g(this,"points");g(this,"_segments");const{points:s}=e;this.points=s}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let s=0,r=e.length-1;s<r;s++){const i=e[s],o=e[s+1];this._segments.push(new Qs({start:i,end:o}))}this.isClosed&&this._segments.push(new Qs({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,s)=>e+s.length,0)}getVertices(){return this.points}nearestPoint(e){const{segments:s}=this;let r=this.points[0],i=1/0,o,a;for(let c=0;c<s.length;c++)o=s[c].nearestPoint(e),a=S.Dist2(o,e),a<i&&(r=o,i=a);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,s,r=0){const{segments:i}=this;for(let o=0,a=i.length;o<a;o++)if(i[o].hitTestLineSegment(e,s,r))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce((s,r,i)=>i===0?`M ${r.x} ${r.y}`:`${s} L ${r.x} ${r.y}`,"")}}class ht extends oa{constructor(t){super({...t}),this.isClosed=!0}}class cr extends ht{constructor(e){const{x:s=0,y:r=0,width:i,height:o}=e;super({...e,points:[new S(s,r),new S(s+i,r),new S(s+i,r+o),new S(s,r+o)]});g(this,"x");g(this,"y");g(this,"w");g(this,"h");this.x=s,this.y=r,this.w=i,this.h=o}getBounds(){return new Y(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:e,y:s,w:r,h:i}=this;return`M${e},${s} h${r} v${i} h-${r}z`}}class cs{constructor(t){g(this,"canSnap",()=>!0);g(this,"canScroll",()=>!1);g(this,"canEdit",()=>!1);g(this,"canResize",()=>!0);g(this,"canEditInReadOnly",()=>!1);g(this,"canCrop",()=>!1);g(this,"canBeLaidOut",()=>!0);g(this,"hideResizeHandles",()=>!1);g(this,"hideRotateHandle",()=>!1);g(this,"hideSelectionBoundsBg",()=>!1);g(this,"hideSelectionBoundsFg",()=>!1);g(this,"isAspectRatioLocked",()=>!1);g(this,"onBeforeCreate");g(this,"onBeforeUpdate");g(this,"onDragShapesOver");g(this,"onDragShapesOut");g(this,"onDropShapesOver");g(this,"onResizeStart");g(this,"onResize");g(this,"onResizeEnd");g(this,"onTranslateStart");g(this,"onTranslate");g(this,"onTranslateEnd");g(this,"onHandleDrag");g(this,"onRotateStart");g(this,"onRotate");g(this,"onRotateEnd");g(this,"onBindingChange");g(this,"onChildrenChange");g(this,"onDoubleClickHandle");g(this,"onDoubleClickEdge");g(this,"onDoubleClick");g(this,"onClick");g(this,"onEditEnd");this.editor=t}canBind(t){return!0}providesBackgroundForChildren(t){return!1}canReceiveNewChildrenOfType(t,e){return!1}canDropShapes(t,e){return!1}expandSelectionOutlinePx(t){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(t){return{}}getHandleSnapGeometry(t){return{}}}g(cs,"props"),g(cs,"migrations"),g(cs,"type");function g5(n,t,e={}){const{closed:s=!1,snap:r=1,start:i="outset",end:o="outset",lengthRatio:a=2,style:c="dashed"}=e;let l=0,d=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,l=Math.min(t*a,n/4);break}case"dotted":{h=100,l=t/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(i==="outset"?(n+=l/2,f+=l/2):i==="skip"&&(n-=l,f-=l),o==="outset"?n+=l/2:o==="skip"&&(n-=l)),d=Math.floor(n/l/(2*h)),d-=d%r,d<3&&c==="dashed"?n/t<5?(l=n,d=1,p=0):(l=n*.333,p=n*.333):(d=Math.max(d,3),l=n/d/(2*h),s?(f=l/2,p=(n-d*l)/d):p=(n-d*l)/Math.max(1,d-1)),{strokeDasharray:[l,p].join(" "),strokeDashoffset:f.toString()}}function Zx({bounds:n,className:t}){const e=N(),s=z("zoom level",()=>e.getZoomLevel(),[e]);return u.jsx("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((r,i)=>{const{strokeDasharray:o,strokeDashoffset:a}=g5(r[0].dist(r[1]),1/s,{style:"dashed",lengthRatio:4});return u.jsx("line",{x1:r[0].x,y1:r[0].y,x2:r[1].x,y2:r[1].y,strokeDasharray:o,strokeDashoffset:a},i)})})}class od extends cs{constructor(){super(...arguments);g(this,"hideSelectionBoundsFg",()=>!0);g(this,"canBind",()=>!1);g(this,"onChildrenChange",e=>{const s=this.editor.getSortedChildIdsForParent(e.id);if(s.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(s.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(s,e.parentId),this.editor.deleteShapes([e.id]);return}})}getDefaultProps(){return{}}getGeometry(e){const s=this.editor.getSortedChildIdsForParent(e.id);return s.length===0?new cr({width:1,height:1,isFilled:!1}):new ls({children:s.map(r=>{const i=this.editor.getShape(r),o=this.editor.getShapeGeometry(r),a=this.editor.getShapeLocalTransform(i).applyToPoints(o.vertices);return o.isClosed?new ht({points:a,isFilled:!0}):new oa({points:a})})})}component(e){const s=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),i=r.length>0&&r.some(c=>c!==e.id&&this.editor.isShapeOfType(this.editor.getShape(c),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!s&&(o||i))return null;const a=this.editor.getShapeGeometry(e).bounds;return u.jsx(Kr,{id:e.id,children:u.jsx(Zx,{className:"tl-group",bounds:a})})}indicator(e){const s=this.editor.getShapeGeometry(e).bounds;return u.jsx(Zx,{className:"",bounds:s})}}g(od,"type","group"),g(od,"props",iI),g(od,"migrations",oI);const oP=[od],m5=new Set(oP.map(n=>n.type));function aP(n){const t=[...oP],e=new Set;for(const s of n){if(m5.has(s.type))throw new Error(`Shape type "${s.type}" is a core shapes type and cannot be overridden`);if(e.has(s.type))throw new Error(`Shape type "${s.type}" is defined more than once`);t.push(s),e.add(s.type)}return t}const y5={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function Jx(n,t){if(!t)return!1;switch(n.type){case"mixed":return t.type==="mixed";case"shared":return t.type==="shared"&&n.value===t.value;default:throw Zt(n)}}class S5{constructor(t){g(this,"map");this.map=new Map(t)}get(t){return this.map.get(t)}getAsKnownValue(t){const e=this.get(t);if(e&&e.type!=="mixed")return e.value}get size(){return this.map.size}equals(t){if(this.size!==t.size)return!1;const e=new Set;for(const[s,r]of this){if(!Jx(r,t.get(s)))return!1;e.add(s)}for(const[s,r]of t)if(!e.has(s)&&!Jx(r,this.get(s)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class pg extends S5{set(t,e){this.map.set(t,e)}applyValue(t,e){const s=this.get(t);if(!s){this.set(t,{type:"shared",value:e});return}switch(s.type){case"mixed":return;case"shared":s.value!==e&&this.set(t,{type:"mixed"});return;default:Zt(s,"type")}}}function w5(n,t,e){return Ms(n).then(function(s){return s.arrayBuffer()}).then(function(s){return new File([s],t,{type:e})})}function x5(n,t){var r;let e=n;const s=new Set(t);for(;s.has(e);)e=(r=/^.*(\d+)$/.exec(e))!=null&&r[1]?e.replace(/(\d+)(?=\D?)$/,i=>(+i+1).toString()):`${e} 1`;return e}function Pl(n,t,e){if(e.length===0)return[];const s=new Map;for(const i of ge(e.map(o=>n.getShape(o)))){const{parentId:o}=i;s.has(o)||s.set(o,{children:ge(n.getSortedChildIdsForParent(o).map(a=>n.getShape(a))),moving:new Set}),s.get(o).moving.add(i)}const r=[];switch(t){case"toBack":{s.forEach(({moving:i,children:o})=>b5(i,o,r));break}case"toFront":{s.forEach(({moving:i,children:o})=>v5(i,o,r));break}case"forward":{s.forEach(({moving:i,children:o})=>C5(i,o,r));break}case"backward":{s.forEach(({moving:i,children:o})=>I5(i,o,r));break}}return r}function b5(n,t,e){const s=t.length;if(n.size===s)return;let r,i;for(let o=0;o<s;o++){const a=t[o];if(n.has(a))r=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const o=Fo(r,i,n.size);e.push(...Array.from(n.values()).sort(Xt).map((a,c)=>({...a,index:o[c]})))}}function v5(n,t,e){const s=t.length;if(n.size===s)return;let r,i;for(let o=s-1;o>-1;o--){const a=t[o];if(n.has(a))i=a.index,n.delete(a);else{r=a.index;break}}if(n.size!==0){const o=Fo(r,i,n.size);e.push(...Array.from(n.values()).sort(Xt).map((a,c)=>({...a,index:o[c]})))}}function C5(n,t,e){var i;const s=t.length;if(n.size===s)return;let r={name:"skipping"};for(let o=0;o<s;o++){const a=n.has(t[o]);switch(r.name){case"skipping":{if(!a)continue;r={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;const{selectIndex:c}=r;Fo(t[o].index,(i=t[o+1])==null?void 0:i.index,o-c).forEach((l,d)=>e.push({...t[c+d],index:l})),r={name:"skipping"};break}}}}function I5(n,t,e){var i;const s=t.length;if(n.size===s)return;let r={name:"skipping"};for(let o=s-1;o>-1;o--){const a=n.has(t[o]);switch(r.name){case"skipping":{if(!a)continue;r={name:"selecting",selectIndex:o};break}case"selecting":{if(a)continue;Fo((i=t[o-1])==null?void 0:i.index,t[o].index,r.selectIndex-o).forEach((c,l)=>{e.push({...t[o+l+1],index:c})}),r={name:"skipping"};break}}}}function cP({editor:n}){const t=n.getSelectedShapes(),e=n.getSelectionRotation(),s=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:r}}=n;if(!s)return null;const i=s.center.clone().rotWith(s.point,e);return{selectionPageCenter:i,initialCursorAngle:i.angle(r),initialSelectionRotation:e,shapeSnapshots:t.map(o=>({shape:Je(o),initialPagePoint:n.getShapePageTransform(o.id).point()}))}}function ad({delta:n,editor:t,snapshot:e,stage:s}){const{selectionPageCenter:r,shapeSnapshots:i}=e;t.updateShapes(i.map(({shape:a,initialPagePoint:c})=>{const l=pn(a.parentId)?t.getShapePageTransform(a.parentId):Q.Identity(),d=S.RotWith(c,r,n),h=Q.applyToPoint(Q.Inverse(l),d),p=Br(a.rotation+n);return{id:a.id,type:a.type,x:h.x,y:h.y,rotation:p}}));const o=[];i.forEach(({shape:a})=>{var h,p,f;const c=t.getShape(a.id);if(!c)return;const l=t.getShapeUtil(a);if(s==="start"||s==="one-off"){const y=(h=l.onRotateStart)==null?void 0:h.call(l,a);y&&o.push(y)}const d=(p=l.onRotate)==null?void 0:p.call(l,a,c);if(d&&o.push(d),s==="end"||s==="one-off"){const y=(f=l.onRotateEnd)==null?void 0:f.call(l,a,c);y&&o.push(y)}}),o.length>0&&t.updateShapes(o)}const P5=n=>{const{store:t}=n,e=t.query.filterHistory("binding"),s=t.query.records("binding");function r(){const i=s.get(),o=new Map;for(const a of i){const{fromId:c,toId:l}=a,d=o.get(c);d?d.push(a):o.set(c,[a]);const h=o.get(l);h?h.push(a):o.set(l,[a])}return o}return K("arrowBindingsIndex",(i,o)=>{if(Ci(i))return r();const a=i,c=e.getDiffSince(o);if(c===jn)return r();let l;function d(f){l??(l=new Map(a));const y=l.get(f.fromId),m=y==null?void 0:y.filter(b=>b.id!==f.id);m!=null&&m.length?l.set(f.fromId,m):l.delete(f.fromId);const x=l.get(f.toId),w=x==null?void 0:x.filter(b=>b.id!==f.id);w!=null&&w.length?l.set(f.toId,w):l.delete(f.toId)}function h(f){l??(l=new Map(a));let y=l.get(f);return y?y===a.get(f)&&(y=y.slice(0),l.set(f,y)):(y=[],l.set(f,y)),y}function p(f){h(f.fromId).push(f),h(f.toId).push(f)}for(const f of c){for(const y of lt(f.added))p(y);for(const[y,m]of lt(f.updated))d(y),p(m);for(const y of lt(f.removed))d(y)}return l??a})};function E5(n,t,e){const s=n.getShapeMaskedPageBounds(t);return s===void 0?!0:!e.includes(s)}const _5=n=>{function t(e){const s=e.getCurrentPageShapeIds(),r=e.getViewportPageBounds(),i=new Set;return s.forEach(o=>{E5(e,o,r)&&i.add(o)}),i}return K("getCulledShapes",e=>{if(Ci(e))return t(n);const s=t(n);if(e.size!==s.size)return s;for(const r of e)if(!s.has(r))return s;return e})},T5=n=>{const t=n.query.ids("shape"),e=n.query.filterHistory("shape");function s(){const r={},i=t.get(),o=Array(i.size);return i.forEach(a=>o.push(n.get(a))),o.sort(Xt),o.forEach(a=>{r[a.parentId]||(r[a.parentId]=[]),r[a.parentId].push(a.id)}),r}return K("parentsToChildrenWithIndexes",(r,i)=>{if(Ci(r))return s();const o=e.getDiffSince(i);if(o===jn)return s();if(o.length===0)return r;let a=null;const c=h=>{a||(a={...r}),a[h]?a[h]===r[h]&&(a[h]=[...a[h]]):a[h]=[]},l=new Set;let d;for(let h=0,p=o.length;h<p;h++){d=o[h];for(const f of Object.values(d.added))bo(f)&&(c(f.parentId),a[f.parentId].push(f.id),l.add(a[f.parentId]));for(const[f,y]of Object.values(d.updated))if(bo(y)&&bo(f)){if(f.parentId!==y.parentId)c(f.parentId),c(y.parentId),a[f.parentId].splice(a[f.parentId].indexOf(y.id),1),a[y.parentId].push(y.id),l.add(a[y.parentId]);else if(f.index!==y.index){c(y.parentId);const m=a[y.parentId].indexOf(y.id);a[y.parentId][m]=y.id,l.add(a[y.parentId])}}for(const f of Object.values(d.removed))bo(f)&&(c(f.parentId),a[f.parentId].splice(a[f.parentId].indexOf(f.id),1))}for(const h of l){const p=ge(h.map(f=>n.get(f)));p.sort(Xt),h.splice(0,h.length,...p.map(f=>f.id))}return a??r})},Tp=(n,t,e)=>{for(;!un(e.parentId);){const s=n.get(e.parentId);if(!s)return!1;e=s}return e.parentId===t},k5=(n,t)=>{const e=n.query.ids("shape");let s=null;function r(){const i=t();return s=i,new Set([...e.get()].filter(o=>Tp(n,i,n.get(o))))}return K("_shapeIdsInCurrentPage",(i,o)=>{if(Ci(i))return r();const a=t();if(a!==s)return r();const c=n.history.getDiffSince(o);if(c===jn)return r();const l=new td(i);for(const h of c){for(const p of Object.values(h.added))bo(p)&&Tp(n,a,p)&&l.add(p.id);for(const[p,f]of Object.values(h.updated))bo(f)&&(Tp(n,a,f)?l.add(f.id):l.remove(f.id));for(const p of Object.keys(h.removed))pn(p)&&l.remove(p)}const d=l.get();return d?Fa(d.value,d.diff):i})},lP=v.createContext(null);function M5({context:n,editor:t,children:e}){return u.jsx(eh.Provider,{value:t,children:u.jsx(lP.Provider,{value:n,children:e})})}function dP(){const n=v.useContext(lP);return n?{isDarkMode:n.isDarkMode}:null}async function A5(n,t,e={}){var P,C;const s=typeof t[0]=="string"?t:t.map(_=>_.id);if(s.length===0)return;if(!window.document)throw Error("No document");const{scale:r=1,background:i=!1,padding:o=n.options.defaultSvgPadding,preserveAspectRatio:a=!1}=e,c=e.darkMode??n.user.getIsDarkMode(),l=fr({isDarkMode:c}),d=n.getShapeAndDescendantIds(s),h=n.getUnorderedRenderingShapes(!1).filter(({id:_})=>d.has(_));let p=null;if(e.bounds)p=e.bounds;else for(const{id:_}of h){const k=n.getShapeMaskedPageBounds(_);k&&(p?p.union(k):p=k.clone())}if(!p)return;const f=s.length===1&&n.isShapeOfType(n.getShape(s[0]),"frame")?s[0]:null;f||p.expandBy(o);const y=p.width*r,m=p.height*r;try{(C=(P=document.body).focus)==null||C.call(P)}catch{}const x=[],w=new Map,b={isDarkMode:c,addExportDef:_=>{if(w.has(_.key))return;const k=(async()=>{const D=await _.getElement();D&&x.push(u.jsx(v.Fragment,{children:D},x.length))})();w.set(_.key,k)}},I=(await Promise.all(h.map(async({id:_,opacity:k,index:D,backgroundIndex:T})=>{var V,W;if(_===f)return[];const A=n.getShape(_);if(n.isShapeOfType(A,"group"))return[];const L=n.getShapeUtil(A);let j=await((V=L.toSvg)==null?void 0:V.call(L,A,b)),R=await((W=L.toBackgroundSvg)==null?void 0:W.call(L,A,b));if(!j&&!R){const te=n.getShapePageBounds(A);j=u.jsx("rect",{width:te.w,height:te.h,fill:l.solid,stroke:l.grey.pattern,strokeWidth:1})}let F=n.getShapePageTransform(A).toCssString();"scale"in A.props&&A.props.scale!==1&&(F=`${F} scale(${A.props.scale}, ${A.props.scale})`),j&&(j=u.jsx("g",{transform:F,opacity:k,children:j},A.id)),R&&(R=u.jsx("g",{transform:F,opacity:k,children:R},`bg_${A.id}`));const H=n.getShapeMask(A.id);if(H){const te=`mask_${A.id.replace(":","_")}`;x.push(u.jsx("clipPath",{id:te,children:u.jsx("path",{d:`M${H.map(({x:le,y:Se})=>`${le},${Se}`).join("L")}Z`})},x.length)),j&&(j=u.jsx("g",{clipPath:`url(#${te})`,children:j},A.id)),R&&(R=u.jsx("g",{clipPath:`url(#${te})`,children:R},`bg_${A.id}`))}const U=[];return j&&U.push({zIndex:D,element:j}),R&&U.push({zIndex:T,element:R}),U}))).flat();return await Promise.all(w.values()),{jsx:u.jsx(M5,{editor:n,context:b,children:u.jsxs("svg",{preserveAspectRatio:a||void 0,direction:"ltr",width:y,height:m,viewBox:`${p.minX} ${p.minY} ${p.width} ${p.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:i?f?l.solid:l.background:"transparent"},children:[u.jsx("defs",{children:x}),I.sort((_,k)=>_.zIndex-k.zIndex).map(({element:_})=>_)]})}),width:y,height:m}}const j5=40;class D5{constructor(t){g(this,"_clickId","");g(this,"_clickTimeout");g(this,"_clickScreenPoint");g(this,"_previousScreenPoint");g(this,"_getClickTimeout",(t,e=Qe())=>{this._clickId=e,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===t&&this._clickId===e){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},t==="idle"||t==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)});g(this,"_clickState","idle");g(this,"lastPointerInfo",{});g(this,"handlePointerEvent",t=>{switch(t.name){case"pointer_down":{if(!this._clickState)return t;switch(this._clickScreenPoint=S.From(t.point),this._previousScreenPoint&&S.Dist2(this._previousScreenPoint,this._clickScreenPoint)>j5**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=t,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),t}case"pointer_up":{if(!this._clickState)return t;switch(this._clickScreenPoint=S.From(t.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return t}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&S.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),t}return t});g(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});this.editor=t}get clickState(){return this._clickState}}class O5{constructor(t){g(this,"_isEdgeScrolling",!1);g(this,"_edgeScrollDuration",-1);this.editor=t}updateEdgeScrolling(t){const{editor:e}=this,s=this.getEdgeScroll();if(s.x===0&&s.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=t,this._edgeScrollDuration>e.options.edgeScrollDelay){const r=e.options.edgeScrollEaseDuration>0?It.easeInCubic(Math.min(1,this._edgeScrollDuration/(e.options.edgeScrollDelay+e.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:s.x*r,y:s.y*r})}}getEdgeProximityFactors(t,e,s,r,i){const{editor:o}=this,a=o.options.edgeScrollDistance,c=s?o.options.coarsePointerWidth:0,l=t-c,d=t+c,h=r?0:a,p=i?e:e-a;return l<h?Math.min(1,(h-l)/a):d>p?-Math.min(1,(d-p)/a):0}getEdgeScroll(){const{editor:t}=this,{inputs:{currentScreenPoint:{x:e,y:s}}}=t,r=t.getViewportScreenBounds(),{isCoarsePointer:i,insets:[o,a,c,l]}=t.getInstanceState(),d=this.getEdgeProximityFactors(e,r.w,i,l,a),h=this.getEdgeProximityFactors(s,r.h,i,o,c);return{x:d,y:h}}moveCameraWhenCloseToEdge(t){const{editor:e}=this;if(!e.inputs.isDragging||e.inputs.isPanning||e.getCameraOptions().isLocked||t.x===0&&t.y===0)return;const s=e.getViewportScreenBounds(),r=s.w<1e3?.612:1,i=s.h<1e3?.612:1,o=e.getZoomLevel(),a=e.user.getEdgeScrollSpeed()*e.options.edgeScrollSpeed,c=a*t.x*r/o,l=a*t.y*i/o,{x:d,y:h,z:p}=e.getCamera();e.setCamera(new S(d+c,h+l,p))}}class R5{constructor(t){g(this,"isSafari");g(this,"isIos");g(this,"isChromeForIos");g(this,"isFirefox");g(this,"isAndroid");this.editor=t,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}class L5{constructor(t,e){g(this,"disposeSideEffectListener");this.editor=t,this.disposeSideEffectListener=t.sideEffects.registerAfterChangeHandler("instance",(r,i)=>{r.isFocused!==i.isFocused&&(i.isFocused?this.focus():this.blur(),this.updateContainerClass())});const s=t.getInstanceState().isFocused;e!==s&&t.updateInstanceState({isFocused:!!e}),this.updateContainerClass()}updateContainerClass(){const t=this.editor.getContainer();this.editor.getInstanceState().isFocused?t.classList.add("tl-container__focused"):t.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var t;(t=this.disposeSideEffectListener)==null||t.call(this)}}function Pa(n){return F5}class $5{constructor(){g(this,"length",0);g(this,"head",null);g(this,"tail",this)}push(t){return new oy(t,this)}toArray(){return tr}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const F5=new $5;class oy{constructor(t,e){g(this,"length");this.head=t,this.tail=e,this.length=e.length+1}push(t){return new oy(t,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let t=this;return{next(){if(t.length){const e=t.head;return t=t.tail,{value:e,done:!1}}else return{value:void 0,done:!0}}}}}class N5{constructor(t){g(this,"store");g(this,"dispose");g(this,"state","recording");g(this,"pendingDiff",new z5);g(this,"stacks",Ct("HistoryManager.stacks",{undos:Pa(),redos:Pa()},{isEqual:(t,e)=>t.undos===e.undos&&t.redos===e.redos}));g(this,"annotateError");g(this,"onBatchComplete",()=>{});g(this,"_isInBatch",!1);g(this,"batch",(t,e)=>{const s=this.state;s!=="paused"&&(e!=null&&e.history)&&(this.state=B5[e.history]);try{if(this._isInBatch)return t(),this;this._isInBatch=!0;try{$r(()=>{t(),this.onBatchComplete()})}catch(r){throw this.annotateError(r),r}finally{this._isInBatch=!1}return this}finally{this.state=s}});g(this,"_undo",({pushToRedoStack:t,toMark:e=void 0})=>{var r;const s=this.state;this.state="paused";try{let{undos:i,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),c=bC(a),l=ng(a);t&&!c&&(o=o.push({type:"diff",diff:a}));let d=!1;if(c)for(;((r=i.head)==null?void 0:r.type)==="stop";){const h=i.head;if(i=i.tail,t&&(o=o.push(h)),h.id===e){d=!0;break}}if(!d)e:for(;i.head;){const h=i.head;switch(i=i.tail,t&&(o=o.push(h)),h.type){case"diff":Ka(l,[ng(h.diff)]);break;case"stop":if(!e||h.id===e)break e;break;default:Zt(h)}}this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:o})}finally{this.state=s}return this});g(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));g(this,"redo",()=>{var e;const t=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:s,redos:r}=this.stacks.get();if(r.length===0)return this;for(;((e=r.head)==null?void 0:e.type)==="stop";)s=s.push(r.head),r=r.tail;const i=eu();for(;r.head;){const o=r.head;if(s=s.push(o),r=r.tail,o.type==="diff")Ka(i,[o.diff]);else break}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:r})}finally{this.state=t}return this});g(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));g(this,"bailToMark",t=>(this._undo({pushToRedoStack:!1,toMark:t}),this));g(this,"squashToMark",t=>{var i;let e=this.stacks.get().undos;const s=[];for(;e.head&&!(e.head.type==="stop"&&e.head.id===t);)e.head.type==="diff"&&s.push(e.head.diff),e=e.tail;if(!e.head||((i=e.head)==null?void 0:i.id)!==t)return console.error("Could not find mark to squash to: ",t),this;if(s.length===0)return this;const r=eu();return Ka(r,s.reverse()),this.stacks.update(({redos:o})=>({undos:e.push({type:"diff",diff:r}),redos:o})),this});g(this,"mark",(t=Qe())=>($r(()=>{this.flushPendingDiff(),this.stacks.update(({undos:e,redos:s})=>({undos:e.push({type:"stop",id:t}),redos:s}))}),t));this.store=t.store,this.annotateError=t.annotateError??Qd,this.dispose=this.store.addHistoryInterceptor((e,s)=>{if(s==="user")switch(this.state){case"recording":this.pendingDiff.apply(e.changes),this.stacks.update(({undos:r})=>({undos:r,redos:Pa()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(e.changes);break;case"paused":break;default:Zt(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const t=this.pendingDiff.clear();this.stacks.update(({undos:e,redos:s})=>({undos:e.push({type:"diff",diff:t}),redos:s}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}ignore(t){return this.batch(t,{history:"ignore"})}clear(){this.stacks.set({undos:Pa(),redos:Pa()}),this.pendingDiff.clear()}debug(){const{undos:t,redos:e}=this.stacks.get();return{undos:t.toArray(),redos:e.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const B5={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class z5{constructor(){g(this,"diff",eu());g(this,"isEmptyAtom",Ct("PendingDiff.isEmpty",!0))}clear(){const t=this.diff;return this.diff=eu(),this.isEmptyAtom.set(!0),t}isEmpty(){return this.isEmptyAtom.get()}apply(t){Ka(this.diff,[t]),this.isEmptyAtom.set(bC(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class U5{constructor(t){g(this,"scribbleItems",new Map);g(this,"state","paused");g(this,"addScribble",(t,e=Qe())=>{const s={id:e,scribble:{id:e,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...t,state:"starting"},timeoutMs:0,delayRemaining:t.delay??0,prev:null,next:null};return this.scribbleItems.set(e,s),s});g(this,"stop",t=>{const e=this.scribbleItems.get(t);if(!e)throw Error(`Scribble with id ${t} not found`);return e.delayRemaining=Math.min(e.delayRemaining,200),e.scribble.state="stopping",e});g(this,"addPoint",(t,e,s)=>{const r=this.scribbleItems.get(t);if(!r)throw Error(`Scribble with id ${t} not found`);const{prev:i}=r,o={x:e,y:s,z:.5};return(!i||S.Dist(i,o)>=1)&&(r.next=o),r});g(this,"tick",t=>{this.scribbleItems.size!==0&&this.editor.batch(()=>{this.scribbleItems.forEach(e=>{if(e.scribble.state==="starting"){const{next:c,prev:l}=e;c&&c!==l&&(e.prev=c,e.scribble.points.push(c)),e.scribble.points.length>8&&(e.scribble.state="active");return}e.delayRemaining>0&&(e.delayRemaining=Math.max(0,e.delayRemaining-t)),e.timeoutMs+=t,e.timeoutMs>=16&&(e.timeoutMs=0);const{delayRemaining:s,timeoutMs:r,prev:i,next:o,scribble:a}=e;switch(a.state){case"active":{o&&o!==i?(e.prev=o,a.points.push(o),s===0&&a.points.length>8&&a.points.shift()):r===0&&(a.points.length>1?a.points.shift():e.delayRemaining=a.delay);break}case"stopping":{if(e.delayRemaining===0&&r===0){if(a.points.length===1){this.scribbleItems.delete(e.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)})})});this.editor=t}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}}var H5=Object.defineProperty,K5=Object.getOwnPropertyDescriptor,nh=(n,t,e,s)=>{for(var r=K5(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&H5(t,e,r),r};const oe=n=>Math.round(n*10**8)/10**8;function Xs(n,t,e,s,r){const i=n.filter(a=>(s==="forward"?a.startNode.id===t:a.endNode.id===t)&&oe(a.length)===oe(e)&&ns(a.breadthIntersection[0],a.breadthIntersection[1],r[0],r[1]));if(i.length===0)return[];const o=new Set;return i.forEach(a=>{const c=s==="forward"?a.endNode.id:a.startNode.id;if(!o.has(c)){o.add(c);const l=Xs(n,c,e,s,ns(a.breadthIntersection[0],a.breadthIntersection[1],r[0],r[1]));i.push(...l)}}),i}function G5(n){n.sort((t,e)=>e.gaps.length-t.gaps.length);for(let t=n.length-1;t>0;t--){const e=n[t];for(let s=t-1;s>=0;s--){const r=n[s];if(r.direction===e.direction&&e.gaps.every(i=>r.gaps.some(o=>oe(i.startEdge[0].x)===oe(o.startEdge[0].x)&&oe(i.startEdge[0].y)===oe(o.startEdge[0].y)&&oe(i.startEdge[1].x)===oe(o.startEdge[1].x)&&oe(i.startEdge[1].y)===oe(o.startEdge[1].y))&&r.gaps.some(o=>oe(i.endEdge[0].x)===oe(o.endEdge[0].x)&&oe(i.endEdge[0].y)===oe(o.endEdge[0].y)&&oe(i.endEdge[1].x)===oe(o.endEdge[1].x)&&oe(i.endEdge[1].y)===oe(o.endEdge[1].y)))){n.splice(t,1);break}}}}class Nc{constructor(t){g(this,"editor");this.manager=t,this.editor=t.editor}getSnapPointsCache(){const{editor:t}=this;return t.store.createComputedCache("snapPoints",e=>{const s=t.getShapePageTransform(e.id);if(!s)return;const i=t.getShapeUtil(e).getBoundsSnapGeometry(e).points??t.getShapeGeometry(e).bounds.cornersAndCenter;if(!(!s||!i))return i.map((o,a)=>{const{x:c,y:l}=Q.applyToPoint(s,o);return{x:c,y:l,id:`${e.id}:${a}`}})})}getSnapPoints(t){return this.getSnapPointsCache().get(t)??[]}getSnappablePoints(){const t=this.getSnapPointsCache(),e=this.manager.getSnappableShapes(),s=[];for(const r of e){const i=t.get(r);i&&s.push(...i)}return s}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),t=>({id:t,pageBounds:Gn(this.editor.getShapePageBounds(t))}))}getVisibleGaps(){const t=[],e=[];let s,r;const i=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<i.length;a++){s=i[a];for(let c=a+1;c<i.length;c++)r=i[c],s.pageBounds.maxX<r.pageBounds.minX&&Ia(s.pageBounds.minY,s.pageBounds.maxY,r.pageBounds.minY,r.pageBounds.maxY)&&t.push({startNode:s,endNode:r,startEdge:[new S(s.pageBounds.maxX,s.pageBounds.minY),new S(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new S(r.pageBounds.minX,r.pageBounds.minY),new S(r.pageBounds.minX,r.pageBounds.maxY)],length:r.pageBounds.minX-s.pageBounds.maxX,breadthIntersection:ns(s.pageBounds.minY,s.pageBounds.maxY,r.pageBounds.minY,r.pageBounds.maxY)})}const o=i.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<o.length;a++){s=o[a];for(let c=a+1;c<o.length;c++)r=o[c],s.pageBounds.maxY<r.pageBounds.minY&&Ia(s.pageBounds.minX,s.pageBounds.maxX,r.pageBounds.minX,r.pageBounds.maxX)&&e.push({startNode:s,endNode:r,startEdge:[new S(s.pageBounds.minX,s.pageBounds.maxY),new S(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new S(r.pageBounds.minX,r.pageBounds.minY),new S(r.pageBounds.maxX,r.pageBounds.minY)],length:r.pageBounds.minY-s.pageBounds.maxY,breadthIntersection:ns(s.pageBounds.minX,s.pageBounds.maxX,r.pageBounds.minX,r.pageBounds.maxX)})}return{horizontal:t,vertical:e}}snapTranslateShapes({lockedAxis:t,initialSelectionPageBounds:e,initialSelectionSnapPoints:s,dragDelta:r}){var x,w;const i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=e.clone().translate(r),c=s.map(({x:b,y:I},E)=>({id:"selection:"+E,x:b+r.x,y:I+r.y})),l=o,d=[],h=[],p=new S(i,i);this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const f=new S(t==="x"?0:((x=d[0])==null?void 0:x.nudge)??0,t==="y"?0:((w=h[0])==null?void 0:w.nudge)??0);p.x=0,p.y=0,d.length=0,h.length=0,c.forEach(b=>{b.x+=f.x,b.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h,minOffset:p});const y=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:h}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:h});return this.manager.setIndicators([...m,...y]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:t,dragDelta:e,handle:s,isAspectRatioLocked:r,isResizingFromCenter:i}){var _,k;const o=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:l}=Y.Resize(t,s,i?e.x*2:e.x,i?e.y*2:e.y,r);let d=s;c<0&&(d=QU(d)),l<0&&(d=JU(d)),i&&(a.center=t.center);const h=d==="top"||d==="bottom",p=d==="left"||d==="right",f=Qx(d,a),y=this.getSnappablePoints(),m=[],x=[],w=new S(o,o);this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:f});const b=new S(h?0:((_=m[0])==null?void 0:_.nudge)??0,p?0:((k=x[0])==null?void 0:k.nudge)??0);if(r&&e3(d)&&b.len()!==0){const D=m.length&&x.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":m.length?"x":"y",T=t.aspectRatio;D==="x"?(x.length=0,b.y=b.x/T,(d==="bottom_left"||d==="top_right")&&(b.y=-b.y)):(m.length=0,b.x=b.y*T,(d==="bottom_left"||d==="top_right")&&(b.x=-b.x))}const I=S.Add(e,b),{box:E}=Y.Resize(t,s,i?I.x*2:I.x,i?I.y*2:I.y,r);i&&(E.center=t.center);const P=Qx("any",E);m.length=0,x.length=0,w.x=0,w.y=0,this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:P});const C=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:x});return this.manager.setIndicators([...C]),{nudge:b}}collectPointSnaps({selectionSnapPoints:t,otherNodeSnapPoints:e,minOffset:s,nearestSnapsX:r,nearestSnapsY:i}){for(const o of t)for(const a of e){const c=S.Sub(o,a),l=Math.abs(c.x),d=Math.abs(c.y);oe(l)<=oe(s.x)&&(oe(l)<oe(s.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),s.x=l),oe(d)<=oe(s.y)&&(oe(d)<oe(s.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),s.y=d)}}collectGapSnaps({selectionPageBounds:t,minOffset:e,nearestSnapsX:s,nearestSnapsY:r}){const{horizontal:i,vertical:o}=this.getVisibleGaps();for(const a of i){if(!Ia(a.breadthIntersection[0],a.breadthIntersection[1],t.minY,t.maxY))continue;const l=a.startEdge[0].x+a.length/2-t.center.x;if(a.length>t.width&&oe(Math.abs(l))<=oe(e.x)){oe(Math.abs(l))<oe(e.x)&&(s.length=0),e.x=Math.abs(l);const w={type:"gap_center",gap:a,nudge:l},b=s.find(({type:E})=>E==="gap_center"),I=b&&ns(a.breadthIntersection[0],a.breadthIntersection[1],b.gap.breadthIntersection[0],b.gap.breadthIntersection[1]);b&&b.gap.length>a.length&&I?s[s.indexOf(b)]=w:(!b||!I)&&s.push(w)}const h=a.startNode.pageBounds.minX-a.length,p=t.maxX,f=h-p;oe(Math.abs(f))<=oe(e.x)&&(oe(Math.abs(f))<oe(e.x)&&(s.length=0),e.x=Math.abs(f),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const y=a.endNode.pageBounds.maxX+a.length,m=t.minX,x=y-m;oe(Math.abs(x))<=oe(e.x)&&(oe(Math.abs(x))<oe(e.x)&&(s.length=0),e.x=Math.abs(x),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:x}))}for(const a of o){if(!Ia(a.breadthIntersection[0],a.breadthIntersection[1],t.minX,t.maxX))continue;const l=a.startEdge[0].y+a.length/2-t.center.y;if(a.length>t.height&&oe(Math.abs(l))<=oe(e.y)){oe(Math.abs(l))<oe(e.y)&&(r.length=0),e.y=Math.abs(l);const w={type:"gap_center",gap:a,nudge:l},b=r.find(({type:E})=>E==="gap_center"),I=b&&Ia(b.gap.breadthIntersection[0],b.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);b&&b.gap.length>a.length&&I?r[r.indexOf(b)]=w:(!b||!I)&&r.push(w);continue}const h=a.startNode.pageBounds.minY-a.length,p=t.maxY,f=h-p;oe(Math.abs(f))<=oe(e.y)&&(oe(Math.abs(f))<oe(e.y)&&(r.length=0),e.y=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const y=a.endNode.pageBounds.maxY+a.length,m=t.minY,x=y-m;oe(Math.abs(x))<=oe(e.y)&&(oe(Math.abs(x))<oe(e.y)&&(r.length=0),e.y=Math.abs(x),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:t,nearestSnapsY:e}){const s={},r={};if(t.length>0){for(const i of t)if(i.type==="points"){const o=oe(i.points.otherPoint.x);s[o]||(s[o]=[]),s[o].push(i.points)}}if(e.length>0){for(const i of e)if(i.type==="points"){const o=oe(i.points.otherPoint.y);r[o]||(r[o]=[]),r[o].push(i.points)}}return Object.values(s).concat(Object.values(r)).map(i=>({id:Qe(),type:"points",points:Mm(i.map(o=>S.From(o.otherPoint)).concat(i.map(o=>S.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:t,nearestSnapsX:e,nearestSnapsY:s}){const{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:t.sides[0],right:t.sides[1],bottom:[t.corners[3],t.corners[2]],left:[t.corners[0],t.corners[3]]},a=[];if(e.length>0)for(const c of e){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:h,endNode:p,length:f,endEdge:y}}=c;switch(c.type){case"gap_center":{const m=(f-t.width)/2,x=ns(l[0],l[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Qe(),gaps:[...Xs(i,h.id,m,"backward",x),{startEdge:d,endEdge:o.left},{startEdge:o.right,endEdge:y},...Xs(i,p.id,m,"forward",x)]});break}case"gap_duplicate":{const m=ns(l[0],l[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Qe(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:d.map(x=>x.clone().addXY(-h.pageBounds.width,0))},{startEdge:d,endEdge:y},...Xs(i,p.id,f,"forward",m)]:[...Xs(i,h.id,f,"backward",m),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(s.length>0)for(const c of s){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:d,startNode:h,endNode:p,length:f,endEdge:y}}=c;switch(c.type){case"gap_center":{const m=(f-t.height)/2,x=ns(l[0],l[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Qe(),gaps:[...Xs(r,h.id,m,"backward",x),{startEdge:d,endEdge:o.top},{startEdge:o.bottom,endEdge:y},...Xs(r,c.gap.endNode.id,m,"forward",x)]});break}case"gap_duplicate":{const m=ns(l[0],l[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Qe(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:d.map(x=>x.clone().addXY(0,-h.pageBounds.height))},{startEdge:d,endEdge:y},...Xs(r,p.id,f,"forward",m)]:[...Xs(r,h.id,f,"backward",m),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:o.top}]})}break}}return G5(a),a}}nh([K],Nc.prototype,"getSnapPointsCache");nh([K],Nc.prototype,"getSnappablePoints");nh([K],Nc.prototype,"getSnappableGapNodes");nh([K],Nc.prototype,"getVisibleGaps");function Qx(n,t){const{minX:e,maxX:s,minY:r,maxY:i}=t,o=[];switch(n){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:e,y:r})}switch(n){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:s,y:r})}switch(n){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:s,y:i})}switch(n){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:e,y:i})}return o}var W5=Object.defineProperty,V5=Object.getOwnPropertyDescriptor,Y5=(n,t,e,s)=>{for(var r=V5(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&W5(t,e,r),r};const X5=()=>null,q5=()=>[];class uP{constructor(t){g(this,"editor");this.manager=t,this.editor=t.editor}getSnapGeometryCache(){const{editor:t}=this;return t.store.createComputedCache("handle snap geometry",e=>{const s=t.getShapeUtil(e).getHandleSnapGeometry(e);return{outline:s.outline===void 0?t.getShapeGeometry(e):s.outline,points:s.points??[],getSelfSnapOutline:s.getSelfSnapOutline??X5,getSelfSnapPoints:s.getSelfSnapPoints??q5}})}*iterateSnapPointsInPageSpace(t,e){var r,i;const s=(r=this.getSnapGeometryCache().get(t))==null?void 0:r.getSelfSnapPoints(e);if(s&&s.length){const o=Gn(this.editor.getShapePageTransform(t));for(const a of s)yield o.applyToPoint(a)}for(const o of this.manager.getSnappableShapes()){if(o===t)continue;const a=(i=this.getSnapGeometryCache().get(o))==null?void 0:i.points;if(!a||!a.length)continue;const c=Gn(this.editor.getShapePageTransform(o));for(const l of a)yield c.applyToPoint(l)}}*iterateSnapOutlines(t,e){var r,i;const s=(r=this.getSnapGeometryCache().get(t))==null?void 0:r.getSelfSnapOutline(e);s&&(yield{shapeId:t,outline:s});for(const o of this.manager.getSnappableShapes()){if(o===t)continue;const a=(i=this.getSnapGeometryCache().get(o))==null?void 0:i.outline;a&&(yield{shapeId:o,outline:a})}}getHandleSnapPosition({currentShapeId:t,handle:e,handleInPageSpace:s}){const r=this.manager.getSnapThreshold();let i=r,o=null;for(const l of this.iterateSnapPointsInPageSpace(t,e))S.DistMin(s,l,i)&&(i=S.Dist(s,l),o=l);if(o)return o;let a=r,c=null;for(const{shapeId:l,outline:d}of this.iterateSnapOutlines(t,e)){const h=Gn(this.editor.getShapePageTransform(l)),p=this.editor.getPointInShapeSpace(l,s),f=d.nearestPoint(p),y=h.applyToPoint(f);S.DistMin(s,y,a)&&(a=S.Dist(s,y),c=y)}return c||null}snapHandle({currentShapeId:t,handle:e}){const r=Gn(this.editor.getShapePageTransform(t)).applyToPoint(e),i=this.getHandleSnapPosition({currentShapeId:t,handle:e,handleInPageSpace:r});return i?(this.manager.setIndicators([{id:Qe(),type:"points",points:[i]}]),{nudge:S.Sub(i,r)}):null}}Y5([K],uP.prototype,"getSnapGeometryCache");var Z5=Object.defineProperty,J5=Object.getOwnPropertyDescriptor,ay=(n,t,e,s)=>{for(var r=J5(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&Z5(t,e,r),r};class sh{constructor(t){g(this,"shapeBounds");g(this,"handles");g(this,"_snapIndicators",Ct("snapLines",void 0));this.editor=t,this.shapeBounds=new Nc(this),this.handles=new uP(this)}getIndicators(){return this._snapIndicators.get()??tr}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(t){this._snapIndicators.set(t)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:t}=this,e=t.getViewportPageBounds(),s=t.getSelectedShapeIds(),r=new Set,i=o=>{if(pn(o)){const c=t.getShape(o);c&&t.isShapeOfType(c,"frame")&&r.add(o)}const a=t.getSortedChildIdsForParent(o);for(const c of a){if(s.includes(c))continue;const l=t.getShape(c);if(!l||!t.getShapeUtil(l).canSnap(l))continue;const h=t.getShapePageBounds(c);if(h&&e.includes(h)){if(t.isShapeOfType(l,"group")){i(c);continue}r.add(c)}}};return i(this.getCurrentCommonAncestor()??t.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}ay([K],sh.prototype,"getSnapThreshold");ay([K],sh.prototype,"getSnappableShapes");ay([K],sh.prototype,"getCurrentCommonAncestor");const Q5=/\r?\n|\r/g;function eb(n){return n.replace(Q5,`
`).split(`
`).map(t=>t||" ").join(`
`)}const e4={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},t4=/\s/;class n4{constructor(t){g(this,"baseElm");g(this,"measureText",(t,e)=>{var o;const s=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",s),s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("font-family",e.fontFamily),s.style.setProperty("font-style",e.fontStyle),s.style.setProperty("font-weight",e.fontWeight),s.style.setProperty("font-size",e.fontSize+"px"),s.style.setProperty("line-height",e.lineHeight*e.fontSize+"px"),s.style.setProperty("max-width",e.maxWidth===null?null:e.maxWidth+"px"),s.style.setProperty("min-width",e.minWidth===null?null:e.minWidth+"px"),s.style.setProperty("padding",e.padding),s.style.setProperty("overflow-wrap",e.disableOverflowWrapBreaking?"normal":"break-word"),s.textContent=eb(t);const r=s.scrollWidth,i=s.getBoundingClientRect();return s.remove(),{x:0,y:0,w:i.width,h:i.height,scrollWidth:r}});this.editor=t;const e=this.editor.getContainer(),s=document.createElement("div");s.classList.add("tl-text"),s.classList.add("tl-text-measure"),s.tabIndex=-1,e.appendChild(s),this.baseElm=s,t.disposables.add(()=>{s.remove()})}measureElementTextNodeSpans(t,{shouldTruncateToFirstLine:e=!1}={}){const s=[],r=t.getBoundingClientRect(),i=-r.left,o=-r.top,a=new Range,c=t.childNodes[0];let l=0,d=null,h=null,p=0,f=0,y=!1;for(const m of t.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const x of m.textContent??""){a.setStart(c,l),a.setEnd(c,l+x.length);const w=a.getClientRects(),b=w[w.length-1],I=b.top+o,E=b.left+i,P=b.right+i,C=E<f,_=t4.test(x);if(_!==h||I!==p||!d){if(d){if(e&&I!==p){y=!0;break}s.push(d)}d={box:{x:E,y:I,w:b.width,h:b.height},text:x},f=E}else C&&(d.box.x=E),d.box.w=C?d.box.w+b.width:P-d.box.x,d.text+=x;x===`
`&&(f=0),h=_,p=I,l+=x.length}return d&&s.push(d),{spans:s,didTruncate:y}}measureTextSpans(t,e){var l;if(t==="")return[];const s=(l=this.baseElm)==null?void 0:l.cloneNode();this.baseElm.insertAdjacentElement("afterend",s);const r=Math.ceil(e.width-e.padding*2);s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("width",`${r}px`),s.style.setProperty("height","min-content"),s.style.setProperty("font-size",`${e.fontSize}px`),s.style.setProperty("font-family",e.fontFamily),s.style.setProperty("font-weight",e.fontWeight),s.style.setProperty("line-height",`${e.lineHeight*e.fontSize}px`),s.style.setProperty("text-align",e4[e.textAlign]);const i=e.overflow==="truncate-ellipsis"||e.overflow==="truncate-clip";i&&(s.style.setProperty("overflow-wrap","anywhere"),s.style.setProperty("word-break","break-all"));const o=eb(t);s.textContent=o;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:i});if(e.overflow==="truncate-ellipsis"&&c){s.textContent="â¦";const d=Math.ceil(this.measureElementTextNodeSpans(s).spans[0].box.w);s.style.setProperty("width",`${r-d}px`),s.textContent=o;const h=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:!0}).spans,p=h[h.length-1];return h.push({text:"â¦",box:{x:Math.min(p.box.x+p.box.w,e.width-e.padding-d),y:p.box.y,w:d,h:p.box.h}}),h}return s.remove(),a}}const tb=(typeof process<"u",wC);class s4{constructor(t){g(this,"cancelRaf");g(this,"isPaused",!0);g(this,"now",0);g(this,"start",()=>{var t;this.isPaused=!1,(t=this.cancelRaf)==null||t.call(this),this.cancelRaf=tb(this.tick),this.now=Date.now()});g(this,"tick",()=>{if(this.isPaused)return;const t=Date.now(),e=t-this.now;this.now=t,this.updatePointerVelocity(e),this.editor.emit("frame",e),this.editor.emit("tick",e),this.cancelRaf=tb(this.tick)});g(this,"dispose",()=>{var t;this.isPaused=!0,(t=this.cancelRaf)==null||t.call(this)});g(this,"prevPoint",new S);g(this,"updatePointerVelocity",t=>{const{prevPoint:e,editor:{inputs:{currentScreenPoint:s,pointerVelocity:r}}}=this;if(t===0)return;const i=S.Sub(s,e);this.prevPoint=s.clone();const o=i.len(),a=o?i.div(o):new S(0,0),c=r.clone().lrp(a.mul(o/t),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),r.equals(c)||(this.editor.inputs.pointerVelocity=c)});this.editor=t,this.editor.disposables.add(this.dispose),this.start()}}var r4=Object.defineProperty,i4=Object.getOwnPropertyDescriptor,hs=(n,t,e,s)=>{for(var r=i4(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&r4(t,e,r),r};class Qn{constructor(t,e){g(this,"systemColorScheme",Ct("systemColorScheme","light"));g(this,"updateUserPreferences",t=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...t})});var s;if(this.user=t,this.inferDarkMode=e,window){const r=(s=window.matchMedia)==null?void 0:s.call(window,"(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark"),r==null||r.addEventListener("change",i=>{i.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??xs.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??xs.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??xs.name}getLocale(){return this.user.userPreferences.get().locale??xs.locale}getColor(){return this.user.userPreferences.get().color??xs.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??xs.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??xs.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??xs.isDynamicSizeMode}}hs([K],Qn.prototype,"getUserPreferences");hs([K],Qn.prototype,"getIsDarkMode");hs([K],Qn.prototype,"getEdgeScrollSpeed");hs([K],Qn.prototype,"getAnimationSpeed");hs([K],Qn.prototype,"getId");hs([K],Qn.prototype,"getName");hs([K],Qn.prototype,"getLocale");hs([K],Qn.prototype,"getColor");hs([K],Qn.prototype,"getIsSnapMode");hs([K],Qn.prototype,"getIsWrapMode");hs([K],Qn.prototype,"getIsDynamicResizeMode");const o4={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},a4=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class ee{constructor(t,e){g(this,"performanceTracker");g(this,"id");g(this,"type");g(this,"shapeType");g(this,"initial");g(this,"children");g(this,"parent");g(this,"_path");g(this,"_current");g(this,"_isActive");g(this,"transition",(t,e={})=>{var i;const s=t.split(".");let r=this;for(let o=0;o<s.length;o++){const a=s[o],c=r.getCurrent(),l=(i=r.children)==null?void 0:i[a];if(!l)throw Error(`${r.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==l.id&&(c==null||c.exit(e,a),r._current.set(l),l.enter(e,(c==null?void 0:c.id)||"initial"),!l.getIsActive()))break;r=l}return this});g(this,"handleEvent",t=>{var r;const e=o4[t.name],s=this._current.__unsafe__getWithoutCapture();(r=this[e])==null||r.call(this,t),this._isActive.__unsafe__getWithoutCapture()&&s&&s===this._current.__unsafe__getWithoutCapture()&&s.handleEvent(t)});g(this,"enter",(t,e)=>{var s;if(ft.measurePerformance.get()&&a4.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(s=this.onEnter)==null||s.call(this,t,e),this.children&&this.initial&&this.getIsActive()){const r=this.children[this.initial];this._current.set(r),r.enter(t,e)}});g(this,"exit",(t,e)=>{var s,r;ft.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(s=this.onExit)==null||s.call(this,t,e),this.getIsActive()||(r=this.getCurrent())==null||r.exit(t,e)});g(this,"_currentToolIdMask",Ct("curent tool id mask",void 0));g(this,"onWheel");g(this,"onPointerDown");g(this,"onPointerMove");g(this,"onLongPress");g(this,"onPointerUp");g(this,"onDoubleClick");g(this,"onTripleClick");g(this,"onQuadrupleClick");g(this,"onRightClick");g(this,"onMiddleClick");g(this,"onKeyDown");g(this,"onKeyUp");g(this,"onKeyRepeat");g(this,"onCancel");g(this,"onComplete");g(this,"onInterrupt");g(this,"onTick");g(this,"onEnter");g(this,"onExit");this.editor=t;const{id:s,children:r,initial:i}=this.constructor;this.id=s,this._isActive=Ct("toolIsActive"+this.id,!1),this._current=Ct("toolState"+this.id,void 0),this._path=K("toolPath"+this.id,()=>{const o=this.getCurrent();return this.id+(o?`.${o.getPath()}`:"")}),this.parent=e??{},this.parent?r&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(r().map(o=>[o.id,new o(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",r&&i&&(this.initial=i,this.children=Object.fromEntries(r().map(o=>[o.id,new o(this.editor,this)])),this._current.set(this.children[this.initial]))),this.performanceTracker=new sC}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(t){this._currentToolIdMask.set(t)}}g(ee,"id"),g(ee,"initial"),g(ee,"children");class cd extends ee{constructor(){super(...arguments);g(this,"onKeyDown",e=>{var s;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((s=r.getCurrent())==null?void 0:s.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}})}}g(cd,"id","root"),g(cd,"initial",""),g(cd,"children",()=>[]);var c4=Object.defineProperty,l4=Object.getOwnPropertyDescriptor,Z=(n,t,e,s)=>{for(var r=l4(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&c4(t,e,r),r};class X extends r5{constructor({store:e,user:s,shapeUtils:r,bindingUtils:i,tools:o,getContainer:a,cameraOptions:c,assetOptions:l,initialState:d,autoFocus:h,inferDarkMode:p,options:f}){super();g(this,"options");g(this,"store");g(this,"root");g(this,"disposables",new Set);g(this,"isDisposed",!1);g(this,"_tickManager");g(this,"snaps");g(this,"timers");g(this,"user");g(this,"textMeasure");g(this,"environment");g(this,"scribbles");g(this,"sideEffects");g(this,"edgeScrollManager");g(this,"focusManager");g(this,"getContainer");g(this,"shapeUtils");g(this,"styleProps");g(this,"bindingUtils");g(this,"history");g(this,"_crashingError",null);g(this,"_updateInstanceState",(e,s)=>{this.batch(()=>{this.store.put([{...this.getInstanceState(),...e}])},s)});g(this,"_isChangingStyleTimeout",-1);g(this,"setCursor",e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this));g(this,"_updateCurrentPageState",(e,s)=>{this.batch(()=>{this.store.update(e.id??this.getCurrentPageState().id,r=>({...r,...e}))},{history:"ignore",...s})});g(this,"_cameraOptions",Ct("camera options",_x));g(this,"_viewportAnimation",null);g(this,"_willSetInitialBounds",!0);g(this,"_isLockedOnFollowingUser",Ct("isLockedOnFollowingUser",!1));g(this,"_cameraState",Ct("camera state","idle"));g(this,"_cameraStateTimeoutRemaining",0);g(this,"_decayCameraStateTimeout",e=>{this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))});g(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))});g(this,"_currentPageShapeIds");g(this,"_assetOptions",Ct("asset options",Tx));g(this,"_parentIdsToChildIds");g(this,"animatingShapes",new Map);g(this,"_updateShapes",e=>{this.getInstanceState().isReadonly||this.batch(()=>{var o,a;const s=[];let r,i;for(let c=0,l=e.length;c<l;c++){const d=e[c];d&&(r=this.getShape(d.id),r&&(i=Ws(r,d),i!==r&&(i=((a=(o=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:a.call(o,r,i))??i,s.push(i))))}this.store.put(s)})});g(this,"externalAssetContentHandlers",{file:null,url:null});g(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});g(this,"inputs",{originPagePoint:new S,originScreenPoint:new S,previousPagePoint:new S,previousScreenPoint:new S,currentPagePoint:new S,currentScreenPoint:new S,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new S});g(this,"_clickManager",new D5(this));g(this,"_prevCursor","default");g(this,"_shiftKeyTimeout",-1);g(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});g(this,"_altKeyTimeout",-1);g(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});g(this,"_ctrlKeyTimeout",-1);g(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});g(this,"_restoreToolId","select");g(this,"_pinchStart",1);g(this,"_didPinch",!1);g(this,"_selectedShapeIdsAtPointerDown",[]);g(this,"_longPressTimeout",-1);g(this,"capturedPointerId",null);g(this,"performanceTracker");g(this,"performanceTrackerTimeout",-1);g(this,"dispatch",e=>(this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this));g(this,"_pendingEventsForNextTick",[]);g(this,"_flushEventForTick",e=>{if(this.getCrashingError())return this;const{inputs:s}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,s.shiftKey=!0):!e.shiftKey&&s.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,s.altKey=!0):!e.altKey&&s.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,s.ctrlKey=!0):!e.ctrlKey&&s.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:i,currentPagePoint:o}=s;s.isPointing||(s.isDragging=!1);const a=this.store.unsafeGetWithoutCapture(Yt),c=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(s.isPinching)return;s.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...c.selectedShapeIds]),this._didPinch=!0,s.isPinching=!0,this.interrupt());return}case"pinch":{if(!s.isPinching)return;const{point:{z:d=1},delta:{x:h,y:p}}=e,{x:f,y}=S.SubXY(e.point,a.screenBounds.x,a.screenBounds.y);this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:m,y:x,z:w}=yp(()=>this.getCamera()),{panSpeed:b,zoomSpeed:I}=l;this._setCamera(new S(m+h*b/w-f/w+f/(d*I),x+p*b/w-y/w+y/(d*I),d*I),{immediate:!0});return}case"pinch_end":{if(!s.isPinching)return this;s.isPinching=!1;const{_selectedShapeIdsAtPointerDown:d}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,d.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(d)}));return}}}case"wheel":{if(l.isLocked)return;if(this._updateInputsFromEvent(e),!this.getIsMenuOpen()){const{panSpeed:d,zoomSpeed:h,wheelBehavior:p}=l;if(p!=="none"){this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:f,y,z:m}=yp(()=>this.getCamera()),{x,y:w,z:b=0}=e.delta;let I=p;switch(s.ctrlKey&&(I=p==="pan"?"zoom":"pan"),I){case"zoom":{const{x:E,y:P}=this.inputs.currentScreenPoint;let C=b;p==="zoom"&&(Math.abs(w)>10?C=10*Math.sign(w)/100:C=w/100);const _=m+(C??0)*h*m;this._setCamera(new S(f+(E/_-E)-(E/m-E),y+(P/_-P)-(P/m-P),_),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new S(f+x*d/m,y+w*d/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(s.isPinching)return;this._updateInputsFromEvent(e);const{isPen:d}=e,{isPenMode:h}=a;switch(e.name){case"pointer_down":{if(h&&!d)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===Mx&&(this.capturedPointerId=e.pointerId),s.buttons.add(e.button),s.isPointing=!0,s.isDragging=!1,!h&&d&&this.updateInstanceState({isPenMode:!0}),e.button===Ax?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===vl&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!d&&h)return;const{x:p,y:f,z:y}=yp(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:m,previousScreenPoint:x}=this.inputs,{panSpeed:w}=l,b=S.Sub(m,x);this.setCamera(new S(p+b.x*w/y,f+b.y*w/y,y),{immediate:!0}),this.maybeTrackPerformance("Panning");return}s.isPointing&&!s.isDragging&&S.Dist2(i,o)*this.getZoomLevel()>(a.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/y&&(s.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(s.isDragging=!1,s.isPointing=!1,clearTimeout(this._longPressTimeout),s.buttons.delete(e.button),this.getIsMenuOpen()||a.isPenMode&&!d)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),s.isPanning){s.keys.has("Space")||(s.isPanning=!1);const p=this.inputs.pointerVelocity,f=Math.min(2,p.len());switch(e.button){case Mx:{this.setCursor({type:"grab",rotation:0});break}case vl:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}f>0&&this.slideCamera({speed:f,direction:p})}else e.button===Ax&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.name){case"key_down":{s.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=a.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{s.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(vl)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===vl?e.name="middle_click":e.button===Xm&&(e.name="right_click");const{isPenMode:d}=this.store.unsafeGetWithoutCapture(Yt);if(e.isPen===d){const h=this._clickManager.handlePointerEvent(e);if(e.name!==h.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(h),this.emit("event",h);return}}}return this.root.handleEvent(e),this.emit("event",e),this});this.options={...y5,...f},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new N5({store:e,annotateError:T=>{this.annotateError(T,{origin:"history.batch",willCrashApp:!0}),this.crash(T)}}),this.snaps=new sh(this),this.timers=new DN,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({..._x,...c}),this._assetOptions.set({...Tx,...l}),this.user=new Qn(s??ZI(),p??!1),this.getContainer=a??(()=>document.body),this.textMeasure=new n4(this),this._tickManager=new s4(this);class y extends cd{}g(y,"initial",d??""),this.root=new y(this),this.root.children={};const m=aP(r),x={},w={},b=new Map;for(const T of m){const A=new T(this);x[T.type]=A;const L=RC(T.props??{});w[T.type]=L;for(const j of L.keys())if(!b.has(j.id))b.set(j.id,j);else if(b.get(j.id)!==j)throw Error(`Multiple style props with id "${j.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=x,this.styleProps=w;const I=rP(i),E={};for(const T of I){const A=new T(this);E[T.type]=A}this.bindingUtils=E;for(const T of[...o]){if(Es(this.root.children,T.id))throw Error(`Can't override tool with id "${T.id}"`);this.root.children[T.id]=new T(this,this.root)}this.environment=new R5(this),this.scribbles=new U5(this);const P=(T,A)=>{let L=null;const j=T.selectedShapeIds.filter(H=>!A.has(H));j.length!==T.selectedShapeIds.length&&(L||(L={...T}),L.selectedShapeIds=j);const R=T.erasingShapeIds.filter(H=>!A.has(H));R.length!==T.erasingShapeIds.length&&(L||(L={...T}),L.erasingShapeIds=R),T.hoveredShapeId&&A.has(T.hoveredShapeId)&&(L||(L={...T}),L.hoveredShapeId=null),T.editingShapeId&&A.has(T.editingShapeId)&&(L||(L={...T}),L.editingShapeId=null);const F=T.hintingShapeIds.filter(H=>!A.has(H));return F.length!==T.hintingShapeIds.length&&(L||(L={...T}),L.hintingShapeIds=F),T.focusedGroupId&&A.has(T.focusedGroupId)&&(L||(L={...T}),L.focusedGroupId=null),L};this.sideEffects=this.store.sideEffects;let C=new Map;const _=new Set,k=new Set;let D=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var T,A,L,j;_.clear();for(const R of k){k.delete(R);const F=this.getShape(R);if(!F)continue;const H=this.getShapeUtil(F),U=(T=H.onChildrenChange)==null?void 0:T.call(H,F);U!=null&&U.length&&this.updateShapes(U)}if(D.size){const R=D;D=new Set;for(const F of R){const H=this.getBindingUtil(F);(A=H.onOperationComplete)==null||A.call(H)}}if(C.size){const R=C;C=new Map;for(const F of R.values())(j=(L=this.getBindingUtil(F.binding)).onAfterDelete)==null||j.call(L,F)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(T,A)=>{var L,j,R,F;for(const H of this.getBindingsInvolvingShape(A))D.add(H.type),H.fromId===A.id&&((j=(L=this.getBindingUtil(H)).onAfterChangeFromShape)==null||j.call(L,{binding:H,shapeBefore:T,shapeAfter:A})),H.toId===A.id&&((F=(R=this.getBindingUtil(H)).onAfterChangeToShape)==null||F.call(R,{binding:H,shapeBefore:T,shapeAfter:A}));if(T.parentId!==A.parentId){const H=U=>{var W,te,le,Se;const V=this.getShape(U);if(V)for(const be of this.getBindingsInvolvingShape(V))D.add(be.type),be.fromId===V.id&&((te=(W=this.getBindingUtil(be)).onAfterChangeFromShape)==null||te.call(W,{binding:be,shapeBefore:V,shapeAfter:V})),be.toId===V.id&&((Se=(le=this.getBindingUtil(be)).onAfterChangeToShape)==null||Se.call(le,{binding:be,shapeBefore:V,shapeAfter:V}))};H(A.id),this.visitDescendants(A.id,H)}if(T.parentId!==A.parentId&&un(A.parentId)){const H=new Set([T.id]);this.visitDescendants(T.id,U=>{H.add(U)});for(const U of this.getPageStates()){if(U.pageId===A.parentId)continue;const V=P(U,H);V&&this.store.put([V])}}T.parentId&&pn(T.parentId)&&k.add(T.parentId),A.parentId!==T.parentId&&pn(A.parentId)&&k.add(A.parentId)},beforeDelete:T=>{var R,F,H,U;if(_.has(T.id))return;T.parentId&&pn(T.parentId)&&k.add(T.parentId),_.add(T.id);const A=[];for(const V of this.getBindingsInvolvingShape(T)){D.add(V.type),A.push(V.id);const W=this.getBindingUtil(V);V.fromId===T.id?((R=W.onBeforeIsolateToShape)==null||R.call(W,{binding:V,removedShape:T}),(F=W.onBeforeDeleteFromShape)==null||F.call(W,{binding:V,shape:T})):((H=W.onBeforeIsolateFromShape)==null||H.call(W,{binding:V,removedShape:T}),(U=W.onBeforeDeleteToShape)==null||U.call(W,{binding:V,shape:T}))}A.length&&this.deleteBindings(A);const L=new Set([T.id]),j=ge(this.getPageStates().map(V=>P(V,L)));j.length&&this.store.put(j)}},binding:{beforeCreate:T=>{var L,j;const A=(j=(L=this.getBindingUtil(T)).onBeforeCreate)==null?void 0:j.call(L,{binding:T});return A||T},afterCreate:T=>{var A,L;D.add(T.type),(L=(A=this.getBindingUtil(T)).onAfterCreate)==null||L.call(A,{binding:T})},beforeChange:(T,A)=>{var j,R;const L=(R=(j=this.getBindingUtil(A)).onBeforeChange)==null?void 0:R.call(j,{bindingBefore:T,bindingAfter:A});return L||A},afterChange:(T,A)=>{var L,j;D.add(A.type),(j=(L=this.getBindingUtil(A)).onAfterChange)==null||j.call(L,{bindingBefore:T,bindingAfter:A})},beforeDelete:T=>{var A,L;(L=(A=this.getBindingUtil(T)).onBeforeDelete)==null||L.call(A,{binding:T})},afterDelete:T=>{var A,L;(L=(A=this.getBindingUtil(T)).onAfterDelete)==null||L.call(A,{binding:T}),D.add(T.type)}},page:{afterCreate:T=>{const A=is.createId(T.id),L=Xn.createId(T.id);this.store.has(A)||this.store.put([is.create({id:A})]),this.store.has(L)||this.store.put([Xn.create({id:L,pageId:T.id})])},afterDelete:(T,A)=>{var R,F;if(((R=this.getInstanceState())==null?void 0:R.currentPageId)===T.id){const H=(F=this.getPages().find(U=>U.id!==T.id))==null?void 0:F.id;H?this.store.put([{...this.getInstanceState(),currentPageId:H}]):A==="user"&&this.store.ensureStoreIsUsable()}const L=is.createId(T.id),j=Xn.createId(T.id);this.store.remove([L,j])}},instance:{afterChange:(T,A,L)=>{var j;if(!this.store.has(A.currentPageId)){const R=this.store.has(T.currentPageId)?T.currentPageId:(j=this.getPages()[0])==null?void 0:j.id;R?this.store.update(A.id,F=>({...F,currentPageId:R})):L==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(T,A)=>{if((T==null?void 0:T.selectedShapeIds)!==(A==null?void 0:A.selectedShapeIds)){const L=A.selectedShapeIds.filter(R=>{var H,U;let F=(H=this.getShape(R))==null?void 0:H.parentId;for(;pn(F);){if(A.selectedShapeIds.includes(F))return!1;F=(U=this.getShape(F))==null?void 0:U.parentId}return!0});let j=null;if(L.length>0){const R=this.findCommonAncestor(ge(L.map(F=>this.getShape(F))),F=>this.isShapeOfType(F,"group"));R&&(j=R)}else A!=null&&A.focusedGroupId&&(j=A.focusedGroupId);(L.length!==A.selectedShapeIds.length||j!==A.focusedGroupId)&&this.store.put([{...A,selectedShapeIds:L,focusedGroupId:j??null}])}}}})),this._currentPageShapeIds=k5(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=T5(this.store),this.disposables.add(this.store.listen(T=>{this.emit("change",T)})),this.disposables.add(this.history.dispose),this.history.ignore(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})}),d&&this.root.children[d]===void 0)throw Error(`No state found for initialState "${d}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new O5(this),this.focusManager=new L5(this,h),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new sC}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const s=typeof e=="string"?e:e.type,r=mn(this.shapeUtils,s);return et(r,`No shape util found for type "${s}"`),r}getBindingUtil(e){const s=typeof e=="string"?e:e.type,r=mn(this.bindingUtils,s);return et(r,`No binding util found for type "${s}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return this.history.mark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}batch(e,s){return this.history.batch(e,s),this}annotateError(e,{origin:s,willCrashApp:r,tags:i,extras:o}){const a=this.createErrorAnnotations(s,r);return Am(e,{tags:{...a.tags,...i},extras:{...a.extras,...o}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,s){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:s},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:s},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const s=e.split(".").reverse();let r=this.root;for(;s.length>0;){const i=s.pop();if(!i)return!0;const o=r.getCurrent();if((o==null?void 0:o.id)===i){if(s.length===0)return!0;r=o;continue}else return!1}return!1}isInAny(...e){return e.some(s=>this.isIn(s))}setCurrentTool(e,s={}){return this.root.transition(e,s),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var i;const s=e.split(".").reverse();let r=this.root;for(;s.length>0;){const o=s.pop();if(!o)return r;const a=(i=r.children)==null?void 0:i[o];if(!a)return;r=a}return r}getDocumentSettings(){return this.store.get(og)}updateDocumentSettings(e){return this.history.ignore(()=>{this.store.put([{...this.getDocumentSettings(),...e}])}),this}getInstanceState(){return this.store.get(Yt)}updateInstanceState(e,s){return this._updateInstanceState(e,{history:"ignore",...s}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){const s=new Set(this.getOpenMenus());return s.has(e)||(s.add(e),this.updateInstanceState({openMenus:[...s]})),this}deleteOpenMenu(e){const s=new Set(this.getOpenMenus());return s.has(e)&&(s.delete(e),this.updateInstanceState({openMenus:[...s]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Xn.createId(this.getCurrentPageId())}updateCurrentPageState(e,s){return this._updateCurrentPageState(e,s),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return ge(e.map(s=>this.store.get(s)))}setSelectedShapes(e){return this.batch(()=>{const s=e.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:r}=this.getCurrentPageState(),i=new Set(r);if(s.length===i.size&&s.every(o=>i.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:s}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const s=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(s);if(!r)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,o=>i.includes(o.id))}select(...e){const s=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(s),this}deselect(...e){const s=typeof e[0]=="string"?e:e.map(i=>i.id),r=this.getSelectedShapeIds();return r.length>0&&s.length>0&&this.setSelectedShapes(r.filter(i=>!s.includes(i))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getSelectionPageBounds(){const e=this.getCurrentPageState().selectedShapeIds;return e.length===0?null:Y.Common(ge(e.map(s=>this.getShapePageBounds(s))))}getSelectionRotation(){const e=this.getSelectedShapeIds();let s=!1,r=0;for(let i=0,o=e.length;i<o;i++){const a=this.getShapePageTransform(e[i]);if(a)if(s){if(a.rotation()!==r)return 0}else s=!0,r=a.rotation()}return r}getSelectionRotatedPageBounds(){const e=this.getSelectedShapeIds();if(e.length===0)return;const s=this.getSelectionRotation();if(s===0)return this.getSelectionPageBounds();if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),o=this.getShapePageTransform(e[0]);return i.point=o.applyToPoint(i.point),i}const r=Y.FromPoints(this.getSelectedShapeIds().flatMap(i=>{const o=this.getShapePageTransform(i);return o?o.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-s)));return r.point=r.point.rot(s),r}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:s,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new Y(s,r,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const s=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(s!==null){const r=this.getShape(s);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${s} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return s===this.getFocusedGroupId()?this:this.batch(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:s}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const s=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((s==null?void 0:s.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const s=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(s!==this.getEditingShapeId()){if(s){const r=this.getShape(s);if(r&&this.getShapeUtil(r).canEdit(r))return this._updateCurrentPageState({editingShapeId:s}),this}this._updateCurrentPageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const s=typeof e=="string"?e:(e==null?void 0:e.id)??null;return s===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:s},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return ge(e.map(s=>this.getShape(s)))}setHintingShapes(e){const s=typeof e[0]=="string"?e:e.map(r=>r.id);return this.updateCurrentPageState({hintingShapeIds:Mm(s)},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return ge(e.map(s=>this.getShape(s)))}setErasingShapes(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id);s.sort();const r=this.getErasingShapeIds();return this.history.ignore(()=>{if(s.length===r.length){for(let i=0;i<s.length;i++)if(s[i]!==r[i]){this._updateCurrentPageState({erasingShapeIds:s});break}}else this._updateCurrentPageState({erasingShapeIds:s})}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const s=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(s!==this.getCroppingShapeId())if(!s)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(s),i=this.getShapeUtil(r);r&&i.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:s})}return this}getCameraId(){return is.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this.getCameraId());if(this._isLockedOnFollowingUser.get()){const s=this.getCameraForFollowing();if(s)return{...e,...s}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const s=this.getCollaborators().find(p=>p.userId===e);if(!s)return null;const{w:r,h:i}=s.screenBounds,{x:o,y:a,z:c}=s.camera,l=new Y(-o,-a,r/c,i/c),d=this.getViewportScreenBounds().clone(),h=d.width/d.height;return d.width=l.width,d.height=d.width/h,d.height<l.height&&(d.height=l.height,d.width=d.height*h),d.center=l.center,d}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:s,zy:r}=sb(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(s,r);case"fit-max":return Math.min(s,r);case"fit-x":return s;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(s,r));case"fit-max-100":return Math.min(1,Math.min(s,r));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,r);default:throw Zt(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:s,zy:r}=sb(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(s,r);case"fit-max":return Math.min(s,r);case"fit-x":return s;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(s,r));case"fit-max-100":return Math.min(1,Math.min(s,r));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,r);default:throw Zt(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const s=Je({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=s.zoomSteps)==null?void 0:r.length)<1&&(s.zoomSteps=[1]),this._cameraOptions.set(s),this}getConstrainedCamera(e,s){const r=this.getCamera();let{x:i,y:o,z:a=r.z}=e;if(!(s!=null&&s.force)){const c=this.getCameraOptions(),l=c.zoomSteps[0],d=At(c.zoomSteps),h=this.getViewportScreenBounds();if(c.constraints){const{constraints:p}=c,f=Math.min(p.padding.y,h.w/2),y=Math.min(p.padding.x,h.h/2),m=Y.From(c.constraints.bounds),x=(h.w-y*2)/m.w,w=(h.h-f*2)/m.h,b=this.getBaseZoom(),I=d*b,E=l*b;if(s!=null&&s.reset&&(a=this.getInitialZoom()),a<E||a>I){const{x:j,y:R,z:F}=r,H=-j+h.w/F/2,U=-R+h.h/F/2;a=bt(a,E,I);const V=-j+h.w/a/2,W=-R+h.h/a/2;i=j+V-H,o=R+W-U}const P=y/a-m.x,C=f/a-m.y,_=(h.w-y*2)/a-m.w,k=(h.h-f*2)/a-m.h,D=P+_*p.origin.x,T=C+k*p.origin.y,A=typeof p.behavior=="string"?p.behavior:p.behavior.x,L=typeof p.behavior=="string"?p.behavior:p.behavior.y;if(s!=null&&s.reset)i=D,o=T;else{switch(A){case"fixed":{i=D;break}case"contain":{a<x?i=D:i=bt(i,P+_,P);break}case"inside":{a<x?i=bt(i,P,(h.w-y)/a-m.w):i=bt(i,P+_,P);break}case"outside":{i=bt(i,y/a-m.w,(h.w-y)/a);break}case"free":break;default:throw Zt(A)}switch(L){case"fixed":{o=T;break}case"contain":{a<w?o=T:o=bt(o,C+k,C);break}case"inside":{a<w?o=bt(o,C,(h.h-f)/a-m.h):o=bt(o,C+k,C);break}case"outside":{o=bt(o,f/a-m.h,(h.h-f)/a);break}case"free":break;default:throw Zt(L)}}}else if(a>d||a<l){const{x:p,y:f,z:y}=r;a=bt(a,l,d),i=p+(-p+h.w/a/2)-(-p+h.w/y/2),o=f+(-f+h.h/a/2)-(-f+h.h/y/2)}}return{x:i,y:o,z:a}}_setCamera(e,s){const r=this.getCamera(),{x:i,y:o,z:a}=this.getConstrainedCamera(e,s);return r.x===i&&r.y===o&&r.z===a?this:(this.batch(()=>{const c={...r,x:i,y:o,z:a};this.history.ignore(()=>{this.store.put([c])});const{currentScreenPoint:l,currentPagePoint:d}=this.inputs,{screenBounds:h}=this.store.unsafeGetWithoutCapture(Yt);if(l.x/a-i!==d.x||l.y/a-o!==d.y){const p={type:"pointer",target:"canvas",name:"pointer_move",point:S.AddXY(l,h.x,h.y),pointerId:kx.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};s!=null&&s.immediate?this._flushEventForTick(p):this.dispatch(p)}this._tickCameraState()}),this)}setCamera(e,s){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(s!=null&&s.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=S.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const o=this.getConstrainedCamera(i,s);if(s!=null&&s.animation){const{width:a,height:c}=this.getViewportScreenBounds();this._animateToViewport(new Y(-o.x,-o.y,a/o.z,c/o.z),s)}else this._setCamera(o,{...s,force:!0});return this}centerOnPoint(e,s){if(this.getCameraOptions().isLocked)return this;const{width:r,height:i}=this.getViewportPageBounds();return this.setCamera(new S(-(e.x-r/2),-(e.y-i/2),this.getCamera().z),s),this}zoomToFit(e){const s=[...this.getCurrentPageShapeIds()];if(s.length<=0)return this;const r=Y.Common(ge(s.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),s){const{isLocked:r,constraints:i}=this.getCameraOptions();if(r)return this;const o=this.getCamera(),{x:a,y:c,z:l}=o,{x:d,y:h}=e;let p=1;if(i){const f=this.getInitialZoom();l!==f&&(p=f)}return this.setCamera(new S(a+(d/p-d)-(d/l-d),c+(h/p-h)-(h/l-h),p),s),this}zoomIn(e=this.getViewportScreenCenter(),s){if(this.getCameraOptions().isLocked)return this;const{x:r,y:i,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let l=At(a)*c;for(let d=1;d<a.length;d++){const h=a[d-1]*c,p=a[d]*c;if(!(p-o<=(p-h)/2)){l=p;break}}this.setCamera(new S(r+(e.x/l-e.x)-(e.x/o-e.x),i+(e.y/l-e.y)-(e.y/o-e.y),l),s)}return this}zoomOut(e=this.getViewportScreenCenter(),s){if(this.getCameraOptions().isLocked)return this;const{zoomSteps:r}=this.getCameraOptions();if(r!==null&&r.length>1){const i=this.getBaseZoom(),{x:o,y:a,z:c}=this.getCamera();let l=r[0]*i;for(let d=r.length-1;d>0;d--){const h=r[d-1]*i,p=r[d]*i;if(!(p-c>=(p-h)/2)){l=h;break}}this.setCamera(new S(o+(e.x/l-e.x)-(e.x/c-e.x),a+(e.y/l-e.y)-(e.y/c-e.y),l),s)}return this}zoomToSelection(e){if(this.getCameraOptions().isLocked)return this;const s=this.getSelectionPageBounds();return s&&this.zoomToBounds(s,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,s){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked)return this;const i=this.getViewportScreenBounds(),o=(s==null?void 0:s.inset)??Math.min(Lz,i.width*.28),a=this.getBaseZoom(),c=r.zoomSteps[0],l=At(r.zoomSteps);let d=bt(Math.min((i.width-o)/e.w,(i.height-o)/e.h),c*a,l*a);return(s==null?void 0:s.targetZoom)!==void 0&&(d=Math.min(s.targetZoom,d)),this.setCamera(new S(-e.x+(i.width-e.w*d)/2/d,-e.y+(i.height-e.h*d)/2/d,d),s),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:s,easing:r,duration:i,start:o,end:a}=this._viewportAnimation;if(s>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new S(-a.x,-a.y,this.getViewportScreenBounds().width/a.width));return}const c=i-s,l=r(1-c/i),d=o.minX+(a.minX-o.minX)*l,h=o.minY+(a.minY-o.minY)*l,p=o.maxX+(a.maxX-o.maxX)*l;this._setCamera(new S(-d,-h,this.getViewportScreenBounds().width/(p-d)),{force:!0})}_animateToViewport(e,s={animation:bp}){const{animation:r,...i}=s;if(!r)return;const{duration:o=0,easing:a=It.easeInOutCubic}=r,c=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||c===0?this._setCamera(new S(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:o/c,easing:a,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){if(this.getCameraOptions().isLocked)return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:r,friction:i=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let c=Math.min(r,1);const l=()=>{this.off("tick",d),this.off("stop-camera-animation",l)};this.once("stop-camera-animation",l);const d=h=>{const{x:p,y:f,z:y}=this.getCamera(),m=S.Mul(o,c*h/y);c*=1-i,c<a?l():this._setCamera(new S(p+m.x,f+m.y,y))};return this.on("tick",d),this}zoomToUser(e,s={animation:{duration:500}}){const r=this.getCollaborators().find(i=>i.userId===e);return r?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId),s&&s.animation&&!i&&(s.animation=void 0),this.centerOnPoint(r.cursor,s);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],c=a.indexOf(e);c<0||(a.splice(c,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,s=!1){e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!Nr(document.body.scrollWidth,e.maxX,1),!Nr(document.body.scrollHeight,e.maxY,1),e.minX!==0],{screenBounds:i,insets:o}=this.getInstanceState();if(e.equals(i)&&r.every((c,l)=>c===o[l]))return this;const{_willSetInitialBounds:a}=this;if(this._willSetInitialBounds=!1,a)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(s&&!this.getInstanceState().followingUserId){const c=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(c)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(S.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:s,w:r,h:i}=this.getInstanceState().screenBounds;return new Y(e,s,r,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new S(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:s}=this.getViewportScreenBounds(),{x:r,y:i,z:o}=this.getCamera();return new Y(-r,-i,e/o,s/o)}screenToPage(e){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(Yt),{x:r,y:i,z:o=1}=this.getCamera();return new S((e.x-s.x)/o-r,(e.y-s.y)/o-i,e.z??.5)}pageToScreen(e){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(Yt),{x:r,y:i,z:o=1}=this.getCamera();return new S((e.x+r)*o+s.x,(e.y+i)*o+s.y,e.z??.5)}pageToViewport(e){const{x:s,y:r,z:i=1}=this.getCamera();return new S((e.x+s)*i,(e.y+r)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(o=>o.userId===r).sort((o,a)=>a.lastActivityTimestamp-o.lastActivityTimestamp)[0]):tr}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(s=>s.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const s=this._getCollaboratorsQuery().get().filter(o=>o.userId===e);if(!s.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),s.some(o=>o.followingUserId===r))return this;const i=K("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===e));return $r(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const o=ei("update current page",()=>{const l=i.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.history.ignore(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)})}),a=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",c),this.off("stop-following",a)},c=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const d=this.user.getAnimationSpeed();if(d===0){this._isLockedOnFollowingUser.set(!0);return}const h=this.getViewportPageBoundsForFollowing();if(!h){this.stopFollowingUser();return}const p=this.getViewportPageBounds(),f=Math.abs(h.minX-p.minX)+Math.abs(h.maxX-p.maxX),y=Math.abs(h.minY-p.minY)+Math.abs(h.maxY-p.maxY);if(f<this.options.followChaseViewportSnap&&y<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const m=bt(d*.5,.1,.8),x=new Y(fl(p.minX,h.minX,m),fl(p.minY,h.minY,m),fl(p.width,h.width,m),fl(p.height,h.height,m)),w=new S(-x.x,-x.y,this.getViewportScreenBounds().width/x.width);this.stopCameraAnimation(),this._setCamera(w)};this.once("stop-following",a),this.addListener("frame",c),c()}),this}stopFollowingUser(){return this.history.ignore(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")}),this}getUnorderedRenderingShapes(e){const s=[];let r=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),a=(l,d,h)=>{const p=this.getShape(l);if(!p)return;d*=p.opacity;let f=!1;const y=this.getShapeUtil(p);e&&(f=!h&&o.includes(l),f&&(d*=.32)),s.push({id:l,shape:p,util:y,index:r,backgroundIndex:i,opacity:d}),r+=1,i+=1;const m=this.getSortedChildIdsForParent(l);if(!m.length)return;let x=null;y.providesBackgroundForChildren(p)&&(x=i,i=r,r+=this.options.maxShapesPerPage);for(const w of m)a(w,d,h||f);x!==null&&(i=x)},c=e?[this.getCurrentPage()]:this.getPages();for(const l of c)for(const d of this.getSortedChildIdsForParent(l.id))a(d,1,!1);return s}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(_N)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Xt)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const s=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:s}});return this.getShapeAndDescendantIds(r.map(i=>i.id))}setCurrentPage(e){const s=typeof e=="string"?e:e.id;return this.store.has(s)?(this.stopFollowingUser(),this.complete(),this.batch(()=>this.store.put([{...this.getInstanceState(),currentPageId:s}]),{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getInstanceState().isReadonly?this:this.getPage(e.id)?this.batch(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.history.batch(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const s=this.getPages(),r=x5(e.name??"Page 1",s.map(a=>a.name));let i=e.index;(!i||s.some(a=>a.index===i))&&(i=Zs(s[s.length-1].index));const o=ar.create({meta:{},...e,name:r,index:i});this.store.put([o])}),this}deletePage(e){const s=typeof e=="string"?e:e.id;return this.batch(()=>{if(this.getInstanceState().isReadonly)return;const r=this.getPages();if(r.length===1)return;const i=this.getPage(s);if(i){if(s===this.getCurrentPageId()){const o=r.findIndex(c=>c.id===s),a=r[o-1]??r[o+1];this.setCurrentPage(a.id)}this.store.remove([i.id])}}),this}duplicatePage(e,s=ar.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,i=this.getPage(r);if(!i)return this;const o={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.batch(()=>{var d;const c=this.getPages(),l=tc(i.index,(d=c[c.indexOf(i)+1])==null?void 0:d.index);if(this.createPage({name:i.name+" Copy",id:s,index:l}),this.setCurrentPage(s),this.setCamera(o),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(e,s){const r=typeof e=="string"?e:e.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:r,name:s}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.history.ignore(()=>this.store.put(e)),this)}updateAssets(e){return this.getInstanceState().isReadonly?this:e.length<=0?this:(this.history.ignore(()=>{this.store.put(e.map(s=>({...this.store.get(s.id),...s})))}),this)}deleteAssets(e){if(this.getInstanceState().isReadonly)return this;const s=typeof e[0]=="string"?e:e.map(r=>r.id);return s.length<=0?this:(this.history.ignore(()=>this.store.remove(s)),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,s){if(!e)return"";const r=this.getAsset(e);if(!r)return"";const{screenScale:i,shouldResolveToOriginalImage:o}=s,c=Math.max(.125,(h=>Math.pow(2,Math.ceil(Math.log2(h))))(i||1)),l="connection"in navigator?navigator.connection.effectiveType:null,d=this.getInstanceState().devicePixelRatio;return await this._assetOptions.get().onResolveAsset(r,{screenScale:i||1,steppedScreenScale:c,dpr:d,networkEffectiveType:l,shouldResolveToOriginalImage:o})}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,s)=>e.props===s.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var s,r;return(r=(s=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(s,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const s=typeof e=="string"?e:e.id,r=this.getShape(s);if(!r)throw Error("Editor.getTransform: shape not found");return Q.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(un(e.parentId))return this.getShapeLocalTransform(e);const s=this._getShapePageTransformCache().get(e.parentId)??Q.Identity();return Q.Compose(s,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const s=typeof e=="string"?e:e.id,r=this.getShape(s);return!r||un(r.parentId)?Q.Identity():this._getShapePageTransformCache().get(r.parentId)??Q.Identity()}getShapePageTransform(e){const s=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(s)??Q.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const s=this._getShapePageTransformCache().get(e.id);return s?Y.FromPoints(Q.applyToPoints(s,this.getShapeGeometry(e).vertices)):new Y})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const s=this._getShapeMaskCache().get(e.id);if(!s)return;if(s.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${Q.applyToPoints(Q.Inverse(r),s).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(un(e.parentId))return;const s=this.getShapeAncestors(e.id).filter(i=>this.isShapeOfType(i,"frame"));return s.length===0?void 0:s.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,o)=>{if(!(o&&i))return;const a=qx(i,o);return a?a.map(S.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const s=this._getShapePageBoundsCache().get(e.id);if(!s)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:i}=s;if(i.every((a,c)=>a&&S.Equals(a,r[c])))return s.clone();const o=qx(r,i);return o?Y.FromPoints(o):void 0}return s})}getShapeAncestors(e,s=[]){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return s;const o=i.parentId;if(un(o))return s.reverse(),s;const a=this.store.get(o);return a?(s.push(a),this.getShapeAncestors(a,s)):s}findShapeAncestor(e,s){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return;const o=i.parentId;if(un(o))return;const a=this.getShape(o);if(a)return s(a)?a:this.findShapeAncestor(a,s)}hasAncestor(e,s){const r=typeof e=="string"?e:e==null?void 0:e.id,i=r&&this.getShape(r);return i?i.parentId===s?!0:this.hasAncestor(this.getShapeParent(i),s):!1}findCommonAncestor(e,s){var l;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(d=>d.id),i=ge(r.map(d=>this.getShape(d)));if(i.length===1){const d=i[0].parentId;return un(d)?void 0:s?(l=this.findShapeAncestor(i[0],s))==null?void 0:l.id:d}const[o,...a]=i;let c=this.getShapeParent(o);for(;c;){if(s&&!s(c)){c=this.getShapeParent(c);continue}if(a.every(d=>this.hasAncestor(d,c.id)))return c.id;c=this.getShapeParent(c)}}isShapeOrAncestorLocked(e){const s=typeof e=="string"?this.getShape(e):e;return s===void 0?!1:s.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(s))}_notVisibleShapes(){return _5(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),s=this.getSelectedShapeIds(),r=this.getEditingShapeId(),i=new Set(e);return r&&i.delete(r),s.forEach(o=>{i.delete(o)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(s=>{const r=this.getShapeMaskedPageBounds(s);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const s=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&s.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,s={}){const r=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:o,margin:a=0,hitLocked:c=!1,hitLabels:l=!1,hitInside:d=!1,hitFrameInside:h=!1}=s;let p=1/0,f=null,y=1/0,m=null;const x=(s.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(w.isLocked&&!c||this.isShapeOfType(w,"group"))return!1;const b=this.getShapeMask(w);return b&&!On(e,b)?!1:o?o(w):!0});for(let w=x.length-1;w>=0;w--){const b=x[w],I=this.getShapeGeometry(b),E=I instanceof ls,P=this.getPointInShapeSpace(b,e);if((this.isShapeOfType(b,"arrow")||this.isShapeOfType(b,"geo")&&b.props.fill==="none")&&b.props.text.trim()){for(const _ of I.children)if(_.isLabel&&_.isPointInBounds(P))return b}if(this.isShapeOfType(b,"frame")){const _=I.distanceToPoint(P,d);if(Math.abs(_)<=a)return m||b;if(I.hitTestPoint(P,0,!0))return m||f||(h?b:void 0);continue}let C;if(E){let _=1/0;for(const k of I.children){if(k.isLabel&&!l)continue;const D=k.distanceToPoint(P,d);D<_&&(_=D)}C=_}else a===0&&(I.bounds.w<1||I.bounds.h<1)||I.bounds.containsPoint(P,a)?C=I.distanceToPoint(P,d):C=1/0;if(I.isClosed){if(C<=a){if(I.isFilled||E&&I.children[0].isFilled)return m||b;if(this.getShapePageBounds(b).contains(i))continue;if(Math.abs(C)<a)Math.abs(C)<y&&(y=Math.abs(C),m=b);else if(!m){const{area:_}=I;_<p&&(p=_,f=b)}}}else if(C<this.options.hitTestMargin/r)return b}return m||f||void 0}getShapesAtPoint(e,s={}){return this.getCurrentPageShapes().filter(r=>this.isPointInShape(r,e,s))}isPointInShape(e,s,r={}){const{hitInside:i=!1,margin:o=0}=r,a=typeof e=="string"?e:e.id,c=this.getShapeMask(a);return c&&!On(s,c)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(e,s),o,i)}getPointInShapeSpace(e,s){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(s)}getPointInParentSpace(e,s){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return new S(0,0);if(un(i.parentId))return S.From(s);const o=this.getShapePageTransform(i.parentId);return o?o.clone().invert().applyToPoint(s):S.From(s)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],s=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,i=s.length;r<i;r++)hP(this,s[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:s})=>!e.has(s))}isShapeOfType(e,s){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===s:!1}getShape(e){const s=typeof e=="string"?e:e.id;if(pn(s))return this.store.get(s)}getShapeParent(e){const s=typeof e=="string"?e:e==null?void 0:e.id;if(!s)return;const r=this.getShape(s);if(!(r===void 0||!pn(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,s){return s?s.parentId===e.parentId?s:this.findShapeAncestor(s,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,s=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return!1;let o=!1;if(i.parentId===s)o=!0;else{let a=this.getShape(i.parentId);e:for(;a;){if(a.parentId===s){o=!0;break e}a=this.getShape(a.parentId)}}return o}getAncestorPageId(e){const s=typeof e=="string"?e:e==null?void 0:e.id,r=s&&this.getShape(s);if(r)return un(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,s,r){const i=typeof e[0]=="string"?e:e.map(y=>y.id);if(i.length===0)return this;const o=[],a=un(s)?Q.Identity():this.getShapePageTransform(s),c=a.rotation();let l=[];const d=ge(this.getSortedChildIdsForParent(s).map(y=>this.getShape(y)));if(r){const y=d.find(m=>m.index===r);if(y){const m=d[d.indexOf(y)+1];m?l=Fo(r,m.index,i.length):l=gp(r,i.length)}else{const m=d.sort(Xt).find(x=>x.index>r);m?l=Fo(r,m.index,i.length):l=gp(r,i.length)}}else{const y=d.length&&d[d.length-1];l=y?gp(y.index,i.length):nc(i.length)}const h=a.clone().invert(),p=ge(i.map(y=>this.getShape(y))),f=p.filter(y=>y.isLocked);f.length&&this.updateShapes(f.map(({id:y,type:m})=>({id:y,type:m,isLocked:!1})));for(let y=0;y<p.length;y++){const m=p[y],x=this.getShapePageTransform(m);if(!x)continue;const w=x.point();if(!w)continue;const b=h.applyToPoint(w),I=x.rotation()-c;o.push({id:m.id,type:m.type,parentId:s,x:b.x,y:b.y,rotation:I,index:l[y],isLocked:m.isLocked})}return this.updateShapes(o),this}getHighestIndexForParent(e){const s=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[s];if(!r||r.length===0)return"a1";const i=this.getShape(r[r.length-1]);return Zs(i.index)}getSortedChildIdsForParent(e){const s=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[s];return r||tr}visitDescendants(e,s){const r=typeof e=="string"?e:e.id,i=this.getSortedChildIdsForParent(r);for(const o of i)s(o)!==!1&&this.visitDescendants(o,s);return this}getShapeAndDescendantIds(e){const s=new Set;for(const r of e.map(i=>this.getShape(i)).sort(Xt))s.add(r.id),this.visitDescendants(r,i=>{s.add(i)});return s}getDroppingOverShape(e,s=[]){const r=this.getCurrentPageShapesSorted();for(let i=r.length-1;i>=0;i--){const o=r[i];if(this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,s)||s.find(c=>c.id===o.id||this.hasAncestor(o,c.id)))continue;const a=this.getShapeMaskedPageBounds(o.id);if(a&&a.containsPoint(e)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,e),0,!0))return o}}getOutermostSelectableShape(e,s){const r=typeof e=="string"?e:e.id,i=this.getShape(r);let o=i,a=i;const c=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(c==null?void 0:c.id)!==a.id&&!this.hasAncestor(c,a.id)&&((s==null?void 0:s(a))??!0))o=a;else if((c==null?void 0:c.id)===a.id)break;a=this.getShapeParent(a)}return o}_getBindingsIndexCache(){const e=P5(this);return this.store.createComputedCache("bindingsIndex",s=>e.get().get(s.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,s){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.fromId===r&&i.type===s)}getBindingsToShape(e,s){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.toId===r&&i.type===s)}getBindingsInvolvingShape(e,s){const r=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(r)??tr;return s?i.filter(o=>o.type===s):i}createBindings(e){const s=[];for(const r of e){const i=this.getShape(r.fromId),o=this.getShape(r.toId);if(!i||!o||!this.canBindShapes({fromShape:i,toShape:o,binding:r}))continue;const c=this.getBindingUtil(r.type).getDefaultProps(),l=this.store.schema.types.binding.create({...r,id:r.id??Ii(),props:{...c,...r.props}});s.push(l)}return this.store.put(s),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const s=[];for(const r of e){if(!r)continue;const i=this.getBinding(r.id);if(!i)continue;const o=Ws(i,r);if(o===i)continue;const a=this.getShape(o.fromId),c=this.getShape(o.toId);!a||!c||this.canBindShapes({fromShape:a,toShape:c,binding:o})&&s.push(o)}return this.store.put(s),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:s=!1}={}){const r=e.map(i=>typeof i=="string"?i:i.id);return s?this.store.atomic(()=>{var i,o;for(const a of r){const c=this.getBinding(a);if(!c)continue;const l=this.getBindingUtil(c);(i=l.onBeforeIsolateFromShape)==null||i.call(l,{binding:c,removedShape:this.getShape(c.toId)}),(o=l.onBeforeIsolateToShape)==null||o.call(l,{binding:c,removedShape:this.getShape(c.fromId)}),this.store.remove([a])}}):this.store.remove(r),this}deleteBinding(e,s){return this.deleteBindings([e],s)}canBindShapes({fromShape:e,toShape:s,binding:r}){const i=typeof e=="string"?e:e.type,o=typeof s=="string"?s:s.type,a=typeof r=="string"?r:r.type,c={fromShapeType:i,toShapeType:o,bindingType:a};return i===o?this.getShapeUtil(i).canBind(c):this.getShapeUtil(i).canBind(c)&&this.getShapeUtil(o).canBind(c)}rotateShapesBy(e,s){if((typeof e[0]=="string"?e:e.map(o=>o.id)).length<=0)return this;const i=cP({editor:this});return i?(ad({delta:s,snapshot:i,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(e,s){var o,a,c;let r=e;const i=this.getShapeUtil(e);return r=Ws(r,((o=i.onTranslateStart)==null?void 0:o.call(i,r))??void 0),r=Ws(r,{id:e.id,type:e.type,x:s.x,y:s.y}),r=Ws(r,((a=i.onTranslate)==null?void 0:a.call(i,e,r))??void 0),r=Ws(r,((c=i.onTranslateEnd)==null?void 0:c.call(i,e,r))??void 0),r}nudgeShapes(e,s){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(r.length<=0)return this;const i=[];for(const o of r){const a=this.getShape(o),c=S.From(s),l=this.getShapeParentTransform(a);l&&c.rot(-l.rotation()),i.push(this.getChangesToTranslateShape(a,c.add(a)))}return this.updateShapes(i),this}duplicateShapes(e,s){return this.history.batch(()=>{const r=typeof e[0]=="string"?e:e.map(p=>p.id);if(r.length<=0)return this;const i=new Set(r),o=this.getShapeAndDescendantIds(r),a=[...o].reverse(),c=new Map;for(const p of o)c.set(p,Oe());const{shapesToCreate:l,bindingsToCreate:d}=nb(this,o,p=>{const f=[];for(const m of p){const x=this.getBinding(m);if(!x)continue;const w=Ii();f.push({...x,id:w,fromId:Gn(c.get(x.fromId)),toId:Gn(c.get(x.toId))})}const y=[];for(const m of a){const x=Gn(c.get(m)),w=this.getShape(m);if(!w)continue;let b=0,I=0;if(s&&i.has(m)){const T=this.getShapeParentTransform(w),A=new S(s.x,s.y).rot(-T.rotation());b=A.x,I=A.y}const E=w.parentId,P=this.getSortedChildIdsForParent(E),C=P.indexOf(w.id),_=P[C+1],k=_?this.getShape(_):null,D=k?tc(w.index,k.index):Zs(w.index);y.push({...w,id:x,x:w.x+b,y:w.y+I,index:D,parentId:c.get(w.parentId)??w.parentId})}return{shapesToCreate:y,bindingsToCreate:f}});if(l.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){El(this);return}if(this.createShapes(l),this.createBindings(d),this.setSelectedShapes(ge(r.map(p=>c.get(p)))),s!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,s){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(r.length===0)return this;if(this.getInstanceState().isReadonly)return this;const i=this.getCurrentPageId();if(s===i)return this;if(!this.store.has(s))return this;const o=this.getContentFromCurrentPage(r);if(!o)return this;if(this.getPageShapeIds(s).size+o.shapes.length>this.options.maxShapesPerPage)return El(this,s),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(r),this.setCurrentPage(s),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const s=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getInstanceState().isReadonly||s.length===0)return this;let r=!0,i=!0;const o=[];for(const a of s){const c=this.getShape(a);c&&(o.push(c),c.isLocked?i=!1:r=!1)}return this.batch(()=>{i?(this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(o.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id),r=Pl(this,"toBack",s);return r&&this.updateShapes(r),this}sendBackward(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id),r=Pl(this,"backward",s);return r&&this.updateShapes(r),this}bringForward(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id),r=Pl(this,"forward",s);return r&&this.updateShapes(r),this}bringToFront(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id),r=Pl(this,"toFront",s);return r&&this.updateShapes(r),this}flipShapes(e,s){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let i=ge(r.map(a=>this.getShape(a)));if(!i.length)return this;i=ge(i.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(c=>this.getShape(c)):a).flat());const o=Y.Common(ge(i.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of i){const c=this.getShapeGeometry(a).bounds,l=this.getShapePageTransform(a.id);l&&this.resizeShape(a.id,{x:s==="horizontal"?-1:1,y:s==="vertical"?-1:1},{initialBounds:c,initialPageTransform:l,initialShape:a,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(a).isAspectRatioLocked(a),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(e,s,r){const i=typeof e[0]=="string"?e:e.map(x=>x.id);if(this.getInstanceState().isReadonly)return this;const o=i.map(x=>this.getShape(x)).filter(x=>x?this.getShapeUtil(x).canBeLaidOut(x):!1),a=o.length;if(r===0&&a<3||a<2)return this;const c=Object.fromEntries(o.map(x=>[x.id,this.getShapePageBounds(x)]));let l,d,h,p;s==="horizontal"?(l="x",d="minX",h="maxX",p="width"):(l="y",d="minY",h="maxY",p="height");let f;if(r===0){const x=[];o.sort((b,I)=>c[b.id][d]-c[I.id][d]);for(let b=0;b<a-1;b++){const I=o[b],E=o[b+1],P=c[I.id],_=c[E.id][d]-P[h],k=x.find(D=>D.gap===_);k?k.count++:x.push({gap:_,count:1})}let w=0;x.forEach(b=>{b.count>w&&(w=b.count,f=b.gap)}),w===1&&(f=Math.max(0,x.reduce((b,I)=>b+I.gap*I.count,0)/(a-1)))}else f=r;const y=[];let m=c[o[0].id][h];return o.forEach((x,w)=>{var C,_;if(w===0)return;const b={x:0,y:0};b[l]=m+f-c[x.id][l];const I=this.getShapeParent(x),E=I?S.Rot(b,-this.getShapePageTransform(I).decompose().rotation):b,P=(_=(C=this.getShapeUtil(x)).onTranslateStart)==null?void 0:_.call(C,x);y.push(P?{...P,[l]:x[l]+E[l]}:{id:x.id,type:x.type,[l]:x[l]+E[l]}),m+=c[x.id][p]+f}),this.updateShapes(y),this}packShapes(e,s){var _,k;const r=typeof e[0]=="string"?e:e.map(D=>D.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const i=r.map(D=>this.getShape(D)).filter(D=>D?this.getShapeUtil(D).canBeLaidOut(D):!1),o={},a={};let c,l,d=0;for(let D=0;D<i.length;D++)c=i[D],l=this.getShapePageBounds(c),o[c.id]=l,a[c.id]=l.clone(),d+=l.width*l.height;const h=Y.Common(ge(Object.values(o))),p=h.width;i.sort((D,T)=>o[T.id].height-o[D.id].height);const f=Math.max(Math.ceil(Math.sqrt(d/.95)),p),y=[new Y(h.x,h.y,f,1/0)];let m=0,x=0,w,b;for(let D=0;D<i.length;D++){c=i[D],l=a[c.id];for(let T=y.length-1;T>=0;T--)if(w=y[T],!(l.width>w.width||l.height>w.height)){l.x=w.x,l.y=w.y,x=Math.max(x,l.maxY),m=Math.max(m,l.maxX),l.width===w.width&&l.height===w.height?(b=y.pop(),T<y.length&&(y[T]=b)):l.height===w.height?(w.x+=l.width+s,w.width-=l.width+s):l.width===w.width?(w.y+=l.height+s,w.height-=l.height+s):(y.push(new Y(w.x+(l.width+s),w.y,w.width-(l.width+s),l.height)),w.y+=l.height+s,w.height-=l.height+s);break}}const I=Y.Common(Object.values(a)),E=S.Sub(h.center,I.center);let P;const C=[];for(let D=0;D<i.length;D++){c=i[D],l=o[c.id],P=a[c.id];const T=S.Sub(P.point,l.point).add(E),A=this.getShapeParentTransform(c);A&&T.rot(-A.rotation());const L={id:c.id,type:c.type,x:c.x+T.x,y:c.y+T.y},j=(k=(_=this.getShapeUtil(c)).onTranslateStart)==null?void 0:k.call(_,{...c,...L});j?C.push({...L,...j}):C.push(L)}return C.length&&this.updateShapes(C),this}alignShapes(e,s){const r=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const i=ge(r.map(l=>this.getShape(l))),o=Object.fromEntries(i.map(l=>[l.id,this.getShapePageBounds(l)])),a=Y.Common(ge(Object.values(o))),c=[];return i.forEach(l=>{const d=o[l.id];if(!d)return;const h={x:0,y:0};switch(s){case"top":{h.y=a.minY-d.minY;break}case"center-vertical":{h.y=a.midY-d.minY-d.height/2;break}case"bottom":{h.y=a.maxY-d.minY-d.height;break}case"left":{h.x=a.minX-d.minX;break}case"center-horizontal":{h.x=a.midX-d.minX-d.width/2;break}case"right":{h.x=a.maxX-d.minX-d.width;break}}const p=this.getShapeParent(l),f=p?S.Rot(h,-this.getShapePageTransform(p).decompose().rotation):h;c.push(this.getChangesToTranslateShape(l,S.Add(l,f)))}),this.updateShapes(c),this}distributeShapes(e,s){const r=typeof e[0]=="string"?e:e.map(I=>I.id);if(this.getInstanceState().isReadonly)return this;if(r.length<3)return this;const i=r.length,o=ge(r.map(I=>this.getShape(I))),a=Object.fromEntries(o.map(I=>[I.id,this.getShapePageBounds(I)]));let c,l,d,h,p;s==="horizontal"?(c="x",l="minX",d="maxX",h="midX",p="width"):(c="y",l="minY",d="maxY",h="midY",p="height");const f=[],y=o.sort((I,E)=>a[I.id][l]-a[E.id][l])[0],m=o.sort((I,E)=>a[E.id][d]-a[I.id][d])[0],x=a[y.id][h],w=(a[m.id][h]-x)/(i-1),b=x+w;return o.filter(I=>I!==y&&I!==m).sort((I,E)=>a[I.id][h]-a[E.id][h]).forEach((I,E)=>{const P={x:0,y:0};P[c]=b+w*E-a[I.id][p]/2-a[I.id][c];const C=this.getShapeParent(I),_=C?S.Rot(P,-this.getShapePageTransform(C).rotation()):P;f.push(this.getChangesToTranslateShape(I,S.Add(I,_)))}),this.updateShapes(f),this}stretchShapes(e,s){const r=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(r.length<2)return this;const i=ge(r.map(l=>this.getShape(l))),o=Object.fromEntries(r.map(l=>[l,this.getShapeGeometry(l).bounds])),a=Object.fromEntries(r.map(l=>[l,this.getShapePageBounds(l)])),c=Y.Common(ge(Object.values(a)));switch(s){case"vertical":{this.batch(()=>{for(const l of i){if(this.getShapePageTransform(l).rotation()%je)continue;const h=o[l.id],p=a[l.id],f=new S(0,c.minY-p.minY),y=this.getShapeParentTransform(l);y&&f.rot(-y.rotation());const{x:m,y:x}=S.Add(f,l);this.updateShapes([{id:l.id,type:l.type,x:m,y:x}]);const w=new S(1,c.height/p.height);this.resizeShape(l.id,w,{initialBounds:h,scaleOrigin:new S(p.center.x,c.minY),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const l of i){const d=o[l.id],h=a[l.id];if(this.getShapePageTransform(l).rotation()%je)continue;const f=new S(c.minX-h.minX,0),y=this.getShapeParentTransform(l);y&&f.rot(-y.rotation());const{x:m,y:x}=S.Add(f,l);this.updateShapes([{id:l.id,type:l.type,x:m,y:x}]);const w=new S(c.width/h.width,1);this.resizeShape(l.id,w,{initialBounds:d,scaleOrigin:new S(c.minX,h.center.y),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}}return this}resizeShape(e,s,r={}){var y,m,x;const i=typeof e=="string"?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(s.x)||(s=new S(1,s.y)),Number.isFinite(s.y)||(s=new S(s.x,1));const o=r.initialShape??this.getShape(i);if(!o)return this;const a=r.scaleOrigin??((y=this.getShapePageBounds(i))==null?void 0:y.center);if(!a)return this;const c=r.initialPageTransform?Q.Cast(r.initialPageTransform):this.getShapePageTransform(i);if(!c)return this;const l=c.rotation();if(l==null)return this;const d=r.scaleAxisRotation??l,h=r.initialBounds??this.getShapeGeometry(i).bounds;if(!h)return this;const p=r.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!vI(l,d))return this._resizeUnalignedShape(i,s,{...r,initialBounds:h,scaleOrigin:a,scaleAxisRotation:d,initialPageTransform:c,isAspectRatioLocked:p,initialShape:o});const f=this.getShapeUtil(o);if(p&&(Math.abs(s.x)>Math.abs(s.y)?s=new S(s.x,Math.sign(s.y)*Math.abs(s.x)):s=new S(Math.sign(s.x)*Math.abs(s.y),s.y)),f.onResize&&f.canResize(o)){const w=this._scalePagePoint(Q.applyToPoint(c,new S(0,0)),a,s,d),b=this.getPointInParentSpace(o.id,w),I=new S(s.x,s.y),E=Nr((l-d)%Math.PI,0);I.x=E?s.x:s.y,I.y=E?s.y:s.x;const P=Q.applyToPoint(c,new S),{x:C,y:_}=this.getPointInParentSpace(o.id,P);let k=o;r.skipStartAndEndCallbacks||(k=Ws(o,((m=f.onResizeStart)==null?void 0:m.call(f,o))??void 0)),k=Ws(k,{id:i,type:o.type,x:b.x,y:b.y,...f.onResize({...o,x:C,y:_},{newPoint:b,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:I.x,scaleY:I.y,initialBounds:h,initialShape:o})}),r.skipStartAndEndCallbacks||(k=Ws(k,((x=f.onResizeEnd)==null?void 0:x.call(f,o,k))??void 0)),this.updateShapes([k])}else{const w=Q.applyToPoint(c,h.center),b=this._scalePagePoint(w,a,s,d),I=this.getPointInParentSpace(o.id,w),E=this.getPointInParentSpace(o.id,b),P=S.Sub(E,I);this.updateShapes([{id:i,type:o.type,x:o.x+P.x,y:o.y+P.y}])}return this}_scalePagePoint(e,s,r,i){const o=S.RotWith(e,s,-i).sub(s),a=S.MulV(o,r);return S.Add(a,s).rotWith(s,i)}_resizeUnalignedShape(e,s,r){const{type:i}=r.initialShape,o=new S(s.x,s.y);if(Math.abs(s.x)>Math.abs(s.y)?o.x=Math.sign(s.x)*Math.abs(s.y):o.y=Math.sign(s.y)*Math.abs(s.x),this.resizeShape(e,o,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(s.x)*Math.sign(s.y)<0){let{rotation:w}=Q.Decompose(r.initialPageTransform);w-=2*w,this.updateShapes([{id:e,type:i,rotation:w}])}const a=Q.applyToPoint(r.initialPageTransform,r.initialBounds.center),c=this._scalePagePoint(a,r.scaleOrigin,s,r.scaleAxisRotation),l=this.getShapePageBounds(e),d=this.getShapePageTransform(e),h=l.center,p=d.point();if(!h||!p)return this;const f=S.Sub(c,h),y=S.Add(p,f),{x:m,y:x}=this.getPointInParentSpace(e,y);return this.updateShapes([{id:e,type:i,x:m,y:x}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(e.length<=0)return this;const s=this.getCurrentPageShapeIds();if(e.length+s.size>this.options.maxShapesPerPage)return El(this),this;const i=this.getFocusedGroupId();return this.batch(()=>{var h,p;const o=this.getCurrentPageShapesSorted(),a=e.map(f=>{if(f.id||(f={id:Oe(),...f}),!f.parentId||!(this.store.has(f.parentId)||e.some(y=>y.id===f.parentId))){let y=this.getFocusedGroupId();for(let x=o.length-1;x>=0;x--){const w=o[x];if(this.getShapeUtil(w).canReceiveNewChildrenOfType(w,f.type)&&this.isPointInShape(w,{x:f.x??0,y:f.y??0},{margin:0,hitInside:!0})){y=w.id;break}}const m=f.parentId;if(y===f.id&&(y=i),y!==m&&(f={...f},f.parentId=y,pn(y))){const x=this.getPointInShapeSpace(this.getShape(y),{x:f.x??0,y:f.y??0});f.x=x.x,f.y=x.y,f.rotation=-this.getShapePageTransform(y).rotation()+(f.rotation??0)}}return f}),c=new Map,l=[],{opacityForNextShape:d}=this.getInstanceState();for(const f of a){const y=this.getShapeUtil(f);let m=f.index;if(!m){const I=f.parentId??i;c.has(I)||c.set(I,this.getHighestIndexForParent(I)),m=c.get(I),c.set(I,Zs(m))}const x=y.getDefaultProps();for(const[I,E]of this.styleProps[f.type])x[E]=this.getStyleForNextShape(I);let w=this.store.schema.types.shape.create({...f,index:m,opacity:f.opacity??d,parentId:f.parentId??i,props:"props"in f?{...x,...f.props}:x});if(w.index===void 0)throw Error("no index!");const b=(p=(h=this.getShapeUtil(w)).onBeforeCreate)==null?void 0:p.call(h,w);b&&(w=b),l.push(w)}l.forEach(f=>{f.meta={...this.getInitialMetaForShape(f),...f.meta}}),this.store.put(l)})}animateShape(e,s={animation:bp}){return this.animateShapes([e],s)}animateShapes(e,s={animation:bp}){if(!s.animation)return this;const{duration:r=500,easing:i=It.linear}=s.animation,o=Qe();let a=r,c;const l=[];let d,h;for(let y=0,m=e.length;y<m;y++){if(d=e[y],!d)continue;h={partial:d,values:[]};const x=this.getShape(d.id);if(x){for(const w of["x","y","rotation"])d[w]!==void 0&&x[w]!==d[w]&&h.values.push({prop:w,from:x[w],to:d[w]});l.push(h),this.animatingShapes.set(x.id,o)}}let p;const f=y=>{if(a-=y,a<0){const{animatingShapes:b}=this,I=e.filter(E=>E&&b.get(E.id)===o);I.length&&this.updateShapes(I),this.off("tick",f);return}c=i(1-a/r);const{animatingShapes:m}=this,x=[];let w;for(let b=0,I=l.length;b<I;b++)p=l[b],w=m.get(p.partial.id),w===o&&x.push({id:p.partial.id,type:p.partial.type,...p.values.reduce((E,{prop:P,from:C,to:_})=>(E[P]=C+(_-C)*c,E),{})});this._updateShapes(x)};return this.on("tick",f),this}groupShapes(e,s={}){var m;const{groupId:r=Oe(),select:i=!0}=s;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof e[0]=="string"?e:e.map(x=>x.id);if(o.length<=1)return this;const a=ge(this._getUnlockedShapeIds(o).map(x=>this.getShape(x))),c=a.sort(Xt).map(x=>x.id),l=Y.Common(ge(a.map(x=>this.getShapePageBounds(x)))),{x:d,y:h}=l.point,p=this.findCommonAncestor(a)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const f=a.filter(x=>x.parentId===p).sort(Xt),y=(m=f[f.length-1])==null?void 0:m.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:p,index:y,x:d,y:h,opacity:1,props:{}}]),this.reparentShapes(c,r),i&&this.select(r)}),this}ungroupShapes(e,s={}){const{select:r=!0}=s,i=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return ge(i.map(c=>this.getShape(c))).forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):o.add(c.id)}),a.length===0?this:(this.batch(()=>{let c;for(let l=0,d=a.length;l<d;l++){c=a[l];const h=this.getSortedChildIdsForParent(c.id);for(let p=0,f=h.length;p<f;p++)o.add(h[p]);this.reparentShapes(h,c.parentId,c.index)}this.deleteShapes(a.map(l=>l.id)),r&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const s=Array(e.length);for(let r=0,i=e.length;r<i;r++){const o=e[r];if(!o)continue;const a=this.getShape(o.id);a&&(this.isShapeOrAncestorLocked(a)&&!Object.hasOwn(o,"isLocked")||(this.animatingShapes.delete(o.id),s.push(o)))}return this._updateShapes(s),this}_getUnlockedShapeIds(e){return e.filter(s=>{var r;return!((r=this.getShape(s))!=null&&r.isLocked)})}deleteShapes(e){if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const s=this._getUnlockedShapeIds(typeof e[0]=="string"?e:e.map(o=>o.id));if(this.getInstanceState().isReadonly)return this;if(s.length===0)return this;const r=new Set(s);for(const o of s)this.visitDescendants(o,a=>{r.add(a)});const i=[...r];return this.batch(()=>this.store.remove(i))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,s){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let i=0,o=r.length;i<o;i++)this._extractSharedStyles(this.getShape(r[i]),s)}else for(const[r,i]of this.styleProps[e.type])s.applyValue(r,mn(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),s=new pg;for(const r of e)this._extractSharedStyles(r,s);return s}getStyleForNextShape(e){const s=this.getInstanceState().stylesForNextShape[e.id];return s===void 0?e.defaultValue:s}getShapeStyleIfExists(e,s){const r=this.styleProps[e.type].get(s);if(r!==void 0)return mn(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),s=new pg;if(!e)return s;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())s.applyValue(r,this.getStyleForNextShape(r));return s}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],s=i=>{const o=this.getShape(i);if(o)if(this.isShapeOfType(o,"group"))for(const a of this.getSortedChildIdsForParent(o.id))s(a);else e.push(o)};for(const i of this.getSelectedShapeIds())s(i);let r=null;for(const i of e)if(r===null)r=i.opacity;else if(r!==i.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,s){return this.updateInstanceState({opacityForNextShape:e},s),this}setOpacityForSelectedShapes(e){const s=this.getSelectedShapes();if(s.length>0){const r=[],i=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o);for(const c of a)i(this.getShape(c))}else r.push(o)};for(const o of s)i(o);this.updateShapes(r.map(o=>({id:o.id,type:o.type,opacity:e})))}return this}setStyleForNextShapes(e,s,r){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:s}},r),this}setStyleForSelectedShapes(e,s){const r=this.getSelectedShapes();if(r.length>0){const i=[],o=a=>{if(this.isShapeOfType(a,"group")){const c=this.getSortedChildIdsForParent(a.id);for(const l of c)o(this.getShape(l))}else{const c=this.getShapeUtil(a),l=this.styleProps[a.type].get(e);if(l){const d={id:a.id,type:a.type,props:{[l]:s}};i.push({util:c,originalShape:a,updatePartial:d})}}};for(const a of r)o(a);this.updateShapes(i.map(({updatePartial:a})=>a))}return this}registerExternalAssetHandler(e,s){return this.externalAssetContentHandlers[e]=s,this}async getAssetForExternalContent(e){var s,r;return await((r=(s=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(s,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,s){return this.externalContentHandlers[e]=s,this}async putExternalContent(e){var s,r;return(r=(s=this.externalContentHandlers)[e.type])==null?void 0:r.call(s,e)}getContentFromCurrentPage(e){const s=typeof e[0]=="string"?e:e.map(i=>i.id);if(!s||s.length===0)return;const r=this.getShapeAndDescendantIds(s);return nb(this,r,i=>{const o=[];for(const h of i){const p=this.getBinding(h);p&&o.push(p)}const a=[],c=[];for(const h of r){const p=this.getShape(h);if(!p)continue;if(!r.has(p.parentId)){const y=this.getShapePageTransform(p.id),m=y.point();c.push({...p,x:m.x,y:m.y,rotation:y.rotation(),parentId:this.getCurrentPageId()}),a.push(p.id)}else c.push(p)}const l=[],d=new Set;for(const h of c){if(!("assetId"in h.props))continue;const p=h.props.assetId;if(!p||d.has(p))continue;d.add(p);const f=this.getAsset(p);f&&l.push(f)}return{schema:this.store.schema.serialize(),shapes:c,rootShapeIds:a,bindings:o,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const s=[];return await Promise.allSettled(e.assets.map(async r=>{var i,o;if((r.type==="image"||r.type==="video")&&!((i=r.props.src)!=null&&i.startsWith("data:image"))&&!((o=r.props.src)!=null&&o.startsWith("http"))){const a=Je(r),c=await this._assetOptions.get().onResolveAsset(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginalImage:!0});a.props.src=await vi.blobToDataUrl(await Ms(c).then(l=>l.blob())),s.push(a)}else s.push(r)})),e.assets=s,e}putContentOntoCurrentPage(e,s={}){var A,L;if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:i=!1,preservePosition:o=!1}=s;let{point:a=void 0}=s;const c=this.getCurrentPageId(),{rootShapeIds:l}=e,d=[],h=[],p=[],f={store:{...Object.fromEntries(e.assets.map(j=>[j.id,j])),...Object.fromEntries(e.shapes.map(j=>[j.id,j])),...Object.fromEntries(((A=e.bindings)==null?void 0:A.map(j=>[j.id,j]))??[])},schema:e.schema},y=this.store.schema.migrateStoreSnapshot(f);if(y.type==="error")throw Error("Could not put content: could not migrate content");for(const j of Object.values(y.value))switch(j.typeName){case"asset":{d.push(j);break}case"shape":{h.push(j);break}case"binding":{p.push(j);break}}const m=new Map(i?h.map(j=>[j.id,j.id]):h.map(j=>[j.id,Oe()])),x=new Map(i?p.map(j=>[j.id,j.id]):p.map(j=>[j.id,Ii()]));let w=this.getCurrentPageId(),b=1/0,I=[];for(const j of this.getSelectedShapes()){if(b===0)break;const R=this.isShapeOfType(j,"frame"),F=this.getShapeAncestors(j);R&&F.push(j);const H=R?F.length+1:F.length;if(H<b)b=H,I=F,w=R?j.id:j.parentId;else if(H===b){if(I.length!==F.length)throw Error(`Ancestors: ${I.length} !== ${F.length}`);if(I.length===0){w=c;break}else{w=c;for(let U=0;U<I.length&&F[U]===I[U];U++)w=F[U].id}}}let E=!1;if(!un(w)){const j=this.getShape(w);if(j){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(j)))w=c;else if(l.length===1){const R=h.find(F=>F.id===l[0]);this.isShapeOfType(j,"frame")&&this.isShapeOfType(R,"frame")&&R.props.w===(j==null?void 0:j.props.w)&&R.props.h===(j==null?void 0:j.props.h)&&(E=!0)}}else w=c}E||(E=m.has(w)),E&&(w=this.getShape(w).parentId);let P=this.getHighestIndexForParent(w);const C=[],_=h.map(j=>{const R=m.get(j.id),F={...j,id:R};return l.includes(j.id)&&(F.parentId=c,C.push(F)),m.has(F.parentId)?F.parentId=m.get(j.parentId):(l.push(F.id),F.index=P,P=Zs(P)),F});if(_.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return El(this),this;const k=p.map(j=>({...j,id:Gn(x.get(j.id)),fromId:Gn(m.get(j.fromId)),toId:Gn(m.get(j.toId))})),D=[],T=[];for(const j of d)this.store.has(j.id)||((j.type==="image"||j.type==="video")&&((L=j.props.src)!=null&&L.startsWith("data:image"))&&(T.push(Je(j)),j.props.src=null),D.push(j));return Promise.allSettled(T.map(async j=>{const R=await w5(j.props.src,j.props.name,j.props.mimeType??"image/png"),F=await this.getAssetForExternalContent({type:"file",file:R});if(!F){this.deleteAssets([j.id]);return}this.updateAssets([{...F,id:j.id}])})),this.batch(()=>{D.length>0&&this.createAssets(D),this.createShapes(_),this.createBindings(k),r&&this.select(...C.map(U=>U.id)),w!==c&&this.reparentShapes(C.map(U=>U.id),w);const j=_.map(U=>this.getShape(U.id)),R=Y.Common(j.map(U=>this.getShapePageBounds(U)));if(a===void 0)if(un(w)){const U=this.getViewportPageBounds();o||U.includes(Y.From(R))?a=R.center:a=U.center}else{const U=this.getShape(w);a=Q.applyToPoint(this.getShapePageTransform(U),this.getShapeGeometry(U).bounds.center)}if(C.length===1){const U=C[0];if(this.isShapeOfType(U,"frame"))for(;this.getShapesAtPoint(a).some(V=>this.isShapeOfType(V,"frame")&&V.props.w===U.props.w&&V.props.h===U.props.h);)a.x+=R.w+16}const F=Y.Common(ge(C.map(({id:U})=>this.getShapePageBounds(U)))).center,H=S.Sub(a,F);this.updateShapes(C.map(({id:U})=>{const V=this.getShape(U),W=this.getShapeParentTransform(U).decompose().rotation,te=S.Rot(H,-W);return{id:V.id,type:V.type,x:V.x+te.x,y:V.y+te.y}}))}),this}async getSvgElement(e,s={}){const r=await A5(this,e,s);if(!r)return;const i=document.createDocumentFragment(),o=LA(i);Ic.flushSync(()=>{o.render(r.jsx)});const a=i.firstElementChild;return et(a instanceof SVGSVGElement,"Expected an SVG element"),o.unmount(),{svg:a,width:r.width,height:r.height}}async getSvgString(e,s={}){const r=await this.getSvgElement(e,s);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,s={}){const r=await this.getSvgElement(e,s);if(r)return r.svg}_updateInputsFromEvent(e){const{pointerVelocity:s,previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:a}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(Yt),{x:l,y:d,z:h}=this.store.unsafeGetWithoutCapture(this.getCameraId()),p=e.point.x-c.x,f=e.point.y-c.y,y=e.point.z??.5;r.setTo(o),i.setTo(a),o.set(p,f);const m=p/h-l,x=f/h-d;isFinite(m)&&isFinite(x)&&a.set(m,x,y),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(s.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(a)),this.history.ignore(()=>{var w;this.store.put([{id:rc,typeName:"pointer",x:a.x,y:a.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===kx.CAMERA_MOVE?((w=this.store.unsafeGetWithoutCapture(rc))==null?void 0:w.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return d5(this.store)}loadSnapshot(e){return sP(this.store,e),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_flushEventsForTick(e){this.batch(()=>{if(this._pendingEventsForNextTick.length>0){const s=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of s)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}maybeTrackPerformance(e){ft.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}Z([K],X.prototype,"getCanUndo");Z([K],X.prototype,"getCanRedo");Z([K],X.prototype,"getPath");Z([K],X.prototype,"getCurrentTool");Z([K],X.prototype,"getCurrentToolId");Z([K],X.prototype,"getDocumentSettings");Z([K],X.prototype,"getInstanceState");Z([K],X.prototype,"getOpenMenus");Z([K],X.prototype,"getIsMenuOpen");Z([K],X.prototype,"getPageStates");Z([K],X.prototype,"_getPageStatesQuery");Z([K],X.prototype,"getCurrentPageState");Z([K],X.prototype,"_getCurrentPageStateId");Z([K],X.prototype,"getSelectedShapeIds");Z([K],X.prototype,"getSelectedShapes");Z([K],X.prototype,"getOnlySelectedShapeId");Z([K],X.prototype,"getOnlySelectedShape");Z([K],X.prototype,"getSelectionPageBounds");Z([K],X.prototype,"getSelectionRotation");Z([K],X.prototype,"getSelectionRotatedPageBounds");Z([K],X.prototype,"getSelectionRotatedScreenBounds");Z([K],X.prototype,"getFocusedGroupId");Z([K],X.prototype,"getFocusedGroup");Z([K],X.prototype,"getEditingShapeId");Z([K],X.prototype,"getEditingShape");Z([K],X.prototype,"getHoveredShapeId");Z([K],X.prototype,"getHoveredShape");Z([K],X.prototype,"getHintingShapeIds");Z([K],X.prototype,"getHintingShape");Z([K],X.prototype,"getErasingShapeIds");Z([K],X.prototype,"getErasingShapes");Z([K],X.prototype,"getCameraId");Z([K],X.prototype,"getCamera");Z([K],X.prototype,"getViewportPageBoundsForFollowing");Z([K],X.prototype,"getCameraForFollowing");Z([K],X.prototype,"getZoomLevel");Z([K],X.prototype,"getViewportScreenBounds");Z([K],X.prototype,"getViewportScreenCenter");Z([K],X.prototype,"getViewportPageBounds");Z([K],X.prototype,"_getCollaboratorsQuery");Z([K],X.prototype,"getCollaborators");Z([K],X.prototype,"getCollaboratorsOnCurrentPage");Z([K],X.prototype,"getRenderingShapes");Z([K],X.prototype,"_getAllPagesQuery");Z([K],X.prototype,"getPages");Z([K],X.prototype,"getCurrentPageId");Z([K],X.prototype,"getCurrentPageShapeIdsSorted");Z([K],X.prototype,"_getAllAssetsQuery");Z([K],X.prototype,"_getShapeGeometryCache");Z([K],X.prototype,"_getShapeHandlesCache");Z([K],X.prototype,"_getShapePageTransformCache");Z([K],X.prototype,"_getShapePageBoundsCache");Z([K],X.prototype,"_getShapeClipPathCache");Z([K],X.prototype,"_getShapeMaskCache");Z([K],X.prototype,"_getShapeMaskedPageBoundsCache");Z([K],X.prototype,"_notVisibleShapes");Z([K],X.prototype,"getCulledShapes");Z([K],X.prototype,"getCurrentPageBounds");Z([K],X.prototype,"getCurrentPageShapes");Z([K],X.prototype,"getCurrentPageShapesSorted");Z([K],X.prototype,"getCurrentPageRenderingShapesSorted");Z([K],X.prototype,"_getBindingsIndexCache");Z([K],X.prototype,"_getSelectionSharedStyles");Z([K({isEqual:(n,t)=>n.equals(t)})],X.prototype,"getSharedStyles");Z([K],X.prototype,"getSharedOpacity");Z([K],X.prototype,"getIsFocused");function El(n,t=n.getCurrentPageId()){const e=n.getPage(t).name;n.emit("max-shapes",{name:e,pageId:t,count:n.options.maxShapesPerPage})}function Ws(n,t){if(!t)return n;let e=null;const s=Object.entries(t);for(let r=0,i=s.length;r<i;r++){const[o,a]=s[r];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==n[o]){if(e||(e={...n}),o==="props"||o==="meta"){e[o]={...n[o]};for(const[c,l]of Object.entries(a))l!==void 0&&(e[o][c]=l);continue}e[o]=a}}return e||n}function hP(n,t,e){const s=n.getShape(t);if(!s)return;e.push(s);const r=n.getSortedChildIdsForParent(t);for(let i=0,o=r.length;i<o;i++)hP(n,r[i],e)}function nb(n,t,e){let s;if(n.history.ignore(()=>{const r=n.store.extractingChanges(()=>{const i=new Set,o=new Set;for(const a of t)if(n.getShape(a))for(const l of n.getBindingsInvolvingShape(a)){const d=t.has(l.fromId),h=t.has(l.toId);if(d&&h){i.add(l.id);continue}(!d||!h)&&o.add(l.id)}n.deleteBindings([...o],{isolateShapes:!0});try{s=Lr.ok(e(i))}catch(a){s=Lr.err(a)}});n.store.applyDiff(ng(r))}),s.ok)return s.value;throw s.error}function sb(n,t){if(!t.constraints)throw Error("Should have constraints here");const{padding:{x:e,y:s}}=t.constraints,r=n.getViewportScreenBounds(),i=Y.From(t.constraints.bounds),o=(r.w-e*2)/i.w,a=(r.h-s*2)/i.h;return{zx:o,zy:a}}function Bc(){const n=N(),t=dP();return z("isDarkMode",()=>(t==null?void 0:t.isDarkMode)??n.user.getIsDarkMode(),[t,n])}const rb="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",ib="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",_l='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Ir(n,t,e,s,r,i=16,o=16){const a=(-e-t)*(_e/180),c=Math.sin(a),l=Math.cos(a),d=1*l-1*c,h=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${r};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+e} 16 16)${s?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${i} ${o}, pointer`}const d4=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],u4={none:()=>"none","ew-resize":(n,t,e)=>Ir(ib,n,0,t,e),"ns-resize":(n,t,e)=>Ir(ib,n,90,t,e),"nesw-resize":(n,t,e)=>Ir(rb,n,0,t,e),"nwse-resize":(n,t,e)=>Ir(rb,n,90,t,e),"nwse-rotate":(n,t,e)=>Ir(_l,n,0,t,e),"nesw-rotate":(n,t,e)=>Ir(_l,n,90,t,e),"senw-rotate":(n,t,e)=>Ir(_l,n,180,t,e),"swne-rotate":(n,t,e)=>Ir(_l,n,270,t,e)};function kn(n,t=0,e="black"){return u4[n](jz(t),!1,e)}function h4(){const n=N(),t=Qt(),e=Bc();Fr("useCursor",()=>{const{type:s,rotation:r}=n.getInstanceState().cursor;if(d4.includes(s)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${s})`);return}t.style.setProperty("--tl-cursor",kn(s,r,e?"white":"black"))},[n,t,e])}function p4(){const n=N(),t=Qt(),e=Bc(),s=z(ft.forceSrgb);me.useEffect(()=>{e?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),s?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[n,t,s,e])}function cy(n){const t=v.useRef();return v.useLayoutEffect(()=>{t.current=n}),v.useDebugValue(n),v.useCallback((...e)=>{const s=t.current;return et(s,"fn does not exist"),s(...e)},[])}function f4(){const[n,t]=v.useState(0);v.useEffect(()=>t(e=>e+1),[])}function g4(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
â¢ If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
â¢ If your hard disk is full, try clearing up some space and then reload the page.`)}function m4(){window.alert(`Oops! We could not access your browser's storageâand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
â¢ If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const y4=(n,t)=>t.some(e=>n instanceof e);let ob,ab;function S4(){return ob||(ob=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function w4(){return ab||(ab=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pP=new WeakMap,fg=new WeakMap,fP=new WeakMap,kp=new WeakMap,ly=new WeakMap;function x4(n){const t=new Promise((e,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{e(nr(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&pP.set(e,n)}).catch(()=>{}),ly.set(t,n),t}function b4(n){if(fg.has(n))return;const t=new Promise((e,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});fg.set(n,t)}let gg={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return fg.get(n);if(t==="objectStoreNames")return n.objectStoreNames||fP.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return nr(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function v4(n){gg=n(gg)}function C4(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const s=n.call(Mp(this),t,...e);return fP.set(s,t.sort?t.sort():[t]),nr(s)}:w4().includes(n)?function(...t){return n.apply(Mp(this),t),nr(pP.get(this))}:function(...t){return nr(n.apply(Mp(this),t))}}function I4(n){return typeof n=="function"?C4(n):(n instanceof IDBTransaction&&b4(n),y4(n,S4())?new Proxy(n,gg):n)}function nr(n){if(n instanceof IDBRequest)return x4(n);if(kp.has(n))return kp.get(n);const t=I4(n);return t!==n&&(kp.set(n,t),ly.set(t,n)),t}const Mp=n=>ly.get(n);function gP(n,t,{blocked:e,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,t),a=nr(o);return s&&o.addEventListener("upgradeneeded",c=>{s(nr(o.result),c.oldVersion,c.newVersion,nr(o.transaction),c)}),e&&o.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function P4(n,{blocked:t}={}){const e=indexedDB.deleteDatabase(n);return t&&e.addEventListener("blocked",s=>t(s.oldVersion,s)),nr(e).then(()=>{})}const E4=["get","getKey","getAll","getAllKeys","count"],_4=["put","add","delete","clear"],Ap=new Map;function cb(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Ap.get(t))return Ap.get(t);const e=t.replace(/FromIndex$/,""),s=t!==e,r=_4.includes(e);if(!(e in(s?IDBIndex:IDBObjectStore).prototype)||!(r||E4.includes(e)))return;const i=async function(o,...a){const c=this.transaction(o,r?"readwrite":"readonly");let l=c.store;return s&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),r&&c.done]))[0]};return Ap.set(t,i),i}v4(n=>({...n,get:(t,e,s)=>cb(t,e)||n.get(t,e,s),has:(t,e)=>!!cb(t,e)||n.has(t,e)}));const rh="TLDRAW_DOCUMENT_v2",mP="TLDRAW_DB_NAME_INDEX_v2",De={Records:"records",Schema:"schema",SessionState:"session_state"};async function ih(n,t){j4(n);const e=await gP(n,3,{upgrade(s){s.objectStoreNames.contains(De.Records)||s.createObjectStore(De.Records),s.objectStoreNames.contains(De.Schema)||s.createObjectStore(De.Schema),s.objectStoreNames.contains(De.SessionState)||s.createObjectStore(De.SessionState)}});try{return await t(e)}finally{e.close()}}async function T4({persistenceKey:n,sessionId:t,didCancel:e}){const s=rh+n;if(dy().includes(s))return await A4({persistenceKey:n,didCancel:e}),await ih(s,async r=>{var h,p;if(e!=null&&e())return;const i=r.transaction([De.Records,De.Schema,De.SessionState],"readonly"),o=i.objectStore(De.Records),a=i.objectStore(De.Schema),c=i.objectStore(De.SessionState);let l=t?(h=await c.get(t))==null?void 0:h.snapshot:null;l||(l=(p=(await c.getAll()).sort((y,m)=>y.updatedAt-m.updatedAt).pop())==null?void 0:p.snapshot);const d={records:await o.getAll(),schema:await a.get(De.Schema),sessionStateSnapshot:l};if(e!=null&&e()){i.abort();return}return await i.done,d})}async function k4({persistenceKey:n,schema:t,changes:e,sessionId:s,sessionStateSnapshot:r,didCancel:i}){const o=rh+n;await ih(o,async a=>{const c=a.transaction([De.Records,De.Schema,De.SessionState],"readwrite"),l=c.objectStore(De.Records),d=c.objectStore(De.Schema),h=c.objectStore(De.SessionState);for(const[p,f]of Object.entries(e.added))await l.put(f,p);for(const[p,f]of Object.values(e.updated))await l.put(f,f.id);for(const p of Object.keys(e.removed))await l.delete(p);if(d.put(t.serialize(),De.Schema),r&&s?h.put({snapshot:r,updatedAt:Date.now(),id:s},s):(r||s)&&console.error("sessionStateSnapshot and instanceId must be provided together"),i!=null&&i())return c.abort();await c.done})}async function M4({persistenceKey:n,schema:t,snapshot:e,sessionId:s,sessionStateSnapshot:r,didCancel:i}){const o=rh+n;await ih(o,async a=>{const c=a.transaction([De.Records,De.Schema,De.SessionState],"readwrite"),l=c.objectStore(De.Records),d=c.objectStore(De.Schema),h=c.objectStore(De.SessionState);await l.clear();for(const[p,f]of Object.entries(e))await l.put(f,p);if(d.put(t.serialize(),De.Schema),r&&s?h.put({snapshot:r,updatedAt:Date.now(),id:s},s):(r||s)&&console.error("sessionStateSnapshot and instanceId must be provided together"),i!=null&&i())return c.abort();await c.done})}async function A4({persistenceKey:n,didCancel:t}){await ih(rh+n,async e=>{const s=e.transaction([De.SessionState],"readwrite"),r=s.objectStore(De.SessionState),i=(await r.getAll()).sort((a,c)=>a.updatedAt-c.updatedAt);if(i.length<10){await s.done;return}const o=i.slice(0,i.length-10);for(const{id:a}of o)await r.delete(a);if(t!=null&&t())return s.abort();await s.done})}function dy(){const n=JSON.parse(Dm(mP)||"[]")??[];return Array.isArray(n)?n:[]}function j4(n){const t=new Set(dy());t.add(n),Om(mP,JSON.stringify([...t]))}const D4=350,O4=1e4,lb=Symbol("UPDATE_INSTANCE_STATE"),R4=n=>n;class L4{constructor(t){g(this,"onmessage")}postMessage(t){}close(){}}const $4=typeof BroadcastChannel>"u"?L4:BroadcastChannel;class F4{constructor(t,{persistenceKey:e,sessionId:s=Su,onLoad:r,onLoadError:i},o=new $4(`tldraw-tab-sync-${e}`)){g(this,"disposables",new Set);g(this,"diffQueue",[]);g(this,"didDispose",!1);g(this,"shouldDoFullDBWrite",!0);g(this,"isReloading",!1);g(this,"persistenceKey");g(this,"sessionId");g(this,"serializedSchema");g(this,"isDebugging",!1);g(this,"documentTypes");g(this,"$sessionStateSnapshot");g(this,"initTime",Date.now());g(this,"isPersisting",!1);g(this,"didLastWriteError",!1);g(this,"scheduledPersistTimeout",null);this.store=t,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=e,this.sessionId=s,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=tP(this.store),this.disposables.add(t.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(R4({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(t.listen(()=>{this.diffQueue.push(lb),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...t){this.isDebugging&&console.debug(...t)}async connect(t,e){this.debug("connecting");let s;try{s=await T4({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(r){e(r),m4(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",s,"didDispose",this.didDispose),!this.didDispose)try{if(s){const r=Object.fromEntries(s.records.map(a=>[a.id,a])),i=s.sessionStateSnapshot??c5(r),o=this.store.schema.migrateStoreSnapshot({store:r,schema:s.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),e(new Error(`Failed to migrate store: ${o.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(o.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),i&&nP(this.store,i)}this.channel.onmessage=({data:r})=>{var a,c;this.debug("got message",r);const i=r,o=this.store.schema.getMigrationsSince(i.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){e(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}i.type==="diff"&&(this.debug("applying diff"),$r(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(i.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),t(this)}catch(r){if(this.debug("error loading data from store",r),this.didDispose)return;e(r);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(t=>t())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?O4:D4))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){et(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const t=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await M4({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const e=Lm(t.filter(s=>s!==lb));await k4({persistenceKey:this.persistenceKey,changes:e,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),g4(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function yP({initialData:n,defaultName:t="",id:e,...s}={}){const r="schema"in s&&s.schema?s.schema:Cz({shapes:"shapeUtils"in s&&s.shapeUtils?db(aP(s.shapeUtils)):void 0,bindings:"bindingUtils"in s&&s.bindingUtils?db(rP(s.bindingUtils)):void 0,migrations:"migrations"in s?s.migrations:void 0});return new Bm({id:e,schema:r,initialData:n,props:{defaultName:t}})}function db(n){return Object.fromEntries(n.map(t=>[t.type,{props:t.props,migrations:t.migrations}]))}function ub(n){const t=yP(n);return n.snapshot&&sP(t,n.snapshot),{store:t,opts:n}}function SP(n){const[t,e]=v.useState(()=>ub(n));if(!uC(t.opts,n)){const s=ub(n);return e(s),s.store}return t.store}function N4({persistenceKey:n,sessionId:t,...e}){const[s,r]=v.useState(null),i=SP(e);return v.useEffect(()=>{const o=Qe();if(!n){r({id:o,storeWithStatus:{status:"not-synced",store:i}});return}r({id:o,storeWithStatus:{status:"loading"}});const a=l=>{r(d=>(d==null?void 0:d.id)===o?{id:o,storeWithStatus:l}:d)},c=new F4(i,{sessionId:t,persistenceKey:n,onLoad(){a({store:i,status:"synced-local"})},onLoadError(l){a({status:"error",error:l})}});return()=>{r(l=>(l==null?void 0:l.id)===o?null:l),c.close()}},[n,i,t]),(s==null?void 0:s.storeWithStatus)??{status:"loading"}}function B4(){const n=N(),t=Qt();v.useEffect(()=>{const e=i=>t.style.setProperty("--tl-zoom",i.toString()),s=iC(e,100),r=new ra("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?e(n.getZoomLevel()):s(n.getZoomLevel())});return r.attach(),r.execute(),()=>{r.detach(),s.cancel()}},[n,t])}const z4=[],U4=[],H4=[],K4=v.memo(function({store:t,components:e,className:s,user:r,...i}){const[o,a]=me.useState(null),c=v.useMemo(()=>r??ZI(),[r]),l=(e==null?void 0:e.ErrorFallback)===void 0?KI:e==null?void 0:e.ErrorFallback,d={...i,shapeUtils:i.shapeUtils??z4,bindingUtils:i.bindingUtils??U4,tools:i.tools??H4,components:e};return u.jsx("div",{ref:a,draggable:!1,className:se("tl-container tl-theme__light",s),onPointerDown:Rt,tabIndex:-1,children:u.jsx(ac,{fallback:l,onError:h=>Am(h,{tags:{origin:"react.tldraw-before-app"}}),children:o&&u.jsx(Hz,{container:o,children:u.jsx(V3,{overrides:e,children:t?t instanceof Bm?u.jsx(xP,{...d,store:t,user:c}):u.jsx(wP,{...d,store:t,user:c}):u.jsx(G4,{...d,store:t,user:c})})})})})});function G4(n){const{defaultName:t,snapshot:e,initialData:s,shapeUtils:r,bindingUtils:i,persistenceKey:o,sessionId:a,user:c}=n,l=N4({shapeUtils:r,bindingUtils:i,initialData:s,persistenceKey:o,sessionId:a,defaultName:t,snapshot:e});return u.jsx(wP,{...n,store:l,user:c})}const wP=v.memo(function({store:t,user:e,...s}){const r=Qt();v.useLayoutEffect(()=>{e.userPreferences.get().colorScheme==="dark"&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,e]);const{LoadingScreen:i}=tt();switch(t.status){case"error":throw t.error;case"loading":return i?u.jsx(i,{}):null}return u.jsx(xP,{...s,store:t.store,user:e})});function xP({onMount:n,children:t,store:e,tools:s,shapeUtils:r,bindingUtils:i,user:o,initialState:a,autoFocus:c=!0,inferDarkMode:l,cameraOptions:d,assetOptions:h,options:p}){const{ErrorFallback:f}=tt(),y=Qt(),m=v.useRef(null),[x,w]=v.useState(null),b=m.current;x!==b&&w(b);const[I]=v.useState(c);v.useLayoutEffect(()=>{const C=new X({store:e,shapeUtils:r,bindingUtils:i,tools:s,getContainer:()=>y,user:o,initialState:a,autoFocus:I,inferDarkMode:l,cameraOptions:d,assetOptions:h,options:p});return m.current=C,w(C),()=>{C.dispose()}},[y,r,i,s,e,o,a,I,l,d,h,p]);const E=v.useSyncExternalStore(v.useCallback(C=>b?(b.on("crash",C),()=>b.off("crash",C)):()=>{},[b]),()=>(b==null?void 0:b.getCrashingError())??null),{Canvas:P}=tt();return b?u.jsx(ac,{fallback:f,onError:C=>b.annotateError(C,{origin:"react.tldraw",willCrashApp:!0}),children:E?u.jsx(V4,{crashingError:E}):u.jsx(eh.Provider,{value:b,children:u.jsx(W4,{onMount:n,children:t??(P?u.jsx(P,{}):null)})})}):null}function W4({children:n,onMount:t}){return B4(),h4(),p4(),f4(),Y4(t),u.jsx(u.Fragment,{children:n})}function V4({crashingError:n}){throw n}function uy({children:n}){return u.jsx("div",{className:"tl-loading",children:n})}function bP({children:n}){return u.jsx("div",{className:"tl-loading",children:n})}function Y4(n){const t=N(),e=cy(s=>{let r;return s.history.ignore(()=>{r=n==null?void 0:n(s),s.emit("mount")}),window.tldrawReady=!0,r});me.useLayoutEffect(()=>{if(t)return e==null?void 0:e(t)},[t,e])}function Oi({children:n,className:t="",...e}){return u.jsx("div",{...e,className:se("tl-html-container",t),children:n})}class ld{constructor(t){this.editor=t}}g(ld,"props"),g(ld,"migrations"),g(ld,"type");function vP(n,t,e={}){const{newPoint:s,handle:r,scaleX:i,scaleY:o}=t,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:d=1/0}=e;let h=n.props.w*i,p=n.props.h*o;const f=new S(0,0);if(h>0){if(h<a){switch(r){case"top_left":case"left":case"bottom_left":{f.x=h-a;break}case"top":case"bottom":{f.x=(h-a)/2;break}default:f.x=0}h=a}}else if(f.x=h,h=-h,h<a){switch(r){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-a}h=a}if(p>0){if(p<l){switch(r){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(r){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:y,y:m}=f.rot(n.rotation).add(s);return{x:y,y:m,props:{w:Math.min(c,h),h:Math.min(d,p)}}}class aa extends cs{constructor(){super(...arguments);g(this,"onResize",(e,s)=>vP(e,s))}getGeometry(e){return new cr({width:e.props.w,height:e.props.h,isFilled:!0})}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}}var Sf;let X4=(Sf=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(Sf,"id","idle"),Sf);var wf;let q4=(wf=class extends ee{constructor(){super(...arguments);g(this,"markId","");g(this,"wasFocusedOnEnter",!1);g(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});g(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,r=this.parent.shapeType,i=Oe();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:s.x,y:s.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const s=this.parent.shapeType,r=Oe();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:s,x:e.x,y:e.y}]);const i=this.editor.getShape(r);if(!i){this.cancel();return}let{w:o,h:a}=i.props;const c=new S(o/2,a/2),l=this.editor.getShapeParentTransform(i);l&&c.rot(-l.rotation());let d=1;this.editor.user.getIsDynamicResizeMode()&&(d=1/this.editor.getZoomLevel(),o*=d,a*=d,c.mul(d));const h=Je(i);h.x=i.x-c.x,h.y=i.y-c.y,h.props.w=o,h.props.h=a,"scale"in i.props&&(h.props.scale=d),this.editor.updateShape(h),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},g(wf,"id","pointing"),wf);class dd extends ee{constructor(){super(...arguments);g(this,"onCreate")}}g(dd,"id","box"),g(dd,"initial","idle"),g(dd,"children",()=>[X4,q4]);function oh(n){const t=N();return z("isEditing",()=>t.getEditingShapeId()===n,[t,n])}function Z4(){return v.useId().replace(/:/g,"_")}function bs(n){const t=N();return v.useMemo(function(){const r=l=>{if(l.isKilled)return;if(l.button===Xm){t.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...yn(l)});return}if(l.button!==0)return;const d=mu(l.currentTarget);function h(){d.removeEventListener("pointerup",h),Rc(d,l)}Oc(d,l),d.addEventListener("pointerup",h),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...yn(l)}),Rt(l)};let i,o;function a(l){l.isKilled||l.button===0&&(l.clientX===i&&l.clientY===o||(i=l.clientX,o=l.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...yn(l)})))}return{onPointerDown:r,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...yn(l)})}}},[t,n])}const J4=20,Q4=8;function hy(n,t=J4){return Math.max(Q4,Math.ceil(n/t))}class vo extends ti{constructor(e){super({...e,isFilled:!1,isClosed:!1});g(this,"_center");g(this,"radius");g(this,"start");g(this,"end");g(this,"largeArcFlag");g(this,"sweepFlag");g(this,"measure");g(this,"angleStart");g(this,"angleEnd");const{center:s,sweepFlag:r,largeArcFlag:i,start:o,end:a}=e;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=S.Angle(s,o),this.angleEnd=S.Angle(s,a),this.radius=S.Dist(s,o),this.measure=Dz(this.angleStart,this.angleEnd,r,i),this.start=o,this.end=a,this.sweepFlag=r,this.largeArcFlag=i,this._center=s}nearestPoint(e){const{_center:s,measure:r,radius:i,angleEnd:o,angleStart:a,start:c,end:l}=this,d=lg(r,a,o,s.angle(e));if(d<=0)return c;if(d>=1)return l;const h=s.clone().add(e.clone().sub(s).uni().mul(i));let p,f=1/0,y;for(const m of[c,l,h])y=S.Dist2(e,m),y<f&&(p=m,f=y);if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(e,s){const{_center:r,radius:i,measure:o,angleStart:a,angleEnd:c}=this,l=Fc(e,s,r,i);return l===null?!1:l.some(d=>{const h=lg(o,a,c,r.angle(d));return h>=0&&h<=1})}getVertices(){const{_center:e,measure:s,length:r,radius:i,angleStart:o}=this,a=[];for(let c=0,l=hy(Math.abs(r));c<l+1;c++){const d=c/l*s,h=o+d;a.push(Di(e,i,h))}return a}getSvgPathData(e=!0){const{start:s,end:r,radius:i,largeArcFlag:o,sweepFlag:a}=this;return`${e?`M${s.toFixed()}`:""} A${i} ${i} 0 ${o} ${a} ${r.toFixed()}`}getLength(){return this.measure*this.radius}}class py extends ti{constructor(e){super({isClosed:!0,...e});g(this,"_center");g(this,"radius");g(this,"x");g(this,"y");this.config=e;const{x:s=0,y:r=0,radius:i}=e;this.x=s,this.y=r,this._center=new S(i+s,i+r),this.radius=i}getBounds(){return new Y(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:e,radius:s}=this,r=je*s,i=[];for(let o=0,a=hy(r);o<a;o++){const c=o/a*je;i.push(Di(e,s,c))}return i}nearestPoint(e){const{_center:s,radius:r}=this;return s.equals(e)?S.AddXY(s,r,0):s.clone().add(e.clone().sub(s).uni().mul(r))}hitTestLineSegment(e,s,r=0){const{_center:i,radius:o}=this;return Fc(e,s,i,o+r)!==null}getSvgPathData(){const{_center:e,radius:s}=this;return`M${e.x+s},${e.y} a${s},${s} 0 1,0 ${s*2},0a${s},${s} 0 1,0 -${s*2},0`}}class Wt extends oa{constructor(e){const{start:s,cp1:r,cp2:i,end:o}=e;super({...e,points:[s,o]});g(this,"a");g(this,"b");g(this,"c");g(this,"d");this.a=s,this.b=r,this.c=i,this.d=o}getVertices(){const e=[],{a:s,b:r,c:i,d:o}=this;for(let a=0,c=10;a<=c;a++){const l=a/c;e.push(new S((1-l)*(1-l)*(1-l)*s.x+3*((1-l)*(1-l))*l*r.x+3*(1-l)*(l*l)*i.x+l*l*l*o.x,(1-l)*(1-l)*(1-l)*s.y+3*((1-l)*(1-l))*l*r.y+3*(1-l)*(l*l)*i.y+l*l*l*o.y))}return e}midPoint(){return Wt.GetAtT(this,.5)}nearestPoint(e){let s,r=1/0,i,o;for(const a of this.segments)o=a.nearestPoint(e),i=S.Dist2(o,e),i<r&&(s=o,r=i);if(!s)throw Error("nearest point not found");return s}getSvgPathData(e=!0){const{a:s,b:r,c:i,d:o}=this;return`${e?`M ${s.toFixed()} `:""} C${r.toFixed()} ${i.toFixed()} ${o.toFixed()}`}static GetAtT(e,s){const{a:r,b:i,c:o,d:a}=e;return new S((1-s)*(1-s)*(1-s)*r.x+3*((1-s)*(1-s))*s*i.x+3*(1-s)*(s*s)*o.x+s*s*s*a.x,(1-s)*(1-s)*(1-s)*r.y+3*((1-s)*(1-s))*s*i.y+3*(1-s)*(s*s)*o.y+s*s*s*a.y)}getLength(e=32){let s,r=this.a,i=0;for(let o=1;o<=e;o++)s=Wt.GetAtT(this,o/e),i+=S.Dist(r,s),r=s;return i}}class e8 extends ti{constructor(e){super({...e,isClosed:!1,isFilled:!1});g(this,"points");g(this,"_segments");const{points:s}=e;this.points=s}get segments(){if(!this._segments){this._segments=[];const{points:e}=this,s=e.length,r=s-2,i=1.25;for(let o=0;o<s-1;o++){const a=o===0?e[0]:e[o-1],c=e[o],l=e[o+1],d=o===r?l:e[o+2],h=c,p=o===0?a:new S(c.x+(l.x-a.x)/6*i,c.y+(l.y-a.y)/6*i),f=o===r?l:new S(l.x-(d.x-c.x)/6*i,l.y-(d.y-c.y)/6*i),y=l;this._segments.push(new Wt({start:h,cp1:p,cp2:f,end:y}))}}return this._segments}getLength(){return this.segments.reduce((e,s)=>e+s.length,0)}getVertices(){const e=this.segments.reduce((s,r)=>s.concat(r.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let s,r=1/0,i,o;for(const a of this.segments)o=a.nearestPoint(e),i=S.Dist2(o,e),i<r&&(s=o,r=i);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(e,s){return this.segments.some(r=>r.hitTestLineSegment(e,s))}getSvgPathData(){let e=this.segments.reduce((s,r,i)=>s+r.getSvgPathData(i===0),"");return this.isClosed&&(e+="Z"),e}}class t8 extends ti{constructor(e){super({...e,isClosed:!0});g(this,"w");g(this,"h");g(this,"_edges");this.config=e;const{width:s,height:r}=e;this.w=s,this.h=r}get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let s=0,r=e.length;s<r;s++){const i=e[s],o=e[(s+1)%r];this._edges.push(new Qs({start:i,end:o}))}}return this._edges}getVertices(){const e=Math.max(1,this.w),s=Math.max(1,this.h),r=e/2,i=s/2,o=Math.pow(r-i,2)/Math.pow(r+i,2),a=_e*(r+i)*(1+3*o/(10+Math.sqrt(4-3*o))),c=hy(a),l=je/c,d=Math.cos(l),h=Math.sin(l);let p=0,f=1,y=0,m=1;const x=Array(c);for(let w=0;w<c;w++)x[w]=new S(r+r*f,i+i*p),y=h*f+d*p,m=d*f-h*p,p=y,f=m;return x}nearestPoint(e){let s,r=1/0,i,o;for(const a of this.edges)o=a.nearestPoint(e),i=S.Dist2(o,e),i<r&&(s=o,r=i);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(e,s){return this.edges.some(r=>r.hitTestLineSegment(e,s))}getBounds(){return new Y(0,0,this.w,this.h)}getLength(){const{w:e,h:s}=this,r=e/2,i=s/2,o=Math.max(0,r),a=Math.max(0,i);return xI(o,a)}getSvgPathData(e=!1){const{w:s,h:r}=this,i=s/2,o=r/2,a=Math.max(0,i),c=Math.max(0,o);return`${e?`M${i-a},${o}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class n8 extends ti{constructor(e){super({...e,isClosed:!0});g(this,"w");g(this,"h");g(this,"a");g(this,"b");g(this,"c");g(this,"d");this.config=e;const{width:s,height:r}=e;if(this.w=s,this.h=r,r>s){const i=s/2;this.a=new vo({start:new S(0,i),end:new S(s,i),center:new S(s/2,i),sweepFlag:1,largeArcFlag:1}),this.b=new Qs({start:new S(s,i),end:new S(s,r-i)}),this.c=new vo({start:new S(s,r-i),end:new S(0,r-i),center:new S(s/2,r-i),sweepFlag:1,largeArcFlag:1}),this.d=new Qs({start:new S(0,r-i),end:new S(0,i)})}else{const i=r/2;this.a=new vo({start:new S(i,r),end:new S(i,0),center:new S(i,i),sweepFlag:1,largeArcFlag:1}),this.b=new Qs({start:new S(i,0),end:new S(s-i,0)}),this.c=new vo({start:new S(s-i,0),end:new S(s-i,r),center:new S(s-i,i),sweepFlag:1,largeArcFlag:1}),this.d=new Qs({start:new S(s-i,r),end:new S(i,r)})}}nearestPoint(e){let s,r=1/0,i,o;const{a,b:c,c:l,d}=this;for(const h of[a,c,l,d])o=h.nearestPoint(e),i=S.Dist2(o,e),i<r&&(s=o,r=i);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(e,s){const{a:r,b:i,c:o,d:a}=this;return[r,i,o,a].some(c=>c.hitTestLineSegment(e,s))}getVertices(){const{a:e,b:s,c:r,d:i}=this;return[e,s,r,i].reduce((o,a)=>(o.push(...a.vertices),o),[])}getBounds(){return new Y(0,0,this.w,this.h)}getLength(){const{h:e,w:s}=this;return e>s?(_e*(s/2)+(e-s))*2:(_e*(e/2)+(s-e))*2}getSvgPathData(){const{a:e,b:s,c:r,d:i}=this;return[e,s,r,i].map((o,a)=>o.getSvgPathData(a===0)).join(" ")+" Z"}}async function s8({shouldReload:n=!0}={}){kN(),await Promise.all(dy().map(t=>P4(t))),TN(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=s8);function r8(n,t="_blank"){ey.openWindow(n,t)}const CP="TLDRAW_ASSET_STORE_v1",No={Assets:"assets"};async function IP(n,t){const e=await gP(n,1,{upgrade(s){s.objectStoreNames.contains(No.Assets)||s.createObjectStore(No.Assets)}});try{return await t(e)}finally{e.close()}}async function i8({persistenceKey:n,assetId:t}){const e=CP+n;return await IP(e,async s=>await s.transaction([No.Assets],"readwrite").objectStore(No.Assets).get(t))}async function o8({persistenceKey:n,assetId:t,blob:e}){const s=CP+n;await IP(s,async r=>{const i=r.transaction([No.Assets],"readwrite");await i.objectStore(No.Assets).put(e,t),await i.done})}function a8({children:n}){const t=N();return z("shouldDisplayHandles",()=>{if(t.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(t.isInAny("select.editing_shape")){const s=t.getOnlySelectedShape();return s&&t.isShapeOfType(s,"note")}return!1},[t])?u.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:c8}=Math,Mo=c8+1e-4;function PP(n,t={}){const{size:e=16,smoothing:s=.5}=t;if(n.length===0||e<=0)return{left:[],right:[]};const r=n[0],i=n[n.length-1],o=i.runningLength,a=Math.pow(e*s,2),c=[],l=[];let d=n[0].vector,h=n[0].point,p=h,f=h,y=p,m=!1,x;for(let w=0;w<n.length;w++){x=n[w];const{point:b,vector:I}=n[w],E=x.vector.dpr(d),P=(w<n.length-1?n[w+1]:n[w]).vector,C=w<n.length-1?P.dpr(x.vector):1,_=E<0&&!m,k=C!==null&&C<.2;if(_||k){if(C>-.62&&o-x.runningLength>x.radius){const T=d.clone().mul(x.radius);d.clone().cpr(P)<0?(f=S.Add(b,T),y=S.Sub(b,T)):(f=S.Sub(b,T),y=S.Add(b,T)),c.push(f),l.push(y)}else{const T=d.clone().mul(x.radius).per(),A=S.Sub(x.input,T);for(let L=1/13,j=0;j<1;j+=L)f=S.RotWith(A,x.input,Mo*j),c.push(f),y=S.RotWith(A,x.input,Mo+Mo*-j),l.push(y)}h=f,p=y,k&&(m=!0);continue}if(m=!1,x===r||x===i){const T=S.Per(I).mul(x.radius);c.push(S.Sub(b,T)),l.push(S.Add(b,T));continue}const D=S.Lrp(P,I,C).per().mul(x.radius);f=S.Sub(b,D),(w<=1||S.Dist2(h,f)>a)&&(c.push(f),h=f),y=S.Add(b,D),(w<=1||S.Dist2(p,y)>a)&&(l.push(y),p=y),d=I}return{left:c,right:l}}function fy(n,t={}){const{size:e=16,start:s={},end:r={},last:i=!1}=t,{cap:o=!0}=s,{cap:a=!0}=r;if(n.length===0||e<=0)return[];const c=n[0],l=n[n.length-1],d=l.runningLength,h=s.taper===!1?0:s.taper===!0?Math.max(e,d):s.taper,p=r.taper===!1?0:r.taper===!0?Math.max(e,d):r.taper,{left:f,right:y}=PP(n,t),m=c.point,x=n.length>1?n[n.length-1].point:S.AddXY(c.point,1,1);if(n.length===1&&(!(h||p)||i)){const E=S.Add(m,S.Sub(m,x).uni().per().mul(-c.radius)),P=[];for(let C=1/13,_=C;_<=1;_+=C)P.push(S.RotWith(E,m,Mo*2*_));return P}const w=[];if(!(h||p&&n.length===1))if(o)for(let E=1/8,P=E;P<=1;P+=E){const C=S.RotWith(y[0],m,Mo*P);w.push(C)}else{const E=S.Sub(f[0],y[0]),P=S.Mul(E,.5),C=S.Mul(E,.51);w.push(S.Sub(m,P),S.Sub(m,C),S.Add(m,C),S.Add(m,P))}const b=[],I=l.vector.clone().per().neg();if(p||h&&n.length===1)b.push(x);else if(a){const E=S.Add(x,S.Mul(I,l.radius));for(let P=1/29,C=P;C<1;C+=P)b.push(S.RotWith(E,x,Mo*3*C))}else b.push(S.Add(x,S.Mul(I,l.radius)),S.Add(x,S.Mul(I,l.radius*.99)),S.Sub(x,S.Mul(I,l.radius*.99)),S.Sub(x,S.Mul(I,l.radius)));return f.concat(b,y.reverse(),w)}const l8=.025,d8=.01;function Ds(n,t={}){var x;const{streamline:e=.5,size:s=16,simulatePressure:r=!1}=t;if(n.length===0)return[];const i=.15+(1-e)*.85;let o=n.map(S.From),a=0;if(!r){let w=o[0];for(;w&&!(w.z>=l8);)o.shift(),w=o[0]}if(!r){let w=o[o.length-1];for(;w&&!(w.z>=d8);)o.pop(),w=o[o.length-1]}if(o.length===0)return[{point:S.From(n[0]),input:S.From(n[0]),pressure:r?.5:.15,vector:new S(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(S.Dist2(c,o[0])>(s/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const l=o.pop();for(c=o[o.length-1];c&&!(S.Dist2(c,l)>(s/3)**2);)o.pop(),c=o[o.length-1],a++;o.push(l);const d=t.last||!t.simulatePressure||o.length>1&&S.Dist2(o[o.length-1],o[o.length-2])<s**2||a>0;if(o.length===2&&t.simulatePressure){const w=o[1];o=o.slice(0,-1);for(let b=1;b<5;b++){const I=S.Lrp(o[0],w,b/4);I.z=(o[0].z+(w.z-o[0].z))*b/4,o.push(I)}}const h=[{point:o[0],input:o[0],pressure:r?.5:o[0].z,vector:new S(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=h[0],y,m;d&&e>0&&o.push(o[o.length-1].clone());for(let w=1,b=o.length;w<b;w++)y=!i||t.last&&w===b-1?o[w].clone():o[w].clone().lrp(f.point,1-i),!f.point.equals(y)&&(m=S.Dist(y,f.point),p+=m,!(w<4&&p<s)&&(f={input:o[w],point:y,pressure:r?.5:o[w].z,vector:S.Sub(f.point,y).uni(),distance:m,runningLength:p,radius:1},h.push(f)));if((x=h[1])!=null&&x.vector&&(h[0].vector=h[1].vector.clone()),p<1){const w=Math.max(.5,...h.map(b=>b.pressure));h.forEach(b=>b.pressure=w)}return h}const{min:Pr}=Math,jp=.275;function ah(n,t){const{size:e=16,thinning:s=.5,simulatePressure:r=!0,easing:i=x=>x,start:o={},end:a={}}=t,{easing:c=It.easeOutQuad}=o,{easing:l=It.easeOutCubic}=a,d=n[n.length-1].runningLength;let h,p=n[0].pressure,f;if(!r&&d<e){const x=n.reduce((w,b)=>Math.max(w,b.pressure),.5);return n.forEach(w=>{w.pressure=x,w.radius=e*i(.5-s*(.5-w.pressure))}),n}else{let x;for(let w=0,b=n.length;w<b&&(f=n[w],!(f.runningLength>e*5));w++){const I=Pr(1,f.distance/e);if(r){const E=Pr(1,1-I);x=Pr(1,p+(E-p)*(I*jp))}else x=Pr(1,p+(f.pressure-p)*.5);p=p+(x-p)*.5}for(let w=0;w<n.length;w++){if(f=n[w],s){let{pressure:b}=f;const I=Pr(1,f.distance/e);if(r){const E=Pr(1,1-I);b=Pr(1,p+(E-p)*(I*jp))}else b=Pr(1,p+(b-p)*(I*jp));f.radius=e*i(.5-s*(.5-b)),p=b}else f.radius=e/2;h===void 0&&(h=f.radius)}}const y=o.taper===!1?0:o.taper===!0?Math.max(e,d):o.taper,m=a.taper===!1?0:a.taper===!0?Math.max(e,d):a.taper;if(y||m)for(let x=0;x<n.length;x++){f=n[x];const{runningLength:w}=f,b=w<y?c(w/y):1,I=d-w<m?l((d-w)/m):1;f.radius=Math.max(.01,f.radius*Math.min(b,I))}return n}function u8(n,t={}){return fy(ah(Ds(n,t),t),t)}function hb({scribble:n,zoom:t,color:e,opacity:s,className:r}){if(!n.points.length)return null;const i=u8(n.points,{size:n.size/t,start:{taper:n.taper,easing:It.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(i.length<4){const a=n.size/t/2,{x:c,y:l}=n.points[n.points.length-1];o=`M ${c-a},${l} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=Zm(i);return u.jsx("svg",{className:r&&se("tl-overlays__item",r),children:u.jsx("path",{className:"tl-scribble",d:o,fill:e??`var(--color-${n.color})`,opacity:s??n.opacity})})}const h8=({bounds:n,rotation:t})=>{const e=N();return z("should display",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[e])?u.jsx(BI,{bounds:n,rotation:t}):null};function gr(){const n=N();return z("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function p8({size:n,width:t,height:e,hideAlternateHandles:s}){const r=$(n/3),i=r/2;return u.jsxs("svg",{className:"tl-overlays__item",children:[u.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${$(0-i)},${$(n)} 
						${$(0-i)},${$(0-i)} 
						${$(n)},${$(0-i)}`,strokeWidth:r,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),u.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:$(t/2-n),y1:$(0-i),x2:$(t/2+n),y2:$(0-i),strokeWidth:r,"data-testid":"selection.crop.top","aria-label":"top handle"}),u.jsx("polyline",{className:se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${$(t-n)},${$(0-i)} 
						${$(t+i)},${$(0-i)} 
						${$(t+i)},${$(n)}`,strokeWidth:r,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),u.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:$(t+i),y1:$(e/2-n),x2:$(t+i),y2:$(e/2+n),strokeWidth:r,"data-testid":"selection.crop.right","aria-label":"right handle"}),u.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${$(t+i)},${$(e-n)} 
						${$(t+i)},${$(e+i)}
						${$(t-n)},${$(e+i)}`,strokeWidth:r,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),u.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:$(t/2-n),y1:$(e+i),x2:$(t/2+n),y2:$(e+i),strokeWidth:r,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),u.jsx("polyline",{className:se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${$(0+n)},${$(e+i)} 
						${$(0-i)},${$(e+i)}
						${$(0-i)},${$(e-n)}`,strokeWidth:r,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),u.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:$(0-i),y1:$(e/2-n),x2:$(0-i),y2:$(e/2+n),strokeWidth:r,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const f8=Cn(function({bounds:t,rotation:e}){const s=N(),r=v.useRef(null),i=gr(),o=bs("top"),a=bs("right"),c=bs("bottom"),l=bs("left"),d=bs("top_left"),h=bs("top_right"),p=bs("bottom_right"),f=bs("bottom_left"),y=!s.getIsMenuOpen()&&s.getInstanceState().cursor.type==="default",m=s.getInstanceState().isCoarsePointer,x=s.getOnlySelectedShape(),w=x&&s.isShapeOrAncestorLocked(x),b=x?s.getShapeUtil(x).expandSelectionOutlinePx(x):0;if(ia(r,t==null?void 0:t.x,t==null?void 0:t.y,1,s.getSelectionRotation(),{x:-b,y:-b}),!t)return null;t=t.clone().expandBy(b).zeroFix();const I=s.getZoomLevel(),E=s.getInstanceState().isChangingStyle,P=t.width,C=t.height,_=8/I,k=P<_*2,D=C<_*2,T=P<_*4,A=C<_*4,L=P<_*5,j=C<_*5,R=m?1.75:1,F=6/I*R,H=(T?F/2:F)*(R*.75),U=(A?F/2:F)*(R*.75),V=(x?!s.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!E;let W=V&&s.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||V&&s.isIn("select.resizing")&&x&&s.isShapeOfType(x,"text");x&&W&&s.environment.isFirefox&&s.isShapeOfType(x,"embed")&&(W=!1);const te=s.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!E&&!i,le=s.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!E&&!i,Se=!m&&!(k||D)&&(le||te)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!w,be=m&&(!T||!A)&&(le||te)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!w,nt=le&&(x?s.getShapeUtil(x).canResize(x)&&!s.getShapeUtil(x).hideResizeHandles(x):!0)&&!te&&!w,ie=k||D,yt=k&&D,Ke=L||j,Ye=nt||te,ke=!Se,st=!le||!be,Re=!le||!Ye,_n=!le||!Ye||ie,Tt=!le||!Ye||ie,cn=!le||!Ye||yt&&!te;let ut=!0,Bt=!0;if(te)ut=Ke,Bt=Ke;else if(nt){ut=ie||yt||m;const xr=m&&x&&x.type==="text";Bt=ut&&!xr}const Us=Math.min(24/I,C-U*3),ha=le&&m&&x&&s.isShapeOfType(x,"text")&&Us*I>=4;return u.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:u.jsxs("g",{ref:r,children:[W&&u.jsx("rect",{className:"tl-selection__fg__outline",width:$(P),height:$(C)}),u.jsx(Tl,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:F,corner:"top_left_rotate",cursor:y?kn("nwse-rotate",e):void 0,isHidden:ke}),u.jsx(Tl,{"data-testid":"selection.rotate.top-right",cx:P+F*3,cy:0,targetSize:F,corner:"top_right_rotate",cursor:y?kn("nesw-rotate",e):void 0,isHidden:ke}),u.jsx(Tl,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+F*3,targetSize:F,corner:"bottom_left_rotate",cursor:y?kn("swne-rotate",e):void 0,isHidden:ke}),u.jsx(Tl,{"data-testid":"selection.rotate.bottom-right",cx:P+F*3,cy:C+F*3,targetSize:F,corner:"bottom_right_rotate",cursor:y?kn("senw-rotate",e):void 0,isHidden:ke}),u.jsx(m8,{"data-testid":"selection.rotate.mobile",cx:T?-F*1.5:P/2,cy:T?C/2:-F*1.5,size:_,isHidden:st}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":ut}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:$(0-(A?U*2:U)),width:$(P),height:$(Math.max(1,U*2)),style:y?{cursor:kn("ns-resize",e)}:void 0,...o}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":Bt}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:$(P-(T?0:H)),y:0,height:$(C),width:$(Math.max(1,H*2)),style:y?{cursor:kn("ew-resize",e)}:void 0,...a}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":ut}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:$(C-(A?0:U)),width:$(P),height:$(Math.max(1,U*2)),style:y?{cursor:kn("ns-resize",e)}:void 0,...c}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":Bt}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:$(0-(T?H*2:H)),y:0,height:$(C),width:$(Math.max(1,H*2)),style:y?{cursor:kn("ew-resize",e)}:void 0,...l}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":Re}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:$(0-(T?H*2:H*1.5)),y:$(0-(A?U*2:U*1.5)),width:$(H*3),height:$(U*3),style:y?{cursor:kn("nwse-resize",e)}:void 0,...d}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":_n}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:$(P-(T?0:H*1.5)),y:$(0-(A?U*2:U*1.5)),width:$(H*3),height:$(U*3),style:y?{cursor:kn("nesw-resize",e)}:void 0,...h}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":cn}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:$(P-(T?H:H*1.5)),y:$(C-(A?U:U*1.5)),width:$(H*3),height:$(U*3),style:y?{cursor:kn("nwse-resize",e)}:void 0,...p}),u.jsx("rect",{className:se("tl-transparent",{"tl-hidden":Tt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:$(0-(T?H*3:H*1.5)),y:$(C-(A?0:U*1.5)),width:$(H*3),height:$(U*3),style:y?{cursor:kn("nesw-resize",e)}:void 0,...f}),nt&&u.jsxs(u.Fragment,{children:[u.jsx("rect",{"data-testid":"selection.resize.top-left",className:se("tl-corner-handle",{"tl-hidden":Re}),"aria-label":"top_left handle",x:$(0-_/2),y:$(0-_/2),width:$(_),height:$(_)}),u.jsx("rect",{"data-testid":"selection.resize.top-right",className:se("tl-corner-handle",{"tl-hidden":_n}),"aria-label":"top_right handle",x:$(P-_/2),y:$(0-_/2),width:$(_),height:$(_)}),u.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:se("tl-corner-handle",{"tl-hidden":cn}),"aria-label":"bottom_right handle",x:$(P-_/2),y:$(C-_/2),width:$(_),height:$(_)}),u.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:se("tl-corner-handle",{"tl-hidden":Tt}),"aria-label":"bottom_left handle",x:$(0-_/2),y:$(C-_/2),width:$(_),height:$(_)})]}),ha&&u.jsxs(u.Fragment,{children:[u.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:$(0-_/4),y:$(C/2-Us/2),rx:_/4,width:$(_/2),height:$(Us)}),u.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:_/4,x:$(P-_/4),y:$(C/2-Us/2),width:$(_/2),height:$(Us)})]}),te&&u.jsx(p8,{size:_,width:P,height:C,hideAlternateHandles:Ke})]})})}),Tl=function({cx:t,cy:e,targetSize:s,corner:r,cursor:i,isHidden:o,"data-testid":a}){const c=bs(r);return u.jsx("rect",{className:se("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${r} target`,pointerEvents:"all",x:$(t-s*3),y:$(e-s*3),width:$(Math.max(1,s*3)),height:$(Math.max(1,s*3)),cursor:i,...c})},g8=Math.sqrt(Math.PI),m8=function({cx:t,cy:e,size:s,isHidden:r,"data-testid":i}){const o=bs("mobile_rotate"),a=N(),c=z("zoom level",()=>a.getZoomLevel(),[a]),l=Math.max(14*(1/c),20/Math.max(1,c));return u.jsxs("g",{children:[u.jsx("circle",{"data-testid":i,pointerEvents:"all",className:se("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:t,cy:e,r:l,...o}),u.jsx("circle",{className:se("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:t,cy:e,r:s/g8})]})};function mg(n,t,e){const{arrowheadStart:s,arrowheadEnd:r}=t.props,i=Co(n,t,e),o=i.start.clone(),a=i.end.clone(),c=S.Med(o,a);if(S.Equals(o,a))return{bindings:e,isStraight:!0,start:{handle:o,point:o,arrowhead:t.props.arrowheadStart},end:{handle:a,point:a,arrowhead:t.props.arrowheadEnd},middle:c,isValid:!1,length:0};const l=S.Sub(a,o).uni(),d=wu(n,t,"start"),h=wu(n,t,"end"),p=n.getShapePageTransform(t);pb(a,i.start,p,h),pb(o,i.end,p,d);let f=0,y=0,m=0,x=0,w=Io*t.props.scale;const b=d&&h&&d.shape===h.shape,I=d&&h?gy(n,d.shape.id,h.shape.id):"safe";I==="safe"&&d&&h&&!b&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&o.setTo(a.clone().add(l.clone().mul(Io*t.props.scale))):h.didIntersect||h.isClosed&&a.setTo(o.clone().sub(l.clone().mul(Io*t.props.scale))));const E=S.Sub(a,o),P=S.Len(E)?E.uni():S.From(E),C=!S.Equals(P,l);b||(I!=="start-contains-end"&&d&&s!=="none"&&!d.isExact&&(m=Dr[t.props.size]/2+("size"in d.shape.props?Dr[d.shape.props.size]/2:0),f=(xu+m)*t.props.scale,w+=m*t.props.scale),I!=="end-contains-start"&&h&&r!=="none"&&!h.isExact&&(x=Dr[t.props.size]/2+("size"in h.shape.props?Dr[h.shape.props.size]/2:0),y=(xu+x)*t.props.scale,w+=x*t.props.scale));const _=o.clone().add(P.clone().mul(f*(C?-1:1))),k=a.clone().sub(P.clone().mul(y*(C?-1:1)));S.DistMin(_,k,w)&&(f!==0&&y!==0?(f*=-1.5,y*=-1.5):f!==0?f*=-1:y!==0&&(y*=-1)),o.add(P.clone().mul(f*(C?-1:1))),a.sub(P.clone().mul(y*(C?-1:1))),C?(d&&h&&a.setTo(S.Add(o,P.clone().mul(-Io*t.props.scale))),c.setTo(S.Med(i.start,i.end))):c.setTo(S.Med(o,a));const D=S.Dist(o,a);return{bindings:e,isStraight:!0,start:{handle:i.start,point:o,arrowhead:t.props.arrowheadStart},end:{handle:i.end,point:a,arrowhead:t.props.arrowheadEnd},middle:c,isValid:D>0,length:D}}function pb(n,t,e,s){if(s===void 0||s.isExact)return;const r=Q.applyToPoint(e,t),i=Q.applyToPoint(e,n),o=Q.applyToPoint(Q.Inverse(s.transform),r),a=Q.applyToPoint(Q.Inverse(s.transform),i),c=s.isClosed,d=(c?ry:u5)(o,a,s.outline);let h;if(d!==null&&(h=d.sort((y,m)=>S.Dist2(y,o)-S.Dist2(m,o))[0]??(c?void 0:a)),h===void 0)return;const p=Q.applyToPoint(s.transform,h),f=Q.applyToPoint(Q.Inverse(e),p);n.setTo(f),s.didIntersect=!0}function y8(n,t,e){const{arrowheadEnd:s,arrowheadStart:r}=t.props,i=t.props.bend;if(Math.abs(i)>Math.abs(t.props.bend*(v8*t.props.scale)))return mg(n,t,e);const o=Co(n,t,e),a=S.Med(o.start,o.end),c=S.Sub(o.end,o.start),l=S.Len(c)?c.uni():S.From(c),d=S.Add(a,l.per().mul(-i)),h=wu(n,t,"start"),p=wu(n,t,"end"),f=o.start.clone(),y=o.end.clone(),m=d.clone();if(S.Equals(f,y))return{bindings:e,isStraight:!0,start:{handle:f,point:f,arrowhead:t.props.arrowheadStart},end:{handle:y,point:y,arrowhead:t.props.arrowheadEnd},middle:m,isValid:!1,length:0};const x=t.props.bend<0,w=x?Dc:bI,b=fb(f,y,m),I=S.Angle(b.center,f),E=S.Angle(b.center,y),P=w(I,E);if(b.length===0||b.size===0||!Ex(b.length)||!Ex(b.size))return mg(n,t,e);const C=f.clone(),_=y.clone(),k=m.clone(),D=n.getShapePageTransform(t);let T=0,A=0,L=Io*t.props.scale;if(h&&!h.isExact){const te=Q.applyToPoint(D,C),le=Q.applyToPoint(D,b.center),Se=Q.applyToPoint(D,_),be=Q.Inverse(h.transform),nt=Q.applyToPoint(be,te),ie=Q.applyToPoint(be,le),yt=Q.applyToPoint(be,Se),{isClosed:Ke}=h,Ye=Ke?hg:Xx;let ke,st=Ye(ie,b.radius,h.outline);if(st){const Re=ie.angle(nt),_n=ie.angle(yt),Tt=w(Re,_n);st=st.filter(ut=>w(Re,ie.angle(ut))<=Tt);const cn=Tt*.25;st.sort(Ke?(ut,Bt)=>Math.abs(w(Re,ie.angle(ut))-cn)<Math.abs(w(Re,ie.angle(Bt))-cn)?-1:1:(ut,Bt)=>w(Re,ie.angle(ut))<w(Re,ie.angle(Bt))?-1:1),ke=st[0]??(Ke?void 0:nt)}else ke=Ke?void 0:nt;if(ke&&(C.setTo(n.getPointInShapeSpace(t,Q.applyToPoint(h.transform,ke))),h.didIntersect=!0,r!=="none")){const Re=Dr[t.props.size]/2+("size"in h.shape.props?Dr[h.shape.props.size]/2:0);T=(xu+Re)*t.props.scale,L+=Re*t.props.scale}}if(p&&!p.isExact){const te=Q.applyToPoint(D,C),le=Q.applyToPoint(D,_),Se=Q.applyToPoint(D,b.center),be=Q.Inverse(p.transform),nt=Q.applyToPoint(be,te),ie=Q.applyToPoint(be,Se),yt=Q.applyToPoint(be,le),Ke=p.isClosed,Ye=Ke?hg:Xx;let ke,st=Ye(ie,b.radius,p.outline);if(st){const Re=ie.angle(nt),_n=ie.angle(yt),Tt=w(Re,_n),cn=Tt*.75;st=st.filter(ut=>w(Re,ie.angle(ut))<=Tt),st.sort(Ke?(ut,Bt)=>Math.abs(w(Re,ie.angle(ut))-cn)<Math.abs(w(Re,ie.angle(Bt))-cn)?-1:1:(ut,Bt)=>w(Re,ie.angle(ut))<w(Re,ie.angle(Bt))?-1:1),st[0]?ke=st[0]:ke=Ke?void 0:yt}else ke=Ke?void 0:yt;if(ke&&(_.setTo(n.getPointInShapeSpace(t,Q.applyToPoint(p.transform,ke))),p.didIntersect=!0,s!=="none")){const Re=Dr[t.props.size]/2+("size"in p.shape.props?Dr[p.shape.props.size]/2:0);A=(xu+Re)*t.props.scale,L+=Re*t.props.scale}}let j=S.Angle(b.center,C),R=S.Angle(b.center,_),F=w(j,R),H=F*b.radius;const U=C.clone(),V=_.clone();if(T!==0&&U.setTo(b.center).add(S.FromAngle(j+F*(T/H*(x?1:-1))).mul(b.radius)),A!==0&&V.setTo(b.center).add(S.FromAngle(R+F*(A/H*(x?-1:1))).mul(b.radius)),S.DistMin(U,V,L)&&(T!==0&&A!==0?(T*=-1.5,A*=-1.5):T!==0?T*=-2:A!==0&&(A*=-2)),T!==0&&C.setTo(b.center).add(S.FromAngle(j+F*(T/H*(x?1:-1))).mul(b.radius)),A!==0&&_.setTo(b.center).add(S.FromAngle(R+F*(A/H*(x?-1:1))).mul(b.radius)),h&&p&&!h.isExact&&!p.isExact){j=S.Angle(b.center,C),R=S.Angle(b.center,_),F=w(j,R),H=F*b.radius;const te=gy(n,h.shape.id,p.shape.id);te==="double-bound"&&H<30?(C.setTo(f),_.setTo(y),k.setTo(m)):te==="safe"&&(h&&!h.didIntersect&&C.setTo(f),(p&&!p.didIntersect||w(I,j)>w(I,R))&&_.setTo(b.center).add(S.FromAngle(j+F*(Math.min(.9,Io*t.props.scale/H)*(x?1:-1))).mul(b.radius)))}S8(b.center,b.radius,C,_,k,P,x),C.equals(_)&&(C.setTo(k.clone().addXY(1,1)),_.setTo(k.clone().subXY(1,1))),f.setTo(C),y.setTo(_),m.setTo(k);const W=fb(f,y,m);return{bindings:e,isStraight:!1,start:{point:f,handle:o.start,arrowhead:t.props.arrowheadStart},end:{point:y,handle:o.end,arrowhead:t.props.arrowheadEnd},middle:m,handleArc:b,bodyArc:W,isValid:W.length!==0&&isFinite(W.center.x)&&isFinite(W.center.y)}}function fb(n,t,e){const s=Ym(n,t,e),r=S.Dist(s,n),i=+S.Clockwise(n,e,t),o=((n.y-t.y)**2+(n.x-t.x)**2)**.5,a=((t.y-e.y)**2+(t.x-e.x)**2)**.5,c=((e.y-n.y)**2+(e.x-n.x)**2)**.5,l=Math.acos((a*a+c*c-o*o)/(2*a*c))*2,d=+(_e>l),h=(je-l)*(i?1:-1),p=h*r;return{center:s,radius:r,size:h,length:p,largeArcFlag:d,sweepFlag:i}}function S8(n,t,e,s,r,i,o){const a=S.Angle(n,e),c=S.Angle(n,s);let l=Dc(a,c);if(o||(l=je-l),r.setTo(n).add(S.FromAngle(a+l*(.5*(o?1:-1))).mul(t)),l>i){r.rotWith(n,_e);const d=s.clone();s.setTo(e),e.setTo(d)}}const w8=8;function x8(n){return Math.abs(n.props.bend)<w8*n.props.scale}function wu(n,t,e){const s=n.getBindingsFromShape(t,"arrow").find(c=>c.props.terminal===e);if(!s)return;const r=n.getShape(s.toId);if(!r)return;const i=n.getShapePageTransform(r),o=n.getShapeGeometry(r),a=o instanceof ls?o.children[0].vertices:o.vertices;return{shape:r,transform:i,isClosed:o.isClosed,isExact:s.props.isExact,didIntersect:!1,outline:a}}function gb(n,t,e,s){const r=n.getShape(e.toId);if(r){const{point:i,size:o}=n.getShapeGeometry(r).bounds,a=S.Add(i,S.MulV(e.props.isPrecise||s?e.props.normalizedAnchor:{x:.5,y:.5},o)),c=Q.applyToPoint(n.getShapePageTransform(r),a);return Q.applyToPoint(Q.Inverse(t),c)}else return new S(0,0)}function gn(n,t){const e=n.getBindingsFromShape(t,"arrow");return{start:e.find(s=>s.props.terminal==="start"),end:e.find(s=>s.props.terminal==="end")}}const b8=uB("arrow info",(n,t)=>{const e=gn(n,t);return x8(t)?mg(n,t,e):y8(n,t,e)});function Ps(n,t){const e=typeof t=="string"?t:t.id;return b8.get(n,e)}function Co(n,t,e){var a,c;const s=n.getShapePageTransform(t),r=gy(n,(a=e.start)==null?void 0:a.toId,(c=e.end)==null?void 0:c.toId),i=e.start?gb(n,s,e.start,r==="double-bound"||r==="start-contains-end"):S.From(t.props.start),o=e.end?gb(n,s,e.end,r==="double-bound"||r==="end-contains-start"):S.From(t.props.end);return{start:i,end:o}}function Ea(n,t,e,s){const r=typeof t=="string"?t:t.id,i=typeof e=="string"?e:e.id,o=n.getBindingsFromShape(r,"arrow").filter(c=>c.props.terminal===s.terminal);o.length>1&&n.deleteBindings(o.slice(1));const a=o[0];a?n.updateBinding({...a,toId:i,props:s}):n.createBinding({type:"arrow",fromId:r,toId:i,props:s})}function ud(n,t,e){const s=n.getBindingsFromShape(t,"arrow").filter(r=>r.props.terminal===e);n.deleteBindings(s)}const Io=10,xu=10,v8=10,Dr={s:2,m:3.5,l:5,xl:10};function gy(n,t,e){if(!t||!e)return"safe";if(t===e)return"double-bound";const s=n.getShapePageBounds(t),r=n.getShapePageBounds(e);if(s&&r){if(s.contains(r))return"start-contains-end";if(r.contains(s))return"end-contains-start"}return"safe"}class hd extends ld{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:t}){Dp(this.editor,this.editor.getShape(t.fromId))}onAfterChange({bindingAfter:t}){Dp(this.editor,this.editor.getShape(t.fromId))}onAfterChangeFromShape({shapeAfter:t}){Dp(this.editor,t)}onAfterChangeToShape({binding:t}){EP(this.editor,t.fromId)}onBeforeIsolateFromShape({binding:t}){const e=this.editor.getShape(t.fromId);e&&bu({editor:this.editor,arrow:e,terminal:t.props.terminal})}}g(hd,"type","arrow"),g(hd,"props",HC),g(hd,"migrations",KC);function EP(n,t){var x;const e=n.getShape(t);if(!e)return;const s=gn(n,e),{start:r,end:i}=s,o=r?n.getShape(r.toId):void 0,a=i?n.getShape(i.toId):void 0,c=n.getAncestorPageId(e);if(!c)return;let l;if(o&&a)l=n.findCommonAncestor([o,a])??c;else if(o||a){const w=(x=o||a)==null?void 0:x.parentId;w&&w===e.parentId?l=e.parentId:l=c}else return;l&&l!==e.parentId&&n.reparentShapes([t],l);const d=n.getShape(t);if(!d)throw Error("no reparented arrow");const h=n.getShapeNearestSibling(d,o),p=n.getShapeNearestSibling(d,a);let f;if(h&&p)f=h.index>p.index?h:p;else if(h&&!p)f=h;else if(p&&!h)f=p;else return;let y;const m=n.getSortedChildIdsForParent(f.parentId).map(w=>n.getShape(w)).filter(w=>w.index>f.index);if(m.length){const w=m.find(b=>b.type!=="arrow");if(d.index>f.index&&(!w||d.index<w.index))return;y=tc(f.index,m[0].index)}else y=Zs(f.index);y!==d.index&&n.updateShapes([{id:t,type:"arrow",index:y}])}function Dp(n,t){const e=gn(n,t);for(const s of["start","end"]){const r=e[s];if(!r)continue;const i=n.getShape(r.toId),o=n.getAncestorPageId(t)===n.getAncestorPageId(i);(!i||!o)&&bu({editor:n,arrow:t,terminal:s,unbind:!0})}EP(n,t.id)}function bu({editor:n,arrow:t,terminal:e,unbind:s=!1,useHandle:r=!1}){const i=Ps(n,t);if(!i)throw new Error("expected arrow info");const o=r?i.start.handle:i.start.point,a=r?i.end.handle:i.end.point,c=e==="start"?o:a,l={id:t.id,type:"arrow",props:{[e]:{x:c.x,y:c.y},bend:t.props.bend}};if(!i.isStraight){const d=e==="start"?o:i.start.handle,h=e==="end"?a:i.end.handle,p=S.Med(d,h),f=S.Sub(d,h).per().uni().mul(i.handleArc.radius*2*Math.sign(t.props.bend)),y=Fc(i.handleArc.center,S.Add(p,f),i.handleArc.center,i.handleArc.radius);et((y==null?void 0:y.length)===1);const m=S.Dist(p,y[0])*Math.sign(t.props.bend);Nr(m,l.props.bend)||(l.props.bend=m)}n.updateShape(l),s&&ud(n,t,e)}const _P=[hd],Lt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Pt={s:2,m:3.5,l:5,xl:10},Bo={s:18,m:24,l:36,xl:44},sr={s:18,m:22,l:26,xl:32},C8={s:18,m:20,l:24,xl:28},Ts={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},I8=20,P8=4.25,ss=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function E8(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var s,r,i,o,a=[],c=!0,l=!1;try{if(i=(e=e.call(n)).next,t===0){if(Object(e)!==e)return;c=!1}else for(;!(c=(s=i.call(e)).done)&&(a.push(s.value),a.length!==t);c=!0);}catch(d){l=!0,r=d}finally{try{if(!c&&e.return!=null&&(o=e.return(),Object(o)!==o))return}finally{if(l)throw r}}return a}}function mb(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),e.push.apply(e,s)}return e}function Mn(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?mb(Object(e),!0).forEach(function(s){_8(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):mb(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}function _8(n,t,e){return t=L8(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function T8(n,t){if(n==null)return{};var e={},s=Object.keys(n),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(e[r]=n[r]);return e}function k8(n,t){if(n==null)return{};var e=T8(n,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(e[s]=n[s])}return e}function yb(n,t){return A8(n)||E8(n,t)||TP(n,t)||O8()}function kl(n){return M8(n)||j8(n)||TP(n)||D8()}function M8(n){if(Array.isArray(n))return yg(n)}function A8(n){if(Array.isArray(n))return n}function j8(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function TP(n,t){if(n){if(typeof n=="string")return yg(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return yg(n,t)}}function yg(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,s=new Array(t);e<t;e++)s[e]=n[e];return s}function D8(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O8(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R8(n,t){if(typeof n!="object"||n===null)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function L8(n){var t=R8(n,"string");return typeof t=="symbol"?t:String(t)}function Va(n){var t=n.sizes.shift(),e=Math.max(Math.ceil(t[0]),1),s=Math.max(Math.ceil(t[1]),1),r=[e-1,s-1,1,1],i=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;o?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(e,s)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=e,c.height=s);var l=a.getContext("2d"),d=c.getContext("2d");d&&(d.fillRect.apply(d,r),l.drawImage(c,e-1,s-1,1,1,0,0,1,1));var h=l&&l.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-i;return[a,c].forEach(function(f){f.height=0,f.width=0}),o?(postMessage({width:e,height:s,benchmark:p,isTestPass:h}),!h&&n.sizes.length&&Va(n)):h?n.onSuccess(e,s,p):(n.onError(e,s,p),n.sizes.length&&Va(n)),h}var Op={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},$8=["onError","onSuccess"],Po={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},_a={};function Rp(n){var t=n.width===n.height,e=n.height===1,s=n.width===1,r=[];if(!n.width||!n.height)n.sizes.forEach(function(d){var h=t||e?d:1,p=t||s?d:1;r.push([h,p])});else for(var i=n.min||Po.min,o=n.step||Po.step,a=Math.max(n.width,n.height);a>=i;){var c=t||e?a:1,l=t||s?a:1;r.push([c,l]),a-=o}return r}function Ml(n){var t=window&&"HTMLCanvasElement"in window,e=window&&"OffscreenCanvas"in window,s=Date.now(),r=n.onError,i=n.onSuccess,o=k8(n,$8),a=null;if(!t)return!1;if(n.useWorker&&e){var c=`
            var canvasTest = `.concat(Va.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(l);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(h){var p=h.data,f=p.width,y=p.height,m=p.benchmark,x=p.isTestPass;x?(_a[s].onSuccess(f,y,m),delete _a[s]):_a[s].onError(f,y,m)}}if(n.usePromise)return new Promise(function(h,p){var f=Mn(Mn({},n),{},{onError:function(w,b,I){var E;if(n.sizes.length===0)E=!0;else{var P=n.sizes.slice(-1),C=yb(P,1),_=yb(C[0],2),k=_[0],D=_[1];E=w===k&&b===D}r(w,b,I),E&&p({width:w,height:b,benchmark:I})},onSuccess:function(w,b,I){i(w,b,I),h({width:w,height:b,benchmark:I})}});if(a){var y=f.onError,m=f.onSuccess;_a[s]={onError:y,onSuccess:m},a.postMessage(o)}else Va(f)});if(a)_a[s]={onError:r,onSuccess:i},a.postMessage(o);else return Va(n)}var Lp={maxArea:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rp({width:t.max,height:t.max,min:t.min,step:t.step,sizes:kl(Op.area)}),s=Mn(Mn(Mn({},Po),t),{},{sizes:e});return Ml(s)},maxHeight:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rp({width:1,height:t.max,min:t.min,step:t.step,sizes:kl(Op.height)}),s=Mn(Mn(Mn({},Po),t),{},{sizes:e});return Ml(s)},maxWidth:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rp({width:t.max,height:1,min:t.min,step:t.step,sizes:kl(Op.width)}),s=Mn(Mn(Mn({},Po),t),{},{sizes:e});return Ml(s)},test:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Mn(Mn({},Po),t);return e.sizes=kl(e.sizes),e.width&&e.height&&(e.sizes=[[e.width,e.height]]),Ml(e)}};let $p=null;function F8(){return $p||($p=N8()),$p}async function N8(){const n=await Lp.maxWidth({usePromise:!0}),t=await Lp.maxHeight({usePromise:!0}),e=await Lp.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:t.height,maxArea:e.width*e.height}}const Sb=8192,B8=4096*4096;async function z8(n,t){if(n<=Sb&&t<=Sb&&n*t<=B8)return[n,t];const{maxWidth:e,maxHeight:s,maxArea:r}=await F8(),i=n/t;if(n>e&&(n=e,t=n/i),t>s&&(t=s,n=t*i),n*t>r){const o=Math.sqrt(r/(n*t));n*=o,t*=o}return[n,t]}function U8(n,t){const e=n.w/t.w,s=n.h/t.h;return e<=1&&s<=1?n:e>s?{w:n.w/e,h:n.h/e}:{w:n.w/s,h:n.h/s}}function H8(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function K8(n){const t=new URL(n).host.replace("www.","");for(const e of jc)if(kP(e.hostnames,t)){const s=e.fromEmbedUrl(n);if(s)return{definition:e,url:s,embedUrl:n}}}const G8=n=>n.split("*").map(t=>H8(t)).join(".+"),kP=(n,t)=>!!n.find(e=>{const s=new RegExp(G8(e));return t.match(s)});function W8(n){const t=new URL(n).host.replace("www.","");for(const e of jc)if(kP(e.hostnames,t)){const s=e.toEmbedUrl(n);if(s)return{definition:e,embedUrl:s,url:n}}}function MP(n){return W8(n)??K8(n)}function Or(n){try{return MP(n)}catch(t){console.error(t)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Eo="  ",nn=class nn{static insertTextFirefox(t,e){t.setRangeText(e,t.selectionStart||0,t.selectionEnd||0,"end"),t.dispatchEvent(new InputEvent("input",{data:e,inputType:"insertText",isComposing:!1}))}static insert(t,e){const s=t.ownerDocument,r=s.activeElement;r!==t&&t.focus(),s.execCommand("insertText",!1,e)||nn.insertTextFirefox(t,e),r===s.body?t.blur():r instanceof HTMLElement&&r!==t&&r.focus()}static set(t,e){t.select(),nn.insert(t,e)}static getSelection(t){const{selectionStart:e,selectionEnd:s}=t;return t.value.slice(e||void 0,s||void 0)}static wrapSelection(t,e,s){const{selectionStart:r,selectionEnd:i}=t,o=nn.getSelection(t);nn.insert(t,e+o+(s??e)),t.selectionStart=(r||0)+e.length,t.selectionEnd=(i||0)+e.length}static replace(t,e,s){let r=0;t.value.replace(e,(...i)=>{const o=r+i[i.length-2],a=i[0].length;t.selectionStart=o,t.selectionEnd=o+a;const c=typeof s=="string"?s:s(...i);return nn.insert(t,c),t.selectionStart=o,r+=c.length-a,c})}static findLineEnd(t,e){const s=t.lastIndexOf(`
`,e-1)+1;return t.charAt(s)!=="	"?e:s+1}static indent(t){var a;const{selectionStart:e,selectionEnd:s,value:r}=t,i=r.slice(e,s),o=(a=/\n/g.exec(i))==null?void 0:a.length;if(o&&o>0){const c=r.lastIndexOf(`
`,e-1)+1,l=t.value.slice(c,s-1),d=l.replace(/^|\n/g,`$&${Eo}`),h=d.length-l.length;t.setSelectionRange(c,s-1),nn.insert(t,d),t.setSelectionRange(e+1,s+h)}else nn.insert(t,Eo)}static unindent(t){const{selectionStart:e,selectionEnd:s,value:r}=t,i=r.lastIndexOf(`
`,e-1)+1,o=nn.findLineEnd(r,s),a=t.value.slice(i,o),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;t.setSelectionRange(i,o),nn.insert(t,c);const d=/\t| {1,2}/.exec(r.slice(i,e)),h=d?d[0].length:0,p=e-h;t.setSelectionRange(e-h,Math.max(p,s-l))}static indentCE(t){var c;const e=window.getSelection(),s=t.innerText,r=Al(t)??0,i=Al(t)??0,o=s.slice(r,i),a=(c=/\n/g.exec(o))==null?void 0:c.length;if(a&&a>0){const l=s.lastIndexOf(`
`,r-1)+1,d=s.slice(l,i-1),p=d.replace(/^|\n/g,`$&${Eo}`).length-d.length;e&&e.setBaseAndExtent(t,r+1,t,i+p)}else{const l=window.getSelection();t.innerText=s.slice(0,r)+Eo+s.slice(r),l==null||l.setBaseAndExtent(t,r+1,t,r+2)}}static unindentCE(t){const e=window.getSelection(),s=t.innerText,r=Al(t)??0,i=Al(t)??0,o=s.lastIndexOf(`
`,r-1)+1,a=nn.findLineEnd(s,i),c=s.slice(o,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=c.length-l.length;if(e){e.setBaseAndExtent(t,o,t,a);const h=/\t| {1,2}/.exec(s.slice(o,r)),p=h?h[0].length:0,f=r-p;e.setBaseAndExtent(t,r-p,t,Math.max(f,i-d))}}static normalizeText(t){return t.replace(nn.fixNewLines,`
`)}static normalizeTextForDom(t){return t.replace(nn.fixNewLines,`
`).split(`
`).map(e=>e||" ").join(`
`)}};g(nn,"fixNewLines",/\r?\n|\r/g);let zo=nn;function Al(n){if(typeof window.getSelection>"u")return;const t=window.getSelection();if(!t)return;let e=0;if(t.rangeCount!==0){const s=t.getRangeAt(0),r=s.cloneRange();r.selectNodeContents(n),r.setEnd(s.endContainer,s.endOffset),e=r.toString().length}return e}const V8=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function AP(n){return V8.test(n)}function Y8(n){return n.replace(/\t/g,Eo)}function X8(n){const t=n.split(`
`);for(;t[0]&&t[0].trim().length===0;)t.shift();let e=1/0;for(const s of t)if(s.trim().length>0){const r=s.length-s.trimStart().length;e=Math.min(e,r)}return t.map(s=>s.slice(e)).join(`
`)}function q8(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Z8(n){return q8(X8(Y8(n)))}function J8(n,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:r},{toasts:i,msg:o},a){n.registerExternalAssetHandler("file",async({file:c})=>{const l=c.name;let d=c;const h=s.includes(d.type),p=r.includes(d.type);et(h||p,`File type not allowed: ${d.type}`),et(d.size<=e,`File size too big: ${(d.size/1024).toFixed()}kb > ${(e/1024).toFixed()}kb`),d.type==="video/quicktime"&&(d=new Blob([d],{type:"video/mp4"}));let f=h?await Is.getImageSize(d):await Is.getVideoSize(d);const y=await Is.isAnimated(d)||p,m=await fN(await d.arrayBuffer());if(isFinite(t)){const b=U8(f,{w:t,h:t});f!==b&&Is.isStaticImageType(d.type)&&(f=b)}const x=yi.createId(m),w={id:x,type:h?"image":"video",typeName:"asset",props:{name:l,src:"",w:f.w,h:f.h,fileSize:d.size,mimeType:d.type,isAnimated:y}};return a?(w.props.src=x,await o8({persistenceKey:a,assetId:x,blob:d})):w.props.src=await vi.blobToDataUrl(d),yi.create(w)}),n.registerExternalAssetHandler("url",async({url:c})=>{var d,h,p,f,y;let l;try{const x=await(await Ms(c,{method:"GET",mode:"no-cors"})).text(),w=new DOMParser().parseFromString(x,"text/html");l={image:((d=w.head.querySelector('meta[property="og:image"]'))==null?void 0:d.getAttribute("content"))??"",favicon:((h=w.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:h.getAttribute("href"))??((p=w.head.querySelector('link[rel="icon"]'))==null?void 0:p.getAttribute("href"))??"",title:((f=w.head.querySelector('meta[property="og:title"]'))==null?void 0:f.getAttribute("content"))??c,description:((y=w.head.querySelector('meta[property="og:description"]'))==null?void 0:y.getAttribute("content"))??""},l.image.startsWith("/")&&(l.image=new URL(l.image,c).href),l.favicon.startsWith("/")&&(l.favicon=new URL(l.favicon,c).href)}catch(m){console.error(m),i.addToast({title:o("assets.url.failed"),severity:"error"}),l={image:"",favicon:"",title:"",description:""}}return{id:yi.createId(Jf(c)),typeName:"asset",type:"bookmark",props:{src:c,description:l.description,image:l.image,favicon:l.favicon,title:l.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:c,text:l})=>{const d=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=new DOMParser().parseFromString(l,"image/svg+xml").querySelector("svg");if(!h)throw new Error("No <svg/> element present");let p=parseFloat(h.getAttribute("width")||"0"),f=parseFloat(h.getAttribute("height")||"0");if(!(p&&f)){document.body.appendChild(h);const m=h.getBoundingClientRect();document.body.removeChild(h),p=m.width,f=m.height}const y=await n.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});if(!y)throw Error("Could not create an asset");wb(n,[y],d)}),n.registerExternalContentHandler("embed",({point:c,url:l,embed:d})=>{const h=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:p,height:f}=d,y=Oe(),m={id:y,type:"embed",x:h.x-(p||450)/2,y:h.y-(f||450)/2,props:{w:p,h:f,url:l}};n.createShapes([m]).select(y)}),n.registerExternalContentHandler("files",async({point:c,files:l})=>{const d=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=new S(d.x,d.y),p=[];await Promise.all(l.map(async(f,y)=>{if(f.size>e)return console.warn(`File size too big: ${(f.size/1024).toFixed()}kb > ${(e/1024).toFixed()}kb`),null;if(!f.type)throw new Error("No mime type");if(!s.concat(r).includes(f.type))return console.warn(`${f.name} not loaded - Extension not allowed.`),null;try{const m=await n.getAssetForExternalContent({type:"file",file:f});if(!m)throw Error("Could not create an asset");p[y]=m}catch(m){return i.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(m),null}})),wb(n,ge(p),h)}),n.registerExternalContentHandler("text",async({point:c,text:l})=>{const d=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=n.getShapeUtil("text").getDefaultProps(),p=Z8(l),f=n.getOnlySelectedShape();if(f&&"text"in f.props){n.updateShapes([{id:f.id,type:f.type,props:{text:p}}]);return}let y,m,x,w="middle";const b=p.split(`
`).length>1,I=AP(p);b&&(w=b?I?"end":"start":"middle");const E=n.textMeasure.measureText(p,{...Lt,fontFamily:Ts[h.font],fontSize:Bo[h.size],maxWidth:null}),P=Math.min(b?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(E.w>P){const C=n.textMeasure.measureText(p,{...Lt,fontFamily:Ts[h.font],fontSize:Bo[h.size],maxWidth:P});y=C.w,m=C.h,x=!1,w=I?"end":"start"}else y=E.w,m=E.h,x=!0;d.y-m/2<n.getViewportPageBounds().minY+40&&(d.y=n.getViewportPageBounds().minY+40+m/2),n.createShapes([{id:Oe(),type:"text",x:d.x-y/2,y:d.y-m/2,props:{text:p,textAlign:w,autoSize:x,w:y}}])}),n.registerExternalContentHandler("url",async({point:c,url:l})=>{const d=Or(l);if(d)return n.putExternalContent({type:"embed",url:d.url,point:c,embed:d.definition});const h=c??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),p=yi.createId(Jf(l)),f=Q8(n,l,h);let y=n.getAsset(p),m=!1;if(!y){m=!0;try{const x=await n.getAssetForExternalContent({type:"url",url:l});if(!x)throw Error("Could not create an asset");y=x}catch{i.addToast({title:o("assets.url.failed"),severity:"error"});return}}n.batch(()=>{m&&n.createAssets([y]),n.updateShapes([{id:f.id,type:f.type,props:{assetId:y.id}}])})})}async function wb(n,t,e){if(!t.length)return[];const s=S.From(e),r=[];for(let i=0;i<t.length;i++){const o=t[i];switch(o.type){case"bookmark":{r.push({id:Oe(),type:"bookmark",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,url:o.props.src}}),s.x+=300;break}case"image":{r.push({id:Oe(),type:"image",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w;break}case"video":r.push({id:Oe(),type:"video",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w}}return n.batch(()=>{const i=t.filter(o=>!n.getAsset(o.id));i.length&&n.createAssets(i),n.createShapes(r).select(...r.map(o=>o.id)),jP(n,e)}),r.map(i=>i.id)}function jP(n,t){const e=n.getViewportPageBounds();let s=n.getSelectionPageBounds();if(s){const r=s.center.sub(t);n.updateShapes(n.getSelectedShapes().map(i=>{const o=n.getShapeParentTransform(i).decompose().rotation,a=S.Rot(r,-o);return{id:i.id,type:i.type,x:i.x-a.x,y:i.y-a.y}}))}s=n.getSelectionPageBounds(),s&&!e.contains(s)&&n.zoomToSelection()}function Q8(n,t,e){const s={id:Oe(),type:"bookmark",x:e.x-150,y:e.y-160,opacity:1,props:{assetId:null,url:t}};return n.batch(()=>{n.createShapes([s]).select(s.id),jP(n,e)}),n.getShape(s.id)}const eH=new or,tH=n=>async t=>!t||!t.props.src?null:n&&t.props.src.startsWith("asset:")?await eH.get(t,async()=>await nH(n,t.id)):t.type==="video"?t.props.src:t.type!=="image"?null:t.props.src;async function nH(n,t){const e=await i8({assetId:t,persistenceKey:n});return e?URL.createObjectURL(e):null}var xf;let sH=(xf=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")});g(this,"onKeyUp",e=>{var s;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...e,target:"shape",shape:r}))}})}},g(xf,"id","idle"),xf);var bf;let rH=(bf=class extends ee{constructor(){super(...arguments);g(this,"shape");g(this,"markId","");g(this,"onEnter",()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:s=>!s.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:s,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()});g(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});g(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}});g(this,"onPointerUp",()=>{this.cancel()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()});g(this,"preciseTimeout",-1);g(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var d;const{originPagePoint:e}=this.editor.inputs,s=Oe();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShape({id:s,type:"arrow",x:e.x,y:e.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(s);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=i.find(h=>h.id==="start"),l=(d=o.onHandleDrag)==null?void 0:d.call(o,r,{handle:{...c,x:0,y:0},isPrecise:!0,initial:a});l&&this.editor.updateShapes([l]),this.shape=this.editor.getShape(s),this.editor.select(s)}updateArrowShapeEndHandle(){var r,i;const e=this.shape;if(!e)throw Error("expected shape");const s=this.editor.getShapeHandles(e);if(!s)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=s.find(d=>d.id==="start"),l=(r=o.onHandleDrag)==null?void 0:r.call(o,e,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:a});l&&this.editor.updateShapes([l])}{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),l=s.find(h=>h.id==="end"),d=(i=o.onHandleDrag)==null?void 0:i.call(o,this.editor.getShape(e),{handle:{...l,x:c.x,y:c.y},isPrecise:!1,initial:a});d&&this.editor.updateShapes([d])}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},g(bf,"id","pointing"),bf);class pd extends ee{constructor(){super(...arguments);g(this,"shapeType","arrow")}}g(pd,"id","arrow"),g(pd,"initial","idle"),g(pd,"children",()=>[sH,rH]);class my extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"initialShape");g(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");g(this,"util",this.editor.getShapeUtil(this.shapeType));g(this,"isPen",!1);g(this,"isPenOrStylus",!1);g(this,"segmentMode","free");g(this,"didJustShiftClickToExtendPreviousShapeLine",!1);g(this,"pagePointWhereCurrentSegmentChanged",{});g(this,"pagePointWhereNextSegmentChanged",null);g(this,"lastRecordedPoint",{});g(this,"mergeNextPoint",!1);g(this,"currentLineLength",0);g(this,"canDraw",!1);g(this,"markId",null);g(this,"onEnter",e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});g(this,"onPointerMove",()=>{const{inputs:e}=this.editor;if(this.isPen&&!e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?S.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())});g(this,"onKeyDown",e=>{if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()});g(this,"onKeyUp",e=>{if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()});g(this,"onExit",()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(e,s){if(!this.canClose())return!1;const r=Pt[s],i=e[0].points[0],o=e[e.length-1],a=o.points[o.points.length-1];return i!==a&&this.currentLineLength>r*4&&S.DistMin(i,a,r*2)}startShape(){const{inputs:{originPagePoint:e,isPen:s}}=this.editor;this.markId="draw start "+Qe(),this.editor.mark(this.markId);const{z:r=.5}=this.info.point;this.isPen=s,this.isPenOrStylus=s||r>0&&r<.5||r>.5&&r<1;const i=this.isPenOrStylus?r*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=At(a.props.segments);if(!c)throw Error("Expected a previous segment!");const l=At(c.points);if(!l)throw Error("Expected a previous point!");const{x:d,y:h}=this.editor.getPointInShapeSpace(a,e).toFixed(),p={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+i.toFixed(2)},{x:d,y:h,z:+i.toFixed(2)}]},f=Q.applyToPoint(this.editor.getShapePageTransform(a.id),l);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const y=[...a.props.segments,p];this.currentLineLength<Pt[a.props.size]*4&&(this.currentLineLength=this.getLineLength(y));const m={id:a.id,type:this.shapeType,props:{segments:y}};this.canClose()&&(m.props.isClosed=this.getIsClosed(y,a.props.size)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const o=Oe();this.editor.createShapes([{id:o,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:e}=this,{inputs:s}=this.editor;if(!e)return;const{id:r,props:{size:i}}=e,o=this.editor.getShape(r);if(!o)return;const{segments:a}=o.props,{x:c,y:l,z:d}=this.editor.getPointInShapeSpace(o,s.currentPagePoint).toFixed(),h=this.isPenOrStylus?+(s.currentPagePoint.z*1.25).toFixed(2):.5,p={x:c,y:l,z:h};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(S.Dist2(f,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const m=At(a);if(!m)throw Error("Expected a previous segment!");const x=At(m.points);if(!x)throw Error("Expected a previous last point!");let w;const b=this.editor.getPointInShapeSpace(o,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(m.type==="straight"){this.currentLineLength+=S.Dist(x,b),w={type:"straight",points:[{...x},b]};const E=this.editor.getShapePageTransform(o);this.pagePointWhereCurrentSegmentChanged=Q.applyToPoint(E,x)}else w={type:"straight",points:[b,p]};const I={id:r,type:this.shapeType,props:{segments:[...a,w]}};this.canClose()&&(I.props.isClosed=this.getIsClosed(a,i)),this.editor.updateShapes([I])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(S.Dist2(f,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const m=a.slice(),x=m[m.length-1],w=At(x.points);if(!w)throw Error("No previous point!");const b={type:"free",points:[...S.PointsBetween(w,p,6).map(P=>({x:Js(P.x),y:Js(P.y),z:Js(P.z)}))]},I=[...m,b];this.currentLineLength<Pt[o.props.size]*4&&(this.currentLineLength=this.getLineLength(I));const E={id:r,type:this.shapeType,props:{segments:I}};this.canClose()&&(E.props.isClosed=this.getIsClosed(I,i)),this.editor.updateShapes([E])}break}case"straight":{const f=a.slice(),y=f[f.length-1],{pagePointWhereCurrentSegmentChanged:m}=this,{ctrlKey:x,currentPagePoint:w}=this.editor.inputs;if(!m)throw Error("We should have a point where the segment changed");let b,I=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(I=!x,this.didJustShiftClickToExtendPreviousShapeLine=!1):I=!x;let E=this.editor.getPointInShapeSpace(o,w).toFixed().toJson(),P=!1,C;if((this.editor.user.getIsSnapMode()?!x:x)&&f.length>2){let D,T=8/this.editor.getZoomLevel();for(let A=0,L=a.length-2;A<L;A++){const j=a[A];if(!j)break;if(j.type==="free")continue;const R=j.points[0],F=At(j.points);if(!(R&&F))continue;const H=S.NearestPointOnLineSegment(R,F,E);if(S.DistMin(H,E,T)){D=H.toFixed().toJson(),T=S.Dist(H,E),C=j;break}}D&&(P=!0,E=D)}if(P&&C){const D=this.editor.getShapePageTransform(o),T=C.points[0],A=At(C.points);if(!A)throw Error("Expected a last point!");const L=Q.applyToPoint(D,T),j=Q.applyToPoint(D,A),R=Q.applyToPoint(D,E);this.editor.snaps.setIndicators([{id:Qe(),type:"points",points:[L,R,j]}])}else{if(this.editor.snaps.clearIndicators(),I){const D=S.Angle(m,w),A=gu(D,24)-D;b=S.RotWith(w,m,A)}else b=w;E=this.editor.getPointInShapeSpace(o,b).toFixed().toJson()}this.currentLineLength+=S.Dist(y.points[0],E),f[f.length-1]={...y,type:"straight",points:[y.points[0],E]};const k={id:r,type:this.shapeType,props:{segments:f}};this.canClose()&&(k.props.isClosed=this.getIsClosed(a,i)),this.editor.updateShapes([k]);break}case"free":{const f=a.slice(),y=f[f.length-1],m=[...y.points];if(m.length&&this.mergeNextPoint){const{z:w}=m[m.length-1];m[m.length-1]={x:p.x,y:p.y,z:w?Math.max(w,p.z):p.z}}else this.currentLineLength+=S.Dist(m[m.length-1],p),m.push(p);f[f.length-1]={...y,points:m},this.currentLineLength<Pt[o.props.size]*4&&(this.currentLineLength=this.getLineLength(f));const x={id:r,type:this.shapeType,props:{segments:f}};if(this.canClose()&&(x.props.isClosed=this.getIsClosed(f,i)),this.editor.updateShapes([x]),m.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:r,type:this.shapeType,props:{isComplete:!0}}]);const w=Oe(),b=this.editor.getShape(r).props;this.editor.createShapes([{id:w,type:this.shapeType,x:Js(s.currentPagePoint.x),y:Js(s.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:b.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}}]),this.initialShape=Je(this.editor.getShape(w)),this.mergeNextPoint=!1,this.lastRecordedPoint=s.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let s=0;for(const r of e)for(let i=0;i<r.points.length-1;i++){const o=r.points[i],a=r.points[i+1];s+=S.Dist2(a,o)}return Math.sqrt(s)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}g(my,"id","drawing");var vf;let DP=(vf=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("drawing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(vf,"id","idle"),vf);class fd extends ee{constructor(){super(...arguments);g(this,"shapeType","draw");g(this,"onExit",()=>{const e=this.children.drawing;e.initialShape=void 0})}}g(fd,"id","draw"),g(fd,"initial","idle"),g(fd,"children",()=>[DP,my]);class Sg extends dd{constructor(){super(...arguments);g(this,"shapeType","frame");g(this,"onCreate",e=>{if(!e)return;const s=this.editor.getShapePageBounds(e),r=[],i=this.editor.getShapeAncestors(e).map(o=>o.id);this.editor.getSortedChildIdsForParent(e.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===e.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&s.contains(c)&&iH(a,i,e)&&r.push(a.id)}),this.editor.reparentShapes(r,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}g(Sg,"id","frame"),g(Sg,"initial","idle");function iH(n,t,e){return t.includes(n.id)?!1:n.parentId===e.parentId}var Cf;let oH=(Cf=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onKeyUp",e=>{var s;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...e,target:"shape",shape:r}))}});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(Cf,"id","idle"),Cf);var If;let aH=(If=class extends ee{constructor(){super(...arguments);g(this,"markId","");g(this,"onPointerUp",()=>{this.complete()});g(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,r=Oe();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(os),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs,s=Oe();this.markId=`creating:${s}`,this.editor.mark(this.markId);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(os),o=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:s,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(os),scale:r,...o}}]);const a=this.editor.getShape(s);if(!a)return;const{w:c,h:l}=a.props,d=new S(c/2,l/2).mul(r),h=this.editor.getShapeParentTransform(a);h&&d.rot(-h.rotation()),this.editor.select(s),this.editor.updateShape({id:a.id,type:"geo",x:a.x-d.x,y:a.y-d.y,props:{geo:this.editor.getStyleForNextShape(os),w:c*r,h:l*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},g(If,"id","pointing"),If);class gd extends ee{constructor(){super(...arguments);g(this,"shapeType","geo")}}g(gd,"id","geo"),g(gd,"initial","idle"),g(gd,"children",()=>[oH,aH]);class md extends ee{constructor(){super(...arguments);g(this,"shapeType","highlight");g(this,"onExit",()=>{const e=this.children.drawing;e.initialShape=void 0})}}g(md,"id","highlight"),g(md,"initial","idle"),g(md,"children",()=>[DP,my]);var Pf;let cH=(Pf=class extends ee{constructor(){super(...arguments);g(this,"shapeId","");g(this,"onEnter",e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})});g(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(Pf,"id","idle"),Pf);const xb=2;var Ef;let lH=(Ef=class extends ee{constructor(){super(...arguments);g(this,"shape",{});g(this,"markId");g(this,"onEnter",e=>{const{inputs:s}=this.editor,{currentPagePoint:r}=s;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&s.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(f=>f.type==="vertex").sort(Xt),c=a[a.length-1],l=a[a.length-2],d=Q.applyToPoint(this.editor.getShapeParentTransform(this.shape),new S(this.shape.x,this.shape.y)),h=S.Sub(r,d).addXY(.1,.1),p=Je(this.shape.props.points);if(S.DistMin(c,l,xb)||S.DistMin(h,c,xb))p[c.id]={id:c.id,index:c.index,x:h.x,y:h.y};else{const f=Zs(c.index);p[f]={id:f,index:f,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:p}}])}else{const o=Oe();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:r.x,y:r.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});g(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const s=At(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...s,x:s.x-.1,y:s.y-.1},onInteractionEnd:"line"})}});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},g(Ef,"id","pointing"),Ef);class yd extends ee{constructor(){super(...arguments);g(this,"shapeType","line")}}g(yd,"id","line"),g(yd,"initial","idle"),g(yd,"children",()=>[cH,lH]);var _f;let dH=(_f=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(_f,"id","idle"),_f);function Ne(n,t){var r;const e=new Set;for(const i of t){const o=n.getShape(i);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&e.add(o);const a=n.getShape(o.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&e.add(a)}const s=new Map;for(const i of e){const o=OP(n,i);o.length&&s.set(i,o)}for(const[i,o]of s){const a=n.getShapeUtil(i),c=ge(o.map(l=>n.getShape(l)));(r=a.onDragShapesOut)==null||r.call(a,i,c)}}function OP(n,t){const e=n.getSortedChildIdsForParent(t.id);if(e.length===0)return[];const s=n.getShapePageBounds(t);if(!s)return[];let r,i,o;const a=[];for(const c of e){const l=n.getShapePageBounds(c);if(!l)continue;if(!s.includes(l)){a.push(c);continue}r??(r=n.getShapeGeometry(t)),i??(i=n.getShapePageTransform(t)),o??(o=i.applyToPoints(r.vertices));const d=n.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:h,isClosed:p}=n.getShapeGeometry(c);if(!h.some(f=>On(f,d))){if(p){if(iP(d,h))continue}else if(f5(d,h))continue;a.push(c)}}return a}function vu(n,t,e=!1){n.select(t),n.setEditingShape(t),n.setCurrentTool("select.editing_shape",{target:"shape",shape:t}),e&&n.emit("select-all-text",{shapeId:t.id}),RP(n)}const uH=16;function RP(n){const t=n.getSelectionPageBounds(),e=n.getViewportPageBounds();if(t&&!e.contains(t)){const s=t.clone().expandBy(uH/n.getZoomLevel()).expand(e),r=e.clone().translate({x:(s.center.x-e.center.x)*2,y:(s.center.y-e.center.y)*2});n.zoomToBounds(r,{animation:{duration:n.options.animationMediumMs},inset:0})}}const Si=20,hH=0,$e=200,ch=new S($e/2,$e/2),LP=10,pH=[[["a1"],new S($e*.5,$e*-.5-Si)],[["a2"],new S($e*1.5+Si,$e*.5)],[["a3"],new S($e*.5,$e*1.5+Si)],[["a4"],new S($e*-.5-Si,$e*.5)]];function fH(n){if(n===1)return pH;const t=$e*n,e=Si*n;return[[["a1"],new S(t*.5,t*-.5-e)],[["a2"],new S(t*1.5+e,t*.5)],[["a3"],new S(t*.5,t*1.5+e)],[["a4"],new S(t*-.5-e,t*.5)]]}function $P(n,t,e,s,r){return Object.fromEntries(fH(r).map(([i,o],a)=>{const c=o.clone();return a===0&&s?c.y-=s:a===2&&e&&(c.y+=e),[i,c.rot(t).add(n)]}))}function FP(n,t,e,s){const r=new Set(n.getSelectedShapeIds()),i=($e+Si+s)**2,o=new Map,a=[];for(const d of n.getCurrentPageShapes()){if(!n.isShapeOfType(d,"note")||e!==d.props.scale||r.has(d.id))continue;const h=n.getShapePageTransform(d.id);t===h.rotation()&&(o.set(d,n.getShapePageBounds(d).center),a.push(...Object.values($P(h.point(),t,d.props.growY,s,e))))}const c=a.length;let l;for(const[d,h]of o)for(let p=0;p<c;p++)l=a[p],l&&(S.Dist2(h,l)>i||n.isPointInShape(d,l)&&(a[p]=void 0));return ge(a)}function NP(n,t,e,s,r=!1){let i;const o=n.getCurrentPageShapesSorted(),a=($e+Si**2)**t.props.scale;for(let c=o.length-1;c>=0;c--){const l=o[c];if(l.type==="note"&&l.id!==t.id){const d=n.getShapePageBounds(l);if(d&&S.Dist2(d.center,e)<a&&n.isPointInShape(l,e)){i=l;break}}}if(n.complete(),!i||r){n.mark("creating note shape");const c=Oe();n.createShape({id:c,type:"note",x:e.x,y:e.y,rotation:s,opacity:t.opacity,props:{...t.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const l=n.getShape(c);if(!l)return;const d=n.getPointInParentSpace(l,S.Sub(e,S.Rot(ch.clone().mul(l.props.scale),s)));n.updateShape({id:c,type:"note",x:d.x,y:d.y}),i=n.getShape(c)}return RP(n),i}var Tf;let gH=(Tf=class extends ee{constructor(){super(...arguments);g(this,"dragged",!1);g(this,"info",{});g(this,"wasFocusedOnEnter",!1);g(this,"markId","");g(this,"shape",{});g(this,"onEnter",()=>{const{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){const s=Oe();this.markId=`creating:${s}`,e.mark(this.markId);const r=this.editor.inputs.originPagePoint.clone(),i=bb(this.editor,r,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&r.sub(i),this.shape=vb(this.editor,s,r)}});g(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const s=Oe(),r=this.editor.inputs.originPagePoint.clone(),i=bb(this.editor,r,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&r.sub(i),this.shape=vb(this.editor,s,r)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}});g(this,"onPointerUp",()=>{this.complete()});g(this,"onInterrupt",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},g(Tf,"id","pointing"),Tf);function bb(n,t,e){let s=LP/n.getZoomLevel(),r;for(const i of FP(n,0,e,0)){const o=S.Sub(t,i),a=o.len();a<s&&(s=a,r=o)}return r}function vb(n,t,e){n.createShape({id:t,type:"note",x:e.x,y:e.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(t);const s=n.getShape(t),r=n.getShapeGeometry(s).bounds;return n.updateShapes([{id:t,type:"note",x:s.x-r.width/2,y:s.y-r.height/2}]),n.getShape(t)}class Sd extends ee{constructor(){super(...arguments);g(this,"shapeType","note")}}g(Sd,"id","note"),g(Sd,"initial","idle"),g(Sd,"children",()=>[dH,gH]);function mH(n){const t=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!t)return n.setHoveredShape(null);let e;const s=n.getOutermostSelectableShape(t);return s===t||s.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(s.id)?e=t:e=s,n.setHoveredShape(e.id)}const er=J0(mH,32);var kf;let yH=(kf=class extends ee{constructor(){super(...arguments);g(this,"onPointerMove",e=>{switch(e.target){case"shape":case"canvas":er(this.editor)}});g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});g(this,"onExit",()=>{er.cancel()});g(this,"onKeyDown",e=>{var s;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...e,target:"shape",shape:r}))}});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(kf,"id","idle"),kf);var Mf;let SH=(Mf=class extends ee{constructor(){super(...arguments);g(this,"shape");g(this,"markId","");g(this,"onExit",()=>{this.editor.setHintingShapes([])});g(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:s}}=this.editor,r=Oe();this.markId=`creating:${r}`,this.editor.mark(this.markId);const i=this.createTextShape(r,s,!1);if(!i){this.cancel();return}this.shape=this.editor.getShape(i),this.editor.select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.cancel()});g(this,"onCancel",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const e=Oe(),{currentPagePoint:s}=this.editor.inputs;this.createTextShape(e,s,!0)&&(this.editor.select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,s,r){this.editor.createShape({id:e,type:"text",x:s.x,y:s.y,props:{text:"",autoSize:r,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(e);if(!i){this.cancel();return}const o=this.editor.getShapePageBounds(i),a=new S;if(r)switch(i.props.textAlign){case"start":{a.x=0;break}case"middle":{a.x=-o.width/2;break}case"end":{a.x=-o.width;break}}else a.x=0;if(a.y=-o.height/2,pn(i.parentId)){const c=this.editor.getShapeParentTransform(i);a.rot(-c.rotation())}return this.editor.updateShape({...i,x:i.x+a.x,y:i.y+a.y}),i}},g(Mf,"id","pointing"),Mf);class wd extends ee{constructor(){super(...arguments);g(this,"shapeType","text")}}g(wd,"id","text"),g(wd,"initial","idle"),g(wd,"children",()=>[yH,SH]);const wH=[wd,fd,gd,Sd,yd,Sg,pd,md];function es(){return fr({isDarkMode:Bc()})}function Uo(n){return{key:`${As.id}:${n}`,getElement:async()=>{const t=xH(n);if(!t)return null;const e=t.$$_url,s=t.$$_fontface;if(!e||!s)return null;const r=await(await Ms(e)).blob(),i=await vi.blobToDataUrl(r),o=s.replace(e,i);return u.jsx("style",{children:o})}}}function xH(n){const t=NC[n];for(const e of document.fonts)if(t.includes(e.family))return e;return null}function yy(n){return{key:`${As.id}:${n}`,getElement:async()=>n!=="pattern"?null:u.jsx(bH,{})}}function bH(){const n=es(),t=8/12;return u.jsxs(u.Fragment,{children:[u.jsxs("mask",{id:"hash_pattern_mask",children:[u.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),u.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[u.jsx("line",{x1:t*1,y1:t*3,x2:t*3,y2:t*1}),u.jsx("line",{x1:t*5,y1:t*7,x2:t*7,y2:t*5}),u.jsx("line",{x1:t*9,y1:t*11,x2:t*11,y2:t*9})]})]}),u.jsx("pattern",{id:Cu(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:u.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:"url(#hash_pattern_mask)"})})]})}function Sy(){return{key:`${As.id}:pattern`,component:PH}}const Na=8,Cb=(n,t,e)=>new Promise((s,r)=>{const i=Na*t*n,o=document.createElement("canvas");o.width=i,o.height=i;const a=o.getContext("2d");if(!a)return;a.fillStyle=e?lu.darkMode.solid:lu.lightMode.solid,a.fillRect(0,0,i,i),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*n;const c=8/12,l=d=>d*t*n;a.beginPath(),a.moveTo(l(c*1),l(c*3)),a.lineTo(l(c*3),l(c*1)),a.moveTo(l(c*5),l(c*7)),a.lineTo(l(c*7),l(c*5)),a.moveTo(l(c*9),l(c*11)),a.lineTo(l(c*11),l(c*9)),a.stroke(),o.toBlob(d=>{!d||ft.throwToBlob.get()?r():s(d)})}),Ib=(n,t)=>{const e=document.createElement("canvas");e.width=n[0],e.height=n[1];const s=e.getContext("2d");return s?(t(s),e.toDataURL()):""};let Fp=null;function vH(){return Fp||(Fp={white:Ib([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:Ib([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),Fp}function BP(n){return Math.ceil(Math.log2(Math.max(1,n)))}function Cu(n,t){const e=BP(n);return`tldraw_hash_pattern_${t}_${e}`}function zP(n){const t=[],s=BP(n);for(let r=0;r<=s;r++)t.push(Math.pow(2,r));return t}function CH(n){const t=vH();return zP(n).flatMap(e=>[{zoom:e,url:t.white,theme:"light"},{zoom:e,url:t.black,theme:"dark"}])}function IH(){const n=N(),t=z("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),e=z("maxZoom",()=>Math.ceil(At(n.getCameraOptions().zoomSteps)),[n]),[s,r]=v.useState(!1),[i,o]=v.useState(()=>CH(e));return v.useEffect(()=>{const c=Promise.all(zP(e).flatMap(d=>[Cb(t,d,!1).then(h=>({zoom:d,theme:"light",url:URL.createObjectURL(h)})),Cb(t,d,!0).then(h=>({zoom:d,theme:"dark",url:URL.createObjectURL(h)}))]));let l=!1;return c.then(d=>{l||(o(d),r(!0))}),()=>{l=!0,r(!1),c.then(d=>{for(const{url:h}of d)URL.revokeObjectURL(h)})}},[t,e]),{defs:u.jsx(u.Fragment,{children:i.map(c=>{const l=Cu(c.zoom,c.theme);return u.jsx("pattern",{id:l,width:Na,height:Na,patternUnits:"userSpaceOnUse",children:u.jsx("image",{href:c.url,width:Na,height:Na})},l)})}),isReady:s}}function PH(){const n=N(),t=v.useRef(null),{defs:e,isReady:s}=IH();return v.useEffect(()=>{if(s&&n.environment.isSafari){const r=UP(t.current);r&&n.timers.requestAnimationFrame(()=>{r.style.display="none",n.timers.requestAnimationFrame(()=>{r.style.display=""})})}},[n,s]),u.jsx("g",{ref:t,"data-testid":s?"ready-pattern-fill-defs":void 0,children:e})}function UP(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?UP(n.parentElement):null}const Ht=me.memo(function({theme:t,d:e,color:s,fill:r,scale:i}){switch(r){case"none":return null;case"solid":return u.jsx("path",{fill:t[s].semi,d:e});case"semi":return u.jsx("path",{fill:t.solid,d:e});case"fill":return u.jsx("path",{fill:t[s].fill,d:e});case"pattern":return u.jsx(EH,{theme:t,color:s,fill:r,d:e,scale:i})}});function EH({d:n,color:t,theme:e}){const s=N(),r=dP(),i=z("zoomLevel",()=>s.getZoomLevel(),[s]),o=s.getZoomLevel()<=.18;return u.jsxs(u.Fragment,{children:[u.jsx("path",{fill:e[t].pattern,d:n}),u.jsx("path",{fill:r?`url(#${Cu(1,e.id)})`:o?e[t].semi:`url(#${Cu(i,e.id)})`,d:n})]})}function _H(n){return n.replace(/\s/g,"Â ")}function wg(n,t,e){const{padding:s=0}=e;if(t.length===0)return null;const r=Y.From(t[0].box);for(const{box:l}of t)r.union(l);const i=s+(e.offsetX??0),o=(e.offsetY??0)+e.fontSize/2+(e.verticalTextAlign==="start"?s:e.verticalTextAlign==="end"?e.height-s-r.height:(Math.ceil(e.height)-r.height)/2);let a=null;const c=[];for(const{text:l,box:d}of t)a!==null&&d.y>a&&c.push(u.jsx("tspan",{alignmentBaseline:"mathematical",x:i,y:d.y+o,children:`
`},c.length)),c.push(u.jsx("tspan",{alignmentBaseline:"mathematical",x:d.x+i,y:d.y+o,unicodeBidi:"plaintext",children:_H(l)},c.length)),a=d.y;return u.jsx("text",{fontSize:e.fontSize,fontFamily:e.fontFamily,fontStyle:e.fontFamily,fontWeight:e.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,children:c})}function TH(n,t,e,s){if((n==="start-legacy"||n==="end-legacy")&&e.length!==0){const r=Y.From(e[0].box);for(const{box:i}of e)r.union(i);if(n==="start-legacy")return(s-2*t-r.width)/2;if(n==="end-legacy")return-(s-2*t-r.width)/2}}function kH(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function lh({fontSize:n,font:t,align:e,verticalAlign:s,text:r,labelColor:i,bounds:o,padding:a=16,stroke:c=!0}){const l=N(),d=es(),h={fontSize:n,fontFamily:NC[t],textAlign:e,verticalTextAlign:s,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:Lt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:i,stroke:void 0,strokeWidth:void 0},p=l.textMeasure.measureTextSpans(r,h),f=TH(e,a,p,o.width);f&&(h.offsetX=f),h.offsetX+=o.x,h.offsetY+=o.y;const y=wg(l,p,h);let m=null;return c&&(h.fill=d.background,h.stroke=d.background,h.strokeWidth=2,m=wg(l,p,h)),u.jsxs(u.Fragment,{children:[m,y]})}const MH=v.forwardRef(function({isEditing:t,text:e,handleFocus:s,handleChange:r,handleKeyDown:i,handleBlur:o,handleInputPointerDown:a,handleDoubleClick:c},l){return u.jsx("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!t,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:e,onFocus:s,onChange:r,onKeyDown:i,onBlur:o,onTouchEnd:Rt,onContextMenu:t?Rt:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:Ee})});function AH(n,t,e){const s=N(),r=v.useRef(null),i=z("isEditing",()=>s.getEditingShapeId()===n,[s]),o=z("isEditingAnything",()=>!!s.getEditingShapeId(),[s]);v.useEffect(()=>{function d({shapeId:h}){var p;h===n&&((p=r.current)==null||p.select())}return s.on("select-all-text",d),()=>{s.off("select-all-text",d)}},[s,n,i]),v.useEffect(()=>{var d,h,p,f;i&&(document.activeElement!==r.current&&((d=r.current)==null||d.focus()),s.getInstanceState().isCoarsePointer&&((h=r.current)==null||h.select()),s.environment.isSafari&&((p=r.current)==null||p.blur(),(f=r.current)==null||f.focus()))},[s,i]);const a=v.useCallback(d=>{if(s.getEditingShapeId()===n)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&s.complete();break}}},[s,n]),c=v.useCallback(d=>{if(s.getEditingShapeId()!==n)return;let h=zo.normalizeText(d.currentTarget.value);const p=h.replace(/\t/g,Eo);if(p!==h){const f=d.currentTarget.selectionStart;d.currentTarget.value=p,d.currentTarget.selectionStart=f+(p.length-h.length),d.currentTarget.selectionEnd=f+(p.length-h.length),h=p}s.updateShape({id:n,type:t,props:{text:h}})},[s,n,t]),l=v.useCallback(d=>{s.dispatch({...yn(d),type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(n)}),Rt(d)},[s,n]);return{rInput:r,handleFocus:Qd,handleBlur:Qd,handleKeyDown:a,handleChange:c,handleInputPointerDown:l,handleDoubleClick:Rt,isEmpty:e.trim().length===0,isEditing:i,isEditingAnything:o}}const dh=me.memo(function({id:t,type:e,text:s,labelColor:r,font:i,fontSize:o,lineHeight:a,align:c,verticalAlign:l,wrap:d,isSelected:h,padding:p=0,onKeyDown:f,classNamePrefix:y,style:m,textWidth:x,textHeight:w}){const{rInput:b,isEmpty:I,isEditing:E,isEditingAnything:P,...C}=AH(t,e,s),[_,k]=v.useState(s);v.useEffect(()=>{E||k(s)},[E,s]);const D=zo.normalizeTextForDom(s),T=D.length>0,A=kH(c);if(!E&&!T)return null;const L=y||"tl-text";return u.jsx("div",{className:`${L}-label tl-text-wrapper`,"data-font":i,"data-align":c,"data-hastext":!I,"data-isediting":E,"data-iseditinganything":P,"data-textwrap":!!d,"data-isselected":h,style:{justifyContent:c==="middle"||A?"center":c,alignItems:l==="middle"?"center":l,padding:p,...m},children:u.jsxs("div",{className:`${L}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*a)+"px",minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(x||0),color:r,width:x?Math.ceil(x):void 0,height:w?Math.ceil(w):void 0},children:[u.jsx("div",{className:`${L} tl-text tl-text-content`,dir:"auto",children:D.split(`
`).map((j,R)=>u.jsx("div",{dir:"auto",children:j},R))}),(P||h)&&u.jsx(MH,{ref:b,text:s,isEditing:E,...C,handleKeyDown:f??C.handleKeyDown},_)]})})});function vs(n,t,e={}){const{closed:s=!1,snap:r=1,start:i="outset",end:o="outset",lengthRatio:a=2,style:c="dashed"}=e;let l=0,d=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,l=Math.min(t*a,n/4);break}case"dotted":{h=100,l=t/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(i==="outset"?(n+=l/2,f+=l/2):i==="skip"&&(n-=l,f-=l),o==="outset"?n+=l/2:o==="skip"&&(n-=l)),d=Math.floor(n/l/(2*h)),d-=d%r,d<3&&c==="dashed"?n/t<4?(l=n,d=1,p=0):(l=n*(1/3),p=n*(1/3)):(l=n/d/(2*h),s?(f=l/2,p=(n-d*l)/d):p=(n-d*l)/Math.max(1,d-1)),{strokeDasharray:[l,p].join(" "),strokeDashoffset:f.toString()}}const Pb=new WeakMap;function wy(n,t){const e=Pb.get(t);if(e)return e;const s=Ps(n,t);let r=0,i=0;const o=s.isStraight?new Qs({start:S.From(s.start.point),end:S.From(s.end.point)}):new vo({center:S.Cast(s.handleArc.center),start:S.Cast(s.start.point),end:S.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});if(t.props.text.trim()){const c=o.bounds,l=xg(t),{w:d,h}=n.textMeasure.measureText(t.props.text,{...Lt,fontFamily:Ts[t.props.font],fontSize:l,maxWidth:null});if(r=d,i=h,c.width>c.height){r=Math.max(Math.min(d,64),Math.min(c.width-64,d));const{w:p,h:f}=n.textMeasure.measureText(t.props.text,{...Lt,fontFamily:Ts[t.props.font],fontSize:l,maxWidth:r});r=p,i=f}if(r>16*l){r=16*l;const{w:p,h:f}=n.textMeasure.measureText(t.props.text,{...Lt,fontFamily:Ts[t.props.font],fontSize:l,maxWidth:r});r=p,i=f}}const a=new S(r,i).addScalar(P8*2*t.props.scale);return Pb.set(t,a),a}function HP(n){const t=Pt[n.props.size];return(I8+(t-Pt.s)*2+(t===Pt.xl?20:0))*n.props.scale}function jH(n,t,e){const s=wy(n,t),r=HP(t),i=S.Nudge(e.start.point,e.end.point,r),o=S.Nudge(e.end.point,e.start.point,r),a=ry(i,o,Y.FromCenter(e.middle,s).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,l]=a;S.Dist2(c,i)>S.Dist2(l,i)&&([l,c]=a);const d=i.add(S.Sub(e.middle,c)),h=o.add(S.Sub(e.middle,l)),p=S.Dist(e.start.point,d)/e.length,f=S.Dist(e.start.point,h)/e.length;return{start:p,end:f}}function DH(n,t,e){const s=wy(n,t),r=HP(t),i=Math.sign(t.props.bend),o=r/e.handleArc.radius*i,a=S.Angle(e.bodyArc.center,e.start.point)-o,c=S.Angle(e.bodyArc.center,e.end.point)+o,l=Di(e.bodyArc.center,e.bodyArc.radius,a),d=Di(e.bodyArc.center,e.bodyArc.radius,c),h=[],p=Eb(e.bodyArc.center,e.bodyArc.radius,a,c,i,Y.FromCenter(l,s).corners);h.push(new ht({points:Y.FromCenter(l,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=Eb(e.bodyArc.center,e.bodyArc.radius,a,c,i,Y.FromCenter(d,s).corners);h.push(new ht({points:Y.FromCenter(d,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const _ of[...p??[],...f??[],l,d])h.push(new py({x:_.x-3,y:_.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const y=(p&&_b(e.start.point,p))??e.middle,m=(f&&_b(e.end.point,f))??e.middle,x=S.Angle(e.bodyArc.center,e.start.point),w=S.Angle(e.bodyArc.center,e.end.point),b=S.Angle(e.bodyArc.center,y),I=S.Angle(e.bodyArc.center,m);if(Mr(x,b,i)>Mr(x,I,i))return{start:.5,end:.5,dbg:h};const E=Mr(x,w,i),P=Mr(x,b,i)/E,C=Mr(x,I,i)/E;return{start:P,end:C,dbg:h}}function xd(n,t){let e;const s=[],r=Ps(n,t),i=!!r.bindings.start,o=!!r.bindings.end,a=r.start.arrowhead!=="none",c=r.end.arrowhead!=="none";if(r.isStraight){const d=jH(n,t,r);let h=bt(t.props.labelPosition,a||i?d.start:0,c||o?d.end:1);h=h>=.48&&h<=.52?.5:h,e=S.Lrp(r.start.point,r.end.point,h)}else{const d=DH(n,t,r);d.dbg&&s.push(...d.dbg);let h=bt(t.props.labelPosition,a||i?d.start:0,c||o?d.end:1);h=h>=.48&&h<=.52?.5:h;const p=OH(S.Angle(r.bodyArc.center,r.start.point),S.Angle(r.bodyArc.center,r.end.point),Math.sign(t.props.bend),h);e=Di(r.bodyArc.center,r.bodyArc.radius,p)}const l=wy(n,t);return{box:Y.FromCenter(e,l),debugGeom:s}}function Eb(n,t,e,s,r,i){const o=hg(n,t,i),a=Mr(e,s,r);return o==null?void 0:o.filter(c=>{const l=Mr(e,S.Angle(n,c),r);return l>=0&&l<=a})}function _b(n,t){let e=null,s=-1/0;for(const r of t){const i=S.Dist2(n,r);i>s&&(e=r,s=i)}return e}function OH(n,t,e,s){const r=Mr(n,t,e);return n+r*s*e*-1}function xg(n){return C8[n.props.size]*n.props.scale}function RH(n,t,e){const s=t==="end"?n.end.point:n.start.point,r=t==="end"?n.start.point:n.end.point,i=n.isStraight?S.Dist(r,s):Math.abs(n.bodyArc.length),o=Math.max(Math.min(i/5,e*3),e);let a;if(n.isStraight)a=S.Nudge(s,r,o);else{const c=h5(s,o,n.handleArc.center,n.handleArc.radius);a=t==="end"?n.handleArc.sweepFlag?c[0]:c[1]:n.handleArc.sweepFlag?c[1]:c[0]}return S.IsNaN(a)&&(a=n.start.point),{point:s,int:a}}function LH({point:n,int:t}){const e=S.RotWith(t,n,_e/6),s=S.RotWith(t,n,-_e/6);return`M ${e.x} ${e.y} L ${n.x} ${n.y} L ${s.x} ${s.y}`}function $H({point:n,int:t}){const e=S.RotWith(t,n,_e/6),s=S.RotWith(t,n,-_e/6);return`M ${e.x} ${e.y} L ${n.x} ${n.y} L ${s.x} ${s.y} Z`}function FH({point:n,int:t}){const e=S.Sub(t,n).div(2),s=S.Add(n,S.Rot(e,Ue)),r=S.Sub(n,S.Rot(e,Ue));return`M ${s.x} ${s.y} L ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function NH({point:n,int:t}){const e=S.Lrp(n,t,.45),s=S.Dist(e,n);return`M ${e.x-s},${e.y}
  a ${s},${s} 0 1,0 ${s*2},0
  a ${s},${s} 0 1,0 -${s*2},0 `}function BH({point:n,int:t}){const e=S.Lrp(n,t,.75),s=S.RotWith(e,n,_e/4),r=S.RotWith(e,n,-_e/4),i=S.Lrp(s,r,.5);return i.add(S.Sub(i,n)),`M ${i.x} ${i.y} L ${s.x} ${s.y} ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function zH({int:n,point:t}){const e=S.Lrp(t,n,.85),s=S.Sub(e,t).div(2),r=S.Add(t,S.Rot(s,Ue)),i=S.Sub(t,S.Rot(s,Ue)),o=S.Add(e,S.Rot(s,Ue)),a=S.Sub(e,S.Rot(s,Ue));return`M ${r.x} ${r.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${i.x} ${i.y} Z`}function UH({int:n,point:t}){const e=S.Sub(n,t).div(2),s=S.Add(t,S.Rot(e,Ue)),r=S.Sub(t,S.Rot(e,Ue));return`M ${s.x} ${s.y} L ${r.x} ${r.y}`}function Iu(n,t,e){const s=t==="end"?n.end.arrowhead:n.start.arrowhead;if(s==="none")return;const r=RH(n,t,e);if(r){switch(s){case"bar":return UH(r);case"square":return zH(r);case"diamond":return BH(r);case"dot":return NH(r);case"inverted":return FH(r);case"arrow":return LH(r);case"triangle":return $H(r)}return""}}function HH(n){const{start:t,end:e,handleArc:{radius:s,largeArcFlag:r,sweepFlag:i}}=n;return`M${t.handle.x},${t.handle.y} A${s} ${s} 0 ${r} ${i} ${e.handle.x},${e.handle.y}`}function KP(n){const{start:t,end:e,bodyArc:{radius:s,largeArcFlag:r,sweepFlag:i}}=n;return`M${t.point.x},${t.point.y} A${s} ${s} 0 ${r} ${i} ${e.point.x},${e.point.y}`}function GP(n,t){return`M${n.x},${n.y}L${t.x},${t.y}`}function KH(n){return GP(n.start.handle,n.end.handle)}function WP(n){return GP(n.start.point,n.end.point)}let GH=0;class bd extends cs{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"canSnap",()=>!1);g(this,"hideResizeHandles",()=>!0);g(this,"hideRotateHandle",()=>!0);g(this,"hideSelectionBoundsBg",()=>!0);g(this,"hideSelectionBoundsFg",()=>!0);g(this,"canBeLaidOut",e=>{const s=gn(this.editor,e);return!s.start&&!s.end});g(this,"onHandleDrag",(e,{handle:s,isPrecise:r})=>{const i=s.id,o=gn(this.editor,e);if(i==="middle"){const{start:C,end:_}=Co(this.editor,e,o),k=S.Sub(_,C),D=S.Per(k),T=S.Med(_,C),A=S.Sub(T,D),L=S.Add(T,D),j=S.NearestPointOnLineSegment(A,L,s,!1);let R=S.Dist(j,T);return S.Clockwise(j,_,T)&&(R*=-1),{id:e.id,type:e.type,props:{bend:R}}}const a={id:e.id,type:"arrow",props:{}},c=o[i],d=o[i==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return ud(this.editor,e,i),a.props[i]={x:s.x,y:s.y},a;const h=this.editor.getShapePageTransform(e.id).applyToPoint(s),p=this.editor.getShapeAtPoint(h,{hitInside:!0,hitFrameInside:!0,margin:0,filter:C=>!C.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:C,binding:"arrow"})});if(!p)return ud(this.editor,e,i),a.props[i]={x:s.x,y:s.y},a;const f=this.editor.getShapeGeometry(p),y=Y.ZeroFix(f.bounds),x=this.editor.getShapePageTransform(a.id).applyToPoint(s),w=this.editor.getPointInShapeSpace(p,x);let b=r;b||(!c||c&&p.id!==c.toId)&&(b=this.editor.inputs.pointerVelocity.len()<.5),r||(f.isClosed||(b=!0),d&&p.id===d.toId&&d.props.isPrecise&&(b=!0));const I={x:(w.x-y.minX)/y.width,y:(w.y-y.minY)/y.height};b&&S.Dist(w,y.center)<Math.max(4,Math.min(Math.min(y.width,y.height)*.15,16))/this.editor.getZoomLevel()&&(I.x=.5,I.y=.5);const E={terminal:i,normalizedAnchor:I,isPrecise:b,isExact:this.editor.inputs.altKey};Ea(this.editor,e,p.id,E),this.editor.setHintingShapes([p.id]);const P=gn(this.editor,e);return P.start&&P.end&&P.start.toId===P.end.toId&&S.Equals(P.start.props.normalizedAnchor,P.end.props.normalizedAnchor)&&Ea(this.editor,e,P.end.toId,{...P.end.props,normalizedAnchor:{x:P.end.props.normalizedAnchor.x+.05,y:P.end.props.normalizedAnchor.y}}),a});g(this,"onTranslateStart",e=>{const s=gn(this.editor,e),r=Co(this.editor,e,s),i=this.editor.getShapePageTransform(e.id),o=this.editor.getSelectedShapeIds();if(!(s.start&&(o.includes(s.start.toId)||this.editor.isAncestorSelected(s.start.toId))||s.end&&(o.includes(s.end.toId)||this.editor.isAncestorSelected(s.end.toId)))){kb.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:Mc(r,(a,c)=>{const l=s[a];return l?{binding:l,shapePosition:c,pagePosition:i.applyToPoint(c)}:null})}),s.start&&(bu({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),s.end&&bu({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=s[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}});g(this,"onTranslate",(e,s)=>{const r=kb.get(e);if(!r)return;const i=this.editor.getShapePageTransform(s.id),o=S.Sub(i.applyToPoint(s),r.pagePosition);for(const a of Object.values(r.terminalBindings)){if(!a)continue;const c=S.Add(a.pagePosition,S.Mul(o,.5)),l=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:d=>!d.isLocked&&this.editor.canBindShapes({fromShape:s,toShape:d,binding:"arrow"})});if((l==null?void 0:l.id)===a.binding.toId){const d=Y.ZeroFix(this.editor.getShapeGeometry(l).bounds),h=this.editor.getPointInShapeSpace(l,c),p={x:(h.x-d.minX)/d.width,y:(h.y-d.minY)/d.height};Ea(this.editor,s,l.id,{...a.binding.props,normalizedAnchor:p,isPrecise:!0})}else ud(this.editor,s,a.binding.props.terminal)}});g(this,"_resizeInitialBindings",new or);g(this,"onResize",(e,s)=>{const{scaleX:r,scaleY:i}=s,o=this._resizeInitialBindings.get(e,()=>gn(this.editor,e)),a=Co(this.editor,e,o),{start:c,end:l}=Je(e.props);let{bend:d}=e.props;o.start||(c.x=a.start.x*r,c.y=a.start.y*i),o.end||(l.x=a.end.x*r,l.y=a.end.y*i);const h=Math.abs(r),p=Math.abs(i),f=o!=null&&o.start?S.From(o.start.props.normalizedAnchor):null,y=o!=null&&o.end?S.From(o.end.props.normalizedAnchor):null;return r<0&&i>=0?(d!==0&&(d*=-1,d*=Math.max(h,p)),f&&(f.x=1-f.x),y&&(y.x=1-y.x)):r>=0&&i<0?(d!==0&&(d*=-1,d*=Math.max(h,p)),f&&(f.y=1-f.y),y&&(y.y=1-y.y)):r>=0&&i>=0?d!==0&&(d*=Math.max(h,p)):r<0&&i<0&&(d!==0&&(d*=Math.max(h,p)),f&&(f.x=1-f.x,f.y=1-f.y),y&&(y.x=1-y.x,y.y=1-y.y)),o.start&&f&&Ea(this.editor,e,o.start.toId,{...o.start.props,normalizedAnchor:f.toJson()}),o.end&&y&&Ea(this.editor,e,o.end.toId,{...o.end.props,normalizedAnchor:y.toJson()}),{props:{start:c,end:l,bend:d}}});g(this,"onDoubleClickHandle",(e,s)=>{switch(s.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}});g(this,"onEditEnd",e=>{const{id:s,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:s,type:r,props:{text:i.trimEnd()}}])})}canBind({toShapeType:e}){return e!=="arrow"}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const s=Ps(this.editor,e),r=[],i=s.isStraight?new Qs({start:S.From(s.start.point),end:S.From(s.end.point)}):new vo({center:S.Cast(s.handleArc.center),start:S.Cast(s.start.point),end:S.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});let o;if(e.props.text.trim()){const a=xd(this.editor,e);r.push(...a.debugGeom),o=new cr({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new ls({children:[...o?[i,o]:[i],...r]})}getHandles(e){const s=Ps(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:s.start.handle.x,y:s.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:s.middle.x,y:s.middle.y},{id:"end",type:"vertex",index:"a3",x:s.end.handle.x,y:s.end.handle.y}].filter(Boolean)}component(e){const s=es(),r=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,o=Ps(this.editor,e);if(!(o!=null&&o.isValid))return null;const a=xd(this.editor,e),c=e.id===this.editor.getOnlySelectedShapeId(),d=this.editor.getEditingShapeId()===e.id||e.props.text;return u.jsxs(u.Fragment,{children:[u.jsx(Kr,{id:e.id,style:{minWidth:50,minHeight:50},children:u.jsx(Tb,{shape:e,shouldDisplayHandles:i&&(r==null?void 0:r.id)===e.id})}),d&&u.jsx(dh,{id:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:xg(e),lineHeight:Lt.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:s[e.props.labelColor].solid,textWidth:a.box.w,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(e){const s=oh(e.id),r=Ps(this.editor,e);if(!r)return null;const{start:i,end:o}=Co(this.editor,e,r==null?void 0:r.bindings),a=this.editor.getShapeGeometry(e),c=a.bounds,l=e.props.text.trim()?a.children[1]:null;if(S.Equals(i,o))return null;const d=Pt[e.props.size]*e.props.scale,h=r.start.arrowhead&&Iu(r,"start",d),p=r.end.arrowhead&&Iu(r,"end",d),f=r.isStraight?WP(r):KP(r),y=h&&r.start.arrowhead!=="arrow"||p&&r.end.arrowhead!=="arrow"||!!l,m=(e.id+"_clip").replace(":","_");return s&&l?u.jsx("rect",{x:$(l.x),y:$(l.y),width:l.w,height:l.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale}):u.jsxs("g",{children:[y&&u.jsx("defs",{children:u.jsxs("mask",{id:m,children:[u.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.w+200,height:c.h+200,fill:"white"}),l&&u.jsx("rect",{x:$(l.x),y:$(l.y),width:l.w,height:l.h,fill:"black",rx:3.5*e.props.scale,ry:3.5*e.props.scale}),h&&u.jsx("path",{d:h,fill:r.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),p&&u.jsx("path",{d:p,fill:r.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),u.jsxs("g",{...y?{mask:`url(#${m})`}:void 0,children:[y&&u.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),u.jsx("path",{d:f})]}),h&&u.jsx("path",{d:h}),p&&u.jsx("path",{d:p}),l&&u.jsx("rect",{x:$(l.x),y:$(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}toSvg(e,s){s.addExportDef(yy(e.props.fill)),e.props.text&&s.addExportDef(Uo(e.props.font));const r=fr(s),i=1/e.props.scale;return u.jsxs("g",{transform:`scale(${i})`,children:[u.jsx(Tb,{shape:e,shouldDisplayHandles:!1}),u.jsx(lh,{fontSize:xg(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:r[e.props.labelColor].solid,bounds:xd(this.editor,e).box,padding:4*e.props.scale})]})}getCanvasSvgDefs(){return[Sy(),{key:"arrow:dot",component:VH},{key:"arrow:cross",component:YH}]}}g(bd,"type","arrow"),g(bd,"props",zC),g(bd,"migrations",UC);function WH(n,t){const e=Ps(n,t);return e.isStraight?S.Dist(e.start.handle,e.end.handle):Math.abs(e.handleArc.length)}const Tb=Cn(function({shape:t,shouldDisplayHandles:e}){const s=N(),r=es(),i=Ps(s,t),o=Y.ZeroFix(s.getShapeGeometry(t).bounds),a=gn(s,t),c=me.useMemo(()=>s.environment.isSafari?GH+=1:0,[t]);if(!(i!=null&&i.isValid))return null;const l=Pt[t.props.size]*t.props.scale,d=i.start.arrowhead&&Iu(i,"start",l),h=i.end.arrowhead&&Iu(i,"end",l),p=i.isStraight?WP(i):KP(i);let f=null;if(e){const E=2/s.getZoomLevel(),{strokeDasharray:P,strokeDashoffset:C}=vs(WH(s,t),E,{end:"skip",start:"skip",lengthRatio:2.5});f=a.start||a.end?u.jsx("path",{className:"tl-arrow-hint",d:i.isStraight?KH(i):HH(i),strokeDasharray:P,strokeDashoffset:C,strokeWidth:E,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:y,strokeDashoffset:m}=vs(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:t.props.dash}),x=xd(s,t),w=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),b=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow"),I=(t.id+"_clip_"+c).replace(":","_");return u.jsxs(u.Fragment,{children:[u.jsx("defs",{children:u.jsxs("mask",{id:I,children:[u.jsx("rect",{x:$(-100+o.minX),y:$(-100+o.minY),width:$(o.width+200),height:$(o.height+200),fill:"white"}),t.props.text.trim()&&u.jsx("rect",{x:x.box.x,y:x.box.y,width:x.box.w,height:x.box.h,fill:"black",rx:4,ry:4}),d&&w&&u.jsx("path",{d,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&b&&u.jsx("path",{d:h,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),u.jsxs("g",{fill:"none",stroke:r[t.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,u.jsxs("g",{mask:`url(#${I})`,children:[u.jsx("rect",{x:$(o.minX-100),y:$(o.minY-100),width:$(o.width+200),height:$(o.height+200),opacity:0}),u.jsx("path",{d:p,strokeDasharray:y,strokeDashoffset:m})]}),d&&w&&t.props.fill!=="none"&&u.jsx(Ht,{theme:r,d,color:t.props.color,fill:t.props.fill,scale:t.props.scale}),h&&b&&t.props.fill!=="none"&&u.jsx(Ht,{theme:r,d:h,color:t.props.color,fill:t.props.fill,scale:t.props.scale}),d&&u.jsx("path",{d}),h&&u.jsx("path",{d:h})]})]})}),kb=new WeakMap;function VH(){return u.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:u.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function YH(){return u.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[u.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),u.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const Mb="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Ho({url:n,zoomLevel:t}){return u.jsx("a",{className:se("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Rt,onPointerUp:Rt,title:n,draggable:!1,children:u.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Mb}") center 100% / 100% no-repeat`,WebkitMask:`url("${Mb}") center 100% / 100% no-repeat`}})})}const Ab="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",XH=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function xy(n){return XH.map(e=>{const{offsetX:s,offsetY:r,blur:i,spread:o,color:a}=e,c=new S(s,r),{x:l,y:d}=c.rot(-n);return`${l}px ${d}px ${i}px ${o}px ${a}`}).join(", ")}const qH=300,VP=320,ZH=46,JH=101;class vd extends aa{constructor(){super(...arguments);g(this,"canResize",()=>!1);g(this,"hideSelectionBoundsFg",()=>!0);g(this,"onBeforeCreate",e=>jb(this.editor,e));g(this,"onBeforeUpdate",(e,s)=>{if(e.props.url!==s.props.url)if(Ln.isValid(s.props.url))e6(this.editor,s);else return{...s,props:{...s.props,url:e.props.url}};if(e.props.assetId!==s.props.assetId)return jb(this.editor,s)})}getDefaultProps(){return{url:"",w:qH,h:VP,assetId:null}}component(e){const s=e.props.assetId?this.editor.getAsset(e.props.assetId):null,r=this.editor.getShapePageTransform(e).rotation(),i=QH(e);return u.jsx(Oi,{children:u.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:xy(r)},children:[(!s||s.props.image)&&u.jsxs("div",{className:"tl-bookmark__image_container",children:[s?u.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:s==null?void 0:s.props.image,alt:(s==null?void 0:s.props.title)||""}):u.jsx("div",{className:"tl-bookmark__placeholder"}),(s==null?void 0:s.props.image)&&u.jsx(Ho,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),u.jsxs("div",{className:"tl-bookmark__copy_container",children:[s!=null&&s.props.title?u.jsx("h2",{className:"tl-bookmark__heading",children:s.props.title}):null,s!=null&&s.props.description&&(s!=null&&s.props.image)?u.jsx("p",{className:"tl-bookmark__description",children:s.props.description}):null,u.jsxs("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Rt,onPointerUp:Rt,onClick:Rt,children:[s!=null&&s.props.favicon?u.jsx("img",{className:"tl-bookmark__favicon",src:s==null?void 0:s.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${i}`}):u.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Ab}") center 100% / 100% no-repeat`,WebkitMask:`url("${Ab}") center 100% / 100% no-repeat`}}),u.jsx("span",{children:i})]})]})]})})}indicator(e){return u.jsx("rect",{width:$(e.props.w),height:$(e.props.h),rx:"6",ry:"6"})}}g(vd,"type","bookmark"),g(vd,"props",YC),g(vd,"migrations",XC);function jb(n,t){const e=t.props.assetId?n.getAsset(t.props.assetId):null;let s=VP;return e&&(e.props.image||(e.props.title?s=JH:s=ZH)),{...t,props:{...t.props,h:s}}}const QH=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function e6(n,t){const{url:e}=t.props,s=yi.createId(Jf(e));n.getAsset(s)?t.props.assetId!==s&&n.updateShapes([{id:t.id,type:t.type,props:{assetId:s}}]):(n.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),t6(n,t))}const t6=iC(async(n,t)=>{if(n.isDisposed)return;const{url:e}=t.props,s=await n.getAssetForExternalContent({type:"url",url:e});s&&n.batch(()=>{n.createAssets([s]),n.updateShapes([{id:t.id,type:t.type,props:{assetId:s.id}}])})},500);function Ri(n,t=!1){const e=n.length;if(e<2)return"";let s=n[0].point,r=n[1].point;if(e===2)return`M${Pe(s)}L${Pe(r)}`;let i="";for(let o=2,a=e-1;o<a;o++)s=n[o].point,r=n[o+1].point,i+=fn(s,r);return t?`M${fn(n[0].point,n[1].point)}Q${Pe(n[1].point)}${fn(n[1].point,n[2].point)}T${i}${fn(n[e-1].point,n[0].point)}${fn(n[0].point,n[1].point)}Z`:`M${Pe(n[0].point)}Q${Pe(n[1].point)}${fn(n[1].point,n[2].point)}${n.length>3?"T":""}${i}L${Pe(n[e-1].point)}`}function n6(n,t={}){const{start:e={},end:s={}}=t,{cap:r=!0}=e,{cap:i=!0}=s;et(!e.taper&&!s.taper,"cap taper not supported here"),et(!e.easing&&!s.easing,"cap easing not supported here"),et(r&&i,"cap must be true");const o=Ds(n,t);ah(o,t);const a=s6(o);let c="";for(const l of a)c+=i6(l,t);return c}function s6(n){if(n.length<=2)return[n];const t=[];let e=[n[0]],s=S.Sub(n[1].point,n[0].point).uni(),r,i,o,a,c;for(let l=1,d=n.length;l<d-1;l++){if(o=n[l-1],a=n[l],c=n[l+1],r=S.Sub(c.point,a.point).uni(),i=S.Dpr(s,r),s=r,i<-.8){const h={...a,point:a.input};e.push(h),t.push(Np(e)),e=[h];continue}if(e.push(a),!(i>.7)&&(S.Dist2(o.point,a.point)+S.Dist2(a.point,c.point))/((o.radius+a.radius+c.radius)/3)**2<1.5){e.push(a),t.push(Np(e)),e=[a];continue}}return e.push(n[n.length-1]),t.push(Np(e)),t}function Np(n){const t=n[0];let e;for(;n.length>2&&(e=n[1],S.Dist2(t.point,e.point)<((t.radius+e.radius)/2*.5)**2);)n.splice(1,1);const s=n[n.length-1];let r;for(;n.length>2&&(r=n[n.length-2],S.Dist2(s.point,r.point)<((s.radius+r.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:S.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:S.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function r6(n,t,e){return"M "+n+" "+t+" m -"+e+", 0 a "+e+","+e+" 0 1,1 "+e*2+",0 a "+e+","+e+" 0 1,1 -"+e*2+",0"}function i6(n,t={}){if(n.length===0)return"";if(n.length===1)return r6(n[0].point.x,n[0].point.y,n[0].radius);const{left:e,right:s}=PP(n,t);s.reverse();let r=`M${Pe(e[0])}T`;for(let i=1;i<e.length;i++)r+=fn(e[i-1],e[i]);{const i=n[n.length-1],o=i.radius,a=i.vector.clone().per().neg(),c=S.Add(i.point,S.Mul(a,o)),l=S.Add(i.point,S.Mul(a,-o));r+=`${Pe(c)}A${$(o)},${$(o)} 0 0 1 ${Pe(l)}T`}for(let i=1;i<s.length;i++)r+=fn(s[i-1],s[i]);{const i=n[0],o=i.radius,a=i.vector.clone().per(),c=S.Add(i.point,S.Mul(a,o)),l=S.Add(i.point,S.Mul(a,-o));r+=`${Pe(c)}A${$(o)},${$(o)} 0 0 1 ${Pe(l)}Z`}return r}const o6=n=>n*.65+Mz(n*_e/2)*.35,a6=n=>({size:n,thinning:.5,streamline:$o(n,[9,16],[.64,.74],!0),smoothing:.62,easing:It.easeOutSine,simulatePressure:!0}),c6=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:o6}),Db=n=>({size:n,thinning:0,streamline:$o(n,[9,16],[.68,.74],!0),smoothing:.62,simulatePressure:!1,easing:It.linear}),l6=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:It.linear});function by({strokeWidth:n,showAsComplete:t}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:It.easeOutSine,last:t}}function bg(n,t,e,s){const r=n.isComplete||e;return s?n.isPen?{...l6(t),last:r}:{...Db(t),last:r}:n.dash==="draw"?n.isPen?{...c6(t),last:r}:{...a6(t),last:r}:{...Db(t),last:r}}function Ko(n){const t=[];for(const e of n)if(e.type==="free"||e.points.length<2)t.push(...e.points.map(S.Cast));else{const s=Math.max(4,Math.floor(S.Dist(e.points[0],e.points[1])/16));t.push(...S.PointsBetween(e.points[0],e.points[1],s))}return t}function d6(n,t){return{draw:"none",solid:"none",dotted:`0.1 ${t*2}`,dashed:`${t*2} ${t*2}`}[n.props.dash]}class Cd extends cs{constructor(){super(...arguments);g(this,"hideResizeHandles",e=>Bp(e));g(this,"hideRotateHandle",e=>Bp(e));g(this,"hideSelectionBoundsFg",e=>Bp(e));g(this,"onResize",(e,s)=>{const{scaleX:r,scaleY:i}=s,o=[];for(const a of e.props.segments)o.push({...a,points:a.points.map(({x:c,y:l,z:d})=>({x:Js(r*c),y:Js(i*l),z:d}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const s=Ko(e.props.segments),r=(Pt[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const o=Y.FromPoints(s);if(o.width<r*2&&o.height<r*2)return new py({x:-r,y:-r,radius:r,isFilled:!0})}const i=Ds(s,bg(e.props,r,e.props.isPen,!0)).map(o=>o.point);return e.props.isClosed?new ht({points:i,isFilled:e.props.fill!=="none"}):new oa({points:i})}component(e){return u.jsx(Kr,{id:e.id,children:u.jsx(Ob,{shape:e,zoomLevel:this.editor.getZoomLevel()})})}indicator(e){var h;const s=Ko(e.props.segments);let r=(Pt[e.props.size]+1)*e.props.scale;const i=this.editor.getZoomLevel();!(i<.5&&i<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&s.length===1&&(r+=ds(e.id)()*(r/6));const a=e.props.isComplete||((h=At(e.props.segments))==null?void 0:h.type)==="straight",c=bg(e.props,r,a,!0),l=Ds(s,c),d=l.length>1?Ri(l,e.props.isClosed):YP(s[0],r);return u.jsx("path",{d})}toSvg(e,s){s.addExportDef(yy(e.props.fill));const r=1/e.props.scale;return u.jsx("g",{transform:`scale(${r})`,children:u.jsx(Ob,{shape:e,zoomLevel:1})})}getCanvasSvgDefs(){return[Sy()]}expandSelectionOutlinePx(e){const s=e.props.dash==="draw"?1.6:1;return Pt[e.props.size]*s/2*e.props.scale}}g(Cd,"type","draw"),g(Cd,"props",ZC),g(Cd,"migrations",JC);function YP(n,t){const e=(t+1)*.5;return`M ${n.x} ${n.y} m -${e}, 0 a ${e},${e} 0 1,0 ${e*2},0 a ${e},${e} 0 1,0 -${e*2},0`}function Bp(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function Ob({shape:n,zoomLevel:t}){var h;const e=es(),s=Ko(n.props.segments),r=n.props.isComplete||((h=At(n.props.segments))==null?void 0:h.type)==="straight";let i=(Pt[n.props.size]+1)*n.props.scale;const o=t<.5&&t<1.5/i;!o&&!n.props.isPen&&n.props.dash==="draw"&&s.length===1&&(i+=ds(n.id)()*(i/6));const a=bg(n.props,i,r,o);if(!o&&n.props.dash==="draw")return u.jsxs(u.Fragment,{children:[n.props.isClosed&&n.props.fill&&s.length>1?u.jsx(Ht,{d:Ri(Ds(s,a),n.props.isClosed),theme:e,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,u.jsx("path",{d:n6(s,a),strokeLinecap:"round",fill:e[n.props.color].solid})]});const c=Ds(s,a),l=c.length<2,d=l?YP(s[0],0):Ri(c,n.props.isClosed);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{d,theme:e,color:n.props.color,fill:l||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),u.jsx("path",{d,strokeLinecap:"round",fill:l?e[n.props.color].solid:"none",stroke:e[n.props.color].solid,strokeWidth:i,strokeDasharray:l?"none":d6(n,i),strokeDashoffset:"0"})]})}function u6(n,t,e={}){const{newPoint:s,handle:r,scaleX:i,scaleY:o}=t,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:d=1/0}=e;let h=n.props.w*i,p=n.props.h*o;const f=new S(0,0);if(h>0){if(h<a){switch(r){case"top_left":case"left":case"bottom_left":{f.x=h-a;break}case"top":case"bottom":{f.x=(h-a)/2;break}default:f.x=0}h=a}}else if(f.x=h,h=-h,h<a){switch(r){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-a}h=a}if(p>0){if(p<l){switch(r){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(r){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:y,y:m}=f.rot(n.rotation).add(s);return{x:y,y:m,props:{w:Math.min(c,h),h:Math.min(d,p)}}}const h6=n=>Object.entries(n).filter(([t,e])=>e).map(([t])=>t).join(" ");class Id extends aa{constructor(){super(...arguments);g(this,"hideSelectionBoundsFg",e=>!this.canResize(e));g(this,"canEdit",()=>!0);g(this,"canResize",e=>{var s,r;return!!((r=(s=Or(e.props.url))==null?void 0:s.definition)!=null&&r.doesResize)});g(this,"canEditInReadOnly",()=>!0);g(this,"isAspectRatioLocked",e=>{const s=Or(e.props.url);return(s==null?void 0:s.definition.isAspectRatioLocked)??!1});g(this,"onResize",(e,s)=>{const r=this.isAspectRatioLocked(e),i=Or(e.props.url);let o=(i==null?void 0:i.definition.minWidth)??200,a=(i==null?void 0:i.definition.minHeight)??200;if(r){const c=e.props.w/e.props.h;c>1?o*=c:a/=c}return u6(e,s,{minWidth:o,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(e){const{w:s,h:r,url:i}=e.props,o=oh(e.id),a=v.useMemo(()=>MP(i),[i]),c=z("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:y}=this.editor.getCurrentPageState();if(f&&y!==f){const m=this.editor.getShape(f);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),l=this.editor.getShapePageTransform(e).rotation(),d=o||c;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(a==null?void 0:a.definition.type)==="tldraw")return null;if((a==null?void 0:a.definition.type)==="github_gist"){const f=a.url.split("/").pop();if(!f)throw Error("No gist id!");return u.jsx(Oi,{className:"tl-embed-container",id:e.id,children:u.jsx(p6,{id:f,width:$(s),height:$(r),isInteractive:d,pageRotation:l})})}const p=h6({...mz,...(a==null?void 0:a.definition.overridePermissions)??{}});return u.jsx(Oi,{className:"tl-embed-container",id:e.id,children:a!=null&&a.definition?u.jsx("iframe",{className:"tl-embed",sandbox:p,src:a.embedUrl,width:$(s),height:$(r),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:xy(l),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(e){const s=v.useMemo(()=>Or(e.props.url),[e.props.url]);return u.jsx("rect",{width:$(e.props.w),height:$(e.props.h),rx:(s==null?void 0:s.definition.overrideOutlineRadius)??8,ry:(s==null?void 0:s.definition.overrideOutlineRadius)??8})}}g(Id,"type","embed"),g(Id,"props",QC),g(Id,"migrations",eI);function p6({id:n,file:t,isInteractive:e,width:s,height:r,style:i,pageRotation:o}){return u.jsx("iframe",{className:"tl-embed",draggable:!1,width:$(s),height:$(r),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:xy(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${t?`?file=${t}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const f6=v.forwardRef(({id:n,name:t,isEditing:e},s)=>{const r=N(),i=v.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(Rt(c),c.currentTarget.blur(),r.setEditingShape(null))},[r]),o=v.useCallback(c=>{const l=r.getShape(n);if(!l)return;const d=l.props.name,h=c.currentTarget.value.trim();d!==h&&r.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,r]),a=v.useCallback(c=>{const l=r.getShape(n);if(!l)return;const d=l.props.name,h=c.currentTarget.value;d!==h&&r.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,r]);return u.jsxs("div",{className:`tl-frame-label ${e?"tl-frame-label__editing":""}`,children:[u.jsx("input",{className:"tl-frame-name-input",ref:s,style:{display:e?void 0:"none"},value:t,autoFocus:!0,onKeyDown:i,onBlur:o,onChange:a}),XP(t,"Frame")+"â"]})}),g6=function({id:t,name:e,width:s,height:r}){const i=N(),o=z("shape rotation",()=>Br(i.getShapePageTransform(t).rotation()),[i,t]),a=oh(t),c=v.useRef(null),l=v.useCallback(y=>{const m=yn(y);i.getEditingShapeId()!==t&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(t),...m}),y.preventDefault())},[i,t]);v.useEffect(()=>{const y=c.current;y&&a&&(y.focus(),y.select())},[c,a]);const h=((o+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(h)];let f;switch(p){case"top":f="";break;case"right":f=`translate(${$(s)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${$(s)}px, ${$(r)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${$(r)}px) rotate(270deg)`;break}return u.jsx("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?s:r)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:u.jsx("div",{className:"tl-frame-heading-hit-area",children:u.jsx(f6,{ref:c,id:t,name:e,isEditing:a})})})};function XP(n,t){return n.match(/^\s*$/)?t:n}class Pd extends aa{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"canReceiveNewChildrenOfType",(e,s)=>!e.isLocked);g(this,"canDropShapes",(e,s)=>!e.isLocked);g(this,"onDragShapesOver",(e,s)=>{s.every(r=>r.parentId===e.id)||this.editor.reparentShapes(s,e.id)});g(this,"onDragShapesOut",(e,s)=>{const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(s,r.id):this.editor.reparentShapes(s,this.editor.getCurrentPageId())});g(this,"onResize",(e,s)=>vP(e,s))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){return new cr({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const s=this.editor.getShapeGeometry(e).bounds,r=es(),i=z("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const a=o==null?void 0:o.info;return a?a.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return u.jsxs(u.Fragment,{children:[u.jsx(Kr,{children:u.jsx("rect",{className:se("tl-frame__body",{"tl-frame__creating":i}),width:s.width,height:s.height,fill:r.solid,stroke:r.text})}),i?null:u.jsx(g6,{id:e.id,name:e.props.name,width:s.width,height:s.height})]})}toSvg(e,s){const r=fr({isDarkMode:s.isDarkMode}),a=((Br(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,c=Math.floor(a);let l;switch(c){case 0:l="";break;case 3:l=`translate(${$(e.props.w)}, 0) rotate(90)`;break;case 2:l=`translate(${$(e.props.w)}, ${$(e.props.h)}) rotate(180)`;break;case 1:l=`translate(0, ${$(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const d={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},h=this.editor.textMeasure.measureTextSpans(XP(e.props.name,"Frame")+"â",d),p=h[0],f=At(h),y=f.box.w+f.box.x-p.box.x,m=wg(this.editor,h,{offsetY:-d.height-2,...d});return u.jsxs(u.Fragment,{children:[u.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),u.jsxs("g",{transform:l,children:[u.jsx("rect",{x:-8,y:-d.height-4,width:y+16,height:d.height,fill:r.background,rx:4,ry:4}),m]})]})}indicator(e){const s=this.editor.getShapeGeometry(e).bounds;return u.jsx("rect",{width:$(s.width),height:$(s.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}g(Pd,"type","frame"),g(Pd,"props",tI),g(Pd,"migrations",nI);function Rb(n,t){return n>t?(_e*(t/2)+(n-t))*2:(_e*(n/2)+(t-n))*2}function qP(n,t){return vy(n,t).map((e,s)=>e.getSvgPathData(s===0)).join(" ")+" Z"}function m6(n,t,e,s){const r=n/4,i=t/4,o=ds(s),a=e*.75,c=b=>b.addXY(o()*a,o()*a),l=new S(n/2,t),d=new S(0,i*1.2),h=new S(n/2,i*.9),p=new S(n,i*1.2),f=c(new S(n/2,t)),y=c(new S(0,i*1.2)),m=c(new S(n/2,i*.9)),x=c(new S(n,i*1.2));return[new Wt({start:l,cp1:new S(r*1.5,i*3),cp2:new S(0,i*2.5),end:d}),new Wt({start:d,cp1:new S(0,-i*.32),cp2:new S(r*1.85,-i*.32),end:h}),new Wt({start:h,cp1:new S(r*2.15,-i*.32),cp2:new S(n,-i*.32),end:p}),new Wt({start:p,cp1:new S(n,i*2.5),cp2:new S(r*2.5,i*3),end:f}),new Wt({start:f,cp1:new S(r*1.5,i*3),cp2:new S(0,i*2.5),end:y}),new Wt({start:y,cp1:new S(0,-i*.32),cp2:new S(r*1.85,-i*.32),end:m}),new Wt({start:m,cp1:new S(r*2.15,-i*.32),cp2:new S(n,-i*.32),end:x}),new Wt({start:x,cp1:new S(n,i*2.5),cp2:new S(r*2.5,i*3),end:l})].map((b,I)=>b.getSvgPathData(I===0)).join(" ")+" Z"}function vy(n,t){const e=n/4,s=t/4;return[new Wt({start:new S(n/2,t),cp1:new S(e*1.5,s*3),cp2:new S(0,s*2.5),end:new S(0,s*1.2)}),new Wt({start:new S(0,s*1.2),cp1:new S(0,-s*.32),cp2:new S(e*1.85,-s*.32),end:new S(n/2,s*.9)}),new Wt({start:new S(n/2,s*.9),cp1:new S(e*2.15,-s*.32),cp2:new S(n,-s*.32),end:new S(n,s*1.2)}),new Wt({start:new S(n,s*1.2),cp1:new S(n,s*2.5),cp2:new S(e*2.5,s*3),end:new S(n/2,t)})]}function y6(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function S6(n,t,e,s){const r=ds(n),i=t/2,o=e/2,a=xI(i,o),c=[],l=je*r(),d=je+Ue/2+Math.abs(r())*Ue,h=Math.max(16,a/10);for(let p=0;p<h;p++){const f=p/(h-1),y=l+f*d,m=Math.cos(y),x=Math.sin(y);c.push(new S(i*m+t*.5+.05*r(),o*x+e/2+.05*r(),Math.min(1,.5+Math.abs(.5-(r()>0?It.easeInOutSine(f):It.easeInExpo(f)))/2)))}return Ds(c,y6(s))}function w6(n,t,e,s){return Ri(S6(n,t,e,s))}function vg(n){let t="M";const e=n.length;let s,r,i;for(let o=0,a=e;o<a;o+=3)s=n[o],r=n[o+1],i=n[o+2],t+=`${Pe(s)}L${Pe(r)}Q${Pe(i)}`;return t+=`${Pe(n[0])}`,t}function Cg(n,t,e,s,r){const i=[],o=ds(n);let a=t[0],c;const l=t.length;for(let d=0,h=l*r;d<h;d++){c=S.AddXY(t[(d+1)%l],o()*e,o()*e);const p=S.Sub(c,a),f=S.Len(p),y=S.Div(p,f).mul(Math.min(f/4,s));i.push(S.Add(a,y),S.Add(c,y.neg()),c),a=c}return i}function x6(n,t,e){const s=Math.min(n,t)/2,r=Math.max(n,t)-s*2,o=(Math.PI*(s*2)+2*r)/e,a=n>t?[{type:"straight",start:new S(s,0),delta:new S(1,0)},{type:"arc",center:new S(n-s,s),startAngle:-_e/2},{type:"straight",start:new S(n-s,t),delta:new S(-1,0)},{type:"arc",center:new S(s,s),startAngle:_e/2}]:[{type:"straight",start:new S(n,s),delta:new S(0,1)},{type:"arc",center:new S(s,t-s),startAngle:0},{type:"straight",start:new S(0,t-s),delta:new S(0,-1)},{type:"arc",center:new S(s,s),startAngle:_e}];let c=0;const l=[];for(let d=0;d<e;d++){const h=a[0];h.type==="straight"?l.push(S.Add(h.start,S.Mul(h.delta,c))):l.push(Di(h.center,s,h.startAngle+c/s)),c+=o;let p=h.type==="straight"?r:_e*s;for(;c>p;)c-=p,a.push(a.shift()),p=a[0].type==="straight"?r:_e*s}return l}const b6={s:50,m:70,l:100,xl:130},v6=.2;function uh(n,t,e,s){const r=ds(e),i=Rb(n,t),o=Math.max(Math.ceil(i/b6[s]),6,Math.ceil(i/Math.min(n,t))),a=i/o*v6,c=Math.max(n-a*2,1),l=Math.max(t-a*2,1),h=Rb(c,l)/o,p=(n-c)/2,f=(t-l)/2,y=x6(c,l,o).map(I=>I.addXY(p,f)),m=n<20?0:a*.3,x=t<20?0:a*.3,w=y.slice(0);for(let I=0;I<Math.floor(o/2);I++)w[I]=S.AddXY(w[I],r()*m,r()*x),w[o-I-1]=S.AddXY(w[o-I-1],r()*m,r()*x);const b=[];for(let I=0;I<w.length;I++){const E=I===w.length-1?0:I+1,P=w[I],C=w[E],_=y[I],k=y[E],D=S.Dist(_,k),T=h-D,L=S.Dist(P,C)/D,j=(Math.max(p,f)+T)*L,R=S.Lrp(_,k,.5).add(S.Sub(k,_).uni().per().mul(j));R.x<0?R.x=0:R.x>n&&(R.x=n),R.y<0?R.y=0:R.y>t&&(R.y=t);const F=Ym(P,C,R),H=S.Dist(F||S.Average([P,C]),P);b.push({leftPoint:P,rightPoint:C,arcPoint:R,center:F,radius:H})}return b}function C6(n,t,e,s){const r=[],i=uh(n,t,e,s);for(const{center:o,radius:a,leftPoint:c,rightPoint:l}of i)r.push(...Oz(c,l,o,a,10));return r}function Ig(n,t,e,s){const r=uh(n,t,e,s);let i=`M${r[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:a,radius:c,center:l}of r){if(l===null){i+=` L${a.toFixed()}`;continue}const d=S.Clockwise(o,a,l)?"0":"1";i+=` A${$(c)},${$(c)} 0 ${d},1 ${a.toFixed()}`}return i+=" Z",i}const I6={s:.5,m:.7,l:.9,xl:1.6};function P6(n,t,e,s){const r=ds(e),i=I6[s],o=uh(n,t,e,s),l=o.reduce((f,y)=>f+S.Dist2(y.leftPoint,y.rightPoint),0)/o.length>(i*15)**2?f=>f.addXY(r()*i*2,r()*i*2):f=>f;let d=`M${o[0].leftPoint.toFixed()}`,h=l(o[0].leftPoint),p=`M${h.toFixed()}`;for(const{leftPoint:f,center:y,rightPoint:m,radius:x,arcPoint:w}of o){if(y===null){d+=` L${m.toFixed()}`;const _=l(m);p+=` L${_.toFixed()}`,h=_;continue}const b=S.Clockwise(f,m,y)?"0":"1";d+=` A${$(x)},${$(x)} 0 ${b},1 ${m.toFixed()}`;const I=l(m),E=l(w),P=Ym(h,I,E);if(!Number.isFinite(P.x)||!Number.isFinite(P.y)){p+=` L${I.toFixed()}`,h=I;continue}const C=Math.abs(S.Dist(P,h));p+=` A${$(C)},${$(C)} 0 ${b},1 ${I.toFixed()}`,h=I}return d+p+" Z"}function Pg(n,t){switch(n.geo){case"x-box":return E6(n.w,n.h,t,n.dash);case"check-box":return _6(n.w,n.h);default:return}}function E6(n,t,e,s){const r=s==="draw"?.62:0;if(s==="dashed")return[[new S(0,0),new S(n/2,t/2)],[new S(n,t),new S(n/2,t/2)],[new S(0,t),new S(n/2,t/2)],[new S(n,0),new S(n/2,t/2)]];const i=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(t,a));return[[new S(i(e*r),o(e*r)),new S(i(n-e*r),o(t-e*r))],[new S(i(e*r),o(t-e*r)),new S(i(n-e*r),o(e*r))]]}function _6(n,t){const e=Math.min(n,t)*.82,s=(n-e)/2,r=(t-e)/2,i=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(t,a));return[[new S(i(s+e*.25),o(r+e*.52)),new S(i(s+e*.45),o(r+e*.82))],[new S(i(s+e*.45),o(r+e*.82)),new S(i(s+e*.82),o(r+e*.22))]]}function Lb({shape:n,shouldScale:t}){const e=t?n.props.scale:1,s=N(),r=es(),{id:i,props:o}=n,{w:a,color:c,fill:l,dash:d,growY:h,size:p}=o,f=Pt[p]*e,y=o.h+h;switch(o.geo){case"cloud":if(d==="solid"){const m=Ig(a,y,i,p);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:m,color:c,fill:l,scale:e}),u.jsx("path",{d:m,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}else if(d==="draw"){const m=P6(a,y,i,p);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:m,color:c,fill:l,scale:e}),u.jsx("path",{d:m,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}else{const m=Ig(a,y,i,p),x=uh(a,y,i,p);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:m,color:c,fill:l,scale:e}),u.jsx("g",{strokeWidth:f,stroke:r[c].solid,fill:"none",pointerEvents:"all",children:x.map(({leftPoint:w,rightPoint:b,center:I,radius:E},P)=>{const C=I?E*Br(Br(S.Angle(I,b))-Br(S.Angle(I,w))):S.Dist(w,b),{strokeDasharray:_,strokeDashoffset:k}=vs(C,f,{style:d,start:"outset",end:"outset"});return u.jsx("path",{d:I?`M${w.x},${w.y}A${E},${E},0,0,1,${b.x},${b.y}`:`M${w.x},${w.y}L${b.x},${b.y}`,strokeDasharray:_,strokeDashoffset:k},P)})})]})}case"ellipse":{const m=t?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const w=m.length,{strokeDasharray:b,strokeDashoffset:I}=vs(w<64?w*2:w,f,{style:d,snap:4,closed:!0});return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:x,color:c,fill:l,scale:e}),u.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:r[c].solid,strokeDasharray:b,strokeDashoffset:I})]})}else{const b=(t?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:b,color:c,fill:l,scale:e}),u.jsx("path",{d:b,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}}case"oval":{const m=t?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m.getSvgPathData(!0);if(d==="dashed"||d==="dotted"){const w=m.getLength(),{strokeDasharray:b,strokeDashoffset:I}=vs(w<64?w*2:w,f,{style:d,snap:4,start:"outset",end:"outset",closed:!0});return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:x,color:c,fill:l,scale:e}),u.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:r[c].solid,strokeDasharray:b,strokeDashoffset:I})]})}else return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:x,color:c,fill:l,scale:e}),u.jsx("path",{d:x,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}case"heart":if(d==="dashed"||d==="dotted"||d==="solid"){const m=qP(a,y),x=vy(a,y);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:m,color:c,fill:l,scale:e}),x.map((w,b)=>{const{strokeDasharray:I,strokeDashoffset:E}=vs(w.length,f,{style:d,snap:1,start:"outset",end:"outset",closed:!0});return u.jsx("path",{d:w.getSvgPathData(),strokeWidth:f,fill:"none",stroke:r[c].solid,strokeDasharray:I,strokeDashoffset:E,pointerEvents:"all"},`curve_${b}`)})]})}else{const m=m6(a,y,f,n.id);return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:m,color:c,fill:l,scale:e}),u.jsx("path",{d:m,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}default:{const m=t?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m instanceof ls?m.children[0].vertices:m.vertices,w=Pg(n.props,f);if(d==="solid"){let b="M"+x[0]+"L"+x.slice(1)+"Z";if(w)for(const[I,E]of w)b+=`M${I.x},${I.y}L${E.x},${E.y}`;return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:b,color:c,fill:l,scale:e}),u.jsx("path",{d:b,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}else if(d==="dashed"||d==="dotted"){const b="M"+x[0]+"L"+x.slice(1)+"Z";return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:b,color:c,fill:l,scale:e}),u.jsxs("g",{strokeWidth:f,stroke:r[c].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(x.length)).map((I,E)=>{const P=S.ToFixed(x[E]),C=S.ToFixed(x[(E+1)%x.length]),_=S.Dist(P,C),{strokeDasharray:k,strokeDashoffset:D}=vs(_,f,{style:d,start:"outset",end:"outset"});return u.jsx("line",{x1:P.x,y1:P.y,x2:C.x,y2:C.y,strokeDasharray:k,strokeDashoffset:D},E)}),w&&w.map(([I,E],P)=>{const C=S.Dist(I,E),{strokeDasharray:_,strokeDashoffset:k}=vs(C,f,{style:d,start:"skip",end:"skip",snap:d==="dotted"?4:void 0});return u.jsx("path",{d:`M${I.x},${I.y}L${E.x},${E.y}`,stroke:r[c].solid,strokeWidth:f,fill:"none",strokeDasharray:_,strokeDashoffset:k},`line_fg_${P}`)})]})]})}else if(d==="draw"){let b=vg(Cg(i,x,f/3,f*2,2));if(w)for(const[E,P]of w)b+=`M${E.toFixed()}L${P.toFixed()}`;const I=vg(Cg(i,x,0,f*2,1));return u.jsxs(u.Fragment,{children:[u.jsx(Ht,{theme:r,d:I,color:c,fill:l,scale:e}),u.jsx("path",{d:b,stroke:r[c].solid,strokeWidth:f,fill:"none"})]})}}}}const Un=17*3;class Ed extends aa{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"onEditEnd",e=>{const{id:s,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:s,type:r,props:{text:i.trimEnd()}}])});g(this,"onResize",(e,{handle:s,newPoint:r,scaleX:i,scaleY:o,initialShape:a})=>{let c=a.props.w*i,l=(a.props.h+a.props.growY)*o,d=0,h=0;if(e.props.text.trim()){let m=Math.max(Math.abs(c),Un),x=Math.max(Math.abs(l),Un);m<Un&&x===Un&&(m=Un),m===Un&&x<Un&&(x=Un);const w=jl(this.editor,{...e,props:{...e.props,w:m,h:x}}),b=Math.max(Math.abs(c),w.w)*Math.sign(c),I=Math.max(Math.abs(l),w.h)*Math.sign(l);d=Math.abs(b)-Math.abs(c),h=Math.abs(I)-Math.abs(l),c=b,l=I}const p=new S(0,0);i<0&&(p.x+=c),(s==="left"||s==="top_left"||s==="bottom_left")&&(p.x+=i<0?d:-d),o<0&&(p.y+=l),(s==="top"||s==="top_left"||s==="top_right")&&(p.y+=o<0?h:-h);const{x:f,y}=p.rot(e.rotation).add(r);return{x:f,y,props:{w:Math.max(Math.abs(c),1),h:Math.max(Math.abs(l),1),growY:0}}});g(this,"onBeforeCreate",e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const s=e.props.h,r=jl(this.editor,e).h;let i=null;if(r>s?i=r-s:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}});g(this,"onBeforeUpdate",(e,s)=>{const r=e.props.text,i=s.props.text;if(r===i&&e.props.font===s.props.font&&e.props.size===s.props.size)return;if(r&&!i)return{...s,props:{...s.props,growY:0}};const o=e.props.w,a=e.props.h,c=jl(this.editor,s),l=c.w,d=c.h;if(!r&&i&&i.length===1){let p=Math.max(o,l),f=Math.max(a,d);return e.props.w<Un&&e.props.h<Un&&(p=Math.max(p,Un),f=Math.max(f,Un),p=Math.max(p,f),f=Math.max(p,f)),{...s,props:{...s.props,w:p,h:f,growY:0}}}let h=null;if(d>a?h=d-a:e.props.growY&&(h=0),h!==null)return{...s,props:{...s.props,growY:h,w:Math.max(s.props.w,l)}};if(l>e.props.w)return{...s,props:{...s.props,w:l}}});g(this,"onDoubleClick",e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const s=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=s/2,o=r/2,a=Pt[e.props.size]*e.props.scale,c=e.props.fill!=="none";let l;switch(e.props.geo){case"cloud":{l=new ht({points:C6(s,r,e.id,e.props.size),isFilled:c});break}case"triangle":{l=new ht({points:[new S(i,0),new S(s,r),new S(0,r)],isFilled:c});break}case"diamond":{l=new ht({points:[new S(i,0),new S(s,o),new S(i,r),new S(0,o)],isFilled:c});break}case"pentagon":{l=new ht({points:wp(s,r,5),isFilled:c});break}case"hexagon":{l=new ht({points:wp(s,r,6),isFilled:c});break}case"octagon":{l=new ht({points:wp(s,r,8),isFilled:c});break}case"ellipse":{l=new t8({width:s,height:r,isFilled:c});break}case"oval":{l=new n8({width:s,height:r,isFilled:c});break}case"star":{const b=je/5/2,I=Math.floor(5/4)*2,E=5*2-I,P=0,C=Math.floor(5/2)*2,_=Math.cos(-Ue+I*b)*s/2,k=Math.cos(-Ue+E*b)*s/2,D=Math.sin(-Ue+P*b)*r/2,T=Math.sin(-Ue+C*b)*r/2,A=s-Math.abs(_-k),L=r-Math.abs(T-D),j=s/2+k-(s/2-_),R=r/2+D-(r/2-T),F=1,H=(s-j)/2,U=(r-R)/2,V=(s+A)/2,W=(r+L)/2,te=V*F/2,le=W*F/2;l=new ht({points:Array.from(Array(5*2)).map((Se,be)=>{const nt=-Ue+be*b;return new S(H+(be%2?te:V)*Math.cos(nt),U+(be%2?le:W)*Math.sin(nt))}),isFilled:c});break}case"rhombus":{const w=Math.min(s*.38,r*.38);l=new ht({points:[new S(w,0),new S(s,0),new S(s-w,r),new S(0,r)],isFilled:c});break}case"rhombus-2":{const w=Math.min(s*.38,r*.38);l=new ht({points:[new S(0,0),new S(s-w,0),new S(s,r),new S(w,r)],isFilled:c});break}case"trapezoid":{const w=Math.min(s*.38,r*.38);l=new ht({points:[new S(w,0),new S(s-w,0),new S(s,r),new S(0,r)],isFilled:c});break}case"arrow-right":{const w=Math.min(s,r)*.38,b=r*.16;l=new ht({points:[new S(0,b),new S(s-w,b),new S(s-w,0),new S(s,r/2),new S(s-w,r),new S(s-w,r-b),new S(0,r-b)],isFilled:c});break}case"arrow-left":{const w=Math.min(s,r)*.38,b=r*.16;l=new ht({points:[new S(w,0),new S(w,b),new S(s,b),new S(s,r-b),new S(w,r-b),new S(w,r),new S(0,r/2)],isFilled:c});break}case"arrow-up":{const w=s*.16,b=Math.min(s,r)*.38;l=new ht({points:[new S(s/2,0),new S(s,b),new S(s-w,b),new S(s-w,r),new S(w,r),new S(w,b),new S(0,b)],isFilled:c});break}case"arrow-down":{const w=s*.16,b=Math.min(s,r)*.38;l=new ht({points:[new S(w,0),new S(s-w,0),new S(s-w,r-b),new S(s,r-b),new S(s/2,r),new S(0,r-b),new S(w,r-b)],isFilled:c});break}case"check-box":case"x-box":case"rectangle":{l=new cr({width:s,height:r,isFilled:c});break}case"heart":{const b=vy(s,r).reduce((I,E)=>(I.push(...E.vertices),I),[]);l=new ht({points:b,isFilled:c});break}default:Zt(e.props.geo)}const d=jl(this.editor,e),h=Math.min(100,s/2),p=Math.min(sr[e.props.size]*e.props.scale*Lt.lineHeight+ss*2,r/2),f=Math.min(s,Math.max(d.w,Math.min(h,Math.max(1,s-8)))),y=Math.min(r,Math.max(d.h,Math.min(p,Math.max(1,s-8)))),m=Pg(e.props,a),x=m?m.map(w=>new oa({points:w})):[];return new ls({children:[l,new cr({x:e.props.align==="start"?0:e.props.align==="end"?s-f:(s-f)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?r-y:(r-y)/2,width:f,height:y,isFilled:!0,isLabel:!0}),...x]})}getHandleSnapGeometry(e){const s=this.getGeometry(e),r=s.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),s.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[s.bounds.center]};default:Zt(e.props.geo)}}component(e){const{id:s,type:r,props:i}=e,{fill:o,font:a,align:c,verticalAlign:l,size:d,text:h}=i,p=e.id===this.editor.getOnlySelectedShapeId(),f=es(),m=this.editor.getEditingShapeId()!==null||e.props.text;return u.jsxs(u.Fragment,{children:[u.jsx(Kr,{id:s,children:u.jsx(Lb,{shape:e,shouldScale:!0})}),m&&u.jsx(Oi,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:u.jsx(dh,{id:s,type:r,font:a,fontSize:sr[d]*e.props.scale,lineHeight:Lt.lineHeight,padding:16*e.props.scale,fill:o,align:c,verticalAlign:l,text:h,isSelected:p,labelColor:f[i.labelColor].solid,wrap:!0})}),e.props.url&&u.jsx(Ho,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:s,props:r}=e,{w:i,size:o}=r,a=r.h+r.growY,c=Pt[o],l=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?u.jsx("path",{d:w6(s,i,a,c)}):u.jsx("path",{d:l.getSvgPathData(!0)});case"heart":return u.jsx("path",{d:qP(i,a)});case"oval":return u.jsx("path",{d:l.getSvgPathData(!0)});case"cloud":return u.jsx("path",{d:Ig(i,a,s,o)});default:{const d=this.editor.getShapeGeometry(e),h=d instanceof ls?d.children[0].vertices:d.vertices;let p;if(r.dash==="draw"){const y=Cg(s,h,0,c*2*e.props.scale,1);p=vg(y)}else p="M"+h[0]+"L"+h.slice(1)+"Z";const f=Pg(e.props,c);if(f)for(const[y,m]of f)p+=`M${y.x},${y.y}L${m.x},${m.y}`;return u.jsx("path",{d:p})}}}toSvg(e,s){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},i=r.props;s.addExportDef(yy(i.fill));let o;if(i.text){s.addExportDef(Uo(i.font));const a=fr(s),c=new Y(0,0,i.w,i.h+i.growY);o=u.jsx(lh,{fontSize:sr[i.size],font:i.font,align:i.align,verticalAlign:i.verticalAlign,text:i.text,labelColor:a[i.labelColor].solid,bounds:c,padding:16})}return u.jsxs(u.Fragment,{children:[u.jsx(Lb,{shouldScale:!1,shape:r}),o]})}getCanvasSvgDefs(){return[Sy()]}}g(Ed,"type","geo"),g(Ed,"props",sI),g(Ed,"migrations",rI);function jl(n,t){const e=t.props.text;if(!e)return{w:0,h:0};const s=n.textMeasure.measureText("w",{...Lt,fontFamily:Ts[t.props.font],fontSize:sr[t.props.size]*t.props.scale,maxWidth:100}),r={s:2,m:3.5,l:5,xl:10},i=n.textMeasure.measureText(e,{...Lt,fontFamily:Ts[t.props.font],fontSize:sr[t.props.size]*t.props.scale,minWidth:s.w,maxWidth:Math.max(0,Math.ceil(s.w+r[t.props.size]),Math.ceil(t.props.w-ss*2))});return{w:i.w+ss*2,h:i.h+ss*2}}function T6(){const[n,t]=v.useState(!1);return v.useEffect(()=>{const s=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");t(s&&r.matches);const i=()=>t(s&&r.matches);return r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),z(ft.forceSrgb)||!n?"srgb":"p3"}const $b=.35,Fb=.82;class _d extends cs{constructor(){super(...arguments);g(this,"hideResizeHandles",e=>Dl(e));g(this,"hideRotateHandle",e=>Dl(e));g(this,"hideSelectionBoundsFg",e=>Dl(e));g(this,"onResize",(e,s)=>{const{scaleX:r,scaleY:i}=s,o=[];for(const a of e.props.segments)o.push({...a,points:a.points.map(({x:c,y:l,z:d})=>({x:r*c,y:i*l,z:d}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const s=mi(e);if(Dl(e))return new py({x:-s/2,y:-s/2,radius:s/2,isFilled:!0});const{strokePoints:r,sw:i}=Nb(e,s,!0),o=by({strokeWidth:i,showAsComplete:!0});return ah(r,o),new ht({points:fy(r,o),isFilled:!0})}component(e){const s=zp(this.editor,e),r=mi(e);return u.jsx(Kr,{id:e.id,children:u.jsx(Ol,{shape:e,forceSolid:s,strokeWidth:r,opacity:$b})})}backgroundComponent(e){const s=zp(this.editor,e),r=mi(e);return u.jsx(Kr,{id:e.id,children:u.jsx(Ol,{shape:e,forceSolid:s,strokeWidth:r,opacity:Fb})})}indicator(e){const s=zp(this.editor,e),r=mi(e),{strokePoints:i,sw:o}=Nb(e,r,s),a=Ko(e.props.segments);let c;return i.length<2?c=M6(a[0],o):c=Ri(i,!1),u.jsx("path",{d:c})}toSvg(e){const s=mi(e),r=s<1.5,i=1/e.props.scale;return u.jsx("g",{transform:`scale(${i})`,children:u.jsx(Ol,{forceSolid:r,strokeWidth:s,shape:e,opacity:$b})})}toBackgroundSvg(e){const s=mi(e),r=s<1.5,i=1/e.props.scale;return u.jsx("g",{transform:`scale(${i})`,children:u.jsx(Ol,{forceSolid:r,strokeWidth:s,shape:e,opacity:Fb})})}}g(_d,"type","highlight"),g(_d,"props",aI),g(_d,"migrations",cI);function k6(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function M6(n,t){const e=t/2;return`M ${n.x} ${n.y} m -${e}, 0 a ${e},${e} 0 1,0 ${e*2},0 a ${e},${e} 0 1,0 -${e*2},0`}function Nb(n,t,e){var c;const s=Ko(n.props.segments),r=n.props.isComplete||((c=At(n.props.segments))==null?void 0:c.type)==="straight";let i=t;!e&&!n.props.isPen&&s.length===1&&(i+=ds(n.id)()*(t/6));const o=by({strokeWidth:i,showAsComplete:r});return{strokePoints:Ds(s,o),sw:i}}function mi(n){return Bo[n.props.size]*1.12*n.props.scale}function Dl(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function Ol({strokeWidth:n,forceSolid:t,shape:e,opacity:s}){var p;const r=es(),i=Ko(e.props.segments);let o=n;!t&&!e.props.isPen&&i.length===1&&(o+=ds(e.id)()*(o/6));const a=by({strokeWidth:o,showAsComplete:e.props.isComplete||((p=At(e.props.segments))==null?void 0:p.type)==="straight"}),c=Ds(i,a),l=c.length>1?Ri(c,!1):k6(e.props.segments[0].points[0]),d=T6(),h=r[e.props.color].highlight[d];return u.jsx("path",{d:l,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:o,opacity:s})}function zp(n,t){return z("forceSolid",()=>{const e=mi(t),s=n.getZoomLevel();return e/s<1.5},[n])}function ZP(){return u.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[u.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),u.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),u.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function JP(n,t,e){const s=N(),[r,i]=v.useState(null),o=t?s.getAsset(t):null,c=s.getCulledShapes().has(n),l=o&&"w"in o.props?e/o.props.w:1,d=z("zoom level",()=>s.getZoomLevel()*l,[s,l]);return v.useEffect(()=>{if(c)return;let h=!1;const p=s.timers.setTimeout(async()=>{const f=await s.resolveAssetUrl(t,{screenScale:d});h||i(f)},500);return()=>{clearTimeout(p),h=!0}},[t,o==null?void 0:o.props.src,c,d,s]),{asset:o,url:r}}function QP(){const[n,t]=v.useState(!1);return v.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{t(e.matches)};return s(),e.addEventListener("change",s),()=>e.removeEventListener("change",s)},[]),n}async function A6(n){const e=await(await Ms(n)).blob();return vi.blobToDataUrl(e)}class Td extends aa{constructor(){super(...arguments);g(this,"isAspectRatioLocked",()=>!0);g(this,"canCrop",()=>!0);g(this,"onDoubleClick",e=>{const s=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;!s||!(s.props.src&&this.isAnimated(e))||this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])});g(this,"onDoubleClickEdge",e=>{const s=e.props;if(!s||this.editor.getCroppingShapeId()!==e.id)return;const r=Je(s.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},i=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,o=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=new S(r.topLeft.x*i,r.topLeft.y*o).rot(e.rotation),c={id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:o}};this.editor.updateShapes([c])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}isAnimated(e){const s=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return s?"mimeType"in s.props&&Is.isAnimatedImageType(s==null?void 0:s.props.mimeType)||"isAnimated"in s.props&&s.props.isAnimated:!1}component(e){var m;const s=this.editor.getCroppingShapeId()===e.id,r=QP(),[i,o]=v.useState(""),[a,c]=v.useState(""),l=e.id===this.editor.getOnlySelectedShapeId(),{asset:d,url:h}=JP(e.id,e.props.assetId,e.props.w);if(v.useEffect(()=>{if(h){let x=!1;const w=Lo();return w.onload=()=>{x||c(h)},w.src=h,()=>{x=!0}}},[h,e]),v.useEffect(()=>{if(h&&this.isAnimated(e)){let x=!1;const w=Lo();return w.onload=()=>{if(x)return;const b=document.createElement("canvas");b.width=w.width,b.height=w.height;const I=b.getContext("2d");I&&(I.drawImage(w,0,0),o(b.toDataURL()),c(h))},w.crossOrigin="anonymous",w.src=h,()=>{x=!0}}},[r,h,e]),(d==null?void 0:d.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const p=l&&s&&this.editor.isIn("select.crop"),f=r&&(((m=d==null?void 0:d.props.mimeType)==null?void 0:m.includes("video"))||this.isAnimated(e)),y=Bb(e);return d!=null&&d.props.src?a?u.jsxs(u.Fragment,{children:[p&&u.jsx("div",{style:y,children:u.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||f?i:a,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),u.jsxs(Oi,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[u.jsxs("div",{className:"tl-image-container",style:y,children:[u.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||f?i:a,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(e)&&!e.props.playing&&u.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),e.props.url&&u.jsx(Ho,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:u.jsxs(Oi,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:d?"transparent":"var(--color-low)",border:d?"none":"1px solid var(--color-low-border)"},children:[u.jsx("div",{className:"tl-image-container",style:y,children:d?null:u.jsx(ZP,{})}),"url"in e.props&&e.props.url&&u.jsx(Ho,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:u.jsx("rect",{width:$(e.props.w),height:$(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginalImage:!0});if(!r)return null;(r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await A6(r)||"");const i=Bb(e),o=e.props.crop;if(i.transform&&o){const{transform:a,width:c,height:l}=i,d=(o.bottomRight.x-o.topLeft.x)*c,h=(o.bottomRight.y-o.topLeft.y)*l,p=[new S(0,0),new S(d,0),new S(d,h),new S(0,h)],f=`cropClipPath_${e.id.replace(":","_")}`;return u.jsxs(u.Fragment,{children:[u.jsx("defs",{children:u.jsx("clipPath",{id:f,children:u.jsx("polygon",{points:p.map(y=>`${y.x},${y.y}`).join(" ")})})}),u.jsx("g",{clipPath:`url(#${f})`,children:u.jsx("image",{href:r,width:c,height:l,style:{transform:a}})})]})}else return u.jsx("image",{href:r,width:e.props.w,height:e.props.h})}}g(Td,"type","image"),g(Td,"props",lI),g(Td,"migrations",dI);function Bb(n){const t=n.props.crop,e=t==null?void 0:t.topLeft;if(!e)return{width:n.props.w,height:n.props.h};const s=1/(t.bottomRight.x-t.topLeft.x)*n.props.w,r=1/(t.bottomRight.y-t.topLeft.y)*n.props.h,i=-e.x*s,o=-e.y*r;return{transform:`translate(${i}px, ${o}px)`,width:s,height:r}}function eE(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function tE(n,t,e){const s=t.vertices,r=eE(e);return Ds(s,r)}function j6(n,t,e){const s=eE(e);return fy(ah(tE(n,t,e),s),s)}function D6(n,t,e){const s=j6(n,t,e);return Zm(s)}function O6(n,t,e){if(n.props.dash==="draw"){const s=tE(n,t,e);return Ri(s)}return t.getSvgPathData()}function nE(n,t,e){let s=`M ${Pe(t[0])}L`,r=`M ${Pe(t[0])}L`;const i=e/3,o=e*2,a=ds(n);let c=t[0],l,d=t[0],h;const p=t.length;for(let f=0,y=p-1;f<y;f++){l=t[f+1],h=S.AddXY(t[f+1],a()*i,a()*i);const m=S.Sub(l,c),x=S.Len(m),w=S.Div(m,x).mul(Math.min(x/4,o)),b=S.Add(c,w),I=S.Add(l,w.neg()),E=S.Sub(h,d),P=S.Len(E),C=S.Div(E,P).mul(Math.min(P/4,o)),_=S.Add(d,C),k=S.Add(h,C.neg());f===y-1?(s+=`${Pe(b)}L ${Pe(l)}`,r+=`${Pe(_)}L ${Pe(h)}`):(s+=`${Pe(b)}L ${Pe(I)}Q ${Pe(l)}`,r+=`${Pe(_)}L ${Pe(k)}Q ${Pe(h)}`,c=l,d=h)}return[s,s+r]}const R6=new or;class kd extends cs{constructor(){super(...arguments);g(this,"hideResizeHandles",()=>!0);g(this,"hideRotateHandle",()=>!0);g(this,"hideSelectionBoundsFg",()=>!0);g(this,"hideSelectionBoundsBg",()=>!0);g(this,"onResize",(e,s)=>{const{scaleX:r,scaleY:i}=s;return{props:{points:Mc(e.props.points,(o,{id:a,index:c,x:l,y:d})=>({id:a,index:c,x:l*r,y:d*i}))}}});g(this,"onHandleDrag",(e,{handle:s})=>{if(s.type==="vertex")return{...e,props:{...e.props,points:{...e.props.points,[s.id]:{id:s.id,index:s.index,x:s.x,y:s.y}}}}})}getDefaultProps(){const[e,s]=nc(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[s]:{id:s,index:s,x:.1,y:.1}},scale:1}}getGeometry(e){return Ba(e)}getHandles(e){return R6.get(e.props,()=>{const s=Ba(e),r=Eg(e),i=r.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<r.length-1;o++){const a=tc(r[o].index,r[o+1].index),l=s.segments[o].midPoint();i.push({id:a,type:"create",index:a,x:l.x,y:l.y,canSnap:!0})}return i.sort(Xt)})}component(e){return u.jsx(Kr,{id:e.id,children:u.jsx(zb,{shape:e})})}indicator(e){const s=Pt[e.props.size]*e.props.scale,r=Ba(e),{dash:i}=e.props;let o;if(e.props.spline==="line"){const a=r.points;if(i==="solid"||i==="dotted"||i==="dashed")o="M"+a[0]+"L"+a.slice(1);else{const[c]=nE(e.id,a,s);o=c}}else o=O6(e,r,s);return u.jsx("path",{d:o})}toSvg(e){return u.jsx(zb,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const s=Eg(e);return{points:s,getSelfSnapPoints:r=>{const i=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id);return s.filter((o,a)=>Math.abs(a-i)>1).map(S.From)},getSelfSnapOutline:r=>{const i=this.getHandles(e).filter(a=>a.type==="vertex").findIndex(a=>a.id===r.id),o=Ba(e).segments.filter((a,c)=>c!==i-1&&c!==i);return o.length?new ls({children:o}):null}}}}g(kd,"type","line"),g(kd,"props",uI),g(kd,"migrations",hI);function Eg(n){return Object.values(n.props.points).sort(Xt)}function Ba(n){const t=Eg(n).map(S.From);switch(n.props.spline){case"cubic":return new e8({points:t});case"line":return new oa({points:t})}}function zb({shape:n,shouldScale:t=!1}){const e=es(),s=Ba(n),{dash:r,color:i,size:o}=n.props,a=1/n.props.scale,c=t?a:1,l=Pt[o]*n.props.scale;if(n.props.spline==="line"){if(r==="solid"){const d=s.points,h="M"+d[0]+"L"+d.slice(1);return u.jsx("path",{d:h,stroke:e[i].solid,strokeWidth:l,fill:"none",transform:`scale(${c})`})}if(r==="dashed"||r==="dotted")return u.jsx("g",{stroke:e[i].solid,strokeWidth:l,transform:`scale(${c})`,children:s.segments.map((d,h)=>{const{strokeDasharray:p,strokeDashoffset:f}=vs(d.length,l,{style:r,start:h>0?"outset":"none",end:h<s.segments.length-1?"outset":"none"});return u.jsx("path",{strokeDasharray:p,strokeDashoffset:f,d:d.getSvgPathData(!0),fill:"none"},h)})});if(r==="draw"){const d=s.points,[h,p]=nE(n.id,d,l);return u.jsx("path",{d:p,stroke:e[i].solid,strokeWidth:l,fill:"none",transform:`scale(${c})`})}}if(n.props.spline==="cubic"){const d=s.getSvgPathData();if(r==="solid")return u.jsx("path",{strokeWidth:l,stroke:e[i].solid,fill:"none",d,transform:`scale(${c})`});if(r==="dashed"||r==="dotted")return u.jsx("g",{stroke:e[i].solid,strokeWidth:l,transform:`scale(${c})`,children:s.segments.map((h,p)=>{const{strokeDasharray:f,strokeDashoffset:y}=vs(h.length,l,{style:r,start:p>0?"outset":"none",end:p<s.segments.length-1?"outset":"none"});return u.jsx("path",{strokeDasharray:f,strokeDashoffset:y,d:h.getSvgPathData(),fill:"none"},p)})});if(r==="draw")return u.jsx("path",{d:D6(n,s,l),strokeWidth:1,stroke:e[i].solid,fill:e[i].solid,transform:`scale(${c})`})}}const sE=v.createContext(null);function L6({assetUrls:n,children:t}){return v.useEffect(()=>{for(const e of Object.values(n.icons)){const s=Lo();s.src=e,s.decode()}for(const e of Object.values(n.embedIcons)){const s=Lo();s.src=e,s.decode()}},[n]),u.jsx(sE.Provider,{value:n,children:t})}function Cy(){const n=v.useContext(sE);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const _g={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new projectâ¦","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},$6=new Set(["ar","fa","he","ur","ku"]),io={locale:"en",label:"English",messages:_g,dir:"ltr"};async function F6(n,t){if(!(await Ms(t.translations.en)).ok)return console.warn("No main translations found."),io;if(n==="en")return io;const s=oc.find(a=>a.locale===n);if(!s)return console.warn(`No translation found for locale ${n}`),io;const i=await(await Ms(t.translations[s.locale])).json();if(!i)return console.warn(`No messages found for locale ${n}`),io;const o=[];for(const a in io.messages)i[a]||o.push(a);return o.length>0,{locale:n,label:s.label,dir:$6.has(s.locale)?"rtl":"ltr",messages:{...io.messages,...i}}}const rE=v.createContext(null);function iE(){const n=v.useContext(rE);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}const N6=Cn(function({overrides:t,children:e}){const r=N().user.getLocale(),i=Cy(),[o,a]=v.useState(()=>t&&t.en?{locale:"en",label:"English",dir:"ltr",messages:{..._g,...t.en}}:{locale:"en",label:"English",dir:"ltr",messages:_g});return v.useEffect(()=>{let c=!1;async function l(){const d=await F6(r,i);d&&!c&&(t&&t[r]?a({...d,messages:{...d.messages,...t[r]}}):a(d))}return l(),()=>{c=!0}},[i,r,t]),u.jsx(rE.Provider,{value:o,children:e})});function Te(){const n=iE();return v.useCallback(function(e){return n.messages[e]??e},[n])}class Md extends cs{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"hideResizeHandles",()=>!0);g(this,"hideSelectionBoundsFg",()=>!1);g(this,"onBeforeCreate",e=>Ub(this.editor,e));g(this,"onBeforeUpdate",(e,s)=>{if(!(e.props.text===s.props.text&&e.props.font===s.props.font&&e.props.size===s.props.size))return Ub(this.editor,s)});g(this,"onEditEnd",e=>{const{id:s,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:s,type:r,props:{text:i.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:s,labelWidth:r}=oE(this.editor,e),{scale:i}=e.props,o=s*i,a=r*i,c=$e*i,l=Rl(e);return new ls({children:[new cr({width:c,height:l,isFilled:!0}),new cr({x:e.props.align==="start"?0:e.props.align==="end"?c-a:(c-a)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?l-o:(l-o)/2,width:a,height:o,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:s}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const i=this.editor.getZoomLevel();if(i*s<.25)return[];const o=Rl(e),a=$e*s,c=hH/i*s;return i*s<.5?[{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+c}]:[{id:"top",index:"a1",type:"clone",x:a/2,y:-c},{id:"right",index:"a2",type:"clone",x:a+c,y:o/2},{id:"bottom",index:"a3",type:"clone",x:a/2,y:o+c},{id:"left",index:"a4",type:"clone",x:-c,y:o/2}]}component(e){const{id:s,type:r,props:{scale:i,color:o,font:a,size:c,align:l,text:d,verticalAlign:h,fontSizeAdjustment:p}}=e,f=U6(s),y=es(),m=$e*i,x=Rl(e),w=z("shape rotation",()=>{var E;return((E=this.editor.getShapePageTransform(s))==null?void 0:E.rotation())??0},[this.editor]),b=z("zoom",()=>this.editor.getZoomLevel()<.35/i,[i,this.editor]),I=e.id===this.editor.getOnlySelectedShapeId();return u.jsxs(u.Fragment,{children:[u.jsx("div",{id:s,className:"tl-note__container",style:{width:m,height:x,backgroundColor:y[o].note.fill,borderBottom:b?`${3*i}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:b?"none":H6(e.id,w,i)},children:u.jsx(dh,{id:s,type:r,font:a,fontSize:(p||sr[c])*i,lineHeight:Lt.lineHeight,align:l,verticalAlign:h,text:d,isNote:!0,isSelected:I,labelColor:y[o].note.text,wrap:!0,padding:16*i,onKeyDown:f})}),"url"in e.props&&e.props.url&&u.jsx(Ho,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{scale:s}=e.props;return u.jsx("rect",{rx:s,width:$($e*s),height:$(Rl(e))})}toSvg(e,s){s.addExportDef(Uo(e.props.font)),e.props.text&&s.addExportDef(Uo(e.props.font));const r=fr({isDarkMode:s.isDarkMode}),i=K6(e);return u.jsxs(u.Fragment,{children:[u.jsx("rect",{x:5,y:5,rx:1,width:$e-10,height:i.h,fill:"rgba(0,0,0,.1)"}),u.jsx("rect",{rx:1,width:$e,height:i.h,fill:r[e.props.color].note.fill}),u.jsx(lh,{fontSize:e.props.fontSizeAdjustment||sr[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:i,stroke:!1})]})}}g(Md,"type","note"),g(Md,"props",pI),g(Md,"migrations",fI);function Ub(n,t){const{labelHeight:e,fontSizeAdjustment:s}=oE(n,t),r=Math.max(0,e-$e);if(r!==t.props.growY||s!==t.props.fontSizeAdjustment)return{...t,props:{...t.props,growY:r,fontSizeAdjustment:s}}}function B6(n,t){const{text:e}=t.props;if(!e)return{labelHeight:sr[t.props.size]*Lt.lineHeight+ss*2,labelWidth:100,fontSizeAdjustment:0};const s=sr[t.props.size];let r=0,i=0,o=$e,a=$e;const c=1;do{r=Math.min(s,s-i);const l=n.textMeasure.measureText(e,{...Lt,fontFamily:Ts[t.props.font],fontSize:r,maxWidth:$e-ss*2-c,disableOverflowWrapBreaking:!0});if(o=l.h+ss*2,a=l.w+ss*2,r<=14){const d=n.textMeasure.measureText(e,{...Lt,fontFamily:Ts[t.props.font],fontSize:r,maxWidth:$e-ss*2-c});o=d.h+ss*2,a=d.w+ss*2;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(i++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:r}}const z6=new or;function oE(n,t){return z6.get(t,()=>B6(n,t))}function U6(n){const t=N(),e=iE();return v.useCallback(s=>{const r=t.getShape(n);if(!r)return;const i=s.key==="Tab",o=(s.metaKey||s.ctrlKey)&&s.key==="Enter";if(i||o){s.preventDefault();const a=t.getShapePageTransform(n),c=a.rotation(),l=!!(e.dir==="rtl"||AP(r.props.text)),d=($e+t.options.adjacentShapeMargin+(o&&!s.shiftKey?r.props.growY:0))*r.props.scale,h=new S(i?s.shiftKey!=l?-1:1:0,o?s.shiftKey?-1:1:0).mul(d).add(ch.clone().mul(r.props.scale)).rot(c).add(a.point()),p=NP(t,r,h,c);p&&(t.mark("editing adjacent shape"),vu(t,p,!0))}},[n,t,e.dir])}function Rl(n){return($e+n.props.growY)*n.props.scale}function H6(n,t,e){const s=ds(n),r=Math.abs(s())+.5,i=Math.cos(t),o=5*e,a=4*e,c=6*e,l=7*e;return`0px ${o-r}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+r*l)*Math.max(0,i)}px ${c+r*l}px -${a+r*c}px rgba(15, 23, 31, ${(.3+r*.1).toFixed(2)}), 
	0px ${48*e}px ${10*e}px -${10*e}px inset rgba(15, 23, 44, ${((.022+s()*.005)*((1+i)/2)).toFixed(2)})`}function K6(n){return new Y(0,0,$e,$e+n.props.growY)}function G6(n,{initialBounds:t,scaleX:e,scaleY:s,newPoint:r}){const i=Math.max(.01,Math.min(Math.abs(e),Math.abs(s))),o=new S(0,0);e<0&&(o.x=-(t.width*i)),s<0&&(o.y=-(t.height*i));const{x:a,y:c}=S.Add(r,o.rot(n.rotation));return{x:a,y:c,props:{scale:i*n.props.scale}}}const W6=new or;class Ad extends cs{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"isAspectRatioLocked",()=>!0);g(this,"onResize",(e,s)=>{const{newPoint:r,initialBounds:i,initialShape:o,scaleX:a,handle:c}=s;if(s.mode==="scale_shape"||c!=="right"&&c!=="left")return{id:e.id,type:e.type,...G6(e,s)};{const l=Math.max(1,Math.abs(i.width*a)),{x:d,y:h}=a<0?S.Sub(r,S.FromAngle(e.rotation).mul(l)):r;return{id:e.id,type:e.type,x:d,y:h,props:{w:l/o.props.scale,autoSize:!1}}}});g(this,"onEditEnd",e=>{const{id:s,type:r,props:{text:i}}=e,o=e.props.text.trimEnd();o.length===0?this.editor.deleteShapes([e.id]):o!==e.props.text&&this.editor.updateShapes([{id:s,type:r,props:{text:i.trimEnd()}}])});g(this,"onBeforeUpdate",(e,s)=>{if(!s.props.autoSize)return;const r=e.props.size!==s.props.size||e.props.textAlign!==s.props.textAlign||e.props.font!==s.props.font||e.props.scale!==1&&s.props.scale===1,i=e.props.text!==s.props.text;if(!r&&!i)return;const o=this.getMinDimensions(e),a=Hb(this.editor,s.props),c=o.width*e.props.scale,l=o.height*e.props.scale,d=a.width*s.props.scale,h=a.height*s.props.scale;let p;switch(s.props.textAlign){case"middle":{p=new S((d-c)/2,i?0:(h-l)/2);break}case"end":{p=new S(d-c,i?0:(h-l)/2);break}default:{if(i)break;p=new S(0,(h-l)/2);break}}if(p){p.rot(s.rotation);const{x:f,y}=s;return{...s,x:f-p.x,y:y-p.y,props:{...s.props,w:d}}}else return{...s,props:{...s.props,w:d}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return W6.get(e.props,s=>Hb(this.editor,s))}getGeometry(e){const{scale:s}=e.props,{width:r,height:i}=this.getMinDimensions(e);return new cr({width:r*s,height:i*s,isFilled:!0,isLabel:!0})}component(e){const{id:s,props:{font:r,size:i,text:o,color:a,scale:c,textAlign:l}}=e,{width:d,height:h}=this.getMinDimensions(e),p=e.id===this.editor.getOnlySelectedShapeId(),f=es(),y=V6(s);return u.jsx(dh,{id:s,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:Bo[i],lineHeight:Lt.lineHeight,align:l,verticalAlign:"middle",text:o,labelColor:f[a].solid,isSelected:p,textWidth:d,textHeight:h,style:{transform:`scale(${c})`,transformOrigin:"top left"},wrap:!0,onKeyDown:y})}indicator(e){const s=this.editor.getShapeGeometry(e).bounds,r=N();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:u.jsx("rect",{width:$(s.width),height:$(s.height)})}toSvg(e,s){s.addExportDef(Uo(e.props.font)),e.props.text&&s.addExportDef(Uo(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,i=r.width/(e.props.scale??1),o=r.height/(e.props.scale??1),a=fr(s);return u.jsx(lh,{fontSize:Bo[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:a[e.props.color].solid,bounds:new Y(0,0,i,o),padding:0})}}g(Ad,"type","text"),g(Ad,"props",gI),g(Ad,"migrations",mI);function Hb(n,t){const{font:e,text:s,autoSize:r,size:i,w:o}=t,a=r?16:Math.max(16,o),c=Bo[i],l=r?null:Math.floor(Math.max(a,o)),d=n.textMeasure.measureText(s,{...Lt,fontFamily:Ts[e],fontSize:c,maxWidth:l});return r&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(c,d.h)}}function V6(n){const t=N();return v.useCallback(e=>{if(t.getEditingShapeId()===n)switch(e.key){case"Enter":{(e.ctrlKey||e.metaKey)&&t.complete();break}case"Tab":{Ee(e),e.shiftKey?zo.unindent(e.currentTarget):zo.indent(e.currentTarget);break}}},[t,n])}class jd extends aa{constructor(){super(...arguments);g(this,"canEdit",()=>!0);g(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:s}=this,r=s.getShapeGeometry(e).bounds.w*s.getZoomLevel()>=110,{asset:i,url:o}=JP(e.id,e.props.assetId,e.props.w),{time:a,playing:c}=e.props,l=oh(e.id),d=QP(),h=v.useRef(null),p=v.useCallback(b=>{const I=b.currentTarget;I&&s.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:I.currentTime}}])},[e.id,s]),f=v.useCallback(b=>{const I=b.currentTarget;I&&s.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:I.currentTime}}])},[e.id,s]),y=v.useCallback(b=>{const I=b.currentTarget;I&&l&&s.updateShapes([{type:"video",id:e.id,props:{time:I.currentTime}}])},[l,e.id,s]),[m,x]=v.useState(!1),w=v.useCallback(b=>{const I=b.currentTarget;I&&(a!==I.currentTime&&(I.currentTime=a),c||I.pause(),x(!0))},[c,a]);return v.useEffect(()=>{const b=h.current;b&&(m&&!l&&a!==b.currentTime&&(b.currentTime=a),l&&document.activeElement!==b&&b.focus())},[l,m,a]),v.useEffect(()=>{if(d){const b=h.current;if(!b)return;b.pause(),b.currentTime=0}},[h,d]),u.jsxs(u.Fragment,{children:[u.jsx(Oi,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:i?"transparent":"var(--color-low)",border:i?"none":"1px solid var(--color-low-border)"},children:u.jsx("div",{className:"tl-counter-scaled",children:u.jsx("div",{className:"tl-video-container",children:i!=null&&i.props.src?o?u.jsx("video",{ref:h,style:l?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:l&&r,onPlay:p,onPause:f,onTimeUpdate:y,onLoadedData:w,hidden:!m,children:u.jsx("source",{src:o})}):null:u.jsx(ZP,{})})})}),"url"in e.props&&e.props.url&&u.jsx(Ho,{url:e.props.url,zoomLevel:s.getZoomLevel()})]})}indicator(e){return u.jsx("rect",{width:$(e.props.w),height:$(e.props.h)})}toSvg(e){return u.jsx("image",{href:Y6(e.id),width:e.props.w,height:e.props.h})}}g(jd,"type","video"),g(jd,"props",yI),g(jd,"migrations",SI);function Y6(n){const t=n.split(":")[1],e=document.querySelector(`.tl-video-shape-${t}`);if(e){const s=document.createElement("canvas");return s.width=e.videoWidth,s.height=e.videoHeight,s.getContext("2d").drawImage(e,0,0),s.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const Iy=[Ad,vd,Cd,Ed,Md,kd,Pd,bd,_d,Id,Td,jd];function X6(n){return[n.sideEffects.registerAfterChangeHandler("instance_page_state",(t,e)=>{if(t.croppingShapeId!==e.croppingShapeId){const s=n.isIn("select.crop");!t.croppingShapeId&&e.croppingShapeId?s||n.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!e.croppingShapeId&&s&&n.setCurrentTool("select.idle")}t.editingShapeId!==e.editingShapeId&&(!t.editingShapeId&&e.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):t.editingShapeId&&!e.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))})]}class aE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"scribbleId","id");g(this,"markId","");g(this,"excludedShapeIds",new Set);g(this,"onEnter",e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:s}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const o=this.editor.getPointInShapeSpace(i,s);return this.editor.getShapeGeometry(i).bounds.containsPoint(o)}return!1}).map(i=>i.id));const r=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=r.id,this.update()});g(this,"pushPointToScribble",()=>{const{x:e,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,s)});g(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});g(this,"onPointerMove",()=>{this.update()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()})}update(){const{editor:e,excludedShapeIds:s}=this,r=e.getErasingShapeIds(),i=e.getZoomLevel(),o=e.getCurrentPageShapes(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=e;this.pushPointToScribble();const l=new Set(r),d=this.editor.options.hitTestMargin/i;for(const h of o){if(e.isShapeOfType(h,"group"))continue;const p=e.getShapeMask(h.id);if(p&&!On(a,p))continue;const f=e.getShapeGeometry(h),y=e.getShapePageTransform(h);if(!f||!y)continue;const m=y.clone().invert(),x=m.applyToPoint(c),w=m.applyToPoint(a),{bounds:b}=f;b.minX-d>Math.max(x.x,w.x)||b.minY-d>Math.max(x.y,w.y)||b.maxX+d<Math.min(x.x,w.x)||b.maxY+d<Math.min(x.y,w.y)||f.hitTestLineSegment(x,w,d)&&l.add(e.getOutermostSelectableShape(h).id)}this.editor.setErasingShapes([...l].filter(h=>!s.has(h)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}g(aE,"id","erasing");var Af;let q6=(Af=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(Af,"id","idle"),Af);var jf;let Z6=(jf=class extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{const e=this.editor.getZoomLevel(),s=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let a=s.length,c=a-1;c>=0;c--){const l=s[c];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const d=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(d,"frame")&&i.size>o)break;i.add(d.id)}}this.editor.setErasingShapes([...i])});g(this,"onLongPress",e=>{this.startErasing(e)});g(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startErasing(e)});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.cancel()})}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},g(jf,"id","pointing"),jf);class Dd extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}g(Dd,"id","eraser"),g(Dd,"initial","idle"),g(Dd,"children",()=>[q6,Z6,aE]);class cE extends ee{constructor(){super(...arguments);g(this,"initialCamera",new S);g(this,"onEnter",()=>{this.initialCamera=S.From(this.editor.getCamera()),this.update()});g(this,"onPointerMove",()=>{this.update()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.parent.transition("idle")});g(this,"onComplete",()=>{this.complete()})}update(){const{initialCamera:e,editor:s}=this,{currentScreenPoint:r,originScreenPoint:i}=s.inputs,o=S.Sub(r,i).div(s.getZoomLevel());o.len2()!==0&&s.setCamera(e.clone().add(o))}complete(){const{editor:e}=this,{pointerVelocity:s}=e.inputs,r=Math.min(s.len(),2);r>.1&&this.editor.slideCamera({speed:r,direction:s}),this.parent.transition("idle")}}g(cE,"id","dragging");var Df;let J6=(Df=class extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});g(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});g(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},g(Df,"id","idle"),Df);var Of;let Q6=(Of=class extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})});g(this,"onLongPress",()=>{this.startDragging()});g(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startDragging()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.complete()})}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},g(Of,"id","pointing"),Of);class Od extends ee{constructor(){super(...arguments);g(this,"onDoubleClick",e=>{if(e.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomIn(s,{animation:{duration:220,easing:It.easeOutQuint}})}});g(this,"onTripleClick",e=>{if(e.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomOut(s,{animation:{duration:320,easing:It.easeOutQuint}})}});g(this,"onQuadrupleClick",e=>{if(e.phase==="settle"){const s=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;s===1?this.editor.zoomToFit({animation:{duration:400,easing:It.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:It.easeOutQuint}})}})}}g(Od,"id","hand"),g(Od,"initial","idle"),g(Od,"children",()=>[J6,Q6,cE]);var Rf;let eK=(Rf=class extends ee{constructor(){super(...arguments);g(this,"onPointerDown",e=>{this.parent.transition("lasering",e)})}},g(Rf,"id","idle"),Rf);class lE extends ee{constructor(){super(...arguments);g(this,"scribbleId","id");g(this,"onEnter",()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()});g(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});g(this,"onPointerMove",()=>{this.pushPointToScribble()});g(this,"onPointerUp",()=>{this.complete()});g(this,"pushPointToScribble",()=>{const{x:e,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,s)});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}g(lE,"id","lasering");class Rd extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}g(Rd,"id","laser"),g(Rd,"initial","idle"),g(Rd,"children",()=>[eK,lE]);class dE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"initialSelectedShapeIds",[]);g(this,"excludedShapeIds",new Set);g(this,"isWrapMode",!1);g(this,"initialStartShape",null);g(this,"onEnter",e=>{const{altKey:s,currentPagePoint:r}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),s){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>this.editor.isShapeOfType(i,"group")||this.editor.isShapeOrAncestorLocked(i)).map(i=>i.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(r)[0],this.hitTestShapes()});g(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});g(this,"onTick",({elapsed:e})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(e)});g(this,"onPointerMove",()=>{this.hitTestShapes()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)});g(this,"onKeyDown",e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()});g(this,"onKeyUp",()=>{this.hitTestShapes()});g(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:s,isWrapMode:r}=this,{inputs:{originPagePoint:i,currentPagePoint:o,shiftKey:a,ctrlKey:c}}=e,l=new Set(a?this.initialSelectedShapeIds:[]),d=r?!c:c,h=Y.FromPoints([i,o]),{corners:p}=h;let f,y,m,x,w,b;const I=e.getCurrentPageShapes(),E=e.getCurrentPageId();e:for(let _=0,k=I.length;_<k;_++){if(m=I[_],s.has(m.id)||l.has(m.id)||(x=e.getShapePageBounds(m),!x))continue e;if(h.contains(x)){this.handleHit(m,o,E,l,p);continue e}if(d||e.isShapeOfType(m,"frame"))continue e;if(h.collides(x)){if(w=e.getShapePageTransform(m),!w)continue e;b=w.clone().invert().applyToPoints(p);const D=e.getShapeGeometry(m);t:for(let T=0;T<4;T++)if(f=b[T],y=b[(T+1)%4],D.hitTestLineSegment(f,y,0)){this.handleHit(m,o,E,l,p);break t}}}e.getInstanceState().isCoarsePointer;const P=e.getInstanceState().brush;(!P||!h.equals(P))&&e.updateInstanceState({brush:{...h.toJson()}});const C=e.getSelectedShapeIds();(C.length!==l.size||C.some(_=>!l.has(_)))&&e.setSelectedShapes(Array.from(l))}handleHit(e,s,r,i,o){if(e.parentId===r){i.add(e.id);return}const a=this.editor.getOutermostSelectableShape(e),c=this.editor.getShapeMask(a.id);c&&!iP(c,o)&&!On(s,c)||i.add(a.id)}}g(dE,"id","brushing");const Go={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class uE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e,this.updateCursor()});g(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startResizing()});g(this,"onLongPress",()=>{this.startResizing()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const e=this.editor.getSelectedShapes(),s=Go[this.info.handle];this.editor.setCursor({type:s,rotation:e.length===1?this.editor.getSelectionRotation():0})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}g(uE,"id","pointing_resize_handle");const Hn=8;class Py extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"markId","");g(this,"snapshot",{});g(this,"onEnter",e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});g(this,"onPointerMove",()=>{this.updateShapes()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const s=Go[this.info.handle];this.editor.setCursor({type:s,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:e,cursorHandleOffset:s}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;const i=e.props,o=this.editor.inputs.currentPagePoint.clone().sub(s),a=this.editor.inputs.originPagePoint.clone().sub(s),c=o.clone().sub(a).rot(-e.rotation),l=i.crop??this.getDefaultCrop(),d=Je(l),h=new S(e.x,e.y),p=new S(0,0),f=1/(l.bottomRight.x-l.topLeft.x)*i.w,y=1/(l.bottomRight.y-l.topLeft.y)*i.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(y<Hn)break;m=!0,d.topLeft.y=d.topLeft.y+c.y/y,y*(d.bottomRight.y-d.topLeft.y)<Hn?(d.topLeft.y=d.bottomRight.y-Hn/y,p.y=(d.topLeft.y-l.topLeft.y)*y):d.topLeft.y<=0?(d.topLeft.y=0,p.y=(d.topLeft.y-l.topLeft.y)*y):p.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(y<Hn)break;m=!0,d.bottomRight.y=Math.min(1,d.bottomRight.y+c.y/y),y*(d.bottomRight.y-d.topLeft.y)<Hn&&(d.bottomRight.y=d.topLeft.y+Hn/y);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<Hn)break;m=!0,d.topLeft.x=d.topLeft.x+c.x/f,f*(d.bottomRight.x-d.topLeft.x)<Hn?(d.topLeft.x=d.bottomRight.x-Hn/f,p.x=(d.topLeft.x-l.topLeft.x)*f):d.topLeft.x<=0?(d.topLeft.x=0,p.x=(d.topLeft.x-l.topLeft.x)*f):p.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<Hn)break;m=!0,d.bottomRight.x=Math.min(1,d.bottomRight.x+c.x/f),f*(d.bottomRight.x-d.topLeft.x)<Hn&&(d.bottomRight.x=d.topLeft.x+Hn/f);break}}if(!m)return;h.add(p.rot(e.rotation));const x={id:e.id,type:e.type,x:h.x,y:h.y,props:{crop:d,w:(d.bottomRight.x-d.topLeft.x)*f,h:(d.bottomRight.y-d.topLeft.y)*y}};this.editor.updateShapes([x]),this.updateCursor()}complete(){this.updateShapes(),Ne(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,r=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),o=S.RotWith(i.getHandlePoint(this.info.handle),i.point,e),a=S.Sub(s,o);return{shape:r,cursorHandleOffset:a}}}g(Py,"id","cropping");function Ey(n,t=!1){const e=n.getZoomLevel(),{inputs:{currentPagePoint:s}}=n;return n.getShapeAtPoint(s,{hitInside:!1,hitLabels:t,margin:n.options.hitTestMargin/e,renderingOnly:!0})??n.getSelectedShapeAtPoint(s)}function hE(n,t,e){if(!t)throw Error("Needs to translate a cropped shape!");const{crop:s}=t.props;if(!s)return;const r=n.inputs.shiftKey?Math.abs(e.x)<Math.abs(e.y)?"x":"y":null;r==="x"?e.x=0:r==="y"&&(e.y=0),e.rot(-t.rotation);const i=1/(s.bottomRight.x-s.topLeft.x)*t.props.w,o=1/(s.bottomRight.y-s.topLeft.y)*t.props.h,a=s.bottomRight.y-s.topLeft.y,c=s.bottomRight.x-s.topLeft.x,l=Je(s);return l.topLeft.x=Math.min(1-c,Math.max(0,l.topLeft.x-e.x/i)),l.topLeft.y=Math.min(1-a,Math.max(0,l.topLeft.y-e.y/o)),l.bottomRight.x=l.topLeft.x+c,l.bottomRight.y=l.topLeft.y+a,{id:t.id,type:t.type,props:{crop:l}}}var Lf;let tK=(Lf=class extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)});g(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});g(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});g(this,"onPointerDown",e=>{var s;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=Ey(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(s=this.editor.getShapeUtil(e.shape))!=null&&s.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}});g(this,"onDoubleClick",e=>{var o;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const s=this.editor.getCroppingShapeId();if(!s)return;const r=this.editor.getShape(s);if(!r)return;const i=this.editor.getShapeUtil(r);if(i){if(e.target==="selection"){(o=i.onDoubleClickEdge)==null||o.call(i,r);return}this.cancel(),this.editor.root.handleEvent(e)}});g(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});g(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});g(this,"onKeyUp",e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:s}}}=this,r=s.has("ShiftLeft"),i=new S(0,0);if(s.has("ArrowLeft")&&(i.x+=1),s.has("ArrowRight")&&(i.x-=1),s.has("ArrowUp")&&(i.y+=1),s.has("ArrowDown")&&(i.y-=1),i.equals(new S(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const a=hE(this.editor,o,i);a&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([a]))}},g(Lf,"id","idle"),Lf);class pE extends ee{constructor(){super(...arguments);g(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});g(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)});g(this,"onPointerUp",e=>{this.editor.setCurrentTool("select.crop.idle",e)})}}g(pE,"id","pointing_crop");class _y extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const s=this.editor.getSelectedShapes()[0];if(!s)return;const r=Go[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(s.id)});g(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)});g(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startCropping()});g(this,"onLongPress",()=>{this.startCropping()});g(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}g(_y,"id","pointing_crop_handle");class fE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"markId","translating crop");g(this,"snapshot",{});g(this,"onEnter",e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});g(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});g(this,"onPointerMove",()=>{this.updateShapes()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onKeyDown",e=>{switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}});g(this,"onKeyUp",e=>{switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:s,currentPagePoint:r}=this.editor.inputs,i=r.clone().sub(s),o=hE(this.editor,e,i);o&&this.editor.updateShapes([o])}}g(fE,"id","translating_crop");class Ld extends ee{constructor(){super(...arguments);g(this,"markId","");g(this,"onEnter",()=>{this.didCancel=!1,this.markId=this.editor.history.mark()});g(this,"didCancel",!1);g(this,"onExit",()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.history.squashToMark(this.markId)});g(this,"onCancel",()=>{this.didCancel=!0})}}g(Ld,"id","crop"),g(Ld,"initial","idle"),g(Ld,"children",()=>[tK,fE,pE,_y,Py]);class gE extends ee{constructor(){super(...arguments);g(this,"shapeId","");g(this,"initialHandle",{});g(this,"initialAdjacentHandle",null);g(this,"initialPagePoint",{});g(this,"markId","");g(this,"initialPageTransform");g(this,"initialPageRotation");g(this,"info",{});g(this,"isPrecise",!1);g(this,"isPreciseId",null);g(this,"pointingId",null);g(this,"onEnter",e=>{const{shape:s,isCreating:r,handle:i}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=s.id,this.markId=r?`creating:${s.id}`:"dragging handle",r||this.editor.mark(this.markId),this.initialHandle=Je(i),this.editor.isShapeOfType(s,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...s,props:{points:{...s.props.points,[i.index]:{id:i.index,index:i.index,x:i.x,y:i.y}}}});const l=this.editor.getShapeHandles(s).find(d=>d.index===i.index);this.initialHandle=Je(l)}this.initialPageTransform=this.editor.getShapePageTransform(s),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:r?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(s).sort(Xt),a=o.findIndex(c=>c.id===e.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<o.length;c++){const l=o[c];if(l.type==="vertex"&&l.id!=="middle"&&l.id!==e.handle.id){this.initialAdjacentHandle=l;break}}if(!this.initialAdjacentHandle)for(let c=o.length-1;c>=0;c--){const l=o[c];if(l.type==="vertex"&&l.id!=="middle"&&l.id!==e.handle.id){this.initialAdjacentHandle=l;break}}if(this.editor.isShapeOfType(s,"arrow")){const c=gn(this.editor,s)[e.handle.id];this.isPrecise=!1,c?(this.editor.setHintingShapes([c.toId]),this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)});g(this,"exactTimeout",-1);g(this,"onPointerMove",()=>{this.update()});g(this,"onKeyDown",()=>{this.update()});g(this,"onKeyUp",()=>{this.update()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.update(),this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),Ne(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var _;const{editor:e,shapeId:s,initialPagePoint:r}=this,{initialHandle:i,initialPageRotation:o,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:h,shiftKey:p,ctrlKey:f,altKey:y,pointerVelocity:m}}=e,x=this.info.shape,w=e.getShape(s);if(!w)return;const b=e.getShapeUtil(w);let I=h.clone().sub(r).rot(-o).add(i);if(p&&a&&i.id!=="middle"){const k=S.Angle(a,I),T=gu(k,24)-k;I=S.RotWith(I,a,T)}e.snaps.clearIndicators();let E={...i,x:I.x,y:I.y};if(i.canSnap&&(l?!f:f)){if(!e.getShapePageTransform(w.id))throw Error("Expected a page transform");const D=d.handles.snapHandle({currentShapeId:s,handle:E});D&&(D.nudge.rot(-e.getShapeParentTransform(w).rotation()),I.add(D.nudge),E={...i,x:I.x,y:I.y})}const P=(_=b.onHandleDrag)==null?void 0:_.call(b,w,{handle:E,isPrecise:this.isPrecise||y,initial:x}),C={id:w.id,type:w.type,...P};if(i.type==="vertex"&&this.editor.isShapeOfType(w,"arrow")){const k=gn(e,w)[i.id];k?c[0]!==k.toId&&(e.setHintingShapes([k.toId]),this.pointingId=k.toId,this.isPrecise=m.len()<.5||y,this.isPreciseId=this.isPrecise?k.toId:null,this.resetExactTimeout()):c.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}P&&e.updateShapes([C])}}g(gE,"id","dragging_handle");function mE(n){return n.isLabel?[n]:n instanceof ls?n.children.filter(t=>t.isLabel):[]}class yE extends ee{constructor(){super(...arguments);g(this,"hitShapeForPointerUp",null);g(this,"onEnter",()=>{const e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,er(this.editor),this.editor.select(e)});g(this,"onExit",()=>{var i;const{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null),er.cancel();const s=this.editor.getShape(e),r=this.editor.getShapeUtil(s);(i=r.onEditEnd)==null||i.call(r,s)});g(this,"onPointerMove",e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{er(this.editor);return}}});g(this,"onPointerDown",e=>{switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{const s=Ey(this.editor,!0);if(s){this.onPointerDown({...e,shape:s,target:"shape"});return}break}case"shape":{const{shape:s}=e,r=this.editor.getEditingShape();if(!r)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(s).getGeometry(s),o=mE(i),a=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(r,"text")&&r.props.text.trim()==="";if(a&&!c){const l=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(l,0)&&a.hitTestPoint(l)){if(s.id===r.id)return;this.hitShapeForPointerUp=s,this.editor.mark("editing on pointer up"),this.editor.select(s.id);return}}else{if(s.id===r.id)this.editor.isShapeOfType(s,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)});g(this,"onPointerUp",e=>{const s=this.hitShapeForPointerUp;if(!s)return;this.hitShapeForPointerUp=null;const r=this.editor.getShapeUtil(s);if(!s.isLocked){if(this.editor.getInstanceState().isReadonly&&!r.canEditInReadOnly(s)){this.parent.transition("pointing_shape",e);return}this.editor.select(s.id),this.editor.setEditingShape(s.id),er(this.editor)}});g(this,"onComplete",e=>{this.parent.transition("idle",e)});g(this,"onCancel",e=>{this.parent.transition("idle",e)})}}g(yE,"id","editing_shape");function Kb(n){const t=n.getOnlySelectedShape();return!!(t&&!n.isShapeOrAncestorLocked(t)&&n.getShapeUtil(t).canCrop(t))}function Pu(n){const t=n.getSelectedShapeIds(),{shiftKey:e,altKey:s,currentPagePoint:r}=n.inputs,i=n.getShapeAtPoint(r,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:o=>!o.isLocked});if(i){const o=n.getOutermostSelectableShape(i);if(e&&!s)n.cancelDoubleClick(),t.includes(o.id)?(n.mark("deselecting shape"),n.deselect(o)):(n.mark("shift selecting shape"),n.setSelectedShapes([...t,o.id]));else{let a;o===i||o.id===n.getFocusedGroupId()||t.includes(o.id)?a=i:a=o,a&&!t.includes(a.id)&&(n.mark("selecting shape"),n.select(a.id))}}else{if(e)return;{t.length>0&&(n.mark("selecting none"),n.selectNone());const o=n.getFocusedGroupId();if(pn(o)){const a=n.getShape(o);n.isPointInShape(a,r,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const nK=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var $f;let sK=($f=class extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),er(this.editor),this.editor.setCursor({type:"default",rotation:0})});g(this,"onExit",()=>{er.cancel()});g(this,"onPointerMove",()=>{er(this.editor)});g(this,"onPointerDown",e=>{if(this.editor.getIsMenuOpen())return;const s=e.ctrlKey&&Kb(this.editor);if(e.ctrlKey&&!s){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const r=Ey(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&Gb(this.editor,a)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{s?this.parent.transition("crop.pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}});g(this,"onDoubleClick",e=>{var s,r,i,o;if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const a=this.editor.getHoveredShape(),c=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),l=this.editor.getFocusedGroupId();if(c){if(this.editor.isShapeOfType(c,"group")){Pu(this.editor);return}else{const d=this.editor.getShape(c.parentId);if(d&&this.editor.isShapeOfType(d,"group")&&!(l&&d.id===l)){Pu(this.editor);return}}this.onDoubleClick({...e,shape:c,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const c=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const l=(s=c.onDoubleClickEdge)==null?void 0:s.call(c,a);if(l){this.editor.mark("double click edge"),this.editor.updateShapes([l]),Ne(this.editor,[a.id]);return}}if(c.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,e,!0)}break}case"shape":{const{shape:a}=e,c=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(c.onDoubleClick){const l=(r=c.onDoubleClick)==null?void 0:r.call(c,a);if(l){this.editor.updateShapes([l]);return}else if(c.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:c}=e,l=this.editor.getShapeUtil(a),d=(o=l.onDoubleClickHandle)==null?void 0:o.call(l,a,c);d?this.editor.updateShapes([d]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,e,!0)}}});g(this,"onRightClick",e=>{switch(e.target){case"canvas":{const s=this.editor.getHoveredShape(),r=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&Gb(this.editor,a)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:s}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,o=>!s.includes(o.id));s.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});g(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});g(this,"onKeyDown",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(ft.editOnType.get()&&!nK.includes(e.key)&&!e.altKey&&!e.ctrlKey){const s=this.editor.getOnlySelectedShape();if(s&&this.editor.isShapeOfType(s,"note")&&this.shouldStartEditingShape(s)){this.startEditingShape(s,{...e,target:"shape",shape:s},!0);return}}});g(this,"onKeyRepeat",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});g(this,"onKeyUp",e=>{switch(e.code){case"Enter":{const s=this.editor.getSelectedShapes();if(s.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(s.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}Kb(this.editor)&&this.parent.transition("crop",e);break}}});g(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,s,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),vu(this.editor,e,r),this.parent.transition("editing_shape",s))}isOverArrowLabelTest(e){if(!e)return!1;const s=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&On(s,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const s=Oe(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:s,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(s);if(!o)return;const a=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!a.canEditInReadOnly(o)||(this.editor.setEditingShape(s),this.editor.select(s),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:s}}}=this,r=s.has("ShiftLeft"),i=new S(0,0);if(s.has("ArrowLeft")&&(i.x-=1),s.has("ArrowRight")&&(i.x+=1),s.has("ArrowUp")&&(i.y-=1),s.has("ArrowDown")&&(i.y+=1),i.equals(new S(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),a=this.editor.getInstanceState().isGridMode?r?o*oK:o:r?rK:iK,c=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(c,i.mul(a)),Ne(this.editor,c)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},g($f,"id","idle"),$f);const rK=10,iK=1,oK=5;function Gb(n,t){const e=n.getSelectionRotatedPageBounds();if(!e)return!1;const s=n.getSelectionRotation();return s?On(t,e.corners.map(r=>S.RotWith(r,e.point,s))):e.containsPoint(t)}class SE extends ee{constructor(){super(...arguments);g(this,"shapeId","");g(this,"markId","");g(this,"wasAlreadySelected",!1);g(this,"didDrag",!1);g(this,"info",{});g(this,"onEnter",e=>{const{shape:s}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=s.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===s.id,this.updateCursor();const i=this.editor.getShapeGeometry(s).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${s.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(s,o);this._labelDragOffset=S.Sub(i.center,a),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});g(this,"_labelDragOffset",new S(0,0));g(this,"onPointerMove",()=>{const{isDragging:e}=this.editor.inputs;if(!e)return;const s=this.editor.getShape(this.shapeId);if(!s)return;const r=Ps(this.editor,s),i=this.editor.getShapeGeometry(s),o=i.children[0],a=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint),c=o.nearestPoint(S.Add(a,this._labelDragOffset));let l;if(r.isStraight){const d=S.Dist(r.start.point,r.end.point);l=1-S.Dist(r.end.point,c)/d}else{const{_center:d,measure:h,angleEnd:p,angleStart:f}=i.children[0];l=lg(h,f,p,d.angle(c))}isNaN(l)&&(l=.5),this.didDrag=!0,this.editor.updateShape({id:s.id,type:s.type,props:{labelPosition:l}})});g(this,"onPointerUp",()=>{const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}g(SE,"id","pointing_arrow_label");class wE extends ee{constructor(){super(...arguments);g(this,"onEnter",()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});g(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)});g(this,"onPointerUp",()=>{Pu(this.editor),this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}g(wE,"id","pointing_canvas");class xE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e;const{shape:s}=e;if(this.editor.isShapeOfType(s,"arrow")){const r=gn(this.editor,s)[e.handle.id];r&&this.editor.setHintingShapes([r.toId])}this.editor.setCursor({type:"grabbing",rotation:0})});g(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})});g(this,"onPointerUp",()=>{const{shape:e,handle:s}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:r}=this,i=Wb(r,e,s,!1);if(i){vu(r,i,!0);return}}this.parent.transition("idle",this.info)});g(this,"onPointerMove",()=>{const{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()});g(this,"onLongPress",()=>{this.startDraggingHandle()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}startDraggingHandle(){const{editor:e}=this;if(e.getInstanceState().isReadonly)return;const{shape:s,handle:r}=this.info;if(e.isShapeOfType(s,"note")){const i=Wb(e,s,r,!0);if(i){const o=e.getPointInParentSpace(i,e.inputs.originPagePoint).sub(S.Rot(ch.clone().mul(s.props.scale),i.rotation));e.updateShape({...i,x:o.x,y:o.y}),e.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{vu(e,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}g(xE,"id","pointing_handle");function Wb(n,t,e,s){const r=n.getShapePageTransform(t.id),i=r.point(),o=r.rotation(),c=$P(i,o,t.props.growY,0,t.props.scale)[e.index];if(c)return NP(n,t,c,o,s)}class bE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});g(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startRotating()});g(this,"onLongPress",()=>{this.startRotating()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:Go[this.info.handle],rotation:this.editor.getSelectionRotation()})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}g(bE,"id","pointing_rotate_handle");class vE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e});g(this,"onPointerUp",e=>{Pu(this.editor),this.parent.transition("idle",e)});g(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startTranslating(e)});g(this,"onLongPress",e=>{this.startTranslating(e)});g(this,"onDoubleClick",e=>{var i,o;const s=this.editor.getHoveredShape(),r=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(r){this.parent.transition("idle"),(o=(i=this.parent).onDoubleClick)==null||o.call(i,{...e,target:"shape",shape:this.editor.getShape(r)});return}});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}cancel(){this.parent.transition("idle")}}g(vE,"id","pointing_selection");class CE extends ee{constructor(){super(...arguments);g(this,"hitShape",{});g(this,"hitShapeForPointerUp",{});g(this,"isDoubleClick",!1);g(this,"didSelectOnEnter",!1);g(this,"onEnter",e=>{const s=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o,shiftKey:a,altKey:c}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;const l=this.editor.getOutermostSelectableShape(e.shape),d=this.editor.findShapeAncestor(l,h=>s.includes(h.id));if(this.editor.getShapeUtil(e.shape).onClick||l.id===i||s.includes(l.id)||d||s.length>1&&(r!=null&&r.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=l;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),s.includes(l.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...s,l.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([l.id]))});g(this,"onPointerUp",e=>{var d;const s=this.editor.getSelectedShapeIds(),r=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o,shiftKey:a}}=this.editor,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/i,hitInside:!0,renderingOnly:!0})??this.hitShape,l=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(l){const h=this.editor.getShapeUtil(l);if(h.onClick){const p=(d=h.onClick)==null?void 0:d.call(h,l);if(p){this.editor.mark("shape on click"),this.editor.updateShapes([p]),this.parent.transition("idle",e);return}}if(l.id===r){s.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const h=this.editor.getOutermostSelectableShape(c,p=>!s.includes(p.id));if(s.includes(h.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(s.includes(l.id)){if(s.length===1){const p=this.editor.getShapeUtil(l).getGeometry(l),f=mE(p),y=f.length===1?f[0]:void 0;if(y){const m=this.editor.getPointInShapeSpace(l,o);if(y.bounds.containsPoint(m,0)&&y.hitTestPoint(m)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);const x=this.editor.getShapeUtil(l);this.editor.getInstanceState().isReadonly&&!x.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l);else if(a){const p=this.editor.getShapeAncestors(h);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!p.find(y=>y.id===f)),h.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([h.id])}this.parent.transition("idle",e)});g(this,"onDoubleClick",()=>{this.isDoubleClick=!0});g(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startTranslating(e)});g(this,"onLongPress",e=>{this.startTranslating(e)});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.cancel()});g(this,"onInterrupt",()=>{this.cancel()})}startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",e))}cancel(){this.parent.transition("idle")}}g(CE,"id","pointing_shape");class IE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"markId","");g(this,"didHoldCommand",!1);g(this,"creationCursorOffset",{x:0,y:0});g(this,"snapshot",{});g(this,"onEnter",e=>{const{isCreating:s=!1,creationCursorOffset:r={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=r,this.snapshot=this._createSnapshot(),s?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});g(this,"onTick",({elapsed:e})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(e)});g(this,"onPointerMove",()=>{this.updateShapes()});g(this,"onKeyDown",()=>{this.updateShapes()});g(this,"onKeyUp",()=>{this.updateShapes()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()});g(this,"_createSnapshot",()=>{const e=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getSelectionRotatedPageBounds(),o=S.RotWith(i.getHandlePoint(this.info.handle),i.point,s),a=S.Sub(r,o),c=new Map,l=[];e.forEach(h=>{const p=this.editor.getShape(h);if(p){if(p.type==="frame"&&l.push({id:h,children:ge(this.editor.getSortedChildIdsForParent(p).map(f=>this.editor.getShape(f)))}),c.set(p.id,this._createShapeSnapshot(p)),this.editor.isShapeOfType(p,"frame")&&e.length===1)return;this.editor.visitDescendants(p.id,f=>{const y=this.editor.getShape(f);if(y&&(c.set(y.id,this._createShapeSnapshot(y)),this.editor.isShapeOfType(y,"frame")))return!1})}});const d=![...c.values()].some(h=>!vI(h.pageRotation,s)||h.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:i,cursorHandleOffset:a,selectionRotation:s,selectedShapeIds:e,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:l}});g(this,"_createShapeSnapshot",e=>{const s=this.editor.getShapePageTransform(e),r=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:s,pageRotation:Q.Decompose(s).rotation,isAspectRatioLocked:r.isAspectRatioLocked(e)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var e,s;if(Ne(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(s=(e=this.info).onCreate)==null||s.call(e,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,s=[];e.forEach(({shape:r})=>{var a;const i=this.editor.getShapeUtil(r),o=(a=i.onResizeStart)==null?void 0:a.call(i,r);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,s=[];e.forEach(({shape:r})=>{var c;const i=this.editor.getShape(r.id),o=this.editor.getShapeUtil(r),a=(c=o.onResizeEnd)==null?void 0:c.call(o,r,i);a&&s.push(a)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{altKey:e,shiftKey:s}=this.editor.inputs,{frames:r,shapeSnapshots:i,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:l,canShapesDeform:d}=this.snapshot;let h=s||!d;if(i.size===1){const k=[...i.values()][0];this.editor.isShapeOfType(k.shape,"text")&&(h=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:p}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),y=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!p){const{gridSize:k}=this.editor.getDocumentSettings();f.snapToGrid(k)}const m=this.info.handle,x=Vb(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!p:p)&&l%Ue===0){const{nudge:k}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:S.Sub(f,y),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Vb(m,l),isAspectRatioLocked:h,isResizingFromCenter:e});f.add(k)}const b=S.RotWith(e?o.center:o.getHandlePoint(x),o.point,l),I=S.Sub(f,b).rot(-l),E=S.Sub(y,b).rot(-l),P=S.DivV(I,E);Number.isFinite(P.x)||(P.x=1),Number.isFinite(P.y)||(P.y=1);const C=m==="top"||m==="bottom",_=m==="left"||m==="right";h?_?P.y=Math.abs(P.x):C?P.x=Math.abs(P.y):Math.abs(P.x)>Math.abs(P.y)?P.y=Math.abs(P.x)*(P.y<0?-1:1):P.x=Math.abs(P.y)*(P.x<0?-1:1):(C&&(P.x=1),_&&(P.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:P.x<0,isFlippedY:P.y<0,rotation:l});for(const k of i.keys()){const D=i.get(k);this.editor.resizeShape(k,P,{initialShape:D.shape,initialBounds:D.bounds,initialPageTransform:D.pageTransform,dragHandle:m,mode:c.length===1&&k===c[0]?"resize_bounds":"scale_shape",scaleOrigin:b,isAspectRatioLocked:h,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:k,children:D}of r){if(!D.length)continue;const T=i.get(k).shape,A=this.editor.getShape(k);if(!(T&&A))continue;const L=A.x-T.x,j=A.y-T.y,R=new S(L,j).rot(-T.rotation);if(R.x!==0||R.y!==0)for(const F of D)this.editor.updateShape({id:F.id,type:F.type,x:F.x-R.x,y:F.y-R.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:k}of r)if(k.length)for(const D of k)this.editor.updateShape({id:D.id,type:D.type,x:D.x,y:D.y})}}updateCursor({dragHandle:e,isFlippedX:s,isFlippedY:r,rotation:i}){const o={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{o.type="nwse-resize",s!==r&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",s!==r&&(o.type="nwse-resize");break}}o.rotation=i,this.editor.setCursor(o)}}g(IE,"id","resizing");const Up=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Vb(n,t){t=t%je;const e=Math.round(t/(_e/4)),s=Up.indexOf(n);return Up[(s+e)%Up.length]}const Yb=Math.PI/180;class PE extends ee{constructor(){super(...arguments);g(this,"snapshot",{});g(this,"info",{});g(this,"markId","");g(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const s=cP({editor:this.editor});if(!s)return this.parent.transition("idle",this.info);this.snapshot=s;const r=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ad({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Go[this.info.handle],rotation:r+this.snapshot.initialSelectionRotation})});g(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});g(this,"onPointerMove",()=>{this.update()});g(this,"onKeyDown",()=>{this.update()});g(this,"onKeyUp",()=>{this.update()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"update",()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ad({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Go[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation})});g(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});g(this,"complete",()=>{ad({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),Ne(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}_getRotationFromPointerPosition({snapToNearestDegree:e}){const s=this.editor.getSelectionRotation(),r=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:i,currentPagePoint:o}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:c}=this.snapshot;if(!r)return c;const d=r.center.clone().rotWith(r.point,s).angle(o)-a;let h=c+d;if(i)h=gu(h,24);else if(e&&(h=Math.round(h/Yb)*Yb,this.editor.getInstanceState().isCoarsePointer)){const p=gu(h,4),f=rd(h,p);Math.abs(f)<Az(5)&&(h=p)}return h-c}}g(PE,"id","rotating");class EE extends ee{constructor(){super(...arguments);g(this,"hits",new Set);g(this,"size",0);g(this,"scribbleId","id");g(this,"initialSelectedShapeIds",new Set);g(this,"newlySelectedShapeIds",new Set);g(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})});g(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});g(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});g(this,"onPointerUp",()=>{this.complete()});g(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});g(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});g(this,"onCancel",()=>{this.cancel()});g(this,"onComplete",()=>{this.complete()});g(this,"pushPointToScribble",()=>{const{x:e,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,s)})}updateScribbleSelection(e){const{editor:s}=this,r=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:i,originPagePoint:o,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:d}=this;e&&this.pushPointToScribble();const h=r;let p,f,y,m;const x=0;for(let I=0,E=h.length;I<E;I++){if(p=h[I],s.isShapeOfType(p,"group")||l.has(p.id)||s.isShapeOrAncestorLocked(p)||(f=s.getShapeGeometry(p),s.isShapeOfType(p,"frame")&&f.bounds.containsPoint(s.getPointInShapeSpace(p,o))))continue;const P=s.getShapePageTransform(p);if(!f||!P)continue;const C=P.clone().invert();y=C.applyToPoint(a),m=C.applyToPoint(c);const{bounds:_}=f;if(!(_.minX-x>Math.max(y.x,m.x)||_.minY-x>Math.max(y.y,m.y)||_.maxX+x<Math.min(y.x,m.x)||_.maxY+x<Math.min(y.y,m.y))&&f.hitTestLineSegment(y,m,x)){const k=this.editor.getOutermostSelectableShape(p),D=this.editor.getShapeMask(k.id);if(D&&ry(a,c,D)!==null&&!On(c,D))continue;l.add(k.id)}}const w=s.getSelectedShapeIds(),b=new Set(i?[...l,...d]:[...l]);(w.length!==b.size||w.some(I=>!b.has(I)))&&this.editor.setSelectedShapes(Array.from(b))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}g(EE,"id","scribble_brushing");const aK=20,cK=100;class lK{constructor(t){g(this,"prevDroppingShapeId",null);g(this,"droppingNodeTimer",null);g(this,"first",!0);g(this,"dispose",()=>{this.clear()});this.editor=t,t.disposables.add(this.dispose)}updateDroppingNode(t,e){var s;this.first&&(this.editor.setHintingShapes(t.map(r=>this.editor.findShapeAncestor(r,i=>i.type!=="group")).filter(r=>r)),this.prevDroppingShapeId=((s=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,t))==null?void 0:s.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(t,aK,e):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(t,cK,e))}setDragTimer(t,e,s){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,t,s)}),this.droppingNodeTimer=null},e)}handleDrag(t,e,s){var c,l,d,h,p;e=ge(e.map(f=>this.editor.getShape(f.id)));const r=((c=this.editor.getDroppingOverShape(t,e))==null?void 0:c.id)??null;if(r===this.prevDroppingShapeId){this.hintParents(e);return}const{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),a=r&&this.editor.getShape(r);o&&((d=(l=this.editor.getShapeUtil(o)).onDragShapesOut)==null||d.call(l,o,e)),a&&((p=(h=this.editor.getShapeUtil(a)).onDragShapesOver)==null||p.call(h,a,e)),this.hintParents(e),s==null||s(),this.prevDroppingShapeId=r}hintParents(t){const e=new Map;for(const r of t){const i=this.editor.findShapeAncestor(r,o=>o.type!=="group");i&&(e.has(i.id)||e.set(i.id,[]),e.get(i.id).push(r.id))}const s=[];for(const[r,i]of e){const o=this.editor.getShape(r);o&&OP(this.editor,o).length<i.length&&s.push(o.id)}this.editor.setHintingShapes(s)}dropShapes(t){var s,r;const{prevDroppingShapeId:e}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,t),e){const i=this.editor.getShape(e);if(!i)return;(r=(s=this.editor.getShapeUtil(i)).onDropShapesOver)==null||r.call(s,i,t)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class _E extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"selectionSnapshot",{});g(this,"snapshot",{});g(this,"markId","");g(this,"isCloning",!1);g(this,"isCreating",!1);g(this,"onCreate",()=>{});g(this,"dragAndDropManager",new lK(this.editor));g(this,"onEnter",e=>{var i;const{isCreating:s=!1,onCreate:r=()=>{}}=e;if(!((i=this.editor.getSelectedShapeIds())!=null&&i.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=s,this.onCreate=r,s?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=Xb(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()});g(this,"onTick",({elapsed:e})=>{const{editor:s}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),s.edgeScrollManager.updateEdgeScrolling(e)});g(this,"onPointerMove",()=>{this.updateShapes()});g(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});g(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onComplete",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()});g(this,"updateParentTransforms",()=>{const{editor:e,snapshot:{shapeSnapshots:s}}=this;s.forEach(r=>{const i=e.getShape(r.shape.id);if(!i)return null;const o=un(i.parentId)?null:Q.Inverse(e.getShapePageTransform(i.parentId));r.parentTransform=o})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=Xb(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),Ne(this.editor,this.snapshot.movingShapes.map(s=>s.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,s=[];e.forEach(r=>{var a;const i=this.editor.getShapeUtil(r),o=(a=i.onTranslateStart)==null?void 0:a.call(i,r);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=S.Average(e.map(o=>this.editor.getShapePageTransform(o.id).point())),i=S.Sub(r,this.selectionSnapshot.averagePagePoint);S.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(o=>o.id),offset:{x:i.x,y:i.y}}})}const s=[];e.forEach(r=>{var c;const i=this.editor.getShape(r.id),o=this.editor.getShapeUtil(r),a=(c=o.onTranslateEnd)==null?void 0:c.call(o,r,i);a&&s.push(a)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),dK({editor:this.editor,snapshot:e});const{movingShapes:s}=e,r=[];s.forEach(i=>{var l;const o=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i),c=(l=a.onTranslate)==null?void 0:l.call(a,i,o);c&&r.push(c)}),r.length>0&&this.editor.updateShapes(r)}}g(_E,"id","translating");function Xb(n){var h;const t=[],e=[],s=n.getSelectedShapeIds(),r=ge(s.map(p=>{const f=n.getShape(p);if(!f)return null;t.push(f);const y=n.getShapePageTransform(p),m=y.point(),x=y.rotation();e.push(m);const w=ar.isId(f.parentId)?null:Q.Inverse(n.getShapePageTransform(f.parentId));return{shape:f,pagePoint:m,pageRotation:x,parentTransform:w}})),i=n.getOnlySelectedShape();let o=[];if(i)o=n.snaps.shapeBounds.getSnapPoints(i.id);else{const p=n.getSelectionPageBounds();p&&(o=p.cornersAndCenter.map((f,y)=>({id:"selection:"+y,x:f.x,y:f.y})))}let a,c;const{originPagePoint:l}=n.inputs,d=r.filter(p=>n.isShapeOfType(p.shape,"note")&&n.isPointInShape(p.shape,l));if(d.length!==0)if(d.length===1)c=d[0];else{const p=n.getCurrentPageShapesSorted();c=(h=d.map(f=>({snapshot:f,index:p.findIndex(y=>y.id===f.shape.id)})).sort((f,y)=>y.index-f.index)[0])==null?void 0:h.snapshot}return c&&(a=FP(n,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:S.Average(e),movingShapes:t,shapeSnapshots:r,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:c}}function dK({editor:n,snapshot:t}){const{inputs:e}=n,{noteSnapshot:s,noteAdjacentPositions:r,initialPageBounds:i,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:c}=t,l=n.getInstanceState().isGridMode,d=n.getDocumentSettings().gridSize,h=S.Sub(e.currentPagePoint,e.originPagePoint),p=n.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;if(p==="x"?h.x=0:p==="y"&&(h.y=0),n.snaps.clearIndicators(),(n.user.getIsSnapMode()?!e.ctrlKey:e.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:x}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:i,lockedAxis:p,initialSelectionSnapPoints:o});h.add(x)}else if(s&&r){const{scale:x}=s.shape.props,w=s.pagePoint.clone().add(h).add(ch.clone().mul(x).rot(s.pageRotation));let b=LP/n.getZoomLevel(),I=new S(0,0);for(const E of r){const P=S.Sub(w,E),C=P.len();C<b&&(b=C,I=P)}h.sub(I)}const y=S.Add(c,h);l&&!e.ctrlKey&&y.snapToGrid(d);const m=S.Sub(y,c);n.updateShapes(ge(a.map(({shape:x,pagePoint:w,parentTransform:b})=>{const I=S.Add(w,m),E=b?Q.applyToPoint(b,I):I;return{id:x.id,type:x.type,x:E.x,y:E.y}})))}class $d extends ee{constructor(){super(...arguments);g(this,"reactor");g(this,"cleanUpDuplicateProps",()=>{const e=this.editor.getSelectedShapeIds(),s=this.editor.getInstanceState();if(!s.duplicateProps)return;const r=new Set(s.duplicateProps.shapeIds);e.length===r.size&&e.every(i=>r.has(i))||this.editor.updateInstanceState({duplicateProps:null})});g(this,"onEnter",()=>{this.reactor=ei("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){typeof process<"u",console.error(e)}})});g(this,"onExit",()=>{var e;(e=this.reactor)==null||e.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}g($d,"id","select"),g($d,"initial","idle"),g($d,"children",()=>[Ld,Py,sK,wE,CE,_E,dE,EE,_y,vE,uE,yE,IE,PE,bE,SE,xE,gE]);class TE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e});g(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}g(TE,"id","idle");class kE extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e});g(this,"onPointerUp",()=>{this.complete()});g(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});g(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}g(kE,"id","pointing");class ME extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"zoomBrush",new Y);g(this,"onEnter",e=>{this.info=e,this.update()});g(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});g(this,"onPointerMove",()=>{this.update()});g(this,"onPointerUp",()=>{this.complete()});g(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:e,currentPagePoint:s}}=this.editor;this.zoomBrush.setTo(Y.FromPoints([e,s])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,s=8/this.editor.getZoomLevel();if(e.width<s&&e.height<s){const r=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(r,{animation:{duration:220}}):this.editor.zoomIn(r,{animation:{duration:220}})}else{const r=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:r,animation:{duration:220}})}this.parent.transition("idle",this.info)}}g(ME,"id","zoom_brushing");class Fd extends ee{constructor(){super(...arguments);g(this,"info",{});g(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()});g(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)});g(this,"onKeyDown",()=>{this.updateCursor()});g(this,"onKeyUp",e=>{this.updateCursor(),e.code==="KeyZ"&&this.complete()});g(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}g(Fd,"id","zoom"),g(Fd,"initial","idle"),g(Fd,"children",()=>[TE,ME,kE]);const uK=[Dd,Od,Rd,Fd,$d];function J(n,t,{checkForDefaultPrevented:e=!0}={}){return function(r){if(n==null||n(r),e===!1||!r.defaultPrevented)return t==null?void 0:t(r)}}function hK(n,t){typeof n=="function"?n(t):n!=null&&(n.current=t)}function hh(...n){return t=>n.forEach(e=>hK(e,t))}function He(...n){return v.useCallback(hh(...n),n)}function pK(n,t){const e=v.createContext(t);function s(i){const{children:o,...a}=i,c=v.useMemo(()=>a,Object.values(a));return u.jsx(e.Provider,{value:c,children:o})}function r(i){const o=v.useContext(e);if(o)return o;if(t!==void 0)return t;throw new Error(`\`${i}\` must be used within \`${n}\``)}return s.displayName=n+"Provider",[s,r]}function Bs(n,t=[]){let e=[];function s(i,o){const a=v.createContext(o),c=e.length;e=[...e,o];function l(h){const{scope:p,children:f,...y}=h,m=(p==null?void 0:p[n][c])||a,x=v.useMemo(()=>y,Object.values(y));return u.jsx(m.Provider,{value:x,children:f})}function d(h,p){const f=(p==null?void 0:p[n][c])||a,y=v.useContext(f);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,d]}const r=()=>{const i=e.map(o=>v.createContext(o));return function(a){const c=(a==null?void 0:a[n])||i;return v.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return r.scopeName=n,[s,fK(r,...t)]}function fK(...n){const t=n[0];if(n.length===1)return t;const e=()=>{const s=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(i){const o=s.reduce((a,{useScope:c,scopeName:l})=>{const h=c(i)[`__scope${l}`];return{...a,...h}},{});return v.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return e.scopeName=t.scopeName,e}var Gr=globalThis!=null&&globalThis.document?v.useLayoutEffect:()=>{},gK=$A.useId||(()=>{}),mK=0;function rr(n){const[t,e]=v.useState(gK());return Gr(()=>{n||e(s=>s??String(mK++))},[n]),n||(t?`radix-${t}`:"")}function Ft(n){const t=v.useRef(n);return v.useEffect(()=>{t.current=n}),v.useMemo(()=>(...e)=>{var s;return(s=t.current)==null?void 0:s.call(t,...e)},[])}function ni({prop:n,defaultProp:t,onChange:e=()=>{}}){const[s,r]=yK({defaultProp:t,onChange:e}),i=n!==void 0,o=i?n:s,a=Ft(e),c=v.useCallback(l=>{if(i){const h=typeof l=="function"?l(n):l;h!==n&&a(h)}else r(l)},[i,n,r,a]);return[o,c]}function yK({defaultProp:n,onChange:t}){const e=v.useState(n),[s]=e,r=v.useRef(s),i=Ft(t);return v.useEffect(()=>{r.current!==s&&(i(s),r.current=s)},[s,r,i]),e}var Li=v.forwardRef((n,t)=>{const{children:e,...s}=n,r=v.Children.toArray(e),i=r.find(wK);if(i){const o=i.props.children,a=r.map(c=>c===i?v.Children.count(o)>1?v.Children.only(null):v.isValidElement(o)?o.props.children:null:c);return u.jsx(Tg,{...s,ref:t,children:v.isValidElement(o)?v.cloneElement(o,void 0,a):null})}return u.jsx(Tg,{...s,ref:t,children:e})});Li.displayName="Slot";var Tg=v.forwardRef((n,t)=>{const{children:e,...s}=n;if(v.isValidElement(e)){const r=bK(e);return v.cloneElement(e,{...xK(s,e.props),ref:t?hh(t,r):r})}return v.Children.count(e)>1?v.Children.only(null):null});Tg.displayName="SlotClone";var SK=({children:n})=>u.jsx(u.Fragment,{children:n});function wK(n){return v.isValidElement(n)&&n.type===SK}function xK(n,t){const e={...t};for(const s in t){const r=n[s],i=t[s];/^on[A-Z]/.test(s)?r&&i?e[s]=(...a)=>{i(...a),r(...a)}:r&&(e[s]=r):s==="style"?e[s]={...r,...i}:s==="className"&&(e[s]=[r,i].filter(Boolean).join(" "))}return{...n,...e}}function bK(n){var s,r;let t=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?n.ref:(t=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?n.props.ref:n.props.ref||n.ref)}var vK=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Ie=vK.reduce((n,t)=>{const e=v.forwardRef((s,r)=>{const{asChild:i,...o}=s,a=i?Li:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(a,{...o,ref:r})});return e.displayName=`Primitive.${t}`,{...n,[t]:e}},{});function Ty(n,t){n&&Ic.flushSync(()=>n.dispatchEvent(t))}function CK(n,t=globalThis==null?void 0:globalThis.document){const e=Ft(n);v.useEffect(()=>{const s=r=>{r.key==="Escape"&&e(r)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[e,t])}var IK="DismissableLayer",kg="dismissableLayer.update",PK="dismissableLayer.pointerDownOutside",EK="dismissableLayer.focusOutside",qb,AE=v.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),zc=v.forwardRef((n,t)=>{const{disableOutsidePointerEvents:e=!1,onEscapeKeyDown:s,onPointerDownOutside:r,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...c}=n,l=v.useContext(AE),[d,h]=v.useState(null),p=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=v.useState({}),y=He(t,_=>h(_)),m=Array.from(l.layers),[x]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),w=m.indexOf(x),b=d?m.indexOf(d):-1,I=l.layersWithOutsidePointerEventsDisabled.size>0,E=b>=w,P=TK(_=>{const k=_.target,D=[...l.branches].some(T=>T.contains(k));!E||D||(r==null||r(_),o==null||o(_),_.defaultPrevented||a==null||a())},p),C=kK(_=>{const k=_.target;[...l.branches].some(T=>T.contains(k))||(i==null||i(_),o==null||o(_),_.defaultPrevented||a==null||a())},p);return CK(_=>{b===l.layers.size-1&&(s==null||s(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},p),v.useEffect(()=>{if(d)return e&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(qb=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),Zb(),()=>{e&&l.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=qb)}},[d,p,e,l]),v.useEffect(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),Zb())},[d,l]),v.useEffect(()=>{const _=()=>f({});return document.addEventListener(kg,_),()=>document.removeEventListener(kg,_)},[]),u.jsx(Ie.div,{...c,ref:y,style:{pointerEvents:I?E?"auto":"none":void 0,...n.style},onFocusCapture:J(n.onFocusCapture,C.onFocusCapture),onBlurCapture:J(n.onBlurCapture,C.onBlurCapture),onPointerDownCapture:J(n.onPointerDownCapture,P.onPointerDownCapture)})});zc.displayName=IK;var _K="DismissableLayerBranch",jE=v.forwardRef((n,t)=>{const e=v.useContext(AE),s=v.useRef(null),r=He(t,s);return v.useEffect(()=>{const i=s.current;if(i)return e.branches.add(i),()=>{e.branches.delete(i)}},[e.branches]),u.jsx(Ie.div,{...n,ref:r})});jE.displayName=_K;function TK(n,t=globalThis==null?void 0:globalThis.document){const e=Ft(n),s=v.useRef(!1),r=v.useRef(()=>{});return v.useEffect(()=>{const i=a=>{if(a.target&&!s.current){let c=function(){DE(PK,e,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",r.current),r.current=c,t.addEventListener("click",r.current,{once:!0})):c()}else t.removeEventListener("click",r.current);s.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",i),t.removeEventListener("click",r.current)}},[t,e]),{onPointerDownCapture:()=>s.current=!0}}function kK(n,t=globalThis==null?void 0:globalThis.document){const e=Ft(n),s=v.useRef(!1);return v.useEffect(()=>{const r=i=>{i.target&&!s.current&&DE(EK,e,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",r),()=>t.removeEventListener("focusin",r)},[t,e]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function Zb(){const n=new CustomEvent(kg);document.dispatchEvent(n)}function DE(n,t,e,{discrete:s}){const r=e.originalEvent.target,i=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:e});t&&r.addEventListener(n,t,{once:!0}),s?Ty(r,i):r.dispatchEvent(i)}var MK=zc,AK=jE,Hp="focusScope.autoFocusOnMount",Kp="focusScope.autoFocusOnUnmount",Jb={bubbles:!1,cancelable:!0},jK="FocusScope",ph=v.forwardRef((n,t)=>{const{loop:e=!1,trapped:s=!1,onMountAutoFocus:r,onUnmountAutoFocus:i,...o}=n,[a,c]=v.useState(null),l=Ft(r),d=Ft(i),h=v.useRef(null),p=He(t,m=>c(m)),f=v.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;v.useEffect(()=>{if(s){let m=function(I){if(f.paused||!a)return;const E=I.target;a.contains(E)?h.current=E:Tr(h.current,{select:!0})},x=function(I){if(f.paused||!a)return;const E=I.relatedTarget;E!==null&&(a.contains(E)||Tr(h.current,{select:!0}))},w=function(I){if(document.activeElement===document.body)for(const P of I)P.removedNodes.length>0&&Tr(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",x);const b=new MutationObserver(w);return a&&b.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",x),b.disconnect()}}},[s,a,f.paused]),v.useEffect(()=>{if(a){ev.add(f);const m=document.activeElement;if(!a.contains(m)){const w=new CustomEvent(Hp,Jb);a.addEventListener(Hp,l),a.dispatchEvent(w),w.defaultPrevented||(DK(FK(OE(a)),{select:!0}),document.activeElement===m&&Tr(a))}return()=>{a.removeEventListener(Hp,l),setTimeout(()=>{const w=new CustomEvent(Kp,Jb);a.addEventListener(Kp,d),a.dispatchEvent(w),w.defaultPrevented||Tr(m??document.body,{select:!0}),a.removeEventListener(Kp,d),ev.remove(f)},0)}}},[a,l,d,f]);const y=v.useCallback(m=>{if(!e&&!s||f.paused)return;const x=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,w=document.activeElement;if(x&&w){const b=m.currentTarget,[I,E]=OK(b);I&&E?!m.shiftKey&&w===E?(m.preventDefault(),e&&Tr(I,{select:!0})):m.shiftKey&&w===I&&(m.preventDefault(),e&&Tr(E,{select:!0})):w===b&&m.preventDefault()}},[e,s,f.paused]);return u.jsx(Ie.div,{tabIndex:-1,...o,ref:p,onKeyDown:y})});ph.displayName=jK;function DK(n,{select:t=!1}={}){const e=document.activeElement;for(const s of n)if(Tr(s,{select:t}),document.activeElement!==e)return}function OK(n){const t=OE(n),e=Qb(t,n),s=Qb(t.reverse(),n);return[e,s]}function OE(n){const t=[],e=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)t.push(e.currentNode);return t}function Qb(n,t){for(const e of n)if(!RK(e,{upTo:t}))return e}function RK(n,{upTo:t}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(t!==void 0&&n===t)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function LK(n){return n instanceof HTMLInputElement&&"select"in n}function Tr(n,{select:t=!1}={}){if(n&&n.focus){const e=document.activeElement;n.focus({preventScroll:!0}),n!==e&&LK(n)&&t&&n.select()}}var ev=$K();function $K(){let n=[];return{add(t){const e=n[0];t!==e&&(e==null||e.pause()),n=tv(n,t),n.unshift(t)},remove(t){var e;n=tv(n,t),(e=n[0])==null||e.resume()}}}function tv(n,t){const e=[...n],s=e.indexOf(t);return s!==-1&&e.splice(s,1),e}function FK(n){return n.filter(t=>t.tagName!=="A")}var NK="Portal",Uc=v.forwardRef((n,t)=>{var a;const{container:e,...s}=n,[r,i]=v.useState(!1);Gr(()=>i(!0),[]);const o=e||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?FA.createPortal(u.jsx(Ie.div,{...s,ref:t}),o):null});Uc.displayName=NK;function BK(n,t){return v.useReducer((e,s)=>t[e][s]??e,n)}var ps=n=>{const{present:t,children:e}=n,s=zK(t),r=typeof e=="function"?e({present:s.isPresent}):v.Children.only(e),i=He(s.ref,UK(r));return typeof e=="function"||s.isPresent?v.cloneElement(r,{ref:i}):null};ps.displayName="Presence";function zK(n){const[t,e]=v.useState(),s=v.useRef({}),r=v.useRef(n),i=v.useRef("none"),o=n?"mounted":"unmounted",[a,c]=BK(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return v.useEffect(()=>{const l=Ll(s.current);i.current=a==="mounted"?l:"none"},[a]),Gr(()=>{const l=s.current,d=r.current;if(d!==n){const p=i.current,f=Ll(l);n?c("MOUNT"):f==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(d&&p!==f?"ANIMATION_OUT":"UNMOUNT"),r.current=n}},[n,c]),Gr(()=>{if(t){const l=h=>{const f=Ll(s.current).includes(h.animationName);h.target===t&&f&&Ic.flushSync(()=>c("ANIMATION_END"))},d=h=>{h.target===t&&(i.current=Ll(s.current))};return t.addEventListener("animationstart",d),t.addEventListener("animationcancel",l),t.addEventListener("animationend",l),()=>{t.removeEventListener("animationstart",d),t.removeEventListener("animationcancel",l),t.removeEventListener("animationend",l)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:v.useCallback(l=>{l&&(s.current=getComputedStyle(l)),e(l)},[])}}function Ll(n){return(n==null?void 0:n.animationName)||"none"}function UK(n){var s,r;let t=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,e=t&&"isReactWarning"in t&&t.isReactWarning;return e?n.ref:(t=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,e=t&&"isReactWarning"in t&&t.isReactWarning,e?n.props.ref:n.props.ref||n.ref)}var Gp=0;function ky(){v.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??nv()),document.body.insertAdjacentElement("beforeend",n[1]??nv()),Gp++,()=>{Gp===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Gp--}},[])}function nv(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var Nd="right-scroll-bar-position",Bd="width-before-scroll-bar",HK="with-scroll-bars-hidden",KK="--removed-body-scroll-bar-size";function Wp(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function GK(n,t){var e=v.useState(function(){return{value:n,callback:t,facade:{get current(){return e.value},set current(s){var r=e.value;r!==s&&(e.value=s,e.callback(s,r))}}}})[0];return e.callback=t,e.facade}var WK=typeof window<"u"?v.useLayoutEffect:v.useEffect,sv=new WeakMap;function VK(n,t){var e=GK(null,function(s){return n.forEach(function(r){return Wp(r,s)})});return WK(function(){var s=sv.get(e);if(s){var r=new Set(s),i=new Set(n),o=e.current;r.forEach(function(a){i.has(a)||Wp(a,null)}),i.forEach(function(a){r.has(a)||Wp(a,o)})}sv.set(e,n)},[n]),e}function YK(n){return n}function XK(n,t){t===void 0&&(t=YK);var e=[],s=!1,r={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return e.length?e[e.length-1]:n},useMedium:function(i){var o=t(i,s);return e.push(o),function(){e=e.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(s=!0;e.length;){var o=e;e=[],o.forEach(i)}e={push:function(a){return i(a)},filter:function(){return e}}},assignMedium:function(i){s=!0;var o=[];if(e.length){var a=e;e=[],a.forEach(i),o=e}var c=function(){var d=o;o=[],d.forEach(i)},l=function(){return Promise.resolve().then(c)};l(),e={push:function(d){o.push(d),l()},filter:function(d){return o=o.filter(d),e}}}};return r}function qK(n){n===void 0&&(n={});var t=XK(null);return t.options=kr({async:!0,ssr:!1},n),t}var RE=function(n){var t=n.sideCar,e=e0(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return v.createElement(s,kr({},e))};RE.isSideCarExport=!0;function ZK(n,t){return n.useMedium(t),RE}var LE=qK(),Vp=function(){},fh=v.forwardRef(function(n,t){var e=v.useRef(null),s=v.useState({onScrollCapture:Vp,onWheelCapture:Vp,onTouchMoveCapture:Vp}),r=s[0],i=s[1],o=n.forwardProps,a=n.children,c=n.className,l=n.removeScrollBar,d=n.enabled,h=n.shards,p=n.sideCar,f=n.noIsolation,y=n.inert,m=n.allowPinchZoom,x=n.as,w=x===void 0?"div":x,b=n.gapMode,I=e0(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),E=p,P=VK([e,t]),C=kr(kr({},I),r);return v.createElement(v.Fragment,null,d&&v.createElement(E,{sideCar:LE,removeScrollBar:l,shards:h,noIsolation:f,inert:y,setCallbacks:i,allowPinchZoom:!!m,lockRef:e,gapMode:b}),o?v.cloneElement(v.Children.only(a),kr(kr({},C),{ref:P})):v.createElement(w,kr({},C,{className:c,ref:P}),a))});fh.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};fh.classNames={fullWidth:Bd,zeroRight:Nd};var JK=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function QK(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=JK();return t&&n.setAttribute("nonce",t),n}function e7(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function t7(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var n7=function(){var n=0,t=null;return{add:function(e){n==0&&(t=QK())&&(e7(t,e),t7(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},s7=function(){var n=n7();return function(t,e){v.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&e])}},$E=function(){var n=s7(),t=function(e){var s=e.styles,r=e.dynamic;return n(s,r),null};return t},r7={left:0,top:0,right:0,gap:0},Yp=function(n){return parseInt(n||"",10)||0},i7=function(n){var t=window.getComputedStyle(document.body),e=t[n==="padding"?"paddingLeft":"marginLeft"],s=t[n==="padding"?"paddingTop":"marginTop"],r=t[n==="padding"?"paddingRight":"marginRight"];return[Yp(e),Yp(s),Yp(r)]},o7=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return r7;var t=i7(n),e=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-e+t[2]-t[0])}},a7=$E(),Ao="data-scroll-locked",c7=function(n,t,e,s){var r=n.left,i=n.top,o=n.right,a=n.gap;return e===void 0&&(e="margin"),`
  .`.concat(HK,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(a,"px ").concat(s,`;
  }
  body[`).concat(Ao,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),e==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(s,`;
    `),e==="padding"&&"padding-right: ".concat(a,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Nd,` {
    right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(Bd,` {
    margin-right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(Nd," .").concat(Nd,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(Bd," .").concat(Bd,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Ao,`] {
    `).concat(KK,": ").concat(a,`px;
  }
`)},rv=function(){var n=parseInt(document.body.getAttribute(Ao)||"0",10);return isFinite(n)?n:0},l7=function(){v.useEffect(function(){return document.body.setAttribute(Ao,(rv()+1).toString()),function(){var n=rv()-1;n<=0?document.body.removeAttribute(Ao):document.body.setAttribute(Ao,n.toString())}},[])},d7=function(n){var t=n.noRelative,e=n.noImportant,s=n.gapMode,r=s===void 0?"margin":s;l7();var i=v.useMemo(function(){return o7(r)},[r]);return v.createElement(a7,{styles:c7(i,!t,r,e?"":"!important")})},Mg=!1;if(typeof window<"u")try{var $l=Object.defineProperty({},"passive",{get:function(){return Mg=!0,!0}});window.addEventListener("test",$l,$l),window.removeEventListener("test",$l,$l)}catch{Mg=!1}var oo=Mg?{passive:!1}:!1,u7=function(n){return n.tagName==="TEXTAREA"},FE=function(n,t){var e=window.getComputedStyle(n);return e[t]!=="hidden"&&!(e.overflowY===e.overflowX&&!u7(n)&&e[t]==="visible")},h7=function(n){return FE(n,"overflowY")},p7=function(n){return FE(n,"overflowX")},iv=function(n,t){var e=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var r=NE(n,s);if(r){var i=BE(n,s),o=i[1],a=i[2];if(o>a)return!0}s=s.parentNode}while(s&&s!==e.body);return!1},f7=function(n){var t=n.scrollTop,e=n.scrollHeight,s=n.clientHeight;return[t,e,s]},g7=function(n){var t=n.scrollLeft,e=n.scrollWidth,s=n.clientWidth;return[t,e,s]},NE=function(n,t){return n==="v"?h7(t):p7(t)},BE=function(n,t){return n==="v"?f7(t):g7(t)},m7=function(n,t){return n==="h"&&t==="rtl"?-1:1},y7=function(n,t,e,s,r){var i=m7(n,window.getComputedStyle(t).direction),o=i*s,a=e.target,c=t.contains(a),l=!1,d=o>0,h=0,p=0;do{var f=BE(n,a),y=f[0],m=f[1],x=f[2],w=m-x-i*y;(y||w)&&NE(n,a)&&(h+=w,p+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(t.contains(a)||t===a));return(d&&(Math.abs(h)<1||!r)||!d&&(Math.abs(p)<1||!r))&&(l=!0),l},Fl=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},ov=function(n){return[n.deltaX,n.deltaY]},av=function(n){return n&&"current"in n?n.current:n},S7=function(n,t){return n[0]===t[0]&&n[1]===t[1]},w7=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},x7=0,ao=[];function b7(n){var t=v.useRef([]),e=v.useRef([0,0]),s=v.useRef(),r=v.useState(x7++)[0],i=v.useState($E)[0],o=v.useRef(n);v.useEffect(function(){o.current=n},[n]),v.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(r));var m=NA([n.lockRef.current],(n.shards||[]).map(av),!0).filter(Boolean);return m.forEach(function(x){return x.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),m.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(r))})}}},[n.inert,n.lockRef.current,n.shards]);var a=v.useCallback(function(m,x){if("touches"in m&&m.touches.length===2)return!o.current.allowPinchZoom;var w=Fl(m),b=e.current,I="deltaX"in m?m.deltaX:b[0]-w[0],E="deltaY"in m?m.deltaY:b[1]-w[1],P,C=m.target,_=Math.abs(I)>Math.abs(E)?"h":"v";if("touches"in m&&_==="h"&&C.type==="range")return!1;var k=iv(_,C);if(!k)return!0;if(k?P=_:(P=_==="v"?"h":"v",k=iv(_,C)),!k)return!1;if(!s.current&&"changedTouches"in m&&(I||E)&&(s.current=P),!P)return!0;var D=s.current||P;return y7(D,x,m,D==="h"?I:E,!0)},[]),c=v.useCallback(function(m){var x=m;if(!(!ao.length||ao[ao.length-1]!==i)){var w="deltaY"in x?ov(x):Fl(x),b=t.current.filter(function(P){return P.name===x.type&&(P.target===x.target||x.target===P.shadowParent)&&S7(P.delta,w)})[0];if(b&&b.should){x.cancelable&&x.preventDefault();return}if(!b){var I=(o.current.shards||[]).map(av).filter(Boolean).filter(function(P){return P.contains(x.target)}),E=I.length>0?a(x,I[0]):!o.current.noIsolation;E&&x.cancelable&&x.preventDefault()}}},[]),l=v.useCallback(function(m,x,w,b){var I={name:m,delta:x,target:w,should:b,shadowParent:v7(w)};t.current.push(I),setTimeout(function(){t.current=t.current.filter(function(E){return E!==I})},1)},[]),d=v.useCallback(function(m){e.current=Fl(m),s.current=void 0},[]),h=v.useCallback(function(m){l(m.type,ov(m),m.target,a(m,n.lockRef.current))},[]),p=v.useCallback(function(m){l(m.type,Fl(m),m.target,a(m,n.lockRef.current))},[]);v.useEffect(function(){return ao.push(i),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,oo),document.addEventListener("touchmove",c,oo),document.addEventListener("touchstart",d,oo),function(){ao=ao.filter(function(m){return m!==i}),document.removeEventListener("wheel",c,oo),document.removeEventListener("touchmove",c,oo),document.removeEventListener("touchstart",d,oo)}},[]);var f=n.removeScrollBar,y=n.inert;return v.createElement(v.Fragment,null,y?v.createElement(i,{styles:w7(r)}):null,f?v.createElement(d7,{gapMode:n.gapMode}):null)}function v7(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const C7=ZK(LE,b7);var gh=v.forwardRef(function(n,t){return v.createElement(fh,kr({},n,{ref:t,sideCar:C7}))});gh.classNames=fh.classNames;var I7=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},co=new WeakMap,Nl=new WeakMap,Bl={},Xp=0,zE=function(n){return n&&(n.host||zE(n.parentNode))},P7=function(n,t){return t.map(function(e){if(n.contains(e))return e;var s=zE(e);return s&&n.contains(s)?s:(console.error("aria-hidden",e,"in not contained inside",n,". Doing nothing"),null)}).filter(function(e){return!!e})},E7=function(n,t,e,s){var r=P7(t,Array.isArray(n)?n:[n]);Bl[e]||(Bl[e]=new WeakMap);var i=Bl[e],o=[],a=new Set,c=new Set(r),l=function(h){!h||a.has(h)||(a.add(h),l(h.parentNode))};r.forEach(l);var d=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(a.has(p))d(p);else try{var f=p.getAttribute(s),y=f!==null&&f!=="false",m=(co.get(p)||0)+1,x=(i.get(p)||0)+1;co.set(p,m),i.set(p,x),o.push(p),m===1&&y&&Nl.set(p,!0),x===1&&p.setAttribute(e,"true"),y||p.setAttribute(s,"true")}catch(w){console.error("aria-hidden: cannot operate on ",p,w)}})};return d(t),a.clear(),Xp++,function(){o.forEach(function(h){var p=co.get(h)-1,f=i.get(h)-1;co.set(h,p),i.set(h,f),p||(Nl.has(h)||h.removeAttribute(s),Nl.delete(h)),f||h.removeAttribute(e)}),Xp--,Xp||(co=new WeakMap,co=new WeakMap,Nl=new WeakMap,Bl={})}},My=function(n,t,e){e===void 0&&(e="data-aria-hidden");var s=Array.from(Array.isArray(n)?n:[n]),r=I7(n);return r?(s.push.apply(s,Array.from(r.querySelectorAll("[aria-live]"))),E7(s,r,e,"aria-hidden")):function(){return null}},Ay="Dialog",[UE,Tte]=Bs(Ay),[_7,fs]=UE(Ay),HE=n=>{const{__scopeDialog:t,children:e,open:s,defaultOpen:r,onOpenChange:i,modal:o=!0}=n,a=v.useRef(null),c=v.useRef(null),[l=!1,d]=ni({prop:s,defaultProp:r,onChange:i});return u.jsx(_7,{scope:t,triggerRef:a,contentRef:c,contentId:rr(),titleId:rr(),descriptionId:rr(),open:l,onOpenChange:d,onOpenToggle:v.useCallback(()=>d(h=>!h),[d]),modal:o,children:e})};HE.displayName=Ay;var KE="DialogTrigger",T7=v.forwardRef((n,t)=>{const{__scopeDialog:e,...s}=n,r=fs(KE,e),i=He(t,r.triggerRef);return u.jsx(Ie.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":Oy(r.open),...s,ref:i,onClick:J(n.onClick,r.onOpenToggle)})});T7.displayName=KE;var jy="DialogPortal",[k7,GE]=UE(jy,{forceMount:void 0}),WE=n=>{const{__scopeDialog:t,forceMount:e,children:s,container:r}=n,i=fs(jy,t);return u.jsx(k7,{scope:t,forceMount:e,children:v.Children.map(s,o=>u.jsx(ps,{present:e||i.open,children:u.jsx(Uc,{asChild:!0,container:r,children:o})}))})};WE.displayName=jy;var Eu="DialogOverlay",VE=v.forwardRef((n,t)=>{const e=GE(Eu,n.__scopeDialog),{forceMount:s=e.forceMount,...r}=n,i=fs(Eu,n.__scopeDialog);return i.modal?u.jsx(ps,{present:s||i.open,children:u.jsx(M7,{...r,ref:t})}):null});VE.displayName=Eu;var M7=v.forwardRef((n,t)=>{const{__scopeDialog:e,...s}=n,r=fs(Eu,e);return u.jsx(gh,{as:Li,allowPinchZoom:!0,shards:[r.contentRef],children:u.jsx(Ie.div,{"data-state":Oy(r.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),$i="DialogContent",YE=v.forwardRef((n,t)=>{const e=GE($i,n.__scopeDialog),{forceMount:s=e.forceMount,...r}=n,i=fs($i,n.__scopeDialog);return u.jsx(ps,{present:s||i.open,children:i.modal?u.jsx(A7,{...r,ref:t}):u.jsx(j7,{...r,ref:t})})});YE.displayName=$i;var A7=v.forwardRef((n,t)=>{const e=fs($i,n.__scopeDialog),s=v.useRef(null),r=He(t,e.contentRef,s);return v.useEffect(()=>{const i=s.current;if(i)return My(i)},[]),u.jsx(XE,{...n,ref:r,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:J(n.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=e.triggerRef.current)==null||o.focus()}),onPointerDownOutside:J(n.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:J(n.onFocusOutside,i=>i.preventDefault())})}),j7=v.forwardRef((n,t)=>{const e=fs($i,n.__scopeDialog),s=v.useRef(!1),r=v.useRef(!1);return u.jsx(XE,{...n,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,i),i.defaultPrevented||(s.current||(a=e.triggerRef.current)==null||a.focus(),i.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:i=>{var c,l;(c=n.onInteractOutside)==null||c.call(n,i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=i.target;((l=e.triggerRef.current)==null?void 0:l.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&r.current&&i.preventDefault()}})}),XE=v.forwardRef((n,t)=>{const{__scopeDialog:e,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:i,...o}=n,a=fs($i,e),c=v.useRef(null),l=He(t,c);return ky(),u.jsxs(u.Fragment,{children:[u.jsx(ph,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:i,children:u.jsx(zc,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Oy(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),u.jsxs(u.Fragment,{children:[u.jsx(O7,{titleId:a.titleId}),u.jsx(L7,{contentRef:c,descriptionId:a.descriptionId})]})]})}),Dy="DialogTitle",qE=v.forwardRef((n,t)=>{const{__scopeDialog:e,...s}=n,r=fs(Dy,e);return u.jsx(Ie.h2,{id:r.titleId,...s,ref:t})});qE.displayName=Dy;var ZE="DialogDescription",D7=v.forwardRef((n,t)=>{const{__scopeDialog:e,...s}=n,r=fs(ZE,e);return u.jsx(Ie.p,{id:r.descriptionId,...s,ref:t})});D7.displayName=ZE;var JE="DialogClose",QE=v.forwardRef((n,t)=>{const{__scopeDialog:e,...s}=n,r=fs(JE,e);return u.jsx(Ie.button,{type:"button",...s,ref:t,onClick:J(n.onClick,()=>r.onOpenChange(!1))})});QE.displayName=JE;function Oy(n){return n?"open":"closed"}var e_="DialogTitleWarning",[kte,t_]=pK(e_,{contentName:$i,titleName:Dy,docsSlug:"dialog"}),O7=({titleId:n})=>{const t=t_(e_),e=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return v.useEffect(()=>{n&&(document.getElementById(n)||console.error(e))},[e,n]),null},R7="DialogDescriptionWarning",L7=({contentRef:n,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${t_(R7).contentName}}.`;return v.useEffect(()=>{var i;const r=(i=n.current)==null?void 0:i.getAttribute("aria-describedby");t&&r&&(document.getElementById(t)||console.warn(s))},[s,n,t]),null},$7=HE,F7=WE,N7=VE,B7=YE;const n_=()=>{},s_=v.createContext(null);function z7({onEvent:n,children:t}){return u.jsx(s_.Provider,{value:n??n_,children:t})}function gs(){return v.useContext(s_)??n_}const r_=v.createContext(null);function U7({children:n}){const t=N(),e=gs(),[s,r]=v.useState([]),i=v.useCallback(l=>{const d=l.id??Qe();return r(h=>[...h.filter(p=>p.id!==l.id),{...l,id:d}]),e("open-menu",{source:"dialog",id:d}),t.addOpenMenu(d),d},[t,e]),o=v.useCallback((l,d)=>(r(h=>h.map(p=>p.id===l?{...p,...d}:p)),e("open-menu",{source:"dialog",id:l}),t.addOpenMenu(l),l),[t,e]),a=v.useCallback(l=>(r(d=>d.filter(h=>{var p;return h.id===l?((p=h.onClose)==null||p.call(h),!1):!0})),e("close-menu",{source:"dialog",id:l}),t.deleteOpenMenu(l),l),[t,e]),c=v.useCallback(()=>{r(l=>(l.forEach(d=>{var h;(h=d.onClose)==null||h.call(d),e("close-menu",{source:"dialog",id:d.id}),t.deleteOpenMenu(d.id)}),[]))},[t,e]);return u.jsx(r_.Provider,{value:{dialogs:s,addDialog:i,removeDialog:a,clearDialogs:c,updateDialog:o},children:n})}function Yi(){const n=v.useContext(r_);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const H7=({id:n,component:t,onClose:e})=>{const{removeDialog:s}=Yi(),r=Qt(),i=v.useCallback(o=>{if(!o){if(e)try{e()}catch(a){console.warn(a)}s(n)}},[n,e,s]);return u.jsx($7,{onOpenChange:i,defaultOpen:!0,children:u.jsx(F7,{container:r,children:u.jsx(N7,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&i(!1)},children:u.jsx(B7,{dir:"ltr",className:"tlui-dialog__content",children:u.jsx(t,{onClose:()=>i(!1)})})})})})};function K7(){const{dialogs:n}=Yi();return u.jsx(u.Fragment,{children:n.map(t=>u.jsx(H7,{...t},t.id))})}const G7=me.memo(K7);function W7(){const n=N(),t=z("follow",()=>n.getInstanceState().followingUserId,[n]);return t?u.jsx(V7,{userId:t}):null}function V7({userId:n}){const t=FI(n);return t?u.jsx("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function mh(n){const t=n+"CollectionProvider",[e,s]=Bs(t),[r,i]=e(t,{collectionRef:{current:null},itemMap:new Map}),o=f=>{const{scope:y,children:m}=f,x=me.useRef(null),w=me.useRef(new Map).current;return u.jsx(r,{scope:y,itemMap:w,collectionRef:x,children:m})};o.displayName=t;const a=n+"CollectionSlot",c=me.forwardRef((f,y)=>{const{scope:m,children:x}=f,w=i(a,m),b=He(y,w.collectionRef);return u.jsx(Li,{ref:b,children:x})});c.displayName=a;const l=n+"CollectionItemSlot",d="data-radix-collection-item",h=me.forwardRef((f,y)=>{const{scope:m,children:x,...w}=f,b=me.useRef(null),I=He(y,b),E=i(l,m);return me.useEffect(()=>(E.itemMap.set(b,{ref:b,...w}),()=>void E.itemMap.delete(b))),u.jsx(Li,{[d]:"",ref:I,children:x})});h.displayName=l;function p(f){const y=i(n+"CollectionConsumer",f);return me.useCallback(()=>{const x=y.collectionRef.current;if(!x)return[];const w=Array.from(x.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((E,P)=>w.indexOf(E.ref.current)-w.indexOf(P.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},p,s]}var Y7="VisuallyHidden",Ry=v.forwardRef((n,t)=>u.jsx(Ie.span,{...n,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));Ry.displayName=Y7;var Ly="ToastProvider",[$y,X7,q7]=mh("Toast"),[i_,Mte]=Bs("Toast",[q7]),[Z7,yh]=i_(Ly),o_=n=>{const{__scopeToast:t,label:e="Notification",duration:s=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:o}=n,[a,c]=v.useState(null),[l,d]=v.useState(0),h=v.useRef(!1),p=v.useRef(!1);return e.trim()||console.error(`Invalid prop \`label\` supplied to \`${Ly}\`. Expected non-empty \`string\`.`),u.jsx($y.Provider,{scope:t,children:u.jsx(Z7,{scope:t,label:e,duration:s,swipeDirection:r,swipeThreshold:i,toastCount:l,viewport:a,onViewportChange:c,onToastAdd:v.useCallback(()=>d(f=>f+1),[]),onToastRemove:v.useCallback(()=>d(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:o})})};o_.displayName=Ly;var a_="ToastViewport",J7=["F8"],Ag="toast.viewportPause",jg="toast.viewportResume",c_=v.forwardRef((n,t)=>{const{__scopeToast:e,hotkey:s=J7,label:r="Notifications ({hotkey})",...i}=n,o=yh(a_,e),a=X7(e),c=v.useRef(null),l=v.useRef(null),d=v.useRef(null),h=v.useRef(null),p=He(t,h,o.onViewportChange),f=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=o.toastCount>0;v.useEffect(()=>{const x=w=>{var I;s.every(E=>w[E]||w.code===E)&&((I=h.current)==null||I.focus())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[s]),v.useEffect(()=>{const x=c.current,w=h.current;if(y&&x&&w){const b=()=>{if(!o.isClosePausedRef.current){const C=new CustomEvent(Ag);w.dispatchEvent(C),o.isClosePausedRef.current=!0}},I=()=>{if(o.isClosePausedRef.current){const C=new CustomEvent(jg);w.dispatchEvent(C),o.isClosePausedRef.current=!1}},E=C=>{!x.contains(C.relatedTarget)&&I()},P=()=>{x.contains(document.activeElement)||I()};return x.addEventListener("focusin",b),x.addEventListener("focusout",E),x.addEventListener("pointermove",b),x.addEventListener("pointerleave",P),window.addEventListener("blur",b),window.addEventListener("focus",I),()=>{x.removeEventListener("focusin",b),x.removeEventListener("focusout",E),x.removeEventListener("pointermove",b),x.removeEventListener("pointerleave",P),window.removeEventListener("blur",b),window.removeEventListener("focus",I)}}},[y,o.isClosePausedRef]);const m=v.useCallback(({tabbingDirection:x})=>{const b=a().map(I=>{const E=I.ref.current,P=[E,...u9(E)];return x==="forwards"?P:P.reverse()});return(x==="forwards"?b.reverse():b).flat()},[a]);return v.useEffect(()=>{const x=h.current;if(x){const w=b=>{var P,C,_;const I=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!I){const k=document.activeElement,D=b.shiftKey;if(b.target===x&&D){(P=l.current)==null||P.focus();return}const L=m({tabbingDirection:D?"backwards":"forwards"}),j=L.findIndex(R=>R===k);qp(L.slice(j+1))?b.preventDefault():D?(C=l.current)==null||C.focus():(_=d.current)==null||_.focus()}};return x.addEventListener("keydown",w),()=>x.removeEventListener("keydown",w)}},[a,m]),u.jsxs(AK,{ref:c,role:"region","aria-label":r.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&u.jsx(Dg,{ref:l,onFocusFromOutsideViewport:()=>{const x=m({tabbingDirection:"forwards"});qp(x)}}),u.jsx($y.Slot,{scope:e,children:u.jsx(Ie.ol,{tabIndex:-1,...i,ref:p})}),y&&u.jsx(Dg,{ref:d,onFocusFromOutsideViewport:()=>{const x=m({tabbingDirection:"backwards"});qp(x)}})]})});c_.displayName=a_;var l_="ToastFocusProxy",Dg=v.forwardRef((n,t)=>{const{__scopeToast:e,onFocusFromOutsideViewport:s,...r}=n,i=yh(l_,e);return u.jsx(Ry,{"aria-hidden":!0,tabIndex:0,...r,ref:t,style:{position:"fixed"},onFocus:o=>{var l;const a=o.relatedTarget;!((l=i.viewport)!=null&&l.contains(a))&&s()}})});Dg.displayName=l_;var Sh="Toast",Q7="toast.swipeStart",e9="toast.swipeMove",t9="toast.swipeCancel",n9="toast.swipeEnd",d_=v.forwardRef((n,t)=>{const{forceMount:e,open:s,defaultOpen:r,onOpenChange:i,...o}=n,[a=!0,c]=ni({prop:s,defaultProp:r,onChange:i});return u.jsx(ps,{present:e||a,children:u.jsx(i9,{open:a,...o,ref:t,onClose:()=>c(!1),onPause:Ft(n.onPause),onResume:Ft(n.onResume),onSwipeStart:J(n.onSwipeStart,l=>{l.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:J(n.onSwipeMove,l=>{const{x:d,y:h}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","move"),l.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:J(n.onSwipeCancel,l=>{l.currentTarget.setAttribute("data-swipe","cancel"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:J(n.onSwipeEnd,l=>{const{x:d,y:h}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","end"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),c(!1)})})})});d_.displayName=Sh;var[s9,r9]=i_(Sh,{onClose(){}}),i9=v.forwardRef((n,t)=>{const{__scopeToast:e,type:s="foreground",duration:r,open:i,onClose:o,onEscapeKeyDown:a,onPause:c,onResume:l,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...y}=n,m=yh(Sh,e),[x,w]=v.useState(null),b=He(t,R=>w(R)),I=v.useRef(null),E=v.useRef(null),P=r||m.duration,C=v.useRef(0),_=v.useRef(P),k=v.useRef(0),{onToastAdd:D,onToastRemove:T}=m,A=Ft(()=>{var F;(x==null?void 0:x.contains(document.activeElement))&&((F=m.viewport)==null||F.focus()),o()}),L=v.useCallback(R=>{!R||R===1/0||(window.clearTimeout(k.current),C.current=new Date().getTime(),k.current=window.setTimeout(A,R))},[A]);v.useEffect(()=>{const R=m.viewport;if(R){const F=()=>{L(_.current),l==null||l()},H=()=>{const U=new Date().getTime()-C.current;_.current=_.current-U,window.clearTimeout(k.current),c==null||c()};return R.addEventListener(Ag,H),R.addEventListener(jg,F),()=>{R.removeEventListener(Ag,H),R.removeEventListener(jg,F)}}},[m.viewport,P,c,l,L]),v.useEffect(()=>{i&&!m.isClosePausedRef.current&&L(P)},[i,P,m.isClosePausedRef,L]),v.useEffect(()=>(D(),()=>T()),[D,T]);const j=v.useMemo(()=>x?y_(x):null,[x]);return m.viewport?u.jsxs(u.Fragment,{children:[j&&u.jsx(o9,{__scopeToast:e,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:j}),u.jsx(s9,{scope:e,onClose:A,children:Ic.createPortal(u.jsx($y.ItemSlot,{scope:e,children:u.jsx(MK,{asChild:!0,onEscapeKeyDown:J(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||A(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:u.jsx(Ie.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":m.swipeDirection,...y,ref:b,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:J(n.onKeyDown,R=>{R.key==="Escape"&&(a==null||a(R.nativeEvent),R.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,A()))}),onPointerDown:J(n.onPointerDown,R=>{R.button===0&&(I.current={x:R.clientX,y:R.clientY})}),onPointerMove:J(n.onPointerMove,R=>{if(!I.current)return;const F=R.clientX-I.current.x,H=R.clientY-I.current.y,U=!!E.current,V=["left","right"].includes(m.swipeDirection),W=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,te=V?W(0,F):0,le=V?0:W(0,H),Se=R.pointerType==="touch"?10:2,be={x:te,y:le},nt={originalEvent:R,delta:be};U?(E.current=be,zl(e9,h,nt,{discrete:!1})):cv(be,m.swipeDirection,Se)?(E.current=be,zl(Q7,d,nt,{discrete:!1}),R.target.setPointerCapture(R.pointerId)):(Math.abs(F)>Se||Math.abs(H)>Se)&&(I.current=null)}),onPointerUp:J(n.onPointerUp,R=>{const F=E.current,H=R.target;if(H.hasPointerCapture(R.pointerId)&&H.releasePointerCapture(R.pointerId),E.current=null,I.current=null,F){const U=R.currentTarget,V={originalEvent:R,delta:F};cv(F,m.swipeDirection,m.swipeThreshold)?zl(n9,f,V,{discrete:!0}):zl(t9,p,V,{discrete:!0}),U.addEventListener("click",W=>W.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),o9=n=>{const{__scopeToast:t,children:e,...s}=n,r=yh(Sh,t),[i,o]=v.useState(!1),[a,c]=v.useState(!1);return l9(()=>o(!0)),v.useEffect(()=>{const l=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(l)},[]),a?null:u.jsx(Uc,{asChild:!0,children:u.jsx(Ry,{...s,children:i&&u.jsxs(u.Fragment,{children:[r.label," ",e]})})})},a9="ToastTitle",u_=v.forwardRef((n,t)=>{const{__scopeToast:e,...s}=n;return u.jsx(Ie.div,{...s,ref:t})});u_.displayName=a9;var c9="ToastDescription",h_=v.forwardRef((n,t)=>{const{__scopeToast:e,...s}=n;return u.jsx(Ie.div,{...s,ref:t})});h_.displayName=c9;var p_="ToastAction",f_=v.forwardRef((n,t)=>{const{altText:e,...s}=n;return e.trim()?u.jsx(m_,{altText:e,asChild:!0,children:u.jsx(Fy,{...s,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${p_}\`. Expected non-empty \`string\`.`),null)});f_.displayName=p_;var g_="ToastClose",Fy=v.forwardRef((n,t)=>{const{__scopeToast:e,...s}=n,r=r9(g_,e);return u.jsx(m_,{asChild:!0,children:u.jsx(Ie.button,{type:"button",...s,ref:t,onClick:J(n.onClick,r.onClose)})})});Fy.displayName=g_;var m_=v.forwardRef((n,t)=>{const{__scopeToast:e,altText:s,...r}=n;return u.jsx(Ie.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...r,ref:t})});function y_(n){const t=[];return Array.from(n.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&t.push(s.textContent),d9(s)){const r=s.ariaHidden||s.hidden||s.style.display==="none",i=s.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=s.dataset.radixToastAnnounceAlt;o&&t.push(o)}else t.push(...y_(s))}}),t}function zl(n,t,e,{discrete:s}){const r=e.originalEvent.currentTarget,i=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e});t&&r.addEventListener(n,t,{once:!0}),s?Ty(r,i):r.dispatchEvent(i)}var cv=(n,t,e=0)=>{const s=Math.abs(n.x),r=Math.abs(n.y),i=s>r;return t==="left"||t==="right"?i&&s>e:!i&&r>e};function l9(n=()=>{}){const t=Ft(n);Gr(()=>{let e=0,s=0;return e=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(s)}},[t])}function d9(n){return n.nodeType===n.ELEMENT_NODE}function u9(n){const t=[],e=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)t.push(e.currentNode);return t}function qp(n){const t=document.activeElement;return n.some(e=>e===t?!0:(e.focus(),document.activeElement!==t))}var h9=d_,p9=u_,f9=h_,g9=f_,lv=Fy;const S_=v.createContext(null);function m9({children:n}){const[t,e]=v.useState([]),s=v.useCallback(o=>{const a=o.id??Qe();return e(c=>[...c.filter(l=>l.id!==o.id),{...o,id:a}]),a},[]),r=v.useCallback(o=>(e(a=>a.filter(c=>c.id!==o)),o),[]),i=v.useCallback(()=>{e(()=>[])},[]);return u.jsx(o_,{children:u.jsx(S_.Provider,{value:{toasts:t,addToast:s,removeToast:r,clearToasts:i},children:n})})}function ms(){const n=v.useContext(S_);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}const ce=v.forwardRef(function({children:t,disabled:e,type:s,...r},i){return u.jsx("button",{ref:i,type:"button",draggable:!1,disabled:e,...r,className:se("tlui-button",`tlui-button__${s}`,r.className),children:t})});function gt({children:n}){return u.jsx("span",{className:"tlui-button__label",children:n})}const Wr=v.memo(function({small:t,invertIcon:e,icon:s,color:r,className:i,...o}){const a=Cy(),c=a.icons[s]??a.icons["question-mark-circle"],l=v.useRef(null);return v.useLayoutEffect(()=>{c||console.error(`Icon not found: ${s}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[l,c,s]),s==="none"?u.jsx("div",{className:se("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":t},i)}):u.jsx("div",{...o,ref:l,className:se("tlui-icon",{"tlui-icon__small":t},i),style:{color:r,mask:`url(${c}) center 100% / 100% no-repeat`,transform:e?"scale(-1, 1)":void 0}})}),y9={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function S9({toast:n}){const{removeToast:t}=ms(),e=Te(),s=o=>{o||t(n.id)},r=n.actions&&n.actions.length>0,i=n.icon||n.severity&&y9[n.severity];return u.jsxs(h9,{onOpenChange:s,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,"data-severity":n.severity,children:[i&&u.jsx("div",{className:"tlui-toast__icon",children:u.jsx(Wr,{icon:i})}),u.jsxs("div",{className:"tlui-toast__main",children:[u.jsxs("div",{className:"tlui-toast__content",children:[n.title&&u.jsx(p9,{className:"tlui-toast__title",children:n.title}),n.description&&u.jsx(f9,{className:"tlui-toast__description",children:n.description})]}),n.actions&&u.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,a)=>u.jsx(g9,{altText:o.label,asChild:!0,onClick:o.onClick,children:u.jsx(ce,{type:o.type,children:u.jsx(gt,{children:o.label})})},a)),u.jsx(lv,{asChild:!0,children:u.jsx(ce,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:u.jsx(gt,{children:n.closeLabel??e("toast.close")})})})]})]}),!r&&u.jsx(lv,{asChild:!0,children:u.jsx(ce,{type:"normal",className:"tlui-toast__close",children:u.jsx(gt,{children:n.closeLabel??e("toast.close")})})})]})}function w9(){const{toasts:n}=ms();return u.jsx(u.Fragment,{children:n.map(t=>u.jsx(S9,{toast:t},t.id))})}const x9=v.memo(w9);function b9(){const n=N(),{toasts:t}=ms(),[e,s]=v.useState(!1);return v.useEffect(()=>{let r=-1;return t.length?s(!0):r=n.timers.setTimeout(()=>{s(!1)},1e3),()=>{clearTimeout(r)}},[t.length,s,n]),e?u.jsx(c_,{className:"tlui-toast__viewport"}):null}function ve({icon:n,small:t,invertIcon:e}){return u.jsx(Wr,{className:"tlui-button__icon",icon:n,small:t,invertIcon:e})}const Zp=[0,390,428,468,580,640,840,1023];var dt=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(dt||{});const v9="2.3.0",C9="https://cdn.tldraw.com";function wi(){return`${C9}/${v9}`}let Og={fonts:{draw:`${wi()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${wi()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${wi()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${wi()}/fonts/IBMPlexMono-Medium.woff2`}};function w_(n){return v.useMemo(()=>n?{fonts:{...Og.fonts,...n==null?void 0:n.fonts}}:Og,[n])}const I9=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Ta={...Og,icons:Object.fromEntries(I9.map(n=>[n,`${wi()}/icons/icon/${n}.svg`])),translations:Object.fromEntries(oc.map(n=>[n.locale,`${wi()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(jc.map(n=>[n.type,`${wi()}/embed-icons/${n.type}.png`]))};function P9(n){return n?{fonts:Object.assign({...Ta.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Ta.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Ta.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Ta.translations},{...n==null?void 0:n.translations})}:Ta}function wh({className:n,children:t}){return u.jsx("div",{className:se("tlui-dialog__header",n),children:t})}function xh({className:n,children:t}){return u.jsx(qE,{dir:"ltr",className:se("tlui-dialog__header__title",n),children:t})}function bh(){return u.jsx("div",{className:"tlui-dialog__header__close",children:u.jsx(QE,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:u.jsx(ce,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:u.jsx(ve,{small:!0,icon:"cross-2"})})})})}function lc({className:n,children:t,style:e}){return u.jsx("div",{className:se("tlui-dialog__body",n),style:e,children:t})}function Ny({className:n,children:t}){return u.jsx("div",{className:se("tlui-dialog__footer",n),children:t})}const By=v.forwardRef(function({className:t,label:e,icon:s,iconLeft:r,autoSelect:i=!1,autoFocus:o=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:d,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:y=!1,children:m,value:x},w){const b=N(),I=v.useRef(null);v.useImperativeHandle(w,()=>I.current);const E=Te(),P=v.useRef(a??""),C=v.useRef(a??""),[_,k]=v.useState(!1),D=v.useCallback(j=>{k(!0);const R=j.currentTarget;C.current=R.value,b.timers.requestAnimationFrame(()=>{i&&R.select()}),p==null||p()},[i,p,b.timers]),T=v.useCallback(j=>{const R=j.currentTarget.value;C.current=R,d==null||d(R)},[d]),A=v.useCallback(j=>{switch(j.key){case"Enter":{j.currentTarget.blur(),Rt(j),l==null||l(j.currentTarget.value);break}case"Escape":{j.currentTarget.value=P.current,j.currentTarget.blur(),Rt(j),h==null||h(j.currentTarget.value);break}}},[l,h]),L=v.useCallback(j=>{k(!1);const R=j.currentTarget.value;f==null||f(R)},[f]);return v.useEffect(()=>{if(!b.environment.isIos)return;const j=window.visualViewport;if(_&&y&&j){const R=()=>{var F;(F=I.current)==null||F.scrollIntoView({block:"center"})};return j.addEventListener("resize",R),j.addEventListener("scroll",R),b.timers.requestAnimationFrame(()=>{var F;(F=I.current)==null||F.scrollIntoView({block:"center"})}),()=>{j.removeEventListener("resize",R),j.removeEventListener("scroll",R)}}},[b,_,y]),u.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,e&&u.jsx("label",{children:E(e)}),r&&u.jsx(Wr,{icon:r,className:"tlui-icon-left",small:!0}),u.jsx("input",{ref:I,className:se("tlui-input",t),type:"text",defaultValue:a,onKeyUp:A,onChange:T,onFocus:D,onBlur:L,autoFocus:o,placeholder:c,value:x}),s&&u.jsx(Wr,{icon:s,small:!!e})]})}),x_=Cn(function({onClose:t}){const e=N(),s=Te(),r=Cy(),[i,o]=v.useState(null),[a,c]=v.useState(""),[l,d]=v.useState(null),[h,p]=v.useState(!1),f=v.useRef(-1);return u.jsxs(u.Fragment,{children:[u.jsxs(wh,{children:[u.jsx(xh,{children:i?`${s("embed-dialog.title")} â ${i.title}`:s("embed-dialog.title")}),u.jsx(bh,{})]}),i?u.jsxs(u.Fragment,{children:[u.jsxs(lc,{className:"tlui-embed-dialog__enter",children:[u.jsx(By,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:y=>{c(y);const m=Or(y);d(m&&m.definition.type===i.type?m:null),p(!1),clearTimeout(f.current),f.current=e.timers.setTimeout(()=>p(!m),320)}}),a===""?u.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[u.jsx("span",{children:s("embed-dialog.instruction")})," ",i.instructionLink&&u.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",u.jsx(Wr,{icon:"external-link",small:!0})]})]}):u.jsx("div",{className:"tlui-embed-dialog__warning",children:h?s("embed-dialog.invalid-url"):"Â "})]}),u.jsxs(Ny,{className:"tlui-dialog__footer__actions",children:[u.jsx(ce,{type:"normal",onClick:()=>{o(null),d(null),c("")},children:u.jsx(gt,{children:s("embed-dialog.back")})}),u.jsx("div",{className:"tlui-embed__spacer"}),u.jsx(ce,{type:"normal",onClick:t,children:u.jsx(gt,{children:s("embed-dialog.cancel")})}),u.jsx(ce,{type:"primary",disabled:!l,onClick:()=>{l&&(e.putExternalContent({type:"embed",url:a,point:e.getViewportPageBounds().center,embed:l.definition}),t())},children:u.jsx(gt,{children:s("embed-dialog.create")})})]})]}):u.jsx(u.Fragment,{children:u.jsx(lc,{className:"tlui-embed-dialog__list",children:jc.map(y=>u.jsxs(ce,{type:"menu",onClick:()=>o(y),children:[u.jsx(gt,{children:y.title}),u.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[y.type]})`}})]},y.type))})})]})});function b_(){const n=N(),t=v.useRef();return v.useEffect(()=>{const e=window.document.createElement("input");e.type="file",e.accept=vN,e.multiple=!0,t.current=e;async function s(r){const i=r.target.files;!i||i.length===0||(n.mark("insert media"),await n.putExternalContent({type:"files",files:Array.from(i),point:n.getViewportPageBounds().center,ignoreParent:!1}),e.value="")}return e.addEventListener("change",s),()=>{t.current=void 0,e.removeEventListener("change",s)}},[n]),v.useCallback(()=>{var e;(e=t.current)==null||e.click()},[t])}const v_=v.createContext(null);function E9({overrides:n,children:t}){const e=N(),s=gs(),{addDialog:r}=Yi(),i=b_(),o=v.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(l){e.setCurrentTool("select"),s("select-tool",{source:l,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(l){e.setCurrentTool("hand"),s("select-tool",{source:l,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(l){e.setCurrentTool("eraser"),s("select-tool",{source:l,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(l){e.setCurrentTool("draw"),s("select-tool",{source:l,id:"draw"})}},...[...os.values].map(l=>({id:l,label:`tool.${l}`,meta:{geo:l},kbd:l==="rectangle"?"r":l==="ellipse"?"o":void 0,icon:"geo-"+l,onSelect(d){e.batch(()=>{e.setStyleForNextShapes(os,l),e.setCurrentTool("geo"),s("select-tool",{source:d,id:`geo-${l}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(l){e.setCurrentTool("arrow"),s("select-tool",{source:l,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(l){e.setCurrentTool("line"),s("select-tool",{source:l,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(l){e.setCurrentTool("frame"),s("select-tool",{source:l,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(l){e.setCurrentTool("text"),s("select-tool",{source:l,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(l){i(),s("select-tool",{source:l,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(l){e.setCurrentTool("note"),s("select-tool",{source:l,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(l){e.setCurrentTool("laser"),s("select-tool",{source:l,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(l){r({component:x_}),s("select-tool",{source:l,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(l){e.setCurrentTool("highlight"),s("select-tool",{source:l,id:"highlight"})}}];a.push();const c=Object.fromEntries(a.map(l=>[l.id,l]));return n?n(e,c,{insertMedia:i}):c},[n,e,s,i,r]);return u.jsx(v_.Provider,{value:o,children:t})}function vh(){const n=v.useContext(v_);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const C_=me.createContext(null);function _9({forceMobile:n=!1,children:t}){const e=N(),s=z("breakpoint",()=>{const{width:r}=e.getViewportScreenBounds(),i=n?dt.MOBILE_SM:Zp.length-1;for(let o=0;o<i;o++)if(r>Zp[o]&&r<=Zp[o+1])return o;return i},[e]);return u.jsx(C_.Provider,{value:s,children:t})}function Pn(){const n=v.useContext(C_);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}function T9(){const{addToast:n,removeToast:t,clearToasts:e}=ms(),{addDialog:s,clearDialogs:r,removeDialog:i,updateDialog:o}=Yi(),c=Pn()<dt.TABLET_SM,l=Te();return v.useMemo(()=>({addToast:n,removeToast:t,clearToasts:e,addDialog:s,clearDialogs:r,removeDialog:i,updateDialog:o,msg:l,isMobile:c}),[s,n,r,e,l,i,t,o,c])}function k9(n,t){const e={};for(const s of n)if(s.translations)for(const[r,i]of wn(s.translations)){let o=e[r];o||(o=e[r]={}),Object.assign(o,i)}return{actions:(s,r)=>{for(const i of n)i.actions&&(r=i.actions(s,r,t));return r},tools:(s,r,i)=>{for(const o of n)o.tools&&(r=o.tools(s,r,{...t,...i}));return r},translations:e}}function I_(n){return v.useMemo(()=>n,n)}function M9(n){const t=I_(n==null?[]:Array.isArray(n)?n:[n]);return v.useMemo(()=>{const e={};for(const s of t)if(s.translations)for(const[r,i]of wn(s.translations)){let o=e[r];o||(o=e[r]={}),Object.assign(o,i)}return e},[t])}function A9(n){const t=T9(),e=I_(n==null?[]:Array.isArray(n)?n:[n]);return v.useMemo(()=>k9(e,t),[e,t])}function j9(n,t){const e=ge(t.map(r=>n.getShape(r)).filter(r=>r&&n.isShapeOfType(r,"frame")));if(!e.length)return;const s=[];n.batch(()=>{e.map(r=>{const i=n.getSortedChildIdsForParent(r.id);i.length&&(n.reparentShapes(i,r.parentId,r.index),s.push(...i))}),n.setSelectedShapes(s),n.deleteShapes(t)})}const D9=50;function O9(n,t,e={}){const s=n.getShape(t);if(!s)return;const r=n.getSortedChildIdsForParent(s.id),i=ge(r.map(f=>n.getShape(f)));if(!i.length)return;const o=Y.FromPoints(i.flatMap(f=>{const y=n.getShapeGeometry(f.id);return n.getShapeLocalTransform(f).applyToPoints(y.vertices)})),{padding:a=D9}=e,c=o.w+2*a,l=o.h+2*a,d=a-o.minX,h=a-o.minY;if(d===0&&h===0&&s.props.w===c&&s.props.h===l)return;const p=new S(d,h).rot(s.rotation);n.batch(()=>{const f=r.map(y=>{const m=n.getShape(y);return{id:m.id,type:m.type,x:m.x+d,y:m.y+h}});f.push({id:s.id,type:s.type,x:s.x-p.x,y:s.y-p.y,props:{w:c,h:l}}),n.updateShapes(f)})}function dv(n){return Ln.isValid(n)?{isValid:!0,hasProtocol:!0}:Ln.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const R9=Cn(function({onClose:t}){const s=N().getOnlySelectedShape();return s&&"url"in s.props&&typeof s.props.url=="string"?u.jsx(L9,{onClose:t,selectedShape:s}):null}),L9=Cn(function({onClose:t,selectedShape:e}){const s=N(),r=Te(),i=v.useRef(null);v.useEffect(()=>{s.timers.requestAnimationFrame(()=>{var y;return(y=i.current)==null?void 0:y.focus()})},[s]);const o=v.useRef(e.props.url),[a,c]=v.useState(()=>{const y=dv(e.props.url),m=y.isValid===!0?y.hasProtocol?e.props.url:"https://"+e.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=v.useCallback(y=>{const m=y.replace(/https?:\/\/(https?:\/\/)/,(b,I)=>I),x=dv(m),w=x.isValid===!0?x.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:w,valid:x.isValid})},[]),d=v.useCallback(()=>{const y=s.getOnlySelectedShape();y&&(s.updateShapes([{id:y.id,type:y.type,props:{url:""}}]),t())},[s,t]),h=v.useCallback(()=>{const y=s.getOnlySelectedShape();y&&(y&&"url"in y.props&&y.props.url!==a.safe&&s.updateShapes([{id:y.id,type:y.type,props:{url:a.safe}}]),t())},[s,t,a]),p=v.useCallback(()=>{t()},[t]);if(!e)return t(),null;const f=o.current&&!a.valid;return u.jsxs(u.Fragment,{children:[u.jsxs(wh,{children:[u.jsx(xh,{children:r("edit-link-dialog.title")}),u.jsx(bh,{})]}),u.jsx(lc,{children:u.jsxs("div",{className:"tlui-edit-link-dialog",children:[u.jsx(By,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:l,onComplete:h,onCancel:p}),u.jsx("div",{children:a.valid?r("edit-link-dialog.detail"):r("edit-link-dialog.invalid-url")})]})}),u.jsxs(Ny,{className:"tlui-dialog__footer__actions",children:[u.jsx(ce,{type:"normal",onClick:p,onTouchEnd:p,children:u.jsx(gt,{children:r("edit-link-dialog.cancel")})}),f?u.jsx(ce,{type:"danger",onTouchEnd:d,onClick:d,children:u.jsx(gt,{children:r("edit-link-dialog.clear")})}):u.jsx(ce,{type:"primary",disabled:!a.valid,onTouchEnd:h,onClick:h,children:u.jsx(gt,{children:r("edit-link-dialog.save")})})]})]})});var zy={exports:{}};zy.exports;(function(n){var t=function(){var e=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function o(c,l){if(!i[c]){i[c]={};for(var d=0;d<c.length;d++)i[c][c.charAt(d)]=d}return i[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(d){return s.charAt(d)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(s,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return e(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),d=new Uint8Array(l.length*2),h=0,p=l.length;h<p;h++){var f=l.charCodeAt(h);d[h*2]=f>>>8,d[h*2+1]=f%256}return d},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),d=0,h=l.length;d<h;d++)l[d]=c[d*2]*256+c[d*2+1];var p=[];return l.forEach(function(f){p.push(e(f))}),a.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return r.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(r,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return e(l)})},_compress:function(c,l,d){if(c==null)return"";var h,p,f={},y={},m="",x="",w="",b=2,I=3,E=2,P=[],C=0,_=0,k;for(k=0;k<c.length;k+=1)if(m=c.charAt(k),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=I++,y[m]=!0),x=w+m,Object.prototype.hasOwnProperty.call(f,x))w=x;else{if(Object.prototype.hasOwnProperty.call(y,w)){if(w.charCodeAt(0)<256){for(h=0;h<E;h++)C=C<<1,_==l-1?(_=0,P.push(d(C)),C=0):_++;for(p=w.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1}else{for(p=1,h=0;h<E;h++)C=C<<1|p,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=0;for(p=w.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1}b--,b==0&&(b=Math.pow(2,E),E++),delete y[w]}else for(p=f[w],h=0;h<E;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1;b--,b==0&&(b=Math.pow(2,E),E++),f[x]=I++,w=String(m)}if(w!==""){if(Object.prototype.hasOwnProperty.call(y,w)){if(w.charCodeAt(0)<256){for(h=0;h<E;h++)C=C<<1,_==l-1?(_=0,P.push(d(C)),C=0):_++;for(p=w.charCodeAt(0),h=0;h<8;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1}else{for(p=1,h=0;h<E;h++)C=C<<1|p,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=0;for(p=w.charCodeAt(0),h=0;h<16;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1}b--,b==0&&(b=Math.pow(2,E),E++),delete y[w]}else for(p=f[w],h=0;h<E;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1;b--,b==0&&(b=Math.pow(2,E),E++)}for(p=2,h=0;h<E;h++)C=C<<1|p&1,_==l-1?(_=0,P.push(d(C)),C=0):_++,p=p>>1;for(;;)if(C=C<<1,_==l-1){P.push(d(C));break}else _++;return P.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,d){var h=[],p=4,f=4,y=3,m="",x=[],w,b,I,E,P,C,_,k={val:d(0),position:l,index:1};for(w=0;w<3;w+=1)h[w]=w;for(I=0,P=Math.pow(2,2),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;switch(I){case 0:for(I=0,P=Math.pow(2,8),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;_=e(I);break;case 1:for(I=0,P=Math.pow(2,16),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;_=e(I);break;case 2:return""}for(h[3]=_,b=_,x.push(_);;){if(k.index>c)return"";for(I=0,P=Math.pow(2,y),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;switch(_=I){case 0:for(I=0,P=Math.pow(2,8),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;h[f++]=e(I),_=f-1,p--;break;case 1:for(I=0,P=Math.pow(2,16),C=1;C!=P;)E=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=d(k.index++)),I|=(E>0?1:0)*C,C<<=1;h[f++]=e(I),_=f-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,y),y++),h[_])m=h[_];else if(_===f)m=b+b.charAt(0);else return null;x.push(m),h[f++]=b+m.charAt(0),p--,b=m,p==0&&(p=Math.pow(2,y),y++)}}};return a}();n!=null?n.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})})(zy);var $9=zy.exports;const P_=ur($9);async function F9(n,t,e){var w,b,I;const{elements:s,files:r}=t,i={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},o=new Map,a=new Map,c=n.getCurrentPageId(),l=new Map,d=[],h=new Set;s.forEach(E=>{if(l.set(E.id,Oe()),E.boundElements!==null)for(const P of E.boundElements)P.type==="text"&&h.add(P.id)});let p=IN;for(const E of s){if(h.has(E.id))continue;const P=l.get(E.id),C={id:P,typeName:"shape",parentId:c,index:p,x:E.x,y:E.y,rotation:0,isLocked:E.locked,opacity:N9(E.opacity),meta:{}};switch(E.angle!==0&&a.set(P,E.angle),E.groupIds&&E.groupIds.length>0?o.has(E.groupIds[0])?(w=o.get(E.groupIds[0]))==null||w.push(P):o.set(E.groupIds[0],[P]):d.push(P),E.type){case"rectangle":case"ellipse":case"diamond":{let _="",k="middle";if(E.boundElements!==null){for(const T of E.boundElements)if(T.type==="text"){const A=s.find(L=>L.id===T.id);A&&(_=A.text,k=G9[A.textAlign])}}const D=E.backgroundColor==="transparent"?E.strokeColor:E.backgroundColor;i.shapes.push({...C,type:"geo",props:{geo:E.type,url:E.link??"",w:E.width,h:E.height,size:Ul[E.strokeWidth]??"draw",color:ka[D]??"black",text:_,align:k,dash:Hl(E),fill:Y9(E)}});break}case"freedraw":{i.shapes.push({...C,type:"draw",props:{dash:Hl(E),size:Ul[E.strokeWidth],color:ka[E.strokeColor]??"black",segments:[{type:"free",points:E.points.map(([_,k,D=.5])=>({x:_,y:k,z:D}))}]}});break}case"line":{if(E.points.slice().length<2)break;const k=nc(E.points.length);i.shapes.push({...C,type:"line",props:{dash:Hl(E),size:Ul[E.strokeWidth],color:ka[E.strokeColor]??"black",spline:E.roundness?"cubic":"line",points:{...Object.fromEntries(E.points.map(([D,T],A)=>{const L=k[A];return[L,{id:L,index:L,x:D,y:T}]}))}}});break}case"arrow":{let _="";if(E.boundElements!==null){for(const L of E.boundElements)if(L.type==="text"){const j=s.find(R=>R.id===L.id);j&&(_=j.text)}}const k=E.points[0],D=E.points[E.points.length-1],T=l.get((b=E.startBinding)==null?void 0:b.elementId),A=l.get((I=E.endBinding)==null?void 0:I.elementId);i.shapes.push({...C,type:"arrow",props:{text:_,bend:V9(E,k,D),dash:Hl(E),size:Ul[E.strokeWidth]??"m",color:ka[E.strokeColor]??"black",start:{x:k[0],y:k[1]},end:{x:D[0],y:D[1]},arrowheadEnd:uv[E.endArrowhead]??"none",arrowheadStart:uv[E.startArrowhead]??"none"}}),T&&i.bindings.push({id:Ii(),typeName:"binding",type:"arrow",fromId:P,toId:T,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),A&&i.bindings.push({id:Ii(),typeName:"binding",type:"arrow",fromId:P,toId:A,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:_,scale:k}=z9(E.fontSize);i.shapes.push({...C,type:"text",props:{size:_,scale:k,font:U9[E.fontFamily]??"draw",color:ka[E.strokeColor]??"black",text:E.text,textAlign:W9[E.textAlign]}});break}case"image":{const _=r[E.fileId];if(!_)break;const k=yi.createId();i.assets.push({id:k,typeName:"asset",type:"image",props:{w:E.width,h:E.height,fileSize:_.size,name:E.id??"Untitled",isAnimated:!1,mimeType:_.mimeType,src:_.dataURL},meta:{}}),i.shapes.push({...C,type:"image",props:{w:E.width,h:E.height,assetId:k}})}}p=Zs(p)}const f=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(i,{point:f,select:!1,preserveIds:!0});for(const E of o.values())if(E.length>1){n.groupShapes(E);const P=n.getShape(E[0]);P!=null&&P.parentId&&pn(P.parentId)&&d.push(P.parentId)}for(const[E,P]of a)n.select(E),n.rotateShapesBy([E],P);const y=ge(d.map(E=>n.getShape(E))),m=Y.Common(y.map(E=>n.getShapePageBounds(E))),x=n.getViewportPageBounds().center;n.updateShapes(y.map(E=>{const P={x:(E.x??0)-(m.x+m.w/2),y:(E.y??0)-(m.y+m.h/2)};return{id:E.id,type:E.type,x:x.x+P.x,y:x.y+P.y}})),n.setSelectedShapes(d)}const N9=n=>{const t=n/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},Ul={1:"s",2:"m",3:"l",4:"xl"},B9={16:"s",20:"m",28:"l",36:"xl"};function z9(n){const t=B9[n];return t?{size:t,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const U9={1:"draw",2:"sans",3:"mono"},ka={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},H9={solid:"draw",dashed:"dashed",dotted:"dotted"},K9={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},G9={left:"start",center:"middle",right:"end"},W9={left:"start",center:"middle",right:"end"},uv={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function V9(n,t,e){let s=0;if(n.points.length>2){const r=new S(t[0],t[1]),i=new S(e[0],e[1]),o=new S(n.points[1][0],n.points[1][1]),a=S.Sub(i,r),c=S.Per(a),l=S.Med(i,r),d=S.Sub(l,c),h=S.Add(l,c),p=S.NearestPointOnLineSegment(d,h,o,!1);s=S.Dist(p,l),S.Clockwise(p,i,l)&&(s*=-1)}return s}const Hl=n=>{let t=H9[n.strokeStyle]??"draw";return t==="draw"&&n.roughness===0&&(t="solid"),t},Y9=n=>n.backgroundColor==="transparent"?"none":K9[n.fillStyle]??"solid";async function E_(n,t,e,s){const i=(await Promise.all(t.map(async o=>await(await Ms(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:i,point:e,ignoreParent:!1,sources:s}),t.forEach(o=>URL.revokeObjectURL(o))}function X9(n,t,e){const s=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0),r=n.getSelectionPageBounds();n.mark("paste"),n.putContentOntoCurrentPage(t,{point:s,select:!0});const i=n.getSelectionPageBounds();r&&i&&(r!=null&&r.collides(i))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function Rg(n,t,e,s){var r;try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&(r=(await Ms(t,{method:"HEAD"})).headers.get("content-type"))!=null&&r.match(/^image\//)){n.mark("paste"),E_(n,[t]);return}}catch(i){i.message!=="Failed to fetch"&&console.error(i)}return n.mark("paste"),await n.putExternalContent({type:"url",point:e,url:t,sources:s})}function q9(n){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=n.trim(),t.body.textContent||t.body.innerText||""}const Z9=n=>{try{const t=new URL(n);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}},J9=n=>{const t=n.split(/[\n\s]/);for(const e of t)try{const s=new URL(e);if(!(s.protocol==="http:"||s.protocol==="https:"))return}catch{return}return $I(t)},Q9=n=>/^<svg/.test(n),eG=["input","select","textarea"];function Jp(n){const{activeElement:t}=document;return n.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||eG.indexOf(t.tagName.toLowerCase())>-1)}const tG=n=>n.types.find(t=>t.match(/^image\//)),Qp=(n,t,e,s)=>{const r=J9(t);if(r)for(const i of r)Rg(n,i,e);else Z9(t)?Rg(n,t,e):Q9(t)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:t,point:e,sources:s})):(n.mark("paste"),n.putExternalContent({type:"text",text:t,point:e,sources:s}))},nG=async(n,t,e)=>{if(n.getEditingShapeId()!==null)return;if(!t)throw Error("No clipboard data");const s=[];for(const r of Object.values(t.items))switch(r.kind){case"file":{s.push({type:"file",source:new Promise(i=>i(r.getAsFile()))});break}case"string":{r.type==="text/html"?s.push({type:"html",source:new Promise(i=>r.getAsString(i))}):r.type==="text/plain"?s.push({type:"text",source:new Promise(i=>r.getAsString(i))}):s.push({type:r.type,source:new Promise(i=>r.getAsString(i))});break}}T_(n,s,e)},__=async(n,t,e)=>{const s=[];for(const r of t){if(tG(r))for(const i of r.types)i.match(/^image\//)&&s.push({type:"blob",source:r.getType(i)});r.types.includes("text/html")&&s.push({type:"html",source:(async()=>{const i=await r.getType("text/html");return await vi.blobToText(i)})()}),r.types.includes("text/uri-list")&&s.push({type:"url",source:(async()=>{const i=await r.getType("text/uri-list");return await vi.blobToText(i)})()}),r.types.includes("text/plain")&&s.push({type:"text",source:(async()=>{const i=await r.getType("text/plain");return await vi.blobToText(i)})()})}return await T_(n,s,e)};async function T_(n,t,e){const s=t.filter(i=>(i.type==="file"||i.type==="blob")&&i.source!==null);if(s.length){const o=(await Promise.all(s.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await E_(n,o,e)}const r=await Promise.all(t.filter(i=>i.type!=="file").map(i=>new Promise(o=>{const a=i;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var d;const l=(d=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:d[1];if(l)try{const h=P_.decompressFromBase64(l);if(h===null){o({type:"error",data:h,reason:"found tldraw data comment but could not parse base64"});return}else{const p=JSON.parse(h);if(p.type!=="application/tldraw"&&o({type:"error",data:p,reason:`found tldraw data comment but JSON was of a different type: ${p.type}`}),typeof p.data=="string"){o({type:"error",data:p,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:p.data});return}}catch{o({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const h=JSON.parse(c);if(h.type==="excalidraw/clipboard"){o({type:"excalidraw",data:h});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const i of r)if(i.type==="tldraw"){X9(n,i.data,e);return}for(const i of r)if(i.type==="excalidraw"){F9(n,i.data,e);return}for(const i of r)if(i.type==="text"&&i.subtype==="html"){const a=new DOMParser().parseFromString(i.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");Qp(n,l,e,r);return}if(!r.some(l=>l.type==="text"&&l.subtype!=="html")&&i.data.trim()){Qp(n,q9(i.data),e,r);return}}for(const i of r)if(i.type==="text"&&i.subtype==="url"){Rg(n,i.data,e,r);return}for(const i of r)if(i.type==="text"&&i.subtype==="text"&&i.data.trim()){Qp(n,i.data,e,r);return}}const _u=async n=>{var s;const t=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const e=P_.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if(!(typeof navigator>"u")){const r=t.shapes.map(i=>n.isShapeOfType(i,"text")||n.isShapeOfType(i,"geo")||n.isShapeOfType(i,"arrow")?i.props.text:n.isShapeOfType(i,"bookmark")||n.isShapeOfType(i,"embed")?i.props.url:null).filter(ON);if((s=navigator.clipboard)!=null&&s.write){const i=new Blob([`<div data-tldraw>${e}</div>`],{type:"text/html"});let o=r.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":i,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${e}</div>`)}};function sG(){const n=N(),t=gs(),e=v.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await _u(n),t("copy",{source:o}))},[n,t]),s=v.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await _u(n),n.deleteShapes(n.getSelectedShapeIds()),t("cut",{source:o}))},[n,t]),r=v.useCallback(async function(o,a,c){n.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(__(n,o,c),t("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{r(l,a,c)}))},[n,t]);return{copy:e,cut:s,paste:r}}function rG(){const n=N(),t=gs(),e=z("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(!e)return;const s=async c=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Jp(n)||(Ee(c),await _u(n),t("copy",{source:"kbd"}))};async function r(c){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Jp(n)||(Ee(c),await _u(n),n.deleteShapes(n.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let i=!1;const o=c=>{c.button===1&&(i=!0,n.timers.requestAnimationFrame(()=>{i=!1}))},a=c=>{if(i){Rt(c);return}n.getEditingShapeId()!==null||Jp(n)||(c.clipboardData&&!n.inputs.shiftKey?nG(n,c.clipboardData):navigator.clipboard.read().then(l=>{Array.isArray(l)&&l[0]instanceof ClipboardItem&&__(n,l,n.inputs.currentPagePoint)}),Ee(c),t("paste",{source:"kbd"}))};return document.addEventListener("copy",s),document.addEventListener("cut",r),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",s),document.removeEventListener("cut",r),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[n,t,e])}async function k_(n,t,e){const{type:s,quality:r,scale:i,width:o,height:a}=e;let[c,l]=await z8(o*i,a*i);c=Math.floor(c),l=Math.floor(l);const d=c/o,h=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),p=await new Promise(y=>{const m=Lo();m.crossOrigin="anonymous",m.onload=async()=>{n.environment.isSafari&&await new Promise(b=>n.timers.setTimeout(b,250));const x=document.createElement("canvas"),w=x.getContext("2d");x.width=c,x.height=l,w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.drawImage(m,0,0,c,l),URL.revokeObjectURL(h),y(x)},m.onerror=()=>{y(null)},m.src=h});if(!p)return null;const f=await new Promise(y=>p.toBlob(m=>{(!m||ft.throwToBlob.get())&&y(null),y(m)},"image/"+s,r));if(!f)return null;if(s==="png"){const y=new DataView(await f.arrayBuffer());return Cs.setPhysChunk(y,d,{type:"image/"+s})}else return f}async function M_(n,t,e){const s=await n.getSvgString(t!=null&&t.length?t:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...e});if(!s)throw new Error("Could not construct SVG.");return s}async function Lg(n,t,e,s={}){var r;switch(e){case"svg":return(r=await M_(n,t,s))==null?void 0:r.svg;case"json":{const i=await n.resolveAssetsInContent(n.getContentFromCurrentPage(t));return JSON.stringify(i)}default:Zt(e)}}async function A_({editor:n,ids:t,format:e,opts:s={}}){switch(e){case"svg":return new Blob([await Lg(n,t,"svg",s)],{type:"text/plain"});case"json":return new Blob([await Lg(n,t,"json",s)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const r=await M_(n,t,s);if(!r)throw new Error("Could not construct image.");const i=await k_(n,r.svg,{type:e,quality:1,scale:2,width:r.width,height:r.height});if(!i)throw new Error("Could not construct image.");return i}default:Zt(e)}}const iG={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function oG(n,t,e,s={}){return{blobPromise:A_({editor:n,ids:t,format:e,opts:s}),mimeType:iG[e]}}function aG(n,t,e="svg",s={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:r,mimeType:i}=oG(n,t,e,s);return window.navigator.clipboard.write([new ClipboardItem({[i]:r})]).catch(o=>(console.error(o),r.then(a=>window.navigator.clipboard.write([new ClipboardItem({[i]:a})]))))}switch(e){case"json":case"svg":return cG(async()=>Lg(n,t,e,s));case"jpeg":case"png":throw new Error("Copy not supported");default:Zt(e)}}async function cG(n){var t,e;await((e=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:e.call(t,await n()))}function lG(){const n=N(),{addToast:t}=ms(),e=Te();return v.useCallback((s,r="svg")=>{aG(n,s,r).catch(()=>{t({id:"copy-fail",severity:"warning",title:e("toast.error.copy-fail.title"),description:e("toast.error.copy-fail.desc")})})},[n,t,e])}async function dG(n,t,e="png",s,r={}){if(!s&&(s=`shapes at ${hv()}`,t.length===1)){const a=n.getShape(t[0]);n.isShapeOfType(a,"frame")?s=a.props.name??"frame":s=`${a.id.replace(/:/,"_")} at ${hv()}`}s+=`.${e}`;const i=await A_({editor:n,ids:t,format:e,opts:r}),o=new File([i],s,{type:i.type});uG(o)}function hv(){const n=new Date,t=String(n.getFullYear()).slice(2),e=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),r=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${t}-${e}-${s} ${r}.${i}.${o}`}function uG(n){const t=document.createElement("a"),e=URL.createObjectURL(n);t.href=e,t.download=n.name,t.click(),URL.revokeObjectURL(e)}function hG(){const n=N(),{addToast:t}=ms(),e=Te();return v.useCallback((s,r="png",i)=>{dG(n,s,r,i,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),t({id:"export-fail",title:e("toast.error.export-fail.title"),description:e("toast.error.export-fail.desc"),severity:"error"})})},[n,t,e])}async function pG(n,t,e){const s=ge(t.map(a=>{const c=n.getShape(a);if(!(!c||n.getShapeUtil(c.type).toSvg===void 0))return c}));if(s.length===0)return;if(s.length===1){const a=s[0];if(!a||n.isShapeOfType(a,"image"))return}const r=[];if(e!==void 0){const a=s.map(c=>({shape:c,bounds:n.getShapeMaskedPageBounds(c).clone().expandBy(e)}));for(let c=0;c<a.length;c++){const l=a[c];if(c===0){r[0]={shapes:[l.shape],bounds:l.bounds};continue}let d=!1;for(const h of r)if(h.bounds.includes(l.bounds)){h.shapes.push(l.shape),h.bounds.expand(l.bounds),d=!0;break}d||r.push({shapes:[l.shape],bounds:l.bounds})}}else{const a=Y.Common(s.map(c=>n.getShapeMaskedPageBounds(c)));r.push({shapes:s,bounds:a})}const i=n.options.flattenImageBoundsPadding;for(const a of r){e!==void 0&&a.bounds.expandBy(-e);const c=await n.getSvgString(a.shapes,{padding:i});if(!(c!=null&&c.svg))continue;const l=new Blob([c.svg],{type:"image/svg+xml"}),d=await n.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});d&&(a.asset=d)}const o=[];return $r(()=>{for(const a of r){const{asset:c,bounds:l,shapes:d}=a;if(!c)continue;const h=n.findCommonAncestor(d)??n.getCurrentPageId();if(!h)continue;let p="a1";for(const w of d)if(w.parentId===h){w.index>p&&(p=w.index);break}let f,y,m;if(pn(h)){const w=n.getShape(h);if(!w)continue;const b=n.getPointInShapeSpace(w,{x:l.x,y:l.y});m=n.getShapePageTransform(h).rotation(),b.sub(new S(i,i).rot(-m)),f=b.x,y=b.y}else f=l.x-i,y=l.y-i,m=0;n.deleteShapes(d),n.createAssets([{...c,id:c.id}]);const x=Oe();n.createShape({id:x,type:"image",index:p,parentId:h,x:f,y,rotation:-m,props:{assetId:c.id,w:l.w+i*2,h:l.h+i*2}}),o.push(x)}}),o}function fG(){const n=N(),t=v.useRef(null),e=v.useRef(null);return v.useCallback(async function(){const r=document.createElement("div"),i=document.createElement("style"),o=(w,b)=>{w&&(w.innerHTML=""),b&&document.head.contains(b)&&document.head.removeChild(b),w&&document.body.contains(w)&&document.body.removeChild(w)};o(t.current,e.current),t.current=r,e.current=i;const a=`tl-print-surface-${Qe()}`;r.className=a,i.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{n.once("tick",()=>{o(r,i)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function d(w,b,I){try{r.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${w.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${I}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${b?"":"hide"}">
          ${b??""}
        </div>
      </div>`}catch(E){console.error(E)}}function h(){n.environment.isChromeForIos?(c(),window.print()):n.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=n.getSelectedShapeIds(),f=n.getCurrentPageId(),y=n.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const w=await n.getSvgString(p,x);if(w){const b=y.find(I=>I.id===f);d(`tldraw â ${b==null?void 0:b.name}`,null,w.svg),h()}}else{const w=n.getCurrentPage(),b=await n.getSvgString(n.getSortedChildIdsForParent(w.id),x);b&&(d(`tldraw â ${w.name}`,null,b.svg),h())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[n])}const j_=v.createContext(null);function gG(n){return Object.fromEntries(n.map(t=>[t.id,t]))}function lo(n,t){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||t}function mG({overrides:n,children:t}){const e=N(),{addDialog:s,clearDialogs:r}=Yi(),{clearToasts:i}=ms(),o=Te(),a=b_(),c=fG(),{cut:l,copy:d,paste:h}=sG(),p=lG(),f=hG(),y=o("document.default-name"),m=gs(),x=v.useMemo(()=>{function w(){return e.isIn("select")||(e.complete(),e.setCurrentTool("select")),!1}function b(){return e.isIn("select")&&e.getSelectedShapeIds().length>0}const E=gG([{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(P){b()&&(w()||(m("edit-link",{source:P}),e.mark("edit-link"),s({component:R9})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(P){m("insert-embed",{source:P}),s({component:x_})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(P){m("insert-media",{source:P}),a()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(P){m("undo",{source:P}),e.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(P){m("redo",{source:P}),e.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("export-as",{format:"svg",source:P}),f(C,"svg",lo(e,y)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("export-as",{format:"png",source:P}),f(C,"png",lo(e,y)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("export-as",{format:"json",source:P}),f(C,"json",lo(e,y)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("export-all-as",{format:"svg",source:P}),f(Array.from(e.getCurrentPageShapeIds()),"svg",lo(e,y)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(P){const C=Array.from(e.getCurrentPageShapeIds().values());C.length!==0&&(m("export-all-as",{format:"png",source:P}),f(C,"png",lo(e,y)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(P){const C=Array.from(e.getCurrentPageShapeIds().values());C.length!==0&&(m("export-all-as",{format:"json",source:P}),f(C,"json",lo(e,y)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("copy-as",{format:"svg",source:P}),p(C,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("copy-as",{format:"png",source:P}),p(C,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(P){let C=e.getSelectedShapeIds();C.length===0&&(C=Array.from(e.getCurrentPageShapeIds().values())),C.length!==0&&(m("copy-as",{format:"json",source:P}),p(C,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(P){if(!b()||w())return;m("toggle-auto-size",{source:P}),e.mark("toggling auto size");const C=e.getSelectedShapes().filter(_=>e.isShapeOfType(_,"text")&&_.props.autoSize===!1);e.updateShapes(C.map(_=>({id:_.id,type:_.type,props:{..._.props,w:8,autoSize:!0}}))),Ne(e,C.map(_=>_.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(P){m("open-embed-link",{source:P});const C=e.getSelectedShapeIds(),_="No embed shapes selected";if(C.length!==1){console.error(_);return}const k=e.getShape(C[0]);if(!k||!e.isShapeOfType(k,"embed")){console.error(_);return}r8(k.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(P){var C,_;if(((C=e.root.getCurrent())==null?void 0:C.id)!=="zoom"&&(m("zoom-tool",{source:P}),!(e.inputs.shiftKey||e.inputs.ctrlKey))){const k=e.root.getCurrent();k&&((_=k.getCurrent())==null?void 0:_.id)==="idle"&&e.setCurrentTool("zoom",{onInteractionEnd:k.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(P){b()&&(w()||e.batch(()=>{m("convert-to-bookmark",{source:P});const C=e.getSelectedShapes(),_=[],k=[];for(const D of C){if(!D||!e.isShapeOfType(D,"embed")||!D.props.url)continue;const T=new S(D.x,D.y);T.rot(-D.rotation),T.add(new S(D.props.w/2-300/2,D.props.h/2-320/2)),T.rot(D.rotation);const A={id:Oe(),type:"bookmark",rotation:D.rotation,x:T.x,y:T.y,opacity:1,props:{url:D.props.url}};_.push(A),k.push(D.id)}e.mark("convert shapes to bookmark"),e.deleteShapes(k),e.createShapes(_)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(P){b()&&(w()||(m("convert-to-embed",{source:P}),e.batch(()=>{const C=e.getSelectedShapeIds(),_=ge(C.map(T=>e.getShape(T))),k=[],D=[];for(const T of _){if(!e.isShapeOfType(T,"bookmark"))continue;const{url:A}=T.props,L=Or(T.props.url);if(!L||!L.definition)continue;const{width:j,height:R}=L.definition,F=new S(T.x,T.y);F.rot(-T.rotation),F.add(new S(T.props.w/2-j/2,T.props.h/2-R/2)),F.rot(T.rotation);const H={id:Oe(),type:"embed",x:F.x,y:F.y,rotation:T.rotation,props:{url:A,w:j,h:R}};k.push(H),D.push(T.id)}e.mark("convert shapes to embed"),e.deleteShapes(D),e.createShapes(k)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(P){if(!b()||w())return;m("duplicate-shapes",{source:P});const C=e.getInstanceState();let _,k;if(C.duplicateProps)_=C.duplicateProps.shapeIds,k=C.duplicateProps.offset;else{_=e.getSelectedShapeIds();const D=Y.Common(ge(_.map(T=>e.getShapePageBounds(T))));k=e.getCameraOptions().isLocked?{x:20,y:20}:{x:D.width+20,y:0}}e.mark("duplicate shapes"),e.duplicateShapes(_,k),C.duplicateProps&&e.updateInstanceState({duplicateProps:{...C.duplicateProps,shapeIds:e.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(P){b()&&(w()||(m("ungroup-shapes",{source:P}),e.mark("ungroup"),e.ungroupShapes(e.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(P){if(!b()||w())return;m("group-shapes",{source:P});const C=e.getOnlySelectedShape();C&&e.isShapeOfType(C,"group")?(e.mark("ungroup"),e.ungroupShapes(e.getSelectedShapeIds())):(e.mark("group"),e.groupShapes(e.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(P){if(!b())return;m("remove-frame",{source:P});const C=e.getSelectedShapes();C.length>0&&C.every(_=>e.isShapeOfType(_,"frame"))&&(e.mark("remove-frame"),j9(e,C.map(_=>_.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(P){if(!b())return;m("fit-frame-to-content",{source:P});const C=e.getOnlySelectedShape();C&&e.isShapeOfType(C,"frame")&&(e.mark("fit-frame-to-content"),O9(e,C.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"left",source:P}),e.mark("align left");const C=e.getSelectedShapeIds();e.alignShapes(C,"left"),Ne(e,C)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"center-horizontal",source:P}),e.mark("align center horizontal");const C=e.getSelectedShapeIds();e.alignShapes(C,"center-horizontal"),Ne(e,C)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"right",source:P}),e.mark("align right");const C=e.getSelectedShapeIds();e.alignShapes(C,"right"),Ne(e,C)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"center-vertical",source:P}),e.mark("align center vertical");const C=e.getSelectedShapeIds();e.alignShapes(C,"center-vertical"),Ne(e,C)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"top",source:P}),e.mark("align top");const C=e.getSelectedShapeIds();e.alignShapes(C,"top"),Ne(e,C)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(P){if(!b()||w())return;m("align-shapes",{operation:"bottom",source:P}),e.mark("align bottom");const C=e.getSelectedShapeIds();e.alignShapes(C,"bottom"),Ne(e,C)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(P){if(!b()||w())return;m("distribute-shapes",{operation:"horizontal",source:P}),e.mark("distribute horizontal");const C=e.getSelectedShapeIds();e.distributeShapes(C,"horizontal"),Ne(e,C)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(P){if(!b()||w())return;m("distribute-shapes",{operation:"vertical",source:P}),e.mark("distribute vertical");const C=e.getSelectedShapeIds();e.distributeShapes(C,"vertical"),Ne(e,C)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(P){if(!b()||w())return;m("stretch-shapes",{operation:"horizontal",source:P}),e.mark("stretch horizontal");const C=e.getSelectedShapeIds();e.stretchShapes(C,"horizontal"),Ne(e,C)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(P){if(!b()||w())return;m("stretch-shapes",{operation:"vertical",source:P}),e.mark("stretch vertical");const C=e.getSelectedShapeIds();e.stretchShapes(C,"vertical"),Ne(e,C)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(P){if(!b()||w())return;m("flip-shapes",{operation:"horizontal",source:P}),e.mark("flip horizontal");const C=e.getSelectedShapeIds();e.flipShapes(C,"horizontal"),Ne(e,C)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(P){if(!b()||w())return;m("flip-shapes",{operation:"vertical",source:P}),e.mark("flip vertical");const C=e.getSelectedShapeIds();e.flipShapes(C,"vertical"),Ne(e,C)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(P){if(!b()||w())return;m("pack-shapes",{source:P}),e.mark("pack");const C=e.getSelectedShapeIds();e.packShapes(C,e.options.adjacentShapeMargin),Ne(e,C)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(P){if(!b()||w())return;m("stack-shapes",{operation:"vertical",source:P}),e.mark("stack-vertical");const C=e.getSelectedShapeIds();e.stackShapes(C,"vertical",16),Ne(e,C)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(P){if(!b()||w())return;m("stack-shapes",{operation:"horizontal",source:P}),e.mark("stack-horizontal");const C=e.getSelectedShapeIds();e.stackShapes(C,"horizontal",16),Ne(e,C)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(P){b()&&(w()||(m("reorder-shapes",{operation:"toFront",source:P}),e.mark("bring to front"),e.bringToFront(e.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(P){b()&&(w()||(m("reorder-shapes",{operation:"forward",source:P}),e.mark("bring forward"),e.bringForward(e.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(P){b()&&(w()||(m("reorder-shapes",{operation:"backward",source:P}),e.mark("send backward"),e.sendBackward(e.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(P){b()&&(w()||(m("reorder-shapes",{operation:"toBack",source:P}),e.mark("send to back"),e.sendToBack(e.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(P){b()&&(w()||(e.mark("cut"),l(P)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(P){b()&&(w()||d(P))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(P){var C;(C=navigator.clipboard)==null||C.read().then(_=>{h(_,P,P==="context-menu"?e.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(P){e.batch(()=>{w()||(m("select-all-shapes",{source:P}),e.mark("select all kbd"),e.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(P){b()&&(w()||(m("select-none-shapes",{source:P}),e.mark("select none"),e.selectNone()))}},{id:"delete",label:"action.delete",kbd:"â«,del,backspace",icon:"trash",onSelect(P){b()&&(w()||(m("delete-shapes",{source:P}),e.mark("delete"),e.deleteShapes(e.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(P){if(!b()||w())return;m("rotate-cw",{source:P}),e.mark("rotate-cw");const C=e.getSelectionRotation()%(Ue/2),_=Nr(C,0)||Nr(C,Ue/2),k=e.getSelectedShapeIds();e.rotateShapesBy(k,Ue/2-(_?0:C)),Ne(e,k)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(P){if(!b()||w())return;m("rotate-ccw",{source:P}),e.mark("rotate-ccw");const C=e.getSelectionRotation()%(Ue/2),_=Nr(C,0),k=e.getSelectedShapeIds();e.rotateShapesBy(k,_?-(Ue/2):-C),Ne(e,k)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(P){m("zoom-in",{source:P}),e.zoomIn(void 0,{animation:{duration:e.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(P){m("zoom-out",{source:P}),e.zoomOut(void 0,{animation:{duration:e.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(P){m("reset-zoom",{source:P}),e.resetZoom(void 0,{animation:{duration:e.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(P){m("zoom-to-fit",{source:P}),e.zoomToFit({animation:{duration:e.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(P){b()&&(w()||(m("zoom-to-selection",{source:P}),e.zoomToSelection({animation:{duration:e.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(P){m("toggle-snap-mode",{source:P}),e.user.updateUserPreferences({isSnapMode:!e.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(P){const C=e.user.getIsDarkMode()?"light":"dark";m("color-scheme",{source:P,value:C}),e.user.updateUserPreferences({colorScheme:C})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(P){m("toggle-wrap-mode",{source:P}),e.user.updateUserPreferences({isWrapMode:!e.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(P){m("toggle-dynamic-size-mode",{source:P}),e.user.updateUserPreferences({isDynamicSizeMode:!e.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(P){m("toggle-reduce-motion",{source:P}),e.user.updateUserPreferences({animationSpeed:e.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(P){m("toggle-edge-scrolling",{source:P}),e.user.updateUserPreferences({edgeScrollSpeed:e.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(P){m("toggle-transparent",{source:P}),e.updateInstanceState({exportBackground:!e.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(P){m("toggle-tool-lock",{source:P}),e.updateInstanceState({isToolLocked:!e.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(P){m("unlock-all",{source:P});const C=[];for(const _ of e.getCurrentPageShapes())_.isLocked&&C.push({id:_.id,type:_.type,isLocked:!1});C.length>0&&e.updateShapes(C)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(P){e.timers.requestAnimationFrame(()=>{e.batch(()=>{m("toggle-focus-mode",{source:P}),r(),i(),e.updateInstanceState({isFocusMode:!e.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(P){m("toggle-grid-mode",{source:P}),e.updateInstanceState({isGridMode:!e.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(P){m("toggle-debug-mode",{source:P}),e.updateInstanceState({isDebugMode:!e.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(P){m("print",{source:P}),c()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(P){m("exit-pen-mode",{source:P}),e.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(P){m("stop-following",{source:P}),e.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(P){m("zoom-to-content",{source:P});const C=e.getSelectionPageBounds()??e.getCurrentPageBounds();C&&e.zoomToBounds(C,{targetZoom:Math.min(1,e.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(P){e.mark("locking"),m("toggle-lock",{source:P}),e.toggleLock(e.getSelectedShapeIds())}},{id:"new-page",label:"context.pages.new-page",onSelect(P){const C=ar.createId(),_=e.getSelectedShapeIds();e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:o("page-menu.new-page-initial-name"),id:C}),e.moveShapesToPage(_,C)}),m("new-page",{source:P})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(P){const C=$n;e.batch(()=>{e.mark("change-color"),e.isIn("select")&&e.setStyleForSelectedShapes(C,"white"),e.setStyleForNextShapes(C,"white")}),m("set-style",{source:P,id:C.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(P){const C=ji;e.batch(()=>{e.mark("change-fill"),e.isIn("select")&&e.setStyleForSelectedShapes(C,"fill"),e.setStyleForNextShapes(C,"fill")}),m("set-style",{source:P,id:C.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async P=>{const C=e.getSelectedShapeIds();if(C.length===0)return;e.mark("flattening to image"),m("flatten-to-image",{source:P});const _=await pG(e,C,e.options.flattenImageBoundsExpand);_!=null&&_.length&&e.setSelectedShapes(_)}}]);return n?n(e,E,void 0):E},[e,m,n,s,a,f,p,l,d,h,r,i,c,o,y]);return u.jsx(j_.Provider,{value:x,children:t})}function ne(){const n=v.useContext(j_);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function dc(n,t){return n?typeof n=="string"?n:t?n[t]??n.default:void 0:void 0}var zd=typeof document<"u"?v.useLayoutEffect:v.useEffect;function Tu(n,t){if(n===t)return!0;if(typeof n!=typeof t)return!1;if(typeof n=="function"&&n.toString()===t.toString())return!0;let e,s,r;if(n&&t&&typeof n=="object"){if(Array.isArray(n)){if(e=n.length,e!==t.length)return!1;for(s=e;s--!==0;)if(!Tu(n[s],t[s]))return!1;return!0}if(r=Object.keys(n),e=r.length,e!==Object.keys(t).length)return!1;for(s=e;s--!==0;)if(!{}.hasOwnProperty.call(t,r[s]))return!1;for(s=e;s--!==0;){const i=r[s];if(!(i==="_owner"&&n.$$typeof)&&!Tu(n[i],t[i]))return!1}return!0}return n!==n&&t!==t}function D_(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function pv(n,t){const e=D_(n);return Math.round(t*e)/e}function fv(n){const t=v.useRef(n);return zd(()=>{t.current=n}),t}function yG(n){n===void 0&&(n={});const{placement:t="bottom",strategy:e="absolute",middleware:s=[],platform:r,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=n,[d,h]=v.useState({x:0,y:0,strategy:e,placement:t,middlewareData:{},isPositioned:!1}),[p,f]=v.useState(s);Tu(p,s)||f(s);const[y,m]=v.useState(null),[x,w]=v.useState(null),b=v.useCallback(U=>{U!==C.current&&(C.current=U,m(U))},[]),I=v.useCallback(U=>{U!==_.current&&(_.current=U,w(U))},[]),E=i||y,P=o||x,C=v.useRef(null),_=v.useRef(null),k=v.useRef(d),D=c!=null,T=fv(c),A=fv(r),L=v.useCallback(()=>{if(!C.current||!_.current)return;const U={placement:t,strategy:e,middleware:p};A.current&&(U.platform=A.current),BA(C.current,_.current,U).then(V=>{const W={...V,isPositioned:!0};j.current&&!Tu(k.current,W)&&(k.current=W,Ic.flushSync(()=>{h(W)}))})},[p,t,e,A]);zd(()=>{l===!1&&k.current.isPositioned&&(k.current.isPositioned=!1,h(U=>({...U,isPositioned:!1})))},[l]);const j=v.useRef(!1);zd(()=>(j.current=!0,()=>{j.current=!1}),[]),zd(()=>{if(E&&(C.current=E),P&&(_.current=P),E&&P){if(T.current)return T.current(E,P,L);L()}},[E,P,L,T,D]);const R=v.useMemo(()=>({reference:C,floating:_,setReference:b,setFloating:I}),[b,I]),F=v.useMemo(()=>({reference:E,floating:P}),[E,P]),H=v.useMemo(()=>{const U={position:e,left:0,top:0};if(!F.floating)return U;const V=pv(F.floating,d.x),W=pv(F.floating,d.y);return a?{...U,transform:"translate("+V+"px, "+W+"px)",...D_(F.floating)>=1.5&&{willChange:"transform"}}:{position:e,left:V,top:W}},[e,a,F.floating,d.x,d.y]);return v.useMemo(()=>({...d,update:L,refs:R,elements:F,floatingStyles:H}),[d,L,R,F,H])}const SG=n=>{function t(e){return{}.hasOwnProperty.call(e,"current")}return{name:"arrow",options:n,fn(e){const{element:s,padding:r}=typeof n=="function"?n(e):n;return s&&t(s)?s.current!=null?sw({element:s.current,padding:r}).fn(e):{}:s?sw({element:s,padding:r}).fn(e):{}}}},wG=(n,t)=>({...zA(n),options:[n,t]}),xG=(n,t)=>({...UA(n),options:[n,t]}),bG=(n,t)=>({...HA(n),options:[n,t]}),vG=(n,t)=>({...KA(n),options:[n,t]}),CG=(n,t)=>({...GA(n),options:[n,t]}),IG=(n,t)=>({...WA(n),options:[n,t]}),PG=(n,t)=>({...SG(n),options:[n,t]});var EG="Arrow",O_=v.forwardRef((n,t)=>{const{children:e,width:s=10,height:r=5,...i}=n;return u.jsx(Ie.svg,{...i,ref:t,width:s,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?e:u.jsx("polygon",{points:"0,0 30,0 15,10"})})});O_.displayName=EG;var _G=O_;function R_(n){const[t,e]=v.useState(void 0);return Gr(()=>{if(n){e({width:n.offsetWidth,height:n.offsetHeight});const s=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const i=r[0];let o,a;if("borderBoxSize"in i){const c=i.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=n.offsetWidth,a=n.offsetHeight;e({width:o,height:a})});return s.observe(n,{box:"border-box"}),()=>s.unobserve(n)}else e(void 0)},[n]),t}var Uy="Popper",[L_,Ch]=Bs(Uy),[TG,$_]=L_(Uy),F_=n=>{const{__scopePopper:t,children:e}=n,[s,r]=v.useState(null);return u.jsx(TG,{scope:t,anchor:s,onAnchorChange:r,children:e})};F_.displayName=Uy;var N_="PopperAnchor",B_=v.forwardRef((n,t)=>{const{__scopePopper:e,virtualRef:s,...r}=n,i=$_(N_,e),o=v.useRef(null),a=He(t,o);return v.useEffect(()=>{i.onAnchorChange((s==null?void 0:s.current)||o.current)}),s?null:u.jsx(Ie.div,{...r,ref:a})});B_.displayName=N_;var Hy="PopperContent",[kG,MG]=L_(Hy),z_=v.forwardRef((n,t)=>{var Ke,Ye,ke,st,Re,_n;const{__scopePopper:e,side:s="bottom",sideOffset:r=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:y,...m}=n,x=$_(Hy,e),[w,b]=v.useState(null),I=He(t,Tt=>b(Tt)),[E,P]=v.useState(null),C=R_(E),_=(C==null?void 0:C.width)??0,k=(C==null?void 0:C.height)??0,D=s+(i!=="center"?"-"+i:""),T=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},A=Array.isArray(l)?l:[l],L=A.length>0,j={padding:T,boundary:A.filter(jG),altBoundary:L},{refs:R,floatingStyles:F,placement:H,isPositioned:U,middlewareData:V}=yG({strategy:"fixed",placement:D,whileElementsMounted:(...Tt)=>VA(...Tt,{animationFrame:f==="always"}),elements:{reference:x.anchor},middleware:[wG({mainAxis:r+k,alignmentAxis:o}),c&&xG({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?bG():void 0,...j}),c&&vG({...j}),CG({...j,apply:({elements:Tt,rects:cn,availableWidth:ut,availableHeight:Bt})=>{const{width:Us,height:ha}=cn.reference,xr=Tt.floating.style;xr.setProperty("--radix-popper-available-width",`${ut}px`),xr.setProperty("--radix-popper-available-height",`${Bt}px`),xr.setProperty("--radix-popper-anchor-width",`${Us}px`),xr.setProperty("--radix-popper-anchor-height",`${ha}px`)}}),E&&PG({element:E,padding:a}),DG({arrowWidth:_,arrowHeight:k}),p&&IG({strategy:"referenceHidden",...j})]}),[W,te]=K_(H),le=Ft(y);Gr(()=>{U&&(le==null||le())},[U,le]);const Se=(Ke=V.arrow)==null?void 0:Ke.x,be=(Ye=V.arrow)==null?void 0:Ye.y,nt=((ke=V.arrow)==null?void 0:ke.centerOffset)!==0,[ie,yt]=v.useState();return Gr(()=>{w&&yt(window.getComputedStyle(w).zIndex)},[w]),u.jsx("div",{ref:R.setFloating,"data-radix-popper-content-wrapper":"",style:{...F,transform:U?F.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ie,"--radix-popper-transform-origin":[(st=V.transformOrigin)==null?void 0:st.x,(Re=V.transformOrigin)==null?void 0:Re.y].join(" "),...((_n=V.hide)==null?void 0:_n.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:u.jsx(kG,{scope:e,placedSide:W,onArrowChange:P,arrowX:Se,arrowY:be,shouldHideArrow:nt,children:u.jsx(Ie.div,{"data-side":W,"data-align":te,...m,ref:I,style:{...m.style,animation:U?void 0:"none"}})})})});z_.displayName=Hy;var U_="PopperArrow",AG={top:"bottom",right:"left",bottom:"top",left:"right"},H_=v.forwardRef(function(t,e){const{__scopePopper:s,...r}=t,i=MG(U_,s),o=AG[i.placedSide];return u.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:u.jsx(_G,{...r,ref:e,style:{...r.style,display:"block"}})})});H_.displayName=U_;function jG(n){return n!==null}var DG=n=>({name:"transformOrigin",options:n,fn(t){var x,w,b;const{placement:e,rects:s,middlewareData:r}=t,o=((x=r.arrow)==null?void 0:x.centerOffset)!==0,a=o?0:n.arrowWidth,c=o?0:n.arrowHeight,[l,d]=K_(e),h={start:"0%",center:"50%",end:"100%"}[d],p=(((w=r.arrow)==null?void 0:w.x)??0)+a/2,f=(((b=r.arrow)==null?void 0:b.y)??0)+c/2;let y="",m="";return l==="bottom"?(y=o?h:`${p}px`,m=`${-c}px`):l==="top"?(y=o?h:`${p}px`,m=`${s.floating.height+c}px`):l==="right"?(y=`${-c}px`,m=o?h:`${f}px`):l==="left"&&(y=`${s.floating.width+c}px`,m=o?h:`${f}px`),{data:{x:y,y:m}}}});function K_(n){const[t,e="center"]=n.split("-");return[t,e]}var Ky=F_,Gy=B_,G_=z_,W_=H_,Wy="Popover",[V_,Ate]=Bs(Wy,[Ch]),Hc=Ch(),[OG,si]=V_(Wy),Y_=n=>{const{__scopePopover:t,children:e,open:s,defaultOpen:r,onOpenChange:i,modal:o=!1}=n,a=Hc(t),c=v.useRef(null),[l,d]=v.useState(!1),[h=!1,p]=ni({prop:s,defaultProp:r,onChange:i});return u.jsx(Ky,{...a,children:u.jsx(OG,{scope:t,contentId:rr(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:v.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:l,onCustomAnchorAdd:v.useCallback(()=>d(!0),[]),onCustomAnchorRemove:v.useCallback(()=>d(!1),[]),modal:o,children:e})})};Y_.displayName=Wy;var X_="PopoverAnchor",RG=v.forwardRef((n,t)=>{const{__scopePopover:e,...s}=n,r=si(X_,e),i=Hc(e),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=r;return v.useEffect(()=>(o(),()=>a()),[o,a]),u.jsx(Gy,{...i,...s,ref:t})});RG.displayName=X_;var q_="PopoverTrigger",Z_=v.forwardRef((n,t)=>{const{__scopePopover:e,...s}=n,r=si(q_,e),i=Hc(e),o=He(t,r.triggerRef),a=u.jsx(Ie.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":n1(r.open),...s,ref:o,onClick:J(n.onClick,r.onOpenToggle)});return r.hasCustomAnchor?a:u.jsx(Gy,{asChild:!0,...i,children:a})});Z_.displayName=q_;var Vy="PopoverPortal",[LG,$G]=V_(Vy,{forceMount:void 0}),J_=n=>{const{__scopePopover:t,forceMount:e,children:s,container:r}=n,i=si(Vy,t);return u.jsx(LG,{scope:t,forceMount:e,children:u.jsx(ps,{present:e||i.open,children:u.jsx(Uc,{asChild:!0,container:r,children:s})})})};J_.displayName=Vy;var Wo="PopoverContent",Q_=v.forwardRef((n,t)=>{const e=$G(Wo,n.__scopePopover),{forceMount:s=e.forceMount,...r}=n,i=si(Wo,n.__scopePopover);return u.jsx(ps,{present:s||i.open,children:i.modal?u.jsx(FG,{...r,ref:t}):u.jsx(NG,{...r,ref:t})})});Q_.displayName=Wo;var FG=v.forwardRef((n,t)=>{const e=si(Wo,n.__scopePopover),s=v.useRef(null),r=He(t,s),i=v.useRef(!1);return v.useEffect(()=>{const o=s.current;if(o)return My(o)},[]),u.jsx(gh,{as:Li,allowPinchZoom:!0,children:u.jsx(e1,{...n,ref:r,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:J(n.onCloseAutoFocus,o=>{var a;o.preventDefault(),i.current||(a=e.triggerRef.current)==null||a.focus()}),onPointerDownOutside:J(n.onPointerDownOutside,o=>{const a=o.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,l=a.button===2||c;i.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:J(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),NG=v.forwardRef((n,t)=>{const e=si(Wo,n.__scopePopover),s=v.useRef(!1),r=v.useRef(!1);return u.jsx(e1,{...n,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,i),i.defaultPrevented||(s.current||(a=e.triggerRef.current)==null||a.focus(),i.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:i=>{var c,l;(c=n.onInteractOutside)==null||c.call(n,i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=i.target;((l=e.triggerRef.current)==null?void 0:l.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&r.current&&i.preventDefault()}})}),e1=v.forwardRef((n,t)=>{const{__scopePopover:e,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:d,...h}=n,p=si(Wo,e),f=Hc(e);return ky(),u.jsx(ph,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:i,children:u.jsx(zc,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>p.onOpenChange(!1),children:u.jsx(G_,{"data-state":n1(p.open),role:"dialog",id:p.contentId,...f,...h,ref:t,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),t1="PopoverClose",BG=v.forwardRef((n,t)=>{const{__scopePopover:e,...s}=n,r=si(t1,e);return u.jsx(Ie.button,{type:"button",...s,ref:t,onClick:J(n.onClick,()=>r.onOpenChange(!1))})});BG.displayName=t1;var zG="PopoverArrow",UG=v.forwardRef((n,t)=>{const{__scopePopover:e,...s}=n,r=Hc(e);return u.jsx(W_,{...r,...s,ref:t})});UG.displayName=zG;function n1(n){return n?"open":"closed"}var HG=Y_,KG=Z_,GG=J_,WG=Q_;function ri(n,t){const e=N(),s=v.useRef(!1),r=gs(),i=v.useCallback(a=>{s.current=a,e.batch(()=>{a?(e.complete(),e.addOpenMenu(n)):e.updateInstanceState({openMenus:e.getOpenMenus().filter(c=>!c.startsWith(n))}),t==null||t(a)})},[e,n,t]),o=z("is menu open",()=>e.getOpenMenus().includes(n),[e,n]);return v.useEffect(()=>(s.current&&(r("open-menu",{source:"unknown",id:n}),e.addOpenMenu(n)),()=>{s.current&&(e.deleteOpenMenu(n),e.getOpenMenus().forEach(a=>{a.startsWith(n)&&(r("close-menu",{source:"unknown",id:n}),e.deleteOpenMenu(a))}),s.current=!1)}),[e,n,r]),[o,i]}function Yy({id:n,children:t,onOpenChange:e,open:s}){const[r,i]=ri(n,e);return u.jsx(HG,{onOpenChange:i,open:s||r,children:u.jsx("div",{className:"tlui-popover",children:t})})}function Xy({children:n}){return u.jsx(KG,{asChild:!0,dir:"ltr",children:n})}function qy({side:n,children:t,align:e="center",sideOffset:s=8,alignOffset:r=0}){const i=Qt();return u.jsx(GG,{container:i,children:u.jsx(WG,{className:"tlui-popover__content",side:n,sideOffset:s,align:e,alignOffset:r,dir:"ltr",children:t})})}const s1=v.createContext(null);function Ih(){const n=v.useContext(s1);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function Jn({type:n,sourceId:t,children:e}){return u.jsx(s1.Provider,{value:{type:n,sourceId:t},children:e})}function VG(n){return n.getSelectedShapeIds().map(s=>n.getShape(s)).filter(s=>{if(!s)return!1;if(n.isShapeOfType(s,"arrow")){const r=gn(n,s);if(r.start||r.end)return!1}return!0})}const r1=()=>{const n=N();return z("threeStackableItems",()=>VG(n).length>2,[n])},mr=()=>{const n=N();return z("isInSelectState",()=>n.isIn("select"),[n])},i1=()=>{const n=N();return z("allow group",()=>{const t=n.getSelectedShapes();if(t.length<2)return!1;for(const e of t)if(n.isShapeOfType(e,"arrow")){const s=gn(n,e);if(s.start&&!t.some(r=>r.id===s.start.toId)||s.end&&!t.some(r=>r.id===s.end.toId))return!1}return!0},[n])},o1=()=>{const n=N();return z("allowUngroup",()=>n.getSelectedShapeIds().some(t=>{var e;return((e=n.getShape(t))==null?void 0:e.type)==="group"}),[n])},YG=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function XG(n,t){const e=N();return z("selectedShapes",()=>e.getSelectedShapes().length>=n,[e,n,t])}function an(n,t){const e=N();return z("selectedShapes",()=>{const s=e.getSelectedShapes().filter(r=>!e.isShapeOrAncestorLocked(r)).length;return n===void 0?s:s>=n},[e])}function qG(){const n=N();return z("showAutoSizeToggle",()=>{const t=n.getSelectedShapes();return t.length===1&&n.isShapeOfType(t[0],"text")&&t[0].props.autoSize===!1},[n])}function a1(){const n=N();return z("hasLinkShapeSelected",()=>{const t=n.getOnlySelectedShape();return!!(t&&t.type!=="embed"&&"url"in t.props&&!t.isLocked)},[n])}function ZG(){const n=N();return z("onlyFlippableShape",()=>{const t=n.getOnlySelectedShape();return t&&(n.isShapeOfType(t,"group")||n.isShapeOfType(t,"arrow")||n.isShapeOfType(t,"line")||n.isShapeOfType(t,"draw"))},[n])}function c1(){const n=N();return z("useCanRedo",()=>n.getCanRedo(),[n])}function l1(){const n=N();return z("useCanUndo",()=>n.getCanUndo(),[n])}var JG=v.createContext(void 0);function Zy(n){const t=v.useContext(JG);return n||t||"ltr"}var ef="rovingFocusGroup.onEntryFocus",QG={bubbles:!1,cancelable:!0},Ph="RovingFocusGroup",[$g,d1,eW]=mh(Ph),[tW,u1]=Bs(Ph,[eW]),[nW,sW]=tW(Ph),h1=v.forwardRef((n,t)=>u.jsx($g.Provider,{scope:n.__scopeRovingFocusGroup,children:u.jsx($g.Slot,{scope:n.__scopeRovingFocusGroup,children:u.jsx(rW,{...n,ref:t})})}));h1.displayName=Ph;var rW=v.forwardRef((n,t)=>{const{__scopeRovingFocusGroup:e,orientation:s,loop:r=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:d=!1,...h}=n,p=v.useRef(null),f=He(t,p),y=Zy(i),[m=null,x]=ni({prop:o,defaultProp:a,onChange:c}),[w,b]=v.useState(!1),I=Ft(l),E=d1(e),P=v.useRef(!1),[C,_]=v.useState(0);return v.useEffect(()=>{const k=p.current;if(k)return k.addEventListener(ef,I),()=>k.removeEventListener(ef,I)},[I]),u.jsx(nW,{scope:e,orientation:s,dir:y,loop:r,currentTabStopId:m,onItemFocus:v.useCallback(k=>x(k),[x]),onItemShiftTab:v.useCallback(()=>b(!0),[]),onFocusableItemAdd:v.useCallback(()=>_(k=>k+1),[]),onFocusableItemRemove:v.useCallback(()=>_(k=>k-1),[]),children:u.jsx(Ie.div,{tabIndex:w||C===0?-1:0,"data-orientation":s,...h,ref:f,style:{outline:"none",...n.style},onMouseDown:J(n.onMouseDown,()=>{P.current=!0}),onFocus:J(n.onFocus,k=>{const D=!P.current;if(k.target===k.currentTarget&&D&&!w){const T=new CustomEvent(ef,QG);if(k.currentTarget.dispatchEvent(T),!T.defaultPrevented){const A=E().filter(H=>H.focusable),L=A.find(H=>H.active),j=A.find(H=>H.id===m),F=[L,j,...A].filter(Boolean).map(H=>H.ref.current);g1(F,d)}}P.current=!1}),onBlur:J(n.onBlur,()=>b(!1))})})}),p1="RovingFocusGroupItem",f1=v.forwardRef((n,t)=>{const{__scopeRovingFocusGroup:e,focusable:s=!0,active:r=!1,tabStopId:i,...o}=n,a=rr(),c=i||a,l=sW(p1,e),d=l.currentTabStopId===c,h=d1(e),{onFocusableItemAdd:p,onFocusableItemRemove:f}=l;return v.useEffect(()=>{if(s)return p(),()=>f()},[s,p,f]),u.jsx($g.ItemSlot,{scope:e,id:c,focusable:s,active:r,children:u.jsx(Ie.span,{tabIndex:d?0:-1,"data-orientation":l.orientation,...o,ref:t,onMouseDown:J(n.onMouseDown,y=>{s?l.onItemFocus(c):y.preventDefault()}),onFocus:J(n.onFocus,()=>l.onItemFocus(c)),onKeyDown:J(n.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){l.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const m=aW(y,l.orientation,l.dir);if(m!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let w=h().filter(b=>b.focusable).map(b=>b.ref.current);if(m==="last")w.reverse();else if(m==="prev"||m==="next"){m==="prev"&&w.reverse();const b=w.indexOf(y.currentTarget);w=l.loop?cW(w,b+1):w.slice(b+1)}setTimeout(()=>g1(w))}})})})});f1.displayName=p1;var iW={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function oW(n,t){return t!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function aW(n,t,e){const s=oW(n.key,e);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return iW[s]}function g1(n,t=!1){const e=document.activeElement;for(const s of n)if(s===e||(s.focus({preventScroll:t}),document.activeElement!==e))return}function cW(n,t){return n.map((e,s)=>n[(t+s)%n.length])}var lW=h1,dW=f1,Fg=["Enter"," "],uW=["ArrowDown","PageUp","Home"],m1=["ArrowUp","PageDown","End"],hW=[...uW,...m1],pW={ltr:[...Fg,"ArrowRight"],rtl:[...Fg,"ArrowLeft"]},fW={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Kc="Menu",[uc,gW,mW]=mh(Kc),[Xi,Eh]=Bs(Kc,[mW,Ch,u1]),Gc=Ch(),y1=u1(),[S1,ii]=Xi(Kc),[yW,Wc]=Xi(Kc),w1=n=>{const{__scopeMenu:t,open:e=!1,children:s,dir:r,onOpenChange:i,modal:o=!0}=n,a=Gc(t),[c,l]=v.useState(null),d=v.useRef(!1),h=Ft(i),p=Zy(r);return v.useEffect(()=>{const f=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),u.jsx(Ky,{...a,children:u.jsx(S1,{scope:t,open:e,onOpenChange:h,content:c,onContentChange:l,children:u.jsx(yW,{scope:t,onClose:v.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:p,modal:o,children:s})})})};w1.displayName=Kc;var SW="MenuAnchor",Jy=v.forwardRef((n,t)=>{const{__scopeMenu:e,...s}=n,r=Gc(e);return u.jsx(Gy,{...r,...s,ref:t})});Jy.displayName=SW;var Qy="MenuPortal",[wW,x1]=Xi(Qy,{forceMount:void 0}),b1=n=>{const{__scopeMenu:t,forceMount:e,children:s,container:r}=n,i=ii(Qy,t);return u.jsx(wW,{scope:t,forceMount:e,children:u.jsx(ps,{present:e||i.open,children:u.jsx(Uc,{asChild:!0,container:r,children:s})})})};b1.displayName=Qy;var Zn="MenuContent",[xW,eS]=Xi(Zn),v1=v.forwardRef((n,t)=>{const e=x1(Zn,n.__scopeMenu),{forceMount:s=e.forceMount,...r}=n,i=ii(Zn,n.__scopeMenu),o=Wc(Zn,n.__scopeMenu);return u.jsx(uc.Provider,{scope:n.__scopeMenu,children:u.jsx(ps,{present:s||i.open,children:u.jsx(uc.Slot,{scope:n.__scopeMenu,children:o.modal?u.jsx(bW,{...r,ref:t}):u.jsx(vW,{...r,ref:t})})})})}),bW=v.forwardRef((n,t)=>{const e=ii(Zn,n.__scopeMenu),s=v.useRef(null),r=He(t,s);return v.useEffect(()=>{const i=s.current;if(i)return My(i)},[]),u.jsx(tS,{...n,ref:r,trapFocus:e.open,disableOutsidePointerEvents:e.open,disableOutsideScroll:!0,onFocusOutside:J(n.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>e.onOpenChange(!1)})}),vW=v.forwardRef((n,t)=>{const e=ii(Zn,n.__scopeMenu);return u.jsx(tS,{...n,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>e.onOpenChange(!1)})}),tS=v.forwardRef((n,t)=>{const{__scopeMenu:e,loop:s=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f,disableOutsideScroll:y,...m}=n,x=ii(Zn,e),w=Wc(Zn,e),b=Gc(e),I=y1(e),E=gW(e),[P,C]=v.useState(null),_=v.useRef(null),k=He(t,_,x.onContentChange),D=v.useRef(0),T=v.useRef(""),A=v.useRef(0),L=v.useRef(null),j=v.useRef("right"),R=v.useRef(0),F=y?gh:v.Fragment,H=y?{as:Li,allowPinchZoom:!0}:void 0,U=W=>{var Ke,Ye;const te=T.current+W,le=E().filter(ke=>!ke.disabled),Se=document.activeElement,be=(Ke=le.find(ke=>ke.ref.current===Se))==null?void 0:Ke.textValue,nt=le.map(ke=>ke.textValue),ie=OW(nt,te,be),yt=(Ye=le.find(ke=>ke.textValue===ie))==null?void 0:Ye.ref.current;(function ke(st){T.current=st,window.clearTimeout(D.current),st!==""&&(D.current=window.setTimeout(()=>ke(""),1e3))})(te),yt&&setTimeout(()=>yt.focus())};v.useEffect(()=>()=>window.clearTimeout(D.current),[]),ky();const V=v.useCallback(W=>{var le,Se;return j.current===((le=L.current)==null?void 0:le.side)&&LW(W,(Se=L.current)==null?void 0:Se.area)},[]);return u.jsx(xW,{scope:e,searchRef:T,onItemEnter:v.useCallback(W=>{V(W)&&W.preventDefault()},[V]),onItemLeave:v.useCallback(W=>{var te;V(W)||((te=_.current)==null||te.focus(),C(null))},[V]),onTriggerLeave:v.useCallback(W=>{V(W)&&W.preventDefault()},[V]),pointerGraceTimerRef:A,onPointerGraceIntentChange:v.useCallback(W=>{L.current=W},[]),children:u.jsx(F,{...H,children:u.jsx(ph,{asChild:!0,trapped:r,onMountAutoFocus:J(i,W=>{var te;W.preventDefault(),(te=_.current)==null||te.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:u.jsx(zc,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:p,onDismiss:f,children:u.jsx(lW,{asChild:!0,...I,dir:w.dir,orientation:"vertical",loop:s,currentTabStopId:P,onCurrentTabStopIdChange:C,onEntryFocus:J(c,W=>{w.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:u.jsx(G_,{role:"menu","aria-orientation":"vertical","data-state":N1(x.open),"data-radix-menu-content":"",dir:w.dir,...b,...m,ref:k,style:{outline:"none",...m.style},onKeyDown:J(m.onKeyDown,W=>{const le=W.target.closest("[data-radix-menu-content]")===W.currentTarget,Se=W.ctrlKey||W.altKey||W.metaKey,be=W.key.length===1;le&&(W.key==="Tab"&&W.preventDefault(),!Se&&be&&U(W.key));const nt=_.current;if(W.target!==nt||!hW.includes(W.key))return;W.preventDefault();const yt=E().filter(Ke=>!Ke.disabled).map(Ke=>Ke.ref.current);m1.includes(W.key)&&yt.reverse(),jW(yt)}),onBlur:J(n.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(D.current),T.current="")}),onPointerMove:J(n.onPointerMove,hc(W=>{const te=W.target,le=R.current!==W.clientX;if(W.currentTarget.contains(te)&&le){const Se=W.clientX>R.current?"right":"left";j.current=Se,R.current=W.clientX}}))})})})})})})});v1.displayName=Zn;var CW="MenuGroup",nS=v.forwardRef((n,t)=>{const{__scopeMenu:e,...s}=n;return u.jsx(Ie.div,{role:"group",...s,ref:t})});nS.displayName=CW;var IW="MenuLabel",C1=v.forwardRef((n,t)=>{const{__scopeMenu:e,...s}=n;return u.jsx(Ie.div,{...s,ref:t})});C1.displayName=IW;var ku="MenuItem",gv="menu.itemSelect",_h=v.forwardRef((n,t)=>{const{disabled:e=!1,onSelect:s,...r}=n,i=v.useRef(null),o=Wc(ku,n.__scopeMenu),a=eS(ku,n.__scopeMenu),c=He(t,i),l=v.useRef(!1),d=()=>{const h=i.current;if(!e&&h){const p=new CustomEvent(gv,{bubbles:!0,cancelable:!0});h.addEventListener(gv,f=>s==null?void 0:s(f),{once:!0}),Ty(h,p),p.defaultPrevented?l.current=!1:o.onClose()}};return u.jsx(I1,{...r,ref:c,disabled:e,onClick:J(n.onClick,d),onPointerDown:h=>{var p;(p=n.onPointerDown)==null||p.call(n,h),l.current=!0},onPointerUp:J(n.onPointerUp,h=>{var p;l.current||(p=h.currentTarget)==null||p.click()}),onKeyDown:J(n.onKeyDown,h=>{const p=a.searchRef.current!=="";e||p&&h.key===" "||Fg.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});_h.displayName=ku;var I1=v.forwardRef((n,t)=>{const{__scopeMenu:e,disabled:s=!1,textValue:r,...i}=n,o=eS(ku,e),a=y1(e),c=v.useRef(null),l=He(t,c),[d,h]=v.useState(!1),[p,f]=v.useState("");return v.useEffect(()=>{const y=c.current;y&&f((y.textContent??"").trim())},[i.children]),u.jsx(uc.ItemSlot,{scope:e,disabled:s,textValue:r??p,children:u.jsx(dW,{asChild:!0,...a,focusable:!s,children:u.jsx(Ie.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:l,onPointerMove:J(n.onPointerMove,hc(y=>{s?o.onItemLeave(y):(o.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:J(n.onPointerLeave,hc(y=>o.onItemLeave(y))),onFocus:J(n.onFocus,()=>h(!0)),onBlur:J(n.onBlur,()=>h(!1))})})})}),PW="MenuCheckboxItem",P1=v.forwardRef((n,t)=>{const{checked:e=!1,onCheckedChange:s,...r}=n;return u.jsx(M1,{scope:n.__scopeMenu,checked:e,children:u.jsx(_h,{role:"menuitemcheckbox","aria-checked":Mu(e)?"mixed":e,...r,ref:t,"data-state":iS(e),onSelect:J(r.onSelect,()=>s==null?void 0:s(Mu(e)?!0:!e),{checkForDefaultPrevented:!1})})})});P1.displayName=PW;var E1="MenuRadioGroup",[EW,_W]=Xi(E1,{value:void 0,onValueChange:()=>{}}),_1=v.forwardRef((n,t)=>{const{value:e,onValueChange:s,...r}=n,i=Ft(s);return u.jsx(EW,{scope:n.__scopeMenu,value:e,onValueChange:i,children:u.jsx(nS,{...r,ref:t})})});_1.displayName=E1;var T1="MenuRadioItem",k1=v.forwardRef((n,t)=>{const{value:e,...s}=n,r=_W(T1,n.__scopeMenu),i=e===r.value;return u.jsx(M1,{scope:n.__scopeMenu,checked:i,children:u.jsx(_h,{role:"menuitemradio","aria-checked":i,...s,ref:t,"data-state":iS(i),onSelect:J(s.onSelect,()=>{var o;return(o=r.onValueChange)==null?void 0:o.call(r,e)},{checkForDefaultPrevented:!1})})})});k1.displayName=T1;var sS="MenuItemIndicator",[M1,TW]=Xi(sS,{checked:!1}),A1=v.forwardRef((n,t)=>{const{__scopeMenu:e,forceMount:s,...r}=n,i=TW(sS,e);return u.jsx(ps,{present:s||Mu(i.checked)||i.checked===!0,children:u.jsx(Ie.span,{...r,ref:t,"data-state":iS(i.checked)})})});A1.displayName=sS;var kW="MenuSeparator",j1=v.forwardRef((n,t)=>{const{__scopeMenu:e,...s}=n;return u.jsx(Ie.div,{role:"separator","aria-orientation":"horizontal",...s,ref:t})});j1.displayName=kW;var MW="MenuArrow",D1=v.forwardRef((n,t)=>{const{__scopeMenu:e,...s}=n,r=Gc(e);return u.jsx(W_,{...r,...s,ref:t})});D1.displayName=MW;var rS="MenuSub",[AW,O1]=Xi(rS),R1=n=>{const{__scopeMenu:t,children:e,open:s=!1,onOpenChange:r}=n,i=ii(rS,t),o=Gc(t),[a,c]=v.useState(null),[l,d]=v.useState(null),h=Ft(r);return v.useEffect(()=>(i.open===!1&&h(!1),()=>h(!1)),[i.open,h]),u.jsx(Ky,{...o,children:u.jsx(S1,{scope:t,open:s,onOpenChange:h,content:l,onContentChange:d,children:u.jsx(AW,{scope:t,contentId:rr(),triggerId:rr(),trigger:a,onTriggerChange:c,children:e})})})};R1.displayName=rS;var za="MenuSubTrigger",L1=v.forwardRef((n,t)=>{const e=ii(za,n.__scopeMenu),s=Wc(za,n.__scopeMenu),r=O1(za,n.__scopeMenu),i=eS(za,n.__scopeMenu),o=v.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=i,l={__scopeMenu:n.__scopeMenu},d=v.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return v.useEffect(()=>d,[d]),v.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),u.jsx(Jy,{asChild:!0,...l,children:u.jsx(I1,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":e.open,"aria-controls":r.contentId,"data-state":N1(e.open),...n,ref:hh(t,r.onTriggerChange),onClick:h=>{var p;(p=n.onClick)==null||p.call(n,h),!(n.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),e.open||e.onOpenChange(!0))},onPointerMove:J(n.onPointerMove,hc(h=>{i.onItemEnter(h),!h.defaultPrevented&&!n.disabled&&!e.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{e.onOpenChange(!0),d()},100))})),onPointerLeave:J(n.onPointerLeave,hc(h=>{var f,y;d();const p=(f=e.content)==null?void 0:f.getBoundingClientRect();if(p){const m=(y=e.content)==null?void 0:y.dataset.side,x=m==="right",w=x?-5:5,b=p[x?"left":"right"],I=p[x?"right":"left"];i.onPointerGraceIntentChange({area:[{x:h.clientX+w,y:h.clientY},{x:b,y:p.top},{x:I,y:p.top},{x:I,y:p.bottom},{x:b,y:p.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(h),h.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:J(n.onKeyDown,h=>{var f;const p=i.searchRef.current!=="";n.disabled||p&&h.key===" "||pW[s.dir].includes(h.key)&&(e.onOpenChange(!0),(f=e.content)==null||f.focus(),h.preventDefault())})})})});L1.displayName=za;var $1="MenuSubContent",F1=v.forwardRef((n,t)=>{const e=x1(Zn,n.__scopeMenu),{forceMount:s=e.forceMount,...r}=n,i=ii(Zn,n.__scopeMenu),o=Wc(Zn,n.__scopeMenu),a=O1($1,n.__scopeMenu),c=v.useRef(null),l=He(t,c);return u.jsx(uc.Provider,{scope:n.__scopeMenu,children:u.jsx(ps,{present:s||i.open,children:u.jsx(uc.Slot,{scope:n.__scopeMenu,children:u.jsx(tS,{id:a.contentId,"aria-labelledby":a.triggerId,...r,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var h;o.isUsingKeyboardRef.current&&((h=c.current)==null||h.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:J(n.onFocusOutside,d=>{d.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:J(n.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:J(n.onKeyDown,d=>{var f;const h=d.currentTarget.contains(d.target),p=fW[o.dir].includes(d.key);h&&p&&(i.onOpenChange(!1),(f=a.trigger)==null||f.focus(),d.preventDefault())})})})})})});F1.displayName=$1;function N1(n){return n?"open":"closed"}function Mu(n){return n==="indeterminate"}function iS(n){return Mu(n)?"indeterminate":n?"checked":"unchecked"}function jW(n){const t=document.activeElement;for(const e of n)if(e===t||(e.focus(),document.activeElement!==t))return}function DW(n,t){return n.map((e,s)=>n[(t+s)%n.length])}function OW(n,t,e){const r=t.length>1&&Array.from(t).every(l=>l===t[0])?t[0]:t,i=e?n.indexOf(e):-1;let o=DW(n,Math.max(i,0));r.length===1&&(o=o.filter(l=>l!==e));const c=o.find(l=>l.toLowerCase().startsWith(r.toLowerCase()));return c!==e?c:void 0}function RW(n,t){const{x:e,y:s}=n;let r=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const a=t[i].x,c=t[i].y,l=t[o].x,d=t[o].y;c>s!=d>s&&e<(l-a)*(s-c)/(d-c)+a&&(r=!r)}return r}function LW(n,t){if(!t)return!1;const e={x:n.clientX,y:n.clientY};return RW(e,t)}function hc(n){return t=>t.pointerType==="mouse"?n(t):void 0}var B1=w1,z1=Jy,U1=b1,H1=v1,K1=nS,G1=C1,W1=_h,V1=P1,Y1=_1,X1=k1,q1=A1,Z1=j1,J1=D1,Q1=R1,eT=L1,tT=F1,oS="ContextMenu",[$W,jte]=Bs(oS,[Eh]),en=Eh(),[FW,nT]=$W(oS),sT=n=>{const{__scopeContextMenu:t,children:e,onOpenChange:s,dir:r,modal:i=!0}=n,[o,a]=v.useState(!1),c=en(t),l=Ft(s),d=v.useCallback(h=>{a(h),l(h)},[l]);return u.jsx(FW,{scope:t,open:o,onOpenChange:d,modal:i,children:u.jsx(B1,{...c,dir:r,open:o,onOpenChange:d,modal:i,children:e})})};sT.displayName=oS;var rT="ContextMenuTrigger",iT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,disabled:s=!1,...r}=n,i=nT(rT,e),o=en(e),a=v.useRef({x:0,y:0}),c=v.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=v.useRef(0),d=v.useCallback(()=>window.clearTimeout(l.current),[]),h=p=>{a.current={x:p.clientX,y:p.clientY},i.onOpenChange(!0)};return v.useEffect(()=>d,[d]),v.useEffect(()=>void(s&&d()),[s,d]),u.jsxs(u.Fragment,{children:[u.jsx(z1,{...o,virtualRef:c}),u.jsx(Ie.span,{"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,...r,ref:t,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:s?n.onContextMenu:J(n.onContextMenu,p=>{d(),h(p),p.preventDefault()}),onPointerDown:s?n.onPointerDown:J(n.onPointerDown,Kl(p=>{d(),l.current=window.setTimeout(()=>h(p),700)})),onPointerMove:s?n.onPointerMove:J(n.onPointerMove,Kl(d)),onPointerCancel:s?n.onPointerCancel:J(n.onPointerCancel,Kl(d)),onPointerUp:s?n.onPointerUp:J(n.onPointerUp,Kl(d))})]})});iT.displayName=rT;var NW="ContextMenuPortal",aS=n=>{const{__scopeContextMenu:t,...e}=n,s=en(t);return u.jsx(U1,{...s,...e})};aS.displayName=NW;var oT="ContextMenuContent",aT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=nT(oT,e),i=en(e),o=v.useRef(!1);return u.jsx(H1,{...i,...s,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=n.onCloseAutoFocus)==null||c.call(n,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var c;(c=n.onInteractOutside)==null||c.call(n,a),!a.defaultPrevented&&!r.modal&&(o.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});aT.displayName=oT;var BW="ContextMenuGroup",cT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(K1,{...r,...s,ref:t})});cT.displayName=BW;var zW="ContextMenuLabel",UW=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(G1,{...r,...s,ref:t})});UW.displayName=zW;var HW="ContextMenuItem",lT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(W1,{...r,...s,ref:t})});lT.displayName=HW;var KW="ContextMenuCheckboxItem",dT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(V1,{...r,...s,ref:t})});dT.displayName=KW;var GW="ContextMenuRadioGroup",WW=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(Y1,{...r,...s,ref:t})});WW.displayName=GW;var VW="ContextMenuRadioItem",YW=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(X1,{...r,...s,ref:t})});YW.displayName=VW;var XW="ContextMenuItemIndicator",qW=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(q1,{...r,...s,ref:t})});qW.displayName=XW;var ZW="ContextMenuSeparator",JW=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(Z1,{...r,...s,ref:t})});JW.displayName=ZW;var QW="ContextMenuArrow",eV=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(J1,{...r,...s,ref:t})});eV.displayName=QW;var tV="ContextMenuSub",uT=n=>{const{__scopeContextMenu:t,children:e,onOpenChange:s,open:r,defaultOpen:i}=n,o=en(t),[a,c]=ni({prop:r,defaultProp:i,onChange:s});return u.jsx(Q1,{...o,open:a,onOpenChange:c,children:e})};uT.displayName=tV;var nV="ContextMenuSubTrigger",hT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(eT,{...r,...s,ref:t})});hT.displayName=nV;var sV="ContextMenuSubContent",pT=v.forwardRef((n,t)=>{const{__scopeContextMenu:e,...s}=n,r=en(e);return u.jsx(tT,{...r,...s,ref:t,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});pT.displayName=sV;function Kl(n){return t=>t.pointerType!=="mouse"?n(t):void 0}var rV=sT,iV=iT,oV=aS,aV=aT,cV=dT;const fT=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,lV=fT?"â":"Ctrl",dV=fT?"â¥":"Alt";function gT(n){return n.split(",")[0].split("").map(t=>{const e=t.replace(/\$/g,lV).replace(/\?/g,dV).replace(/!/g,"â§");return e[0].toUpperCase()+e.slice(1)})}function Ng(n){return"â "+gT(n).join("â")}function uV(n){return u.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:u.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[u.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),u.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:u.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var cS="DropdownMenu",[hV,Dte]=Bs(cS,[Eh]),tn=Eh(),[pV,mT]=hV(cS),yT=n=>{const{__scopeDropdownMenu:t,children:e,dir:s,open:r,defaultOpen:i,onOpenChange:o,modal:a=!0}=n,c=tn(t),l=v.useRef(null),[d=!1,h]=ni({prop:r,defaultProp:i,onChange:o});return u.jsx(pV,{scope:t,triggerId:rr(),triggerRef:l,contentId:rr(),open:d,onOpenChange:h,onOpenToggle:v.useCallback(()=>h(p=>!p),[h]),modal:a,children:u.jsx(B1,{...c,open:d,onOpenChange:h,dir:s,modal:a,children:e})})};yT.displayName=cS;var ST="DropdownMenuTrigger",wT=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,disabled:s=!1,...r}=n,i=mT(ST,e),o=tn(e);return u.jsx(z1,{asChild:!0,...o,children:u.jsx(Ie.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...r,ref:hh(t,i.triggerRef),onPointerDown:J(n.onPointerDown,a=>{!s&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:J(n.onKeyDown,a=>{s||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});wT.displayName=ST;var fV="DropdownMenuPortal",xT=n=>{const{__scopeDropdownMenu:t,...e}=n,s=tn(t);return u.jsx(U1,{...s,...e})};xT.displayName=fV;var bT="DropdownMenuContent",vT=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=mT(bT,e),i=tn(e),o=v.useRef(!1);return u.jsx(H1,{id:r.contentId,"aria-labelledby":r.triggerId,...i,...s,ref:t,onCloseAutoFocus:J(n.onCloseAutoFocus,a=>{var c;o.current||(c=r.triggerRef.current)==null||c.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:J(n.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,d=c.button===2||l;(!r.modal||d)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});vT.displayName=bT;var gV="DropdownMenuGroup",CT=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(K1,{...r,...s,ref:t})});CT.displayName=gV;var mV="DropdownMenuLabel",yV=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(G1,{...r,...s,ref:t})});yV.displayName=mV;var SV="DropdownMenuItem",IT=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(W1,{...r,...s,ref:t})});IT.displayName=SV;var wV="DropdownMenuCheckboxItem",PT=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(V1,{...r,...s,ref:t})});PT.displayName=wV;var xV="DropdownMenuRadioGroup",bV=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(Y1,{...r,...s,ref:t})});bV.displayName=xV;var vV="DropdownMenuRadioItem",CV=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(X1,{...r,...s,ref:t})});CV.displayName=vV;var IV="DropdownMenuItemIndicator",PV=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(q1,{...r,...s,ref:t})});PV.displayName=IV;var EV="DropdownMenuSeparator",_V=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(Z1,{...r,...s,ref:t})});_V.displayName=EV;var TV="DropdownMenuArrow",kV=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(J1,{...r,...s,ref:t})});kV.displayName=TV;var MV=n=>{const{__scopeDropdownMenu:t,children:e,open:s,onOpenChange:r,defaultOpen:i}=n,o=tn(t),[a=!1,c]=ni({prop:s,defaultProp:i,onChange:r});return u.jsx(Q1,{...o,open:a,onOpenChange:c,children:e})},AV="DropdownMenuSubTrigger",ET=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(eT,{...r,...s,ref:t})});ET.displayName=AV;var jV="DropdownMenuSubContent",_T=v.forwardRef((n,t)=>{const{__scopeDropdownMenu:e,...s}=n,r=tn(e);return u.jsx(tT,{...r,...s,ref:t,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});_T.displayName=jV;var lS=yT,dS=wT,Th=xT,uS=vT,DV=CT,OV=IT,RV=PT,LV=MV,$V=ET,FV=_T;function Fi({id:n,children:t,modal:e=!1,debugOpen:s=!1}){const[r,i]=ri(n);return u.jsx(lS,{open:s||r,dir:"ltr",modal:e,onOpenChange:i,children:t})}function Ni({children:n,...t}){return u.jsx(dS,{dir:"ltr",asChild:!0,onTouchEnd:e=>Ee(e),...t,children:n})}function Bi({side:n="bottom",align:t="start",sideOffset:e=8,alignOffset:s=8,children:r}){const i=Qt();return u.jsx(Th,{container:i,children:u.jsx(uS,{className:"tlui-menu",side:n,sideOffset:e,align:t,alignOffset:s,collisionPadding:4,children:r})})}function NV({id:n,children:t}){const[e,s]=ri(n);return u.jsx(LV,{open:e,onOpenChange:s,children:t})}function BV({id:n,label:t,title:e,disabled:s}){return u.jsx($V,{dir:"ltr",asChild:!0,disabled:s,children:u.jsxs(ce,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:s,title:e,children:[u.jsx(gt,{children:t}),u.jsx(ve,{icon:"chevron-right",small:!0})]})})}function zV({id:n,alignOffset:t=-1,sideOffset:e=-4,size:s="small",children:r}){const i=Qt();return u.jsx(Th,{container:i,children:u.jsx(FV,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:e,collisionPadding:4,"data-size":s,children:r})})}function UV({children:n}){return u.jsx(DV,{dir:"ltr",className:"tlui-menu__group",children:n})}function pc({noClose:n,children:t}){return u.jsx(OV,{dir:"ltr",asChild:!0,onClick:n?Ee:void 0,children:t})}function Ya({children:n,visibleOnMobileLayout:t=!1}){const e=Pn();return!t&&e<dt.MOBILE?null:u.jsx("kbd",{className:"tlui-kbd",children:gT(n).map((s,r)=>u.jsx("span",{children:s},r))})}function B({disabled:n=!1,spinner:t=!1,readonlyOk:e=!1,id:s,kbd:r,label:i,icon:o,onSelect:a,noClose:c,isSelected:l}){const{type:d,sourceId:h}=Ih(),p=Te(),[f,y]=v.useState(!1);if(gr()&&!e)return null;const x=dc(i,d),w=r?Ng(r):void 0,b=x?p(x):void 0,I=b&&w?`${b} ${w}`:b;switch(d){case"menu":return u.jsx(pc,{children:u.jsxs(ce,{type:"menu","data-testid":`${h}.${s}`,disabled:n,title:I,onClick:E=>{c&&Ee(E),f?y(!1):a(h)},children:[u.jsx(gt,{children:b}),r&&u.jsx(Ya,{children:r})]})});case"context-menu":return n?null:u.jsxs(lT,{dir:"ltr",title:I,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${s}`,onSelect:E=>{c&&Ee(E),f?y(!1):a(h)},children:[u.jsx("span",{className:"tlui-button__label",draggable:!1,children:b}),r&&u.jsx(Ya,{children:r}),t&&u.jsx(uV,{})]});case"panel":return u.jsxs(ce,{"data-testid":`${h}.${s}`,type:"menu",title:I,disabled:n,onClick:()=>a(h),children:[u.jsx(gt,{children:b}),o&&u.jsx(ve,{icon:o})]});case"small-icons":case"icons":return u.jsx(ce,{"data-testid":`${h}.${s}`,type:"icon",title:I,disabled:n,onClick:()=>a(h),children:u.jsx(ve,{icon:o,small:d==="small-icons"})});case"keyboard-shortcuts":return r?u.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${s}`,children:[u.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:b}),u.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:u.jsx(Ya,{visibleOnMobileLayout:!0,children:r})})]}):(console.warn(`Menu item '${i}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return u.jsxs(ce,{type:"low",onClick:()=>a(h),children:[u.jsx(ve,{icon:o}),u.jsx(gt,{children:b})]});case"toolbar":return u.jsx(ce,{type:"tool","data-testid":`tools.${s}`,"aria-label":x,"data-value":s,onClick:()=>a("toolbar"),title:I,onTouchStart:E=>{Ee(E),a("toolbar")},role:"radio","aria-checked":l?"true":"false",children:u.jsx(ve,{icon:o})});case"toolbar-overflow":return u.jsx(pc,{"aria-label":i,children:u.jsx(ce,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${s}`,title:I,role:"radio","aria-checked":l?"true":"false","data-value":s,children:u.jsx(ve,{icon:o})})});default:throw Zt(d)}}function HV(){return u.jsxs(u.Fragment,{children:[u.jsx(KV,{}),u.jsx(GV,{}),u.jsx(WV,{}),u.jsx(VV,{}),u.jsx(YV,{}),u.jsx(ZV,{}),u.jsx(JV,{}),u.jsx(QV,{})]})}function KV(){const n=ne(),t=an(2),e=mr(),s=t&&e;return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n["align-left"],disabled:!s}),u.jsx(B,{...n["align-center-horizontal"],disabled:!s}),u.jsx(B,{...n["align-right"],disabled:!s}),u.jsx(B,{...n["stretch-horizontal"],disabled:!s}),u.jsx(B,{...n["align-top"],disabled:!s}),u.jsx(B,{...n["align-center-vertical"],disabled:!s}),u.jsx(B,{...n["align-bottom"],disabled:!s}),u.jsx(B,{...n["stretch-vertical"],disabled:!s})]})}function GV(){const n=ne(),t=an(3),e=mr(),s=t&&e;return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n["distribute-horizontal"],disabled:!s}),u.jsx(B,{...n["distribute-vertical"],disabled:!s})]})}function WV(){const n=ne(),t=r1(),e=mr(),s=t&&e;return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n["stack-horizontal"],disabled:!s}),u.jsx(B,{...n["stack-vertical"],disabled:!s})]})}function VV(){const n=ne(),t=an(1),e=mr(),s=t&&e;return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n["send-to-back"],disabled:!s}),u.jsx(B,{...n["send-backward"],disabled:!s}),u.jsx(B,{...n["bring-forward"],disabled:!s}),u.jsx(B,{...n["bring-to-front"],disabled:!s})]})}function YV(){return Pn()<dt.TABLET_SM?u.jsx(XV,{}):u.jsx(qV,{})}function XV(){const n=ne(),t=N(),e=z("zoom is 1",()=>t.getZoomLevel()===1,[t]);return u.jsx(B,{...n["zoom-to-100"],disabled:e})}function qV(){const n=ne(),t=an(1),e=mr(),s=t&&e;return u.jsx(B,{...n["rotate-ccw"],disabled:!s})}function ZV(){const n=ne(),t=an(1),e=mr(),s=t&&e;return u.jsx(B,{...n["rotate-cw"],disabled:!s})}function JV(){const n=ne(),t=a1(),e=mr(),s=t&&e;return u.jsx(B,{...n["edit-link"],disabled:!s})}function QV(){const n=i1(),t=o1();return n?u.jsx(mv,{}):t?u.jsx(eY,{}):u.jsx(mv,{})}function mv(){const n=ne(),t=an(2),e=mr(),s=t&&e;return u.jsx(B,{...n.group,disabled:!s})}function eY(){const n=ne();return u.jsx(B,{...n.ungroup})}const tY=v.memo(function({children:t}){const e=Te(),s=Pn(),r=gr(),i=N(),o=z("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),a=t??u.jsx(HV,{});if(!(r&&!o))return u.jsxs(Yy,{id:"actions-menu",children:[u.jsx(Xy,{children:u.jsx(ce,{type:"icon","data-testid":"actions-menu.button",title:e("actions-menu.title"),children:u.jsx(ve,{icon:"dots-vertical",small:!0})})}),u.jsx(qy,{side:s>=dt.TABLET?"bottom":"top",sideOffset:6,children:u.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:u.jsx(Jn,{type:"icons",sourceId:"actions-menu",children:a})})})]})});function Nn({id:n,kbd:t,label:e,readonlyOk:s,onSelect:r,toggle:i=!1,disabled:o=!1,checked:a=!1}){const{type:c,sourceId:l}=Ih(),d=gr(),h=Te();if(d&&!s)return null;const p=dc(e,c),f=p?h(p):void 0;switch(c){case"menu":return u.jsxs(RV,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:y=>{r==null||r(l),Ee(y)},disabled:o,checked:a,children:[u.jsx(Wr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&u.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),t&&u.jsx(Ya,{children:t})]});case"context-menu":return u.jsxs(cV,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:y=>{r(l),Ee(y)},disabled:o,checked:a,children:[u.jsx(Wr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&u.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),t&&u.jsx(Ya,{children:t})]},n);default:return null}}function fe({id:n,label:t,children:e}){const{type:s,sourceId:r}=Ih(),i=Te(),o=dc(t,s),a=o?i(o):void 0;switch(s){case"panel":return u.jsx("div",{className:"tlui-menu__group","data-testid":`${r}-group.${n}`,children:e});case"menu":return u.jsx(UV,{"data-testid":`${r}-group.${n}`,children:e});case"context-menu":return u.jsx(cT,{dir:"ltr",className:"tlui-menu__group","data-testid":`${r}-group.${n}`,children:e});case"keyboard-shortcuts":return u.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${r}-group.${n}`,children:[u.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),u.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:e})]});default:return e}}function En({id:n,disabled:t=!1,label:e,size:s="small",children:r}){const{type:i,sourceId:o}=Ih(),a=Qt(),c=Te(),l=e?typeof e=="string"?e:e[i]??e.default:void 0,d=l?c(l):void 0;switch(i){case"menu":return u.jsxs(NV,{id:`${o}-sub.${n}`,children:[u.jsx(BV,{id:`${o}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:t,label:d,title:d}),u.jsx(zV,{id:`${o}-sub.${d?d.toLowerCase()+"-content":""}`,size:s,children:r})]});case"context-menu":return t?null:u.jsxs(nY,{id:`${o}-sub.${n}`,children:[u.jsx(hT,{dir:"ltr",disabled:t,asChild:!0,children:u.jsxs(ce,{"data-testid":`${o}-sub-trigger.${n}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[u.jsx(gt,{children:d}),u.jsx(ve,{icon:"chevron-right",small:!0})]})}),u.jsx(aS,{container:a,children:u.jsx(pT,{"data-testid":`${o}-sub-content.${n}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":s,children:r})})]});default:return r}}function nY({id:n,children:t}){const[e,s]=ri(n);return u.jsx(uT,{open:e,onOpenChange:s,children:t})}function TT(){const n=ne();return qG()?u.jsx(B,{...n["toggle-auto-size"]}):null}function kT(){const n=ne();return a1()?u.jsx(B,{...n["edit-link"]}):null}function sY(){const n=ne();return an(1)?u.jsx(B,{...n.duplicate}):null}function MT(){const n=ne(),t=N();return z("should display flatten option",()=>{if(t.getSelectedShapeIds().length===0)return!1;const r=t.getOnlySelectedShape();return!(r&&t.isShapeOfType(r,"image"))},[t])?u.jsx(B,{...n["flatten-to-image"]}):null}function AT(){const n=ne();return i1()?u.jsx(B,{...n.group}):null}function jT(){const n=ne();return o1()?u.jsx(B,{...n.ungroup}):null}function DT(){const n=N(),t=ne();return z("allow unframe",()=>{const s=n.getSelectedShapes();return s.length===0?!1:s.every(r=>n.isShapeOfType(r,"frame"))},[n])?u.jsx(B,{...t["remove-frame"]}):null}function OT(){const n=N(),t=ne();return z("allow fit frame to content",()=>{const s=n.getOnlySelectedShape();return s?n.isShapeOfType(s,"frame")&&n.getSortedChildIdsForParent(s).length>0:!1},[n])?u.jsx(B,{...t["fit-frame-to-content"]}):null}function RT(){const n=N(),t=ne();return z("selected shapes",()=>n.getSelectedShapes().length>0,[n])?u.jsx(B,{...t["toggle-lock"]}):null}function hS(){const n=ne(),t=N(),e=z("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return u.jsx(Nn,{...n["toggle-transparent"],checked:e,toggle:!0})}function rY(){const n=N(),t=ne(),e=z("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return u.jsx(B,{...t["unlock-all"],disabled:!e})}function LT(){const n=N(),t=z("zoomed to 100",()=>n.getZoomLevel()===1,[n]),e=ne();return u.jsx(B,{...e["zoom-to-100"],noClose:!0,disabled:t})}function $T(){const n=N(),t=z("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]),e=ne();return u.jsx(B,{...e["zoom-to-fit"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function FT(){const n=N(),t=z("has shapes",()=>n.getSelectedShapeIds().length>0,[n]),e=ne();return u.jsx(B,{...e["zoom-to-selection"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function NT(){return u.jsxs(fe,{id:"clipboard",children:[u.jsx(oY,{}),u.jsx(aY,{}),u.jsx(cY,{}),u.jsx(sY,{}),u.jsx(lY,{})]})}function iY(){var s;const n=N(),t=ne(),e=z("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return u.jsxs(En,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[u.jsxs(fe,{id:"copy-as-group",children:[u.jsx(B,{...t["copy-as-svg"]}),!!((s=window.navigator.clipboard)!=null&&s.write)&&u.jsx(B,{...t["copy-as-png"]}),u.jsx(B,{...t["copy-as-json"]})]}),u.jsx(fe,{id:"copy-as-bg",children:u.jsx(hS,{})})]})}function oY(){const n=ne(),t=an(1);return u.jsx(B,{...n.cut,disabled:!t})}function aY(){const n=ne(),t=XG(1);return u.jsx(B,{...n.copy,disabled:!t})}function cY(){const n=ne(),t=YG;return u.jsx(B,{...n.paste,disabled:!t})}function BT(){const n=N(),t=ne();return z("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?u.jsxs(fe,{id:"conversions",children:[u.jsx(iY,{}),u.jsxs(En,{id:"export-as",label:"context-menu.export-as",size:"small",children:[u.jsxs(fe,{id:"export-as-group",children:[u.jsx(B,{...t["export-as-svg"]}),u.jsx(B,{...t["export-as-png"]}),u.jsx(B,{...t["export-as-json"]})]}),u.jsx(fe,{id:"export-as-bg",children:u.jsx(hS,{})})]})]}):null}function zT(){const n=ne(),t=N(),e=z("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return u.jsx(B,{...n["select-all"],disabled:!e})}function lY(){const n=ne(),t=an(1);return u.jsx(B,{...n.delete,disabled:!t})}function dY(){return u.jsxs(En,{id:"edit",label:"context-menu.edit",size:"small",children:[u.jsx(AT,{}),u.jsx(jT,{}),u.jsx(MT,{}),u.jsx(kT,{}),u.jsx(OT,{}),u.jsx(DT,{}),u.jsx(HT,{}),u.jsx(UT,{}),u.jsx(TT,{}),u.jsx(RT,{})]})}function uY(){const n=an(2),t=ZG(),e=ne();return n||t?u.jsxs(En,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&u.jsxs(fe,{id:"align",children:[u.jsx(B,{...e["align-left"]}),u.jsx(B,{...e["align-center-horizontal"]}),u.jsx(B,{...e["align-right"]}),u.jsx(B,{...e["align-top"]}),u.jsx(B,{...e["align-center-vertical"]}),u.jsx(B,{...e["align-bottom"]})]}),u.jsx(hY,{}),n&&u.jsxs(fe,{id:"stretch",children:[u.jsx(B,{...e["stretch-horizontal"]}),u.jsx(B,{...e["stretch-vertical"]})]}),(n||t)&&u.jsxs(fe,{id:"flip",children:[u.jsx(B,{...e["flip-horizontal"]}),u.jsx(B,{...e["flip-vertical"]})]}),u.jsx(pY,{})]}):null}function hY(){const n=ne();return an(3)?u.jsxs(fe,{id:"distribute",children:[u.jsx(B,{...n["distribute-horizontal"]}),u.jsx(B,{...n["distribute-vertical"]})]}):null}function pY(){const n=ne(),t=an(2),e=r1();return t?u.jsxs(fe,{id:"order",children:[u.jsx(B,{...n.pack}),e&&u.jsx(B,{...n["stack-horizontal"]}),e&&u.jsx(B,{...n["stack-vertical"]})]}):null}function fY(){const n=ne();return an(1)?u.jsx(En,{id:"reorder",label:"context-menu.reorder",size:"small",children:u.jsxs(fe,{id:"reorder",children:[u.jsx(B,{...n["bring-to-front"]}),u.jsx(B,{...n["bring-forward"]}),u.jsx(B,{...n["send-backward"]}),u.jsx(B,{...n["send-to-back"]})]})}):null}function gY(){const n=N(),t=z("pages",()=>n.getPages(),[n]),e=z("current page id",()=>n.getCurrentPageId(),[n]),{addToast:s}=ms(),r=ne(),i=gs();return an(1)?u.jsxs(En,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[u.jsx(fe,{id:"pages",children:t.map(a=>u.jsx(B,{id:a.id,disabled:e===a.id,label:a.name,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),a.id);const c=n.getPage(a.id);c&&s({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(e)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),u.jsx(fe,{id:"new-page",children:u.jsx(B,{...r["new-page"]})})]}):null}function UT(){const n=N(),t=ne();return z("oneEmbedSelected",()=>{const s=n.getOnlySelectedShape();return s?!!(n.isShapeOfType(s,"embed")&&s.props.url&&!n.isShapeOrAncestorLocked(s)):!1},[n])?u.jsx(B,{...t["convert-to-bookmark"]}):null}function HT(){const n=N(),t=ne();return z("oneEmbeddableBookmarkSelected",()=>{const s=n.getOnlySelectedShape();return s?!!(n.isShapeOfType(s,"bookmark")&&s.props.url&&Or(s.props.url)&&!n.isShapeOrAncestorLocked(s)):!1},[n])?u.jsx(B,{...t["convert-to-embed"]}):null}function mY(){const n=ne(),t=N(),e=z("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return u.jsx(Nn,{...n["toggle-snap-mode"],checked:e})}function yY(){const n=ne(),t=N(),e=z("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return u.jsx(Nn,{...n["toggle-tool-lock"],checked:e})}function SY(){const n=ne(),t=N(),e=z("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return u.jsx(Nn,{...n["toggle-grid"],checked:e})}function wY(){const n=ne(),t=N(),e=z("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return u.jsx(Nn,{...n["toggle-wrap-mode"],checked:e})}function xY(){const n=ne(),t=N(),e=z("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return u.jsx(Nn,{...n["toggle-focus-mode"],checked:e})}function bY(){const n=ne(),t=N(),e=z("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return u.jsx(Nn,{...n["toggle-edge-scrolling"],checked:e===1})}function vY(){const n=ne(),t=N(),e=z("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return u.jsx(Nn,{...n["toggle-reduce-motion"],checked:e===0})}function CY(){const n=ne(),t=N(),e=z("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return u.jsx(Nn,{...n["toggle-debug-mode"],checked:e})}function IY(){const n=ne(),t=N(),e=z("dynamic resize",()=>t.user.getIsDynamicResizeMode(),[t]);return u.jsx(Nn,{...n["toggle-dynamic-size-mode"],checked:e})}function PY(){const n=N();return z("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n])?u.jsxs(u.Fragment,{children:[u.jsxs(fe,{id:"modify",children:[u.jsx(dY,{}),u.jsx(uY,{}),u.jsx(fY,{}),u.jsx(gY,{})]}),u.jsx(NT,{}),u.jsx(BT,{}),u.jsx(fe,{id:"select-all",children:u.jsx(zT,{})})]}):null}const EY=v.memo(function({children:t}){const e=N(),{Canvas:s}=tt(),r=v.useCallback(l=>{if(l){if(e.getInstanceState().isCoarsePointer){const d=e.getSelectedShapes(),{inputs:{currentPagePoint:h}}=e,p=e.getShapesAtPoint(h);if(!e.getSelectedShapes().length||!p.some(f=>d.includes(f))){const f=p.filter(y=>e.isShapeOrAncestorLocked(y));f.length&&e.select(...f.map(y=>y.id))}}}else{const d=e.getOnlySelectedShape();d&&e.isShapeOrAncestorLocked(d)&&e.setSelectedShapes([])}},[e]),i=Qt(),[o,a]=ri("context menu",r),c=t??u.jsx(PY,{});return u.jsxs(rV,{dir:"ltr",onOpenChange:a,modal:!1,children:[u.jsx(iV,{onContextMenu:void 0,dir:"ltr",children:s?u.jsx(s,{}):null}),o&&u.jsx(oV,{container:i,children:u.jsx(aV,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Ee,children:u.jsx(Jn,{type:"context-menu",sourceId:"context-menu",children:c})})})]})});function Bg({checked:n}){return u.jsx(Wr,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function _Y(){const n=N(),{addToast:t}=ms(),{addDialog:e}=Yi(),[s,r]=me.useState(!1);return u.jsxs(u.Fragment,{children:[u.jsxs(fe,{id:"items",children:[u.jsx(B,{id:"add-toast",onSelect:()=>{t({id:Qe(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),t({id:Qe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:Qe(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:Qe(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),u.jsx(B,{id:"show-dialog",label:"Show dialog",onSelect:()=>{e({component:({onClose:i})=>u.jsx(MY,{displayDontShowAgain:!0,onCancel:()=>i(),onContinue:()=>i()}),onClose:()=>{}})}}),u.jsx(B,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>AY(n,100)}),u.jsx(B,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const i=n.getSelectedShapes(),o=i.length===0?n.getRenderingShapes():i;window.alert(`Shapes ${o.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(s)throw Error("oh no!");return null})(),u.jsx(B,{id:"throw-error",onSelect:()=>r(!0),label:"Throw error"}),u.jsx(B,{id:"hard-reset",onSelect:HI,label:"Hard reset"})]}),u.jsxs(fe,{id:"flags",children:[u.jsx(TY,{}),u.jsx(kY,{})]})]})}function TY(){const n=Object.values(ft);return n.length?u.jsx(En,{id:"debug flags",label:"Debug Flags",children:u.jsx(fe,{id:"debug flags",children:n.map(t=>u.jsx(KT,{flag:t},t.name))})}):null}function kY(){const n=Object.values($z);return n.length?u.jsx(En,{id:"feature flags",label:"Feature Flags",children:u.jsx(fe,{id:"feature flags",children:n.map(t=>u.jsx(KT,{flag:t},t.name))})}):null}function MY({title:n="title",body:t="hello hello hello",cancel:e="Cancel",confirm:s="Continue",displayDontShowAgain:r=!1,onCancel:i,onContinue:o}){const[a,c]=me.useState(!1);return u.jsxs(u.Fragment,{children:[u.jsxs(wh,{children:[u.jsx(xh,{children:n}),u.jsx(bh,{})]}),u.jsx(lc,{style:{maxWidth:350},children:t}),u.jsxs(Ny,{className:"tlui-dialog__footer__actions",children:[r&&u.jsxs(ce,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[u.jsx(Bg,{checked:a}),u.jsx(gt,{children:"Donât show again"})]}),u.jsx(ce,{type:"normal",onClick:i,children:u.jsx(gt,{children:e})}),u.jsx(ce,{type:"primary",onClick:async()=>o(),children:u.jsx(gt,{children:s})})]})]})}const KT=Cn(function({flag:t,onChange:e}){const s=t.get();return u.jsx(Nn,{id:t.name,title:t.name,label:t.name.replace(/([a-z0-9])([A-Z])/g,r=>`${r[0]} ${r[1].toLowerCase()}`).replace(/^[a-z]/,r=>r.toUpperCase()),checked:s,onSelect:()=>{t.set(!s),e==null||e(!s)}})});let yv=0;function AY(n,t){const e=Array(t),s=Math.floor(Math.sqrt(t));for(let r=0;r<t;r++)yv++,e[r]={id:Oe("box"+yv),type:"geo",x:r%s*132,y:Math.floor(r/s)*132};n.batch(()=>{n.createShapes(e).setSelectedShapes(e.map(r=>r.id))})}function jY({children:n}){const t=n??u.jsx(_Y,{});return u.jsxs(Fi,{id:"debug",children:[u.jsx(Ni,{children:u.jsx(ce,{type:"icon",title:"Debug menu",children:u.jsx(ve,{icon:"dots-horizontal"})})}),u.jsx(Bi,{side:"top",align:"end",alignOffset:0,children:u.jsx(Jn,{type:"menu",sourceId:"debug-panel",children:t})})]})}const DY=v.memo(function(){const{DebugMenu:t}=ai();return u.jsxs("div",{className:"tlui-debug-panel",children:[u.jsx(RY,{}),u.jsx(LY,{}),t&&u.jsx(t,{})]})});function OY(n=!0){const[t,e]=v.useState(0),s=N();v.useEffect(()=>{if(!n)return;const r=()=>e(i=>i+1);return s.on("tick",r),()=>{s.off("tick",r)}},[s,n])}const RY=Cn(function(){OY();const t=N(),e=t.getPath(),s=t.getHoveredShape(),r=t.getOnlySelectedShape(),i=e==="select.idle"||!e.includes("select.")?s:r,o=i&&e.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${S.ToInt(t.getPointInShapeSpace(i,t.inputs.currentPagePoint))}]`:"",a=e.startsWith("select.")&&!e.includes(".idle")?` / [${S.ToInt(t.inputs.originPagePoint)}] â [${S.ToInt(t.inputs.currentPagePoint)}] = ${S.Dist(t.inputs.originPagePoint,t.inputs.currentPagePoint).toFixed(0)}`:"";return u.jsx("div",{className:"tlui-debug-panel__current-state",children:`${e}${o}${a}`})});function LY(){const n=N(),t=z("show_fps",()=>ft.showFps.get(),[ft]),e=v.useRef(null);return v.useEffect(()=>{if(!t)return;const s=250;let r=0,i=-1,o=performance.now(),a=0,c=0,l=!1;function d(){if(c++,a=performance.now()-o,a>s){const h=Math.round(c*(s/a)*(1e3/s));h>r&&(r=h);const p=r*.75;(h<p&&!l||h>=p&&l)&&(l=!l),e.current.innerHTML=`FPS ${h.toString()}`,e.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),a-=s,c=0,o=performance.now()}i=n.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(i)}},[t,n]),t?u.jsx("div",{ref:e}):null}function GT(){const n=N(),t=gs(),e=z("locale",()=>n.user.getLocale(),[n]);return u.jsx(En,{id:"help menu language",label:"menu.language",children:u.jsx(fe,{id:"languages",children:oc.map(({locale:s,label:r})=>u.jsx(Nn,{id:`language-${s}`,title:s,label:r,checked:s===e,onSelect:()=>{n.user.updateUserPreferences({locale:s}),t("change-language",{source:"menu",locale:s})}},s))})})}function $Y(){return u.jsxs(u.Fragment,{children:[u.jsx(GT,{}),u.jsx(FY,{})]})}function FY(){const{KeyboardShortcutsDialog:n}=ai(),{addDialog:t}=Yi();return n?u.jsx(B,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{t({component:n})}}):null}const NY=v.memo(function({children:t}){const e=Te(),s=Pn(),r=t??u.jsx($Y,{});return s<dt.MOBILE?null:u.jsx("div",{className:"tlui-help-menu",children:u.jsxs(Fi,{id:"help menu",children:[u.jsx(Ni,{children:u.jsx(ce,{type:"help",title:e("help-menu.title"),"data-testid":"help-menu.button",children:u.jsx(ve,{icon:"question-mark",small:!0})})}),u.jsx(Bi,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:u.jsx(Jn,{type:"menu",sourceId:"help-menu",children:r})})]})})});function BY(){const n=N(),t=ne(),[e,s]=v.useState(!1),r=v.useRef(!1);return Fr("toggle showback to content",()=>{const i=r.current,o=n.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===n.getCulledShapes().size),i!==a&&(s(a),r.current=a)},[n]),e?u.jsx(B,{...t["back-to-content"],onSelect:()=>{t["back-to-content"].onSelect("helper-buttons"),s(!1)}}):null}function zY(){const n=N(),t=ne();return z("is pen mode",()=>n.getInstanceState().isPenMode,[n])?u.jsx(B,{...t["exit-pen-mode"]}):null}function UY(){const n=N(),t=ne();return z("is following user",()=>!!n.getInstanceState().followingUserId,[n])?u.jsx(B,{...t["stop-following"]}):null}function HY(){return u.jsxs(u.Fragment,{children:[u.jsx(zY,{}),u.jsx(BY,{}),u.jsx(UY,{})]})}function KY({children:n}){const t=n??u.jsx(HY,{});return u.jsx("div",{className:"tlui-helper-buttons",children:u.jsx(Jn,{type:"helper-buttons",sourceId:"helper-buttons",children:t})})}function GY(){const n=ne(),t=vh();return u.jsxs(u.Fragment,{children:[u.jsxs(fe,{label:"shortcuts-dialog.tools",id:"tools",children:[u.jsx(B,{...n["toggle-tool-lock"]}),u.jsx(B,{...n["insert-media"]}),u.jsx(B,{...t.select}),u.jsx(B,{...t.draw}),u.jsx(B,{...t.eraser}),u.jsx(B,{...t.hand}),u.jsx(B,{...t.rectangle}),u.jsx(B,{...t.ellipse}),u.jsx(B,{...t.arrow}),u.jsx(B,{...t.line}),u.jsx(B,{...t.text}),u.jsx(B,{...t.frame}),u.jsx(B,{...t.note}),u.jsx(B,{...t.laser})]}),u.jsxs(fe,{label:"shortcuts-dialog.preferences",id:"preferences",children:[u.jsx(B,{...n["toggle-dark-mode"]}),u.jsx(B,{...n["toggle-focus-mode"]}),u.jsx(B,{...n["toggle-grid"]})]}),u.jsxs(fe,{label:"shortcuts-dialog.edit",id:"edit",children:[u.jsx(B,{...n.undo}),u.jsx(B,{...n.redo}),u.jsx(B,{...n.cut}),u.jsx(B,{...n.copy}),u.jsx(B,{...n.paste}),u.jsx(B,{...n["select-all"]}),u.jsx(B,{...n.delete}),u.jsx(B,{...n.duplicate})]}),u.jsxs(fe,{label:"shortcuts-dialog.view",id:"view",children:[u.jsx(B,{...n["zoom-in"]}),u.jsx(B,{...n["zoom-out"]}),u.jsx(B,{...n["zoom-to-100"]}),u.jsx(B,{...n["zoom-to-fit"]}),u.jsx(B,{...n["zoom-to-selection"]})]}),u.jsxs(fe,{label:"shortcuts-dialog.transform",id:"transform",children:[u.jsx(B,{...n["bring-to-front"]}),u.jsx(B,{...n["bring-forward"]}),u.jsx(B,{...n["send-backward"]}),u.jsx(B,{...n["send-to-back"]}),u.jsx(B,{...n.group}),u.jsx(B,{...n.ungroup}),u.jsx(B,{...n["flip-horizontal"]}),u.jsx(B,{...n["flip-vertical"]}),u.jsx(B,{...n["align-top"]}),u.jsx(B,{...n["align-center-vertical"]}),u.jsx(B,{...n["align-bottom"]}),u.jsx(B,{...n["align-left"]}),u.jsx(B,{...n["align-center-horizontal"]}),u.jsx(B,{...n["align-right"]})]})]})}const WY=v.memo(function({children:t}){const e=Te(),s=Pn(),r=t??u.jsx(GY,{});return u.jsxs(u.Fragment,{children:[u.jsxs(wh,{className:"tlui-shortcuts-dialog__header",children:[u.jsx(xh,{children:e("shortcuts-dialog.title")}),u.jsx(bh,{})]}),u.jsx(lc,{className:se("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":s<=dt.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":s<=dt.TABLET}),children:u.jsx(Jn,{type:"keyboard-shortcuts",sourceId:"kbd",children:r})}),u.jsx("div",{className:"tlui-dialog__scrim"})]})}),VY=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function YY(){const n=N(),t=gs(),e=z("colorScheme",()=>n.user.getUserPreferences().colorScheme,[n]);return u.jsx(En,{id:"help menu color-scheme",label:"menu.theme",children:u.jsx(fe,{id:"languages",children:VY.map(({colorScheme:s,label:r})=>u.jsx(Nn,{id:`color-scheme-${s}`,label:r,checked:s===e,onSelect:()=>{n.user.updateUserPreferences({colorScheme:s}),t("color-scheme",{source:"menu",value:s})}},s))})})}function XY(){return u.jsxs(u.Fragment,{children:[u.jsx(ZY,{}),u.jsx(tX,{}),u.jsx(qY,{}),u.jsx(nX,{}),u.jsx(sX,{})]})}function qY(){const n=ne();return u.jsxs(En,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[u.jsxs(fe,{id:"export-all-as-group",children:[u.jsx(B,{...n["export-all-as-svg"]}),u.jsx(B,{...n["export-all-as-png"]}),u.jsx(B,{...n["export-all-as-json"]})]}),u.jsx(fe,{id:"export-all-as-bg",children:u.jsx(hS,{})})]})}function ZY(){const n=N(),t=z("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return u.jsxs(En,{id:"edit",label:"menu.edit",disabled:!t,children:[u.jsx(eX,{}),u.jsx(NT,{}),u.jsx(BT,{}),u.jsx(JY,{}),u.jsx(QY,{}),u.jsx(fe,{id:"select-all",children:u.jsx(zT,{})})]})}function JY(){return u.jsxs(fe,{id:"misc",children:[u.jsx(AT,{}),u.jsx(jT,{}),u.jsx(kT,{}),u.jsx(TT,{}),u.jsx(DT,{}),u.jsx(OT,{}),u.jsx(HT,{}),u.jsx(UT,{}),u.jsx(MT,{})]})}function QY(){return u.jsxs(fe,{id:"lock",children:[u.jsx(RT,{}),u.jsx(rY,{})]})}function eX(){const n=ne(),t=l1(),e=c1();return u.jsxs(fe,{id:"undo-redo",children:[u.jsx(B,{...n.undo,disabled:!t}),u.jsx(B,{...n.redo,disabled:!e})]})}function tX(){const n=ne();return u.jsx(En,{id:"view",label:"menu.view",children:u.jsxs(fe,{id:"view-actions",children:[u.jsx(B,{...n["zoom-in"]}),u.jsx(B,{...n["zoom-out"]}),u.jsx(LT,{}),u.jsx($T,{}),u.jsx(FT,{})]})})}function nX(){const n=ne();return u.jsxs(fe,{id:"extras",children:[u.jsx(B,{...n["insert-embed"]}),u.jsx(B,{...n["insert-media"]})]})}function sX(){return u.jsx(fe,{id:"preferences",children:u.jsxs(En,{id:"preferences",label:"menu.preferences",children:[u.jsxs(fe,{id:"preferences-actions",children:[u.jsx(mY,{}),u.jsx(yY,{}),u.jsx(SY,{}),u.jsx(wY,{}),u.jsx(xY,{}),u.jsx(bY,{}),u.jsx(vY,{}),u.jsx(IY,{}),u.jsx(CY,{})]}),u.jsx(fe,{id:"color-scheme",children:u.jsx(YY,{})}),u.jsx(fe,{id:"language",children:u.jsx(GT,{})})]})})}const rX=v.memo(function({children:t}){const e=Qt(),[s,r]=ri("main menu"),i=Te(),o=t??u.jsx(XY,{});return u.jsxs(lS,{dir:"ltr",open:s,onOpenChange:r,modal:!1,children:[u.jsx(dS,{asChild:!0,dir:"ltr",children:u.jsx(ce,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:u.jsx(ve,{icon:"menu",small:!0})})}),u.jsx(Th,{container:e,children:u.jsx(uS,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:u.jsx(Jn,{type:"menu",sourceId:"main-menu",children:o})})})]})}),iX=v.memo(function(){const t=Pn(),{MainMenu:e,QuickActions:s,ActionsMenu:r,PageMenu:i}=ai();return!e&&!i&&t<6?null:u.jsx("div",{className:"tlui-menu-zone",children:u.jsxs("div",{className:"tlui-buttons__horizontal",children:[e&&u.jsx(e,{}),i&&u.jsx(i,{}),t<6?null:u.jsxs(u.Fragment,{children:[s&&u.jsx(s,{}),r&&u.jsx(r,{})]})]})})}),tf={};function Ma(n){if(tf[n])return tf[n];const e=document.createElement("canvas").getContext("2d");e.fillStyle=n,e.fillRect(0,0,1,1);const[s,r,i,o]=e.getImageData(0,0,1,1).data,a=new Float32Array([s/255,r/255,i/255,o/255]);return tf[n]=a,a}const Ud=10,WT=4*6*Ud+12+4*12;function po(n,{center:t,radius:e,numArcSegments:s=20,startAngle:r=0,endAngle:i=je,offset:o=0}){const a=(i-r)/s;let c=o;for(let l=r;l<i;l+=a)n[c++]=t.x,n[c++]=t.y,n[c++]=t.x+Math.cos(l)*e,n[c++]=t.y+Math.sin(l)*e,n[c++]=t.x+Math.cos(l+a)*e,n[c++]=t.y+Math.sin(l+a)*e;return n}function fo(n,t,e,s,r,i){n[t++]=e,n[t++]=s,n[t++]=e,n[t++]=s+i,n[t++]=e+r,n[t++]=s,n[t++]=e+r,n[t++]=s,n[t++]=e,n[t++]=s+i,n[t++]=e+r,n[t++]=s+i}function oX(n,t,e){const s=Ud;e=Math.min(e,Math.min(t.w,t.h)/2);const r=Y.ExpandBy(t,-e);if(r.w<=0||r.h<=0)return po(n,{center:t.center,radius:e,numArcSegments:Ud*4}),Ud*4*6;let i=0;return fo(n,i,r.minX,r.minY,r.w,r.h),i+=12,fo(n,i,r.minX,t.minY,r.w,e),i+=12,fo(n,i,r.maxX,r.minY,e,r.h),i+=12,fo(n,i,r.minX,r.maxY,r.w,e),i+=12,fo(n,i,t.minX,r.minY,e,r.h),i+=12,po(n,{numArcSegments:s,offset:i,center:r.point,radius:e,startAngle:_e,endAngle:_e*1.5}),i+=s*6,po(n,{numArcSegments:s,offset:i,center:S.Add(r.point,new S(r.w,0)),radius:e,startAngle:_e*1.5,endAngle:je}),i+=s*6,po(n,{numArcSegments:s,offset:i,center:S.Add(r.point,r.size),radius:e,startAngle:0,endAngle:Ue}),i+=s*6,po(n,{numArcSegments:s,offset:i,center:S.Add(r.point,new S(0,r.h)),radius:e,startAngle:Ue,endAngle:_e}),WT}function aX(n){if(!n)throw new Error("Canvas element not found");const t=n.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw new Error("Failed to get webgl2 context");const e=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,s=t.createShader(t.VERTEX_SHADER);if(!s)throw new Error("Failed to create vertex shader");if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const r=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,i=t.createShader(t.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=t.createProgram();if(!o)throw new Error("Failed to create program");if(t.attachShader(o,s),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error("Failed to link program");t.useProgram(o);const a=t.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");t.enableVertexAttribArray(a);const c=t.getUniformLocation(o,"canvasPageBounds"),l=t.getUniformLocation(o,"fillColor");if(!t.createBuffer())throw new Error("Failed to create buffer");if(!t.createBuffer())throw new Error("Failed to create buffer");return{context:t,selectedShapes:Gl(t,1024),unselectedShapes:Gl(t,4096),viewport:Gl(t,WT),collaborators:Gl(t,1024),prepareTriangles(p,f){t.bindBuffer(t.ARRAY_BUFFER,p.buffer),t.bufferData(t.ARRAY_BUFFER,p.vertices,t.STATIC_DRAW,0,f),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0)},drawTrianglesTransparently(p){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLES,0,p/2),t.disable(t.BLEND)},drawTriangles(p){t.drawArrays(t.TRIANGLES,0,p/2)},setFillColor(p){t.uniform4fv(l,p)},setCanvasPageBounds(p){t.uniform4fv(c,p)}}}function Gl(n,t){const e=n.createBuffer();if(!e)throw new Error("Failed to create buffer");return{buffer:e,vertices:new Float32Array(t)}}function Sv(n,t,e){let s=n.vertices.length;for(;s<t+e.length;)s*=2;if(s!=n.vertices.length){const r=new Float32Array(s);r.set(n.vertices),n.vertices=r}n.vertices.set(e,t)}var cX=Object.defineProperty,lX=Object.getOwnPropertyDescriptor,oi=(n,t,e,s)=>{for(var r=lX(t,e),i=n.length-1,o;i>=0;i--)(o=n[i])&&(r=o(t,e,r)||r);return r&&cX(t,e,r),r};class yr{constructor(t,e,s){g(this,"disposables",[]);g(this,"close",()=>this.disposables.forEach(t=>t()));g(this,"gl");g(this,"shapeGeometryCache");g(this,"colors");g(this,"id",Qe());g(this,"canvasBoundingClientRect",Ct("canvasBoundingClientRect",new Y));g(this,"originPagePoint",new S);g(this,"originPageCenter",new S);g(this,"isInViewport",!1);g(this,"getMinimapPagePoint",(t,e)=>{const s=this.getCanvasPageBounds(),r=this.getCanvasScreenBounds();let i=t-r.x,o=e-r.y;return i*=s.width/r.width,o*=s.height/r.height,i+=s.minX,o+=s.minY,new S(i,o,1)});g(this,"minimapScreenPointToPagePoint",(t,e,s=!1,r=!1)=>{const{editor:i}=this,o=i.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(t,e);if(r){const l=this.editor.getCurrentPageBounds()??new Y,d=l.minX-o.width/2,h=l.maxX+o.width/2,p=l.minY-o.height/2,f=l.maxY+o.height/2,y=Math.max(0,d+o.width-a),m=Math.max(0,-(h-o.width-a)),x=Math.max(0,p+o.height-c),w=Math.max(0,-(f-o.height-c));a+=(y-m)/2,c+=(x-w)/2,a=bt(a,d,h),c=bt(c,p,f)}if(s){const{originPagePoint:l}=this,d=Math.abs(a-l.x),h=Math.abs(c-l.y);d>h?c=l.y:a=l.x}return new S(a,c)});g(this,"render",()=>{const t=this.gl.context,e=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=e.x,this.elem.height=e.y,t.viewport(0,0,e.x,e.y),t.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),t.clear(t.COLOR_BUFFER_BIT);const s=new Set(this.editor.getSelectedShapeIds()),r=this.colors;let i=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,l=a.length;c<l;c++){const d=a[c],h=this.shapeGeometryCache.get(d);if(!h)continue;const p=h.length;s.has(d)?(Sv(this.gl.selectedShapes,i,h),i+=p):(Sv(this.gl.unselectedShapes,o,h),o+=p)}this.drawShapes(this.gl.unselectedShapes,o,r.shapeFill),this.drawShapes(this.gl.selectedShapes,i,r.selectFill),this.drawViewport(),this.drawCollaborators()});this.editor=t,this.elem=e,this.container=s,this.gl=aX(e),this.shapeGeometryCache=t.store.createComputedCache("webgl-geometry",r=>{const i=t.getShapeMaskedPageBounds(r.id);if(!i)return null;const o=new Float32Array(12);return fo(o,0,i.x,i.y,i.w,i.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),ei("minimap render",this.render))}_getColors(){const t=getComputedStyle(this.editor.getContainer());return{shapeFill:Ma(t.getPropertyValue("--color-text-3").trim()),selectFill:Ma(t.getPropertyValue("--color-selected").trim()),viewportFill:Ma(t.getPropertyValue("--color-muted-1").trim()),background:Ma(t.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const t=this.editor.getViewportPageBounds(),e=this.editor.getCurrentPageBounds();return e?Y.Expand(e,t):t}getContentScreenBounds(){const t=this.getContentPageBounds(),e=this.editor.pageToScreen(t.point),s=this.editor.pageToScreen(new S(t.maxX,t.maxY));return new Y(e.x,e.y,s.x-e.x,s.y-e.y)}_getCanvasBoundingRect(){const{x:t,y:e,width:s,height:r}=this.elem.getBoundingClientRect();return new Y(t,e,s,r)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const t=new ResizeObserver(()=>{const e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)});return t.observe(this.elem),t.observe(this.container),()=>t.disconnect()}getCanvasSize(){const t=this.canvasBoundingClientRect.get(),e=this.getDpr();return new S(t.width*e,t.height*e)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const t=this.getCanvasScreenBounds(),e=this.getContentPageBounds(),s=t.width/t.height;let r=e.width,i=r/s;i<e.height&&(i=e.height,r=i*s);const o=new Y(0,0,r,i);return o.center=e.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:t,y:e,w:s,h:r}=this.getCanvasPageBounds();return new Float32Array([t,e,s,r])}drawShapes(t,e,s){this.gl.prepareTriangles(t,e),this.gl.setFillColor(s),this.gl.drawTriangles(e)}drawViewport(){const t=this.editor.getViewportPageBounds(),e=oX(this.gl.viewport.vertices,t,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,e),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(e),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(e),this.gl.drawTrianglesTransparently(e),this.gl.drawTrianglesTransparently(e))}drawCollaborators(){const t=this.editor.getCollaboratorsOnCurrentPage();if(!t.length)return;const e=20,s=e*6,r=s*t.length;this.gl.collaborators.vertices.length<r&&(this.gl.collaborators.vertices=new Float32Array(r));const i=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:c}of t)po(i,{center:S.From(c),radius:3*a,offset:o,numArcSegments:e}),o+=s;this.gl.prepareTriangles(this.gl.collaborators,r),o=0;for(const{color:c}of t)this.gl.setFillColor(Ma(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,s/2),o+=s}}oi([K],yr.prototype,"getDpr");oi([K],yr.prototype,"getContentPageBounds");oi([K],yr.prototype,"getContentScreenBounds");oi([K],yr.prototype,"getCanvasSize");oi([K],yr.prototype,"getCanvasClientPosition");oi([K],yr.prototype,"getCanvasPageBounds");oi([K],yr.prototype,"getZoom");oi([K],yr.prototype,"getCanvasPageBoundsArray");function dX(){const n=N(),t=Qt(),e=v.useRef(null),s=v.useRef(!1),r=v.useRef();v.useEffect(()=>{try{const d=new yr(n,e.current,t);return r.current=d,r.current.close}catch(d){n.annotateError(d,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw d})}},[n,t]);const i=v.useCallback(d=>{if(!n.getCurrentPageShapeIds().size||!r.current)return;const h=r.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),p=r.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);r.current.originPagePoint.setTo(p),r.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(h,{animation:{duration:n.options.animationMediumMs}})},[n]),o=v.useCallback(d=>{if(!r.current)return;const h=d.currentTarget;if(Oc(h,d),!n.getCurrentPageShapeIds().size)return;s.current=!0,r.current.isInViewport=!1;const p=r.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),f=n.getViewportPageBounds(),y=r.current.getContentPageBounds();if(new Y(y.x-f.width/2,y.y-f.height/2,y.width+f.width,y.height+f.height).containsPoint(p)&&!f.containsPoint(p)){r.current.isInViewport=f.containsPoint(p);const w=S.Sub(f.center,f.point),b=S.Add(p,w);r.current.originPagePoint.setTo(b),r.current.originPageCenter.setTo(p),n.centerOnPoint(p,{animation:{duration:n.options.animationMediumMs}})}else{const w=r.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);r.current.isInViewport=f.containsPoint(w),r.current.originPagePoint.setTo(w),r.current.originPageCenter.setTo(f.center)}function x(w){h&&Rc(h,w),s.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[n]),a=v.useCallback(d=>{if(!r.current)return;const h=r.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(s.current){if(r.current.isInViewport){const m=r.current.originPagePoint.clone().sub(r.current.originPageCenter);n.centerOnPoint(S.Sub(h,m));return}n.centerOnPoint(h)}const p=r.current.getMinimapPagePoint(d.clientX,d.clientY),f=n.pageToScreen(p),y={type:"pointer",target:"canvas",name:"pointer_move",...yn(d),point:f,isPen:n.getInstanceState().isPenMode};n.dispatch(y)},[n]),c=v.useCallback(d=>{const h=DI(d);n.dispatch({type:"wheel",name:"wheel",delta:h,point:new S(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey})},[n]),l=Bc();return v.useEffect(()=>{n.timers.setTimeout(()=>{var d,h;(d=r.current)==null||d.updateColors(),(h=r.current)==null||h.render()})},[l,n]),u.jsx("div",{className:"tlui-minimap",children:u.jsx("canvas",{role:"img","aria-label":"minimap",ref:e,className:"tlui-minimap__canvas",onDoubleClick:i,onPointerMove:a,onPointerDown:o,onWheel:c})})}function uX(n,t){const[e,s]=me.useState(t);me.useLayoutEffect(()=>{const i=Dm(n);if(i)try{s(JSON.parse(i))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const r=me.useCallback(i=>{s(o=>{const a=typeof i=="function"?i(o):i;return Om(n,JSON.stringify(a)),a})},[n]);return[e,r]}const hX=v.memo(function(){const t=ne(),e=Te(),s=Pn(),[r,i]=uX("minimap",!0),o=v.useCallback(()=>{i(l=>!l)},[i]),{ZoomMenu:a,Minimap:c}=ai();return s<dt.MOBILE?null:u.jsxs("div",{className:"tlui-navigation-panel",children:[u.jsx("div",{className:"tlui-buttons__horizontal",children:a&&s<dt.TABLET?u.jsx(a,{}):r?u.jsxs(u.Fragment,{children:[a&&u.jsx(a,{}),c&&u.jsx(ce,{type:"icon","data-testid":"minimap.toggle-button",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:u.jsx(ve,{icon:r?"chevrons-ne":"chevrons-sw"})})]}):u.jsxs(u.Fragment,{children:[u.jsx(ce,{type:"icon","data-testid":"minimap.zoom-out",title:`${e(dc(t["zoom-out"].label))} ${Ng(t["zoom-out"].kbd)}`,onClick:()=>t["zoom-out"].onSelect("navigation-zone"),children:u.jsx(ve,{icon:"minus"})}),a&&u.jsx(a,{}),u.jsx(ce,{type:"icon","data-testid":"minimap.zoom-in",title:`${e(dc(t["zoom-in"].label))} ${Ng(t["zoom-in"].kbd)}`,onClick:()=>t["zoom-in"].onSelect("navigation-zone"),children:u.jsx(ve,{icon:"plus"})}),c&&u.jsx(ce,{type:"icon","data-testid":"minimap.toggle-button",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:u.jsx(ve,{icon:r?"chevrons-ne":"chevrons-sw"})})]})}),c&&s>=dt.TABLET&&!r&&u.jsx(c,{})]})}),pX=function({name:t,id:e,isCurrentPage:s}){const r=N(),i=v.useRef(null),o=v.useCallback(()=>{r.mark("rename page")},[r]),a=v.useCallback(c=>{r.renamePage(e,c||"New Page")},[r,e]);return u.jsx(By,{className:"tlui-page-menu__item__input",ref:c=>i.current=c,defaultValue:t,onValueChange:a,onFocus:o,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:s,autoSelect:!0})},zg=(n,t,e,s)=>{let r;const i=n.getPages(),o=e>s?i[s-1]:i[s],a=e>s?i[s]:i[s+1];o&&!a?r=Zs(o.index):!o&&a?r=EN(i[0].index):r=tc(o.index,a.index),r!==i[e].index&&(n.mark("moving page"),n.updatePage({id:t,index:r}))},wv=Cn(function({index:t,listSize:e,item:s,onRename:r}){const i=N(),o=Te(),a=i.getPages(),c=v.useCallback(()=>{i.mark("creating page");const p=ar.createId();i.duplicatePage(s.id,p)},[i,s]),l=v.useCallback(()=>{zg(i,s.id,t,t-1)},[i,s,t]),d=v.useCallback(()=>{zg(i,s.id,t,t+1)},[i,s,t]),h=v.useCallback(()=>{i.mark("deleting page"),i.deletePage(s.id)},[i,s]);return u.jsxs(Fi,{id:`page item submenu ${t}`,children:[u.jsx(Ni,{children:u.jsx(ce,{type:"icon",title:o("page-menu.submenu.title"),children:u.jsx(ve,{icon:"dots-vertical"})})}),u.jsx(Bi,{alignOffset:0,side:"right",sideOffset:-4,children:u.jsxs(Jn,{type:"menu",sourceId:"page-menu",children:[u.jsxs(fe,{id:"modify",children:[r&&u.jsx(B,{id:"rename",label:"page-menu.submenu.rename",onSelect:r}),u.jsx(B,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=i.options.maxPages}),t>0&&u.jsx(B,{id:"move-up",onSelect:l,label:"page-menu.submenu.move-up"}),t<e-1&&u.jsx(B,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:d})]}),e>1&&u.jsx(fe,{id:"delete",children:u.jsx(B,{id:"delete",onSelect:h,label:"page-menu.submenu.delete"})})]})})]})}),fX=v.memo(function(){const t=N(),e=Te(),s=Pn(),r=v.useCallback(()=>x(!1),[]),[i,o]=ri("page-menu",r),a=36,c=v.useRef(null),l=z("pages",()=>t.getPages(),[t]),d=z("currentPage",()=>t.getCurrentPage(),[t]),h=z("currentPageId",()=>t.getCurrentPageId(),[t]),p=gr(),f=z("maxPageCountReached",()=>t.getPages().length>=t.options.maxPages,[t]),y=z("isCoarsePointer",()=>t.getInstanceState().isCoarsePointer,[t]),[m,x]=v.useState(!1),w=v.useCallback(()=>{p||x(T=>!T)},[p]),b=v.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[I,E]=v.useState(Object.fromEntries(l.map((T,A)=>[T.id,{y:A*a,offsetY:0,isSelected:!1}])));v.useLayoutEffect(()=>{E(Object.fromEntries(l.map((T,A)=>[T.id,{y:A*a,offsetY:0,isSelected:!1}])))},[a,l]),v.useEffect(()=>{i&&t.timers.requestAnimationFrame(()=>{const T=document.querySelector(`[data-testid="page-menu-item-${h}"]`);if(T){const A=c.current;if(!A)return;const L=T.offsetTop,j=A.scrollTop;L<j&&A.scrollTo({top:L});const R=L+a,F=A.scrollTop+A.offsetHeight;R>F&&A.scrollTo({top:R-A.offsetHeight})}})},[a,h,i,t]);const P=v.useCallback(T=>{const{clientY:A,currentTarget:L}=T,{dataset:{id:j,index:R}}=L;if(!j||!R)return;const F=b.current;Oc(T.currentTarget,T),F.status="pointing",F.pointing={id:j,index:+R};const U=I[j].y;F.startY=A,F.startIndex=Math.max(0,Math.min(Math.round(U/a),l.length-1))},[a,l.length,I]),C=v.useCallback(T=>{const A=b.current;if(A.status==="pointing"){const{clientY:L}=T,j=L-A.startY;Math.abs(j)>5&&(A.status="dragging")}if(A.status==="dragging"){const{clientY:L}=T,j=L-A.startY,R=I[A.pointing.id],{startIndex:F,pointing:H}=A,U=R.y+j,V=Math.max(0,Math.min(Math.round(U/a),l.length-1)),W={...I};if(W[H.id]={y:R.y,offsetY:j,isSelected:!0},V!==A.dragIndex){A.dragIndex=V;for(let te=0;te<l.length;te++){const le=l[te];if(le.id===A.pointing.id)continue;let{y:Se}=W[le.id];V===F?Se=te*a:V<F?V<=te&&te<F?Se=(te+1)*a:Se=te*a:V>F&&(V>=te&&te>F?Se=(te-1)*a:Se=te*a),Se!==W[le.id].y&&(W[le.id]={y:Se,offsetY:0,isSelected:!0})}}E(W)}},[a,l,I]),_=v.useCallback(T=>{const A=b.current;if(A.status==="dragging"){const{id:L,index:j}=A.pointing;zg(t,L,j,A.dragIndex)}Rc(T.currentTarget,T),A.status="idle"},[t]),k=v.useCallback(T=>{const A=b.current;T.key==="Escape"&&(A.status==="dragging"&&E(Object.fromEntries(l.map((L,j)=>[L.id,{y:j*a,offsetY:0,isSelected:!1}]))),A.status="idle")},[a,l]),D=v.useCallback(()=>{p||t.batch(()=>{t.mark("creating page");const T=ar.createId();t.createPage({name:e("page-menu.new-page-initial-name"),id:T}),t.setCurrentPage(T),x(!0)})},[t,e,p]);return u.jsxs(Yy,{id:"pages",onOpenChange:o,open:i,children:[u.jsx(Xy,{"data-testid":"main.page-menu",children:u.jsxs(ce,{type:"menu",title:d.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[u.jsx("div",{className:"tlui-page-menu__name",children:d.name}),u.jsx(ve,{icon:"chevron-down",small:!0})]})}),u.jsx(qy,{side:"bottom",align:"start",sideOffset:6,children:u.jsxs("div",{className:"tlui-page-menu__wrapper",children:[u.jsxs("div",{className:"tlui-page-menu__header",children:[u.jsx("div",{className:"tlui-page-menu__header__title",children:e("page-menu.title")}),!p&&u.jsxs("div",{className:"tlui-buttons__horizontal",children:[u.jsx(ce,{type:"icon","data-testid":"page-menu.edit",title:e(m?"page-menu.edit-done":"page-menu.edit-start"),onClick:w,children:u.jsx(ve,{icon:m?"check":"edit"})}),u.jsx(ce,{type:"icon","data-testid":"page-menu.create",title:e(f?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:f,onClick:D,children:u.jsx(ve,{icon:"plus"})})]})]}),u.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:a*l.length+4},ref:c,children:l.map((T,A)=>{const L=I[T.id]??{position:A*40,offsetY:0};return m?u.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:T.id===d.id?888:A,transform:`translate(0px, ${L.y+L.offsetY}px)`},children:[u.jsx(ce,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:P,onPointerUp:_,onPointerMove:C,onKeyDown:k,"data-id":T.id,"data-index":A,children:u.jsx(ve,{icon:"drag-handle-dots"})}),s<dt.TABLET_SM&&y?u.jsxs(ce,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const j=window.prompt("Rename page",T.name);j&&j!==T.name&&t.renamePage(T.id,j)},onDoubleClick:w,children:[u.jsx(Bg,{checked:T.id===d.id}),u.jsx(gt,{children:T.name})]}):u.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:a},children:u.jsx(pX,{id:T.id,name:T.name,isCurrentPage:T.id===d.id})}),!p&&u.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":m,children:u.jsx(wv,{index:A,item:T,listSize:l.length})})]},T.id+"_editing"):u.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[u.jsxs(ce,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>t.setCurrentPage(T.id),onDoubleClick:w,title:e("page-menu.go-to-page"),children:[u.jsx(Bg,{checked:T.id===d.id}),u.jsx(gt,{children:T.name})]}),!p&&u.jsx("div",{className:"tlui-page_menu__item__submenu",children:u.jsx(wv,{index:A,item:T,listSize:l.length,onRename:()=>{if(t.environment.isIos){const j=window.prompt("Rename page",T.name);j&&j!==T.name&&t.renamePage(T.id,j)}else t.batch(()=>{x(!0),t.setCurrentPage(T.id)})}})})]},T.id)})})]})})]})});function gX(){const n=ne(),t=N(),e=l1(),s=c1(),r=an(1),i=gr(),o=z("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]),a=mr(),c=r&&a;if(!(i&&!o))return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n.undo,disabled:!e}),u.jsx(B,{...n.redo,disabled:!s}),u.jsx(B,{...n.delete,disabled:!c}),u.jsx(B,{...n.duplicate,disabled:!c})]})}const mX=v.memo(function({children:t}){const e=t??u.jsx(gX,{});return u.jsx(Jn,{type:"small-icons",sourceId:"quick-actions",children:e})}),yX=Object.freeze([$n,Ai,ji,js]);function VT(n=yX){const t=N();return z("getRelevantStyles",()=>{var i;const e=new pg(t.getSharedStyles()),s=!!((i=t.root.getCurrent())!=null&&i.shapeType),r=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(e.size===0&&t.isIn("select")&&t.getSelectedShapeIds().length===0)for(const o of n)e.applyValue(o,t.getStyleForNextShape(o));return s||r||e.size>0?e:null},[t])}const qn={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},xi=v.memo(function(t){const{uiType:e,items:s,title:r,style:i,value:o,onValueChange:a,theme:c}=t,l=N(),d=Te(),h=v.useRef(!1),p=v.useRef(null),{handleButtonClick:f,handleButtonPointerDown:y,handleButtonPointerEnter:m,handleButtonPointerUp:x}=v.useMemo(()=>{const w=()=>{h.current=!1,window.removeEventListener("pointerup",w);const C=p.current;C&&["TEXTAREA","INPUT"].includes(C.nodeName)&&C.focus(),p.current=null};return{handleButtonClick:C=>{const{id:_}=C.currentTarget.dataset;o.type==="shared"&&o.value===_||(l.mark("point picker item"),a(i,_))},handleButtonPointerDown:C=>{const{id:_}=C.currentTarget.dataset;l.mark("point picker item"),a(i,_),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",w)},handleButtonPointerEnter:C=>{if(!h.current)return;const{id:_}=C.currentTarget.dataset;a(i,_)},handleButtonPointerUp:C=>{const{id:_}=C.currentTarget.dataset;o.type==="shared"&&o.value===_||a(i,_)}}},[o,l,a,i]);return u.jsx("div",{"data-testid":`style.${e}`,className:se("tlui-buttons__grid"),children:s.map(w=>u.jsx(ce,{type:"icon","data-id":w.value,"data-testid":`style.${e}.${w.value}`,"aria-label":w.value,"data-state":o.type==="shared"&&o.value===w.value?"hinted":void 0,title:r+" â "+d(`${e}-style.${w.value}`),className:se("tlui-button-grid__button"),style:i===$n?{color:c[w.value].solid}:void 0,onPointerEnter:m,onPointerDown:y,onPointerUp:x,onClick:f,children:u.jsx(ve,{icon:w.icon})},w.value))})});function YT(n,[t,e]){return Math.min(e,Math.max(t,n))}function SX(n){const t=v.useRef({value:n,previous:n});return v.useMemo(()=>(t.current.value!==n&&(t.current.previous=t.current.value,t.current.value=n),t.current.previous),[n])}var XT=["PageUp","PageDown"],qT=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ZT={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ca="Slider",[Ug,wX,xX]=mh(ca),[JT,Ote]=Bs(ca,[xX]),[bX,kh]=JT(ca),QT=v.forwardRef((n,t)=>{const{name:e,min:s=0,max:r=100,step:i=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[s],value:d,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:f=!1,...y}=n,m=v.useRef(new Set),x=v.useRef(0),b=o==="horizontal"?vX:CX,[I=[],E]=ni({prop:d,defaultProp:l,onChange:T=>{var L;(L=[...m.current][x.current])==null||L.focus(),h(T)}}),P=v.useRef(I);function C(T){const A=TX(I,T);D(T,A)}function _(T){D(T,x.current)}function k(){const T=P.current[x.current];I[x.current]!==T&&p(I)}function D(T,A,{commit:L}={commit:!1}){const j=jX(i),R=DX(Math.round((T-s)/i)*i+s,j),F=YT(R,[s,r]);E((H=[])=>{const U=EX(H,F,A);if(AX(U,c*i)){x.current=U.indexOf(F);const V=String(U)!==String(H);return V&&L&&p(U),V?U:H}else return H})}return u.jsx(bX,{scope:n.__scopeSlider,name:e,disabled:a,min:s,max:r,valueIndexToChangeRef:x,thumbs:m.current,values:I,orientation:o,children:u.jsx(Ug.Provider,{scope:n.__scopeSlider,children:u.jsx(Ug.Slot,{scope:n.__scopeSlider,children:u.jsx(b,{"aria-disabled":a,"data-disabled":a?"":void 0,...y,ref:t,onPointerDown:J(y.onPointerDown,()=>{a||(P.current=I)}),min:s,max:r,inverted:f,onSlideStart:a?void 0:C,onSlideMove:a?void 0:_,onSlideEnd:a?void 0:k,onHomeKeyDown:()=>!a&&D(s,0,{commit:!0}),onEndKeyDown:()=>!a&&D(r,I.length-1,{commit:!0}),onStepKeyDown:({event:T,direction:A})=>{if(!a){const R=XT.includes(T.key)||T.shiftKey&&qT.includes(T.key)?10:1,F=x.current,H=I[F],U=i*R*A;D(H+U,F,{commit:!0})}}})})})})});QT.displayName=ca;var[ek,tk]=JT(ca,{startEdge:"left",endEdge:"right",size:"width",direction:1}),vX=v.forwardRef((n,t)=>{const{min:e,max:s,dir:r,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...d}=n,[h,p]=v.useState(null),f=He(t,I=>p(I)),y=v.useRef(),m=Zy(r),x=m==="ltr",w=x&&!i||!x&&i;function b(I){const E=y.current||h.getBoundingClientRect(),P=[0,E.width],_=pS(P,w?[e,s]:[s,e]);return y.current=E,_(I-E.left)}return u.jsx(ek,{scope:n.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width",children:u.jsx(nk,{dir:m,"data-orientation":"horizontal",...d,ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:I=>{const E=b(I.clientX);o==null||o(E)},onSlideMove:I=>{const E=b(I.clientX);a==null||a(E)},onSlideEnd:()=>{y.current=void 0,c==null||c()},onStepKeyDown:I=>{const P=ZT[w?"from-left":"from-right"].includes(I.key);l==null||l({event:I,direction:P?-1:1})}})})}),CX=v.forwardRef((n,t)=>{const{min:e,max:s,inverted:r,onSlideStart:i,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=n,d=v.useRef(null),h=He(t,d),p=v.useRef(),f=!r;function y(m){const x=p.current||d.current.getBoundingClientRect(),w=[0,x.height],I=pS(w,f?[s,e]:[e,s]);return p.current=x,I(m-x.top)}return u.jsx(ek,{scope:n.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:u.jsx(nk,{"data-orientation":"vertical",...l,ref:h,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const x=y(m.clientY);i==null||i(x)},onSlideMove:m=>{const x=y(m.clientY);o==null||o(x)},onSlideEnd:()=>{p.current=void 0,a==null||a()},onStepKeyDown:m=>{const w=ZT[f?"from-bottom":"from-top"].includes(m.key);c==null||c({event:m,direction:w?-1:1})}})})}),nk=v.forwardRef((n,t)=>{const{__scopeSlider:e,onSlideStart:s,onSlideMove:r,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=n,d=kh(ca,e);return u.jsx(Ie.span,{...l,ref:t,onKeyDown:J(n.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):XT.concat(qT).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:J(n.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(p)?p.focus():s(h)}),onPointerMove:J(n.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&r(h)}),onPointerUp:J(n.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),i(h))})})}),sk="SliderTrack",rk=v.forwardRef((n,t)=>{const{__scopeSlider:e,...s}=n,r=kh(sk,e);return u.jsx(Ie.span,{"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation,...s,ref:t})});rk.displayName=sk;var Hg="SliderRange",ik=v.forwardRef((n,t)=>{const{__scopeSlider:e,...s}=n,r=kh(Hg,e),i=tk(Hg,e),o=v.useRef(null),a=He(t,o),c=r.values.length,l=r.values.map(p=>ak(p,r.min,r.max)),d=c>1?Math.min(...l):0,h=100-Math.max(...l);return u.jsx(Ie.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...s,ref:a,style:{...n.style,[i.startEdge]:d+"%",[i.endEdge]:h+"%"}})});ik.displayName=Hg;var Kg="SliderThumb",ok=v.forwardRef((n,t)=>{const e=wX(n.__scopeSlider),[s,r]=v.useState(null),i=He(t,a=>r(a)),o=v.useMemo(()=>s?e().findIndex(a=>a.ref.current===s):-1,[e,s]);return u.jsx(IX,{...n,ref:i,index:o})}),IX=v.forwardRef((n,t)=>{const{__scopeSlider:e,index:s,name:r,...i}=n,o=kh(Kg,e),a=tk(Kg,e),[c,l]=v.useState(null),d=He(t,b=>l(b)),h=c?!!c.closest("form"):!0,p=R_(c),f=o.values[s],y=f===void 0?0:ak(f,o.min,o.max),m=_X(s,o.values.length),x=p==null?void 0:p[a.size],w=x?kX(x,y,a.direction):0;return v.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),u.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${w}px)`},children:[u.jsx(Ug.ItemSlot,{scope:n.__scopeSlider,children:u.jsx(Ie.span,{role:"slider","aria-label":n["aria-label"]||m,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:d,style:f===void 0?{display:"none"}:n.style,onFocus:J(n.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),h&&u.jsx(PX,{name:r??(o.name?o.name+(o.values.length>1?"[]":""):void 0),value:f},s)]})});ok.displayName=Kg;var PX=n=>{const{value:t,...e}=n,s=v.useRef(null),r=SX(t);return v.useEffect(()=>{const i=s.current,o=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(o,"value").set;if(r!==t&&c){const l=new Event("input",{bubbles:!0});c.call(i,t),i.dispatchEvent(l)}},[r,t]),u.jsx("input",{style:{display:"none"},...e,ref:s,defaultValue:t})};function EX(n=[],t,e){const s=[...n];return s[e]=t,s.sort((r,i)=>r-i)}function ak(n,t,e){const i=100/(e-t)*(n-t);return YT(i,[0,100])}function _X(n,t){return t>2?`Value ${n+1} of ${t}`:t===2?["Minimum","Maximum"][n]:void 0}function TX(n,t){if(n.length===1)return 0;const e=n.map(r=>Math.abs(r-t)),s=Math.min(...e);return e.indexOf(s)}function kX(n,t,e){const s=n/2,i=pS([0,50],[0,s]);return(s-i(t)*e)*e}function MX(n){return n.slice(0,-1).map((t,e)=>n[e+1]-t)}function AX(n,t){if(t>0){const e=MX(n);return Math.min(...e)>=t}return!0}function pS(n,t){return e=>{if(n[0]===n[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(n[1]-n[0]);return t[0]+s*(e-n[0])}}function jX(n){return(String(n).split(".")[1]||"").length}function DX(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}var OX=QT,RX=rk,LX=ik,$X=ok;const FX=v.memo(function(t){const{title:e,steps:s,value:r,label:i,onValueChange:o}=t,a=N(),c=Te(),l=v.useCallback(p=>{o(p[0])},[o]),d=v.useCallback(()=>{a.mark("click slider")},[a]),h=v.useCallback(()=>{r&&o(r)},[r,o]);return u.jsx("div",{className:"tlui-slider__container",children:u.jsxs(OX,{"data-testid":t["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:s,step:1,value:r?[r]:void 0,onPointerDown:d,onValueChange:l,onPointerUp:h,title:e+" â "+c(i),children:[u.jsx(RX,{className:"tlui-slider__track",dir:"ltr",children:r!==null&&u.jsx(LX,{className:"tlui-slider__range",dir:"ltr"})}),r!==null&&u.jsx($X,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function NX({label:n,uiTypeA:t,uiTypeB:e,labelA:s,labelB:r,itemsA:i,itemsB:o,styleA:a,styleB:c,valueA:l,valueB:d,onValueChange:h}){const p=Te(),f=v.useMemo(()=>{var m;return((m=i.find(x=>l.type==="shared"&&l.value===x.value))==null?void 0:m.icon)??"mixed"},[i,l]),y=v.useMemo(()=>{var m;return((m=o.find(x=>d.type==="shared"&&d.value===x.value))==null?void 0:m.icon)??"mixed"},[o,d]);return l===void 0&&d===void 0?null:u.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[u.jsx("div",{title:p(n),className:"tlui-style-panel__double-select-picker-label",children:p(n)}),u.jsxs("div",{className:"tlui-buttons__horizontal",children:[u.jsxs(Fi,{id:`style panel ${t} A`,children:[u.jsx(Ni,{children:u.jsx(ce,{type:"icon","data-testid":`style.${t}`,title:p(s)+" â "+(l===null||l.type==="mixed"?p("style-panel.mixed"):p(`${t}-style.${l.value}`)),children:u.jsx(ve,{icon:f,small:!0,invertIcon:!0})})}),u.jsx(Bi,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:u.jsx("div",{className:"tlui-buttons__grid",children:i.map((m,x)=>u.jsx(pc,{"data-testid":`style.${t}.${m.value}`,children:u.jsx(ce,{type:"icon",onClick:()=>h(a,m.value),title:`${p(s)} â ${p(`${t}-style.${m.value}`)}`,children:u.jsx(ve,{icon:m.icon,invertIcon:!0})},m.value)},x))})})]}),u.jsxs(Fi,{id:`style panel ${e}`,children:[u.jsx(Ni,{children:u.jsx(ce,{type:"icon","data-testid":`style.${e}`,title:p(r)+" â "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${d.value}`)),children:u.jsx(ve,{icon:y,small:!0})})}),u.jsx(Bi,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:u.jsx("div",{className:"tlui-buttons__grid",children:o.map(m=>u.jsx(pc,{children:u.jsx(ce,{type:"icon",title:`${p(r)} â ${p(`${e}-style.${m.value}`)}`,"data-testid":`style.${e}.${m.value}`,onClick:()=>h(c,m.value),children:u.jsx(ve,{icon:m.icon})})},m.value))})})]})]})]})}const BX=v.memo(NX);function zX({id:n,label:t,uiType:e,style:s,items:r,type:i,value:o,onValueChange:a}){const c=Te(),l=N(),d=v.useMemo(()=>{var f;return(f=r.find(y=>o.type==="shared"&&y.value===o.value))==null?void 0:f.icon},[r,o]),h=o.type==="mixed"?c("style-panel.mixed"):c(`${e}-style.${o.value}`),p=t?c(t):"";return u.jsxs(Fi,{id:`style panel ${n}`,children:[u.jsx(Ni,{children:u.jsxs(ce,{type:i,"data-testid":`style.${e}`,title:h,children:[u.jsx(gt,{children:p}),u.jsx(ve,{icon:d??"mixed"})]})}),u.jsx(Bi,{side:"left",align:"center",alignOffset:0,children:u.jsx("div",{className:"tlui-buttons__grid",children:r.map(f=>u.jsx(pc,{children:u.jsx(ce,{type:"icon","data-testid":`style.${e}.${f.value}`,title:c(`${e}-style.${f.value}`),onClick:()=>{l.mark("select style dropdown item"),a(s,f.value)},children:u.jsx(ve,{icon:f.icon})})},f.value))})})]})}const fS=v.memo(zX);function UX({styles:n}){const t=Bc();if(!n)return null;const e=n.get(os),s=n.get(uu),r=n.get(du),i=n.get(fu),o=n.get(As),a=e===void 0,c=s===void 0&&r===void 0,l=i===void 0,d=o===void 0,h=fr({isDarkMode:t});return u.jsxs(u.Fragment,{children:[u.jsx(HX,{theme:h,styles:n}),!d&&u.jsx(KX,{theme:h,styles:n}),!(a&&c&&l)&&u.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[u.jsx(GX,{styles:n}),u.jsx(VX,{styles:n}),u.jsx(WX,{styles:n})]})]})}function Vc(){const n=N(),t=gs();return me.useMemo(()=>function(s,r){n.batch(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(s,r),n.setStyleForNextShapes(s,r),n.updateInstanceState({isChangingStyle:!0})}),t("set-style",{source:"style-panel",id:s.id,value:r})},[n,t])}function HX({styles:n,theme:t}){const e=Te(),s=N(),r=Vc(),i=n.get($n),o=n.get(ji),a=n.get(Ai),c=n.get(js),l=o!==void 0||a!==void 0||c!==void 0;return u.jsxs(u.Fragment,{children:[u.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[i===void 0?null:u.jsx(xi,{title:e("style-panel.color"),uiType:"color",style:$n,items:qn.color,value:i,onValueChange:r,theme:t}),u.jsx(YX,{})]}),l&&u.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[o===void 0?null:u.jsx(xi,{title:e("style-panel.fill"),uiType:"fill",style:ji,items:qn.fill,value:o,onValueChange:r,theme:t}),a===void 0?null:u.jsx(xi,{title:e("style-panel.dash"),uiType:"dash",style:Ai,items:qn.dash,value:a,onValueChange:r,theme:t}),c===void 0?null:u.jsx(xi,{title:e("style-panel.size"),uiType:"size",style:js,items:qn.size,value:c,onValueChange:(d,h)=>{r(d,h);const p=s.getSelectedShapeIds();p.length>0&&Ne(s,p)},theme:t})]})]})}function KX({theme:n,styles:t}){const e=Te(),s=Vc(),r=t.get(As),i=t.get(ag),o=t.get(hu),a=t.get(pu);return r===void 0&&o===void 0?null:u.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:u.jsx(xi,{title:e("style-panel.font"),uiType:"font",style:As,items:qn.font,value:r,onValueChange:s,theme:n}),i===void 0?null:u.jsxs("div",{className:"tlui-style-panel__row",children:[u.jsx(xi,{title:e("style-panel.align"),uiType:"align",style:ag,items:qn.textAlign,value:i,onValueChange:s,theme:n}),u.jsx("div",{className:"tlui-style-panel__row__extra-button",children:u.jsx(ce,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:u.jsx(ve,{icon:"vertical-align-middle"})})})]}),o===void 0?null:u.jsxs("div",{className:"tlui-style-panel__row",children:[u.jsx(xi,{title:e("style-panel.align"),uiType:"align",style:hu,items:qn.horizontalAlign,value:o,onValueChange:s,theme:n}),u.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a===void 0?u.jsx(ce,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:u.jsx(ve,{icon:"vertical-align-middle"})}):u.jsx(fS,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:pu,items:qn.verticalAlign,value:a,onValueChange:s})})]})]})}function GX({styles:n}){const t=Vc(),e=n.get(os);return e===void 0?null:u.jsx(fS,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:os,items:qn.geo,value:e,onValueChange:t})}function WX({styles:n}){const t=Vc(),e=n.get(fu);return e===void 0?null:u.jsx(fS,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:fu,items:qn.spline,value:e,onValueChange:t})}function VX({styles:n}){const t=Vc(),e=n.get(uu),s=n.get(du);return!e||!s?null:u.jsx(BX,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:du,itemsA:qn.arrowheadStart,valueA:s,uiTypeB:"arrowheadEnd",styleB:uu,itemsB:qn.arrowheadEnd,valueB:e,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Aa=[.1,.25,.5,.75,1];function YX(){const n=N(),t=z("opacity",()=>n.getSharedOpacity(),[n]),e=gs(),s=Te(),r=me.useCallback(o=>{const a=Aa[o];n.batch(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(a),n.setOpacityForNextShapes(a),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:"opacity",value:o})},[n,e]);if(t===void 0)return null;const i=t.type==="mixed"?-1:Aa.indexOf(hN(Aa,o=>Math.abs(o-t.value)));return u.jsx(FX,{"data-testid":"style.opacity",value:i>=0?i:Aa.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:r,steps:Aa.length-1,title:s("style-panel.opacity")})}const XX=v.memo(function({isMobile:t,children:e}){const s=N(),r=VT(),i=v.useCallback(()=>{t||s.updateInstanceState({isChangingStyle:!1})},[s,t]),o=e??u.jsx(UX,{styles:r});return u.jsx("div",{className:se("tlui-style-panel",{"tlui-style-panel__wrapper":!t}),"data-ismobile":t,onPointerLeave:i,children:o})});function qX(){const n=N(),t=Te(),e=VT(),s=e==null?void 0:e.get($n),r=fr({isDarkMode:n.user.getIsDarkMode()}),i=((s==null?void 0:s.type)==="shared"?r[s.value]:r.black).solid,o=z("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),a=v.useCallback(l=>{l||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:c}=ai();return c?u.jsxs(Yy,{id:"mobile style menu",onOpenChange:a,children:[u.jsx(Xy,{children:u.jsx(ce,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":i},title:t("style-panel.title"),disabled:o,children:u.jsx(ve,{icon:o?"blob":(s==null?void 0:s.type)==="mixed"?"mixed":"blob"})})}),u.jsx(qy,{side:"top",align:"end",children:c&&u.jsx(c,{isMobile:!0})})]}):null}function ZX(){return u.jsxs(u.Fragment,{children:[u.jsx(QX,{}),u.jsx(eq,{}),u.jsx(tq,{}),u.jsx(nq,{}),u.jsx(sq,{}),u.jsx(rq,{}),u.jsx(iq,{}),u.jsx(oq,{}),u.jsx(aq,{}),u.jsx(cq,{}),u.jsx(dq,{}),u.jsx(lq,{}),u.jsx(pq,{}),u.jsx(mq,{}),u.jsx(uq,{}),u.jsx(gq,{}),u.jsx(fq,{}),u.jsx(hq,{}),u.jsx(yq,{}),u.jsx(Sq,{}),u.jsx(wq,{}),u.jsx(xq,{}),u.jsx(bq,{}),u.jsx(vq,{}),u.jsx(Cq,{}),u.jsx(Iq,{}),u.jsx(Eq,{}),u.jsx(Pq,{})]})}function JX(n){var s;const t=N(),e=(s=n.meta)==null?void 0:s.geo;return z("is tool selected",()=>{const r=t.getCurrentToolId(),i=t.getSharedStyles().getAsKnownValue(os);return e?r==="geo"&&i===e:r===n.id},[t,n.id,e])}function Fe({tool:n}){const t=vh(),e=JX(t[n]);return u.jsx(B,{...t[n],isSelected:e})}function QX(){return u.jsx(Fe,{tool:"select"})}function eq(){return u.jsx(Fe,{tool:"hand"})}function tq(){return u.jsx(Fe,{tool:"draw"})}function nq(){return u.jsx(Fe,{tool:"eraser"})}function sq(){return u.jsx(Fe,{tool:"arrow"})}function rq(){return u.jsx(Fe,{tool:"text"})}function iq(){return u.jsx(Fe,{tool:"note"})}function oq(){const n=vh();return u.jsx(B,{...n.asset})}function aq(){return u.jsx(Fe,{tool:"rectangle"})}function cq(){return u.jsx(Fe,{tool:"ellipse"})}function lq(){return u.jsx(Fe,{tool:"diamond"})}function dq(){return u.jsx(Fe,{tool:"triangle"})}function uq(){return u.jsx(Fe,{tool:"rhombus"})}function hq(){return u.jsx(Fe,{tool:"heart"})}function pq(){return u.jsx(Fe,{tool:"hexagon"})}function fq(){return u.jsx(Fe,{tool:"cloud"})}function gq(){return u.jsx(Fe,{tool:"star"})}function mq(){return u.jsx(Fe,{tool:"oval"})}function yq(){return u.jsx(Fe,{tool:"x-box"})}function Sq(){return u.jsx(Fe,{tool:"check-box"})}function wq(){return u.jsx(Fe,{tool:"arrow-left"})}function xq(){return u.jsx(Fe,{tool:"arrow-up"})}function bq(){return u.jsx(Fe,{tool:"arrow-down"})}function vq(){return u.jsx(Fe,{tool:"arrow-right"})}function Cq(){return u.jsx(Fe,{tool:"line"})}function Iq(){return u.jsx(Fe,{tool:"highlight"})}function Pq(){return u.jsx(Fe,{tool:"frame"})}function Eq(){return u.jsx(Fe,{tool:"laser"})}const nf=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function sf(n,t,e,s){n.addEventListener?n.addEventListener(t,e,s):n.attachEvent&&n.attachEvent("on".concat(t),e)}function ja(n,t,e,s){n.removeEventListener?n.removeEventListener(t,e,s):n.detachEvent&&n.detachEvent("on".concat(t),e)}function ck(n,t){const e=t.slice(0,t.length-1);for(let s=0;s<e.length;s++)e[s]=n[e[s].toLowerCase()];return e}function lk(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const t=n.split(",");let e=t.lastIndexOf("");for(;e>=0;)t[e-1]+=",",t.splice(e,1),e=t.lastIndexOf("");return t}function _q(n,t){const e=n.length>=t.length?n:t,s=n.length>=t.length?t:n;let r=!0;for(let i=0;i<e.length;i++)s.indexOf(e[i])===-1&&(r=!1);return r}const fc={backspace:8,"â«":8,tab:9,clear:12,enter:13,"â©":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"âª":20,",":188,".":190,"/":191,"`":192,"-":nf?173:189,"=":nf?61:187,";":nf?59:186,"'":222,"[":219,"]":221,"\\":220},Os={"â§":16,shift:16,"â¥":18,alt:18,option:18,"â":17,ctrl:17,control:17,"â":91,cmd:91,command:91},Gg={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Mt={16:!1,18:!1,17:!1,91:!1},at={};for(let n=1;n<20;n++)fc["f".concat(n)]=111+n;let Be=[],Xa=null,dk="all";const qs=new Map,Yc=n=>fc[n.toLowerCase()]||Os[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Tq=n=>Object.keys(fc).find(t=>fc[t]===n),kq=n=>Object.keys(Os).find(t=>Os[t]===n);function uk(n){dk=n||"all"}function gc(){return dk||"all"}function Mq(){return Be.slice(0)}function Aq(){return Be.map(n=>Tq(n)||kq(n)||String.fromCharCode(n))}function jq(){const n=[];return Object.keys(at).forEach(t=>{at[t].forEach(e=>{let{key:s,scope:r,mods:i,shortcut:o}=e;n.push({scope:r,shortcut:o,mods:i,keys:s.split("+").map(a=>Yc(a))})})}),n}function Dq(n){const t=n.target||n.srcElement,{tagName:e}=t;let s=!0;const r=e==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||e==="TEXTAREA"||e==="SELECT")&&!t.readOnly)&&(s=!1),s}function Oq(n){return typeof n=="string"&&(n=Yc(n)),Be.indexOf(n)!==-1}function Rq(n,t){let e,s;n||(n=gc());for(const r in at)if(Object.prototype.hasOwnProperty.call(at,r))for(e=at[r],s=0;s<e.length;)e[s].scope===n?e.splice(s,1).forEach(o=>{let{element:a}=o;return gS(a)}):s++;gc()===n&&uk(t||"all")}function Lq(n){let t=n.keyCode||n.which||n.charCode;const e=Be.indexOf(t);if(e>=0&&Be.splice(e,1),n.key&&n.key.toLowerCase()==="meta"&&Be.splice(0,Be.length),(t===93||t===224)&&(t=91),t in Mt){Mt[t]=!1;for(const s in Os)Os[s]===t&&(Sn[s]=!1)}}function hk(n){if(typeof n>"u")Object.keys(at).forEach(r=>{Array.isArray(at[r])&&at[r].forEach(i=>Wl(i)),delete at[r]}),gS(null);else if(Array.isArray(n))n.forEach(r=>{r.key&&Wl(r)});else if(typeof n=="object")n.key&&Wl(n);else if(typeof n=="string"){for(var t=arguments.length,e=new Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];let[r,i]=e;typeof r=="function"&&(i=r,r=""),Wl({key:n,scope:r,method:i,splitKey:"+"})}}const Wl=n=>{let{key:t,scope:e,method:s,splitKey:r="+"}=n;lk(t).forEach(o=>{const a=o.split(r),c=a.length,l=a[c-1],d=l==="*"?"*":Yc(l);if(!at[d])return;e||(e=gc());const h=c>1?ck(Os,a):[],p=[];at[d]=at[d].filter(f=>{const m=(s?f.method===s:!0)&&f.scope===e&&_q(f.mods,h);return m&&p.push(f.element),!m}),p.forEach(f=>gS(f))})};function xv(n,t,e,s){if(t.element!==s)return;let r;if(t.scope===e||t.scope==="all"){r=t.mods.length>0;for(const i in Mt)Object.prototype.hasOwnProperty.call(Mt,i)&&(!Mt[i]&&t.mods.indexOf(+i)>-1||Mt[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Mt[16]&&!Mt[18]&&!Mt[17]&&!Mt[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(Be),t.method(n,t)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function bv(n,t){const e=at["*"];let s=n.keyCode||n.which||n.charCode;if(!Sn.filter.call(this,n))return;if((s===93||s===224)&&(s=91),Be.indexOf(s)===-1&&s!==229&&Be.push(s),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const c=Gg[a];n[a]&&Be.indexOf(c)===-1?Be.push(c):!n[a]&&Be.indexOf(c)>-1?Be.splice(Be.indexOf(c),1):a==="metaKey"&&n[a]&&Be.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(Be=Be.slice(Be.indexOf(c))))}),s in Mt){Mt[s]=!0;for(const a in Os)Os[a]===s&&(Sn[a]=!0);if(!e)return}for(const a in Mt)Object.prototype.hasOwnProperty.call(Mt,a)&&(Mt[a]=n[Gg[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(Be.indexOf(17)===-1&&Be.push(17),Be.indexOf(18)===-1&&Be.push(18),Mt[17]=!0,Mt[18]=!0);const r=gc();if(e)for(let a=0;a<e.length;a++)e[a].scope===r&&(n.type==="keydown"&&e[a].keydown||n.type==="keyup"&&e[a].keyup)&&xv(n,e[a],r,t);if(!(s in at))return;const i=at[s],o=i.length;for(let a=0;a<o;a++)if((n.type==="keydown"&&i[a].keydown||n.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,d=c.key.split(l),h=[];for(let p=0;p<d.length;p++)h.push(Yc(d[p]));h.sort().join("")===Be.sort().join("")&&xv(n,c,r,t)}}function Sn(n,t,e){Be=[];const s=lk(n);let r=[],i="all",o=document,a=0,c=!1,l=!0,d="+",h=!1,p=!1;for(e===void 0&&typeof t=="function"&&(e=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(o=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(h=t.capture),typeof t.splitKey=="string"&&(d=t.splitKey),t.single===!0&&(p=!0)),typeof t=="string"&&(i=t),p&&hk(n,i);a<s.length;a++)n=s[a].split(d),r=[],n.length>1&&(r=ck(Os,n)),n=n[n.length-1],n=n==="*"?"*":Yc(n),n in at||(at[n]=[]),at[n].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:s[a],method:e,key:s[a],splitKey:d,element:o});if(typeof o<"u"&&window){if(!qs.has(o)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return bv(m,o)},y=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;bv(m,o),Lq(m)};qs.set(o,{keydownListener:f,keyupListenr:y,capture:h}),sf(o,"keydown",f,h),sf(o,"keyup",y,h)}if(!Xa){const f=()=>{Be=[]};Xa={listener:f,capture:h},sf(window,"focus",f,h)}}}function $q(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(at).forEach(e=>{at[e].filter(r=>r.scope===t&&r.shortcut===n).forEach(r=>{r&&r.method&&r.method()})})}function gS(n){const t=Object.values(at).flat();if(t.findIndex(s=>{let{element:r}=s;return r===n})<0){const{keydownListener:s,keyupListenr:r,capture:i}=qs.get(n)||{};s&&r&&(ja(n,"keyup",r,i),ja(n,"keydown",s,i),qs.delete(n))}if((t.length<=0||qs.size<=0)&&(Object.keys(qs).forEach(r=>{const{keydownListener:i,keyupListenr:o,capture:a}=qs.get(r)||{};i&&o&&(ja(r,"keyup",o,a),ja(r,"keydown",i,a),qs.delete(r))}),qs.clear(),Object.keys(at).forEach(r=>delete at[r]),Xa)){const{listener:r,capture:i}=Xa;ja(window,"focus",r,i),Xa=null}}const rf={getPressedKeyString:Aq,setScope:uk,getScope:gc,deleteScope:Rq,getPressedKeyCodes:Mq,getAllKeyCodes:jq,isPressed:Oq,filter:Dq,trigger:$q,unbind:hk,keyMap:fc,modifier:Os,modifierMap:Gg};for(const n in rf)Object.prototype.hasOwnProperty.call(rf,n)&&(Sn[n]=rf[n]);if(typeof window<"u"){const n=window.hotkeys;Sn.noConflict=t=>(t&&window.hotkeys===Sn&&(window.hotkeys=n),Sn),window.hotkeys=Sn}const vv=["copy","cut","paste","asset"];function Fq(){const n=N(),t=gr(),e=ne(),s=vh(),r=z("is focused",()=>n.getInstanceState().isFocused,[n]);v.useEffect(()=>{if(!r)return;const i=new Array,o=(c,l)=>{Sn(c,{element:document.body},l),i.push(()=>{Sn.unbind(c,l)})},a=(c,l)=>{Sn(c,{element:document.body,keyup:!0,keydown:!1},l),i.push(()=>{Sn.unbind(c,l)})};for(const c of Object.values(e))c.kbd&&(t&&!c.readonlyOk||vv.includes(c.id)||o(Cv(c.kbd),l=>{Ua(n)||(Ee(l),c.onSelect("kbd"))}));for(const c of Object.values(s))!c.kbd||!c.readonlyOk&&n.getInstanceState().isReadonly||vv.includes(c.id)||o(Cv(c.kbd),l=>{Ua(n)||(Ee(l),c.onSelect("kbd"))});return o(",",c=>{if(Ua(n)||n.inputs.keys.has("Comma"))return;Ee(c),n.focus(),n.inputs.keys.add("Comma");const{x:l,y:d,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_down",point:{x:l,y:d,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),a(",",c=>{if(Ua(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:l,y:d,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:l,y:d,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),()=>{i.forEach(c=>c())}},[e,s,t,n,r])}function Cv(n){return Nq(n).map(t=>{let e="";const s=t.split("");return s.length===1?e=s[0]:s[0]==="!"?e=`shift+${s[1]}`:s[0]==="?"?s.length===3&&s[1]==="!"?e=`alt+shift+${s[2]}`:e=`alt+${s[1]}`:s[0]==="$"?s[1]==="!"?e=`cmd+shift+${s[2]},ctrl+shift+${s[2]}`:s[1]==="?"?e=`cmd+â¥+${s[2]},ctrl+alt+${s[2]}`:e=`cmd+${s[1]},ctrl+${s[1]}`:e=t,e}).join(",")}function Nq(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const t=n.split(",");let e=t.lastIndexOf("");for(;e>=0;)t[e-1]+=",",t.splice(e,1),e=t.lastIndexOf("");return t}function Ua(n){return n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError()}const Bq=v.createContext(!1);function zq({children:n}){const t=N(),e=Z4(),s=Pn(),r=Te(),i=Math.min(8,5+s),[o,a]=v.useState(0),c=v.useRef(null),[l,d]=v.useState(null),h=v.useMemo(()=>{const f=l?`:not([data-value="${l}"])`:"";return`
			#${e}_main > *:nth-child(n + ${i+(l?1:2)})${f} {
				display: none;
			}
			#${e}_more > *:nth-child(-n + ${i}) {
				display: none;
			}
        `},[l,e,i]),p=cy(()=>{if(!c.current)return;const f=Array.from(c.current.children);a(f.length),f.findIndex(x=>x.getAttribute("data-value")===l)<=i&&d(null);const m=Array.from(c.current.children).findIndex(x=>x.getAttribute("aria-checked")==="true");m!==-1&&m>=i&&d(f[m].getAttribute("data-value"))});return v.useLayoutEffect(()=>{p()}),v.useLayoutEffect(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),v.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[y,m]of f)Sn(y,x=>{var I;if(Ua(t))return;Ee(x);const b=Array.from(((I=c.current)==null?void 0:I.children)??[]).filter(E=>!(E instanceof HTMLElement)||E.tagName.toLowerCase()!=="button"?!1:!!(E.offsetWidth||E.offsetHeight))[m];b&&b.click()});return()=>{Sn.unbind("1,2,3,4,5,6,7,8,9,0")}},[t]),u.jsxs(u.Fragment,{children:[u.jsx("style",{children:h}),u.jsxs("div",{className:se("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":s<dt.TABLET_SM}),role:"radiogroup",children:[u.jsx("div",{id:`${e}_main`,ref:c,className:"tlui-toolbar__tools__list",children:u.jsx(Jn,{type:"toolbar",sourceId:"toolbar",children:n})}),o>i+1&&u.jsx(Bq.Provider,{value:!0,children:u.jsxs(Fi,{id:"toolbar overflow",modal:!1,children:[u.jsx(Ni,{children:u.jsx(ce,{title:r("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:u.jsx(ve,{icon:"chevron-up"})})}),u.jsx(Bi,{side:"top",align:"center",children:u.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${e}_more`,children:u.jsx(Jn,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}const Uq=["select","hand","draw","eraser","text","zoom","laser","highlight"];function Hq({activeToolId:n}){const t=N(),e=Pn(),s=Te(),r=z("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!n||Uq.includes(n)?null:u.jsx(ce,{type:"normal",title:s("action.toggle-tool-lock"),"data-testid":"tool-lock",className:se("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":e<dt.TABLET_SM}),onClick:()=>t.updateInstanceState({isToolLocked:!r}),children:u.jsx(ve,{icon:r?"lock":"unlock",small:!0})})}const Kq=v.memo(function({children:t}){const e=N(),s=Pn(),r=gr(),i=z("current tool id",()=>e.getCurrentToolId(),[e]),{ActionsMenu:o,QuickActions:a}=ai();return u.jsx("div",{className:"tlui-toolbar",children:u.jsxs("div",{className:"tlui-toolbar__inner",children:[u.jsxs("div",{className:"tlui-toolbar__left",children:[!r&&u.jsxs("div",{className:"tlui-toolbar__extras",children:[s<dt.TABLET&&u.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[a&&u.jsx(a,{}),o&&u.jsx(o,{})]}),u.jsx(Hq,{activeToolId:i})]}),u.jsx(zq,{children:t??u.jsx(ZX,{})})]}),s<dt.TABLET_SM&&!r&&u.jsx("div",{className:"tlui-toolbar__tools",children:u.jsx(qX,{})})]})})});function Gq(){const n=ne();return u.jsxs(u.Fragment,{children:[u.jsx(B,{...n["zoom-in"],noClose:!0}),u.jsx(B,{...n["zoom-out"],noClose:!0}),u.jsx(LT,{}),u.jsx($T,{}),u.jsx(FT,{})]})}const Wq=v.memo(function({children:t}){const e=Qt(),[s,r]=ri("zoom menu"),i=t??u.jsx(Gq,{});return u.jsxs(lS,{dir:"ltr",open:s,onOpenChange:r,modal:!1,children:[u.jsx(dS,{asChild:!0,dir:"ltr",children:u.jsx(Vq,{})}),u.jsx(Th,{container:e,children:u.jsx(uS,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:u.jsx(Jn,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),Vq=v.forwardRef(function(t,e){const s=N(),r=Pn(),i=z("zoom",()=>s.getZoomLevel(),[s]),o=Te(),a=v.useCallback(()=>{s.resetZoom(s.getViewportScreenCenter(),{animation:{duration:s.options.animationMediumMs}})},[s]);return u.jsx(ce,{ref:e,...t,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:r<dt.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:r<dt.MOBILE?"zoom-in":void 0,children:r<dt.MOBILE?null:u.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(i*100),"%"]})})}),pk=v.createContext(null);function Yq({overrides:n={},children:t}){const e=Qm(n);return u.jsx(pk.Provider,{value:v.useMemo(()=>({ContextMenu:EY,ActionsMenu:tY,HelpMenu:NY,ZoomMenu:Wq,MainMenu:rX,Minimap:dX,StylePanel:XX,PageMenu:fX,NavigationPanel:hX,Toolbar:Kq,KeyboardShortcutsDialog:WY,QuickActions:mX,HelperButtons:KY,DebugPanel:DY,DebugMenu:jY,MenuPanel:iX,...e}),[e]),children:t})}function ai(){const n=v.useContext(pk);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}function Xq({overrides:n,components:t,assetUrls:e,onUiEvent:s,forceMobile:r,children:i}){return u.jsx(L6,{assetUrls:P9(e),children:u.jsx(N6,{overrides:M9(n),children:u.jsx(z7,{onEvent:s,children:u.jsx(m9,{children:u.jsx(U7,{children:u.jsx(_9,{forceMobile:r,children:u.jsx(Yq,{overrides:t,children:u.jsx(qq,{overrides:n,children:i})})})})})})})})}function qq({overrides:n,children:t}){const e=A9(n);return u.jsx(mG,{overrides:e.actions,children:u.jsx(E9,{overrides:e.tools,children:t})})}function Zq(){const n=N(),{addToast:t}=ms();v.useEffect(()=>{function e({name:s,count:r}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${s} (${r}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",e),()=>{n.removeListener("max-shapes",e)}},[n,t])}const Jq=me.memo(function({renderDebugMenuItems:t,children:e,hideUi:s,components:r,...i}){return u.jsx(Xq,{...i,components:r,children:u.jsx(Qq,{hideUi:s,renderDebugMenuItems:t,children:e})})}),Qq=me.memo(function({children:t,hideUi:e,...s}){return u.jsxs(u.Fragment,{children:[t,e?null:u.jsx(tZ,{...s}),u.jsx(eZ,{})]})});function eZ(){const{InFrontOfTheCanvas:n}=tt();return n?u.jsx("div",{className:"tl-front",children:u.jsx(n,{})}):null}const tZ=me.memo(function(){const t=N(),e=Te(),s=Pn(),r=gr(),i=z("focus",()=>t.getInstanceState().isFocusMode,[t]),o=z("debug",()=>t.getInstanceState().isDebugMode,[t]),{SharePanel:a,TopPanel:c,MenuPanel:l,StylePanel:d,Toolbar:h,HelpMenu:p,NavigationPanel:f,HelperButtons:y,DebugPanel:m}=ai();Fq(),rG(),Zq();const{"toggle-focus-mode":x}=ne();return u.jsxs("div",{className:se("tlui-layout",{"tlui-layout__mobile":s<dt.TABLET_SM}),"data-breakpoint":s,children:[i?u.jsx("div",{className:"tlui-layout__top",children:u.jsx(ce,{type:"icon",className:"tlui-focus-button",title:e("focus-mode.toggle-focus-mode"),onClick:()=>x.onSelect("menu"),children:u.jsx(ve,{icon:"dot"})})}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"tlui-layout__top",children:[u.jsxs("div",{className:"tlui-layout__top__left",children:[l&&u.jsx(l,{}),y&&u.jsx(y,{})]}),u.jsx("div",{className:"tlui-layout__top__center",children:c&&u.jsx(c,{})}),u.jsxs("div",{className:"tlui-layout__top__right",children:[a&&u.jsx(a,{}),d&&s>=dt.TABLET_SM&&!r&&u.jsx(d,{})]})]}),u.jsxs("div",{className:"tlui-layout__bottom",children:[u.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&u.jsx(f,{}),h&&u.jsx(h,{}),p&&u.jsx(p,{})]}),o&&m&&u.jsx(m,{})]})]}),u.jsx(x9,{}),u.jsx(G7,{}),u.jsx(b9,{}),u.jsx(W7,{})]})});async function nZ(n,t){const{url:e,style:s="normal",weight:r="500",display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l,format:d}=t,h={style:s,weight:r,display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l},p=new FontFace(n,`url(${e})`,h);return await p.load(),document.fonts.add(p),p.$$_url=e,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${e}") format("${d}")
}`,p}const Vl=(n,t)=>{const[e,s]=v.useState(2);return v.useEffect(()=>{let r=!1;return s(2),nZ(n,t).then(()=>{r||s(0)}).catch(i=>{r||(console.error(i),s(1))}),()=>{r=!0}},[n,t]),e};function sZ(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function fk(n){const t=v.useMemo(()=>sZ(n),[n]),e=[Vl("tldraw_draw",t.draw),Vl("tldraw_serif",t.serif),Vl("tldraw_sans",t.sansSerif),Vl("tldraw_mono",t.monospace)];return{error:e.some(s=>s===1),done:!e.some(s=>s===2)}}function rZ(n){const{children:t,maxImageDimension:e,maxAssetSize:s,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i,onMount:o,components:a={},shapeUtils:c=[],bindingUtils:l=[],tools:d=[],...h}=n,p=Qm(a),f=v.useMemo(()=>({Scribble:hb,CollaboratorScribble:hb,SelectionForeground:f8,SelectionBackground:h8,Handles:a8,...p}),[p]),y=Wa(c),m=v.useMemo(()=>[...Iy,...y],[y]),x=Wa(l),w=v.useMemo(()=>[..._P,...x],[x]),b=Wa(d),I=v.useMemo(()=>[...uK,...wH,...b],[b]),E="persistenceKey"in h?h.persistenceKey:void 0,P=w_(h.assetUrls),C=v.useMemo(()=>({onResolveAsset:tH(E),...h.assetOptions}),[E,h.assetOptions]),{done:_,error:k}=fk(P);return k?u.jsx(bP,{children:"Could not load assets. Please refresh the page."}):_?u.jsx(K4,{initialState:"select",...h,components:f,shapeUtils:m,bindingUtils:w,tools:I,assetOptions:C,children:u.jsxs(Jq,{...h,components:f,children:[u.jsx(iZ,{maxImageDimension:e,maxAssetSize:s,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i,persistenceKey:E,onMount:o}),t]})}):u.jsx(uy,{children:u.jsx(Jm,{})})}function iZ({maxImageDimension:n=1e3,maxAssetSize:t=10*1024*1024,acceptedImageMimeTypes:e=jm,acceptedVideoMimeTypes:s=lC,onMount:r,persistenceKey:i}){const o=N(),a=ms(),c=Te(),l=cy(p=>{const f=[];return f.push(...X6(p)),J8(p,{maxImageDimension:n,maxAssetSize:t,acceptedImageMimeTypes:e,acceptedVideoMimeTypes:s},{toasts:a,msg:c},i),f.push(r==null?void 0:r(p)),()=>{f.forEach(y=>y==null?void 0:y())}});v.useLayoutEffect(()=>{if(o)return l==null?void 0:l(o)},[o,l]);const{Canvas:d}=tt(),{ContextMenu:h}=ai();return h?u.jsx(h,{}):d?u.jsx(d,{}):null}v.memo(function(t){const[e,s]=v.useState(null),[r,i]=v.useState(null),o=Wa(t.shapeUtils??[]),a=v.useMemo(()=>[...Iy,...o],[o]),c=Wa(t.bindingUtils??[]),l=v.useMemo(()=>[..._P,...c],[c]),d=SP({snapshot:t.snapshot,shapeUtils:a}),h=w_(),{done:p,error:f}=fk(h),{pageId:y,bounds:m,scale:x,background:w,padding:b,darkMode:I,preserveAspectRatio:E,format:P="svg"}=t;return v.useLayoutEffect(()=>{if(!r||!d||!p)return;let C=!1;const _=document.createElement("div");r.appendChild(_),r.classList.add("tl-container","tl-theme__light");const k=new X({store:d,shapeUtils:a,bindingUtils:l,tools:[],getContainer:()=>_});y&&k.setCurrentPage(y);const D=k.getCurrentPageShapeIds();async function T(){const A=await k.getSvgString([...D],{bounds:m,scale:x,background:w,padding:b,darkMode:I,preserveAspectRatio:E});if(A&&!C){if(P==="svg"){if(!C){const L=new Blob([A.svg],{type:"image/svg+xml"}),j=URL.createObjectURL(L);s(j)}}else if(P==="png"){const L=await k_(k,A.svg,{type:P,quality:1,scale:2,width:A.width,height:A.height});if(L&&!C){const j=URL.createObjectURL(L);s(j)}}}k.dispose()}return T(),()=>{C=!0}},[P,r,d,a,l,y,m,x,w,b,I,E,p,f]),f?u.jsx(bP,{children:"Could not load assets."}):p?u.jsx("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:e&&u.jsx("img",{src:e,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):u.jsx(uy,{children:u.jsx(Jm,{})})});const oZ=ye({schemaVersion:Jt(1),storeVersion:sd,recordVersions:cu(he,ye({version:sd,subTypeVersions:cu(he,sd).optional(),subTypeKey:he.optional()}))}),aZ=ye({schemaVersion:Jt(2),sequences:cu(he,sd)});ye({tldrawFileFormatVersion:wB,schema:xB("schemaVersion",{1:oZ,2:aZ}),records:jt(ye({id:he,typeName:he}).allowUnknownProperties())});var gk={exports:{}},cZ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",lZ=cZ,dZ=lZ;function mk(){}function yk(){}yk.resetWarningCache=mk;var uZ=function(){function n(s,r,i,o,a,c){if(c!==dZ){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}n.isRequired=n;function t(){return n}var e={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:t,element:n,elementType:n,instanceOf:t,node:n,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:yk,resetWarningCache:mk};return e.PropTypes=e,e};gk.exports=uZ();var hZ=gk.exports;const Xe=ur(hZ);function pZ(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var Sk=v,fZ=pZ(Sk);function Iv(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function gZ(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var mZ=!!(typeof window<"u"&&window.document&&window.document.createElement);function yZ(n,t,e){if(typeof n!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof t!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof e<"u"&&typeof e!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function s(r){return r.displayName||r.name||"Component"}return function(i){if(typeof i!="function")throw new Error("Expected WrappedComponent to be a React component.");var o=[],a;function c(){a=n(o.map(function(d){return d.props})),l.canUseDOM?t(a):e&&(a=e(a))}var l=function(d){gZ(h,d);function h(){return d.apply(this,arguments)||this}h.peek=function(){return a},h.rewind=function(){if(h.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var y=a;return a=void 0,o=[],y};var p=h.prototype;return p.UNSAFE_componentWillMount=function(){o.push(this),c()},p.componentDidUpdate=function(){c()},p.componentWillUnmount=function(){var y=o.indexOf(this);o.splice(y,1),c()},p.render=function(){return fZ.createElement(i,this.props)},h}(Sk.PureComponent);return Iv(l,"displayName","SideEffect("+s(i)+")"),Iv(l,"canUseDOM",mZ),l}}var SZ=yZ;const wZ=ur(SZ);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Pv=Object.getOwnPropertySymbols,xZ=Object.prototype.hasOwnProperty,bZ=Object.prototype.propertyIsEnumerable;function vZ(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function CZ(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var s=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(s.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(i){r[i]=i}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var IZ=CZ()?Object.assign:function(n,t){for(var e,s=vZ(n),r,i=1;i<arguments.length;i++){e=Object(arguments[i]);for(var o in e)xZ.call(e,o)&&(s[o]=e[o]);if(Pv){r=Pv(e);for(var a=0;a<r.length;a++)bZ.call(e,r[a])&&(s[r[a]]=e[r[a]])}}return s};const PZ=ur(IZ);var Pi={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},ue={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(ue).map(function(n){return ue[n]});var Ze={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},Au={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},mc={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},EZ=Object.keys(Au).reduce(function(n,t){return n[Au[t]]=t,n},{}),_Z=[ue.NOSCRIPT,ue.SCRIPT,ue.STYLE],as="data-react-helmet",TZ=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kZ=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},MZ=function(){function n(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,s){return e&&n(t.prototype,e),s&&n(t,s),t}}(),dn=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},AZ=function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)},Ev=function(n,t){var e={};for(var s in n)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s]);return e},jZ=function(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n},Wg=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return e===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},DZ=function(t){var e=jo(t,ue.TITLE),s=jo(t,mc.TITLE_TEMPLATE);if(s&&e)return s.replace(/%s/g,function(){return Array.isArray(e)?e.join(""):e});var r=jo(t,mc.DEFAULT_TITLE);return e||r||void 0},OZ=function(t){return jo(t,mc.ON_CHANGE_CLIENT_STATE)||function(){}},of=function(t,e){return e.filter(function(s){return typeof s[t]<"u"}).map(function(s){return s[t]}).reduce(function(s,r){return dn({},s,r)},{})},RZ=function(t,e){return e.filter(function(s){return typeof s[ue.BASE]<"u"}).map(function(s){return s[ue.BASE]}).reverse().reduce(function(s,r){if(!s.length)for(var i=Object.keys(r),o=0;o<i.length;o++){var a=i[o],c=a.toLowerCase();if(t.indexOf(c)!==-1&&r[c])return s.concat(r)}return s},[])},Da=function(t,e,s){var r={};return s.filter(function(i){return Array.isArray(i[t])?!0:(typeof i[t]<"u"&&NZ("Helmet: "+t+' should be of type "Array". Instead found type "'+TZ(i[t])+'"'),!1)}).map(function(i){return i[t]}).reverse().reduce(function(i,o){var a={};o.filter(function(p){for(var f=void 0,y=Object.keys(p),m=0;m<y.length;m++){var x=y[m],w=x.toLowerCase();e.indexOf(w)!==-1&&!(f===Ze.REL&&p[f].toLowerCase()==="canonical")&&!(w===Ze.REL&&p[w].toLowerCase()==="stylesheet")&&(f=w),e.indexOf(x)!==-1&&(x===Ze.INNER_HTML||x===Ze.CSS_TEXT||x===Ze.ITEM_PROP)&&(f=x)}if(!f||!p[f])return!1;var b=p[f].toLowerCase();return r[f]||(r[f]={}),a[f]||(a[f]={}),r[f][b]?!1:(a[f][b]=!0,!0)}).reverse().forEach(function(p){return i.push(p)});for(var c=Object.keys(a),l=0;l<c.length;l++){var d=c[l],h=PZ({},r[d],a[d]);r[d]=h}return i},[]).reverse()},jo=function(t,e){for(var s=t.length-1;s>=0;s--){var r=t[s];if(r.hasOwnProperty(e))return r[e]}return null},LZ=function(t){return{baseTag:RZ([Ze.HREF,Ze.TARGET],t),bodyAttributes:of(Pi.BODY,t),defer:jo(t,mc.DEFER),encode:jo(t,mc.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:of(Pi.HTML,t),linkTags:Da(ue.LINK,[Ze.REL,Ze.HREF],t),metaTags:Da(ue.META,[Ze.NAME,Ze.CHARSET,Ze.HTTPEQUIV,Ze.PROPERTY,Ze.ITEM_PROP],t),noscriptTags:Da(ue.NOSCRIPT,[Ze.INNER_HTML],t),onChangeClientState:OZ(t),scriptTags:Da(ue.SCRIPT,[Ze.SRC,Ze.INNER_HTML],t),styleTags:Da(ue.STYLE,[Ze.CSS_TEXT],t),title:DZ(t),titleAttributes:of(Pi.TITLE,t)}},Vg=function(){var n=Date.now();return function(t){var e=Date.now();e-n>16?(n=e,t(e)):setTimeout(function(){Vg(t)},0)}}(),_v=function(t){return clearTimeout(t)},$Z=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||Vg:global.requestAnimationFrame||Vg,FZ=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||_v:global.cancelAnimationFrame||_v,NZ=function(t){return console&&typeof console.warn=="function"&&console.warn(t)},Oa=null,BZ=function(t){Oa&&FZ(Oa),t.defer?Oa=$Z(function(){Tv(t,function(){Oa=null})}):(Tv(t),Oa=null)},Tv=function(t,e){var s=t.baseTag,r=t.bodyAttributes,i=t.htmlAttributes,o=t.linkTags,a=t.metaTags,c=t.noscriptTags,l=t.onChangeClientState,d=t.scriptTags,h=t.styleTags,p=t.title,f=t.titleAttributes;Yg(ue.BODY,r),Yg(ue.HTML,i),zZ(p,f);var y={baseTag:uo(ue.BASE,s),linkTags:uo(ue.LINK,o),metaTags:uo(ue.META,a),noscriptTags:uo(ue.NOSCRIPT,c),scriptTags:uo(ue.SCRIPT,d),styleTags:uo(ue.STYLE,h)},m={},x={};Object.keys(y).forEach(function(w){var b=y[w],I=b.newTags,E=b.oldTags;I.length&&(m[w]=I),E.length&&(x[w]=y[w].oldTags)}),e&&e(),l(t,m,x)},wk=function(t){return Array.isArray(t)?t.join(""):t},zZ=function(t,e){typeof t<"u"&&document.title!==t&&(document.title=wk(t)),Yg(ue.TITLE,e)},Yg=function(t,e){var s=document.getElementsByTagName(t)[0];if(s){for(var r=s.getAttribute(as),i=r?r.split(","):[],o=[].concat(i),a=Object.keys(e),c=0;c<a.length;c++){var l=a[c],d=e[l]||"";s.getAttribute(l)!==d&&s.setAttribute(l,d),i.indexOf(l)===-1&&i.push(l);var h=o.indexOf(l);h!==-1&&o.splice(h,1)}for(var p=o.length-1;p>=0;p--)s.removeAttribute(o[p]);i.length===o.length?s.removeAttribute(as):s.getAttribute(as)!==a.join(",")&&s.setAttribute(as,a.join(","))}},uo=function(t,e){var s=document.head||document.querySelector(ue.HEAD),r=s.querySelectorAll(t+"["+as+"]"),i=Array.prototype.slice.call(r),o=[],a=void 0;return e&&e.length&&e.forEach(function(c){var l=document.createElement(t);for(var d in c)if(c.hasOwnProperty(d))if(d===Ze.INNER_HTML)l.innerHTML=c.innerHTML;else if(d===Ze.CSS_TEXT)l.styleSheet?l.styleSheet.cssText=c.cssText:l.appendChild(document.createTextNode(c.cssText));else{var h=typeof c[d]>"u"?"":c[d];l.setAttribute(d,h)}l.setAttribute(as,"true"),i.some(function(p,f){return a=f,l.isEqualNode(p)})?i.splice(a,1):o.push(l)}),i.forEach(function(c){return c.parentNode.removeChild(c)}),o.forEach(function(c){return s.appendChild(c)}),{oldTags:i,newTags:o}},xk=function(t){return Object.keys(t).reduce(function(e,s){var r=typeof t[s]<"u"?s+'="'+t[s]+'"':""+s;return e?e+" "+r:r},"")},UZ=function(t,e,s,r){var i=xk(s),o=wk(e);return i?"<"+t+" "+as+'="true" '+i+">"+Wg(o,r)+"</"+t+">":"<"+t+" "+as+'="true">'+Wg(o,r)+"</"+t+">"},HZ=function(t,e,s){return e.reduce(function(r,i){var o=Object.keys(i).filter(function(l){return!(l===Ze.INNER_HTML||l===Ze.CSS_TEXT)}).reduce(function(l,d){var h=typeof i[d]>"u"?d:d+'="'+Wg(i[d],s)+'"';return l?l+" "+h:h},""),a=i.innerHTML||i.cssText||"",c=_Z.indexOf(t)===-1;return r+"<"+t+" "+as+'="true" '+o+(c?"/>":">"+a+"</"+t+">")},"")},bk=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(s,r){return s[Au[r]||r]=t[r],s},e)},KZ=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(s,r){return s[EZ[r]||r]=t[r],s},e)},GZ=function(t,e,s){var r,i=(r={key:e},r[as]=!0,r),o=bk(s,i);return[me.createElement(ue.TITLE,o,e)]},WZ=function(t,e){return e.map(function(s,r){var i,o=(i={key:r},i[as]=!0,i);return Object.keys(s).forEach(function(a){var c=Au[a]||a;if(c===Ze.INNER_HTML||c===Ze.CSS_TEXT){var l=s.innerHTML||s.cssText;o.dangerouslySetInnerHTML={__html:l}}else o[c]=s[a]}),me.createElement(t,o)})},Vs=function(t,e,s){switch(t){case ue.TITLE:return{toComponent:function(){return GZ(t,e.title,e.titleAttributes)},toString:function(){return UZ(t,e.title,e.titleAttributes,s)}};case Pi.BODY:case Pi.HTML:return{toComponent:function(){return bk(e)},toString:function(){return xk(e)}};default:return{toComponent:function(){return WZ(t,e)},toString:function(){return HZ(t,e,s)}}}},vk=function(t){var e=t.baseTag,s=t.bodyAttributes,r=t.encode,i=t.htmlAttributes,o=t.linkTags,a=t.metaTags,c=t.noscriptTags,l=t.scriptTags,d=t.styleTags,h=t.title,p=h===void 0?"":h,f=t.titleAttributes;return{base:Vs(ue.BASE,e,r),bodyAttributes:Vs(Pi.BODY,s,r),htmlAttributes:Vs(Pi.HTML,i,r),link:Vs(ue.LINK,o,r),meta:Vs(ue.META,a,r),noscript:Vs(ue.NOSCRIPT,c,r),script:Vs(ue.SCRIPT,l,r),style:Vs(ue.STYLE,d,r),title:Vs(ue.TITLE,{title:p,titleAttributes:f},r)}},VZ=function(t){var e,s;return s=e=function(r){AZ(i,r);function i(){return kZ(this,i),jZ(this,r.apply(this,arguments))}return i.prototype.shouldComponentUpdate=function(a){return!tj(this.props,a)},i.prototype.mapNestedChildrenToProps=function(a,c){if(!c)return null;switch(a.type){case ue.SCRIPT:case ue.NOSCRIPT:return{innerHTML:c};case ue.STYLE:return{cssText:c}}throw new Error("<"+a.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},i.prototype.flattenArrayTypeChildren=function(a){var c,l=a.child,d=a.arrayTypeChildren,h=a.newChildProps,p=a.nestedChildren;return dn({},d,(c={},c[l.type]=[].concat(d[l.type]||[],[dn({},h,this.mapNestedChildrenToProps(l,p))]),c))},i.prototype.mapObjectTypeChildren=function(a){var c,l,d=a.child,h=a.newProps,p=a.newChildProps,f=a.nestedChildren;switch(d.type){case ue.TITLE:return dn({},h,(c={},c[d.type]=f,c.titleAttributes=dn({},p),c));case ue.BODY:return dn({},h,{bodyAttributes:dn({},p)});case ue.HTML:return dn({},h,{htmlAttributes:dn({},p)})}return dn({},h,(l={},l[d.type]=dn({},p),l))},i.prototype.mapArrayTypeChildrenToProps=function(a,c){var l=dn({},c);return Object.keys(a).forEach(function(d){var h;l=dn({},l,(h={},h[d]=a[d],h))}),l},i.prototype.warnOnInvalidChildren=function(a,c){return!0},i.prototype.mapChildrenToProps=function(a,c){var l=this,d={};return me.Children.forEach(a,function(h){if(!(!h||!h.props)){var p=h.props,f=p.children,y=Ev(p,["children"]),m=KZ(y);switch(l.warnOnInvalidChildren(h,f),h.type){case ue.LINK:case ue.META:case ue.NOSCRIPT:case ue.SCRIPT:case ue.STYLE:d=l.flattenArrayTypeChildren({child:h,arrayTypeChildren:d,newChildProps:m,nestedChildren:f});break;default:c=l.mapObjectTypeChildren({child:h,newProps:c,newChildProps:m,nestedChildren:f});break}}}),c=this.mapArrayTypeChildrenToProps(d,c),c},i.prototype.render=function(){var a=this.props,c=a.children,l=Ev(a,["children"]),d=dn({},l);return c&&(d=this.mapChildrenToProps(c,d)),me.createElement(t,d)},MZ(i,null,[{key:"canUseDOM",set:function(a){t.canUseDOM=a}}]),i}(me.Component),e.propTypes={base:Xe.object,bodyAttributes:Xe.object,children:Xe.oneOfType([Xe.arrayOf(Xe.node),Xe.node]),defaultTitle:Xe.string,defer:Xe.bool,encodeSpecialCharacters:Xe.bool,htmlAttributes:Xe.object,link:Xe.arrayOf(Xe.object),meta:Xe.arrayOf(Xe.object),noscript:Xe.arrayOf(Xe.object),onChangeClientState:Xe.func,script:Xe.arrayOf(Xe.object),style:Xe.arrayOf(Xe.object),title:Xe.string,titleAttributes:Xe.object,titleTemplate:Xe.string},e.defaultProps={defer:!0,encodeSpecialCharacters:!0},e.peek=t.peek,e.rewind=function(){var r=t.rewind();return r||(r=vk({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),r},s},YZ=function(){return null},XZ=wZ(LZ,BZ,vk)(YZ),Xg=VZ(XZ);Xg.renderStatic=Xg.rewind;const qZ=()=>u.jsxs(Xg,{children:[u.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap",rel:"stylesheet"}),u.jsx("style",{children:`
              html,
              body {
                height: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                font-family: Inter, sans-serif !important;
                font-size: 16px !important;
                overscroll-behavior: none !important;
                touch-action: none !important;
                min-height: 100vh !important;
                min-height: -webkit-fill-available !important; /* mobile viewport bug fix */
              }

              .tldraw__editor {
                position: fixed;
                inset: 0;
                overflow: hidden;
              }
 `})]}),ZZ=qZ,bn=()=>new Map,qg=n=>{const t=bn();return n.forEach((e,s)=>{t.set(s,e)}),t},zs=(n,t,e)=>{let s=n.get(t);return s===void 0&&n.set(t,s=e()),s},JZ=(n,t)=>{const e=[];for(const[s,r]of n)e.push(t(r,s));return e},QZ=(n,t)=>{for(const[e,s]of n)if(t(s,e))return!0;return!1},Vr=()=>new Set,af=n=>n[n.length-1],eJ=(n,t)=>{for(let e=0;e<t.length;e++)n.push(t[e])},lr=Array.from,tJ=Array.isArray;class nJ{constructor(){this._observers=bn()}on(t,e){return zs(this._observers,t,Vr).add(e),e}once(t,e){const s=(...r)=>{this.off(t,s),e(...r)};this.on(t,s)}off(t,e){const s=this._observers.get(t);s!==void 0&&(s.delete(e),s.size===0&&this._observers.delete(t))}emit(t,e){return lr((this._observers.get(t)||bn()).values()).forEach(s=>s(...e))}destroy(){this._observers=bn()}}class mS{constructor(){this._observers=bn()}on(t,e){zs(this._observers,t,Vr).add(e)}once(t,e){const s=(...r)=>{this.off(t,s),e(...r)};this.on(t,s)}off(t,e){const s=this._observers.get(t);s!==void 0&&(s.delete(e),s.size===0&&this._observers.delete(t))}emit(t,e){return lr((this._observers.get(t)||bn()).values()).forEach(s=>s(...e))}destroy(){this._observers=bn()}}const dr=Math.floor,Hd=Math.abs,yS=(n,t)=>n<t?n:t,qi=(n,t)=>n>t?n:t,sJ=Math.pow,Ck=n=>n!==0?n<0:1/n<0,kv=1,Mv=2,cf=4,lf=8,yc=32,ir=64,Rn=128,Mh=31,Zg=63,Ei=127,rJ=2147483647,Ik=Number.MAX_SAFE_INTEGER,iJ=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&dr(n)===n),oJ=String.fromCharCode,aJ=n=>n.toLowerCase(),cJ=/^\s*/g,lJ=n=>n.replace(cJ,""),dJ=/([A-Z])/g,Av=(n,t)=>lJ(n.replace(dJ,e=>`${t}${aJ(e)}`)),uJ=n=>{const t=unescape(encodeURIComponent(n)),e=t.length,s=new Uint8Array(e);for(let r=0;r<e;r++)s[r]=t.codePointAt(r);return s},Sc=typeof TextEncoder<"u"?new TextEncoder:null,hJ=n=>Sc.encode(n),pJ=Sc?hJ:uJ;let qa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});qa&&qa.decode(new Uint8Array).length===1&&(qa=null);class Xc{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Vt=()=>new Xc,SS=n=>{let t=n.cpos;for(let e=0;e<n.bufs.length;e++)t+=n.bufs[e].length;return t},it=n=>{const t=new Uint8Array(SS(n));let e=0;for(let s=0;s<n.bufs.length;s++){const r=n.bufs[s];t.set(r,e),e+=r.length}return t.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),e),t},fJ=(n,t)=>{const e=n.cbuf.length;e-n.cpos<t&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(qi(e,t)*2),n.cpos=0)},vt=(n,t)=>{const e=n.cbuf.length;n.cpos===e&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(e*2),n.cpos=0),n.cbuf[n.cpos++]=t},Jg=vt,re=(n,t)=>{for(;t>Ei;)vt(n,Rn|Ei&t),t=dr(t/128);vt(n,Ei&t)},wS=(n,t)=>{const e=Ck(t);for(e&&(t=-t),vt(n,(t>Zg?Rn:0)|(e?ir:0)|Zg&t),t=dr(t/64);t>0;)vt(n,(t>Ei?Rn:0)|Ei&t),t=dr(t/128)},Qg=new Uint8Array(3e4),gJ=Qg.length/3,mJ=(n,t)=>{if(t.length<gJ){const e=Sc.encodeInto(t,Qg).written||0;re(n,e);for(let s=0;s<e;s++)vt(n,Qg[s])}else pt(n,pJ(t))},yJ=(n,t)=>{const e=unescape(encodeURIComponent(t)),s=e.length;re(n,s);for(let r=0;r<s;r++)vt(n,e.codePointAt(r))},_i=Sc&&Sc.encodeInto?mJ:yJ,Ah=(n,t)=>{const e=n.cbuf.length,s=n.cpos,r=yS(e-s,t.length),i=t.length-r;n.cbuf.set(t.subarray(0,r),s),n.cpos+=r,i>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(qi(e*2,i)),n.cbuf.set(t.subarray(r)),n.cpos=i)},pt=(n,t)=>{re(n,t.byteLength),Ah(n,t)},xS=(n,t)=>{fJ(n,t);const e=new DataView(n.cbuf.buffer,n.cpos,t);return n.cpos+=t,e},SJ=(n,t)=>xS(n,4).setFloat32(0,t,!1),wJ=(n,t)=>xS(n,8).setFloat64(0,t,!1),xJ=(n,t)=>xS(n,8).setBigInt64(0,t,!1),jv=new DataView(new ArrayBuffer(4)),bJ=n=>(jv.setFloat32(0,n),jv.getFloat32(0)===n),wc=(n,t)=>{switch(typeof t){case"string":vt(n,119),_i(n,t);break;case"number":iJ(t)&&Hd(t)<=rJ?(vt(n,125),wS(n,t)):bJ(t)?(vt(n,124),SJ(n,t)):(vt(n,123),wJ(n,t));break;case"bigint":vt(n,122),xJ(n,t);break;case"object":if(t===null)vt(n,126);else if(tJ(t)){vt(n,117),re(n,t.length);for(let e=0;e<t.length;e++)wc(n,t[e])}else if(t instanceof Uint8Array)vt(n,116),pt(n,t);else{vt(n,118);const e=Object.keys(t);re(n,e.length);for(let s=0;s<e.length;s++){const r=e[s];_i(n,r),wc(n,t[r])}}break;case"boolean":vt(n,t?120:121);break;default:vt(n,127)}};class Dv extends Xc{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&re(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Ov=n=>{n.count>0&&(wS(n.encoder,n.count===1?n.s:-n.s),n.count>1&&re(n.encoder,n.count-2))};class Kd{constructor(){this.encoder=new Xc,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ov(this),this.count=1,this.s=t)}toUint8Array(){return Ov(this),it(this.encoder)}}const Rv=n=>{if(n.count>0){const t=n.diff*2+(n.count===1?0:1);wS(n.encoder,t),n.count>1&&re(n.encoder,n.count-2)}};class df{constructor(){this.encoder=new Xc,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Rv(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Rv(this),it(this.encoder)}}class vJ{constructor(){this.sarr=[],this.s="",this.lensE=new Kd}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Xc;return this.sarr.push(this.s),this.s="",_i(t,this.sarr.join("")),Ah(t,this.lensE.toUint8Array()),it(t)}}const Yr=n=>new Error(n),ks=()=>{throw Yr("Method unimplemented")},Rs=()=>{throw Yr("Unexpected case")},Pk=Yr("Unexpected end of array"),Ek=Yr("Integer out of Range");class jh{constructor(t){this.arr=t,this.pos=0}}const ci=n=>new jh(n),CJ=n=>n.pos!==n.arr.length,IJ=(n,t)=>{const e=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,t);return n.pos+=t,e},Kt=n=>IJ(n,de(n)),Vo=n=>n.arr[n.pos++],de=n=>{let t=0,e=1;const s=n.arr.length;for(;n.pos<s;){const r=n.arr[n.pos++];if(t=t+(r&Ei)*e,e*=128,r<Rn)return t;if(t>Ik)throw Ek}throw Pk},bS=n=>{let t=n.arr[n.pos++],e=t&Zg,s=64;const r=(t&ir)>0?-1:1;if(!(t&Rn))return r*e;const i=n.arr.length;for(;n.pos<i;){if(t=n.arr[n.pos++],e=e+(t&Ei)*s,s*=128,t<Rn)return r*e;if(e>Ik)throw Ek}throw Pk},PJ=n=>{let t=de(n);if(t===0)return"";{let e=String.fromCodePoint(Vo(n));if(--t<100)for(;t--;)e+=String.fromCodePoint(Vo(n));else for(;t>0;){const s=t<1e4?t:1e4,r=n.arr.subarray(n.pos,n.pos+s);n.pos+=s,e+=String.fromCodePoint.apply(null,r),t-=s}return decodeURIComponent(escape(e))}},EJ=n=>qa.decode(Kt(n)),zr=qa?EJ:PJ,vS=(n,t)=>{const e=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,t);return n.pos+=t,e},_J=n=>vS(n,4).getFloat32(0,!1),TJ=n=>vS(n,8).getFloat64(0,!1),kJ=n=>vS(n,8).getBigInt64(0,!1),MJ=[n=>{},n=>null,bS,_J,TJ,kJ,n=>!1,n=>!0,zr,n=>{const t=de(n),e={};for(let s=0;s<t;s++){const r=zr(n);e[r]=xc(n)}return e},n=>{const t=de(n),e=[];for(let s=0;s<t;s++)e.push(xc(n));return e},Kt],xc=n=>MJ[127-Vo(n)](n);class Lv extends jh{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),CJ(this)?this.count=de(this)+1:this.count=-1),this.count--,this.s}}class Gd extends jh{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=bS(this);const t=Ck(this.s);this.count=1,t&&(this.s=-this.s,this.count=de(this)+2)}return this.count--,this.s}}class uf extends jh{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=bS(this),e=t&1;this.diff=dr(t/2),this.count=1,e&&(this.count=de(this)+2)}return this.s+=this.diff,this.count--,this.s}}class AJ{constructor(t){this.decoder=new Gd(t),this.str=zr(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}const jJ=crypto.getRandomValues.bind(crypto),_k=()=>jJ(new Uint32Array(1))[0],DJ="10000000-1000-4000-8000"+-1e11,OJ=()=>DJ.replace(/[018]/g,n=>(n^_k()&15>>n/4).toString(16)),zi=Date.now,$v=n=>new Promise(n);Promise.all.bind(Promise);const Fv=n=>n===void 0?null:n;class RJ{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Tk=new RJ,CS=!0;try{typeof localStorage<"u"&&localStorage&&(Tk=localStorage,CS=!1)}catch{}const kk=Tk,LJ=n=>CS||addEventListener("storage",n),$J=n=>CS||removeEventListener("storage",n),FJ=Object.assign,Mk=Object.keys,NJ=(n,t)=>{for(const e in n)t(n[e],e)},BJ=(n,t)=>{const e=[];for(const s in n)e.push(t(n[s],s));return e},Nv=n=>Mk(n).length,Bv=n=>Mk(n).length,zJ=n=>{for(const t in n)return!1;return!0},UJ=(n,t)=>{for(const e in n)if(!t(n[e],e))return!1;return!0},Ak=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),HJ=(n,t)=>n===t||Bv(n)===Bv(t)&&UJ(n,(e,s)=>(e!==void 0||Ak(t,s))&&t[s]===e),IS=(n,t,e=0)=>{try{for(;e<n.length;e++)n[e](...t)}finally{e<n.length&&IS(n,t,e+1)}},KJ=n=>n,GJ=(n,t)=>n===t,Za=(n,t)=>{if(n==null||t==null)return GJ(n,t);if(n.constructor!==t.constructor)return!1;if(n===t)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),t=new Uint8Array(t);case Uint8Array:{if(n.byteLength!==t.byteLength)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;break}case Set:{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;break}case Map:{if(n.size!==t.size)return!1;for(const e of n.keys())if(!t.has(e)||!Za(n.get(e),t.get(e)))return!1;break}case Object:if(Nv(n)!==Nv(t))return!1;for(const e in n)if(!Ak(n,e)||!Za(n[e],t[e]))return!1;break;case Array:if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(!Za(n[e],t[e]))return!1;break;default:return!1}return!0},WJ=(n,t)=>t.includes(n);var jk={};const Xr=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Dk=typeof window<"u"&&typeof document<"u"&&!Xr;let ws;const VJ=()=>{if(ws===void 0)if(Xr){ws=bn();const n=process.argv;let t=null;for(let e=0;e<n.length;e++){const s=n[e];s[0]==="-"?(t!==null&&ws.set(t,""),t=s):t!==null&&(ws.set(t,s),t=null)}t!==null&&ws.set(t,"")}else typeof location=="object"?(ws=bn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[t,e]=n.split("=");ws.set(`--${Av(t,"-")}`,e),ws.set(`-${Av(t,"-")}`,e)}})):ws=bn();return ws},em=n=>VJ().has(n),tm=n=>Fv(Xr?jk[n.toUpperCase().replaceAll("-","_")]:kk.getItem(n)),YJ=n=>em("--"+n)||tm(n)!==null;YJ("production");const zv=Xr&&WJ(jk.FORCE_COLOR,["true","1","2"]),XJ=!em("--no-colors")&&(!Xr||process.stdout.isTTY||zv)&&(!Xr||em("--color")||zv||tm("COLORTERM")!==null||(tm("TERM")||"").includes("color")),Ok=n=>new Uint8Array(n),qJ=(n,t,e)=>new Uint8Array(n,t,e),ZJ=n=>new Uint8Array(n),JJ=n=>{let t="";for(let e=0;e<n.byteLength;e++)t+=oJ(n[e]);return btoa(t)},QJ=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),eQ=n=>{const t=atob(n),e=Ok(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e},tQ=n=>{const t=Buffer.from(n,"base64");return qJ(t.buffer,t.byteOffset,t.byteLength)},nQ=Dk?JJ:QJ,sQ=Dk?eQ:tQ,rQ=n=>{const t=Ok(n.byteLength);return t.set(n),t};class iQ{constructor(t,e){this.left=t,this.right=e}}const Ys=(n,t)=>new iQ(n,t);typeof DOMParser<"u"&&new DOMParser;const oQ=n=>JZ(n,(t,e)=>`${e}:${t};`).join(""),Sr=Symbol,Rk=Sr(),Lk=Sr(),aQ=Sr(),cQ=Sr(),lQ=Sr(),$k=Sr(),dQ=Sr(),Fk=Sr(),uQ=Sr(),hQ=n=>{var s;n.length===1&&((s=n[0])==null?void 0:s.constructor)===Function&&(n=n[0]());const t=[];let e=0;for(;e<n.length;e++){const r=n[e];r===void 0||r.constructor===String||r.constructor===Number||r.constructor===Object&&t.push(JSON.stringify(r))}return t},pQ={[Rk]:Ys("font-weight","bold"),[Lk]:Ys("font-weight","normal"),[aQ]:Ys("color","blue"),[lQ]:Ys("color","green"),[cQ]:Ys("color","grey"),[$k]:Ys("color","red"),[dQ]:Ys("color","purple"),[Fk]:Ys("color","orange"),[uQ]:Ys("color","black")},fQ=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const t=[],e=[],s=bn();let r=[],i=0;for(;i<n.length;i++){const a=n[i],c=pQ[a];if(c!==void 0)s.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=oQ(s);i>0||l.length>0?(t.push("%c"+a),e.push(l)):t.push(a)}else break}}for(i>0&&(r=e,r.unshift(t.join("")));i<n.length;i++){const a=n[i];a instanceof Symbol||r.push(a)}return r},gQ=XJ?fQ:hQ,mQ=(...n)=>{console.log(...gQ(n)),yQ.forEach(t=>t.print(n))},yQ=Vr(),Nk=n=>({[Symbol.iterator](){return this},next:n}),SQ=(n,t)=>Nk(()=>{let e;do e=n.next();while(!e.done&&!t(e.value));return e}),hf=(n,t)=>Nk(()=>{const{done:e,value:s}=n.next();return{done:e,value:e?void 0:t(s)}});class PS{constructor(t,e){this.clock=t,this.len=e}}class qc{constructor(){this.clients=new Map}}const Bk=(n,t,e)=>t.clients.forEach((s,r)=>{const i=n.doc.store.clients.get(r);for(let o=0;o<s.length;o++){const a=s[o];Qk(n,i,a.clock,a.len,e)}}),wQ=(n,t)=>{let e=0,s=n.length-1;for(;e<=s;){const r=dr((e+s)/2),i=n[r],o=i.clock;if(o<=t){if(t<o+i.len)return r;e=r+1}else s=r-1}return null},zk=(n,t)=>{const e=n.clients.get(t.client);return e!==void 0&&wQ(e,t.clock)!==null},ES=n=>{n.clients.forEach(t=>{t.sort((r,i)=>r.clock-i.clock);let e,s;for(e=1,s=1;e<t.length;e++){const r=t[s-1],i=t[e];r.clock+r.len>=i.clock?r.len=qi(r.len,i.clock+i.len-r.clock):(s<e&&(t[s]=i),s++)}t.length=s})},xQ=n=>{const t=new qc;for(let e=0;e<n.length;e++)n[e].clients.forEach((s,r)=>{if(!t.clients.has(r)){const i=s.slice();for(let o=e+1;o<n.length;o++)eJ(i,n[o].clients.get(r)||[]);t.clients.set(r,i)}});return ES(t),t},ju=(n,t,e,s)=>{zs(n.clients,t,()=>[]).push(new PS(e,s))},bQ=()=>new qc,vQ=n=>{const t=bQ();return n.clients.forEach((e,s)=>{const r=[];for(let i=0;i<e.length;i++){const o=e[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<e.length)for(let l=e[i+1];i+1<e.length&&l.deleted;l=e[++i+1])c+=l.length;r.push(new PS(a,c))}}r.length>0&&t.clients.set(s,r)}),t},la=(n,t)=>{re(n.restEncoder,t.clients.size),lr(t.clients.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{n.resetDsCurVal(),re(n.restEncoder,e);const r=s.length;re(n.restEncoder,r);for(let i=0;i<r;i++){const o=s[i];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},_S=n=>{const t=new qc,e=de(n.restDecoder);for(let s=0;s<e;s++){n.resetDsCurVal();const r=de(n.restDecoder),i=de(n.restDecoder);if(i>0){const o=zs(t.clients,r,()=>[]);for(let a=0;a<i;a++)o.push(new PS(n.readDsClock(),n.readDsLen()))}}return t},Uv=(n,t,e)=>{const s=new qc,r=de(n.restDecoder);for(let i=0;i<r;i++){n.resetDsCurVal();const o=de(n.restDecoder),a=de(n.restDecoder),c=e.clients.get(o)||[],l=Et(e,o);for(let d=0;d<a;d++){const h=n.readDsClock(),p=h+n.readDsLen();if(h<l){l<p&&ju(s,o,l,p-l);let f=Ls(c,h),y=c[f];for(!y.deleted&&y.id.clock<h&&(c.splice(f+1,0,Nu(t,y,h-y.id.clock)),f++);f<c.length&&(y=c[f++],y.id.clock<p);)y.deleted||(p<y.id.clock+y.length&&c.splice(f,0,Nu(t,y,p-y.id.clock)),y.delete(t))}else ju(s,o,h,p-h)}}if(s.clients.size>0){const i=new Ui;return re(i.restEncoder,0),la(i,s),i.toUint8Array()}return null},Uk=_k;class da extends nJ{constructor({guid:t=OJ(),collectionid:e=null,gc:s=!0,gcFilter:r=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=s,this.gcFilter=r,this.clientID=Uk(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new Zk,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=$v(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>$v(l=>{const d=h=>{(h===void 0||h===!0)&&(this.off("sync",d),l())};this.on("sync",d)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&ze(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(lr(this.subdocs).map(t=>t.guid))}transact(t,e=null){return ze(this,t,e)}get(t,e=$t){const s=zs(this.share,t,()=>{const i=new e;return i._integrate(this,null),i}),r=s.constructor;if(e!==$t&&r!==e)if(r===$t){const i=new e;i._map=s._map,s._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=s._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=s._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return s}getArray(t=""){return this.get(t,Oo)}getText(t=""){return this.get(t,qo)}getMap(t=""){return this.get(t,Xo)}getXmlElement(t=""){return this.get(t,Zo)}getXmlFragment(t=""){return this.get(t,Hi)}toJSON(){const t={};return this.share.forEach((e,s)=>{t[s]=e.toJSON()}),t}destroy(){lr(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new da({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,ze(t.parent.doc,s=>{const r=e.doc;t.deleted||s.subdocsAdded.add(r),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Hk{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return de(this.restDecoder)}readDsLen(){return de(this.restDecoder)}}class Kk extends Hk{readLeftID(){return xe(de(this.restDecoder),de(this.restDecoder))}readRightID(){return xe(de(this.restDecoder),de(this.restDecoder))}readClient(){return de(this.restDecoder)}readInfo(){return Vo(this.restDecoder)}readString(){return zr(this.restDecoder)}readParentInfo(){return de(this.restDecoder)===1}readTypeRef(){return de(this.restDecoder)}readLen(){return de(this.restDecoder)}readAny(){return xc(this.restDecoder)}readBuf(){return rQ(Kt(this.restDecoder))}readJSON(){return JSON.parse(zr(this.restDecoder))}readKey(){return zr(this.restDecoder)}}class CQ{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=de(this.restDecoder),this.dsCurrVal}readDsLen(){const t=de(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Yo extends CQ{constructor(t){super(t),this.keys=[],de(t),this.keyClockDecoder=new uf(Kt(t)),this.clientDecoder=new Gd(Kt(t)),this.leftClockDecoder=new uf(Kt(t)),this.rightClockDecoder=new uf(Kt(t)),this.infoDecoder=new Lv(Kt(t),Vo),this.stringDecoder=new AJ(Kt(t)),this.parentInfoDecoder=new Lv(Kt(t),Vo),this.typeRefDecoder=new Gd(Kt(t)),this.lenDecoder=new Gd(Kt(t))}readLeftID(){return new Do(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Do(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return xc(this.restDecoder)}readBuf(){return Kt(this.restDecoder)}readJSON(){return xc(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Gk{constructor(){this.restEncoder=Vt()}toUint8Array(){return it(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){re(this.restEncoder,t)}writeDsLen(t){re(this.restEncoder,t)}}class Zc extends Gk{writeLeftID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeRightID(t){re(this.restEncoder,t.client),re(this.restEncoder,t.clock)}writeClient(t){re(this.restEncoder,t)}writeInfo(t){Jg(this.restEncoder,t)}writeString(t){_i(this.restEncoder,t)}writeParentInfo(t){re(this.restEncoder,t?1:0)}writeTypeRef(t){re(this.restEncoder,t)}writeLen(t){re(this.restEncoder,t)}writeAny(t){wc(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){_i(this.restEncoder,JSON.stringify(t))}writeKey(t){_i(this.restEncoder,t)}}class Wk{constructor(){this.restEncoder=Vt(),this.dsCurrVal=0}toUint8Array(){return it(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,re(this.restEncoder,e)}writeDsLen(t){t===0&&Rs(),re(this.restEncoder,t-1),this.dsCurrVal+=t}}class Ui extends Wk{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new df,this.clientEncoder=new Kd,this.leftClockEncoder=new df,this.rightClockEncoder=new df,this.infoEncoder=new Dv(Jg),this.stringEncoder=new vJ,this.parentInfoEncoder=new Dv(Jg),this.typeRefEncoder=new Kd,this.lenEncoder=new Kd}toUint8Array(){const t=Vt();return re(t,0),pt(t,this.keyClockEncoder.toUint8Array()),pt(t,this.clientEncoder.toUint8Array()),pt(t,this.leftClockEncoder.toUint8Array()),pt(t,this.rightClockEncoder.toUint8Array()),pt(t,it(this.infoEncoder)),pt(t,this.stringEncoder.toUint8Array()),pt(t,it(this.parentInfoEncoder)),pt(t,this.typeRefEncoder.toUint8Array()),pt(t,this.lenEncoder.toUint8Array()),Ah(t,it(this.restEncoder)),it(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){wc(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){wc(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const IQ=(n,t,e,s)=>{s=qi(s,t[0].id.clock);const r=Ls(t,s);re(n.restEncoder,t.length-r),n.writeClient(e),re(n.restEncoder,s);const i=t[r];i.write(n,s-i.id.clock);for(let o=r+1;o<t.length;o++)t[o].write(n,0)},TS=(n,t,e)=>{const s=new Map;e.forEach((r,i)=>{Et(t,i)>r&&s.set(i,r)}),Dh(t).forEach((r,i)=>{e.has(i)||s.set(i,0)}),re(n.restEncoder,s.size),lr(s.entries()).sort((r,i)=>i[0]-r[0]).forEach(([r,i])=>{IQ(n,t.clients.get(r),r,i)})},PQ=(n,t)=>{const e=bn(),s=de(n.restDecoder);for(let r=0;r<s;r++){const i=de(n.restDecoder),o=new Array(i),a=n.readClient();let c=de(n.restDecoder);e.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const d=n.readInfo();switch(Mh&d){case 0:{const h=n.readLen();o[l]=new Vn(xe(a,c),h),c+=h;break}case 10:{const h=de(n.restDecoder);o[l]=new Yn(xe(a,c),h),c+=h;break}default:{const h=(d&(ir|Rn))===0,p=new St(xe(a,c),null,(d&Rn)===Rn?n.readLeftID():null,null,(d&ir)===ir?n.readRightID():null,h?n.readParentInfo()?t.get(n.readString()):n.readLeftID():null,h&&(d&yc)===yc?n.readString():null,SM(n,d));o[l]=p,c+=p.length}}}}return e},EQ=(n,t,e)=>{const s=[];let r=lr(e.keys()).sort((f,y)=>f-y);if(r.length===0)return null;const i=()=>{if(r.length===0)return null;let f=e.get(r[r.length-1]);for(;f.refs.length===f.i;)if(r.pop(),r.length>0)f=e.get(r[r.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new Zk,c=new Map,l=(f,y)=>{const m=c.get(f);(m==null||m>y)&&c.set(f,y)};let d=o.refs[o.i++];const h=new Map,p=()=>{for(const f of s){const y=f.id.client,m=e.get(y);m?(m.i--,a.clients.set(y,m.refs.slice(m.i)),e.delete(y),m.i=0,m.refs=[]):a.clients.set(y,[f]),r=r.filter(x=>x!==y)}s.length=0};for(;;){if(d.constructor!==Yn){const y=zs(h,d.id.client,()=>Et(t,d.id.client))-d.id.clock;if(y<0)s.push(d),l(d.id.client,d.id.clock-1),p();else{const m=d.getMissing(n,t);if(m!==null){s.push(d);const x=e.get(m)||{refs:[],i:0};if(x.refs.length===x.i)l(m,Et(t,m)),p();else{d=x.refs[x.i++];continue}}else(y===0||y<d.length)&&(d.integrate(n,y),h.set(d.id.client,d.id.clock+d.length))}}if(s.length>0)d=s.pop();else if(o!==null&&o.i<o.refs.length)d=o.refs[o.i++];else{if(o=i(),o===null)break;d=o.refs[o.i++]}}if(a.clients.size>0){const f=new Ui;return TS(f,a,new Map),re(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},_Q=(n,t)=>TS(n,t.doc.store,t.beforeState),TQ=(n,t,e,s=new Yo(n))=>ze(t,r=>{r.local=!1;let i=!1;const o=r.doc,a=o.store,c=PQ(s,o),l=EQ(r,a,c),d=a.pendingStructs;if(d){for(const[p,f]of d.missing)if(f<Et(a,p)){i=!0;break}if(l){for(const[p,f]of l.missing){const y=d.missing.get(p);(y==null||y>f)&&d.missing.set(p,f)}d.update=Du([d.update,l.update])}}else a.pendingStructs=l;const h=Uv(s,r,a);if(a.pendingDs){const p=new Yo(ci(a.pendingDs));de(p.restDecoder);const f=Uv(p,r,a);h&&f?a.pendingDs=Du([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const p=a.pendingStructs.update;a.pendingStructs=null,Vk(r.doc,p)}},e,!1),Vk=(n,t,e,s=Yo)=>{const r=ci(t);TQ(r,n,e,new s(r))},kQ=(n,t,e)=>Vk(n,t,e,Kk),MQ=(n,t,e=new Map)=>{TS(n,t.store,e),la(n,vQ(t.store))},AQ=(n,t=new Uint8Array([0]),e=new Ui)=>{const s=Yk(t);MQ(e,n,s);const r=[e.toUint8Array()];if(n.store.pendingDs&&r.push(n.store.pendingDs),n.store.pendingStructs&&r.push(VQ(n.store.pendingStructs.update,t)),r.length>1){if(e.constructor===Zc)return GQ(r.map((i,o)=>o===0?i:XQ(i)));if(e.constructor===Ui)return Du(r)}return r[0]},jQ=(n,t)=>AQ(n,t,new Zc),DQ=n=>{const t=new Map,e=de(n.restDecoder);for(let s=0;s<e;s++){const r=de(n.restDecoder),i=de(n.restDecoder);t.set(r,i)}return t},Yk=n=>DQ(new Hk(ci(n))),Xk=(n,t)=>(re(n.restEncoder,t.size),lr(t.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{re(n.restEncoder,e),re(n.restEncoder,s)}),n),OQ=(n,t)=>Xk(n,Dh(t.store)),RQ=(n,t=new Wk)=>(n instanceof Map?Xk(t,n):OQ(t,n),t.toUint8Array()),LQ=n=>RQ(n,new Gk);class $Q{constructor(){this.l=[]}}const Hv=()=>new $Q,Kv=(n,t)=>n.l.push(t),Gv=(n,t)=>{const e=n.l,s=e.length;n.l=e.filter(r=>t!==r),s===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},qk=(n,t,e)=>IS(n.l,[t,e]);class Do{constructor(t,e){this.client=t,this.clock=e}}const Yl=(n,t)=>n===t||n!==null&&t!==null&&n.client===t.client&&n.clock===t.clock,xe=(n,t)=>new Do(n,t),FQ=n=>{for(const[t,e]of n.doc.share.entries())if(e===n)return t;throw Rs()},go=(n,t)=>t===void 0?!n.deleted:t.sv.has(n.id.client)&&(t.sv.get(n.id.client)||0)>n.id.clock&&!zk(t.ds,n.id),nm=(n,t)=>{const e=zs(n.meta,nm,Vr),s=n.doc.store;e.has(t)||(t.sv.forEach((r,i)=>{r<Et(s,i)&&qr(n,xe(i,r))}),Bk(n,t.ds,r=>{}),e.add(t))};class Zk{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Dh=n=>{const t=new Map;return n.clients.forEach((e,s)=>{const r=e[e.length-1];t.set(s,r.id.clock+r.length)}),t},Et=(n,t)=>{const e=n.clients.get(t);if(e===void 0)return 0;const s=e[e.length-1];return s.id.clock+s.length},Jk=(n,t)=>{let e=n.clients.get(t.id.client);if(e===void 0)e=[],n.clients.set(t.id.client,e);else{const s=e[e.length-1];if(s.id.clock+s.length!==t.id.clock)throw Rs()}e.push(t)},Ls=(n,t)=>{let e=0,s=n.length-1,r=n[s],i=r.id.clock;if(i===t)return s;let o=dr(t/(i+r.length-1)*s);for(;e<=s;){if(r=n[o],i=r.id.clock,i<=t){if(t<i+r.length)return o;e=o+1}else s=o-1;o=dr((e+s)/2)}throw Rs()},NQ=(n,t)=>{const e=n.clients.get(t.client);return e[Ls(e,t.clock)]},pf=NQ,sm=(n,t,e)=>{const s=Ls(t,e),r=t[s];return r.id.clock<e&&r instanceof St?(t.splice(s+1,0,Nu(n,r,e-r.id.clock)),s+1):s},qr=(n,t)=>{const e=n.doc.store.clients.get(t.client);return e[sm(n,e,t.clock)]},Wv=(n,t,e)=>{const s=t.clients.get(e.client),r=Ls(s,e.clock),i=s[r];return e.clock!==i.id.clock+i.length-1&&i.constructor!==Vn&&s.splice(r+1,0,Nu(n,i,e.clock-i.id.clock+1)),i},BQ=(n,t,e)=>{const s=n.clients.get(t.id.client);s[Ls(s,t.id.clock)]=e},Qk=(n,t,e,s,r)=>{if(s===0)return;const i=e+s;let o=sm(n,t,e),a;do a=t[o++],i<a.id.clock+a.length&&sm(n,t,i),r(a);while(o<t.length&&t[o].id.clock<i)};class zQ{constructor(t,e,s){this.doc=t,this.deleteSet=new qc,this.beforeState=Dh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Vv=(n,t)=>t.deleteSet.clients.size===0&&!QZ(t.afterState,(e,s)=>t.beforeState.get(s)!==e)?!1:(ES(t.deleteSet),_Q(n,t),la(n,t.deleteSet),!0),Yv=(n,t,e)=>{const s=t._item;(s===null||s.id.clock<(n.beforeState.get(s.id.client)||0)&&!s.deleted)&&zs(n.changed,t,Vr).add(e)},Wd=(n,t)=>{let e=n[t],s=n[t-1],r=t;for(;r>0;e=s,s=n[--r-1]){if(s.deleted===e.deleted&&s.constructor===e.constructor&&s.mergeWith(e)){e instanceof St&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,s);continue}break}const i=t-r;return i&&n.splice(t+1-i,i),i},UQ=(n,t,e)=>{for(const[s,r]of n.clients.entries()){const i=t.clients.get(s);for(let o=r.length-1;o>=0;o--){const a=r[o],c=a.clock+a.len;for(let l=Ls(i,a.clock),d=i[l];l<i.length&&d.id.clock<c;d=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof St&&h.deleted&&!h.keep&&e(h)&&h.gc(t,!1)}}}},HQ=(n,t)=>{n.clients.forEach((e,s)=>{const r=t.clients.get(s);for(let i=e.length-1;i>=0;i--){const o=e[i],a=yS(r.length-1,1+Ls(r,o.clock+o.len-1));for(let c=a,l=r[c];c>0&&l.id.clock>=o.clock;l=r[c])c-=1+Wd(r,c)}})},eM=(n,t)=>{if(t<n.length){const e=n[t],s=e.doc,r=s.store,i=e.deleteSet,o=e._mergeStructs;try{ES(i),e.afterState=Dh(e.doc.store),s.emit("beforeObserverCalls",[e,s]);const a=[];e.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(e,c)})),a.push(()=>{e.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(d=>d.target._item===null||!d.target._item.deleted),c.forEach(d=>{d.currentTarget=l,d._path=null}),c.sort((d,h)=>d.path.length-h.path.length),qk(l._dEH,c,e))})}),a.push(()=>s.emit("afterTransaction",[e,s])),IS(a,[]),e._needFormattingCleanup&&lee(e)}finally{s.gc&&UQ(i,r,s.gcFilter),HQ(i,r),e.afterState.forEach((d,h)=>{const p=e.beforeState.get(h)||0;if(p!==d){const f=r.clients.get(h),y=qi(Ls(f,p),1);for(let m=f.length-1;m>=y;)m-=1+Wd(f,m)}});for(let d=o.length-1;d>=0;d--){const{client:h,clock:p}=o[d].id,f=r.clients.get(h),y=Ls(f,p);y+1<f.length&&Wd(f,y+1)>1||y>0&&Wd(f,y)}if(!e.local&&e.afterState.get(s.clientID)!==e.beforeState.get(s.clientID)&&(mQ(Fk,Rk,"[yjs] ",Lk,$k,"Changed the client-id because another client seems to be using it."),s.clientID=Uk()),s.emit("afterTransactionCleanup",[e,s]),s._observers.has("update")){const d=new Zc;Vv(d,e)&&s.emit("update",[d.toUint8Array(),e.origin,s,e])}if(s._observers.has("updateV2")){const d=new Ui;Vv(d,e)&&s.emit("updateV2",[d.toUint8Array(),e.origin,s,e])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=e;(a.size>0||l.size>0||c.size>0)&&(a.forEach(d=>{d.clientID=s.clientID,d.collectionid==null&&(d.collectionid=s.collectionid),s.subdocs.add(d)}),l.forEach(d=>s.subdocs.delete(d)),s.emit("subdocs",[{loaded:c,added:a,removed:l},s,e]),l.forEach(d=>d.destroy())),n.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,n])):eM(n,t+1)}}},ze=(n,t,e=null,s=!0)=>{const r=n._transactionCleanups;let i=!1,o=null;n._transaction===null&&(i=!0,n._transaction=new zQ(n,e,s),r.push(n._transaction),r.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=t(n._transaction)}finally{if(i){const a=n._transaction===r[0];n._transaction=null,a&&eM(r,0)}}return o};function*KQ(n){const t=de(n.restDecoder);for(let e=0;e<t;e++){const s=de(n.restDecoder),r=n.readClient();let i=de(n.restDecoder);for(let o=0;o<s;o++){const a=n.readInfo();if(a===10){const c=de(n.restDecoder);yield new Yn(xe(r,i),c),i+=c}else if(Mh&a){const c=(a&(ir|Rn))===0,l=new St(xe(r,i),null,(a&Rn)===Rn?n.readLeftID():null,null,(a&ir)===ir?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&yc)===yc?n.readString():null,SM(n,a));yield l,i+=l.length}else{const c=n.readLen();yield new Vn(xe(r,i),c),i+=c}}}}class kS{constructor(t,e){this.gen=KQ(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Yn);return this.curr}}class MS{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const GQ=n=>Du(n,Kk,Zc),WQ=(n,t)=>{if(n.constructor===Vn){const{client:e,clock:s}=n.id;return new Vn(xe(e,s+t),n.length-t)}else if(n.constructor===Yn){const{client:e,clock:s}=n.id;return new Yn(xe(e,s+t),n.length-t)}else{const e=n,{client:s,clock:r}=e.id;return new St(xe(s,r+t),null,xe(s,r+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},Du=(n,t=Yo,e=Ui)=>{if(n.length===1)return n[0];const s=n.map(d=>new t(ci(d)));let r=s.map(d=>new kS(d,!0)),i=null;const o=new e,a=new MS(o);for(;r=r.filter(p=>p.curr!==null),r.sort((p,f)=>{if(p.curr.id.client===f.curr.id.client){const y=p.curr.id.clock-f.curr.id.clock;return y===0?p.curr.constructor===f.curr.constructor?0:p.curr.constructor===Yn?1:-1:y}else return f.curr.id.client-p.curr.id.client}),r.length!==0;){const d=r[0],h=d.curr.id.client;if(i!==null){let p=d.curr,f=!1;for(;p!==null&&p.id.clock+p.length<=i.struct.id.clock+i.struct.length&&p.id.client>=i.struct.id.client;)p=d.next(),f=!0;if(p===null||p.id.client!==h||f&&p.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Ar(a,i.struct,i.offset),i={struct:p,offset:0},d.next();else if(i.struct.id.clock+i.struct.length<p.id.clock)if(i.struct.constructor===Yn)i.struct.length=p.id.clock+p.length-i.struct.id.clock;else{Ar(a,i.struct,i.offset);const y=p.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Yn(xe(h,i.struct.id.clock+i.struct.length),y),offset:0}}else{const y=i.struct.id.clock+i.struct.length-p.id.clock;y>0&&(i.struct.constructor===Yn?i.struct.length-=y:p=WQ(p,y)),i.struct.mergeWith(p)||(Ar(a,i.struct,i.offset),i={struct:p,offset:0},d.next())}}else i={struct:d.curr,offset:0},d.next();for(let p=d.curr;p!==null&&p.id.client===h&&p.id.clock===i.struct.id.clock+i.struct.length&&p.constructor!==Yn;p=d.next())Ar(a,i.struct,i.offset),i={struct:p,offset:0}}i!==null&&(Ar(a,i.struct,i.offset),i=null),AS(a);const c=s.map(d=>_S(d)),l=xQ(c);return la(o,l),o.toUint8Array()},VQ=(n,t,e=Yo,s=Ui)=>{const r=Yk(t),i=new s,o=new MS(i),a=new e(ci(n)),c=new kS(a,!1);for(;c.curr;){const d=c.curr,h=d.id.client,p=r.get(h)||0;if(c.curr.constructor===Yn){c.next();continue}if(d.id.clock+d.length>p)for(Ar(o,d,qi(p-d.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ar(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=p;)c.next()}AS(o);const l=_S(a);return la(i,l),i.toUint8Array()},tM=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:it(n.encoder.restEncoder)}),n.encoder.restEncoder=Vt(),n.written=0)},Ar=(n,t,e)=>{n.written>0&&n.currClient!==t.id.client&&tM(n),n.written===0&&(n.currClient=t.id.client,n.encoder.writeClient(t.id.client),re(n.encoder.restEncoder,t.id.clock+e)),t.write(n.encoder,e),n.written++},AS=n=>{tM(n);const t=n.encoder.restEncoder;re(t,n.clientStructs.length);for(let e=0;e<n.clientStructs.length;e++){const s=n.clientStructs[e];re(t,s.written),Ah(t,s.restEncoder)}},YQ=(n,t,e,s)=>{const r=new e(ci(n)),i=new kS(r,!1),o=new s,a=new MS(o);for(let l=i.curr;l!==null;l=i.next())Ar(a,t(l),0);AS(a);const c=_S(r);return la(o,c),o.toUint8Array()},XQ=n=>YQ(n,KJ,Yo,Zc),Xv="You must not compute changes after the event-handler fired.";class Oh{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=qQ(this.currentTarget,this.target))}deletes(t){return zk(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yr(Xv);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(r=>{if(r!==null){const i=e._map.get(r);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=af(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=af(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=af(i.content.getContent());else return;t.set(r,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yr(Xv);const e=this.target,s=Vr(),r=Vr(),i=[];if(t={added:s,deleted:r,delta:i,keys:this.keys},this.transaction.changed.get(e).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=e._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,r.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),s.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const qQ=(n,t)=>{const e=[];for(;t._item!==null&&t!==n;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let s=0,r=t._item.parent._start;for(;r!==t._item&&r!==null;)!r.deleted&&r.countable&&(s+=r.length),r=r.right;e.unshift(s)}t=t._item.parent}return e},nM=80;let jS=0;class ZQ{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=jS++}}const JQ=n=>{n.timestamp=jS++},sM=(n,t,e)=>{n.p.marker=!1,n.p=t,t.marker=!0,n.index=e,n.timestamp=jS++},QQ=(n,t,e)=>{if(n.length>=nM){const s=n.reduce((r,i)=>r.timestamp<i.timestamp?r:i);return sM(s,t,e),s}else{const s=new ZQ(t,e);return n.push(s),s}},Rh=(n,t)=>{if(n._start===null||t===0||n._searchMarker===null)return null;const e=n._searchMarker.length===0?null:n._searchMarker.reduce((i,o)=>Hd(t-i.index)<Hd(t-o.index)?i:o);let s=n._start,r=0;for(e!==null&&(s=e.p,r=e.index,JQ(e));s.right!==null&&r<t;){if(!s.deleted&&s.countable){if(t<r+s.length)break;r+=s.length}s=s.right}for(;s.left!==null&&r>t;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);return e!==null&&Hd(e.index-r)<s.parent.length/nM?(sM(e,s,r),e):QQ(n._searchMarker,s,r)},bc=(n,t,e)=>{for(let s=n.length-1;s>=0;s--){const r=n[s];if(e>0){let i=r.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(r.index-=i.length);if(i===null||i.marker===!0){n.splice(s,1);continue}r.p=i,i.marker=!0}(t<r.index||e>0&&t===r.index)&&(r.index=qi(t,r.index+e))}},Lh=(n,t,e)=>{const s=n,r=t.changedParentTypes;for(;zs(r,n,()=>[]).push(e),n._item!==null;)n=n._item.parent;qk(s._eH,e,t)};class $t{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Hv(),this._dEH=Hv(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw ks()}clone(){throw ks()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Kv(this._eH,t)}observeDeep(t){Kv(this._dEH,t)}unobserve(t){Gv(this._eH,t)}unobserveDeep(t){Gv(this._dEH,t)}toJSON(){}}const rM=(n,t,e)=>{t<0&&(t=n._length+t),e<0&&(e=n._length+e);let s=e-t;const r=[];let i=n._start;for(;i!==null&&s>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&s>0;a++)r.push(o[a]),s--;t=0}}i=i.right}return r},iM=n=>{const t=[];let e=n._start;for(;e!==null;){if(e.countable&&!e.deleted){const s=e.content.getContent();for(let r=0;r<s.length;r++)t.push(s[r])}e=e.right}return t},vc=(n,t)=>{let e=0,s=n._start;for(;s!==null;){if(s.countable&&!s.deleted){const r=s.content.getContent();for(let i=0;i<r.length;i++)t(r[i],e++,n)}s=s.right}},oM=(n,t)=>{const e=[];return vc(n,(s,r)=>{e.push(t(s,r,n))}),e},eee=n=>{let t=n._start,e=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),s=0,t=t.right}const r=e[s++];return e.length<=s&&(e=null),{done:!1,value:r}}}},aM=(n,t)=>{const e=Rh(n,t);let s=n._start;for(e!==null&&(s=e.p,t-=e.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},Ou=(n,t,e,s)=>{let r=e;const i=n.doc,o=i.clientID,a=i.store,c=e===null?t._start:e.right;let l=[];const d=()=>{l.length>0&&(r=new St(xe(o,Et(a,o)),r,r&&r.lastId,c,c&&c.id,t,null,new Ki(l)),r.integrate(n,0),l=[])};s.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(d(),h.constructor){case Uint8Array:case ArrayBuffer:r=new St(xe(o,Et(a,o)),r,r&&r.lastId,c,c&&c.id,t,null,new Jc(new Uint8Array(h))),r.integrate(n,0);break;case da:r=new St(xe(o,Et(a,o)),r,r&&r.lastId,c,c&&c.id,t,null,new Qc(h)),r.integrate(n,0);break;default:if(h instanceof $t)r=new St(xe(o,Et(a,o)),r,r&&r.lastId,c,c&&c.id,t,null,new wr(h)),r.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},cM=()=>Yr("Length exceeded!"),lM=(n,t,e,s)=>{if(e>t._length)throw cM();if(e===0)return t._searchMarker&&bc(t._searchMarker,e,s.length),Ou(n,t,null,s);const r=e,i=Rh(t,e);let o=t._start;for(i!==null&&(o=i.p,e-=i.index,e===0&&(o=o.prev,e+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(e<=o.length){e<o.length&&qr(n,xe(o.id.client,o.id.clock+e));break}e-=o.length}return t._searchMarker&&bc(t._searchMarker,r,s.length),Ou(n,t,o,s)},tee=(n,t,e)=>{let r=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(r)for(;r.right;)r=r.right;return Ou(n,t,r,e)},dM=(n,t,e,s)=>{if(s===0)return;const r=e,i=s,o=Rh(t,e);let a=t._start;for(o!==null&&(a=o.p,e-=o.index);a!==null&&e>0;a=a.right)!a.deleted&&a.countable&&(e<a.length&&qr(n,xe(a.id.client,a.id.clock+e)),e-=a.length);for(;s>0&&a!==null;)a.deleted||(s<a.length&&qr(n,xe(a.id.client,a.id.clock+s)),a.delete(n),s-=a.length),a=a.right;if(s>0)throw cM();t._searchMarker&&bc(t._searchMarker,r,-i+s)},Ru=(n,t,e)=>{const s=t._map.get(e);s!==void 0&&s.delete(n)},DS=(n,t,e,s)=>{const r=t._map.get(e)||null,i=n.doc,o=i.clientID;let a;if(s==null)a=new Ki([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ki([s]);break;case Uint8Array:a=new Jc(s);break;case da:a=new Qc(s);break;default:if(s instanceof $t)a=new wr(s);else throw new Error("Unexpected content type")}new St(xe(o,Et(i.store,o)),r,r&&r.lastId,null,null,t,e,a).integrate(n,0)},OS=(n,t)=>{const e=n._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},uM=n=>{const t={};return n._map.forEach((e,s)=>{e.deleted||(t[s]=e.content.getContent()[e.length-1])}),t},hM=(n,t)=>{const e=n._map.get(t);return e!==void 0&&!e.deleted},nee=(n,t)=>{const e={};return n._map.forEach((s,r)=>{let i=s;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&go(i,t)&&(e[r]=i.content.getContent()[i.length-1])}),e},Xl=n=>SQ(n.entries(),t=>!t[1].deleted);class see extends Oh{}class Oo extends $t{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Oo;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Oo}clone(){const t=new Oo;return t.insert(0,this.toArray().map(e=>e instanceof $t?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Lh(this,t,new see(this,t))}insert(t,e){this.doc!==null?ze(this.doc,s=>{lM(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?ze(this.doc,e=>{tee(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?ze(this.doc,s=>{dM(s,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return aM(this,t)}toArray(){return iM(this)}slice(t=0,e=this.length){return rM(this,t,e)}toJSON(){return this.map(t=>t instanceof $t?t.toJSON():t)}map(t){return oM(this,t)}forEach(t){vc(this,t)}[Symbol.iterator](){return eee(this)}_write(t){t.writeTypeRef(_ee)}}const ree=n=>new Oo;class iee extends Oh{constructor(t,e,s){super(t,e),this.keysChanged=s}}class Xo extends $t{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((s,r)=>{this.set(r,s)}),this._prelimContent=null}_copy(){return new Xo}clone(){const t=new Xo;return this.forEach((e,s)=>{t.set(s,e instanceof $t?e.clone():e)}),t}_callObserver(t,e){Lh(this,t,new iee(this,t,e))}toJSON(){const t={};return this._map.forEach((e,s)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[s]=r instanceof $t?r.toJSON():r}}),t}get size(){return[...Xl(this._map)].length}keys(){return hf(Xl(this._map),t=>t[0])}values(){return hf(Xl(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return hf(Xl(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,s)=>{e.deleted||t(e.content.getContent()[e.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ze(this.doc,e=>{Ru(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?ze(this.doc,s=>{DS(s,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return OS(this,t)}has(t){return hM(this,t)}clear(){this.doc!==null?ze(this.doc,t=>{this.forEach(function(e,s,r){Ru(t,r,s)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Tee)}}const oee=n=>new Xo,Rr=(n,t)=>n===t||typeof n=="object"&&typeof t=="object"&&n&&t&&HJ(n,t);class rm{constructor(t,e,s,r){this.left=t,this.right=e,this.index=s,this.currentAttributes=r}forward(){switch(this.right===null&&Rs(),this.right.content.constructor){case wt:this.right.deleted||ua(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const qv=(n,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case wt:t.right.deleted||ua(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&qr(n,xe(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},ql=(n,t,e,s)=>{const r=new Map,i=s?Rh(t,e):null;if(i){const o=new rm(i.p.left,i.p,i.index,r);return qv(n,o,e-i.index)}else{const o=new rm(null,t._start,0,r);return qv(n,o,e)}},pM=(n,t,e,s)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===wt&&Rr(s.get(e.right.content.key),e.right.content.value));)e.right.deleted||s.delete(e.right.content.key),e.forward();const r=n.doc,i=r.clientID;s.forEach((o,a)=>{const c=e.left,l=e.right,d=new St(xe(i,Et(r.store,i)),c,c&&c.lastId,l,l&&l.id,t,null,new wt(a,o));d.integrate(n,0),e.right=d,e.forward()})},ua=(n,t)=>{const{key:e,value:s}=t;s===null?n.delete(e):n.set(e,s)},fM=(n,t)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===wt&&Rr(t[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},gM=(n,t,e,s)=>{const r=n.doc,i=r.clientID,o=new Map;for(const a in s){const c=s[a],l=e.currentAttributes.get(a)??null;if(!Rr(l,c)){o.set(a,l);const{left:d,right:h}=e;e.right=new St(xe(i,Et(r.store,i)),d,d&&d.lastId,h,h&&h.id,t,null,new wt(a,c)),e.right.integrate(n,0),e.forward()}}return o},ff=(n,t,e,s,r)=>{e.currentAttributes.forEach((p,f)=>{r[f]===void 0&&(r[f]=null)});const i=n.doc,o=i.clientID;fM(e,r);const a=gM(n,t,e,r),c=s.constructor===String?new $s(s):s instanceof $t?new wr(s):new Zi(s);let{left:l,right:d,index:h}=e;t._searchMarker&&bc(t._searchMarker,e.index,c.getLength()),d=new St(xe(o,Et(i.store,o)),l,l&&l.lastId,d,d&&d.id,t,null,c),d.integrate(n,0),e.right=d,e.index=h,e.forward(),pM(n,t,e,a)},Zv=(n,t,e,s,r)=>{const i=n.doc,o=i.clientID;fM(e,r);const a=gM(n,t,e,r);e:for(;e.right!==null&&(s>0||a.size>0&&(e.right.deleted||e.right.content.constructor===wt));){if(!e.right.deleted)switch(e.right.content.constructor){case wt:{const{key:c,value:l}=e.right.content,d=r[c];if(d!==void 0){if(Rr(d,l))a.delete(c);else{if(s===0)break e;a.set(c,l)}e.right.delete(n)}else e.currentAttributes.set(c,l);break}default:s<e.right.length&&qr(n,xe(e.right.id.client,e.right.id.clock+s)),s-=e.right.length;break}e.forward()}if(s>0){let c="";for(;s>0;s--)c+=`
`;e.right=new St(xe(o,Et(i.store,o)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new $s(c)),e.right.integrate(n,0),e.forward()}pM(n,t,e,a)},mM=(n,t,e,s,r)=>{let i=t;const o=bn();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===wt){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;t!==i;){if(e===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case wt:{const{key:d,value:h}=l,p=s.get(d)??null;(o.get(d)!==l||p===h)&&(t.delete(n),a++,!c&&(r.get(d)??null)===h&&p!==h&&(p===null?r.delete(d):r.set(d,p))),!c&&!t.deleted&&ua(r,l);break}}}t=t.right}return a},aee=(n,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===wt){const s=t.content.key;e.has(s)?t.delete(n):e.add(s)}t=t.left}},cee=n=>{let t=0;return ze(n.doc,e=>{let s=n._start,r=n._start,i=bn();const o=qg(i);for(;r;){if(r.deleted===!1)switch(r.content.constructor){case wt:ua(o,r.content);break;default:t+=mM(e,s,r,i,o),i=qg(o),s=r;break}r=r.right}}),t},lee=n=>{const t=new Set,e=n.doc;for(const[s,r]of n.afterState.entries()){const i=n.beforeState.get(s)||0;r!==i&&Qk(n,e.store.clients.get(s),i,r,o=>{!o.deleted&&o.content.constructor===wt&&o.constructor!==Vn&&t.add(o.parent)})}ze(e,s=>{Bk(n,n.deleteSet,r=>{if(r instanceof Vn||!r.parent._hasFormatting||t.has(r.parent))return;const i=r.parent;r.content.constructor===wt?t.add(i):aee(s,r)});for(const r of t)cee(r)})},Jv=(n,t,e)=>{const s=e,r=qg(t.currentAttributes),i=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case wr:case Zi:case $s:e<t.right.length&&qr(n,xe(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(n);break}t.forward()}i&&mM(n,i,t.right,r,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&bc(o._searchMarker,t.index,-s+e),t};class dee extends Oh{constructor(t,e,s){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(r=>{r===null?this.childListChanged=!0:this.keysChanged.add(r)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];ze(t,s=>{const r=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",d=0,h=0;const p=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},r.size>0&&(f.attributes={},r.forEach((y,m)=>{y!==null&&(f.attributes[m]=y)}))),l="";break;case"retain":d>0&&(f={retain:d},zJ(c)||(f.attributes=FJ({},c))),d=0;break}f&&e.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case wr:case Zi:this.adds(o)?this.deletes(o)||(p(),a="insert",l=o.content.getContent()[0],p()):this.deletes(o)?(a!=="delete"&&(p(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(p(),a="retain"),d+=1);break;case $s:this.adds(o)?this.deletes(o)||(a!=="insert"&&(p(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(p(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(p(),a="retain"),d+=o.length);break;case wt:{const{key:f,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=r.get(f)??null;Rr(m,y)?y!==null&&o.delete(s):(a==="retain"&&p(),Rr(y,i.get(f)??null)?delete c[f]:c[f]=y)}}else if(this.deletes(o)){i.set(f,y);const m=r.get(f)??null;Rr(m,y)||(a==="retain"&&p(),c[f]=m)}else if(!o.deleted){i.set(f,y);const m=c[f];m!==void 0&&(Rr(m,y)?m!==null&&o.delete(s):(a==="retain"&&p(),y===null?delete c[f]:c[f]=y))}o.deleted||(a==="insert"&&p(),ua(r,o.content));break}}o=o.right}for(p();e.length>0;){const f=e[e.length-1];if(f.retain!==void 0&&f.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class qo extends $t{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new qo}clone(){const t=new qo;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const s=new dee(this,t,e);Lh(this,t,s),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===$s&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?ze(this.doc,s=>{const r=new rm(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const a=!e&&typeof o.insert=="string"&&i===t.length-1&&r.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ff(s,this,r,a,o.attributes||{})}else o.retain!==void 0?Zv(s,this,r,o.retain,o.attributes||{}):o.delete!==void 0&&Jv(s,r,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,s){const r=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let p=!1;i.forEach((y,m)=>{p=!0,h[m]=y});const f={insert:a};p&&(f.attributes=h),r.push(f),a=""}}const d=()=>{for(;c!==null;){if(go(c,t)||e!==void 0&&go(c,e))switch(c.content.constructor){case $s:{const h=i.get("ychange");t!==void 0&&!go(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",s?s("removed",c.id):{type:"removed"})):e!==void 0&&!go(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",s?s("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case wr:case Zi:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const p={};h.attributes=p,i.forEach((f,y)=>{p[y]=f})}r.push(h);break}case wt:go(c,t)&&(l(),ua(i,c.content));break}c=c.right}l()};return t||e?ze(o,h=>{t&&nm(h,t),e&&nm(h,e),d()},"cleanup"):d(),r}insert(t,e,s){if(e.length<=0)return;const r=this.doc;r!==null?ze(r,i=>{const o=ql(i,this,t,!s);s||(s={},o.currentAttributes.forEach((a,c)=>{s[c]=a})),ff(i,this,o,e,s)}):this._pending.push(()=>this.insert(t,e,s))}insertEmbed(t,e,s){const r=this.doc;r!==null?ze(r,i=>{const o=ql(i,this,t,!s);ff(i,this,o,e,s||{})}):this._pending.push(()=>this.insertEmbed(t,e,s||{}))}delete(t,e){if(e===0)return;const s=this.doc;s!==null?ze(s,r=>{Jv(r,ql(r,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,s){if(e===0)return;const r=this.doc;r!==null?ze(r,i=>{const o=ql(i,this,t,!1);o.right!==null&&Zv(i,this,o,e,s)}):this._pending.push(()=>this.format(t,e,s))}removeAttribute(t){this.doc!==null?ze(this.doc,e=>{Ru(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?ze(this.doc,s=>{DS(s,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return OS(this,t)}getAttributes(){return uM(this)}_write(t){t.writeTypeRef(kee)}}const uee=n=>new qo;class gf{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Zo||e.constructor===Hi)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Hi extends $t{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Hi}clone(){const t=new Hi;return t.insert(0,this.toArray().map(e=>e instanceof $t?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new gf(this,t)}querySelector(t){t=t.toUpperCase();const s=new gf(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t).next();return s.done?null:s.value}querySelectorAll(t){return t=t.toUpperCase(),lr(new gf(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Lh(this,t,new fee(this,e,t))}toString(){return oM(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},s){const r=t.createDocumentFragment();return s!==void 0&&s._createAssociation(r,this),vc(this,i=>{r.insertBefore(i.toDOM(t,e,s),null)}),r}insert(t,e){this.doc!==null?ze(this.doc,s=>{lM(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)ze(this.doc,s=>{const r=t&&t instanceof $t?t._item:t;Ou(s,this,r,e)});else{const s=this._prelimContent,r=t===null?0:s.findIndex(i=>i===t)+1;if(r===0&&t!==null)throw Yr("Reference item not found");s.splice(r,0,...e)}}delete(t,e=1){this.doc!==null?ze(this.doc,s=>{dM(s,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return iM(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return aM(this,t)}slice(t=0,e=this.length){return rM(this,t,e)}forEach(t){vc(this,t)}_write(t){t.writeTypeRef(Aee)}}const hee=n=>new Hi;class Zo extends Hi{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((s,r)=>{this.setAttribute(r,s)}),this._prelimAttrs=null}_copy(){return new Zo(this.nodeName)}clone(){const t=new Zo(this.nodeName),e=this.getAttributes();return NJ(e,(s,r)=>{typeof s=="string"&&t.setAttribute(r,s)}),t.insert(0,this.toArray().map(s=>s instanceof $t?s.clone():s)),t}toString(){const t=this.getAttributes(),e=[],s=[];for(const a in t)s.push(a);s.sort();const r=s.length;for(let a=0;a<r;a++){const c=s[a];e.push(c+'="'+t[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=e.length>0?" "+e.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?ze(this.doc,e=>{Ru(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?ze(this.doc,s=>{DS(s,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return OS(this,t)}hasAttribute(t){return hM(this,t)}getAttributes(t){return t?nee(this,t):uM(this)}toDOM(t=document,e={},s){const r=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&r.setAttribute(o,a)}return vc(this,o=>{r.appendChild(o.toDOM(t,e,s))}),s!==void 0&&s._createAssociation(r,this),r}_write(t){t.writeTypeRef(Mee),t.writeKey(this.nodeName)}}const pee=n=>new Zo(n.readKey());class fee extends Oh{constructor(t,e,s){super(t,s),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(r=>{r===null?this.childListChanged=!0:this.attributesChanged.add(r)})}}class Lu extends Xo{constructor(t){super(),this.hookName=t}_copy(){return new Lu(this.hookName)}clone(){const t=new Lu(this.hookName);return this.forEach((e,s)=>{t.set(s,e)}),t}toDOM(t=document,e={},s){const r=e[this.hookName];let i;return r!==void 0?i=r.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(i,this),i}_write(t){t.writeTypeRef(jee),t.writeKey(this.hookName)}}const gee=n=>new Lu(n.readKey());class $u extends qo{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new $u}clone(){const t=new $u;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,s){const r=t.createTextNode(this.toString());return s!==void 0&&s._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const e=[];for(const r in t.attributes){const i=[];for(const o in t.attributes[r])i.push({key:o,value:t.attributes[r][o]});i.sort((o,a)=>o.key<a.key?-1:1),e.push({nodeName:r,attrs:i})}e.sort((r,i)=>r.nodeName<i.nodeName?-1:1);let s="";for(let r=0;r<e.length;r++){const i=e[r];s+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];s+=` ${a.key}="${a.value}"`}s+=">"}s+=t.insert;for(let r=e.length-1;r>=0;r--)s+=`</${e[r].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Dee)}}const mee=n=>new $u;class RS{constructor(t,e){this.id=t,this.length=e}get deleted(){throw ks()}mergeWith(t){return!1}write(t,e,s){throw ks()}integrate(t,e){throw ks()}}const yee=0;class Vn extends RS{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Jk(t.doc.store,this)}write(t,e){t.writeInfo(yee),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Jc{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Jc(this.content)}splice(t){throw ks()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const See=n=>new Jc(n.readBuf());class Cc{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Cc(this.len)}splice(t){const e=new Cc(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){ju(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const wee=n=>new Cc(n.readLen()),yM=(n,t)=>new da({guid:n,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Qc{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Qc(yM(this.doc.guid,this.opts))}splice(t){throw ks()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const xee=n=>new Qc(yM(n.readString(),n.readAny()));class Zi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Zi(this.embed)}splice(t){throw ks()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const bee=n=>new Zi(n.readJSON());class wt{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new wt(this.key,this.value)}splice(t){throw ks()}mergeWith(t){return!1}integrate(t,e){const s=e.parent;s._searchMarker=null,s._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const vee=n=>new wt(n.readKey(),n.readJSON());class Fu{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Fu(this.arr)}splice(t){const e=new Fu(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let r=e;r<s;r++){const i=this.arr[r];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const Cee=n=>{const t=n.readLen(),e=[];for(let s=0;s<t;s++){const r=n.readString();r==="undefined"?e.push(void 0):e.push(JSON.parse(r))}return new Fu(e)};class Ki{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ki(this.arr)}splice(t){const e=new Ki(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let r=e;r<s;r++){const i=this.arr[r];t.writeAny(i)}}getRef(){return 8}}const Iee=n=>{const t=n.readLen(),e=[];for(let s=0;s<t;s++)e.push(n.readAny());return new Ki(e)};class $s{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new $s(this.str)}splice(t){const e=new $s(this.str.slice(t));this.str=this.str.slice(0,t);const s=this.str.charCodeAt(t-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",e.str="ï¿½"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Pee=n=>new $s(n.readString()),Eee=[ree,oee,uee,pee,hee,gee,mee],_ee=0,Tee=1,kee=2,Mee=3,Aee=4,jee=5,Dee=6;class wr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new wr(this.type._copy())}splice(t){throw ks()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(s=>{s.deleted?s.id.clock<(t.beforeState.get(s.id.client)||0)&&t._mergeStructs.push(s):s.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(t,!0),s=s.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Oee=n=>new wr(Eee[n.readTypeRef()](n)),Nu=(n,t,e)=>{const{client:s,clock:r}=t.id,i=new St(xe(s,r+e),t,xe(s,r+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=xe(t.redone.client,t.redone.clock+e)),t.right=i,i.right!==null&&(i.right.left=i),n._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=e,i};class St extends RS{constructor(t,e,s,r,i,o,a,c){super(t,c.getLength()),this.origin=s,this.left=e,this.right=r,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Mv:0}set marker(t){(this.info&lf)>0!==t&&(this.info^=lf)}get marker(){return(this.info&lf)>0}get keep(){return(this.info&kv)>0}set keep(t){this.keep!==t&&(this.info^=kv)}get countable(){return(this.info&Mv)>0}get deleted(){return(this.info&cf)>0}set deleted(t){this.deleted!==t&&(this.info^=cf)}markDeleted(){this.info|=cf}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Et(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Et(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Do&&this.id.client!==this.parent.client&&this.parent.clock>=Et(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Wv(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=qr(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vn||this.right&&this.right.constructor===Vn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===St&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===St&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Do){const s=pf(e,this.parent);s.constructor===Vn?this.parent=null:this.parent=s.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Wv(t,t.doc.store,xe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,r;if(s!==null)r=s.right;else if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start;const i=new Set,o=new Set;for(;r!==null&&r!==this.right;){if(o.add(r),i.add(r),Yl(this.origin,r.origin)){if(r.id.client<this.id.client)s=r,i.clear();else if(Yl(this.rightOrigin,r.rightOrigin))break}else if(r.origin!==null&&o.has(pf(t.doc.store,r.origin)))i.has(pf(t.doc.store,r.origin))||(s=r,i.clear());else break;r=r.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Jk(t.doc.store,this),this.content.integrate(t,this),Yv(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Vn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:xe(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Yl(t.origin,this.lastId)&&this.right===t&&Yl(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(s=>{s.p===t&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),ju(t.deleteSet,this.id.client,this.id.clock,this.length),Yv(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw Rs();this.content.gc(t),e?BQ(t,this,new Vn(this.id,this.length)):this.content=new Cc(this.length)}write(t,e){const s=e>0?xe(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Mh|(s===null?0:Rn)|(r===null?0:ir)|(i===null?0:yc);if(t.writeInfo(o),s!==null&&t.writeLeftID(s),r!==null&&t.writeRightID(r),s===null&&r===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=FQ(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Do?(t.writeParentInfo(!1),t.writeLeftID(a)):Rs();i!==null&&t.writeString(i)}this.content.write(t,e)}}const SM=(n,t)=>Ree[t&Mh](n),Ree=[()=>{Rs()},wee,Cee,See,Pee,bee,vee,Oee,Iee,xee,()=>{Rs()}],Lee=10;class Yn extends RS{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){Rs()}write(t,e){t.writeInfo(Lee),re(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const wM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},xM="__ $YJS$ __";wM[xM]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");wM[xM]=!0;class $ee extends mS{constructor(t){super(),this.yarray=t,this.doc=t.doc,this.map=new Map;{const e=t.toArray();this.doc.transact(()=>{for(let s=e.length-1;s>=0;s--){const r=e[s];this.map.has(r.key)?t.delete(s):this.map.set(r.key,r)}})}t.observe((e,s)=>{const r=new Map,i=Array.from(e.changes.added);e.changes.deleted.forEach(l=>{l.content.getContent().forEach(d=>{this.map.get(d.key)===d&&(this.map.delete(d.key),r.set(d.key,{action:"delete",oldValue:d.val}))})});const o=new Map;i.map(l=>l.content.getContent()).flat().forEach(l=>{o.set(l.key,l)});const a=new Set,c=t.toArray();this.doc.transact(l=>{for(let d=c.length-1;d>=0&&(o.size>0||a.size>0);d--){const h=c[d];if(a.has(h.key))a.delete(h.key),t.delete(d,1);else if(o.get(h.key)===h){const p=this.map.get(h.key);if(p)a.add(h.key),r.set(h.key,{action:"update",oldValue:p.val,newValue:h.val});else{const f=r.get(h.key);f&&f.action==="delete"?r.set(h.key,{action:"update",newValue:h.val,oldValue:f.oldValue}):r.set(h.key,{action:"add",newValue:h.val})}o.delete(h.key),this.map.set(h.key,h)}else o.has(h.key)&&(a.add(h.key),o.delete(h.key))}}),r.size>0&&this.emit("change",[r,s])})}set(t,e){this.doc.transact(s=>{this.map.has(t)&&this.delete(t),this.yarray.push([{key:t,val:e}])})}delete(t){let e=0;for(const s of this.yarray){if(s.key===t){this.yarray.delete(e);break}e++}}get(t){const e=this.map.get(t);return e&&e.val}has(t){return this.map.has(t)}}const bM=new Map;class Fee{constructor(t){this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&this.onmessage!==null&&this.onmessage({data:sQ(e.newValue||"")}),LJ(this._onChange)}postMessage(t){kk.setItem(this.room,nQ(ZJ(t)))}close(){$J(this._onChange)}}const Nee=typeof BroadcastChannel>"u"?Fee:BroadcastChannel,LS=n=>zs(bM,n,()=>{const t=Vr(),e=new Nee(n);return e.onmessage=s=>t.forEach(r=>r(s.data,"broadcastchannel")),{bc:e,subs:t}}),Bee=(n,t)=>(LS(n).subs.add(t),t),zee=(n,t)=>{const e=LS(n),s=e.subs.delete(t);return s&&e.subs.size===0&&(e.bc.close(),bM.delete(n)),s},mo=(n,t,e=null)=>{const s=LS(n);s.bc.postMessage(t),s.subs.forEach(r=>r(t,e))},vM=0,$S=1,CM=2,im=(n,t)=>{re(n,vM);const e=LQ(t);pt(n,e)},IM=(n,t,e)=>{re(n,$S),pt(n,jQ(t,e))},Uee=(n,t,e)=>IM(t,e,Kt(n)),PM=(n,t,e)=>{try{kQ(t,Kt(n),e)}catch(s){console.error("Caught error while handling a Yjs update",s)}},Hee=(n,t)=>{re(n,CM),pt(n,t)},Kee=PM,Gee=(n,t,e,s)=>{const r=de(n);switch(r){case vM:Uee(n,t,e);break;case $S:PM(n,e,s);break;case CM:Kee(n,e,s);break;default:throw new Error("Unknown message type")}return r},Wee=0,Vee=(n,t,e)=>{switch(de(n)){case Wee:e(t,zr(n))}},mf=3e4;class Yee extends mS{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=zi();this.getLocalState()!==null&&mf/2<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const s=[];this.meta.forEach((r,i)=>{i!==this.clientID&&mf<=e-r.lastUpdated&&this.states.has(i)&&s.push(i)}),s.length>0&&FS(this,s,"timeout")},dr(mf/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,s=this.meta.get(e),r=s===void 0?0:s.clock+1,i=this.states.get(e);t===null?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:r,lastUpdated:zi()});const o=[],a=[],c=[],l=[];t===null?l.push(e):i==null?t!=null&&o.push(e):(a.push(e),Za(i,t)||c.push(e)),(o.length>0||c.length>0||l.length>0)&&this.emit("change",[{added:o,updated:c,removed:l},"local"]),this.emit("update",[{added:o,updated:a,removed:l},"local"])}setLocalStateField(t,e){const s=this.getLocalState();s!==null&&this.setLocalState({...s,[t]:e})}getStates(){return this.states}}const FS=(n,t,e)=>{const s=[];for(let r=0;r<t.length;r++){const i=t[r];if(n.states.has(i)){if(n.states.delete(i),i===n.clientID){const o=n.meta.get(i);n.meta.set(i,{clock:o.clock+1,lastUpdated:zi()})}s.push(i)}}s.length>0&&(n.emit("change",[{added:[],updated:[],removed:s},e]),n.emit("update",[{added:[],updated:[],removed:s},e]))},Ja=(n,t,e=n.states)=>{const s=t.length,r=Vt();re(r,s);for(let i=0;i<s;i++){const o=t[i],a=e.get(o)||null,c=n.meta.get(o).clock;re(r,o),re(r,c),_i(r,JSON.stringify(a))}return it(r)},Xee=(n,t,e)=>{const s=ci(t),r=zi(),i=[],o=[],a=[],c=[],l=de(s);for(let d=0;d<l;d++){const h=de(s);let p=de(s);const f=JSON.parse(zr(s)),y=n.meta.get(h),m=n.states.get(h),x=y===void 0?0:y.clock;(x<p||x===p&&f===null&&n.states.has(h))&&(f===null?h===n.clientID&&n.getLocalState()!=null?p++:n.states.delete(h):n.states.set(h,f),n.meta.set(h,{clock:p,lastUpdated:r}),y===void 0&&f!==null?i.push(h):y!==void 0&&f===null?c.push(h):f!==null&&(Za(f,m)||a.push(h),o.push(h)))}(i.length>0||a.length>0||c.length>0)&&n.emit("change",[{added:i,updated:a,removed:c},e]),(i.length>0||o.length>0||c.length>0)&&n.emit("update",[{added:i,updated:o,removed:c},e])},qee=n=>BJ(n,(t,e)=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&"),bi=0,EM=3,Ro=1,Zee=2,el=[];el[bi]=(n,t,e,s,r)=>{re(n,bi);const i=Gee(t,n,e.doc,e);s&&i===$S&&!e.synced&&(e.synced=!0)};el[EM]=(n,t,e,s,r)=>{re(n,Ro),pt(n,Ja(e.awareness,Array.from(e.awareness.getStates().keys())))};el[Ro]=(n,t,e,s,r)=>{Xee(e.awareness,Kt(t),e)};el[Zee]=(n,t,e,s,r)=>{Vee(t,e.doc,(i,o)=>Jee(e,o))};const Qv=3e4,Jee=(n,t)=>console.warn(`Permission denied to access ${n.url}.
${t}`),_M=(n,t,e)=>{const s=ci(t),r=Vt(),i=de(s),o=n.messageHandlers[i];return o?o(r,s,n,e,i):console.error("Unable to compute message"),r},TM=n=>{if(n.shouldConnect&&n.ws===null){const t=new n._WS(n.url);t.binaryType="arraybuffer",n.ws=t,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,t.onmessage=e=>{n.wsLastMessageReceived=zi();const s=_M(n,new Uint8Array(e.data),!0);SS(s)>1&&t.send(it(s))},t.onerror=e=>{n.emit("connection-error",[e,n])},t.onclose=e=>{n.emit("connection-close",[e,n]),n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,FS(n.awareness,Array.from(n.awareness.getStates().keys()).filter(s=>s!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(TM,yS(sJ(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n)},t.onopen=()=>{n.wsLastMessageReceived=zi(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);const e=Vt();if(re(e,bi),im(e,n.doc),t.send(it(e)),n.awareness.getLocalState()!==null){const s=Vt();re(s,Ro),pt(s,Ja(n.awareness,[n.doc.clientID])),t.send(it(s))}},n.emit("status",[{status:"connecting"}])}},yf=(n,t)=>{const e=n.ws;n.wsconnected&&e&&e.readyState===e.OPEN&&e.send(t),n.bcconnected&&mo(n.bcChannel,t,n)};class Qee extends mS{constructor(t,e,s,{connect:r=!0,awareness:i=new Yee(s),params:o={},WebSocketPolyfill:a=WebSocket,resyncInterval:c=-1,maxBackoffTime:l=2500,disableBc:d=!1}={}){for(super();t[t.length-1]==="/";)t=t.slice(0,t.length-1);this.serverUrl=t,this.bcChannel=t+"/"+e,this.maxBackoffTime=l,this.params=o,this.roomname=e,this.doc=s,this._WS=a,this.awareness=i,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=d,this.wsUnsuccessfulReconnects=0,this.messageHandlers=el.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const h=Vt();re(h,bi),im(h,s),this.ws.send(it(h))}},c)),this._bcSubscriber=(h,p)=>{if(p!==this){const f=_M(this,new Uint8Array(h),!1);SS(f)>1&&mo(this.bcChannel,it(f),this)}},this._updateHandler=(h,p)=>{if(p!==this){const f=Vt();re(f,bi),Hee(f,h),yf(this,it(f))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:h,updated:p,removed:f},y)=>{const m=h.concat(p).concat(f),x=Vt();re(x,Ro),pt(x,Ja(i,m)),yf(this,it(x))},this._exitHandler=()=>{FS(this.awareness,[s.clientID],"app closed")},Xr&&typeof process<"u"&&process.on("exit",this._exitHandler),i.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&Qv<zi()-this.wsLastMessageReceived&&this.ws.close()},Qv/10),r&&this.connect()}get url(){const t=qee(this.params);return this.serverUrl+"/"+this.roomname+(t.length===0?"":"?"+t)}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Xr&&typeof process<"u"&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(Bee(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const t=Vt();re(t,bi),im(t,this.doc),mo(this.bcChannel,it(t),this);const e=Vt();re(e,bi),IM(e,this.doc),mo(this.bcChannel,it(e),this);const s=Vt();re(s,EM),mo(this.bcChannel,it(s),this);const r=Vt();re(r,Ro),pt(r,Ja(this.awareness,[this.doc.clientID])),mo(this.bcChannel,it(r),this)}disconnectBc(){const t=Vt();re(t,Ro),pt(t,Ja(this.awareness,[this.doc.clientID],new Map)),yf(this,it(t)),this.bcconnected&&(zee(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(TM(this),this.connectBc())}}function ete({roomId:n="example",hostUrl:t="ws://localhost:1234",shapeUtils:e=[]}){const s=()=>{const h=r.schema.serialize(),p=r.allRecords();a.transact(()=>{p.forEach(f=>c.set(f.id,f)),l.set("schema",h)}),r.loadSnapshot({store:Object.fromEntries(p.map(f=>[f.id,f])),schema:h})},[r]=v.useState(()=>yP({shapeUtils:[...Iy,...e]})),[i,o]=v.useState({status:"loading"}),{yDoc:a,yStore:c,meta:l,room:d}=v.useMemo(()=>{const h=new da({gc:!0}),p=h.getArray(`tl_${n}`),f=new $ee(p),y=h.getMap("meta");return{yDoc:h,yStore:f,meta:y,room:new Qee(t,n,h,{connect:!0})}},[t,n]);return v.useEffect(()=>{const h=[];o({status:"loading"});function p(){const I=(C,_)=>{if(_.local)return;const k=[],D=[];C.forEach((T,A)=>{switch(T.action){case"add":case"update":{const L=c.get(A);D.push(L);break}case"delete":{k.push(A);break}}}),r.mergeRemoteChanges(()=>{k.length&&r.remove(k),D.length&&r.put(D)})};c.on("change",I),h.push(()=>c.off("change",I));const E=C=>{const _=d.awareness.getStates(),k=[],D=[];for(const T of C.added){const A=_.get(T);A!=null&&A.presence&&A.presence.id!==w&&D.push(A.presence)}for(const T of C.updated){const A=_.get(T);A!=null&&A.presence&&A.presence.id!==w&&D.push(A.presence)}for(const T of C.removed)k.push(ic.createId(T.toString()));r.mergeRemoteChanges(()=>{k.length&&r.remove(k),D.length&&r.put(D)})},P=()=>{const C=l.get("schema");if(!C)throw new Error("No schema found in the yjs doc");const _=r.schema.getMigrationsSince(C);(!_.ok||_.value.length>0)&&(window.alert("The schema has been updated. Please refresh the page."),a.destroy())};if(l.observe(P),h.push(()=>l.unobserve(P)),d.awareness.on("update",E),h.push(()=>d.awareness.off("update",E)),c.yarray.length){const C=r.schema.serialize(),_=l.get("schema");_||s();const k=c.yarray.toJSON().map(({val:T})=>T),D=r.schema.migrateStoreSnapshot({schema:_,store:Object.fromEntries(k.map(T=>[T.id,T]))});if(D.type==="error"){console.error(D.reason),window.alert("The schema has been updated. Please refresh the page.");return}a.transact(()=>{for(const T of k)D.value[T.id]||c.delete(T.id);for(const T of Object.values(D.value))c.set(T.id,T);l.set("schema",C)}),r.loadSnapshot({store:D.value,schema:C})}else a.transact(()=>{for(const C of r.allRecords())c.set(C.id,C);l.set("schema",r.schema.serialize())});o({store:r,status:"synced-remote",connectionStatus:"online"})}let f=!1;function y({status:I}){if(I==="disconnected"){o({store:r,status:"synced-remote",connectionStatus:"offline"});return}if(d.off("synced",p),I==="connected"){if(f)return;f=!0,d.on("synced",p),h.push(()=>d.off("synced",p))}}d.on("status",y);const m=K("userPreferences",()=>{const I=ny();return{id:I.id,color:I.color??xs.color,name:I.name??xs.name}}),x=d.awareness.clientID.toString();YI({id:x});const w=ic.createId(x),b=QB(m,w)(r);return d.awareness.setLocalStateField("presence",b.get()),h.push(r.listen(async function({changes:E}){a.transact(()=>{Object.values(E.added).forEach(P=>{c.set(P.id,P)}),Object.values(E.updated).forEach(([P,C])=>{c.set(C.id,C)}),Object.values(E.removed).forEach(P=>{c.delete(P.id)})})},{source:"user",scope:"document"})),h.push(()=>d.off("status",y)),h.push(ei("when presence changes",()=>{const I=b.get();requestAnimationFrame(()=>{d.awareness.setLocalStateField("presence",I)})})),()=>{h.forEach(I=>I()),h.length=0}},[d,a,r,c,l]),i}function Rte(){oj("/normalize.css");const n="ws://148.135.43.239:1235",{roomId:t}=XA(),[e,s]=v.useState(!1),r=t0(),i=ete({roomId:t,hostUrl:n});return v.useEffect(()=>{(async()=>{try{await YA(t),s(!0)}catch{setTimeout(()=>{r("/")},2e3)}})()},[t]),e?u.jsxs("div",{className:"tldraw__editor",children:[u.jsx(ZZ,{}),u.jsx(rZ,{autoFocus:!0,store:i,components:{SharePanel:tte}})]}):u.jsx("div",{children:"Loading..."})}const tte=Cn(()=>{const n=N(),t=t0(),e=()=>{t("/")},{color:s,name:r}=n.user.getUserPreferences();return u.jsxs("div",{style:{pointerEvents:"all",display:"flex"},children:[u.jsx(rj,{className:"ml5 mr10",onClick:e,children:"< GoBack"}),u.jsx("input",{type:"color",value:s,onChange:i=>{n.user.updateUserPreferences({color:i.currentTarget.value})}}),u.jsx("input",{value:r,onChange:i=>{n.user.updateUserPreferences({name:i.currentTarget.value})}})]})});export{Rte as default};
