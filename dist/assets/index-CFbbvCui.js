var e,t,n,i,s,r,o,a,l,c,d,h,u,p,g,f,m,y,x,w,v=Object.defineProperty,b=(e,t,n)=>((e,t,n)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);import{h as S,j as k,r as C,O as _,R as P,c as I,P as j,k as E,Q as T,S as M,T as A,i as O,U as D,A as R,H as L,G as z}from"./index-U-YGodSS.js";import{c as F,o as N,s as $,l as B,f as U,j as K,h as H,b as V,a as W,k as Y,u as G}from"./tldraw-BwuRRtrM.js";import{p as X}from"./index-CXcJ1hwD.js";var q="undefined"!=typeof Element,Z="function"==typeof Map,J="function"==typeof Set,Q="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function ee(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,i,s,r;if(Array.isArray(e)){if((n=e.length)!=t.length)return!1;for(i=n;0!=i--;)if(!ee(e[i],t[i]))return!1;return!0}if(Z&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;for(r=e.entries();!(i=r.next()).done;)if(!ee(i.value[1],t.get(i.value[0])))return!1;return!0}if(J&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;return!0}if(Q&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if((n=e.length)!=t.length)return!1;for(i=n;0!=i--;)if(e[i]!==t[i])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"==typeof e.valueOf&&"function"==typeof t.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&"function"==typeof e.toString&&"function"==typeof t.toString)return e.toString()===t.toString();if((n=(s=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(t,s[i]))return!1;if(q&&e instanceof Element)return!1;for(i=n;0!=i--;)if(("_owner"!==s[i]&&"__v"!==s[i]&&"__o"!==s[i]||!e.$$typeof)&&!ee(e[s[i]],t[s[i]]))return!1;return!0}return e!=e&&t!=t}const te=S((function(e,t){try{return ee(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}})),ne="_custom_btn_1z1rr_3",ie="_btn_15_1z1rr_21",se=({className:e,children:t,onClick:n})=>k.jsx("button",{className:`${ne} ${ie} ${e}`,onClick:n,children:t}),re=(e,t)=>{C.useEffect((()=>{const t=document.querySelector(`link[href="${e}"]`);return t&&t.parentNode.removeChild(t),()=>{if(t){const e=document.createElement("link");e.rel="stylesheet",e.href="/normalize.css",document.head.appendChild(e)}}}),[])};var oe=function(e){return e&&e.Math===Math&&e},ae=oe("object"==typeof globalThis&&globalThis)||oe("object"==typeof window&&window)||oe("object"==typeof self&&self)||oe("object"==typeof _&&_)||oe("object"==typeof _&&_)||function(){return this}()||Function("return this")(),le={},ce=function(e){try{return!!e()}catch(t){return!0}},de=!ce((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),he=!ce((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),ue=he,pe=Function.prototype.call,ge=ue?pe.bind(pe):function(){return pe.apply(pe,arguments)},fe={},me={}.propertyIsEnumerable,ye=Object.getOwnPropertyDescriptor,xe=ye&&!me.call({1:2},1);fe.f=xe?function(e){var t=ye(this,e);return!!t&&t.enumerable}:me;var we,ve,be=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Se=he,ke=Function.prototype,Ce=ke.call,_e=Se&&ke.bind.bind(Ce,Ce),Pe=Se?_e:function(e){return function(){return Ce.apply(e,arguments)}},Ie=Pe,je=Ie({}.toString),Ee=Ie("".slice),Te=function(e){return Ee(je(e),8,-1)},Me=ce,Ae=Te,Oe=Object,De=Pe("".split),Re=Me((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(e){return"String"===Ae(e)?De(e,""):Oe(e)}:Oe,Le=function(e){return null==e},ze=Le,Fe=TypeError,Ne=function(e){if(ze(e))throw new Fe("Can't call method on "+e);return e},$e=Re,Be=Ne,Ue=function(e){return $e(Be(e))},Ke="object"==typeof document&&document.all,He=void 0===Ke&&void 0!==Ke?function(e){return"function"==typeof e||e===Ke}:function(e){return"function"==typeof e},Ve=He,We=function(e){return"object"==typeof e?null!==e:Ve(e)},Ye=ae,Ge=He,Xe=function(e,t){return arguments.length<2?(n=Ye[e],Ge(n)?n:void 0):Ye[e]&&Ye[e][t];var n},qe=Pe({}.isPrototypeOf),Ze=ae,Je="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Qe=Ze.process,et=Ze.Deno,tt=Qe&&Qe.versions||et&&et.version,nt=tt&&tt.v8;nt&&(ve=(we=nt.split("."))[0]>0&&we[0]<4?1:+(we[0]+we[1])),!ve&&Je&&(!(we=Je.match(/Edge\/(\d+)/))||we[1]>=74)&&(we=Je.match(/Chrome\/(\d+)/))&&(ve=+we[1]);var it=ve,st=ce,rt=ae.String,ot=!!Object.getOwnPropertySymbols&&!st((function(){var e=Symbol("symbol detection");return!rt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&it&&it<41})),at=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,lt=Xe,ct=He,dt=qe,ht=Object,ut=at?function(e){return"symbol"==typeof e}:function(e){var t=lt("Symbol");return ct(t)&&dt(t.prototype,ht(e))},pt=String,gt=He,ft=function(e){try{return pt(e)}catch(t){return"Object"}},mt=TypeError,yt=function(e){if(gt(e))return e;throw new mt(ft(e)+" is not a function")},xt=yt,wt=Le,vt=function(e,t){var n=e[t];return wt(n)?void 0:xt(n)},bt=ge,St=He,kt=We,Ct=TypeError,_t={exports:{}},Pt=ae,It=Object.defineProperty,jt=function(e,t){try{It(Pt,e,{value:t,configurable:!0,writable:!0})}catch(n){Pt[e]=t}return t},Et=ae,Tt=jt,Mt="__core-js_shared__",At=_t.exports=Et[Mt]||Tt(Mt,{});(At.versions||(At.versions=[])).push({version:"3.37.1",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ot=_t.exports,Dt=Ot,Rt=function(e,t){return Dt[e]||(Dt[e]=t||{})},Lt=Ne,zt=Object,Ft=function(e){return zt(Lt(e))},Nt=Ft,$t=Pe({}.hasOwnProperty),Bt=Object.hasOwn||function(e,t){return $t(Nt(e),t)},Ut=Pe,Kt=0,Ht=Math.random(),Vt=Ut(1..toString),Wt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Vt(++Kt+Ht,36)},Yt=Rt,Gt=Bt,Xt=Wt,qt=ot,Zt=at,Jt=ae.Symbol,Qt=Yt("wks"),en=Zt?Jt.for||Jt:Jt&&Jt.withoutSetter||Xt,tn=function(e){return Gt(Qt,e)||(Qt[e]=qt&&Gt(Jt,e)?Jt[e]:en("Symbol."+e)),Qt[e]},nn=ge,sn=We,rn=ut,on=vt,an=function(e,t){var n,i;if("string"===t&&St(n=e.toString)&&!kt(i=bt(n,e)))return i;if(St(n=e.valueOf)&&!kt(i=bt(n,e)))return i;if("string"!==t&&St(n=e.toString)&&!kt(i=bt(n,e)))return i;throw new Ct("Can't convert object to primitive value")},ln=TypeError,cn=tn("toPrimitive"),dn=function(e,t){if(!sn(e)||rn(e))return e;var n,i=on(e,cn);if(i){if(void 0===t&&(t="default"),n=nn(i,e,t),!sn(n)||rn(n))return n;throw new ln("Can't convert object to primitive value")}return void 0===t&&(t="number"),an(e,t)},hn=ut,un=function(e){var t=dn(e,"string");return hn(t)?t:t+""},pn=We,gn=ae.document,fn=pn(gn)&&pn(gn.createElement),mn=function(e){return fn?gn.createElement(e):{}},yn=mn,xn=!de&&!ce((function(){return 7!==Object.defineProperty(yn("div"),"a",{get:function(){return 7}}).a})),wn=de,vn=ge,bn=fe,Sn=be,kn=Ue,Cn=un,_n=Bt,Pn=xn,In=Object.getOwnPropertyDescriptor;le.f=wn?In:function(e,t){if(e=kn(e),t=Cn(t),Pn)try{return In(e,t)}catch(n){}if(_n(e,t))return Sn(!vn(bn.f,e,t),e[t])};var jn={},En=de&&ce((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Tn=We,Mn=String,An=TypeError,On=function(e){if(Tn(e))return e;throw new An(Mn(e)+" is not an object")},Dn=de,Rn=xn,Ln=En,zn=On,Fn=un,Nn=TypeError,$n=Object.defineProperty,Bn=Object.getOwnPropertyDescriptor,Un="enumerable",Kn="configurable",Hn="writable";jn.f=Dn?Ln?function(e,t,n){if(zn(e),t=Fn(t),zn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Hn in n&&!n[Hn]){var i=Bn(e,t);i&&i[Hn]&&(e[t]=n.value,n={configurable:Kn in n?n[Kn]:i[Kn],enumerable:Un in n?n[Un]:i[Un],writable:!1})}return $n(e,t,n)}:$n:function(e,t,n){if(zn(e),t=Fn(t),zn(n),Rn)try{return $n(e,t,n)}catch(i){}if("get"in n||"set"in n)throw new Nn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Vn=jn,Wn=be,Yn=de?function(e,t,n){return Vn.f(e,t,Wn(1,n))}:function(e,t,n){return e[t]=n,e},Gn={exports:{}},Xn=de,qn=Bt,Zn=Function.prototype,Jn=Xn&&Object.getOwnPropertyDescriptor,Qn=qn(Zn,"name"),ei={EXISTS:Qn,PROPER:Qn&&"something"===function(){}.name,CONFIGURABLE:Qn&&(!Xn||Xn&&Jn(Zn,"name").configurable)},ti=He,ni=Ot,ii=Pe(Function.toString);ti(ni.inspectSource)||(ni.inspectSource=function(e){return ii(e)});var si,ri,oi,ai=ni.inspectSource,li=He,ci=ae.WeakMap,di=li(ci)&&/native code/.test(String(ci)),hi=Wt,ui=Rt("keys"),pi=function(e){return ui[e]||(ui[e]=hi(e))},gi={},fi=di,mi=ae,yi=We,xi=Yn,wi=Bt,vi=Ot,bi=pi,Si=gi,ki="Object already initialized",Ci=mi.TypeError,_i=mi.WeakMap;if(fi||vi.state){var Pi=vi.state||(vi.state=new _i);Pi.get=Pi.get,Pi.has=Pi.has,Pi.set=Pi.set,si=function(e,t){if(Pi.has(e))throw new Ci(ki);return t.facade=e,Pi.set(e,t),t},ri=function(e){return Pi.get(e)||{}},oi=function(e){return Pi.has(e)}}else{var Ii=bi("state");Si[Ii]=!0,si=function(e,t){if(wi(e,Ii))throw new Ci(ki);return t.facade=e,xi(e,Ii,t),t},ri=function(e){return wi(e,Ii)?e[Ii]:{}},oi=function(e){return wi(e,Ii)}}var ji={set:si,get:ri,has:oi,enforce:function(e){return oi(e)?ri(e):si(e,{})},getterFor:function(e){return function(t){var n;if(!yi(t)||(n=ri(t)).type!==e)throw new Ci("Incompatible receiver, "+e+" required");return n}}},Ei=Pe,Ti=ce,Mi=He,Ai=Bt,Oi=de,Di=ei.CONFIGURABLE,Ri=ai,Li=ji.enforce,zi=ji.get,Fi=String,Ni=Object.defineProperty,$i=Ei("".slice),Bi=Ei("".replace),Ui=Ei([].join),Ki=Oi&&!Ti((function(){return 8!==Ni((function(){}),"length",{value:8}).length})),Hi=String(String).split("String"),Vi=Gn.exports=function(e,t,n){"Symbol("===$i(Fi(t),0,7)&&(t="["+Bi(Fi(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Ai(e,"name")||Di&&e.name!==t)&&(Oi?Ni(e,"name",{value:t,configurable:!0}):e.name=t),Ki&&n&&Ai(n,"arity")&&e.length!==n.arity&&Ni(e,"length",{value:n.arity});try{n&&Ai(n,"constructor")&&n.constructor?Oi&&Ni(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(s){}var i=Li(e);return Ai(i,"source")||(i.source=Ui(Hi,"string"==typeof t?t:"")),e};Function.prototype.toString=Vi((function(){return Mi(this)&&zi(this).source||Ri(this)}),"toString");var Wi=Gn.exports,Yi=He,Gi=jn,Xi=Wi,qi=jt,Zi=function(e,t,n,i){i||(i={});var s=i.enumerable,r=void 0!==i.name?i.name:t;if(Yi(n)&&Xi(n,r,i),i.global)s?e[t]=n:qi(t,n);else{try{i.unsafe?e[t]&&(s=!0):delete e[t]}catch(o){}s?e[t]=n:Gi.f(e,t,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e},Ji={},Qi=Math.ceil,es=Math.floor,ts=Math.trunc||function(e){var t=+e;return(t>0?es:Qi)(t)},ns=function(e){var t=+e;return t!=t||0===t?0:ts(t)},is=ns,ss=Math.max,rs=Math.min,os=ns,as=Math.min,ls=function(e){var t=os(e);return t>0?as(t,9007199254740991):0},cs=ls,ds=function(e){return cs(e.length)},hs=Ue,us=function(e,t){var n=is(e);return n<0?ss(n+t,0):rs(n,t)},ps=ds,gs=function(e){return function(t,n,i){var s=hs(t),r=ps(s);if(0===r)return!e&&-1;var o,a=us(i,r);if(e&&n!=n){for(;r>a;)if((o=s[a++])!=o)return!0}else for(;r>a;a++)if((e||a in s)&&s[a]===n)return e||a||0;return!e&&-1}},fs={includes:gs(!0),indexOf:gs(!1)},ms=Bt,ys=Ue,xs=fs.indexOf,ws=gi,vs=Pe([].push),bs=function(e,t){var n,i=ys(e),s=0,r=[];for(n in i)!ms(ws,n)&&ms(i,n)&&vs(r,n);for(;t.length>s;)ms(i,n=t[s++])&&(~xs(r,n)||vs(r,n));return r},Ss=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ks=bs,Cs=Ss.concat("length","prototype");Ji.f=Object.getOwnPropertyNames||function(e){return ks(e,Cs)};var _s={};_s.f=Object.getOwnPropertySymbols;var Ps=Xe,Is=Ji,js=_s,Es=On,Ts=Pe([].concat),Ms=Ps("Reflect","ownKeys")||function(e){var t=Is.f(Es(e)),n=js.f;return n?Ts(t,n(e)):t},As=Bt,Os=Ms,Ds=le,Rs=jn,Ls=ce,zs=He,Fs=/#|\.prototype\./,Ns=function(e,t){var n=Bs[$s(e)];return n===Ks||n!==Us&&(zs(t)?Ls(t):!!t)},$s=Ns.normalize=function(e){return String(e).replace(Fs,".").toLowerCase()},Bs=Ns.data={},Us=Ns.NATIVE="N",Ks=Ns.POLYFILL="P",Hs=Ns,Vs=ae,Ws=le.f,Ys=Yn,Gs=Zi,Xs=jt,qs=function(e,t,n){for(var i=Os(t),s=Rs.f,r=Ds.f,o=0;o<i.length;o++){var a=i[o];As(e,a)||n&&As(n,a)||s(e,a,r(t,a))}},Zs=Hs,Js=function(e,t){var n,i,s,r,o,a=e.target,l=e.global,c=e.stat;if(n=l?Vs:c?Vs[a]||Xs(a,{}):Vs[a]&&Vs[a].prototype)for(i in t){if(r=t[i],s=e.dontCallGetSet?(o=Ws(n,i))&&o.value:n[i],!Zs(l?i:a+(c?".":"#")+i,e.forced)&&void 0!==s){if(typeof r==typeof s)continue;qs(r,s)}(e.sham||s&&s.sham)&&Ys(r,"sham",!0),Gs(n,i,r,e)}},Qs={},er=bs,tr=Ss,nr=Object.keys||function(e){return er(e,tr)},ir=de,sr=En,rr=jn,or=On,ar=Ue,lr=nr;Qs.f=ir&&!sr?Object.defineProperties:function(e,t){or(e);for(var n,i=ar(t),s=lr(t),r=s.length,o=0;r>o;)rr.f(e,n=s[o++],i[n]);return e};var cr,dr=Xe("document","documentElement"),hr=On,ur=Qs,pr=Ss,gr=gi,fr=dr,mr=mn,yr="prototype",xr="script",wr=pi("IE_PROTO"),vr=function(){},br=function(e){return"<"+xr+">"+e+"</"+xr+">"},Sr=function(e){e.write(br("")),e.close();var t=e.parentWindow.Object;return e=null,t},kr=function(){try{cr=new ActiveXObject("htmlfile")}catch(s){}var e,t,n;kr="undefined"!=typeof document?document.domain&&cr?Sr(cr):(t=mr("iframe"),n="java"+xr+":",t.style.display="none",fr.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(br("document.F=Object")),e.close(),e.F):Sr(cr);for(var i=pr.length;i--;)delete kr[yr][pr[i]];return kr()};gr[wr]=!0;var Cr=Object.create||function(e,t){var n;return null!==e?(vr[yr]=hr(e),n=new vr,vr[yr]=null,n[wr]=e):n=kr(),void 0===t?n:ur.f(n,t)},_r=tn,Pr=Cr,Ir=jn.f,jr=_r("unscopables"),Er=Array.prototype;void 0===Er[jr]&&Ir(Er,jr,{configurable:!0,value:Pr(null)});var Tr=function(e){Er[jr][e]=!0},Mr=Ft,Ar=ds,Or=ns,Dr=Tr;Js({target:"Array",proto:!0},{at:function(e){var t=Mr(this),n=Ar(t),i=Or(e),s=i>=0?i:n+i;return s<0||s>=n?void 0:t[s]}}),Dr("at");var Rr=ae,Lr=Pe,zr=function(e,t){return Lr(Rr[e].prototype[t])};zr("Array","at");var Fr=Te,Nr=Array.isArray||function(e){return"Array"===Fr(e)},$r=TypeError,Br=Te,Ur=Pe,Kr=function(e){if("Function"===Br(e))return Ur(e)},Hr=yt,Vr=he,Wr=Kr(Kr.bind),Yr=Nr,Gr=ds,Xr=function(e){if(e>9007199254740991)throw $r("Maximum allowed index exceeded");return e},qr=function(e,t){return Hr(e),void 0===t?e:Vr?Wr(e,t):function(){return e.apply(t,arguments)}},Zr=function(e,t,n,i,s,r,o,a){for(var l,c,d=s,h=0,u=!!o&&qr(o,a);h<i;)h in n&&(l=u?u(n[h],h,t):n[h],r>0&&Yr(l)?(c=Gr(l),d=Zr(e,t,l,c,d,r-1)-1):(Xr(d+1),e[d]=l),d++),h++;return d},Jr=Zr,Qr={};Qr[tn("toStringTag")]="z";var eo="[object z]"===String(Qr),to=He,no=Te,io=tn("toStringTag"),so=Object,ro="Arguments"===no(function(){return arguments}()),oo=eo?no:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=so(e),io))?n:ro?no(t):"Object"===(i=no(t))&&to(t.callee)?"Arguments":i},ao=Pe,lo=ce,co=He,ho=oo,uo=ai,po=function(){},go=Xe("Reflect","construct"),fo=/^\s*(?:class|function)\b/,mo=ao(fo.exec),yo=!fo.test(po),xo=function(e){if(!co(e))return!1;try{return go(po,[],e),!0}catch(t){return!1}},wo=function(e){if(!co(e))return!1;switch(ho(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return yo||!!mo(fo,uo(e))}catch(t){return!0}};wo.sham=!0;var vo=!go||lo((function(){var e;return xo(xo.call)||!xo(Object)||!xo((function(){e=!0}))||e}))?wo:xo,bo=Nr,So=vo,ko=We,Co=tn("species"),_o=Array,Po=function(e){var t;return bo(e)&&(t=e.constructor,(So(t)&&(t===_o||bo(t.prototype))||ko(t)&&null===(t=t[Co]))&&(t=void 0)),void 0===t?_o:t},Io=function(e,t){return new(Po(e))(0===t?0:t)},jo=Jr,Eo=yt,To=Ft,Mo=ds,Ao=Io;Js({target:"Array",proto:!0},{flatMap:function(e){var t,n=To(this),i=Mo(n);return Eo(e),(t=Ao(n,0)).length=jo(t,n,n,i,0,1,e,arguments.length>1?arguments[1]:void 0),t}}),Tr("flatMap"),zr("Array","flatMap");var Oo=Jr,Do=Ft,Ro=ds,Lo=ns,zo=Io;Js({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Do(this),n=Ro(t),i=zo(t,0);return i.length=Oo(i,t,t,n,0,void 0===e?1:Lo(e)),i}}),Tr("flat"),zr("Array","flat");var Fo=oo,No=String,$o=function(e){if("Symbol"===Fo(e))throw new TypeError("Cannot convert a Symbol value to a string");return No(e)},Bo=Js,Uo=Ne,Ko=ns,Ho=$o,Vo=ce,Wo=Pe("".charAt);Bo({target:"String",proto:!0,forced:Vo((function(){return"\ud842"!=="ð ®·".at(-2)}))},{at:function(e){var t=Ho(Uo(this)),n=t.length,i=Ko(e),s=i>=0?i:n+i;return s<0||s>=n?void 0:Wo(t,s)}}),zr("String","at");var Yo,Go,Xo=On,qo=function(){var e=Xo(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Zo=ce,Jo=ae.RegExp,Qo=Zo((function(){var e=Jo("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),ea=Qo||Zo((function(){return!Jo("a","y").sticky})),ta={BROKEN_CARET:Qo||Zo((function(){var e=Jo("^r","gy");return e.lastIndex=2,null!==e.exec("str")})),MISSED_STICKY:ea,UNSUPPORTED_Y:Qo},na=ce,ia=ae.RegExp,sa=na((function(){var e=ia(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})),ra=ce,oa=ae.RegExp,aa=ra((function(){var e=oa("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),la=ge,ca=Pe,da=$o,ha=qo,ua=ta,pa=Cr,ga=ji.get,fa=sa,ma=aa,ya=Rt("native-string-replace",String.prototype.replace),xa=RegExp.prototype.exec,wa=xa,va=ca("".charAt),ba=ca("".indexOf),Sa=ca("".replace),ka=ca("".slice),Ca=(Go=/b*/g,la(xa,Yo=/a/,"a"),la(xa,Go,"a"),0!==Yo.lastIndex||0!==Go.lastIndex),_a=ua.BROKEN_CARET,Pa=void 0!==/()??/.exec("")[1];(Ca||Pa||_a||fa||ma)&&(wa=function(e){var t,n,i,s,r,o,a,l=this,c=ga(l),d=da(e),h=c.raw;if(h)return h.lastIndex=l.lastIndex,t=la(wa,h,d),l.lastIndex=h.lastIndex,t;var u=c.groups,p=_a&&l.sticky,g=la(ha,l),f=l.source,m=0,y=d;if(p&&(g=Sa(g,"y",""),-1===ba(g,"g")&&(g+="g"),y=ka(d,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==va(d,l.lastIndex-1))&&(f="(?: "+f+")",y=" "+y,m++),n=new RegExp("^(?:"+f+")",g)),Pa&&(n=new RegExp("^"+f+"$(?!\\s)",g)),Ca&&(i=l.lastIndex),s=la(xa,p?n:l,y),p?s?(s.input=ka(s.input,m),s[0]=ka(s[0],m),s.index=l.lastIndex,l.lastIndex+=s[0].length):l.lastIndex=0:Ca&&s&&(l.lastIndex=l.global?s.index+s[0].length:i),Pa&&s&&s.length>1&&la(ya,s[0],n,(function(){for(r=1;r<arguments.length-2;r++)void 0===arguments[r]&&(s[r]=void 0)})),s&&u)for(s.groups=o=pa(null),r=0;r<u.length;r++)o[(a=u[r])[0]]=s[a[1]];return s});var Ia=wa;Js({target:"RegExp",proto:!0,forced:/./.exec!==Ia},{exec:Ia});var ja=he,Ea=Function.prototype,Ta=Ea.apply,Ma=Ea.call,Aa="object"==typeof Reflect&&Reflect.apply||(ja?Ma.bind(Ta):function(){return Ma.apply(Ta,arguments)}),Oa=ge,Da=Zi,Ra=Ia,La=ce,za=tn,Fa=Yn,Na=za("species"),$a=RegExp.prototype,Ba=Pe,Ua=ns,Ka=$o,Ha=Ne,Va=Ba("".charAt),Wa=Ba("".charCodeAt),Ya=Ba("".slice),Ga=function(e){return function(t,n){var i,s,r=Ka(Ha(t)),o=Ua(n),a=r.length;return o<0||o>=a?e?"":void 0:(i=Wa(r,o))<55296||i>56319||o+1===a||(s=Wa(r,o+1))<56320||s>57343?e?Va(r,o):i:e?Ya(r,o,o+2):s-56320+(i-55296<<10)+65536}},Xa={codeAt:Ga(!1),charAt:Ga(!0)}.charAt,qa=Pe,Za=Ft,Ja=Math.floor,Qa=qa("".charAt),el=qa("".replace),tl=qa("".slice),nl=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,il=/\$([$&'`]|\d{1,2})/g,sl=function(e,t,n,i,s,r){var o=n+e.length,a=i.length,l=il;return void 0!==s&&(s=Za(s),l=nl),el(r,l,(function(r,l){var c;switch(Qa(l,0)){case"$":return"$";case"&":return e;case"`":return tl(t,0,n);case"'":return tl(t,o);case"<":c=s[tl(l,1,-1)];break;default:var d=+l;if(0===d)return r;if(d>a){var h=Ja(d/10);return 0===h?r:h<=a?void 0===i[h-1]?Qa(l,1):i[h-1]+Qa(l,1):r}c=i[d-1]}return void 0===c?"":c}))},rl=ge,ol=On,al=He,ll=Te,cl=Ia,dl=TypeError,hl=Aa,ul=ge,pl=Pe,gl=function(e,t,n,i){var s=za(e),r=!La((function(){var t={};return t[s]=function(){return 7},7!==""[e](t)})),o=r&&!La((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Na]=function(){return n},n.flags="",n[s]=/./[s]),n.exec=function(){return t=!0,null},n[s](""),!t}));if(!r||!o||n){var a=/./[s],l=t(s,""[e],(function(e,t,n,i,s){var o=t.exec;return o===Ra||o===$a.exec?r&&!s?{done:!0,value:Oa(a,t,n,i)}:{done:!0,value:Oa(e,n,t,i)}:{done:!1}}));Da(String.prototype,e,l[0]),Da($a,s,l[1])}i&&Fa($a[s],"sham",!0)},fl=ce,ml=On,yl=He,xl=Le,wl=ns,vl=ls,bl=$o,Sl=Ne,kl=function(e,t,n){return t+(n?Xa(e,t).length:1)},Cl=vt,_l=sl,Pl=function(e,t){var n=e.exec;if(al(n)){var i=rl(n,e,t);return null!==i&&ol(i),i}if("RegExp"===ll(e))return rl(cl,e,t);throw new dl("RegExp#exec called on incompatible receiver")},Il=tn("replace"),jl=Math.max,El=Math.min,Tl=pl([].concat),Ml=pl([].push),Al=pl("".indexOf),Ol=pl("".slice),Dl="$0"==="a".replace(/./,"$0"),Rl=!!/./[Il]&&""===/./[Il]("a","$0");gl("replace",(function(e,t,n){var i=Rl?"$":"$0";return[function(e,n){var i=Sl(this),s=xl(e)?void 0:Cl(e,Il);return s?ul(s,e,i,n):ul(t,bl(i),e,n)},function(e,s){var r=ml(this),o=bl(e);if("string"==typeof s&&-1===Al(s,i)&&-1===Al(s,"$<")){var a=n(t,r,o,s);if(a.done)return a.value}var l=yl(s);l||(s=bl(s));var c,d=r.global;d&&(c=r.unicode,r.lastIndex=0);for(var h,u=[];null!==(h=Pl(r,o))&&(Ml(u,h),d);){""===bl(h[0])&&(r.lastIndex=kl(o,vl(r.lastIndex),c))}for(var p,g="",f=0,m=0;m<u.length;m++){for(var y,x=bl((h=u[m])[0]),w=jl(El(wl(h.index),o.length),0),v=[],b=1;b<h.length;b++)Ml(v,void 0===(p=h[b])?p:String(p));var S=h.groups;if(l){var k=Tl([x],v,w,o);void 0!==S&&Ml(k,S),y=bl(hl(s,void 0,k))}else y=_l(x,o,w,v,S,s);w>=f&&(g+=Ol(o,f,w)+y,f=w+x.length)}return g+Ol(o,f)}]}),!!fl((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Dl||Rl);var Ll=We,zl=Te,Fl=tn("match"),Nl=ge,$l=Bt,Bl=qe,Ul=qo,Kl=RegExp.prototype,Hl=Js,Vl=ge,Wl=Pe,Yl=Ne,Gl=He,Xl=Le,ql=function(e){var t;return Ll(e)&&(void 0!==(t=e[Fl])?!!t:"RegExp"===zl(e))},Zl=$o,Jl=vt,Ql=function(e){var t=e.flags;return void 0!==t||"flags"in Kl||$l(e,"flags")||!Bl(Kl,e)?t:Nl(Ul,e)},ec=sl,tc=tn("replace"),nc=TypeError,ic=Wl("".indexOf);Wl("".replace);var sc=Wl("".slice),rc=Math.max;Hl({target:"String",proto:!0},{replaceAll:function(e,t){var n,i,s,r,o,a,l,c,d=Yl(this),h=0,u=0,p="";if(!Xl(e)){if(ql(e)&&(n=Zl(Yl(Ql(e))),!~ic(n,"g")))throw new nc("`.replaceAll` does not allow non-global regexes");if(i=Jl(e,tc))return Vl(i,e,d,t)}for(s=Zl(d),r=Zl(e),(o=Gl(t))||(t=Zl(t)),a=r.length,l=rc(1,a),h=ic(s,r);-1!==h;)c=o?Zl(t(r,h,s)):ec(r,s,h,[],void 0,t),p+=sc(s,u,h)+c,u=h+a,h=h+l>s.length?-1:ic(s,r,h+l);return u<s.length&&(p+=sc(s,u)),p}}),zr("String","replaceAll");class oc{constructor(e){b(this,"nextValue"),b(this,"diff"),this.previousValue=e}get(){var e,t,n,i;const s=(null==(t=null==(e=this.diff)?void 0:e.removed)?void 0:t.size)??0,r=(null==(i=null==(n=this.diff)?void 0:n.added)?void 0:i.size)??0;if(0!==s||0!==r)return{value:this.nextValue,diff:this.diff}}_add(e,t){var n,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?null==(n=this.diff.removed)||n.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var t,n,i;const s=this.previousValue.has(e);if(s){if(!(null==(n=null==(t=this.diff)?void 0:t.removed)?void 0:n.has(e)))return;return this._add(e,s)}(null==(i=this.nextValue)?void 0:i.has(e))||this._add(e,s)}_remove(e,t){var n,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((n=this.diff).removed??(n.removed=new Set),this.diff.removed.add(e)):null==(i=this.diff.added)||i.delete(e)}remove(e){var t,n,i,s;const r=this.previousValue.has(e);if(!r){if(!(null==(n=null==(t=this.diff)?void 0:t.added)?void 0:n.has(e)))return;return this._remove(e,r)}(null==(s=null==(i=this.diff)?void 0:i.removed)?void 0:s.has(e))||this._remove(e,r)}}var ac="Expected a function",lc=NaN,cc="[object Symbol]",dc=/^\s+|\s+$/g,hc=/^[-+]0x[0-9a-f]+$/i,uc=/^0b[01]+$/i,pc=/^0o[0-7]+$/i,gc=parseInt,fc="object"==typeof _&&_&&_.Object===Object&&_,mc="object"==typeof self&&self&&self.Object===Object&&self,yc=fc||mc||Function("return this")(),xc=Object.prototype.toString,wc=Math.max,vc=Math.min,bc=function(){return yc.Date.now()};function Sc(e,t,n){var i,s,r,o,a,l,c=0,d=!1,h=!1,u=!0;if("function"!=typeof e)throw new TypeError(ac);function p(t){var n=i,r=s;return i=s=void 0,c=t,o=e.apply(r,n)}function g(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-c>=r}function f(){var e=bc();if(g(e))return m(e);a=setTimeout(f,function(e){var n=t-(e-l);return h?vc(n,r-(e-c)):n}(e))}function m(e){return a=void 0,u&&i?p(e):(i=s=void 0,o)}function y(){var e=bc(),n=g(e);if(i=arguments,s=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(f,t),d?p(e):o}(l);if(h)return a=setTimeout(f,t),p(l)}return void 0===a&&(a=setTimeout(f,t)),o}return t=Cc(t)||0,kc(n)&&(d=!!n.leading,r=(h="maxWait"in n)?wc(Cc(n.maxWait)||0,t):r,u="trailing"in n?!!n.trailing:u),y.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=s=a=void 0},y.flush=function(){return void 0===a?o:m(bc())},y}function kc(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Cc(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&xc.call(e)==cc}(e))return lc;if(kc(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=kc(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(dc,"");var n=uc.test(e);return n||pc.test(e)?gc(e.slice(2),n?2:8):hc.test(e)?lc:+e}var _c=function(e,t,n){var i=!0,s=!0;if("function"!=typeof e)throw new TypeError(ac);return kc(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Sc(e,t,{leading:i,maxWait:t,trailing:s})};const Pc=S(_c);var Ic=200,jc="__lodash_hash_undefined__",Ec="[object Function]",Tc="[object GeneratorFunction]",Mc=/^\[object .+?Constructor\]$/,Ac="object"==typeof _&&_&&_.Object===Object&&_,Oc="object"==typeof self&&self&&self.Object===Object&&self,Dc=Ac||Oc||Function("return this")();function Rc(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,i){var s=e.length,r=n+-1;for(;++r<s;)if(t(e[r],r,e))return r;return-1}(e,Lc,n);var i=n-1,s=e.length;for(;++i<s;)if(e[i]===t)return i;return-1}(e,t,0)>-1}function Lc(e){return e!=e}function zc(e,t){return e.has(t)}function Fc(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Nc,$c=Array.prototype,Bc=Function.prototype,Uc=Object.prototype,Kc=Dc["__core-js_shared__"],Hc=(Nc=/[^.]+$/.exec(Kc&&Kc.keys&&Kc.keys.IE_PROTO||""))?"Symbol(src)_1."+Nc:"",Vc=Bc.toString,Wc=Uc.hasOwnProperty,Yc=Uc.toString,Gc=RegExp("^"+Vc.call(Wc).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xc=$c.splice,qc=ad(Dc,"Map"),Zc=ad(Dc,"Set"),Jc=ad(Object,"create");function Qc(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ed(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function td(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function nd(e){var t=-1,n=e?e.length:0;for(this.__data__=new td;++t<n;)this.add(e[t])}function id(e,t){for(var n,i,s=e.length;s--;)if((n=e[s][0])===(i=t)||n!=n&&i!=i)return s;return-1}function sd(e){if(!ld(e)||(t=e,Hc&&Hc in t))return!1;var t,n=function(e){var t=ld(e)?Yc.call(e):"";return t==Ec||t==Tc}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?Gc:Mc;return n.test(function(e){if(null!=e){try{return Vc.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}Qc.prototype.clear=function(){this.__data__=Jc?Jc(null):{}},Qc.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Qc.prototype.get=function(e){var t=this.__data__;if(Jc){var n=t[e];return n===jc?void 0:n}return Wc.call(t,e)?t[e]:void 0},Qc.prototype.has=function(e){var t=this.__data__;return Jc?void 0!==t[e]:Wc.call(t,e)},Qc.prototype.set=function(e,t){return this.__data__[e]=Jc&&void 0===t?jc:t,this},ed.prototype.clear=function(){this.__data__=[]},ed.prototype.delete=function(e){var t=this.__data__,n=id(t,e);return!(n<0)&&(n==t.length-1?t.pop():Xc.call(t,n,1),!0)},ed.prototype.get=function(e){var t=this.__data__,n=id(t,e);return n<0?void 0:t[n][1]},ed.prototype.has=function(e){return id(this.__data__,e)>-1},ed.prototype.set=function(e,t){var n=this.__data__,i=id(n,e);return i<0?n.push([e,t]):n[i][1]=t,this},td.prototype.clear=function(){this.__data__={hash:new Qc,map:new(qc||ed),string:new Qc}},td.prototype.delete=function(e){return od(this,e).delete(e)},td.prototype.get=function(e){return od(this,e).get(e)},td.prototype.has=function(e){return od(this,e).has(e)},td.prototype.set=function(e,t){return od(this,e).set(e,t),this},nd.prototype.add=nd.prototype.push=function(e){return this.__data__.set(e,jc),this},nd.prototype.has=function(e){return this.__data__.has(e)};var rd=Zc&&1/Fc(new Zc([,-0]))[1]==1/0?function(e){return new Zc(e)}:function(){};function od(e,t){var n,i,s=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function ad(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return sd(n)?n:void 0}function ld(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}const cd=S((function(e){return e&&e.length?function(e,t,n){var i=-1,s=Rc,r=e.length,o=!0,a=[],l=a;if(r>=Ic){var c=rd(e);if(c)return Fc(c);o=!1,s=zc,l=new nd}else l=a;e:for(;++i<r;){var d=e[i],h=d;if(d=0!==d?d:0,o&&h==h){for(var u=l.length;u--;)if(l[u]===h)continue e;a.push(d)}else s(l,h,n)||(l!==a&&l.push(h),a.push(d))}return a}(e):[]}));class dd{constructor(){b(this,"startTime",0),b(this,"name",""),b(this,"frames",0),b(this,"started",!1),b(this,"frame",null),b(this,"recordFrame",(()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))}))}start(e){this.name=e,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3;0===e||Math.floor(this.frames/e),this.name[0].toUpperCase(),this.name.slice(1)}isStarted(){return this.started}}function hd(e,t){const n=[];e:for(const i of e){for(const e of n)if(t?t(i,e):i===e)continue e;n.push(i)}return n}function ud(e){return e.filter((e=>null!=e))}function pd(e){return e[e.length-1]}function gd(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}class fd{constructor(){b(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function md(e){const t=(...n)=>{try{return e(...n)}catch(i){throw i instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(i,t),i}};return t}const yd=()=>{},xd={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function wd(e,t){const n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw new Error(`Unknown switch case ${n}`)}const vd=md(((e,t)=>{if(!e)throw new Error(t||"Assertion Error")})),bd=md(((e,t)=>{if(null==e)throw new Error(t??"value must be defined");return e}));function Sd(e,t){let n;const i=(...i)=>(n||(n={},n.promise=new Promise(((e,t)=>{n.resolve=e,n.reject=t}))),clearTimeout(n.timeout),n.latestArgs=i,n.timeout=setTimeout((()=>{const t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(i){t.reject(i)}}),t),n.promise);return i.cancel=()=>{n&&clearTimeout(n.timeout)},i}const kd=new WeakMap;function Cd(e,t){if("object"!=typeof e||null===e)return;let n=kd.get(e);n||(n={tags:{},extras:{}},kd.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}async function _d(e,t){return window.fetch(e,{referrerPolicy:"strict-origin-when-cross-origin",...t})}const Pd=(e,t)=>{const n=new window.Image(e,t);return n.referrerPolicy="strict-origin-when-cross-origin",n};class Id{static async dataUrlToArrayBuffer(e){return _d(e).then((function(e){return e.arrayBuffer()}))}static async blobToDataUrl(e){return await new Promise(((t,n)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e=>n(e),i.onabort=e=>n(e),i.readAsDataURL(e)}}))}static async blobToText(e){return await new Promise(((t,n)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e=>n(e),i.onabort=e=>n(e),i.readAsText(e)}}))}}function jd(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t+""}
/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 JÃ³zef SokoÅowski <j.k.sokolowski@gmail.com>
 */
function Ed(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function Td(e){const t=new Uint8Array(e);let n,i,s=0,r=0;if(!function(e){return"GIF"===new TextDecoder("ascii").decode(e.slice(0,3))}(e))return!1;for(n=128&t[10],i=7&t[10],s+=6,s+=7,s+=n?3*Math.pow(2,i+1):0;r<2&&s<t.length;)switch(t[s]){case 44:r+=1,n=128&t[s+9],i=7&t[s+9],s+=10,s+=n?3*Math.pow(2,i+1):0,s+=Ed(t,s+1)+1;break;case 33:s+=2,s+=Ed(t,s);break;default:s=t.length}return r>1}let Md=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(Md=new Int32Array(Md))
/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */;class Ad{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const n={};if(!Ad.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,s=e.getInt32(t);t+=4;const r=Ad.getChunkType(e,t);if("IDAT"===r&&n[r])t+=s+4+4;else{if("IEND"===r)break;n[r]={start:i,dataOffset:t+4,size:s},t+=s+4+4}}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return Ad.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let i=46,s=0;const r=Ad.findChunk(e,"pHYs");r&&(i=r.start,s=r.size);const o=Ad.findChunk(e,"IDAT");o&&(i=o.start,s=0);const a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,"p".charCodeAt(0)),l.setUint8(5,"H".charCodeAt(0)),l.setUint8(6,"Y".charCodeAt(0)),l.setUint8(7,"s".charCodeAt(0));const c=2835.5;l.setInt32(8,c*t),l.setInt32(12,c*t),l.setInt8(16,1);const d=new Uint8Array(a.slice(4,17));l.setInt32(17,((e,t)=>{let n=~t;for(let i=0;i<e.length;i++)n=Md[255&(n^e[i])]^n>>>8;return~n})(d));const h=e.buffer.slice(0,i),u=e.buffer.slice(i+s);return new Blob([h,a,u],n)}}
/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */const Od=Object.freeze(["image/svg+xml"]),Dd=Object.freeze(["image/jpeg","image/png","image/webp"]),Rd=Object.freeze(["image/gif","image/apng","image/avif"]),Ld=Object.freeze([...Dd,...Od,...Rd]),zd=Object.freeze(["video/mp4","video/webm","video/quicktime"]),Fd=[...Ld,...zd].join(",");class Nd{static loadVideo(e){return new Promise(((t,n)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=e=>{console.error(e),n(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e}))}static loadImage(e){return new Promise(((t,n)=>{const i=Pd();i.onload=()=>t(i),i.onerror=e=>{console.error(e),n(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e}))}static async getVideoSize(e){return Nd.usingObjectURL(e,(async e=>{const t=await Nd.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}}))}static async getImageSize(e){const t=await Nd.usingObjectURL(e,Nd.loadImage);try{if("image/png"===e.type){const n=new DataView(await e.arrayBuffer());if(Ad.isPng(n,0)){const e=Ad.findChunk(n,"pHYs");if(e){const i=Ad.parsePhys(n,e.dataOffset);if(0===i.unit&&i.ppux===i.ppuy){const e=Math.max(i.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/e),h:Math.round(t.naturalHeight/e)}}}}}}catch(n){return console.error(n),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return"image/gif"===e.type?Td(await e.arrayBuffer()):"image/avif"===e.type?(t=await e.arrayBuffer(),44===new Uint8Array(t)[3]):"image/webp"===e.type?function(e){const t=new Uint8Array(e);return!(!function(e){return!(!e||e.length<12)&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}(t)||!t||t.length<21||1&~(t[20]>>1))}(await e.arrayBuffer()):"image/apng"===e.type&&
/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */
function(e){const t=new Uint8Array(e);if(!t||!("undefined"!=typeof Buffer&&Buffer.isBuffer(t)||t instanceof Uint8Array)||t.length<16)return!1;if(137!==t[0]||80!==t[1]||78!==t[2]||71!==t[3]||13!==t[4]||10!==t[5]||26!==t[6]||10!==t[7])return!1;function n(e,t,n,i,s=1024){if(!t)return-1;const r=(t=new RegExp(t,"g")).source.length,o=new TextDecoder,a=e.length;if(void 0===i&&(i=a),n>=a||i<=0||n>=i)return-1;e=e.subarray(n,i);let l=-1,c=0,d=0,h="";e:for(;c<e.length;){const n=c+s,i=e.subarray(c,n),a=o.decode(i,{stream:!0}),u=h+a;let p,g=-1;for(;null!==(p=t.exec(u));){g=p.index-h.length,l=d+g;break e}c=n,d+=a.length;const f=g>-1?g+r:a.length-r;h=a.slice(f)}return l>=0&&(l+=n>=0?n:a+n),l}const i=n(t,"IDAT",12);if(i>=12)return n(t,"acTL",8,i)>=8;return!1}(await e.arrayBuffer());var t}static isAnimatedImageType(e){return Rd.includes(e||"")}static isStaticImageType(e){return Dd.includes(e||"")}static isVectorImageType(e){return Od.includes(e||"")}static isImageType(e){return Ld.includes(e)}static async usingObjectURL(e,t){const n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function $d(e,t,n){return e+(t-e)*n}function Bd(e=""){let t=0,n=0,i=0,s=0;function r(){const e=t^t<<11;return t=n,n=i,i=s,s^=(s>>>19^e^e>>>8)>>>0,s/4294967296*2}for(let o=0;o<e.length+64;o++)t^=0|e.charCodeAt(o),r();return r}function Ud(e,t,n,i=!1){const[s,r]=t,[o,a]=n,l=o+(e-s)/(r-s)*(a-o);return i?o<a?Math.max(Math.min(l,a),o):Math.max(Math.min(l,o),a):l}function Kd(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Hd(e,t){if(Kd(e,t))return e[t]}function Vd(e){return Object.keys(e)}function Wd(e){return Object.values(e)}function Yd(e){return Object.entries(e)}function Gd(e){return Object.fromEntries(e)}function Xd(e,t){const n={};let i=!1;for(const[s,r]of Yd(e))t(s,r)?n[s]=r:i=!0;return i?n:e}function qd(e,t){const n={};for(const[i,s]of Yd(e)){const e=t(i,s);n[i]=e}return n}function Zd(e,t){if(e===t)return!0;const n=new Set(Object.keys(e)),i=new Set(Object.keys(t));if(n.size!==i.size)return!1;for(const s of n){if(!i.has(s))return!1;if(!Object.is(e[s],t[s]))return!1}return!0}const Jd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Qd="a0",eh="A00000000000000000000000000";function th(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-"a".charCodeAt(0)+2;if(e>="A"&&e<="Z")return"Z".charCodeAt(0)-e.charCodeAt(0)+2;throw new Error("Invalid index key head: "+e)}function nh(e){if(e.length!==th(e.charAt(0)))throw new Error("invalid integer part of index key: "+e)}function ih(e){if(void 0===e)throw Error("n is undefined")}function sh(e){nh(e);const[t,...n]=e.split("");let i=!0;for(let s=n.length-1;i&&s>=0;s--){const e=Jd.indexOf(n[s])+1;e===Jd.length?n[s]="0":(n[s]=Jd.charAt(e),i=!1)}if(i){if("Z"===t)return"a0";if("z"===t)return;const e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}return t+n.join("")}function rh(e,t){if(void 0!==t&&e>=t)throw new Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw new Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+rh(e.slice(n),t.slice(n))}const n=e?Jd.indexOf(e.charAt(0)):0,i=void 0!==t?Jd.indexOf(t.charAt(0)):Jd.length;if(i-n>1){const e=Math.round(.5*(n+i));return Jd.charAt(e)}return t&&t.length>1?t.slice(0,1):Jd.charAt(n)+rh(e.slice(1),void 0)}function oh(e){const t=th(e.charAt(0));if(t>e.length)throw new Error("invalid index: "+e);return e.slice(0,t)}function ah(e){if(e===eh)throw new Error("invalid index: "+e);const t=oh(e);if("0"===e.slice(t.length).slice(-1))throw new Error("invalid index: "+e)}function lh(e,t){if(void 0!==e&&ah(e),void 0!==t&&ah(t),void 0!==e&&void 0!==t&&e>=t)throw new Error(e+" >= "+t);if(void 0===e&&void 0===t)return Qd;if(void 0===e){if(void 0===t)throw Error("b is undefined");const e=oh(t),n=t.slice(e.length);if(e===eh)return e+rh("",n);if(e<t)return e;const i=function(e){nh(e);const[t,...n]=e.split("");let i=!0;for(let s=n.length-1;i&&s>=0;s--){const e=Jd.indexOf(n[s])-1;-1===e?n[s]=Jd.slice(-1):(n[s]=Jd.charAt(e),i=!1)}if(i){if("a"===t)return"Z"+Jd.slice(-1);if("A"===t)return;const e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(Jd.slice(-1)):n.pop(),e+n.join("")}return t+n.join("")}(e);return ih(i),i}if(void 0===t){const t=oh(e),n=e.slice(t.length),i=sh(t);return void 0===i?t+rh(n,void 0):i}const n=oh(e),i=e.slice(n.length),s=oh(t),r=t.slice(s.length);if(n===s)return n+rh(i,r);const o=sh(n);return ih(o),o<t?o:n+rh(i,void 0)}function ch(e,t,n){if(0===n)return[];if(1===n)return[lh(e,t)];if(void 0===t){let i=lh(e,t);const s=[i];for(let e=0;e<n-1;e++)i=lh(i,t),s.push(i);return s}if(void 0===e){let i=lh(e,t);const s=[i];for(let t=0;t<n-1;t++)i=lh(e,i),s.push(i);return s.reverse(),s}const i=Math.floor(n/2),s=lh(e,t);return[...ch(e,s,i),s,...ch(s,t,n-i-1)]}const dh=Qd;function hh(e,t,n){return ch(e,t,n)}function uh(e,t){return ch(e,void 0,t)}function ph(e,t){return ch(e,t,1)[0]}function gh(e){return ch(e,void 0,1)[0]}function fh(e,t="a1"){return[t,...ch(t,void 0,e)]}function mh(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function yh(e,t){return e.id>t.id?1:-1}function xh(e){try{return localStorage.getItem(e)}catch{return null}}function wh(e,t){try{localStorage.setItem(e,t)}catch{}}function vh(e){try{return sessionStorage.getItem(e)}catch{return null}}function bh(e,t){try{sessionStorage.setItem(e,t)}catch{}}function Sh(e){try{sessionStorage.removeItem(e)}catch{}}const kh=[],Ch=Math.ceil(1e3/60);let _h,Ph=0,Ih=0;const jh=()=>{const e=kh.splice(0,kh.length);for(const t of e)t()};function Eh(){if(_h)return;const e=Date.now(),t=e-Ih;_h=Ph+t<Ch?requestAnimationFrame((()=>{_h=void 0,Eh()})):requestAnimationFrame((()=>{_h=void 0,Ih=e,Ph=Math.min(Ph+t-Ch,10*Ch),jh()}))}let Th=!1;function Mh(e){return kh.includes(e)||(kh.push(e),Th||(Th=!0,Ih=Date.now()-Ch-1),Eh()),()=>{const t=kh.indexOf(e);t>-1&&kh.splice(t,1)}}class Ah{constructor(){b(this,"timeouts",[]),b(this,"intervals",[]),b(this,"rafs",[])}setTimeout(e,t,...n){const i=window.setTimeout(e,t,n);return this.timeouts.push(i),i}setInterval(e,t,...n){const i=window.setInterval(e,t,n);return this.intervals.push(i),i}requestAnimationFrame(e){const t=window.requestAnimationFrame(e);return this.rafs.push(t),t}dispose(){this.timeouts.forEach((e=>clearTimeout(e))),this.intervals.forEach((e=>clearInterval(e))),this.rafs.forEach((e=>cancelAnimationFrame(e))),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function Oh(e){return null!==e}const Dh="undefined"!=typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:"undefined"!=typeof global&&global.structuredClone?[global.structuredClone,!0]:"undefined"!=typeof window&&window.structuredClone?[window.structuredClone,!0]:[e=>e?JSON.parse(JSON.stringify(e)):e,!1],Rh=Dh[0],Lh=Object.getPrototypeOf(Rh({}));let zh=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");class Fh{constructor(e,t){b(this,"createDefaultProperties"),b(this,"validator"),b(this,"ephemeralKeys"),b(this,"ephemeralKeySet"),b(this,"scope"),b(this,"isInstance",(e=>(null==e?void 0:e.typeName)===this.typeName)),this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const n=new Set;if(t.ephemeralKeys)for(const[i,s]of Yd(t.ephemeralKeys))s&&n.add(i);this.ephemeralKeySet=n}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[n,i]of Object.entries(e))void 0!==i&&(t[n]=i);return t.typeName=this.typeName,t}clone(e){return{...Rh(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??zh())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new Fh(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function Nh(e,t){return new Fh(e,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}function $h(e){const t={added:e.removed,removed:e.added,updated:{}};for(const[n,i]of Object.values(e.updated))t.updated[n.id]=[i,n];return t}function Bh(e){return 0===Object.keys(e.added).length&&0===Object.keys(e.updated).length&&0===Object.keys(e.removed).length}function Uh(e){const t={added:{},removed:{},updated:{}};return Kh(t,e),t}function Kh(e,t){for(const n of t){for(const[t,i]of Yd(n.added))if(e.removed[t]){const n=e.removed[t];delete e.removed[t],n!==i&&(e.updated[t]=[n,i])}else e.added[t]=i;for(const[t,[i,s]]of Yd(n.updated))e.added[t]?(e.added[t]=s,delete e.updated[t],delete e.removed[t]):e.updated[t]?(e.updated[t]=[e.updated[t][0],s],delete e.removed[t]):(e.updated[t]=n.updated[t],delete e.removed[t]);for(const[t,i]of Yd(n.removed))e.added[t]?delete e.added[t]:e.updated[t]?(e.removed[t]=e.updated[t][0],delete e.updated[t]):e.removed[t]=i}}function Hh(e){return e&&"object"==typeof e&&"parents"in e}function Vh(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}const Wh=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&Hh(e))for(let n=0,i=e.parents.length;n<i;n++)Wh(e.parents[n],e)},Yh=(e,t)=>{if(e.children.add(t)&&Hh(e))for(let n=0,i=e.parents.length;n<i;n++)Yh(e.parents[n],e)};function Gh(e,t){return e===t||Object.is(e,t)||Boolean(e&&t&&"function"==typeof e.equals&&e.equals(t))}function Xh(e,t){const n=Symbol.for(`com.tldraw.state/${e}`),i=globalThis;return i[n]??(i[n]=t()),i[n]}const qh=Xh("empty_array",(()=>Object.freeze([])));class Zh{constructor(){b(this,"arraySize",0),b(this,"array",Array(8)),b(this,"set",null)}get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw new Error("no set or array")}add(e){if(this.array){return-1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0))}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return-1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw new Error("no set or array")}visit(e){if(this.array)for(let t=0;t<this.arraySize;t++){const n=this.array[t];void 0!==n&&e(n)}else{if(!this.set)throw new Error("no set or array");this.set.forEach(e)}}has(e){return this.array?-1!==this.array.indexOf(e):this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Jh=Symbol.for("com.tldraw.state/RESET_VALUE");class Qh{constructor(e){b(this,"index",0),b(this,"buffer"),this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,n){void 0!==n&&(n!==Jh?(this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity):this.clear())}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:n,buffer:i}=this;for(let s=0;s<n;s++){const r=(t-1+n-s)%n,o=i[r];if(!o)return Jh;const[a,l]=o;if(0===s&&e>=l)return[];if(a<=e&&e<l){const e=s+1,t=new Array(e);for(let s=0;s<e;s++)t[s]=i[(r+s)%n][2];return t}}return Jh}}class eu{constructor(e,t){b(this,"offset",0),b(this,"maybeRemoved"),this.below=e,this.child=t}}const tu=Xh("capture",(()=>({stack:null})));function nu(e){const t=tu.stack;tu.stack=null;try{return e()}finally{tu.stack=t}}function iu(e){tu.stack=new eu(tu.stack,e),e.parentSet.clear()}function su(){const e=tu.stack;if(tu.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){const n=e.child.parents[t];e.child.parentSet.has(n)||Wh(n,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){const n=e.maybeRemoved[t];e.child.parentSet.has(n)||Wh(n,e.child)}}function ru(e){if(tu.stack){if(tu.stack.child.parentSet.has(e))return;if(tu.stack.child.parentSet.add(e),tu.stack.child.isActivelyListening&&Yh(e,tu.stack.child),tu.stack.offset<tu.stack.child.parents.length){const t=tu.stack.child.parents[tu.stack.offset];t!==e&&(tu.stack.maybeRemoved?tu.stack.maybeRemoved.push(t):tu.stack.maybeRemoved=[t])}tu.stack.child.parents[tu.stack.offset]=e,tu.stack.child.parentEpochs[tu.stack.offset]=e.lastChangedEpoch,tu.stack.offset++}}const ou=-1;class au{constructor(e,t,n){b(this,"_isActivelyListening",!1),b(this,"lastTraversedEpoch",ou),b(this,"lastReactedEpoch",ou),b(this,"_scheduleCount",0),b(this,"parentSet",new Zh),b(this,"parentEpochs",[]),b(this,"parents",[]),b(this,"_scheduleEffect"),b(this,"maybeExecute",(()=>{this._isActivelyListening&&this.execute()})),this.name=e,this.runEffect=t,this._scheduleEffect=null==n?void 0:n.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){this._isActivelyListening&&this.lastReactedEpoch!==uu()&&(!this.parents.length||Vh(this)?this.scheduleEffect():this.lastReactedEpoch=uu())}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)Yh(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Wh(this.parents[e],this)}execute(){try{iu(this);const e=uu(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{su()}}}const lu=Xh("EffectScheduler",(()=>au));function cu(e,t,n){const i=new lu(e,t,n);return i.attach(),i.scheduleEffect(),()=>{i.detach()}}let du=class{constructor(e){b(this,"initialAtomValues",new Map),this.parent=e}get isRoot(){return null===this.parent}commit(){this.isRoot?gu(this.initialAtomValues.keys()):this.initialAtomValues.forEach(((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)}))}abort(){hu.globalEpoch++,this.initialAtomValues.forEach(((e,t)=>{var n;t.set(e),null==(n=t.historyBuffer)||n.clear()})),this.commit()}};const hu=Xh("transactions",(()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0})));function uu(){return hu.globalEpoch}function pu(e,t){t.lastTraversedEpoch!==hu.globalEpoch&&(t.lastTraversedEpoch=hu.globalEpoch,t instanceof lu?e.add(t):t.children.visit((t=>pu(e,t))))}function gu(e){var t;if(hu.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{hu.globalIsReacting=!0,hu.reactionEpoch=hu.globalEpoch;const n=new Set;for(const t of e)t.children.visit((e=>pu(n,e)));for(const e of n)e.maybeScheduleEffect();let i=0;for(;null==(t=hu.cleanupReactors)?void 0:t.size;){if(i++>1e3)throw new Error("Reaction update depth limit exceeded");const e=hu.cleanupReactors;hu.cleanupReactors=null;for(const t of e)t.maybeScheduleEffect()}}finally{hu.cleanupReactors=null,hu.globalIsReacting=!1}}function fu(e){return hu.currentTransaction?e():function(e){const t=new du(hu.currentTransaction);hu.currentTransaction=t;try{let i,s=!1;try{i=e((()=>s=!0))}catch(n){throw t.abort(),n}return s?t.abort():t.commit(),i}finally{hu.currentTransaction=hu.currentTransaction.parent}}(e)}class mu{constructor(e,t,n){b(this,"isEqual"),b(this,"computeDiff"),b(this,"lastChangedEpoch",uu()),b(this,"children",new Zh),b(this,"historyBuffer"),this.name=e,this.current=t,this.isEqual=(null==n?void 0:n.isEqual)??null,n&&(n.historyLength&&(this.historyBuffer=new Qh(n.historyLength)),this.computeDiff=n.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return ru(this),this.current}set(e,t){var n,i;if((null==(n=this.isEqual)?void 0:n.call(this,this.current,e))??Gh(this.current,e))return this.current;hu.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,uu(),t??(null==(i=this.computeDiff)?void 0:i.call(this,this.current,e,this.lastChangedEpoch,uu()))??Jh),this.lastChangedEpoch=uu();const s=this.current;return this.current=e,function(e,t){if(hu.globalIsReacting){const t=hu.cleanupReactors??(hu.cleanupReactors=new Set);e.children.visit((e=>pu(t,e)))}else hu.currentTransaction?hu.currentTransaction.initialAtomValues.has(e)||hu.currentTransaction.initialAtomValues.set(e,t):gu([e])}(this,s),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return ru(this),e>=this.lastChangedEpoch?qh:(null==(t=this.historyBuffer)?void 0:t.getChangesSince(e))??Jh}}const yu=Xh("Atom",(()=>mu));function xu(e,t,n){return new yu(e,t,n)}let wu=!1;const vu=Symbol.for("com.tldraw.state/UNINITIALIZED"),bu=e=>e===vu,Su=Xh("WithDiff",(()=>class{constructor(e,t){this.value=e,this.diff=t}}));function ku(e,t){return new Su(e,t)}class Cu{constructor(e,t,n){b(this,"lastChangedEpoch",ou),b(this,"lastTraversedEpoch",ou),b(this,"lastCheckedEpoch",ou),b(this,"parentSet",new Zh),b(this,"parents",[]),b(this,"parentEpochs",[]),b(this,"children",new Zh),b(this,"historyBuffer"),b(this,"state",vu),b(this,"error",null),b(this,"computeDiff"),b(this,"isEqual"),this.name=e,this.derive=t,(null==n?void 0:n.historyLength)&&(this.historyBuffer=new Qh(n.historyLength)),this.computeDiff=null==n?void 0:n.computeDiff,this.isEqual=(null==n?void 0:n.isEqual)??Gh}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var t;const n=this.lastChangedEpoch===ou,i=uu();if(!n&&(this.lastCheckedEpoch===i||this.isActivelyListening&&hu.globalIsReacting&&this.lastTraversedEpoch<hu.reactionEpoch||!Vh(this))){if(this.lastCheckedEpoch=i,this.error){if(e)return this.state;throw this.error.thrownValue}return this.state}try{iu(this);const e=this.derive(this.state,this.lastCheckedEpoch),n=e instanceof Su?e.value:e,i=this.state===vu;if(i||!this.isEqual(n,this.state)){if(this.historyBuffer&&!i){const i=e instanceof Su?e.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,uu(),i??(null==(t=this.computeDiff)?void 0:t.call(this,this.state,n,this.lastCheckedEpoch,uu()))??Jh)}this.lastChangedEpoch=uu(),this.state=n}return this.error=null,this.lastCheckedEpoch=uu(),this.state}catch(s){if(this.state!==vu&&(this.state=vu,this.lastChangedEpoch=uu()),this.lastCheckedEpoch=uu(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{su()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{ru(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),ru(this),e>=this.lastChangedEpoch?qh:(null==(t=this.historyBuffer)?void 0:t.getChangesSince(e))??Jh}}const _u=Xh("Computed",(()=>Cu));function Pu(e={},t,n,i){return i.get?(wu||(wu=!0,console.warn("Using `@computed` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use `@computed` as a decorator for methods.\n\n// Before\n@computed\nget foo() {\n\treturn 'foo'\n}\n\n// After\n@computed\ngetFoo() {\n\treturn 'foo'\n}\n")),function(e={},t,n,i){const s=i.get,r=Symbol.for("__@tldraw/state__computed__"+n);return i.get=function(){let t=this[r];return t||(t=new _u(n,s.bind(this),e),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:t})),t.get()},i}(e,0,n,i)):function(e={},t,n,i){const s=i.value,r=Symbol.for("__@tldraw/state__computed__"+n);return i.value=function(){let t=this[r];return t||(t=new _u(n,s.bind(this),e),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:t})),t.get()},i.value[Iu]=!0,i}(e,0,n,i)}const Iu="@@__isComputedMethod__@@";function ju(){if(1===arguments.length){const e=arguments[0];return(t,n,i)=>Pu(e,0,n,i)}return"string"==typeof arguments[0]?new _u(arguments[0],arguments[1],arguments[2]):Pu(void 0,0,arguments[1],arguments[2])}if(1!==Xh("apiVersion",(()=>1)))throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function Eu(e,t){const n=P.useRef(t);n.current=t;const[i,s,r]=P.useMemo((()=>{let t=null;const i=new lu(`useStateTracking(${e})`,(()=>{var e;return null==(e=n.current)?void 0:e.call(n)}),{scheduleEffect(){null==t||t()}});return[i,e=>(t=e,()=>{t=null}),()=>i.scheduleCount]}),[e]);return P.useSyncExternalStore(s,r,r),P.useEffect((()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()})),[i]),i.execute()}const Tu={apply:(e,t,n)=>Eu(e.displayName??e.name??"tracked(???)",(()=>e.apply(t,n)))},Mu=Symbol.for("react.memo"),Au=Symbol.for("react.forward_ref");function Ou(e){let t=null;const n=e.$$typeof;return n===Mu&&(t=(e=e.type).compare),n===Au?C.memo(C.forwardRef(new Proxy(e.render,Tu))):C.memo(new Proxy(e,Tu),t)}function Du(e,t,n=qh){C.useEffect((()=>{const n=new lu(e,t);return n.attach(),n.execute(),()=>{n.detach()}}),n)}function Ru(){const e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,i=C.useRef(!0);i.current=!0;const s=C.useMemo((()=>1===e.length?e[0]:ju(n,(()=>{if(i.current)return e[1]();try{return e[1]()}catch{return{}}}))),t);try{const{subscribe:e,getSnapshot:t}=C.useMemo((()=>({subscribe:e=>cu(`useValue(${n})`,(()=>{s.get(),e()})),getSnapshot:()=>s.get()})),[s]);return C.useSyncExternalStore(e,t,t)}finally{i.current=!1}}var Lu={exports:{}};!function(e,t){var n="__lodash_hash_undefined__",i=1,s=2,r=9007199254740991,o="[object Arguments]",a="[object Array]",l="[object AsyncFunction]",c="[object Boolean]",d="[object Date]",h="[object Error]",u="[object Function]",p="[object GeneratorFunction]",g="[object Map]",f="[object Number]",m="[object Null]",y="[object Object]",x="[object Promise]",w="[object Proxy]",v="[object RegExp]",b="[object Set]",S="[object String]",k="[object Symbol]",C="[object Undefined]",P="[object WeakMap]",I="[object ArrayBuffer]",j="[object DataView]",E=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,M={};M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M[o]=M[a]=M[I]=M[c]=M[j]=M[d]=M[h]=M[u]=M[g]=M[f]=M[y]=M[v]=M[b]=M[S]=M[P]=!1;var A="object"==typeof _&&_&&_.Object===Object&&_,O="object"==typeof self&&self&&self.Object===Object&&self,D=A||O||Function("return this")(),R=t&&!t.nodeType&&t,L=R&&e&&!e.nodeType&&e,z=L&&L.exports===R,F=z&&A.process,N=function(){try{return F&&F.binding&&F.binding("util")}catch(e){}}(),$=N&&N.isTypedArray;function B(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function U(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}function K(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var H,V,W=Array.prototype,Y=Function.prototype,G=Object.prototype,X=D["__core-js_shared__"],q=Y.toString,Z=G.hasOwnProperty,J=function(){var e=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Q=G.toString,ee=RegExp("^"+q.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=z?D.Buffer:void 0,ne=D.Symbol,ie=D.Uint8Array,se=G.propertyIsEnumerable,re=W.splice,oe=ne?ne.toStringTag:void 0,ae=Object.getOwnPropertySymbols,le=te?te.isBuffer:void 0,ce=(H=Object.keys,V=Object,function(e){return H(V(e))}),de=Fe(D,"DataView"),he=Fe(D,"Map"),ue=Fe(D,"Promise"),pe=Fe(D,"Set"),ge=Fe(D,"WeakMap"),fe=Fe(Object,"create"),me=Ue(de),ye=Ue(he),xe=Ue(ue),we=Ue(pe),ve=Ue(ge),be=ne?ne.prototype:void 0,Se=be?be.valueOf:void 0;function ke(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function _e(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Pe(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new _e;++t<n;)this.add(e[t])}function Ie(e){var t=this.__data__=new Ce(e);this.size=t.size}function je(e,t){var n=Ve(e),i=!n&&He(e),s=!n&&!i&&We(e),r=!n&&!i&&!s&&Ze(e),o=n||i||s||r,a=o?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],l=a.length;for(var c in e)!Z.call(e,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||r&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Be(c,l))||a.push(c);return a}function Ee(e,t){for(var n=e.length;n--;)if(Ke(e[n][0],t))return n;return-1}function Te(e){return null==e?void 0===e?C:m:oe&&oe in Object(e)?function(e){var t=Z.call(e,oe),n=e[oe];try{e[oe]=void 0;var i=!0}catch(r){}var s=Q.call(e);i&&(t?e[oe]=n:delete e[oe]);return s}(e):function(e){return Q.call(e)}(e)}function Me(e){return qe(e)&&Te(e)==o}function Ae(e,t,n,r,l){return e===t||(null==e||null==t||!qe(e)&&!qe(t)?e!=e&&t!=t:function(e,t,n,r,l,u){var p=Ve(e),m=Ve(t),x=p?a:$e(e),w=m?a:$e(t),C=(x=x==o?y:x)==y,_=(w=w==o?y:w)==y,P=x==w;if(P&&We(e)){if(!We(t))return!1;p=!0,C=!1}if(P&&!C)return u||(u=new Ie),p||Ze(e)?Re(e,t,n,r,l,u):function(e,t,n,r,o,a,l){switch(n){case j:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!a(new ie(e),new ie(t)));case c:case d:case f:return Ke(+e,+t);case h:return e.name==t.name&&e.message==t.message;case v:case S:return e==t+"";case g:var u=U;case b:var p=r&i;if(u||(u=K),e.size!=t.size&&!p)return!1;var m=l.get(e);if(m)return m==t;r|=s,l.set(e,t);var y=Re(u(e),u(t),r,o,a,l);return l.delete(e),y;case k:if(Se)return Se.call(e)==Se.call(t)}return!1}(e,t,x,n,r,l,u);if(!(n&i)){var E=C&&Z.call(e,"__wrapped__"),T=_&&Z.call(t,"__wrapped__");if(E||T){var M=E?e.value():e,A=T?t.value():t;return u||(u=new Ie),l(M,A,n,r,u)}}if(!P)return!1;return u||(u=new Ie),function(e,t,n,s,r,o){var a=n&i,l=Le(e),c=l.length,d=Le(t),h=d.length;if(c!=h&&!a)return!1;var u=c;for(;u--;){var p=l[u];if(!(a?p in t:Z.call(t,p)))return!1}var g=o.get(e);if(g&&o.get(t))return g==t;var f=!0;o.set(e,t),o.set(t,e);var m=a;for(;++u<c;){var y=e[p=l[u]],x=t[p];if(s)var w=a?s(x,y,p,t,e,o):s(y,x,p,e,t,o);if(!(void 0===w?y===x||r(y,x,n,s,o):w)){f=!1;break}m||(m="constructor"==p)}if(f&&!m){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,r,l,u)}(e,t,n,r,Ae,l))}function Oe(e){return!(!Xe(e)||function(e){return!!J&&J in e}(e))&&(Ye(e)?ee:E).test(Ue(e))}function De(e){if(n=(t=e)&&t.constructor,i="function"==typeof n&&n.prototype||G,t!==i)return ce(e);var t,n,i,s=[];for(var r in Object(e))Z.call(e,r)&&"constructor"!=r&&s.push(r);return s}function Re(e,t,n,r,o,a){var l=n&i,c=e.length,d=t.length;if(c!=d&&!(l&&d>c))return!1;var h=a.get(e);if(h&&a.get(t))return h==t;var u=-1,p=!0,g=n&s?new Pe:void 0;for(a.set(e,t),a.set(t,e);++u<c;){var f=e[u],m=t[u];if(r)var y=l?r(m,f,u,t,e,a):r(f,m,u,e,t,a);if(void 0!==y){if(y)continue;p=!1;break}if(g){if(!B(t,(function(e,t){if(i=t,!g.has(i)&&(f===e||o(f,e,n,r,a)))return g.push(t);var i}))){p=!1;break}}else if(f!==m&&!o(f,m,n,r,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function Le(e){return function(e,t,n){var i=t(e);return Ve(e)?i:function(e,t){for(var n=-1,i=t.length,s=e.length;++n<i;)e[s+n]=t[n];return e}(i,n(e))}(e,Je,Ne)}function ze(e,t){var n,i,s=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function Fe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Oe(n)?n:void 0}ke.prototype.clear=function(){this.__data__=fe?fe(null):{},this.size=0},ke.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ke.prototype.get=function(e){var t=this.__data__;if(fe){var i=t[e];return i===n?void 0:i}return Z.call(t,e)?t[e]:void 0},ke.prototype.has=function(e){var t=this.__data__;return fe?void 0!==t[e]:Z.call(t,e)},ke.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=fe&&void 0===t?n:t,this},Ce.prototype.clear=function(){this.__data__=[],this.size=0},Ce.prototype.delete=function(e){var t=this.__data__,n=Ee(t,e);return!(n<0)&&(n==t.length-1?t.pop():re.call(t,n,1),--this.size,!0)},Ce.prototype.get=function(e){var t=this.__data__,n=Ee(t,e);return n<0?void 0:t[n][1]},Ce.prototype.has=function(e){return Ee(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var n=this.__data__,i=Ee(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},_e.prototype.clear=function(){this.size=0,this.__data__={hash:new ke,map:new(he||Ce),string:new ke}},_e.prototype.delete=function(e){var t=ze(this,e).delete(e);return this.size-=t?1:0,t},_e.prototype.get=function(e){return ze(this,e).get(e)},_e.prototype.has=function(e){return ze(this,e).has(e)},_e.prototype.set=function(e,t){var n=ze(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},Pe.prototype.add=Pe.prototype.push=function(e){return this.__data__.set(e,n),this},Pe.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.clear=function(){this.__data__=new Ce,this.size=0},Ie.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ce){var i=n.__data__;if(!he||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new _e(i)}return n.set(e,t),this.size=n.size,this};var Ne=ae?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,i=null==e?0:e.length,s=0,r=[];++n<i;){var o=e[n];t(o,n,e)&&(r[s++]=o)}return r}(ae(e),(function(t){return se.call(e,t)})))}:function(){return[]},$e=Te;function Be(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function Ue(e){if(null!=e){try{return q.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ke(e,t){return e===t||e!=e&&t!=t}(de&&$e(new de(new ArrayBuffer(1)))!=j||he&&$e(new he)!=g||ue&&$e(ue.resolve())!=x||pe&&$e(new pe)!=b||ge&&$e(new ge)!=P)&&($e=function(e){var t=Te(e),n=t==y?e.constructor:void 0,i=n?Ue(n):"";if(i)switch(i){case me:return j;case ye:return g;case xe:return x;case we:return b;case ve:return P}return t});var He=Me(function(){return arguments}())?Me:function(e){return qe(e)&&Z.call(e,"callee")&&!se.call(e,"callee")},Ve=Array.isArray;var We=le||function(){return!1};function Ye(e){if(!Xe(e))return!1;var t=Te(e);return t==u||t==p||t==l||t==w}function Ge(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function Xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function qe(e){return null!=e&&"object"==typeof e}var Ze=$?function(e){return function(t){return e(t)}}($):function(e){return qe(e)&&Ge(e.length)&&!!M[Te(e)]};function Je(e){return null!=(t=e)&&Ge(t.length)&&!Ye(t)?je(e):De(e);var t}e.exports=function(e,t){return Ae(e,t)}}(Lu,Lu.exports);const zu=S(Lu.exports);function Fu(e,t){for(const[n,i]of Object.entries(e)){const e=i,s=t[n];if("eq"in e&&s!==e.eq)return!1;if("neq"in e&&s===e.neq)return!1;if("gt"in e&&("number"!=typeof s||s<=e.gt))return!1}return!0}function Nu(e,t,n){const i=Object.fromEntries(Object.keys(n).map((e=>[e,new Set])));for(const[s,r]of Object.entries(n))if("eq"in r){const n=e.index(t,s).get().get(r.eq);if(n)for(const e of n)i[s].add(e)}else if("neq"in r){const n=e.index(t,s);for(const[e,t]of n.get())if(e!==r.neq)for(const n of t)i[s].add(n)}else if("gt"in r){const n=e.index(t,s);for(const[e,t]of n.get())if(e>r.gt)for(const n of t)i[s].add(n)}return function(e){if(0===e.length)return new Set;const t=e[0],n=e.slice(1),i=new Set;for(const s of t)n.every((e=>e.has(s)))&&i.add(s);return i}(Object.values(i))}class $u{constructor(e,t){b(this,"indexCache",new Map),b(this,"historyCache",new Map),this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=ju("filterHistory:"+e,((t,n)=>{if(bu(t))return this.history.get();const i=this.history.getDiffSince(n);if(i===Jh)return this.history.get();const s={added:{},removed:{},updated:{}};let r=0,o=0,a=0;for(const l of i){for(const t of Wd(l.added))if(t.typeName===e)if(s.removed[t.id]){const e=s.removed[t.id];delete s.removed[t.id],o--,e!==t&&(s.updated[t.id]=[e,t],a++)}else s.added[t.id]=t,r++;for(const[t,n]of Wd(l.updated))n.typeName===e&&(s.added[n.id]?s.added[n.id]=n:s.updated[n.id]?s.updated[n.id]=[s.updated[n.id][0],n]:(s.updated[n.id]=[t,n],a++));for(const t of Wd(l.removed))t.typeName===e&&(s.added[t.id]?(delete s.added[t.id],r--):s.updated[t.id]?(s.removed[t.id]=s.updated[t.id][0],delete s.updated[t.id],a--,o++):(s.removed[t.id]=t,o++))}return r||o||a?ku(this.history.get(),s):t}),{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(n,i),i}__uncached_createIndex(e,t){const n=this.filterHistory(e),i=()=>{n.get();const i=new Map;for(const n of Wd(this.atoms.get())){const s=n.get();if(s.typeName===e){const e=s[t];i.has(e)||i.set(e,new Set),i.get(e).add(s.id)}}return i};return ju("index:"+e+":"+t,((s,r)=>{if(bu(s))return i();const o=n.getDiffSince(r);if(o===Jh)return i();const a=new Map,l=(e,t)=>{let n=a.get(e);n||(n=new oc(s.get(e)??new Set)),n.add(t),a.set(e,n)},c=(e,t)=>{let n=a.get(e);n||(n=new oc(s.get(e)??new Set)),n.remove(t),a.set(e,n)};for(const n of o){for(const i of Wd(n.added))if(i.typeName===e){l(i[t],i.id)}for(const[i,s]of Wd(n.updated))if(s.typeName===e){const e=i[t],n=s[t];e!==n&&(c(e,s.id),l(n,s.id))}for(const i of Wd(n.removed))if(i.typeName===e){c(i[t],i.id)}}let d,h;for(const[e,t]of a){const n=t.get();n&&(d||(d=new Map(s)),h||(h=new Map),0===n.value.size?d.delete(e):d.set(e,n.value),h.set(e,n.diff))}return d&&h?ku(d,h):s}),{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,n);return ju(n,(()=>{var e;for(const t of i.get())return null==(e=this.atoms.get()[t])?void 0:e.get()}))}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+n);return ju(n,(()=>[...i.get()].map((e=>{const t=this.atoms.get()[e];if(!t)throw new Error("no atom found for record id: "+e);return t.get()}))))}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const n=t();return 0===Object.keys(n).length?new Set(Wd(this.atoms.get()).flatMap((t=>{const n=t.get();return n.typeName===e?n.id:[]}))):Nu(this,e,n)},r=e=>{const t=s(),n=function(e,t){const n={};for(const i of t)e.has(i)||(n.added??(n.added=new Set),n.added.add(i));for(const i of e)t.has(i)||(n.removed??(n.removed=new Set),n.removed.add(i));return n.added||n.removed?n:void 0}(e,t);return n?ku(t,n):e},o=ju("ids_query:"+n,t,{isEqual:zu});return ju("query:"+n,((t,n)=>{const a=o.get();if(bu(t))return s();if(n<o.lastChangedEpoch)return r(t);const l=i.getDiffSince(n);if(l===Jh)return r(t);const c=new oc(t);for(const i of l){for(const t of Wd(i.added))t.typeName===e&&Fu(a,t)&&c.add(t.id);for(const[t,n]of Wd(i.updated))n.typeName===e&&(Fu(a,n)?c.add(n.id):c.remove(n.id));for(const t of Wd(i.removed))t.typeName===e&&c.remove(t.id)}const d=c.get();return d?ku(d.value,d.diff):t}),{historyLength:50})}exec(e,t){const n=Nu(this,e,t);if(0===n.size)return qh;const i=this.atoms.get();return[...n].map((e=>i[e].get()))}}class Bu{constructor(e){b(this,"_beforeCreateHandlers",{}),b(this,"_afterCreateHandlers",{}),b(this,"_beforeChangeHandlers",{}),b(this,"_afterChangeHandlers",{}),b(this,"_beforeDeleteHandlers",{}),b(this,"_afterDeleteHandlers",{}),b(this,"_operationCompleteHandlers",[]),b(this,"_isEnabled",!0),this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const n=this._beforeCreateHandlers[e.typeName];if(n){let i=e;for(const e of n)i=e(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const n=this._afterCreateHandlers[e.typeName];if(n)for(const i of n)i(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let s=t;for(const t of i)s=t(e,s,n);return s}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const s of i)s(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const n=this._beforeDeleteHandlers[e.typeName];if(n)for(const i of n)if(!1===i(e,t))return!1;return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const n=this._afterDeleteHandlers[e.typeName];if(n)for(const i of n)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[n,i]of Object.entries(e))(null==i?void 0:i.beforeCreate)&&t.push(this.registerBeforeCreateHandler(n,i.beforeCreate)),(null==i?void 0:i.afterCreate)&&t.push(this.registerAfterCreateHandler(n,i.afterCreate)),(null==i?void 0:i.beforeChange)&&t.push(this.registerBeforeChangeHandler(n,i.beforeChange)),(null==i?void 0:i.afterChange)&&t.push(this.registerAfterChangeHandler(n,i.afterChange)),(null==i?void 0:i.beforeDelete)&&t.push(this.registerBeforeDeleteHandler(n,i.beforeDelete)),(null==i?void 0:i.afterDelete)&&t.push(this.registerAfterDeleteHandler(n,i.afterDelete));return()=>{for(const e of t)e()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Uu(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Uu(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Uu(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Uu(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Uu(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Uu(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Uu(this._operationCompleteHandlers,e)}}function Uu(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}class Ku{constructor(e){b(this,"id"),b(this,"atoms",xu("store_atoms",{})),b(this,"history",xu("history",0,{historyLength:1e3})),b(this,"query",new $u(this.atoms,this.history)),b(this,"listeners",new Set),b(this,"historyAccumulator",new Hu),b(this,"historyReactor"),b(this,"cancelHistoryReactor",(()=>{})),b(this,"schema"),b(this,"props"),b(this,"scopedTypes"),b(this,"sideEffects",new Bu(this)),b(this,"put",((e,t)=>{this.atomic((()=>{const n={},i={},s=this.atoms.__unsafe__getWithoutCapture();let r,o=null,a=!1;const l=this.isMergingRemoteChanges?"remote":"user";for(let c=0,d=e.length;c<d;c++){r=e[c];const d=(o??s)[r.id];if(d){const e=d.__unsafe__getWithoutCapture();r=this.sideEffects.handleBeforeChange(e,r,l);if(this.schema.validateRecord(this,r,t??"updateRecord",e)===e)continue;d.set(r),a=!0;const i=d.__unsafe__getWithoutCapture();n[r.id]=[e,i],this.addDiffForAfterEvent(e,i)}else r=this.sideEffects.handleBeforeCreate(r,l),a=!0,r=this.schema.validateRecord(this,r,t??"createRecord",null),i[r.id]=r,this.addDiffForAfterEvent(null,r),o||(o={...s}),o[r.id]=xu("atom:"+r.id,r)}o&&this.atoms.set(o),a&&this.updateHistory({added:i,updated:n,removed:{}})}))})),b(this,"remove",(e=>{this.atomic((()=>{const t=new Set,n=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const e=this.atoms.__unsafe__getWithoutCapture()[s];e&&(!1===this.sideEffects.handleBeforeDelete(e.get(),n)&&t.add(s))}let i;this.atoms.update((n=>{let s;for(const r of e){if(t.has(r))continue;if(!(r in n))continue;s||(s={...n}),i||(i={}),delete s[r];const e=n[r].get();i[r]=e,this.addDiffForAfterEvent(e,null)}return s??n})),i&&this.updateHistory({added:{},updated:{},removed:i})}))})),b(this,"get",(e=>{var t;return null==(t=this.atoms.get()[e])?void 0:t.get()})),b(this,"unsafeGetWithoutCapture",(e=>{var t;return null==(t=this.atoms.get()[e])?void 0:t.__unsafe__getWithoutCapture()})),b(this,"serialize",((e="document")=>{const t={};for(const[n,i]of Yd(this.atoms.get())){const s=i.get();("all"===e||this.scopedTypes[e].has(s.typeName))&&(t[n]=s)}return t})),b(this,"allRecords",(()=>Wd(this.atoms.get()).map((e=>e.get())))),b(this,"clear",(()=>{this.remove(Vd(this.atoms.get()))})),b(this,"update",((e,t)=>{const n=this.atoms.get()[e];n?this.put([t(n.__unsafe__getWithoutCapture())]):console.error(`Record ${e} not found. This is probably an error`)})),b(this,"has",(e=>!!this.atoms.get()[e])),b(this,"listen",((e,t)=>{this._flushHistory();const n={onHistory:e,filters:{source:(null==t?void 0:t.source)??"all",scope:(null==t?void 0:t.scope)??"all"}};return this.listeners.add(n),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}})),b(this,"isMergingRemoteChanges",!1),b(this,"mergeRemoteChanges",(e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,fu(e)}finally{this.isMergingRemoteChanges=!1}})),b(this,"createComputedCache",((e,t,n)=>{const i=new fd;return{get:s=>{const r=this.atoms.get()[s];if(r)return i.get(r,(()=>{const i=n?ju(r.name+":equals",(()=>r.get()),{isEqual:n}):r;return ju(e+":"+s,(()=>t(i.get())))})).get()}}})),b(this,"createSelectedComputedCache",((e,t,n)=>{const i=new fd;return{get:s=>{const r=this.atoms.get()[s];if(r)return i.get(r,(()=>{const i=ju(e+":"+s+":selector",(()=>t(r.get())));return ju(e+":"+s,(()=>n(i.get())))})).get()}}})),b(this,"_integrityChecker"),b(this,"_isPossiblyCorrupted",!1),b(this,"pendingAfterEvents",null),b(this,"_isInAtomicOp",!1);const{initialData:t,schema:n,id:i}=e;this.id=i??zh(),this.schema=n,this.props=e.props,t&&this.atoms.set(Gd(Yd(t).map((([e,t])=>[e,xu("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))])))),this.historyReactor=function(e,t,n){const i=new lu(e,t,n);return{scheduler:i,start:e=>{const t=(null==e?void 0:e.force)??!1;i.attach(),t?i.scheduleEffect():i.maybeScheduleEffect()},stop:()=>{i.detach()}}}("Store.historyReactor",(()=>{this.history.get(),this._flushHistory()}),{scheduleEffect:e=>this.cancelHistoryReactor=Mh(e)}),this.scopedTypes={document:new Set(Wd(this.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName))),session:new Set(Wd(this.schema.types).filter((e=>"session"===e.scope)).map((e=>e.typeName))),presence:new Set(Wd(this.schema.types).filter((e=>"presence"===e.scope)).map((e=>e.typeName)))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:n}of e){let e=null,i=null,s=null;for(const{onHistory:r,filters:o}of this.listeners)if("all"===o.source||o.source===n)if("all"!==o.scope)if("document"===o.scope){if(i??(i=this.filterChangesByScope(t,"document")),!i)continue;r({changes:i,source:n})}else if("session"===o.scope){if(e??(e=this.filterChangesByScope(t,"session")),!e)continue;r({changes:e,source:n})}else{if(s??(s=this.filterChangesByScope(t,"presence")),!s)continue;r({changes:s,source:n})}else r({changes:t,source:n})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const n={added:Xd(e.added,((e,n)=>this.scopedTypes[t].has(n.typeName))),updated:Xd(e.updated,((e,n)=>this.scopedTypes[t].has(n[1].typeName))),removed:Xd(e.removed,((e,n)=>this.scopedTypes[t].has(n.typeName)))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach((t=>this.schema.validateRecord(this,t,e,null)))}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error(`Failed to migrate snapshot: ${t.reason}`);const n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic((()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()}))}finally{this.sideEffects.setIsEnabled(n)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}extractingChanges(e){const t=[],n=this.historyAccumulator.addInterceptor((e=>t.push(e.changes)));try{return fu(e),Uh(t)}finally{n()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}={}){this.atomic((()=>{const t=Wd(e.added);for(const[s,r]of Wd(e.updated)){const e=this.schema.getType(r.typeName);if(n&&e.ephemeralKeySet.size){const n=this.get(r.id);if(!n){t.push(r);continue}let i=null;for(const[t,s]of Object.entries(r))e.ephemeralKeySet.has(t)||Object.is(s,Hd(n,t))||(i||(i={...n}),i[t]=s);i&&t.push(i)}else t.push(r)}const i=Vd(e.removed);t.length&&this.put(t),i.length&&this.remove(i)}),t)}ensureStoreIsUsable(){this.atomic((()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),null==(e=this._integrityChecker)||e.call(this)}))}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(vd(this.pendingAfterEvents,"must be in event operation"),e===t)return;if(e&&t&&vd(e.id===t.id),!e&&!t)return;const n=(e||t).id,i=this.pendingAfterEvents.get(n);i?i.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const n=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:e,after:i}of n.values())e&&i?this.sideEffects.handleAfterChange(e,i,t):e&&!i?this.sideEffects.handleAfterDelete(e,t):!e&&i&&this.sideEffects.handleAfterCreate(i,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return fu((()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const n=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??n),this._isInAtomicOp=!0;try{const t=e();return this.flushAtomicCallbacks(),t}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(n),this._isInAtomicOp=!1}}))}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor((t=>e(t,this.isMergingRemoteChanges?"remote":"user")))}}class Hu{constructor(){b(this,"_history",[]),b(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=function(e){if(0===e.length)return[];const t=[];let n,i=[e[0]];for(let s=1,r=e.length;s<r;s++)n=e[s],i[0].source!==n.source&&(t.push(i),i=[]),i.push(n);return t.push(i),t.map((e=>({source:e[0].source,changes:Uh(e.map((e=>e.changes)))})))}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function Vu(e){const t=[];for(let n=e.length-1;n>=0;n--){const i=e[n];if("id"in i)t.unshift(i);else{const e=i.dependsOn,n=t[0];n&&(t[0]={...n,dependsOn:e.concat(n.dependsOn??[])})}}return t}function Wu({sequence:e,sequenceId:t,retroactive:n=!0}){const i={sequenceId:t,retroactive:n,sequence:Vu(e)};return Zu(i),i}function Yu(e,t){return Object.fromEntries(Yd(t).map((([t,n])=>[t,`${e}/${n}`])))}function Gu(e){return Wu({sequenceId:e.sequenceId,retroactive:e.retroactive??!0,sequence:e.sequence.map((t=>"id"in t?{...t,scope:"record",filter:n=>{var i,s;return n.typeName===e.recordType&&((null==(i=t.filter)?void 0:i.call(t,n))??!0)&&((null==(s=e.filter)?void 0:s.call(e,n))??!0)}}:t))})}function Xu(e){const[t,n]=e.split("/");return{sequenceId:t,version:parseInt(n)}}function qu(e,t){t&&vd(e.startsWith(t+"/"),`Every migration in sequence '${t}' must have an id starting with '${t}/'. Got invalid id: '${e}'`),vd(e.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${e}'`)}function Zu(e){if(vd(!e.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${e.sequenceId}`),vd(e.sequenceId.length,"sequenceId must be a non-empty string"),0===e.sequence.length)return;qu(e.sequence[0].id,e.sequenceId);let t=Xu(e.sequence[0].id).version;vd(1===t,`Expected the first migrationId to be '${e.sequenceId}/1' but got '${e.sequence[0].id}'`);for(let n=1;n<e.sequence.length;n++){const i=e.sequence[n].id;qu(i,e.sequenceId);const s=Xu(i).version;vd(s===t+1,`Migration id numbers must increase in increments of 1, expected ${e.sequenceId}/${t+1} but got '${e.sequence[n].id}'`),t=s}}var Ju=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(Ju||{});class Qu{constructor(e,t){var n;b(this,"migrations",{}),b(this,"sortedMigrations"),this.types=e,this.options=t;for(const s of t.migrations??[])vd(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),Zu(s),this.migrations[s.sequenceId]=s;const i=Object.values(this.migrations).flatMap((e=>e.sequence));this.sortedMigrations=function(e){const t=new Map(e.map((e=>[e.id,e]))),n=new Set,i=[];function s(e){vd(!n.has(e.id),`Circular dependency in migrations: ${e.id}`),n.add(e.id);const{version:r,sequenceId:o}=Xu(e.id),a=t.get(`${o}/${r-1}`);if(a&&s(a),e.dependsOn)for(const n of e.dependsOn){const e=t.get(n);e&&s(e)}t.delete(e.id),i.push(e)}for(const r of t.values())s(r);return i}(i);for(const s of this.sortedMigrations)if(null==(n=s.dependsOn)?void 0:n.length)for(const e of s.dependsOn){const t=i.find((t=>t.id===e));vd(t,`Migration '${s.id}' depends on missing migration '${e}'`)}}static create(e,t){return new Qu(e,t??{})}validateRecord(e,t,n,i){try{const e=Hd(this.types,t.typeName);if(!e)throw new Error(`Missing definition for record type ${t.typeName}`);return e.validate(t,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const t=function(e){if(e.schemaVersion>2||e.schemaVersion<1)return xd.err("Bad schema version");if(2===e.schemaVersion)return xd.ok(e);const t={schemaVersion:2,sequences:{}};for(const[n,i]of Object.entries(e.recordVersions))if(t.sequences[`com.tldraw.${n}`]=i.version,"subTypeKey"in i)for(const[e,s]of Object.entries(i.subTypeVersions))t.sequences[`com.tldraw.${n}.${e}`]=s;return xd.ok(t)}(e);if(!t.ok)return t;const n=t.value,i=new Set(Object.keys(n.sequences).filter((e=>this.migrations[e])));for(const r in this.migrations)void 0===n.sequences[r]&&this.migrations[r].retroactive&&i.add(r);if(0===i.size)return xd.ok([]);const s=new Set;for(const r of i){const e=n.sequences[r];if("number"!=typeof e&&this.migrations[r].retroactive||0===e){for(const e of this.migrations[r].sequence)s.add(e.id);continue}const t=`${r}/${e}`,i=this.migrations[r].sequence.findIndex((e=>e.id===t));if(-1===i)return xd.err("Incompatible schema?");for(const n of this.migrations[r].sequence.slice(i+1))s.add(n.id)}return xd.ok(this.sortedMigrations.filter((({id:e})=>s.has(e))))}migratePersistedRecord(e,t,n="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:Ju.MigrationError};let s=i.value;if(0===s.length)return{type:"success",value:e};if(s.some((e=>"store"===e.scope)))return{type:"error",reason:"down"===n?Ju.TargetVersionTooOld:Ju.TargetVersionTooNew};if("down"===n){if(!s.every((e=>e.down)))return{type:"error",reason:Ju.TargetVersionTooOld};s=s.slice().reverse()}e=Rh(e);try{for(const t of s){if("store"===t.scope)throw new Error;if(!(!t.filter||t.filter(e)))continue;const i=t[n](e);i&&(e=Rh(i))}}catch(r){return console.error("Error migrating record",r),{type:"error",reason:Ju.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const n=this.getMigrationsSince(e.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:Ju.MigrationError};const i=n.value;if(0===i.length)return{type:"success",value:t};t=Rh(t);try{for(const e of i)if("record"===e.scope)for(const[n,i]of Object.entries(t)){if(!(!e.filter||e.filter(i)))continue;const s=e.up(i);s&&(t[n]=Rh(s))}else if("store"===e.scope){const n=e.up(t);n&&(t=Rh(n))}else wd(e)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:Ju.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,n;return(null==(n=(t=this.options).createIntegrityChecker)?void 0:n.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((({sequenceId:e,sequence:t})=>[e,t.length?Xu(t.at(-1).id).version:0])))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((({sequenceId:e})=>[e,0])))}}getType(e){const t=Hd(this.types,e);return vd(t,"record type does not exists"),t}}class ep extends Error{constructor(e,t=[]){const n=function(e){if(!e.length)return null;let t="";for(const n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),t.startsWith(".")?t.slice(1):t}(t),i=e.split("\n").map(((e,t)=>0===t?e:`  ${e}`)).join("\n");super(t?`At ${n}: ${i}`:i),b(this,"name","ValidationError"),this.rawMessage=e,this.path=t}}function tp(e,t){try{return t()}catch(n){if(n instanceof ep)throw new ep(n.rawMessage,[e,...n.path]);throw new ep(n.toString(),[e])}}function np(e){if(null===e)return"null";if(Array.isArray(e))return"an array";const t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:wd(t)}}class ip{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return e=this,new ip((t=>null===t?null:e.validate(t)),((t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)));var e}optional(){return Ep(this)}refine(e){return new ip((t=>e(this.validate(t))),((t,n)=>{const i=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,i)?t:e(i)}))}check(e,t){return"string"==typeof e?this.refine((n=>(tp(`(check ${e})`,(()=>t(n))),n))):this.refine((t=>(e(t),t)))}}class sp extends ip{constructor(e){super((t=>{const n=wp.validate(t);for(let i=0;i<n.length;i++)tp(i,(()=>e.validate(n[i])));return n}),((t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);const i=wp.validate(n);let s=t.length!==i.length;for(let r=0;r<i.length;r++){const n=i[r];if(r>=t.length){s=!0,tp(r,(()=>e.validate(n)));continue}if(Object.is(t[r],n))continue;const o=tp(r,(()=>e.validateUsingKnownGoodVersion(t[r],n)));Object.is(o,t[r])||(s=!0)}return s?n:t})),this.itemValidator=e}nonEmpty(){return this.check((e=>{if(0===e.length)throw new ep("Expected a non-empty array")}))}lengthGreaterThan1(){return this.check((e=>{if(e.length<=1)throw new ep("Expected an array with length greater than 1")}))}}class rp extends ip{constructor(e,t=!1){super((n=>{if("object"!=typeof n||null===n)throw new ep(`Expected object, got ${np(n)}`);for(const[t,i]of Object.entries(e))tp(t,(()=>{i.validate(Hd(n,t))}));if(!t)for(const t of Object.keys(n))if(!Kd(e,t))throw new ep("Unexpected property",[t]);return n}),((n,i)=>{if("object"!=typeof i||null===i)throw new ep(`Expected object, got ${np(i)}`);let s=!1;for(const[t,r]of Object.entries(e)){const e=Hd(n,t),o=Hd(i,t);if(Object.is(e,o))continue;const a=tp(t,(()=>{const t=r;return t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(e,o):t.validate(o)}));Object.is(a,e)||(s=!0)}if(!t)for(const t of Object.keys(i))if(!Kd(e,t))throw new ep("Unexpected property",[t]);for(const e of Object.keys(n))if(!Kd(i,e)){s=!0;break}return s?i:n})),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new rp(this.config,!0)}extend(e){return new rp({...this.config,...e})}}class op extends ip{constructor(e,t,n,i){super((t=>{this.expectObject(t);const{matchingSchema:n,variant:i}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,i):tp(`(${e} = ${i})`,(()=>n.validate(t)))}),((t,n)=>{this.expectObject(n),this.expectObject(t);const{matchingSchema:i,variant:s}=this.getMatchingSchemaAndVariant(n);return void 0===i?this.unknownValueValidation(n,s):Hd(t,e)!==Hd(n,e)?tp(`(${e} = ${s})`,(()=>i.validate(n))):tp(`(${e} = ${s})`,(()=>i.validateUsingKnownGoodVersion?i.validateUsingKnownGoodVersion(t,n):i.validate(n)))})),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=i}expectObject(e){if("object"!=typeof e||null===e)throw new ep(`Expected an object, got ${np(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Hd(e,this.key);if(!this.useNumberKeys&&"string"!=typeof t)throw new ep(`Expected a string for key "${this.key}", got ${np(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new ep(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Kd(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new op(this.key,this.config,e,this.useNumberKeys)}}class ap extends ip{constructor(e,t){super((n=>{if("object"!=typeof n||null===n)throw new ep(`Expected object, got ${np(n)}`);for(const[i,s]of Object.entries(n))tp(i,(()=>{e.validate(i),t.validate(s)}));return n}),((n,i)=>{if("object"!=typeof i||null===i)throw new ep(`Expected object, got ${np(i)}`);let s=!1;for(const[r,o]of Object.entries(i)){if(!Kd(n,r)){s=!0,tp(r,(()=>{e.validate(r),t.validate(o)}));continue}const i=Hd(n,r),a=o;if(Object.is(i,a))continue;const l=tp(r,(()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(i,a):t.validate(a)));Object.is(l,i)||(s=!0)}for(const e of Object.keys(n))if(!Kd(i,e)){s=!0;break}return s?i:n})),this.keyValidator=e,this.valueValidator=t}}function lp(e){return new ip((t=>{if(typeof t!==e)throw new ep(`Expected ${e}, got ${np(t)}`);return t}))}const cp=new ip((e=>e)),dp=lp("string"),hp=lp("number").check((e=>{if(Number.isNaN(e))throw new ep("Expected a number, got NaN");if(!Number.isFinite(e))throw new ep(`Expected a finite number, got ${e}`)})),up=hp.check((e=>{if(e<0)throw new ep(`Expected a positive number, got ${e}`)})),pp=hp.check((e=>{if(e<=0)throw new ep(`Expected a non-zero positive number, got ${e}`)})),gp=hp.check((e=>{if(!Number.isInteger(e))throw new ep(`Expected an integer, got ${e}`)})),fp=gp.check((e=>{if(e<0)throw new ep(`Expected a positive integer, got ${e}`)})),mp=gp.check((e=>{if(e<=0)throw new ep(`Expected a non-zero positive integer, got ${e}`)})),yp=lp("boolean");function xp(e){return new ip((t=>{if(t!==e)throw new ep(`Expected ${e}, got ${JSON.stringify(t)}`);return e}))}const wp=new ip((e=>{if(!Array.isArray(e))throw new ep(`Expected an array, got ${np(e)}`);return e}));function vp(e){return new sp(e)}function bp(e){return new rp(e)}function Sp(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Lh)}function kp(e){return null===e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(kp):!!Sp(e)&&Object.values(e).every(kp))}const Cp=new ip((e=>{if(kp(e))return e;throw new ep("Expected json serializable value, got "+typeof e)}),((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let i=0;i<t.length;i++){if(i>=e.length){n=!0,Cp.validate(t[i]);continue}const s=e[i],r=t[i];if(Object.is(s,r))continue;const o=Cp.validateUsingKnownGoodVersion(s,r);Object.is(o,s)||(n=!0)}return n?t:e}if(Sp(e)&&Sp(t)){let n=!1;for(const i of Object.keys(t)){if(!Kd(e,i)){n=!0,Cp.validate(t[i]);continue}const s=e[i],r=t[i];if(Object.is(s,r))continue;const o=Cp.validateUsingKnownGoodVersion(s,r);Object.is(o,s)||(n=!0)}for(const i of Object.keys(e))if(!Kd(t,i)){n=!0;break}return n?t:e}return Cp.validate(t)}));function _p(e,t){return new ap(e,t)}function Pp(e,t){return new op(e,t,((n,i)=>{throw new ep(`Expected one of ${Object.keys(t).map((e=>JSON.stringify(e))).join(" or ")}, got ${JSON.stringify(i)}`,[e])}),!1)}function Ip(e,t){return new ip((n=>tp(e,(()=>t.validate(n)))),((n,i)=>tp(e,(()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,i):t.validate(i)))))}function jp(e){return new ip((t=>{if(!e.has(t)){const n=Array.from(e,(e=>JSON.stringify(e))).join(" or ");throw new ep(`Expected ${n}, got ${t}`)}return t}))}function Ep(e){return new ip((t=>{if(void 0!==t)return e.validate(t)}),((t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)}))}function Tp(...e){return jp(new Set(e))}function Mp(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(n){throw new ep(`Expected a valid url, got ${JSON.stringify(e)}`)}throw new ep(`Expected a valid url, got ${JSON.stringify(e)}`)}}const Ap=new Set(["http:","https:","mailto:"]),Op=dp.check((e=>{if(""===e)return;const t=Mp(e);if(!Ap.has(t.protocol.toLowerCase()))throw new ep(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)})),Dp=new Set(["http:","https:","data:","asset:"]),Rp=dp.check((e=>{if(""===e)return;const t=Mp(e);if(!Dp.has(t.protocol.toLowerCase()))throw new ep(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)})),Lp=dp.refine((e=>{try{return function(e){ah(e)}(e),e}catch{throw new ep(`Expected an index key, got ${JSON.stringify(e)}`)}}));function zp(e){return dp.refine((t=>{if(!t.startsWith(`${e}:`))throw new Error(`${e} ID must start with "${e}:"`);return t}))}const Fp=zp("asset");function Np(e,t){return bp({id:Fp,typeName:xp("asset"),type:xp(e),props:t,meta:Cp})}const $p=bp({x:hp,y:hp,z:hp.optional()}),Bp=bp({x:hp,y:hp,w:hp,h:hp}),Up=hp.check((e=>{if(e<0||e>1)throw new ep("Opacity must be between 0 and 1")})),Kp=dp.refine((e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e})),Hp=zp("shape");const Vp=zp("binding");function Wp(e){return`binding:${zh()}`}function Yp(e){return Nh("binding",{scope:"document",validator:Ip("binding",Pp("type",qd(e,((e,{props:t,meta:n})=>function(e,t,n){return bp({id:Vp,typeName:xp("binding"),type:xp(e),fromId:Hp,toId:Hp,props:t?bp(t):Cp,meta:n?bp(n):Cp})}(e,t,n)))))}).withDefaultProperties((()=>({meta:{}})))}Yu("com.tldraw.binding",{}),Gu({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});class Gp{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){const{defaultValue:n,type:i=cp}=t;return new Gp(e,n,i)}static defineEnum(e,t){const{defaultValue:n,values:i}=t;return new Xp(e,n,i)}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class Xp extends Gp{constructor(e,t,n){super(e,t,Tp(...n)),this.values=n}}const qp=Yu("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Zp=Gu({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:qp.AddIsLocked,up:e=>{e.isLocked=!1},down:e=>{delete e.isLocked}},{id:qp.HoistOpacity,up:e=>{e.opacity=Number(e.props.opacity??"1"),delete e.props.opacity},down:e=>{const t=e.opacity;delete e.opacity,e.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:qp.AddMeta,up:e=>{e.meta={}}},{id:qp.AddWhite,up:e=>{},down:e=>{"white"===e.props.color&&(e.props.color="black")}}]});function Jp(e){return!!e&&"shape"===e.typeName}function Qp(e){return!!e&&e.startsWith("shape:")}function eg(e){return`shape:${e??zh()}`}function tg(e){const t=new Map;for(const[n,i]of Object.entries(e))if(i instanceof Gp){if(t.has(i))throw new Error(`Duplicate style prop ${i.id}. Each style prop can only be used once within a shape.`);t.set(i,n)}return t}function ng(e,t){return qd(t,((t,n)=>`com.tldraw.shape.${e}/${n}`))}function ig(e){return Nh("shape",{scope:"document",validator:Ip("shape",Pp("type",qd(e,((e,{props:t,meta:n})=>function(e,t,n){return bp({id:Hp,typeName:xp("shape"),x:hp,y:hp,rotation:hp,index:Lp,parentId:Kp,type:xp(e),isLocked:yp,opacity:Up,props:t?bp(t):Cp,meta:n?bp(n):Cp})}(e,t,n)))))}).withDefaultProperties((()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})))}function sg(e,t){const n=[];for(const[i,{migrations:s}]of Object.entries(t)){const t=`com.tldraw.${e}.${i}`;s?"sequenceId"in s?(vd(t===s.sequenceId,`sequenceId mismatch for ${i} ${Fh} migrations. Expected '${t}', got '${s.sequenceId}'`),n.push(s)):"sequence"in s?n.push(Wu({sequenceId:t,retroactive:!1,sequence:s.sequence.map((t=>"id"in t?rg(e,i,t):t))})):n.push(Wu({sequenceId:t,retroactive:!1,sequence:Object.keys(s.migrators).map((e=>Number(e))).sort(((e,t)=>e-t)).map((n=>({id:`${t}/${n}`,scope:"record",filter:t=>t.typeName===e&&t.type===i,up:e=>{const t=s.migrators[n].up(e);if(t)return t},down:e=>{const t=s.migrators[n].down(e);if(t)return t}})))})):n.push(Wu({sequenceId:t,retroactive:!1,sequence:[]}))}return n}function rg(e,t,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:n=>n.typeName===e&&n.type===t,up:e=>{const t=n.up(e.props);t&&(e.props=t)},down:"function"==typeof n.down?e=>{const t=n.down(e.props);t&&(e.props=t)}:void 0}}const og=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],ag={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function lg(e){return e.isDarkMode?ag.darkMode:ag.lightMode}const cg=Gp.defineEnum("tldraw:color",{defaultValue:"black",values:og}),dg=Gp.defineEnum("tldraw:labelColor",{defaultValue:"black",values:og}),hg=Gp.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),ug=Gp.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),pg=Gp.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),gg={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},fg=Gp.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),mg=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],yg=Gp.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:mg}),xg=Gp.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:mg}),wg={labelColor:dg,color:cg,fill:ug,dash:hg,size:fg,arrowheadStart:yg,arrowheadEnd:xg,font:pg,start:$p,end:$p,bend:hp,text:dp,labelPosition:hp,scale:pp},vg=ng("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function bg(e){return rg("shape","arrow",e)}const Sg=Wu({sequenceId:"com.tldraw.shape.arrow",sequence:[bg({id:vg.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"}),bg({id:vg.AddIsPrecise,up:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise=!(.5===e.normalizedAnchor.x&&.5===e.normalizedAnchor.y)),"binding"===t.type&&(t.isPrecise=!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y))},down:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise),"binding"===t.type&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise)}}),bg({id:vg.AddLabelPosition,up:e=>{e.labelPosition=.5},down:e=>{delete e.labelPosition}}),{id:vg.ExtractBindings,scope:"store",up:e=>{const t=Object.values(e).filter((e=>"shape"===e.typeName&&"arrow"===e.type));for(const n of t){const{start:t,end:i}=n.props;if("binding"===t.type){const i=Wp(),s={typeName:"binding",id:i,type:"arrow",fromId:n.id,toId:t.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:t.normalizedAnchor,isExact:t.isExact,isPrecise:t.isPrecise}};e[i]=s,n.props.start={x:0,y:0}}else delete n.props.start.type;if("binding"===i.type){const t=Wp(),s={typeName:"binding",id:t,type:"arrow",fromId:n.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};e[t]=s,n.props.end={x:0,y:0}}else delete n.props.end.type}}},bg({id:vg.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}})]}),kg={terminal:Tp("start","end"),normalizedAnchor:$p,isExact:yp,isPrecise:yp},Cg={sequence:[{dependsOn:[vg.ExtractBindings]}]},_g=Ip("camera",bp({typeName:xp("camera"),id:zp("camera"),x:hp,y:hp,z:hp,meta:Cp})),Pg=Gu({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:Yu("com.tldraw.camera",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),Ig=Nh("camera",{validator:_g,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,z:1,meta:{}}))),jg=jp(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),Eg=bp({type:jg,rotation:hp}),Tg=jp(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),Mg=new Set(["starting","paused","active","stopping"]),Ag=bp({id:dp,points:vp($p),size:up,color:Tg,opacity:hp,state:jp(Mg),delay:hp,shrink:hp,taper:yp}),Og=zp("page"),Dg=Ip("page",bp({typeName:xp("page"),id:Og,name:dp,index:Lp,meta:Cp})),Rg=Gu({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:Yu("com.tldraw.page",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),Lg=Nh("page",{validator:Dg,scope:"document"}).withDefaultProperties((()=>({meta:{}})));function zg(e){return Lg.isId(e)}const Fg={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},Ng=e=>e?Xd(e,(e=>Fg[e])):null;zp("instance");const $g=Yu("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),Bg=Gu({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:$g.AddTransparentExportBgs,up:e=>({...e,exportBackground:!0})},{id:$g.RemoveDialog,up:({dialog:e,...t})=>t},{id:$g.AddToolLockMode,up:e=>({...e,isToolLocked:!1})},{id:$g.RemoveExtraPropsForNextShape,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter((([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e))))})},{id:$g.AddLabelColor,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}})},{id:$g.AddFollowingUserId,up:e=>({...e,followingUserId:null})},{id:$g.RemoveAlignJustify,up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}}},{id:$g.AddZoom,up:e=>({...e,zoomBrush:null})},{id:$g.AddVerticalAlign,up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}})},{id:$g.AddScribbleDelay,up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e}},{id:$g.RemoveUserId,up:({userId:e,...t})=>t},{id:$g.AddIsPenModeAndIsGridMode,up:e=>({...e,isPenMode:!1,isGridMode:!1})},{id:$g.HoistOpacity,up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t})},{id:$g.AddChat,up:e=>({...e,chatMessage:"",isChatting:!1})},{id:$g.AddHighlightedUserIds,up:e=>({...e,highlightedUserIds:[]})},{id:$g.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}})},{id:$g.AddMeta,up:e=>({...e,meta:{}})},{id:$g.RemoveCursorColor,up:e=>{const{color:t,...n}=e.cursor;return{...e,cursor:n}}},{id:$g.AddLonelyProperties,up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:$g.ReadOnlyReadonly,up:({isReadOnly:e,...t})=>({...t,isReadonly:e})},{id:$g.AddHoveringCanvas,up:e=>({...e,isHoveringCanvas:null})},{id:$g.AddScribbles,up:({scribble:e,...t})=>({...t,scribbles:[]})},{id:$g.AddInset,up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},{id:$g.AddDuplicateProps,up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})},{id:$g.RemoveCanMoveCamera,up:({canMoveCamera:e,...t})=>({...t}),down:e=>({...e,canMoveCamera:!0})}]}),Ug="instance:instance",Kg=Ip("instance_page_state",bp({typeName:xp("instance_page_state"),id:zp("instance_page_state"),pageId:Og,selectedShapeIds:vp(Hp),hintingShapeIds:vp(Hp),erasingShapeIds:vp(Hp),hoveredShapeId:Hp.nullable(),editingShapeId:Hp.nullable(),croppingShapeId:Hp.nullable(),focusedGroupId:Hp.nullable(),meta:Cp})),Hg=Yu("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),Vg=Gu({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Hg.AddCroppingId,up(e){e.croppingShapeId=null}},{id:Hg.RemoveInstanceIdAndCameraId,up(e){delete e.instanceId,delete e.cameraId}},{id:Hg.AddMeta,up:e=>{e.meta={}}},{id:Hg.RenameProperties,up:e=>{},down:e=>{}},{id:Hg.RenamePropertiesAgain,up:e=>{e.selectedShapeIds=e.selectedIds,delete e.selectedIds,e.hintingShapeIds=e.hintingIds,delete e.hintingIds,e.erasingShapeIds=e.erasingIds,delete e.erasingIds,e.hoveredShapeId=e.hoveredId,delete e.hoveredId,e.editingShapeId=e.editingId,delete e.editingId,e.croppingShapeId=e.croppingShapeId??e.croppingId??null,delete e.croppingId,e.focusedGroupId=e.focusLayerId,delete e.focusLayerId},down:e=>{e.selectedIds=e.selectedShapeIds,delete e.selectedShapeIds,e.hintingIds=e.hintingShapeIds,delete e.hintingShapeIds,e.erasingIds=e.erasingShapeIds,delete e.erasingShapeIds,e.hoveredId=e.hoveredShapeId,delete e.hoveredShapeId,e.editingId=e.editingShapeId,delete e.editingShapeId,e.croppingId=e.croppingShapeId,delete e.croppingShapeId,e.focusLayerId=e.focusedGroupId,delete e.focusedGroupId}}]}),Wg=Nh("instance_page_state",{validator:Kg,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties((()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}))),Yg=Ip("pointer",bp({typeName:xp("pointer"),id:zp("pointer"),x:hp,y:hp,lastActivityTimestamp:hp,meta:Cp})),Gg=Gu({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:Yu("com.tldraw.pointer",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),Xg=Nh("pointer",{validator:Yg,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}}))),qg=Xg.createId("pointer"),Zg=Ip("instance_presence",bp({typeName:xp("instance_presence"),id:zp("instance_presence"),userId:dp,userName:dp,lastActivityTimestamp:hp,followingUserId:dp.nullable(),cursor:bp({x:hp,y:hp,type:jg,rotation:hp}),color:dp,camera:bp({x:hp,y:hp,z:hp}),screenBounds:Bp,selectedShapeIds:vp(zp("shape")),currentPageId:zp("page"),brush:Bp.nullable(),scribbles:vp(Ag),chatMessage:dp,meta:Cp})),Jg=Yu("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),Qg=Gu({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Jg.AddScribbleDelay,up:e=>{null!==e.scribble&&(e.scribble.delay=0)}},{id:Jg.RemoveInstanceId,up:e=>{delete e.instanceId}},{id:Jg.AddChatMessage,up:e=>{e.chatMessage=""}},{id:Jg.AddMeta,up:e=>{e.meta={}}},{id:Jg.RenameSelectedShapeIds,up:e=>{}}]}),ef=Nh("instance_presence",{validator:Zg,scope:"presence"}).withDefaultProperties((()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}))),tf=(e,t)=>n=>ju("instancePresence",(()=>{const i=n.get(Ug),s=n.get(Wg.createId(null==i?void 0:i.currentPageId)),r=n.get(Ig.createId(null==i?void 0:i.currentPageId)),o=n.get(qg),a=e.get();return s&&i&&r&&o&&a?ef.create({id:t??ef.createId(n.id),selectedShapeIds:s.selectedShapeIds,brush:i.brush,scribbles:i.scribbles,userId:a.id,userName:a.name,followingUserId:i.followingUserId,camera:{x:r.x,y:r.y,z:r.z},color:a.color,currentPageId:i.currentPageId,cursor:{x:o.x,y:o.y,rotation:i.cursor.rotation,type:i.cursor.type},lastActivityTimestamp:o.lastActivityTimestamp,screenBounds:i.screenBounds,chatMessage:i.chatMessage,meta:{}}):null})),nf=Ip("document",bp({typeName:xp("document"),id:xp("document:document"),gridSize:hp,name:dp,meta:Cp})),sf=Yu("com.tldraw.document",{AddName:1,AddMeta:2}),rf=Gu({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:sf.AddName,up:e=>{e.name=""},down:e=>{delete e.name}},{id:sf.AddMeta,up:e=>{e.meta={}}}]}),of=Nh("document",{validator:nf,scope:"document"}).withDefaultProperties((()=>({gridSize:10,name:"",meta:{}}))),af=of.createId("document");function lf(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function cf(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}const df=({error:e,phase:t,record:n,recordBefore:i})=>{throw Cd(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:i?cf(Rh(i)):void 0,recordAfter:cf(Rh(n))}}),e};function hf(e){const t=e.query.ids("page"),n=()=>{if(!e.has(af))return e.put([of.create({id:af,name:e.props.defaultName})]),n();if(!e.has(qg))return e.put([Xg.create({id:qg})]),n();const i=t.get();if(0===i.size)return e.put([Lg.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),n();const s=()=>[...i].map((t=>e.get(t))).sort(lf)[0].id,r=e.get(Ug);if(!r)return e.put([e.schema.types.instance.create({id:Ug,currentPageId:s(),exportBackground:!0})]),n();if(!i.has(r.currentPageId))return e.put([{...r,currentPageId:s()}]),n();const o=new Set,a=new Set;for(const t of i){const n=Wg.createId(t);e.has(n)||o.add(n);const i=Ig.createId(t);e.has(i)||a.add(i)}o.size>0&&e.put([...o].map((e=>Wg.create({id:e,pageId:Wg.parseId(e)})))),a.size>0&&e.put([...a].map((e=>Ig.create({id:e}))))};return n}const uf=Np("bookmark",bp({title:dp,description:dp,image:dp,favicon:dp,src:Rp.nullable()})),pf=Yu("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),gf=Gu({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:e=>"bookmark"===e.type,sequence:[{id:pf.MakeUrlsValid,up:e=>{Rp.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:pf.AddFavicon,up:e=>{Rp.isValid(e.props.favicon)||(e.props.favicon="")},down:e=>{delete e.props.favicon}}]}),ff=Np("image",bp({w:hp,h:hp,fileSize:hp,name:dp,isAnimated:yp,mimeType:dp.nullable(),src:Rp.nullable()})),mf=Yu("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4}),yf=Gu({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:e=>"image"===e.type,sequence:[{id:mf.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:mf.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:mf.MakeUrlsValid,up:e=>{Rp.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:mf.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}}]}),xf=Np("video",bp({w:hp,h:hp,fileSize:hp,name:dp,isAnimated:yp,mimeType:dp.nullable(),src:Rp.nullable()})),wf=Yu("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4}),vf=Gu({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:e=>"video"===e.type,sequence:[{id:wf.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:wf.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:wf.MakeUrlsValid,up:e=>{Rp.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:wf.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}}]}),bf=Ip("asset",Pp("type",{image:ff,video:xf,bookmark:uf})),Sf=Gu({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:Yu("com.tldraw.asset",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),kf=Nh("asset",{validator:bf,scope:"document"}).withDefaultProperties((()=>({meta:{}}))),Cf={w:pp,h:pp,assetId:Fp.nullable(),url:Op},_f=ng("bookmark",{NullAssetId:1,MakeUrlsValid:2}),Pf={sequence:[{id:_f.NullAssetId,up:e=>{void 0===e.assetId&&(e.assetId=null)},down:"retired"},{id:_f.MakeUrlsValid,up:e=>{Op.isValid(e.url)||(e.url="")},down:e=>{}}]},If=bp({type:Tp("free","straight"),points:vp($p)}),jf={color:cg,fill:ug,dash:hg,size:fg,segments:vp(If),isComplete:yp,isClosed:yp,isPen:yp,scale:pp},Ef=ng("draw",{AddInPen:1,AddScale:2}),Tf={sequence:[{id:Ef.AddInPen,up:e=>{const{points:t}=e.segments[0];if(0===t.length)return void(e.isPen=!1);let n=!(0===t[0].z||.5===t[0].z);t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),e.isPen=n},down:"retired"},{id:Ef.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]};var Mf={};const Af=/(^\/r\/[^/]+\/?$)/,Of=e=>{try{return new URL(e)}catch(t){return}},Df=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(Af))return e},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(Af))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:e=>{if(e.includes("/maps/")){const t=e.match(/@(.*),(.*),(.*)z/);let n;if(t){const[,i,s,r]=t;n=`https://${new URL(e).host.replace("www.","")}/maps/embed/v1/view?key=${Mf.NEXT_PUBLIC_GC_API_KEY}&center=${i},${s}&zoom=${r}`}else n="";return n}},fromEmbedUrl:e=>{const t=Of(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const e=t.searchParams.get("zoom"),[n,i]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${i},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=Of(e),n=t&&t.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Of(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=Of(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Of(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){const[e,n,i]=t;return`https://codepen.io/${n}/embed/${i}`}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){const[e,n,i]=t;return`https://codepen.io/${n}/pen/${i}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:e=>{const t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){const[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){const[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Of(e);if(!t)return;const n=t.hostname.replace(/^www./,"");if("youtu.be"===n){return`https://www.youtube.com/embed/${t.pathname.split("/").filter(Boolean)[0]}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){return`https://www.youtube.com/embed/${t.searchParams.get("v")}`}},fromEmbedUrl:e=>{const t=Of(e);if(!t)return;if("youtube.com"===t.hostname.replace(/^www./,"")){const e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{const t=Of(e),n=null==t?void 0:t.searchParams.get("cid");if((null==t?void 0:t.pathname.match(/\/calendar\/u\/0/))&&n){t.pathname="/calendar/embed";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{const t=Of(e),n=null==t?void 0:t.searchParams.get("src");if((null==t?void 0:t.pathname.match(/\/calendar\/embed/))&&n){t.pathname="/calendar/u/0";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{const t=Of(e);if((null==t?void 0:t.pathname.match(/^\/presentation/))&&(null==t?void 0:t.pathname.match(/\/pub\/?$/))){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}},fromEmbedUrl:e=>{const t=Of(e);if((null==t?void 0:t.pathname.match(/^\/presentation/))&&(null==t?void 0:t.pathname.match(/\/embed\/?$/))){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{const t=Of(e);if(t&&"player.vimeo.com"===t.hostname){const e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{const t=Of(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{const t=Of(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{const t=Of(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:e=>{const t=Of(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===t.search&&""===t.hash)return`${e}?embed`},fromEmbedUrl:e=>{const t=Of(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],Rf={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},Lf={w:pp,h:pp,url:dp},zf=ng("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),Ff={sequence:[{id:zf.GenOriginalUrlInEmbed,up:e=>{try{const n=e.url,i=new URL(n).host.replace("www.","");let s;for(const e of Df)if(e.hostnames.includes(i))try{s=e.fromEmbedUrl(n)}catch(t){console.warn(t)}e.tmpOldUrl=e.url,e.url=s??""}catch(n){e.url="",e.tmpOldUrl=e.url}},down:"retired"},{id:zf.RemoveDoesResize,up:e=>{delete e.doesResize},down:"retired"},{id:zf.RemoveTmpOldUrl,up:e=>{delete e.tmpOldUrl},down:"retired"},{id:zf.RemovePermissionOverrides,up:e=>{delete e.overridePermissions},down:"retired"}]},Nf={w:pp,h:pp,name:dp},$f={sequence:[]},Bf=Gp.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Uf=Gp.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Kf=Gp.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),Hf={geo:Kf,labelColor:dg,color:cg,fill:ug,dash:hg,size:fg,font:pg,align:Bf,verticalAlign:Uf,url:Op,w:pp,h:pp,growY:up,text:dp,scale:pp},Vf=ng("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),Wf={sequence:[{id:Vf.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Vf.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"},{id:Vf.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:Vf.AddCheckBox,up:e=>{},down:"retired"},{id:Vf.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:Vf.MigrateLegacyAlign,up:e=>{let t;switch(e.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}e.align=t},down:"retired"},{id:Vf.AddCloud,up:e=>{},down:"retired"},{id:Vf.MakeUrlsValid,up:e=>{Op.isValid(e.url)||(e.url="")},down:e=>{}},{id:Vf.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},Yf={},Gf={sequence:[]},Xf={color:cg,size:fg,segments:vp(If),isComplete:yp,isPen:yp,scale:pp},qf={sequence:[{id:ng("highlight",{AddScale:1}).AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},Zf=bp({topLeft:$p,bottomRight:$p}),Jf={w:pp,h:pp,playing:yp,url:Op,assetId:Fp.nullable(),crop:Zf.nullable()},Qf=ng("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3}),em={sequence:[{id:Qf.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Qf.AddCropProp,up:e=>{e.crop=null},down:e=>{delete e.crop}},{id:Qf.MakeUrlsValid,up:e=>{Op.isValid(e.url)||(e.url="")},down:e=>{}}]},tm=Gp.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),nm=bp({id:dp,index:Lp,x:hp,y:hp}),im={color:cg,dash:hg,size:fg,spline:tm,points:_p(dp,nm),scale:pp},sm=ng("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),rm={sequence:[{id:sm.AddSnapHandles,up:e=>{for(const t of Object.values(e.handles))t.canSnap=!0},down:"retired"},{id:sm.RemoveExtraHandleProps,up:e=>{e.handles=Gd(Object.values(e.handles).map((e=>[e.index,{x:e.x,y:e.y}])))},down:e=>{const t=Object.entries(e.handles).map((([e,t])=>({index:e,...t}))).sort(mh);e.handles=Object.fromEntries(t.map(((e,n)=>{const i=0===n?"start":n===t.length-1?"end":`handle:${e.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]})))}},{id:sm.HandlesToPoints,up:e=>{const t=Object.entries(e.handles).map((([e,{x:t,y:n}])=>({x:t,y:n,index:e}))).sort(mh);e.points=t.map((({x:e,y:t})=>({x:e,y:t}))),delete e.handles},down:e=>{const t=fh(e.points.length);e.handles=Object.fromEntries(e.points.map(((e,n)=>[t[n],{x:e.x,y:e.y}]))),delete e.points}},{id:sm.PointIndexIds,up:e=>{const t=fh(e.points.length);e.points=Object.fromEntries(e.points.map(((e,n)=>{const i=t[n];return[i,{id:i,index:i,x:e.x,y:e.y}]})))},down:e=>{const t=Object.values(e.points).sort(mh);e.points=t.map((({x:e,y:t})=>({x:e,y:t})))}},{id:sm.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},om={color:cg,size:fg,font:pg,fontSizeAdjustment:up,align:Bf,verticalAlign:Uf,growY:up,url:Op,text:dp,scale:pp},am=ng("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),lm={sequence:[{id:am.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:am.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:am.MigrateLegacyAlign,up:e=>{switch(e.align){case"start":return void(e.align="start-legacy");case"end":return void(e.align="end-legacy");default:return void(e.align="middle-legacy")}},down:"retired"},{id:am.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:am.MakeUrlsValid,up:e=>{Op.isValid(e.url)||(e.url="")},down:e=>{}},{id:am.AddFontSizeAdjustment,up:e=>{e.fontSizeAdjustment=0},down:e=>{delete e.fontSizeAdjustment}},{id:am.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},cm=Gp.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),dm={color:cg,size:fg,font:pg,textAlign:cm,w:pp,text:dp,scale:pp,autoSize:yp},hm=ng("text",{RemoveJustify:1,AddTextAlign:2}),um={sequence:[{id:hm.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:hm.AddTextAlign,up:e=>{e.textAlign=e.align,delete e.align},down:e=>{e.align=e.textAlign,delete e.textAlign}}]},pm={w:pp,h:pp,time:hp,playing:yp,url:Op,assetId:Fp.nullable()},gm=ng("video",{AddUrlProp:1,MakeUrlsValid:2}),fm={sequence:[{id:gm.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:gm.MakeUrlsValid,up:e=>{Op.isValid(e.url)||(e.url="")},down:e=>{}}]},mm=Yu("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),ym=Wu({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:mm.RemoveCodeAndIconShapeTypes,scope:"store",up:e=>{for(const[t,n]of Yd(e))"shape"!==n.typeName||"icon"!==n.type&&"code"!==n.type||delete e[t]}},{id:mm.AddInstancePresenceType,scope:"store",up(e){}},{id:mm.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:e=>{for(const[t,n]of Yd(e))n.typeName.match(/^(user|user_presence)$/)&&delete e[t]}},{id:mm.RemoveUserDocument,scope:"store",up:e=>{for(const[t,n]of Yd(e))n.typeName.match("user_document")&&delete e[t]}}]}),xm={arrow:{migrations:Sg,props:wg},bookmark:{migrations:Pf,props:Cf},draw:{migrations:Tf,props:jf},embed:{migrations:Ff,props:Lf},frame:{migrations:$f,props:Nf},geo:{migrations:Wf,props:Hf},group:{migrations:Gf,props:Yf},highlight:{migrations:qf,props:Xf},image:{migrations:em,props:Jf},line:{migrations:rm,props:im},note:{migrations:lm,props:om},text:{migrations:um,props:dm},video:{migrations:fm,props:pm}},wm={arrow:{migrations:Cg,props:kg}};function vm({shapes:e=xm,bindings:t=wm,migrations:n}={}){const i=new Map;for(const a of Wd(e))for(const e of tg(a.props??{}).keys()){if(i.has(e.id)&&i.get(e.id)!==e)throw new Error(`Multiple StyleProp instances with the same id: ${e.id}`);i.set(e.id,e)}const s=ig(e),r=Yp(t),o=function(e){const t={};for(const[n,i]of e)t[n]=Ep(i);return Nh("instance",{validator:Ip("instance",bp({typeName:xp("instance"),id:zp("instance"),currentPageId:Og,followingUserId:dp.nullable(),brush:Bp.nullable(),opacityForNextShape:Up,stylesForNextShape:bp(t),cursor:Eg,scribbles:vp(Ag),isFocusMode:yp,isDebugMode:yp,isToolLocked:yp,exportBackground:yp,screenBounds:Bp,insets:vp(yp),zoomBrush:Bp.nullable(),isPenMode:yp,isGridMode:yp,chatMessage:dp,isChatting:yp,highlightedUserIds:vp(dp),isFocused:yp,devicePixelRatio:hp,isCoarsePointer:yp,isHoveringCanvas:yp.nullable(),openMenus:vp(dp),isChangingStyle:yp,isReadonly:yp,meta:Cp,duplicateProps:bp({shapeIds:vp(zp("shape")),offset:bp({x:hp,y:hp})}).nullable()})),scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties((()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null})))}(i);return Qu.create({asset:kf,binding:r,camera:Ig,document:of,instance:o,instance_page_state:Wg,page:Lg,instance_presence:ef,pointer:Xg,shape:s},{migrations:[ym,Sf,Pg,rf,Bg,Vg,Rg,Qg,Gg,Zp,gf,yf,vf,...sg("shape",e),...sg("binding",t),...n??[]],onValidationFailure:df,createIntegrityChecker:hf})}const bm=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"CatalÃ "},{locale:"cs",label:"ÄeÅ¡tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"EspaÃ±ol"},{locale:"fr",label:"FranÃ§ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"PortuguÃªs - Brasil"},{locale:"pt-pt",label:"PortuguÃªs - Europeu"},{locale:"ro",label:"RomÃ¢nÄ"},{locale:"ru",label:"Russian"},{locale:"sl",label:"SlovenÅ¡Äina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiáº¿ng Viá»t"},{locale:"tr",label:"TÃ¼rkÃ§e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"×¢××¨××ª"},{locale:"ar",label:"Ø¹Ø±Ø¨Ù"},{locale:"fa",label:"ÙØ§Ø±Ø³Û"},{locale:"ku",label:"Ú©ÙØ±Ø¯Û"},{locale:"ne",label:"à¤¨à¥à¤ªà¤¾à¤²à¥"},{locale:"hi-in",label:"à¤¹à¤¿à¤¨à¥à¤¦à¥"},{locale:"te",label:"à°¤à±à°²à±à°à±"},{locale:"th",label:"à¸ à¸²à¸©à¸²à¹à¸à¸¢"},{locale:"my",label:"áá¼ááºáá¬áá¬"},{locale:"ko-kr",label:"íêµ­ì´"},{locale:"ja",label:"æ¥æ¬èª"},{locale:"zh-cn",label:"ç®ä½ä¸­æ"},{locale:"zh-tw",label:"ç¹é«ä¸­æ (å°ç£)"}];const Sm={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function km(e){const t=bm.find((t=>t.locale===e.toLowerCase()));if(t)return t.locale;const[n,i]=e.split(/[-_]/).map((e=>e.toLowerCase()));if(i){const e=bm.find((e=>e.locale===n));if(e)return e.locale}return n in Sm?Sm[n]:null}const Cm={error:null};class _m extends C.Component{constructor(){super(...arguments),b(this,"state",Cm)}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){var t,n;null==(n=(t=this.props).onError)||n.call(t,e)}render(){const{error:e}=this.state;if(null!==e){const{fallback:t}=this.props;return k.jsx(t,{error:e})}return this.props.children}}function Pm({children:e,fallback:t,...n}){return null===t?k.jsx(k.Fragment,{children:e}):k.jsx(_m,{fallback:t,...n,children:e})}const Im=P.createContext(null);function jm(){const e=P.useContext(Im);if(!e)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return e}function Em(){return k.jsx("div",{className:"tl-background"})}function Tm(e,t,n,i,s,r){C.useLayoutEffect((()=>{const o=e.current;if(!o)return;if(void 0===t)return;let a=`translate(${t}px, ${n}px)`;void 0!==i&&(a+=` scale(${i})`),void 0!==s&&(a+=` rotate(${s}rad)`),r&&(a+=` translate(${r.x}px, ${r.y}px)`),o.style.transform=a}))}const Mm={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};class Am{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;const{x:t,y:n}=this,i=Math.sin(e),s=Math.cos(e);return this.x=t*s-n*i,this.y=t*i+n*s,this}rotWith(e,t){if(0===t)return this;const n=this.x-e.x,i=this.y-e.y,s=Math.sin(t),r=Math.cos(t);return this.x=e.x+(n*r-i*s),this.y=e.y+(n*s+i*r),this}clone(){const{x:e,y:t,z:n}=this;return new Am(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const n=Am.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Am.Dpr(this,e)}cpr(e){return Am.Cpr(this,e)}len2(){return Am.Len2(this)}len(){return Am.Len(this)}pry(e){return Am.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return Am.Uni(this)}tan(e){return Am.Tan(this,e)}dist(e){return Am.Dist(this,e)}distanceToLineSegment(e,t){return Am.DistanceToLineSegment(e,t,this)}slope(e){return Am.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Am.Angle(this,e)}toAngle(){return Am.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Am.Equals(this,e)}equalsXY(e,t){return Am.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return Am.ToFixed(this)}toString(){return Am.ToString(Am.ToFixed(this))}toJson(){return Am.ToJson(this)}toArray(){return Am.ToArray(this)}static Add(e,t){return new Am(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new Am(e.x+t,e.y+n)}static Sub(e,t){return new Am(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new Am(e.x-t,e.y-n)}static AddScalar(e,t){return new Am(e.x+t,e.y+t)}static SubScalar(e,t){return new Am(e.x-t,e.y-t)}static Div(e,t){return new Am(e.x/t,e.y/t)}static Mul(e,t){return new Am(e.x*t,e.y*t)}static DivV(e,t){return new Am(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Am(e.x*t.x,e.y*t.y)}static Neg(e){return new Am(-e.x,-e.y)}static Per(e){return new Am(e.y,-e.x)}static Abs(e){return new Am(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Am(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return Am.Dpr(e,t)/Am.Len(t)}static Uni(e){return Am.Div(e,Am.Len(e))}static Tan(e,t){return Am.Uni(Am.Sub(e,t))}static Min(e,t){return new Am(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Am(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new Am(e,t,n)}static FromArray(e){return new Am(e[0],e[1])}static Rot(e,t=0){const n=Math.sin(t),i=Math.cos(t);return new Am(e.x*i-e.y*n,e.x*n+e.y*i)}static RotWith(e,t,n){const i=e.x-t.x,s=e.y-t.y,r=Math.sin(n),o=Math.cos(n);return new Am(t.x+(i*o-s*r),t.y+(i*r+s*o))}static NearestPointOnLineThroughPoint(e,t,n){return Am.Mul(t,Am.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,i=!0){if(Am.Equals(e,n))return Am.From(n);if(Am.Equals(t,n))return Am.From(n);const s=Am.Tan(t,e),r=Am.Add(e,Am.Mul(s,Am.Sub(n,e).pry(s)));if(i){if(r.x<Math.min(e.x,t.x))return Am.Cast(e.x<t.x?e:t);if(r.x>Math.max(e.x,t.x))return Am.Cast(e.x>t.x?e:t);if(r.y<Math.min(e.y,t.y))return Am.Cast(e.y<t.y?e:t);if(r.y>Math.max(e.y,t.y))return Am.Cast(e.y>t.y?e:t)}return r}static DistanceToLineThroughPoint(e,t,n){return Am.Dist(n,Am.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,i=!0){return Am.Dist(n,Am.NearestPointOnLineSegment(e,t,n,i))}static Snap(e,t=1){return new Am(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Am?e:Am.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return Am.Sub(t,e).mul(n).add(e)}static Med(e,t){return new Am((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){const n=Am.Len(e);return new Am(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return Am.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new Am(sy(e.x),sy(e.y))}static ToInt(e){return new Am(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,n){return Am.Add(e,Am.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new Am(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:n,z:i}=e;return{x:t,y:n,z:i}}static Average(e){const t=e.length,n=new Am(0,0);if(0===t)return n;for(let i=0;i<t;i++)n.add(e[i]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new Am(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Am(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){const i=[];for(let s=0;s<n;s++){const r=Mm.easeInQuad(s/(n-1)),o=Am.Lrp(e,t,r);o.z=Math.min(1,.5+.65*Math.abs(.5-Om(r))),i.push(o)}return i}static SnapToGrid(e,t=8){return new Am(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const Om=e=>e<.5?2*e*e:(4-2*e)*e-1;function Dm(e){return`${iy(e.x)},${iy(e.y)} `}function Rm(e,t){return`${iy((e.x+t.x)/2)},${iy((e.y+t.y)/2)} `}const Lm=Math.PI,zm=Lm/2,Fm=2*Lm,Nm=Math.sin;function $m(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function Bm(e,t=1e10){return e?Math.round(e*t)/t:0}function Um(e,t,n=1e-6){return Math.abs(e-t)<=n}function Km(e,t){const n=Math.pow(e-t,2)/Math.pow(e+t,2);return Lm*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function Hm(e){return(e%=Fm)<0?e+=Fm:0===e&&(e=0),e}function Vm(e,t){return(e=Hm(e))>(t=Hm(t))&&(t+=Fm),t-e}function Wm(e,t){return Fm-Vm(e,t)}function Ym(e,t){const n=(t-e)%Fm;return 2*n%Fm-n}function Gm(e){return(Fm+e)%Fm}function Xm(e,t){const n=Fm/t;let i=Math.floor((Gm(e)+n/2)/n)*n%Fm;return i<Lm&&(i+=Fm),i>Lm&&(i-=Fm),i}function qm(e,t){return e===t||Um(e%(Math.PI/2)-t%(Math.PI/2),0)}function Zm(e,t,n){return new Am(e.x,e.y).add(Am.FromAngle(n,t))}function Jm(e,t,n){const i=e/2,s=t/2,r=[];let o=1/0,a=-1/0,l=1/0,c=-1/0;for(let u=0;u<n;u++){const e=u*(Fm/n)-zm,t=i+i*Math.cos(e),d=s+s*Math.sin(e);t<o&&(o=t),d<l&&(l=d),t>a&&(a=t),d>c&&(c=d),r.push(new Am(t,d))}const d=a-o,h=c-l;if(0!==e-d||0!==t-h)for(let u=0;u<r.length;u++){const n=r[u];n.x=(n.x-o)/d*e,n.y=(n.y-l)/h*t}return r}function Qm(e,t,n,i){return e<i&&n<t}function ey(e,t,n,i){const s=Math.max(e,n),r=Math.min(t,i);return s<=r?[s,r]:null}function ty(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function ny(e,t){let n,i,s=0;for(let r=0;r<t.length;r++){if(n=t[r],n.x===e.x&&n.y===e.y)return!0;if(i=t[(r+1)%t.length],Am.Dist(e,n)+Am.Dist(e,i)===Am.Dist(n,i))return!0;n.y<=e.y?i.y>e.y&&ty(n,i,e)>0&&(s+=1):i.y<=e.y&&ty(n,i,e)<0&&(s-=1)}return 0!==s}function iy(e){return Math.round(1e4*e)/1e4}function sy(e){return Math.round(100*e)/100}const ry=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function oy(e,t,n){return n<0?Vm(e,t):Wm(e,t)}function ay(e,t,n,i){let s;if(Math.abs(e)>Lm){s=Ym(t,i);const r=Ym(i,n);return Math.abs(s)<Math.abs(r)?s/e:(e-r)/e}{s=Ym(t,i);const n=s/e;return Math.sign(s)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function ly(e,t,n){const i=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y);return new Am(((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/i,((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/i)}function cy(e,t,n,i,s){if(null===n)return[Am.From(e),Am.From(t)];const r=[],o=Am.Angle(n,e),a=Vm(o,Am.Angle(n,t));for(let l=0;l<s;l++){const e=Zm(n,i,o+a*(l/(s-1)));r.push(e)}return r}const dy=({brush:e,color:t,opacity:n,className:i})=>{const s=C.useRef(null);Tm(s,e.x,e.y);const r=iy(Math.max(1,e.w)),o=iy(Math.max(1,e.h));return k.jsx("svg",{className:"tl-overlays__item",ref:s,children:t?k.jsxs("g",{className:"tl-brush",opacity:n,children:[k.jsx("rect",{width:r,height:o,fill:t,opacity:.75}),k.jsx("rect",{width:r,height:o,fill:"none",stroke:t,opacity:.1})]}):k.jsx("rect",{className:`tl-brush tl-brush__default ${i}`,width:r,height:o})})},hy={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},uy={onResolveAsset:async e=>(null==e?void 0:e.props.src)||""},py={duration:0,easing:Mm.easeInOutCubic},gy=-10,fy=["top","right","bottom","left"],my=2;var yy={};const xy={},wy=by("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),vy={logPreventDefaults:by("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:by("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:by("logElementRemoves",{defaults:{all:!1}}),debugSvg:by("debugSvg",{defaults:{all:!1}}),showFps:by("showFps",{defaults:{all:!1}}),measurePerformance:by("measurePerformance",{defaults:{all:!1}}),throwToBlob:by("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:by("reconnectOnPing",{defaults:{all:!1}}),debugCursors:by("debugCursors",{defaults:{all:!1}}),forceSrgb:by("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:by("debugGeometry",{defaults:{all:!1}}),hideShapes:by("hideShapes",{defaults:{all:!1}}),editOnType:by("editOnType",{defaults:{all:!1}})};if("undefined"!=typeof Element){const e=Element.prototype.removeChild;cu("element removal logging",(()=>{vy.logElementRemoves.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e}))}function by(e,{defaults:t,shouldStoreForSession:n=!0}){return function(e){const t=function(e){switch(Sy((()=>yy.TLDRAW_ENV))??Sy((()=>yy.VERCEL_PUBLIC_TLDRAW_ENV))??Sy((()=>yy.NEXT_PUBLIC_TLDRAW_ENV))??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{return JSON.parse(vh(`tldraw_debug:${e}`)??"null")}catch(t){return null}}(e.name):null,i=xu(`debug:${e.name}`,n??t);"undefined"!=typeof window&&(e.shouldStoreForSession&&cu(`debug:${e.name}`,(()=>{const n=i.get();n===t?Sh(`tldraw_debug:${e.name}`):bh(`tldraw_debug:${e.name}`,JSON.stringify(n))})),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,(e=>e.toUpperCase()))}`,{get:()=>i.get(),set(e){i.set(e)},configurable:!0}));return Object.assign(i,e)}({name:e,defaults:t,shouldStoreForSession:n})}function Sy(e){try{return e()}catch{return null}}function ky(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return ky(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Cy(e){e.preventDefault(),vy.logPreventDefaults.get()&&console.warn("preventDefault called on event:",e)}function _y(e,t){if(e.setPointerCapture(t.pointerId),vy.logPointerCaptures.get()){const n=wy.get();n.set(e,(n.get(e)??0)+1),console.warn("setPointerCapture called on element:",e,t)}}function Py(e,t){if(e.hasPointerCapture(t.pointerId)&&(e.releasePointerCapture(t.pointerId),vy.logPointerCaptures.get())){const n=wy.get();1===n.get(e)?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",e,t)}}const Iy=e=>e.stopPropagation(),jy=(e,t,n)=>{e&&e.style.setProperty(t,n)};function Ey(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}const Ty=C.createContext(null);function My({container:e,children:t}){return k.jsx(Ty.Provider,{value:e,children:t})}function Ay(){return bd(C.useContext(Ty),"useContainer used outside of <Tldraw />")}const Oy=["input","select","button","textarea"];function Dy(){const{activeElement:e}=document;return!(!e||!(e.getAttribute("contenteditable")||Oy.indexOf(e.tagName.toLowerCase())>-1))}const Ry=["textarea","input"];const Ly={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function zy(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function Fy(e,t,n,i=.15){return 0===i?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-zy(t-e,n-t,i)+t:e>n?+zy(e-n,n-t,i)+n:e}function Ny(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function $y(e,t,n){return(t=Ny(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function By(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Uy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?By(Object(n),!0).forEach((function(t){$y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):By(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Ky={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Hy(e){return e?e[0].toUpperCase()+e.slice(1):""}const Vy=["enter","leave"];function Wy(e,t="",n=!1){const i=Ky[e],s=i&&i[t]||t;return"on"+Hy(e)+Hy(s)+(function(e=!1,t){return e&&!Vy.includes(t)}(n,s)?"Capture":"")}const Yy=["gotpointercapture","lostpointercapture"];function Gy(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const i=Yy.includes(t)?"capturecapture":"capture",s=!!~t.indexOf(i);return s&&(t=t.replace("capture","")),{device:t,capture:s,passive:n}}function Xy(e){return"touches"in e}function qy(e,t){try{const n=t.clientX-e.clientX,i=t.clientY-e.clientY,s=(t.clientX+e.clientX)/2,r=(t.clientY+e.clientY)/2,o=Math.hypot(n,i),a=-180*Math.atan2(n,i)/Math.PI;return{angle:a,distance:o,origin:[s,r]}}catch(n){}return null}function Zy(e){return function(e){return Array.from(e.touches).filter((t=>{var n,i;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(i=n.contains)||void 0===i?void 0:i.call(n,t.target))}))}(e).map((e=>e.identifier))}function Jy(e,t){const[n,i]=Array.from(e.touches).filter((e=>t.includes(e.identifier)));return qy(n,i)}function Qy(e){let{deltaX:t,deltaY:n,deltaMode:i}=e;return 1===i?(t*=40,n*=40):2===i&&(t*=800,n*=800),[t,n]}function ex(e,...t){return"function"==typeof e?e(...t):e}function tx(){}function nx(...e){return 0===e.length?tx:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function ix(e,t){return Object.assign({},t,e||{})}class sx{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:i}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?ex(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:i,metaKey:s,ctrlKey:r}=e;Object.assign(t,{shiftKey:n,altKey:i,metaKey:s,ctrlKey:r})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);Ly.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[r,o]=t._movement,[a,l]=n.threshold,{_step:c,values:d}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(r)>=a&&d[0]),!1===c[1]&&(c[1]=Math.abs(o)>=l&&d[1])):(!1===c[0]&&(c[0]=Math.abs(r)>=a&&Math.sign(r)*a),!1===c[1]&&(c[1]=Math.abs(o)>=l&&Math.sign(o)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[e,t]=d;h[0]=!1!==c[0]?e-c[0]:0,h[1]=!1!==c[1]?t-c[1]:0}else h[0]=!1!==c[0]?r-c[0]:0,h[1]=!1!==c[1]?o-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const u=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=ex(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[g,f]=t.offset,[[m,y],[x,w]]=t._bounds;t.overflow=[g<m?-1:g>y?1:0,f<x?-1:f>w?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const v=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[i,s]){const[[r,o],[a,l]]=e;return[Fy(t,r,o,i),Fy(n,a,l,s)]}(t._bounds,t.offset,v),t.delta=Ly.sub(t.offset,u),this.computeMovement(),p&&(!t.last||s>32)){t.delta=Ly.sub(t.offset,u);const e=t.delta.map(Math.abs);Ly.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[e[0]/s,e[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const i=this.handler(Uy(Uy(Uy({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class rx extends sx{constructor(...e){super(...e),$y(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Ly.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Ly.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const i="object"==typeof n.axisThreshold?n.axisThreshold[function(e){return Xy(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}(e)]:n.axisThreshold;t.axis=function([e,t],n){const i=Math.abs(e),s=Math.abs(t);return i>s&&i>n?"x":s>i&&s>n?"y":void 0}(t._movement,i)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const ox=e=>e,ax={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>Uy(Uy({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return Ly.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?Ly.toVector(e):void 0,transform(e,t,n){const i=e||n.shared.transform;return this.hasCustomTransform=!!i,i||ox},threshold:e=>Ly.toVector(e,0)},lx=Uy(Uy({},ax),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"==typeof e)return t=>lx.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:i=-1/0,bottom:s=1/0}=e;return[[t,n],[i,s]]}}),cx="undefined"!=typeof window&&window.document&&window.document.createElement;function dx(){return cx&&"ontouchstart"in window}const hx={isBrowser:cx,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:dx(),touchscreen:dx()||cx&&window.navigator.maxTouchPoints>1,pointer:cx&&"onpointerdown"in window,pointerLock:cx&&"exitPointerLock"in window.document},ux={mouse:0,touch:0,pen:8};function px(e){const[t,n]=e.overflow,[i,s]=e._delta,[r,o]=e._direction;(t<0&&i>0&&r<0||t>0&&i<0&&r>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&s>0&&o<0||n>0&&s<0&&o>0)&&(e._movement[1]=e._movementBound[1])}Uy(Uy({},lx),{},{device(e,t,{pointer:{touch:n=!1,lock:i=!1,mouse:s=!1}={}}){return this.pointerLock=i&&hx.pointerLock,hx.touch&&n?"touch":this.pointerLock?"mouse":hx.pointer&&!s?"pointer":hx.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,hx.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:i=1,keys:s=!0}={}}){return this.pointerButtons=i,this.keys=s,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:i=3,axis:s}){const r=Ly.toVector(e,n?i:s?1:0);return this.filterTaps=n,this.tapsThreshold=i,r},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(Ly.toVector(e)),distance:this.transform(Ly.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?Uy(Uy({},ux),e):ux,keyboardDisplacement:(e=10)=>e});const gx=Uy(Uy({},ax),{},{device(e,t,{shared:n,pointer:{touch:i=!1}={}}){if(n.target&&!hx.touch&&hx.gesture)return"gesture";if(hx.touch&&i)return"touch";if(hx.touchscreen){if(hx.pointer)return"pointer";if(hx.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:i={}}){const s=e=>{const t=ix(ex(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},r=e=>{const t=ix(ex(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof i?[s(),r()]:e=>[s(e),r(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;return Ly.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});Uy(Uy({},lx),{},{mouseOnly:(e=!0)=>e});const fx=lx;Uy(Uy({},lx),{},{mouseOnly:(e=!0)=>e});const mx=new Map,yx=new Map;function xx(e){mx.set(e.key,e.engine),yx.set(e.key,e.resolver)}const wx={key:"pinch",engine:class extends sx{constructor(...e){super(...e),$y(this,"ingKey","pinching"),$y(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;this.state.offset="wheel"===e?Ly.add(t,n):[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const i=30*Math.abs(t)-Math.abs(n);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout((()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()}),0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every((e=>n.has(e))))return;if(n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const i=Jy(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every((e=>i.has(e))))return;if(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const s=qy(...Array.from(n.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=Jy(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=qy(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,i=n._values[1],s=t.angle-i;let r=0;Math.abs(s)>270&&(r+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*r]),n.origin=t.origin,n.turns=r,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((e=>!this.ctrl.touchIds.has(e)))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(n){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Ly.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find((t=>e[t])):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-Qy(e)[1]/100*t.offset[0],0],Ly.addTo(t._movement,t._delta),px(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:gx},vx={key:"wheel",engine:class extends rx{constructor(...e){super(...e),$y(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=Qy(e),Ly.addTo(t._movement,t._delta),px(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:fx};function bx(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}const Sx={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(hx.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},kx=["target","eventOptions","window","enabled","transform"];function Cx(e={},t){const n={};for(const[i,s]of Object.entries(t))switch(typeof s){case"function":n[i]=s.call(n,e[i],i,e);break;case"object":n[i]=Cx(e[i],s);break;case"boolean":s&&(n[i]=e[i])}return n}class _x{constructor(e,t){$y(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,i,s){const r=this._listeners,o=function(e,t=""){const n=Ky[e];return e+(n&&n[t]||t)}(t,n),a=Uy(Uy({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),s);e.addEventListener(o,i,a);const l=()=>{e.removeEventListener(o,i,a),r.delete(l)};return r.add(l),l}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class Px{constructor(){$y(this,"_timeouts",new Map)}add(e,t,n=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class Ix{constructor(e){$y(this,"gestures",new Set),$y(this,"_targetEventStore",new _x(this)),$y(this,"gestureEventStores",{}),$y(this,"gestureTimeoutStores",{}),$y(this,"handlers",{}),$y(this,"config",{}),$y(this,"pointerIds",new Set),$y(this,"touchIds",new Set),$y(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&jx(e,"drag");t.wheel&&jx(e,"wheel");t.scroll&&jx(e,"scroll");t.move&&jx(e,"move");t.pinch&&jx(e,"pinch");t.hover&&jx(e,"hover")}(this,e)}setEventIds(e){return Xy(e)?(this.touchIds=new Set(Zy(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){const i=e,{target:s,eventOptions:r,window:o,enabled:a,transform:l}=i,c=bx(i,kx);if(n.shared=Cx({target:s,eventOptions:r,window:o,enabled:a,transform:l},Sx),t){const e=yx.get(t);n[t]=Cx(Uy({shared:n.shared},c),e)}else for(const d in c){const e=yx.get(d);e&&(n[d]=Cx(Uy({shared:n.shared},c[d]),e))}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let i;if(!t.target||(i=t.target(),i)){if(t.enabled){for(const t of this.gestures){const s=this.config[t],r=Ex(n,s.eventOptions,!!i);if(s.enabled){new(mx.get(t))(this,e,t).bind(r)}}const s=Ex(n,t.eventOptions,!!i);for(const t in this.nativeHandlers)s(t,"",(n=>this.nativeHandlers[t](Uy(Uy({},this.state.shared),{},{event:n,args:e}))),void 0,!0)}for(const e in n)n[e]=nx(...n[e]);if(!i)return n;for(const e in n){const{device:t,capture:s,passive:r}=Gy(e);this._targetEventStore.add(i,t,"",n[e],{capture:s,passive:r})}}}}function jx(e,t){e.gestures.add(t),e.gestureEventStores[t]=new _x(e,t),e.gestureTimeoutStores[t]=new Px}const Ex=(e,t,n)=>(i,s,r,o={},a=!1)=>{var l,c;const d=null!==(l=o.capture)&&void 0!==l?l:t.capture,h=null!==(c=o.passive)&&void 0!==c?c:t.passive;let u=a?i:Wy(i,s,d);n&&h&&(u+="Passive"),e[u]=e[u]||[],e[u].push(r)},Tx=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Mx(e,t,n,i,s,r){if(!e.has(n))return;if(!mx.has(i))return;const o=n+"Start",a=n+"End";s[i]=e=>{let i;return e.first&&o in t&&t[o](e),n in t&&(i=t[n](e)),e.last&&a in t&&t[a](e),i},r[i]=r[i]||{}}function Ax(e,t){const[n,i,s]=function(e){const t={},n={},i=new Set;for(let s in e)Tx.test(s)?(i.add(RegExp.lastMatch),n[s]=e[s]):t[s]=e[s];return[n,t,i]}(e),r={};return Mx(s,n,"onDrag","drag",r,t),Mx(s,n,"onWheel","wheel",r,t),Mx(s,n,"onScroll","scroll",r,t),Mx(s,n,"onPinch","pinch",r,t),Mx(s,n,"onMove","move",r,t),Mx(s,n,"onHover","hover",r,t),{handlers:r,config:t,nativeHandlers:i}}const Ox=10,Dx=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function Rx(e){let{deltaY:t,deltaX:n}=e,i=0;return e.ctrlKey||e.altKey||e.metaKey?i=(Math.abs(t)>Ox?Ox*Math.sign(t):t)/100:e.shiftKey&&!Dx&&(n=t,t=0),{x:-n,y:-t,z:-i}}const Lx=([vx,wx].forEach(xx),function(e,t){const{handlers:n,nativeHandlers:i,config:s}=Ax(e,t||{});return function(e,t={},n,i){const s=P.useMemo((()=>new Ix(e)),[]);if(s.applyHandlers(e,i),s.applyConfig(t,n),P.useEffect(s.effect.bind(s)),P.useEffect((()=>s.clean.bind(s)),[]),void 0===t.target)return s.bind.bind(s)}(n,s,void 0,i)});let zx;const Fx=e=>void 0===zx?(zx=e,!1):e-zx>120&&e-zx<160?(zx=e,!0):(zx=e,!1);function Nx(e){const t=jm(),n=C.useMemo((()=>{let n="not sure";let i=1,s=1,r=1,o=0;const a=new Am,l=new Am;return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused)return;if(n="not sure",Fx(Date.now()))return;const i=t.getEditingShapeId();if(i){const e=t.getShape(i);if(e){if(t.getShapeUtil(e).canScroll(e)){const e=t.getShapePageBounds(i);if(null==e?void 0:e.containsPoint(t.inputs.currentPagePoint))return}}}Cy(e),Iy(e);const s=Rx(e);if(0===s.x&&0===s.y)return;const r={type:"wheel",name:"wheel",delta:s,point:new Am(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(r)},onPinchStart:r=>{const o=e.current;n="not sure";const{event:c,origin:d,da:h}=r;c instanceof WheelEvent||(c.target===o||(null==o?void 0:o.contains(c.target)))&&(l.x=d[0],l.y=d[1],a.x=d[0],a.y=d[1],i=h[0],s=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:d[0],y:d[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey}))},onPinchEnd:i=>{const s=e.current,{event:r,origin:o,offset:a}=i;if(r instanceof WheelEvent)return;if(r.target!==s&&!(null==s?void 0:s.contains(r.target)))return;const l=a[0];n="not sure",t.timers.requestAnimationFrame((()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:o[0],y:o[1],z:l},delta:{x:o[0],y:o[1]},shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey})}))},onPinch:c=>{const d=e.current,{event:h,origin:u,offset:p,da:g}=c;if(h instanceof WheelEvent)return;if(h.target!==d&&!(null==d?void 0:d.contains(h.target)))return;const f="gesturechange"===c.type||"gestureend"===c.type;o=g[0];const m=u[0]-l.x,y=u[1]-l.y;switch(l.x=u[0],l.y=u[1],(e=>{if(e&&(n="zooming"),"zooming"===n)return;const t=Math.abs(o-i),s=Am.Dist(a,l);switch(n){case"not sure":t>24?n="zooming":s>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}})(f),n){case"zooming":r=p[0],t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:r},delta:{x:m,y:y},shiftKey:h.shiftKey,altKey:h.altKey,ctrlKey:h.metaKey||h.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:s},delta:{x:m,y:y},shiftKey:h.shiftKey,altKey:h.altKey,ctrlKey:h.metaKey||h.ctrlKey})}}}}),[t,e]);Lx(n,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}function $x(e,t,n){const i=e.getShape(t);return{shape:i,handle:e.getShapeHandles(i).find((e=>e.id===n))}}const Bx=class e{constructor(e=0,t=0,n=0,i=0){b(this,"x",0),b(this,"y",0),b(this,"w",0),b(this,"h",0),this.x=e,this.y=t,this.w=n,this.h=i}get point(){return new Am(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new Am(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new Am(this.minX,this.minY),new Am(this.maxX,this.minY),new Am(this.maxX,this.maxY),new Am(this.minX,this.maxY)]}get cornersAndCenter(){return[new Am(this.minX,this.minY),new Am(this.maxX,this.minY),new Am(this.maxX,this.maxY),new Am(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new Am(this.w,this.h)}toFixed(){return this.x=Bm(this.x),this.y=Bm(this.y),this.w=Bm(this.w),this.h=Bm(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,i=0){return this.x=e,this.y=t,this.w=n,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=i-t,this.h=s-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:t,y:n,w:i,h:s}=this;return new e(t,n,i,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,s=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,i-t),this.height=Math.max(1,s-n)}collides(t){return e.Collides(this,t)}contains(t){return e.Contains(this,t)}includes(t){return e.Includes(this,t)}containsPoint(t,n=0){return e.ContainsPoint(this,t,n)}getHandlePoint(e){switch(e){case"top_left":return new Am(this.minX,this.minY);case"top_right":return new Am(this.maxX,this.minY);case"bottom_left":return new Am(this.minX,this.maxY);case"bottom_right":return new Am(this.maxX,this.maxY);case"top":return new Am(this.midX,this.minY);case"right":return new Am(this.maxX,this.midY);case"bottom":return new Am(this.midX,this.maxY);case"left":return new Am(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){const{minX:i,minY:s,maxX:r,maxY:o}=this;let{minX:a,minY:l,maxX:c,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":d+=n}if((c-a)/(r-i)<0){const e=c;c=a,a=e}if((d-l)/(o-s)<0){const e=d;d=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(c-a),this.height=Math.abs(d-l)}union(e){const t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),s=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=i-t,this.height=s-n,this}static From(t){return new e(t.x,t.y,t.w,t.h)}static FromCenter(t,n){return new e(t.x-n.x/2,t.y-n.y/2,n.x,n.y)}static FromPoints(t){if(0===t.length)return new e;let n,i=1/0,s=1/0,r=-1/0,o=-1/0;for(let e=0,a=t.length;e<a;e++)n=t[e],i=Math.min(n.x,i),s=Math.min(n.y,s),r=Math.max(n.x,r),o=Math.max(n.y,o);return new e(i,s,r-i,o-s)}static Expand(t,n){const i=Math.min(n.minX,t.minX),s=Math.min(n.minY,t.minY),r=Math.max(n.maxX,t.maxX),o=Math.max(n.maxY,t.maxY);return new e(i,s,r-i,o-s)}static ExpandBy(t,n){return new e(t.minX-n,t.minY-n,t.width+2*n,t.height+2*n)}static Resize(t,n,i,s,r=!1){const{minX:o,minY:a,maxX:l,maxY:c}=t;let{minX:d,minY:h,maxX:u,maxY:p}=t;switch(n){case"left":case"top_left":case"bottom_left":d+=i;break;case"right":case"top_right":case"bottom_right":u+=i}switch(n){case"top":case"top_left":case"top_right":h+=s;break;case"bottom":case"bottom_left":case"bottom_right":p+=s}const g=(u-d)/(l-o),f=(p-h)/(c-a),m=g<0,y=f<0;if(r){const e=(l-o)/(c-a),t=Math.abs(u-d),i=Math.abs(p-h),s=t*(f<0?1:-1)*(1/e),r=i*(g<0?1:-1)*e,m=e<t/i;switch(n){case"top_left":m?h=p+s:d=u+r;break;case"top_right":m?h=p+s:u=d-r;break;case"bottom_right":m?p=h-s:u=d-r;break;case"bottom_left":m?p=h-s:d=u+r;break;case"bottom":case"top":{const t=(d+u)/2,n=i*e;d=t-n/2,u=t+n/2;break}case"left":case"right":{const n=(h+p)/2,i=t/e;h=n-i/2,p=n+i/2;break}}}if(m){const e=u;u=d,d=e}if(y){const e=p;p=h,h=e}const x=new e(d,h,Math.abs(u-d),Math.abs(p-h));return{box:x,scaleX:+(x.width/t.width*(g>0?1:-1)).toFixed(5),scaleY:+(x.height/t.height*(f>0?1:-1)).toFixed(5)}}equals(t){return e.Equals(this,t)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(t){return new e(t.x,t.y,Math.max(1,t.w),Math.max(1,t.h))}};b(Bx,"Collides",((e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY))),b(Bx,"Contains",((e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX)),b(Bx,"Includes",((e,t)=>Bx.Collides(e,t)||Bx.Contains(e,t))),b(Bx,"ContainsPoint",((e,t,n=0)=>!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n))),b(Bx,"Common",(e=>{let t=1/0,n=1/0,i=-1/0,s=-1/0;for(let r=0;r<e.length;r++){const o=e[r];t=Math.min(t,o.minX),n=Math.min(n,o.minY),i=Math.max(i,o.maxX),s=Math.max(s,o.maxY)}return new Bx(t,n,i-t,s-n)})),b(Bx,"Sides",((e,t=0)=>{const{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]}));let Ux=Bx;
/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */
const Kx=e=>{let t=e.parentElement;for(;t;){if(t===document.body)return document;const{overflowY:e}=window.getComputedStyle(t);if(t.scrollHeight>t.clientHeight&&("auto"===e||"scroll"===e||"overlay"===e))return t;t=t.parentElement}return document},Hx=class e{constructor(e,t,n,i,s,r){b(this,"a",1),b(this,"b",0),b(this,"c",0),b(this,"d",1),b(this,"e",0),b(this,"f",0),this.a=e,this.b=t,this.c=n,this.d=i,this.e=s,this.f=r}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:n,b:i,c:s,d:r,e:o,f:a}=this;return this.a=n*t.a+s*t.b,this.c=n*t.c+s*t.d,this.e=n*t.e+s*t.f+o,this.b=i*t.a+r*t.b,this.d=i*t.c+r*t.d,this.f=i*t.e+r*t.f+a,this}rotate(t,n,i){return 0===t?this:void 0===n?this.multiply(e.Rotate(t)):this.translate(n,i).multiply(e.Rotate(t)).translate(-n,-i)}translate(t,n){return this.multiply(e.Translate(t,n))}scale(t,n){return this.multiply(e.Scale(t,n))}invert(){const{a:e,b:t,c:n,d:i,e:s,f:r}=this,o=e*i-t*n;return this.a=i/o,this.b=t/-o,this.c=n/-o,this.d=e/o,this.e=(i*s-n*r)/-o,this.f=(t*s-e*r)/o,this}applyToPoint(t){return e.applyToPoint(this,t)}applyToPoints(t){return e.applyToPoints(this,t)}rotation(){return e.Rotation(this)}point(){return e.Point(this)}decomposed(){return e.Decompose(this)}toCssString(){return e.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return e.Decompose(this)}clone(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new e(1,0,0,1,0,0)}static Translate(t,n){return new e(1,0,0,1,t,n)}static Rotate(t,n,i){if(0===t)return e.Identity();const s=Math.cos(t),r=Math.sin(t),o=new e(s,r,-r,s,0,0);return void 0===n?o:e.Compose(e.Translate(n,i),o,e.Translate(-n,-i))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...t){const n=e.Identity();for(let e=0,i=t.length;e<i;e++)n.multiply(t[e]);return n}static Point(e){return new Am(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){const n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const n=(e.b*e.b+e.d*e.d)**.5;t=zm+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return Gm(t)}static Decompose(e){let t,n,i;if(0!==e.a||0!==e.c){const s=(e.a*e.a+e.c*e.c)**.5;t=s,n=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,n=s,i=zm+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,n=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:Gm(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${iy(e.a)}, ${iy(e.b)}, ${iy(e.c)}, ${iy(e.d)}, ${iy(e.e)}, ${iy(e.f)})`}static applyToPoint(e,t){return new Am(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map((t=>new Am(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)))}static applyToBounds(e,t){return new Ux(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(t){return new e(t.a,t.b,t.c,t.d,t.e,t.f)}static Cast(t){return t instanceof e?t:e.From(t)}};b(Hx,"Scale",((e,t,n,i)=>{const s=new Hx(e,0,0,t,0,0);return void 0===n?s:Hx.Compose(Hx.Translate(n,i),s,Hx.Translate(-n,-i))}));let Vx=Hx;function Wx(e,t){return 0===t?e:Wx(t,e%t)}function Yx(e){const t=e.toString().split(".")[1];if(!t)return 1;const n=Math.pow(10,t.length);return n/Wx(parseInt(t,10),n)}class Gx{constructor(e){b(this,"isFilled",!1),b(this,"isClosed",!0),b(this,"isLabel",!1),b(this,"debugColor"),b(this,"ignore"),b(this,"_vertices"),b(this,"_bounds"),b(this,"_area"),b(this,"_length"),this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return!(!this.isClosed||!this.isFilled&&!n||!ny(e,this.vertices))||Am.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&ny(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:n}=this;let i,s,r,o,a=1/0;for(let l=0;l<n.length;l++)r=n[l],o=Am.NearestPointOnLineSegment(e,t,r,!0),s=Am.Dist2(r,o),s<a&&(a=s,i=o);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&ny(i,this.vertices)?-a:a}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){const{vertices:n}=this;let i,s,r,o,a=1/0;for(let l=0;l<n.length;l++)r=n[l],o=Am.NearestPointOnLineSegment(e,t,r,!0),s=Am.Dist2(r,o),s<a&&(a=s,i=o);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return Ux.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let n=0,i=e.length;n<i;n++){const s=e[n],r=e[(n+1)%i];t+=s.x*r.y-r.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<n;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length||(this._length=this.getLength()),this._length}getLength(){const{vertices:e}=this;let t,n=e[0],i=0;for(let s=1;s<e.length;s++)t=e[s],i+=Am.Dist2(n,t),n=t;return Math.sqrt(i)}}class Xx extends Gx{constructor(e){super({...e,isClosed:!0,isFilled:!1}),b(this,"children",[]),b(this,"ignoredChildren",[]);for(const t of e.children)t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter((e=>!e.isLabel)).flatMap((e=>e.vertices))}nearestPoint(e){let t,n=1/0;const{children:i}=this;if(0===i.length)throw Error("no children");let s,r;for(const o of i)s=o.nearestPoint(e),r=Am.Dist2(s,e),r<n&&(n=r,t=s);if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map(((n,i)=>n.distanceToPoint(e,t||i>0))))}hitTestPoint(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((i=>i.hitTestPoint(e,t,n)))}hitTestLineSegment(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((i=>i.hitTestLineSegment(e,t,n)))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const n of this.children)e+=n.toSimpleSvgPath();const t=Ux.FromPoints(this.vertices).corners;for(let n=0,i=t.length;n<i;n++){const s=t[n],r=t[(n-1+i)%i],o=s.dist(r),a=t[(n+1)%i],l=s.dist(a),c=s.clone().lrp(r,4/o),d=s,h=s.clone().lrp(a,4/l);e+=`M${c.x},${c.y} L${d.x},${d.y} L${h.x},${h.y} `}return e}getLength(){return this.children.reduce(((e,t)=>t.isLabel?e:e+t.length),0)}getSvgPathData(){return this.children.map(((e,t)=>e.isLabel?"":e.getSvgPathData(0===t))).join(" ")}}const qx=Ou((function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){const i=jm();!function(e=!0){const[t,n]=C.useState(0),i=jm();C.useEffect((()=>{if(!e)return;const t=()=>n((e=>e+1));return i.on("tick",t),()=>{i.off("tick",t)}}),[i,e])}(n);const s=i.getZoomLevel(),r=i.getRenderingShapes(),{inputs:{currentPagePoint:o}}=i;return k.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:r.map((r=>{const a=i.getShape(r.id);if("group"===a.type)return null;const l=i.getShapeGeometry(a),c=i.getShapePageTransform(a),d=i.getPointInShapeSpace(a,o),h=l.nearestPoint(d),u=l.distanceToPoint(d,!0),p=Math.abs(u)*s,g=u<0,{vertices:f}=l;return k.jsxs("g",{transform:c.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&k.jsx("g",{stroke:l.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:k.jsx(Zx,{geometry:l})}),t&&f.map(((e,t)=>k.jsx("circle",{cx:e.x,cy:e.y,r:2/s,fill:`hsl(${Ud(t,[0,f.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${t}`))),n&&p<150&&k.jsx("line",{x1:h.x,y1:h.y,x2:d.x,y2:d.y,opacity:1-p/150,stroke:g?"goldenrod":"dodgerblue",strokeWidth:2/s})]},r.id+"_outline")}))})}));function Zx({geometry:e}){return e instanceof Xx?k.jsx(k.Fragment,{children:[...e.children,...e.ignoredChildren].map(((e,t)=>k.jsx(Zx,{geometry:e},t)))}):k.jsx("path",{d:e.toSimpleSvgPath()})}function Jx(e){return cd(e)}function Qx(){const e=jm(),t=function(){const e=arguments[0],t=arguments[1],n=3===arguments.length?void 0:arguments[2],i=3===arguments.length?arguments[2]:arguments[3];return C.useMemo((()=>ju(`useComputed(${e})`,t,n)),i)}("userIds",(()=>Jx(e.getCollaborators().map((e=>e.userId))).sort()),{isEqual:(e,t)=>{var n;return e.join(",")===(null==(n=t.join)?void 0:n.call(t,","))}},[e]);return Ru(t)}function ew(e){const t=jm();return Ru(`latestPresence:${e}`,(()=>t.getCollaborators().find((t=>t.userId===e))),[t,e])??null}const tw=Ou((function(){const e=Qx();return k.jsx(k.Fragment,{children:e.map((e=>k.jsx(nw,{collaboratorId:e},e)))})})),nw=Ou((function({collaboratorId:e}){const t=jm(),n=ew(e),i=function(e,t){const n=C.useRef((null==t?void 0:t.lastActivityTimestamp)??-1),[i,s]=C.useState((()=>sw(e,Date.now()-n.current)));C.useEffect((()=>{const t=e.timers.setInterval((()=>{s(sw(e,Date.now()-n.current))}),e.options.collaboratorCheckIntervalMs);return()=>clearInterval(t)}),[e]),t&&(n.current=t.lastActivityTimestamp);return i}(t,n);if(!n||n.currentPageId!==t.getCurrentPageId())return null;switch(i){case"inactive":{const{followingUserId:e,highlightedUserIds:i}=t.getInstanceState();if(e!==n.userId&&!i.includes(n.userId))return null;break}case"idle":{const{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!n.chatMessage&&!e.includes(n.userId))return null;break}}return k.jsx(iw,{latestPresence:n})})),iw=Ou((function({latestPresence:e}){const t=jm(),{CollaboratorBrush:n,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:r,CollaboratorShapeIndicator:o}=ev(),a=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:c,chatMessage:d,brush:h,scribbles:u,selectedShapeIds:p,userName:g,cursor:f,color:m}=e,y=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return k.jsxs(k.Fragment,{children:[h&&n?k.jsx(n,{className:"tl-collaborator__brush",brush:h,color:m,opacity:.1},c+"_brush"):null,y&&s?k.jsx(s,{className:"tl-collaborator__cursor",point:f,color:m,zoom:a,name:"New User"!==g?g:null,chatMessage:d},c+"_cursor"):r?k.jsx(r,{className:"tl-collaborator__cursor-hint",point:f,color:m,zoom:a,viewport:l},c+"_cursor_hint"):null,i&&u.length?k.jsx(k.Fragment,{children:u.map((e=>k.jsx(i,{className:"tl-collaborator__scribble",scribble:e,color:m,zoom:a,opacity:"laser"===e.color?.5:.1},c+"_scribble_"+e.id)))}):null,o&&p.map((e=>k.jsx(o,{className:"tl-collaborator__shape-indicator",shapeId:e,color:m,opacity:.5},c+"_"+e)))]})}));function sw(e,t){return t>e.options.collaboratorInactiveTimeoutMs?"inactive":t>e.options.collaboratorIdleTimeoutMs?"idle":"active"}const rw=C.memo((function({id:e,shape:t,util:n,index:i,backgroundIndex:s,opacity:r,dprMultiple:o}){const a=jm(),{ShapeErrorFallback:l}=ev(),c=C.useRef(null),d=C.useRef(null),h=C.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Du("set shape stuff",(()=>{const t=a.getShape(e);if(!t)return;const n=h.current,i=a.getShapeClipPath(e)??"none";i!==n.clipPath&&(jy(c.current,"clip-path",i),jy(d.current,"clip-path",i),n.clipPath=i);const s=a.getShapePageTransform(e),r=Vx.toCssString(s),l=a.getShapeGeometry(t).bounds;r!==n.transform&&(jy(c.current,"transform",r),jy(d.current,"transform",r),n.transform=r);const u=l.w%o,p=l.h%o,g=0===u?l.w:l.w+(o-u),f=0===p?l.h:l.h+(o-p);g===n.width&&f===n.height||(jy(c.current,"width",Math.max(g,o)+"px"),jy(c.current,"height",Math.max(f,o)+"px"),jy(d.current,"width",Math.max(g,o)+"px"),jy(d.current,"height",Math.max(f,o)+"px"),n.width=g,n.height=f)}),[a]),Du("set opacity and z-index",(()=>{const e=c.current,t=d.current;jy(e,"opacity",r),jy(t,"opacity",r),jy(e,"z-index",i),jy(t,"z-index",s)}),[r,i,s]),Du("set display",(()=>{if(!a.getShape(e))return;const t=a.getCulledShapes().has(e);t!==h.current.isCulled&&(jy(c.current,"display",t?"none":"block"),jy(d.current,"display",t?"none":"block"),h.current.isCulled=t)}),[a]);const u=C.useCallback((e=>a.annotateError(e,{origin:"shape",willCrashApp:!1})),[a]);if(!t)return null;const p="fill"in t.props&&"none"!==t.props.fill;return k.jsxs(k.Fragment,{children:[n.backgroundComponent&&k.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:k.jsx(Pm,{fallback:l,onError:u,children:k.jsx(aw,{shape:t,util:n})})}),k.jsx("div",{ref:c,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":p,draggable:!1,children:k.jsx(Pm,{fallback:l,onError:u,children:k.jsx(ow,{shape:t,util:n})})})]})})),ow=C.memo((function({shape:e,util:t}){return Eu("InnerShape:"+e.type,(()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id))))}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta)),aw=C.memo((function({shape:e,util:t}){return Eu("InnerShape:"+e.type,(()=>{var n;return null==(n=t.backgroundComponent)?void 0:n.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))}))}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta));function lw({className:e}){const t=jm(),{Background:n,SvgDefs:i}=ev(),s=C.useRef(null),r=C.useRef(null),o=C.useRef(null),a=Ay();!function(e){const t=jm();C.useLayoutEffect((()=>{let n=new Ux;function i(){const i=e.current;if(!i)return null;const s=i.getBoundingClientRect(),r=new Ux(s.left||s.x,s.top||s.y,Math.max(s.width,1),Math.max(s.height,1));n.equals(r)||(t.updateViewportScreenBounds(r),n=r)}i();const s=Pc(i,200,{trailing:!0}),r=t.timers.setInterval(s,1e3);window.addEventListener("resize",s);const o=new ResizeObserver((e=>{e[0].contentRect&&s()})),a=e.current;let l=null;return a&&(o.observe(a),l=Kx(a),l.addEventListener("scroll",s)),()=>{clearInterval(r),window.removeEventListener("resize",s),o.disconnect(),null==l||l.removeEventListener("scroll",s),s.cancel()}}),[t,e])}(s),function(){const e=jm(),t=Ay(),n=Ru("isFocused",(()=>e.getInstanceState().isFocused),[e]);C.useEffect((()=>{if(void 0===typeof matchMedia)return;let t=null;const n=()=>{null!=t&&t();const i=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(i),r=e=>{"change"===e.type&&n()};s.addEventListener?s.addEventListener("change",n):s.addListener&&s.addListener(r),t=()=>{s.removeEventListener?s.removeEventListener("change",n):s.removeListener&&s.removeListener(r)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{null==t||t()}}),[e]),C.useEffect((()=>{if(!n)return;const i=t=>{if(!t.altKey||!e.isIn("zoom")&&e.getPath().endsWith(".idle")||Dy()||Cy(t),t.isKilled)return;switch(t.isKilled=!0,t.key){case"=":case"-":case"0":if(t.metaKey||t.ctrlKey)return void Cy(t);break;case"Tab":default:if(Dy()||e.getIsMenuOpen())return;break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&t.preventDefault(),e.getOpenMenus().length>0)return;return void(e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),e.focus()))}const n={type:"keyboard",name:t.repeat?"key_repeat":"key_down",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)},s=t=>{if(t.isKilled)return;if(t.isKilled=!0,Dy()||e.getIsMenuOpen())return;if(","===t.key)return;const n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)};function r(n){var i,s;if(t.contains(n.target)){const t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&("BUTTON"===(null==(i=n.target)?void 0:i.tagName)&&(null==(s=n.target)||s.click()),Cy(n))}}const o=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&Cy(e)};return t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",Cy),document.addEventListener("gesturechange",Cy),document.addEventListener("gestureend",Cy),t.addEventListener("keydown",i),t.addEventListener("keyup",s),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("wheel",o),document.removeEventListener("gesturestart",Cy),document.removeEventListener("gesturechange",Cy),document.removeEventListener("gestureend",Cy),t.removeEventListener("keydown",i),t.removeEventListener("keyup",s)}}),[e,t,n])}(),function(){const e=jm();C.useEffect((()=>{let t=e.getInstanceState().isCoarsePointer;const n=n=>{const i="mouse"!==n.pointerType;t!==i&&(t=i,e.updateInstanceState({isCoarsePointer:i}))};window.addEventListener("pointerdown",n,{capture:!0});const i=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),s=e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos,r=()=>{const n=!s&&i.matches;t===n&&(t=n,e.updateInstanceState({isCoarsePointer:n}))};return i&&(i.addEventListener("change",r),r()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),i&&i.removeEventListener("change",r)}}),[e])}(),Nx(s),function(e){const t=jm();C.useEffect((()=>{const n=e.current;if(!n)return;const i=e=>{var n;if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;const{target:i}=e;if(Ry.includes(null==(n=i.tagName)?void 0:n.toLocaleLowerCase())||t.isIn("select.editing_shape"))return;Cy(e)}};return n.addEventListener("touchstart",i),n.addEventListener("touchend",i),()=>{n.removeEventListener("touchstart",i),n.removeEventListener("touchend",i)}}),[t,e])}(s);const l=C.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Du("position layers",(function(){const{x:e,y:n,z:i}=t.getCamera();if(l.current.allowTextOutline&&t.environment.isSafari&&(a.style.setProperty("--tl-text-outline","none"),l.current.allowTextOutline=!1),l.current.allowTextOutline&&i<t.options.textShadowLod!==l.current.lodDisableTextOutline){const e=i<t.options.textShadowLod;a.style.setProperty("--tl-text-outline",e?"none":"var(--tl-text-outline-reference)"),l.current.lodDisableTextOutline=e}const s=i>=1?Ud(i,[1,8],[.125,.5],!0):Ud(i,[.1,1],[-2,.125],!0),c=`scale(${iy(i)}) translate(${iy(e+s)}px,${iy(n+s)}px)`;jy(r.current,"transform",c),jy(o.current,"transform",c)}),[t,a]);const c=function(){const e=jm();return C.useMemo((function(){let t,n;return{onPointerDown:function(t){t.isKilled||(t.button!==my?0!==t.button&&1!==t.button&&5!==t.button||(_y(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Ey(t)})):e.dispatch({type:"pointer",target:"canvas",name:"right_click",...Ey(t)}))},onPointerMove:function(i){i.isKilled||i.clientX===t&&i.clientY===n||(t=i.clientX,n=i.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Ey(i)}))},onPointerUp:function(i){i.isKilled||0!==i.button&&1!==i.button&&2!==i.button&&5!==i.button||(t=i.clientX,n=i.clientY,Py(i.currentTarget,i),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Ey(i)}))},onPointerEnter:function(t){if(t.isKilled)return;if(e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;const n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled)return;if(e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;const n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){Cy(e)},onDrop:async function(t){var n,i;if(Cy(t),!(null==(i=null==(n=t.dataTransfer)?void 0:n.files)?void 0:i.length))return;const s=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:s,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,Cy(e)},onTouchEnd:function(t){t.isKilled=!0,t.target instanceof HTMLElement&&("A"===t.target.tagName||"TEXTAREA"===t.target.tagName||e.getEditingShape()&&t.target.className.includes("tl-text-content")||Cy(t))},onClick:function(e){Iy(e)}}}),[e])}(),d=Ru("shapeSvgDefs",(()=>{const e=new Map;for(const n of Wd(t.shapeUtils)){if(!n)return;const t=n.getCanvasSvgDefs();for(const{key:n,component:i}of t)e.has(n)||e.set(n,k.jsx(i,{},n))}return[...e.values()]}),[t]),h=Ru("debug_shapes",(()=>vy.hideShapes.get()),[vy]),u=Ru("debug_svg",(()=>vy.debugSvg.get()),[vy]),p=Ru("debug_geometry",(()=>vy.debugGeometry.get()),[vy]),g=Ru("isEditingAnything",(()=>null!==t.getEditingShapeId()),[t]),f=Ru("isSelectingAnything",(()=>!!t.getSelectedShapeIds().length),[t]);return k.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":g,"data-isselectinganything":f,className:I("tl-canvas",e),"data-testid":"canvas",...c,children:[k.jsx("svg",{className:"tl-svg-context",children:k.jsxs("defs",{children:[d,k.jsx(Sw,{}),k.jsx(kw,{}),i&&k.jsx(i,{})]})}),n&&k.jsx("div",{className:"tl-background__wrapper",children:k.jsx(n,{})}),k.jsx(cw,{}),k.jsxs("div",{ref:r,className:"tl-html-layer tl-shapes",draggable:!1,children:[k.jsx(Iw,{}),k.jsx(Pw,{}),h?null:u?k.jsx(yw,{}):k.jsx(ww,{})]}),k.jsx("div",{className:"tl-overlays",children:k.jsxs("div",{ref:o,className:"tl-html-layer",children:[p?k.jsx(qx,{}):null,k.jsx(gw,{}),k.jsx(hw,{}),k.jsx(dw,{}),k.jsx(uw,{}),k.jsx(vw,{}),k.jsx(bw,{}),k.jsx(pw,{}),k.jsx(_w,{}),k.jsx(tw,{})]})}),k.jsx(jw,{})]})}function cw(){const e=jm(),t=Ru("gridSize",(()=>e.getDocumentSettings().gridSize),[e]),{x:n,y:i,z:s}=Ru("camera",(()=>e.getCamera()),[e]),r=Ru("isGridMode",(()=>e.getInstanceState().isGridMode),[e]),{Grid:o}=ev();return o&&r?k.jsx(o,{x:n,y:i,z:s,size:t}):null}function dw(){const e=jm(),t=Ru("scribbles",(()=>e.getInstanceState().scribbles),[e]),n=Ru("zoomLevel",(()=>e.getZoomLevel()),[e]),{Scribble:i}=ev();return i&&t.length?k.jsx(k.Fragment,{children:t.map((e=>k.jsx(i,{className:"tl-user-scribble",scribble:e,zoom:n},e.id)))}):null}function hw(){const e=jm(),t=Ru("brush",(()=>e.getInstanceState().brush),[e]),{Brush:n}=ev();return n&&t?k.jsx(n,{className:"tl-user-brush",brush:t}):null}function uw(){const e=jm(),t=Ru("zoomBrush",(()=>e.getInstanceState().zoomBrush),[e]),{ZoomBrush:n}=ev();return n&&t?k.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function pw(){const e=jm(),t=Ru("snapLines",(()=>e.snaps.getIndicators()),[e]),n=Ru("zoomLevel",(()=>e.getZoomLevel()),[e]),{SnapIndicator:i}=ev();return i&&t.length>0?k.jsx(k.Fragment,{children:t.map((e=>k.jsx(i,{className:"tl-user-snapline",line:e,zoom:n},e.id)))}):null}function gw(){const e=jm(),t=Ru("handles shapeIdWithHandles",(()=>{const{isReadonly:t,isChangingStyle:n}=e.getInstanceState();if(t||n)return!1;const i=e.getOnlySelectedShape();if(!i)return!1;return!!e.getShapeHandles(i)&&i.id}),[e]);return t?k.jsx(fw,{shapeId:t}):null}function fw({shapeId:e}){const t=jm(),{Handles:n}=ev(),i=Ru("zoomLevel",(()=>t.getZoomLevel()),[t]),s=Ru("coarse pointer",(()=>t.getInstanceState().isCoarsePointer),[t]),r=Ru("handles transform",(()=>t.getShapePageTransform(e)),[t,e]),o=Ru("handles",(()=>{const n=t.getShapeHandles(e);if(!n)return null;const r=(s?t.options.coarseHandleRadius:t.options.handleRadius)/i*2;return n.filter((e=>"virtual"!==e.type||!n.some((t=>t!==e&&"vertex"===t.type&&Am.Dist(e,t)<r)))).sort((e=>"vertex"===e.type?1:-1))}),[t,i,s,e]);return n&&o&&r?k.jsx(n,{children:k.jsx("g",{transform:Vx.toCssString(r),children:o.map((t=>k.jsx(mw,{shapeId:e,handle:t,zoom:i,isCoarse:s},t.id)))})}):null}function mw({shapeId:e,handle:t,zoom:n,isCoarse:i}){const s=function(e,t){const n=jm();return C.useMemo((()=>{let i,s;return{onPointerDown:i=>{if(i.isKilled)return;_y(ky(i.currentTarget),i);const{shape:s,handle:r}=$x(n,e,t);r&&n.dispatch({type:"pointer",target:"handle",handle:r,shape:s,name:"pointer_down",...Ey(i)})},onPointerMove:r=>{if(r.isKilled)return;if(r.clientX===i&&r.clientY===s)return;i=r.clientX,s=r.clientY;const{shape:o,handle:a}=$x(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_move",...Ey(r)})},onPointerUp:i=>{if(i.isKilled)return;Py(ky(i.currentTarget),i);const{shape:s,handle:r}=$x(n,e,t);r&&n.dispatch({type:"pointer",target:"handle",handle:r,shape:s,name:"pointer_up",...Ey(i)})}}}),[n,e,t])}(e,t.id),{Handle:r}=ev();return r?k.jsx("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...s,children:k.jsx(r,{shapeId:e,handle:t,zoom:n,isCoarse:i})}):null}function yw(){const e=jm(),t=Ru("rendering shapes",(()=>e.getRenderingShapes()),[e]),n=Ru("dpr multiple",(()=>Yx(Math.floor(100*e.getInstanceState().devicePixelRatio)/100)),[e]);return k.jsx(k.Fragment,{children:t.map((e=>k.jsxs(C.Fragment,{children:[k.jsx(rw,{...e,dprMultiple:n}),k.jsx(Cw,{id:e.id})]},e.id+"_fragment")))})}function xw(){const e=jm(),t=C.useRef(new Set);return Du("reflow for culled shapes",(()=>{const n=e.getCulledShapes();if(t.current.size===n.size&&[...n].every((e=>t.current.has(e))))return;t.current=n;const i=document.getElementsByClassName("tl-canvas");0!==i.length&&i[0].offsetHeight}),[e]),null}function ww(){const e=jm(),t=Ru("rendering shapes",(()=>e.getRenderingShapes()),[e]),n=Ru("dpr multiple",(()=>Yx(Math.floor(100*e.getInstanceState().devicePixelRatio)/100)),[e]);return k.jsxs(k.Fragment,{children:[t.map((e=>k.jsx(rw,{...e,dprMultiple:n},e.id+"_shape"))),e.environment.isSafari&&k.jsx(xw,{})]})}function vw(){const e=jm(),t=Ru("rendering shapes",(()=>e.getRenderingShapes()),[e]),n=C.useRef(new Set),i=Ru("should display selected ids",(()=>{const t=n.current,i=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const t=e.getSelectedShapeIds();for(const e of t)i.add(e);if(e.isInAny("select.idle","select.editing_shape")){const t=e.getInstanceState();if(t.isHoveringCanvas&&!t.isCoarsePointer){const t=e.getHoveredShapeId();t&&i.add(t)}}}if(t.size!==i.size)return n.current=i,i;for(const e of i)if(!t.has(e))return n.current=i,i;return t}),[e]),{ShapeIndicator:s}=ev();return s?k.jsx(k.Fragment,{children:t.map((({id:e})=>k.jsx(s,{shapeId:e,hidden:!i.has(e)},e+"_indicator")))}):null}function bw(){const e=jm(),{ShapeIndicator:t}=ev(),n=Ru("hinting shape ids",(()=>hd(e.getHintingShapeIds())),[e]);return n.length&&t?k.jsx(k.Fragment,{children:n.map((e=>k.jsx(t,{className:"tl-user-indicator__hint",shapeId:e},e+"_hinting")))}):null}function Sw(){return k.jsxs("g",{id:"cursor",children:[k.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[k.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),k.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),k.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[k.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),k.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),k.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[k.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),k.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function kw(){return k.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function Cw({id:e}){const t=jm(),[n,i]=C.useState(null),s=Ru("is in root",(()=>{const n=t.getShape(e);return(null==n?void 0:n.parentId)===t.getCurrentPageId()}),[t,e]);return C.useEffect((()=>{if(!s)return;let n=null;const r=cu("shape to svg",(async()=>{const s=Math.random();n=s;const r=t.isShapeOfType(e,"frame")?0:10;let o=t.getShapePageBounds(e);if(!o)return;o=o.clone().expandBy(r);const a=await t.getSvgString([e],{padding:r,background:t.getInstanceState().exportBackground});if(n!==s||!a)return;const l=`data:image/svg+xml;utf8,${encodeURIComponent(a.svg)}`;i({src:l,bounds:o})}));return()=>{n=null,r()}}),[t,e,s]),s&&n?k.jsx("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function _w(){const e=jm(),t=Ru("selection rotation",(()=>e.getSelectionRotation()),[e]),n=Ru("selection bounds",(()=>e.getSelectionRotatedPageBounds()),[e]),{SelectionForeground:i}=ev();return n&&i?k.jsx(i,{bounds:n,rotation:t}):null}function Pw(){const e=jm(),t=Ru("selection rotation",(()=>e.getSelectionRotation()),[e]),n=Ru("selection bounds",(()=>e.getSelectionRotatedPageBounds()),[e]),{SelectionBackground:i}=ev();return n&&i?k.jsx(i,{bounds:n,rotation:t}):null}function Iw(){const{OnTheCanvas:e}=ev();return e?k.jsx(e,{}):null}function jw(){const e=jm(),t=Ru("camera state",(()=>e.getCameraState()),[e]);return k.jsx("div",{className:I("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===t})})}function Ew({className:e,zoom:t,point:n,color:i,viewport:s,opacity:r=1}){const o=C.useRef(null);return Tm(o,$m(n.x,s.minX+5/t,s.maxX-5/t),$m(n.y,s.minY+5/t,s.maxY-5/t),1/t,Am.Angle(s.center,n)),k.jsxs("svg",{ref:o,className:I("tl-overlays__item",e),children:[k.jsx("use",{href:"#cursor_hint",color:i,strokeWidth:3,stroke:"var(--color-background)"}),k.jsx("use",{href:"#cursor_hint",color:i,opacity:r})]})}const Tw=C.memo((function({className:e,zoom:t,point:n,color:i,name:s,chatMessage:r}){const o=C.useRef(null);return Tm(o,null==n?void 0:n.x,null==n?void 0:n.y,1/t),n?k.jsxs("div",{ref:o,className:I("tl-overlays__item",e),children:[k.jsx("svg",{className:"tl-cursor",children:k.jsx("use",{href:"#cursor",color:i})}),r?k.jsxs(k.Fragment,{children:[s&&k.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),k.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:r})]}):s&&k.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null}));function Mw({x:e,y:t,z:n,size:i}){const s=jm(),{gridSteps:r}=s.options;return k.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[k.jsx("defs",{children:r.map((({min:s,mid:r,step:o},a)=>{const l=o*i*n,c=.5+e*n,d=.5+t*n,h=c>0?c%l:l+c%l,u=d>0?d%l:l+d%l,p=n<r?Ud(n,[s,r],[0,1]):1;return k.jsx("pattern",{id:`grid-${o}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:k.jsx("circle",{className:"tl-grid-dot",cx:h,cy:u,r:1,opacity:p})},`grid-pattern-${a}`)}))}),r.map((({step:e},t)=>k.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${e})`},`grid-rect-${t}`)))]})}function Aw({handle:e,isCoarse:t,className:n,zoom:i}){const s=jm(),r=(t?s.options.coarseHandleRadius:s.options.handleRadius)/i;if("clone"===e.type){const t=3/i,s=`M0,${-t} A${t},${t} 0 0,1 0,${t}`,o=fy.indexOf(e.id);return k.jsxs("g",{className:I(`tl-handle tl-handle__${e.type}`,n),children:[k.jsx("circle",{className:"tl-handle__bg",r:r}),k.jsx("path",{className:"tl-handle__fg",d:s,transform:`rotate(${90*o-90})`})]})}const o=("create"===e.type&&t?3:4)/Math.max(i,.25);return k.jsxs("g",{className:I(`tl-handle tl-handle__${e.type}`,n),children:[k.jsx("circle",{className:"tl-handle__bg",r:r}),k.jsx("circle",{className:"tl-handle__fg",r:o})]})}const Ow=({children:e})=>k.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:e}),Dw=()=>{const{Spinner:e}=ev();return k.jsx(hk,{children:e?k.jsx(e,{}):null})};function Rw(e,t=!0){const n=e.length;if(n<2)return"";let i=e[0],s=e[1];if(2===n)return`M${Dm(i)}L${Dm(s)}`;let r="";for(let o=2,a=n-1;o<a;o++)i=e[o],s=e[o+1],r+=Rm(i,s);return t?`M${Rm(e[0],e[1])}Q${Dm(e[1])}${Rm(e[1],e[2])}T${r}${Rm(e[n-1],e[0])}${Rm(e[0],e[1])}Z`:`M${Dm(e[0])}Q${Dm(e[1])}${Rm(e[1],e[2])}${e.length>3?"T":""}${r}L${Dm(e[n-1])}`}function Lw({scribble:e,zoom:t,color:n,opacity:i,className:s}){return e.points.length?k.jsx("svg",{className:s?I("tl-overlays__item",s):s,children:k.jsx("path",{className:"tl-scribble",d:Rw(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:i??e.opacity})}):null}function zw({bounds:e,rotation:t}){const n=C.useRef(null);return Tm(n,e.x,e.y,1,t),C.useLayoutEffect((()=>{const t=n.current;t&&(t.style.width=iy(Math.max(1,e.width))+"px",t.style.height=iy(Math.max(1,e.height))+"px")}),[e.width,e.height]),k.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function Fw({bounds:e,rotation:t}){const n=jm(),i=C.useRef(null),s=Ru("only selected shape",(()=>n.getOnlySelectedShape()),[n]),r=s?n.getShapeUtil(s).expandSelectionOutlinePx(s):0;return Tm(i,null==e?void 0:e.x,null==e?void 0:e.y,1,t,{x:-r,y:-r}),e=e.clone().expandBy(r).zeroFix(),k.jsx("svg",{ref:i,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:k.jsx("rect",{className:I("tl-selection__fg__outline"),width:iy(e.width),height:iy(e.height)})})}const Nw=()=>k.jsx("div",{className:"tl-shape-error-boundary"}),$w=({shape:e,util:t})=>Eu("Indicator: "+e.type,(()=>t.indicator(t.editor.store.unsafeGetWithoutCapture(e.id)))),Bw=({editor:e,id:t})=>{const n=Ru("shape for indicator",(()=>e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:i}=ev();return!n||n.isLocked?null:k.jsx(Pm,{fallback:i,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:k.jsx($w,{shape:n,util:e.getShapeUtil(n)},n.id)})},Uw=C.memo((function({shapeId:e,className:t,color:n,hidden:i,opacity:s}){const r=jm(),o=C.useRef(null);return Du("indicator transform",(()=>{const t=o.current;if(!t)return;const n=r.getShapePageTransform(e);n&&t.style.setProperty("transform",n.toCssString())}),[r,e]),C.useLayoutEffect((()=>{const e=o.current;e&&e.style.setProperty("display",i?"none":"block")}),[i]),k.jsx("svg",{ref:o,className:I("tl-overlays__item",t),children:k.jsx("g",{className:"tl-shape-indicator",stroke:n??"var(--color-selected)",opacity:s,children:k.jsx(Bw,{editor:r,id:e})})})})),Kw=()=>k.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function Hw({points:e,zoom:t}){const n=2.5/t,i=e.reduce(((e,t)=>Math.min(e,t.x)),1/0),s=e.reduce(((e,t)=>Math.max(e,t.x)),-1/0),r=e.reduce(((e,t)=>Math.min(e,t.y)),1/0),o=e.reduce(((e,t)=>Math.max(e,t.y)),-1/0);let a,l,c,d;return e.some((e=>e.x===i&&e.y===r))?(a=i,l=r,c=s,d=o):(a=i,l=o,c=s,d=r),k.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[k.jsx("line",{x1:a,y1:l,x2:c,y2:d}),e.map(((e,t)=>k.jsx("g",{transform:`translate(${e.x},${e.y})`,children:k.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},t)))]})}function Vw({gaps:e,direction:t,zoom:n}){const i=3.5/n;let s=[-1/0,1/0],r=null;const o="horizontal"===t;for(const l of e)r=ey(s[0],s[1],o?l.startEdge[0].y:l.startEdge[0].x,o?l.startEdge[1].y:l.startEdge[1].x),r&&(s=r,r=ey(s[0],s[1],o?l.endEdge[0].y:l.endEdge[0].x,o?l.endEdge[1].y:l.endEdge[1].x),r&&(s=r));if(null===s)return null;const a=(s[0]+s[1])/2;return k.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:e.map((({startEdge:e,endEdge:t},n)=>k.jsx(C.Fragment,{children:o?k.jsxs(k.Fragment,{children:[k.jsx("line",{x1:e[0].x,y1:a-2*i,x2:e[1].x,y2:a+2*i}),k.jsx("line",{x1:t[0].x,y1:a-2*i,x2:t[1].x,y2:a+2*i}),k.jsx("line",{x1:e[0].x,y1:a,x2:t[0].x,y2:a}),k.jsx("line",{x1:(e[0].x+t[0].x)/2,y1:a-i,x2:(e[0].x+t[0].x)/2,y2:a+i})]}):k.jsxs(k.Fragment,{children:[k.jsx("line",{x1:a-2*i,y1:e[0].y,x2:a+2*i,y2:e[1].y}),k.jsx("line",{x1:a-2*i,y1:t[0].y,x2:a+2*i,y2:t[1].y}),k.jsx("line",{x1:a,y1:e[0].y,x2:a,y2:t[0].y}),k.jsx("line",{x1:a-i,y1:(e[0].y+t[0].y)/2,x2:a+i,y2:(e[0].y+t[0].y)/2})]})},n)))})}function Ww({className:e,line:t,zoom:n}){return k.jsx("svg",{className:I("tl-overlays__item",e),children:"points"===t.type?k.jsx(Hw,{...t,zoom:n}):"gaps"===t.type?k.jsx(Vw,{...t,zoom:n}):null})}function Yw(){return k.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:k.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[k.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),k.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:k.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const Gw=()=>null;function Xw(e,t){const n=C.useRef(e);return t(e,n.current)?n.current:(n.current=e,e)}function qw(e){return Xw(e,gd)}function Zw(e){return Xw(e,Zd)}const Jw=C.createContext(null);function Qw({overrides:e={},children:t}){const n=Zw(e);return k.jsx(Jw.Provider,{value:C.useMemo((()=>({Background:Em,SvgDefs:Gw,Brush:dy,ZoomBrush:dy,CollaboratorBrush:dy,Cursor:Tw,CollaboratorCursor:Tw,CollaboratorHint:Ew,CollaboratorShapeIndicator:Uw,Grid:Mw,Scribble:Lw,SnapIndicator:Ww,Handles:Ow,Handle:Aw,CollaboratorScribble:Lw,ErrorFallback:iv,ShapeErrorFallback:Nw,ShapeIndicatorErrorFallback:Kw,Spinner:Yw,SelectionBackground:zw,SelectionForeground:Fw,ShapeIndicator:Uw,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:lw,LoadingScreen:Dw,...n})),[n]),children:t})}function ev(){const e=C.useContext(Jw);if(!e)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return e}const tv={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var e;return await(null==(e=window.__tldraw__hardReset)?void 0:e.call(window))}};function nv(){tv.hardReset()}const iv=({error:e,editor:t})=>{const n=C.useRef(null),[i,s]=C.useState(!1),[r,o]=C.useState(!1),[a,l]=C.useState(!1);let c=null;try{c=ev().Canvas??null}catch(m){}const d=e instanceof Error?e.message:String(e),h=e instanceof Error?e.stack:null,u=Ru("isDarkMode",(()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null}),[t]),[p,g]=C.useState(null);C.useLayoutEffect((()=>{var e;null!==u&&g(u);let t=null==(e=n.current)?void 0:e.parentElement,i=!1;for(;t;){if(t.classList.contains("tl-theme__dark")||t.classList.contains("tl-theme__light")){i=!0;break}t=t.parentElement}g(i?null:window.matchMedia("(prefers-color-scheme: dark)").matches)}),[u]),C.useEffect((()=>{if(r){const e=null==t?void 0:t.timers.setTimeout((()=>{o(!1)}),2e3);return()=>clearTimeout(e)}}),[r,t]);const f=new URL("https://github.com/tldraw/tldraw/issues/new");return f.searchParams.set("title",d),f.searchParams.set("labels","bug"),f.searchParams.set("body",`Hey, I ran into an error while using tldraw:\n\n\`\`\`js\n${h??d}\n\`\`\`\n\nMy browser: ${navigator.userAgent}`),k.jsxs("div",{ref:n,className:I("tl-container tl-error-boundary",null===p?"":p?"tl-theme__dark":"tl-theme__light"),children:[k.jsx("div",{className:"tl-error-boundary__overlay"}),t&&k.jsx(_m,{onError:yd,fallback:()=>null,children:k.jsx(Im.Provider,{value:t,children:k.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?k.jsx(c,{}):null})})}),k.jsx("div",{className:I("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":i&&!a}),children:a?k.jsxs(k.Fragment,{children:[k.jsx("h2",{children:"Are you sure?"}),k.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),k.jsxs("div",{className:"tl-error-boundary__content__actions",children:[k.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),k.jsx("button",{className:"tl-error-boundary__reset",onClick:async()=>{nv()},children:"Reset data"})]})]}):k.jsxs(k.Fragment,{children:[k.jsx("h2",{children:"Something's gone wrong."}),k.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",k.jsx("a",{href:f.toString(),children:"create a GitHub issue"})," or"," ",k.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),i&&k.jsxs(k.Fragment,{children:["Message:",k.jsx("h4",{children:k.jsx("code",{children:d})}),"Stack trace:",k.jsxs("div",{className:"tl-error-boundary__content__error",children:[k.jsx("pre",{children:k.jsx("code",{children:h??d})}),k.jsx("button",{onClick:()=>{const e=document.createElement("textarea");e.value=h??d,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),o(!0)},children:r?"Copied!":"Copy"})]})]}),k.jsxs("div",{className:"tl-error-boundary__content__actions",children:[k.jsx("button",{onClick:()=>s(!i),children:i?"Hide details":"Show details"}),k.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[k.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),k.jsx("button",{className:"tl-error-boundary__refresh",onClick:()=>{tv.refreshPage()},children:"Refresh Page"})]})]})]})})]})};function sv(){return zh()}const rv="TLDRAW_USER_DATA_v3",ov=bp({id:dp,name:dp.nullable().optional(),locale:dp.nullable().optional(),color:dp.nullable().optional(),colorScheme:Tp("light","dark","system").optional(),animationSpeed:hp.nullable().optional(),edgeScrollSpeed:hp.nullable().optional(),isSnapMode:yp.nullable().optional(),isWrapMode:yp.nullable().optional(),isDynamicSizeMode:yp.nullable().optional()}),av={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7},lv=Math.max(...Object.values(av));const cv=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];const dv=Object.freeze({name:"New User",locale:function(e){for(const t of e){const e=km(t);if(e)return e}return"en"}("undefined"!=typeof window?window.navigator.languages??["en"]:["en"]),color:cv[Math.floor(Math.random()*cv.length)],edgeScrollSpeed:1,animationSpeed:"undefined"!=typeof window&&(null==(uv=null==(hv=window.matchMedia)?void 0:hv.call(window,"(prefers-reduced-motion: reduce)"))?void 0:uv.matches)?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1});var hv,uv;function pv(){return{id:sv()}}function gv(e){if(null===e||"object"!=typeof e)return pv();if(!("version"in e)||!("user"in e)||"number"!=typeof e.version)return pv();const t=Rh(e);var n;(n=t).version<av.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<av.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version,av.MakeFieldsNullable,n.version<av.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<av.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<av.AllowSystemColorScheme&&(!0===n.user.isDarkMode?n.user.colorScheme="dark":!1===n.user.isDarkMode&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<av.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version=lv;try{return ov.validate(t.user)}catch(i){return pv()}}const fv=xu("globalUserData",null);function mv(e){ov.validate(e),fv.set(e),wh(rv,JSON.stringify({version:lv,user:fv.get()})),null==xv||xv.postMessage({type:bv,origin:vv(),data:{user:Sv(),version:lv}})}const yv="undefined"!=typeof process&&!1,xv="undefined"==typeof BroadcastChannel||yv?null:new BroadcastChannel("tldraw-user-sync");null==xv||xv.addEventListener("message",(e=>{const t=e.data;(null==t?void 0:t.type)===bv&&(null==t?void 0:t.origin)!==vv()&&fv.set(gv(t.data))}));let wv=null;function vv(){return null===wv&&(wv=sv()),wv}const bv="tldraw-user-preferences-change";function Sv(){let e=fv.get();return e||(e=gv(JSON.parse(xh(rv)||"null")??null),fv.set(e)),e}function kv(e={}){return{derivePresenceState:e.derivePresenceState??(()=>ju("presence",(()=>null))),userPreferences:e.userPreferences??ju("userPreferences",(()=>Sv())),setUserPreferences:e.setUserPreferences??mv}}var Cv={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,r||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,i,s=[];if(0===this._eventsCount)return s;for(i in e=this._events)t.call(e,i)&&s.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o},a.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,s,r,o){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,d=this._events[a],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,s),!0;case 5:return d.fn.call(d.context,t,i,s,r),!0;case 6:return d.fn.call(d.context,t,i,s,r,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var u,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),h){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,s);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];d[c].fn.apply(d[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,i,s){var r=n?n+e:e;if(!this._events[r])return this;if(!t)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==t||s&&!a.once||i&&a.context!==i||o(this,r);else{for(var l=0,c=[],d=a.length;l<d;l++)(a[l].fn!==t||s&&!a[l].once||i&&a[l].context!==i)&&c.push(a[l]);c.length?this._events[r]=1===c.length?c[0]:c:o(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(Cv);const _v=S(Cv.exports),Pv="TLDRAW_TAB_ID_v2",Iv=globalThis.window;const jv=Iv?Iv[Pv]??vh(Pv)??"TLDRAW_INSTANCE_STATE_V1_"+sv():"<error>";Iv&&(Iv[Pv]=jv,Iv&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Iv.navigator.platform)||Iv.navigator.userAgent.includes("Mac")&&"ontouchend"in document)?bh(Pv,jv):Sh(Pv)),null==Iv||Iv.addEventListener("beforeunload",(()=>{bh(Pv,jv)}));const Ev={Initial:0},Tv=Math.max(...Object.values(Ev));const Mv=bp({version:hp,currentPageId:Og,isFocusMode:yp,exportBackground:yp,isDebugMode:yp,isToolLocked:yp,isGridMode:yp,pageStates:vp(bp({pageId:Og,camera:bp({x:hp,y:hp,z:hp}),selectedShapeIds:vp(Hp),focusedGroupId:Hp.nullable()}))});function Av(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;var t;e.version!==Tv&&(e=Rh(e),(t=e).version,Ev.Initial,t.version=Tv);try{return Mv.validate(e)}catch(n){return console.warn(n),null}}function Ov(e){const t=e.query.ids("page");return ju("sessionStateSnapshot",(()=>{const n=e.get(Ug);if(!n)return null;const i=[...t.get()];return{version:Tv,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:i.map((t=>{const n=e.get(Wg.createId(t)),i=e.get(Ig.createId(t));return{pageId:t,camera:{x:(null==i?void 0:i.x)??0,y:(null==i?void 0:i.y)??0,z:(null==i?void 0:i.z)??1},selectedShapeIds:(null==n?void 0:n.selectedShapeIds)??[],focusedGroupId:(null==n?void 0:n.focusedGroupId)??null}}))}}))}function Dv(e,t){const n=Av(t);if(!n)return;const i=e.schema.types.instance.create({id:Ug,...Ng(e.get(Ug)),currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground}),s=e.allRecords().filter((e=>"instance_page_state"===e.typeName||"camera"===e.typeName));e.atomic((()=>{e.remove(s.map((e=>e.id)));for(const t of n.pageStates)e.put([Ig.create({id:Ig.createId(t.pageId),x:t.camera.x,y:t.camera.y,z:t.camera.z}),Wg.create({id:Wg.createId(t.pageId),pageId:t.pageId,selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId})]);e.put([i]),e.ensureStoreIsUsable()}))}function Rv(e,t){let n={};if("store"in t){const i=e.schema.migrateStoreSnapshot(t);if("success"!==i.type)throw new Error("Failed to migrate store snapshot: "+i.reason);n.document={schema:e.schema.serialize(),store:Xd(i.value,((t,{typeName:n})=>e.scopedTypes.document.has(n)))}}else n=t;const i=Ng(e.get(Ug));e.atomic((()=>{n.document&&e.loadStoreSnapshot(n.document),i&&e.update(Ug,(e=>({...e,...i}))),n.session&&Dv(e,n.session)}))}const Lv=new fd;function zv(e){const t=[],n=new Set;for(const i of e){if(n.has(i.type))throw new Error(`Binding type "${i.type}" is defined more than once`);t.push(i),n.add(i.type)}return t}function Fv({children:e,className:t="",...n}){return k.jsx("svg",{...n,className:I("tl-svg-container",t),children:e})}function Nv(e,t,n,i){const s=e.x-n.x,r=e.y-n.y,o=i.x-n.x,a=i.y-n.y,l=t.x-e.x,c=t.y-e.y,d=o*r-a*s,h=l*r-c*s,u=a*l-o*c;if(0===d||0===h)return null;if(0===u)return null;if(0!==u){const t=d/u,n=h/u;if(0<=t&&t<=1&&0<=n&&n<=1)return Am.AddXY(e,t*l,t*c)}return null}function $v(e,t,n,i){const s=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),r=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),o=r*r-4*s*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-i*i);if(o<0)return null;if(0===o)return null;const a=Math.sqrt(o),l=(-r+a)/(2*s),c=(-r-a)/(2*s);if((l<0||l>1)&&(c<0||c>1))return null;const d=[];return 0<=l&&l<=1&&d.push(Am.Lrp(e,t,l)),0<=c&&c<=1&&d.push(Am.Lrp(e,t,c)),0===d.length?null:d}function Bv(e,t,n){const i=[];let s;for(let r=0,o=n.length-1;r<o;r++)s=Nv(e,t,n[r],n[r+1]),s&&i.push(s);return 0===i.length?null:i}function Uv(e,t,n){const i=[];let s;for(let r=1,o=n.length;r<o+1;r++)s=Nv(e,t,n[r-1],n[r%n.length]),s&&i.push(s);return 0===i.length?null:i}function Kv(e,t,n){const i=[];let s,r,o;for(let a=0,l=n.length;a<l;a++)s=n[a],r=n[(a+1)%n.length],o=$v(s,r,e,t),o&&i.push(...o);return 0===i.length?null:i}function Hv(e,t,n){const i=[];let s,r,o;for(let a=1,l=n.length;a<l;a++)s=n[a-1],r=n[a],o=$v(s,r,e,t),o&&i.push(...o);return 0===i.length?null:i}function Vv(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Wv(e,t,n,i){return Vv(e,n,i)!==Vv(t,n,i)&&Vv(e,t,n)!==Vv(e,t,i)}function Yv(e,t){const n=new Map;let i,s,r,o;for(let a=0,l=e.length;a<l;a++)if(i=e[a],ny(i,t)){const e=Gv(i);n.has(e)||n.set(e,i)}for(let a=0,l=t.length;a<l;a++)if(i=t[a],ny(i,e)){const e=Gv(i);n.has(e)||n.set(e,i)}for(let a=0,l=e.length;a<l;a++){i=e[a],s=e[(a+1)%e.length];for(let e=0,a=t.length;e<a;e++){r=t[e],o=t[(e+1)%t.length];const a=Nv(i,s,r,o);if(null!==a){const e=Gv(a);n.has(e)||n.set(e,a)}}}return 0===n.size?null:function(e){const t=Am.Average(e);return e.sort(((e,n)=>Am.Angle(t,e)-Am.Angle(t,n)))}([...n.values()])}function Gv(e){return`${e.x},${e.y}`}function Xv(e,t){let n,i,s,r;for(let o=0,a=e.length;o<a;o++){n=e[o],i=e[(o+1)%a];for(let e=0,o=t.length;e<o;e++)if(s=t[e],r=t[(e+1)%o],Wv(n,i,s,r))return!0}return!1}function qv(e,t){let n,i,s,r;for(let o=0,a=e.length;o<a;o++){n=e[o],i=e[(o+1)%a];for(let e=1,o=t.length;e<o;e++)if(s=t[e-1],r=t[e],Wv(n,i,s,r))return!0}return!1}class Zv extends Gx{constructor(e){super({...e,isClosed:!1,isFilled:!1}),b(this,"start"),b(this,"end"),b(this,"d"),b(this,"u"),b(this,"ul");const{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:t,end:n,u:i,ul:s}=this;if(0===s)return t;const r=Am.Sub(e,t).dpr(i)/s,o=t.x+i.x*r;if(o<Math.min(t.x,n.x))return t.x<n.x?t:n;if(o>Math.max(t.x,n.x))return t.x>n.x?t:n;const a=t.y+i.y*r;return a<Math.min(t.y,n.y)?t.y<n.y?t:n:a>Math.max(t.y,n.y)?t.y>n.y?t:n:new Am(o,a)}hitTestLineSegment(e,t,n=0){return Wv(e,t,this.start,this.end)||this.distanceToLineSegment(e,t)<=n}getSvgPathData(e=!0){const{start:t,end:n}=this;return`${e?`M${t.toFixed()}`:""} L${n.toFixed()}`}}class Jv extends Gx{constructor(e){super({isClosed:!1,isFilled:!1,...e}),b(this,"points"),b(this,"_segments");const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){const n=e[t],i=e[t+1];this._segments.push(new Zv({start:n,end:i}))}this.isClosed&&this._segments.push(new Zv({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce(((e,t)=>e+t.length),0)}getVertices(){return this.points}nearestPoint(e){const{segments:t}=this;let n,i,s=this.points[0],r=1/0;for(let o=0;o<t.length;o++)n=t[o].nearestPoint(e),i=Am.Dist2(n,e),i<r&&(s=n,r=i);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(e,t,n=0){const{segments:i}=this;for(let s=0,r=i.length;s<r;s++)if(i[s].hitTestLineSegment(e,t,n))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce(((e,t,n)=>0===n?`M ${t.x} ${t.y}`:`${e} L ${t.x} ${t.y}`),"")}}class Qv extends Jv{constructor(e){super({...e}),this.isClosed=!0}}class eb extends Qv{constructor(e){const{x:t=0,y:n=0,width:i,height:s}=e;super({...e,points:[new Am(t,n),new Am(t+i,n),new Am(t+i,n+s),new Am(t,n+s)]}),b(this,"x"),b(this,"y"),b(this,"w"),b(this,"h"),this.x=t,this.y=n,this.w=i,this.h=s}getBounds(){return new Ux(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:e,y:t,w:n,h:i}=this;return`M${e},${t} h${n} v${i} h-${n}z`}}class tb{constructor(e){b(this,"canSnap",(()=>!0)),b(this,"canScroll",(()=>!1)),b(this,"canEdit",(()=>!1)),b(this,"canResize",(()=>!0)),b(this,"canEditInReadOnly",(()=>!1)),b(this,"canCrop",(()=>!1)),b(this,"canBeLaidOut",(()=>!0)),b(this,"hideResizeHandles",(()=>!1)),b(this,"hideRotateHandle",(()=>!1)),b(this,"hideSelectionBoundsBg",(()=>!1)),b(this,"hideSelectionBoundsFg",(()=>!1)),b(this,"isAspectRatioLocked",(()=>!1)),b(this,"onBeforeCreate"),b(this,"onBeforeUpdate"),b(this,"onDragShapesOver"),b(this,"onDragShapesOut"),b(this,"onDropShapesOver"),b(this,"onResizeStart"),b(this,"onResize"),b(this,"onResizeEnd"),b(this,"onTranslateStart"),b(this,"onTranslate"),b(this,"onTranslateEnd"),b(this,"onHandleDrag"),b(this,"onRotateStart"),b(this,"onRotate"),b(this,"onRotateEnd"),b(this,"onBindingChange"),b(this,"onChildrenChange"),b(this,"onDoubleClickHandle"),b(this,"onDoubleClickEdge"),b(this,"onDoubleClick"),b(this,"onClick"),b(this,"onEditEnd"),this.editor=e}canBind(e){return!0}providesBackgroundForChildren(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}}function nb({bounds:e,className:t}){const n=jm(),i=Ru("zoom level",(()=>n.getZoomLevel()),[n]);return k.jsx("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:s}=function(e,t,n={}){const{closed:i=!1,snap:s=1,start:r="outset",end:o="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,d=0,h=1,u=0,p=0;switch(l){case"dashed":h=1,c=Math.min(t*a,e/4);break;case"dotted":h=100,c=t/h;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return i||("outset"===r?(e+=c/2,p+=c/2):"skip"===r&&(e-=c,p-=c),"outset"===o?e+=c/2:"skip"===o&&(e-=c)),d=Math.floor(e/c/(2*h)),d-=d%s,d<3&&"dashed"===l?e/t<5?(c=e,d=1,u=0):(c=.333*e,u=.333*e):(d=Math.max(d,3),c=e/d/(2*h),i?(p=c/2,u=(e-d*c)/d):u=(e-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,u].join(" "),strokeDashoffset:p.toString()}}(e[0].dist(e[1]),1/i,{style:"dashed",lengthRatio:4});return k.jsx("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:s},t)}))})}b(tb,"props"),b(tb,"migrations"),b(tb,"type");class ib extends tb{constructor(){super(...arguments),b(this,"hideSelectionBoundsFg",(()=>!0)),b(this,"canBind",(()=>!1)),b(this,"onChildrenChange",(e=>{const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?(this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),void this.editor.deleteShapes([e.id])):1===t.length?(this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),void this.editor.deleteShapes([e.id])):void 0}))}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new eb({width:1,height:1,isFilled:!1}):new Xx({children:t.map((e=>{const t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),i=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new Qv({points:i,isFilled:!0}):new Jv({points:i})}))})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),i=n.length>0&&n.some((t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group"))),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||i))return null;const r=this.editor.getShapeGeometry(e).bounds;return k.jsx(Fv,{id:e.id,children:k.jsx(nb,{className:"tl-group",bounds:r})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return k.jsx(nb,{className:"",bounds:t})}}b(ib,"type","group"),b(ib,"props",Yf),b(ib,"migrations",Gf);const sb=[ib],rb=new Set(sb.map((e=>e.type)));function ob(e){const t=[...sb],n=new Set;for(const i of e){if(rb.has(i.type))throw new Error(`Shape type "${i.type}" is a core shapes type and cannot be overridden`);if(n.has(i.type))throw new Error(`Shape type "${i.type}" is defined more than once`);t.push(i),n.add(i.type)}return t}const ab={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function lb(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw wd(e)}}class cb{constructor(e){b(this,"map"),this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[n,i]of this){if(!lb(i,e.get(n)))return!1;t.add(n)}for(const[n,i]of e)if(!t.has(n)&&!lb(i,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class db extends cb{set(e,t){this.map.set(e,t)}applyValue(e,t){const n=this.get(e);if(n)switch(n.type){case"mixed":return;case"shared":return void(n.value!==t&&this.set(e,{type:"mixed"}));default:wd(n,"type")}else this.set(e,{type:"shared",value:t})}}function hb(e,t,n){if(0===n.length)return[];const i=new Map;for(const r of ud(n.map((t=>e.getShape(t))))){const{parentId:t}=r;i.has(t)||i.set(t,{children:ud(e.getSortedChildIdsForParent(t).map((t=>e.getShape(t)))),moving:new Set}),i.get(t).moving.add(r)}const s=[];switch(t){case"toBack":i.forEach((({moving:e,children:t})=>function(e,t,n){const i=t.length;if(e.size===i)return;let s,r;for(let o=0;o<i;o++){const n=t[o];if(!e.has(n)){r=n.index;break}s=n.index,e.delete(n)}if(0===e.size)return;{const t=hh(s,r,e.size);n.push(...Array.from(e.values()).sort(mh).map(((e,n)=>({...e,index:t[n]}))))}}(e,t,s)));break;case"toFront":i.forEach((({moving:e,children:t})=>function(e,t,n){const i=t.length;if(e.size===i)return;let s,r;for(let o=i-1;o>-1;o--){const n=t[o];if(!e.has(n)){s=n.index;break}r=n.index,e.delete(n)}if(0===e.size)return;{const t=hh(s,r,e.size);n.push(...Array.from(e.values()).sort(mh).map(((e,n)=>({...e,index:t[n]}))))}}(e,t,s)));break;case"forward":i.forEach((({moving:e,children:t})=>function(e,t,n){var i;const s=t.length;if(e.size===s)return;let r={name:"skipping"};for(let o=0;o<s;o++){const s=e.has(t[o]);switch(r.name){case"skipping":if(!s)continue;r={name:"selecting",selectIndex:o};break;case"selecting":{if(s)continue;const{selectIndex:e}=r;hh(t[o].index,null==(i=t[o+1])?void 0:i.index,o-e).forEach(((i,s)=>n.push({...t[e+s],index:i}))),r={name:"skipping"};break}}}}(e,t,s)));break;case"backward":i.forEach((({moving:e,children:t})=>function(e,t,n){var i;const s=t.length;if(e.size===s)return;let r={name:"skipping"};for(let o=s-1;o>-1;o--){const s=e.has(t[o]);switch(r.name){case"skipping":if(!s)continue;r={name:"selecting",selectIndex:o};break;case"selecting":if(s)continue;hh(null==(i=t[o-1])?void 0:i.index,t[o].index,r.selectIndex-o).forEach(((e,i)=>{n.push({...t[o+i+1],index:e})})),r={name:"skipping"}}}}(e,t,s)))}return s}function ub({editor:e}){const t=e.getSelectedShapes(),n=e.getSelectionRotation(),i=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:s}}=e;if(!i)return null;const r=i.center.clone().rotWith(i.point,n);return{selectionPageCenter:r,initialCursorAngle:r.angle(s),initialSelectionRotation:n,shapeSnapshots:t.map((t=>({shape:Rh(t),initialPagePoint:e.getShapePageTransform(t.id).point()})))}}function pb({delta:e,editor:t,snapshot:n,stage:i}){const{selectionPageCenter:s,shapeSnapshots:r}=n;t.updateShapes(r.map((({shape:n,initialPagePoint:i})=>{const r=Qp(n.parentId)?t.getShapePageTransform(n.parentId):Vx.Identity(),o=Am.RotWith(i,s,e),a=Vx.applyToPoint(Vx.Inverse(r),o),l=Hm(n.rotation+e);return{id:n.id,type:n.type,x:a.x,y:a.y,rotation:l}})));const o=[];r.forEach((({shape:e})=>{var n,s,r;const a=t.getShape(e.id);if(!a)return;const l=t.getShapeUtil(e);if("start"===i||"one-off"===i){const t=null==(n=l.onRotateStart)?void 0:n.call(l,e);t&&o.push(t)}const c=null==(s=l.onRotate)?void 0:s.call(l,e,a);if(c&&o.push(c),"end"===i||"one-off"===i){const t=null==(r=l.onRotateEnd)?void 0:r.call(l,e,a);t&&o.push(t)}})),o.length>0&&t.updateShapes(o)}const gb=(e,t,n)=>{for(;!zg(n.parentId);){const t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},fb=C.createContext(null);function mb({context:e,editor:t,children:n}){return k.jsx(Im.Provider,{value:t,children:k.jsx(fb.Provider,{value:e,children:n})})}function yb(){const e=C.useContext(fb);return e?{isDarkMode:e.isDarkMode}:null}class xb{constructor(e){b(this,"_clickId",""),b(this,"_clickTimeout"),b(this,"_clickScreenPoint"),b(this,"_previousScreenPoint"),b(this,"_getClickTimeout",((e,t=sv())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout((()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}}),"idle"===e||"pendingDouble"===e?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)})),b(this,"_clickState","idle"),b(this,"lastPointerInfo",{}),b(this,"handlePointerEvent",(e=>{switch(e.name){case"pointer_down":if(!this._clickState)return e;switch(this._clickScreenPoint=Am.From(e.point),this._previousScreenPoint&&Am.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}return this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pointer_up":if(!this._clickState)return e;switch(this._clickScreenPoint=Am.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e;case"pointer_move":return"idle"!==this._clickState&&this._clickScreenPoint&&Am.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e})),b(this,"cancelDoubleClickTimeout",(()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"})),this.editor=e}get clickState(){return this._clickState}}class wb{constructor(e){b(this,"_isEdgeScrolling",!1),b(this,"_edgeScrollDuration",-1),this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,n=this.getEdgeScroll();if(0===n.x&&0===n.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const e=t.options.edgeScrollEaseDuration>0?Mm.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*e,y:n.y*e})}}getEdgeProximityFactors(e,t,n,i,s){const{editor:r}=this,o=r.options.edgeScrollDistance,a=n?r.options.coarsePointerWidth:0,l=e-a,c=e+a,d=i?0:o,h=s?t:t-o;return l<d?Math.min(1,(d-l)/o):c>h?-Math.min(1,(c-h)/o):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[r,o,a,l]}=e.getInstanceState();return{x:this.getEdgeProximityFactors(t,i.w,s,l,o),y:this.getEdgeProximityFactors(n,i.h,s,r,a)}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked)return;if(0===e.x&&0===e.y)return;const n=t.getViewportScreenBounds(),i=n.w<1e3?.612:1,s=n.h<1e3?.612:1,r=t.getZoomLevel(),o=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,a=o*e.x*i/r,l=o*e.y*s/r,{x:c,y:d,z:h}=t.getCamera();t.setCamera(new Am(c+a,d+l,h))}}class vb{constructor(e){b(this,"isSafari"),b(this,"isIos"),b(this,"isChromeForIos"),b(this,"isFirefox"),b(this,"isAndroid"),this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}class bb{constructor(e,t){b(this,"disposeSideEffectListener"),this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",((e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?this.focus():this.blur(),this.updateContainerClass())}));t!==e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;null==(e=this.disposeSideEffectListener)||e.call(this)}}function Sb(e){return Cb}class kb{constructor(){b(this,"length",0),b(this,"head",null),b(this,"tail",this)}push(e){return new _b(e,this)}toArray(){return qh}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}const Cb=new kb;class _b{constructor(e,t){b(this,"length"),this.head=e,this.tail=t,this.length=t.length+1}push(e){return new _b(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}return{value:void 0,done:!0}}}}}class Pb{constructor(e){b(this,"store"),b(this,"dispose"),b(this,"state","recording"),b(this,"pendingDiff",new jb),b(this,"stacks",xu("HistoryManager.stacks",{undos:Sb(),redos:Sb()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos})),b(this,"annotateError"),b(this,"onBatchComplete",(()=>{})),b(this,"_isInBatch",!1),b(this,"batch",((e,t)=>{const n=this.state;"paused"!==n&&(null==t?void 0:t.history)&&(this.state=Ib[t.history]);try{if(this._isInBatch)return e(),this;this._isInBatch=!0;try{fu((()=>{e(),this.onBatchComplete()}))}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=n}})),b(this,"_undo",(({pushToRedoStack:e,toMark:t})=>{var n;const i=this.state;this.state="paused";try{let{undos:i,redos:s}=this.stacks.get();const r=this.pendingDiff.clear(),o=Bh(r),a=$h(r);e&&!o&&(s=s.push({type:"diff",diff:r}));let l=!1;if(o)for(;"stop"===(null==(n=i.head)?void 0:n.type);){const n=i.head;if(i=i.tail,e&&(s=s.push(n)),n.id===t){l=!0;break}}if(!l)e:for(;i.head;){const n=i.head;switch(i=i.tail,e&&(s=s.push(n)),n.type){case"diff":Kh(a,[$h(n.diff)]);break;case"stop":if(!t)break e;if(n.id===t)break e;break;default:wd(n)}}this.store.applyDiff(a,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:s})}finally{this.state=i}return this})),b(this,"undo",(()=>(this._undo({pushToRedoStack:!0}),this))),b(this,"redo",(()=>{var e;const t=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:t,redos:n}=this.stacks.get();if(0===n.length)return this;for(;"stop"===(null==(e=n.head)?void 0:e.type);)t=t.push(n.head),n=n.tail;const i={added:{},updated:{},removed:{}};for(;n.head;){const e=n.head;if(t=t.push(e),n=n.tail,"diff"!==e.type)break;Kh(i,[e.diff])}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:t,redos:n})}finally{this.state=t}return this})),b(this,"bail",(()=>(this._undo({pushToRedoStack:!1}),this))),b(this,"bailToMark",(e=>(this._undo({pushToRedoStack:!1,toMark:e}),this))),b(this,"squashToMark",(e=>{var t;let n=this.stacks.get().undos;const i=[];for(;n.head&&("stop"!==n.head.type||n.head.id!==e);)"diff"===n.head.type&&i.push(n.head.diff),n=n.tail;if(!n.head||(null==(t=n.head)?void 0:t.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(0===i.length)return this;const s={added:{},updated:{},removed:{}};return Kh(s,i.reverse()),this.stacks.update((({redos:e})=>({undos:n.push({type:"diff",diff:s}),redos:e}))),this})),b(this,"mark",((e=sv())=>(fu((()=>{this.flushPendingDiff(),this.stacks.update((({undos:t,redos:n})=>({undos:t.push({type:"stop",id:e}),redos:n})))})),e))),this.store=e.store,this.annotateError=e.annotateError??yd,this.dispose=this.store.addHistoryInterceptor(((e,t)=>{if("user"===t)switch(this.state){case"recording":this.pendingDiff.apply(e.changes),this.stacks.update((({undos:e})=>({undos:e,redos:Sb()})));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(e.changes);break;case"paused":break;default:wd(this.state)}}))}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update((({undos:t,redos:n})=>({undos:t.push({type:"diff",diff:e}),redos:n})))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}ignore(e){return this.batch(e,{history:"ignore"})}clear(){this.stacks.set({undos:Sb(),redos:Sb()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const Ib={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class jb{constructor(){b(this,"diff",{added:{},updated:{},removed:{}}),b(this,"isEmptyAtom",xu("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff={added:{},updated:{},removed:{}},this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){Kh(this.diff,[e]),this.isEmptyAtom.set(Bh(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class Eb{constructor(e){b(this,"scribbleItems",new Map),b(this,"state","paused"),b(this,"addScribble",((e,t=sv())=>{const n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),n})),b(this,"stop",(e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t})),b(this,"addPoint",((e,t,n)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:s}=i,r={x:t,y:n,z:.5};return(!s||Am.Dist(s,r)>=1)&&(i.next=r),i})),b(this,"tick",(e=>{0!==this.scribbleItems.size&&this.editor.batch((()=>{this.scribbleItems.forEach((t=>{if("starting"===t.scribble.state){const{next:e,prev:n}=t;return e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),void(t.scribble.points.length>8&&(t.scribble.state="active"))}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:n,timeoutMs:i,prev:s,next:r,scribble:o}=t;switch(o.state){case"active":r&&r!==s?(t.prev=r,o.points.push(r),0===n&&o.points.length>8&&o.points.shift()):0===i&&(o.points.length>1?o.points.shift():t.delayRemaining=o.delay);break;case"stopping":if(0===t.delayRemaining&&0===i){if(1===o.points.length)return void this.scribbleItems.delete(t.id);o.shrink&&(o.size=Math.max(1,o.size*(1-o.shrink))),o.points.shift()}}})),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map((({scribble:e})=>({...e,points:[...e.points]}))).slice(-5)})}))})),this.editor=e}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}}var Tb=Object.defineProperty,Mb=Object.getOwnPropertyDescriptor,Ab=(e,t,n,i)=>{for(var s,r=Mb(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);return r&&Tb(t,n,r),r};const Ob=e=>Math.round(e*10**8)/10**8;function Db(e,t,n,i,s){const r=e.filter((e=>("forward"===i?e.startNode.id===t:e.endNode.id===t)&&Ob(e.length)===Ob(n)&&ey(e.breadthIntersection[0],e.breadthIntersection[1],s[0],s[1])));if(0===r.length)return[];const o=new Set;return r.forEach((t=>{const a="forward"===i?t.endNode.id:t.startNode.id;if(!o.has(a)){o.add(a);const l=Db(e,a,n,i,ey(t.breadthIntersection[0],t.breadthIntersection[1],s[0],s[1]));r.push(...l)}})),r}class Rb{constructor(e){b(this,"editor"),this.manager=e,this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",(t=>{const n=e.getShapePageTransform(t.id);if(!n)return;const i=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;return n&&i?i.map(((e,i)=>{const{x:s,y:r}=Vx.applyToPoint(n,e);return{x:s,y:r,id:`${t.id}:${i}`}})):void 0}))}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(const i of t){const t=e.get(i);t&&n.push(...t)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),(e=>({id:e,pageBounds:bd(this.editor.getShapePageBounds(e))})))}getVisibleGaps(){const e=[],t=[];let n,i;const s=this.getSnappableGapNodes().sort(((e,t)=>e.pageBounds.minX-t.pageBounds.minX));for(let o=0;o<s.length;o++){n=s[o];for(let t=o+1;t<s.length;t++)i=s[t],n.pageBounds.maxX<i.pageBounds.minX&&Qm(n.pageBounds.minY,n.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:n,endNode:i,startEdge:[new Am(n.pageBounds.maxX,n.pageBounds.minY),new Am(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Am(i.pageBounds.minX,i.pageBounds.minY),new Am(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-n.pageBounds.maxX,breadthIntersection:ey(n.pageBounds.minY,n.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const r=s.sort(((e,t)=>e.pageBounds.minY-t.pageBounds.minY));for(let o=0;o<r.length;o++){n=r[o];for(let e=o+1;e<r.length;e++)i=r[e],n.pageBounds.maxY<i.pageBounds.minY&&Qm(n.pageBounds.minX,n.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:n,endNode:i,startEdge:[new Am(n.pageBounds.minX,n.pageBounds.maxY),new Am(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Am(i.pageBounds.minX,i.pageBounds.minY),new Am(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-n.pageBounds.maxY,breadthIntersection:ey(n.pageBounds.minX,n.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:i}){var s,r;const o=this.manager.getSnapThreshold(),a=this.getSnappablePoints(),l=t.clone().translate(i),c=n.map((({x:e,y:t},n)=>({id:"selection:"+n,x:e+i.x,y:t+i.y}))),d=a,h=[],u=[],p=new Am(o,o);this.collectPointSnaps({minOffset:p,nearestSnapsX:h,nearestSnapsY:u,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:h,nearestSnapsY:u,minOffset:p});const g=new Am("x"===e?0:(null==(s=h[0])?void 0:s.nudge)??0,"y"===e?0:(null==(r=u[0])?void 0:r.nudge)??0);p.x=0,p.y=0,h.length=0,u.length=0,c.forEach((e=>{e.x+=g.x,e.y+=g.y})),l.translate(g),this.collectPointSnaps({minOffset:p,nearestSnapsX:h,nearestSnapsY:u,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:h,nearestSnapsY:u,minOffset:p});const f=this.getPointSnapLines({nearestSnapsX:h,nearestSnapsY:u}),m=this.getGapSnapLines({selectionPageBounds:l,nearestSnapsX:h,nearestSnapsY:u});return this.manager.setIndicators([...m,...f]),{nudge:g}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:i,isResizingFromCenter:s}){var r,o;const a=this.manager.getSnapThreshold(),{box:l,scaleX:c,scaleY:d}=Ux.Resize(e,n,s?2*t.x:t.x,s?2*t.y:t.y,i);let h=n;c<0&&(h=function(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}(h)),d<0&&(h=function(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}(h)),s&&(l.center=e.center);const u="top"===h||"bottom"===h,p="left"===h||"right"===h,g=Lb(h,l),f=this.getSnappablePoints(),m=[],y=[],x=new Am(a,a);this.collectPointSnaps({minOffset:x,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:f,selectionSnapPoints:g});const w=new Am(u?0:(null==(r=m[0])?void 0:r.nudge)??0,p?0:(null==(o=y[0])?void 0:o.nudge)??0);if(i&&("top_left"===(v=h)||"top_right"===v||"bottom_right"===v||"bottom_left"===v)&&0!==w.len()){const t=m.length&&y.length?Math.abs(w.x)<Math.abs(w.y)?"x":"y":m.length?"x":"y",n=e.aspectRatio;"x"===t?(y.length=0,w.y=w.x/n,"bottom_left"!==h&&"top_right"!==h||(w.y=-w.y)):(m.length=0,w.x=w.y*n,"bottom_left"!==h&&"top_right"!==h||(w.x=-w.x))}var v;const b=Am.Add(t,w),{box:S}=Ux.Resize(e,n,s?2*b.x:b.x,s?2*b.y:b.y,i);s&&(S.center=e.center);const k=Lb("any",S);m.length=0,y.length=0,x.x=0,x.y=0,this.collectPointSnaps({minOffset:x,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:f,selectionSnapPoints:k});const C=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:y});return this.manager.setIndicators([...C]),{nudge:w}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:i,nearestSnapsY:s}){for(const r of e)for(const e of t){const t=Am.Sub(r,e),o=Math.abs(t.x),a=Math.abs(t.y);Ob(o)<=Ob(n.x)&&(Ob(o)<Ob(n.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:r,otherPoint:e},nudge:e.x-r.x}),n.x=o),Ob(a)<=Ob(n.y)&&(Ob(a)<Ob(n.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:r,otherPoint:e},nudge:e.y-r.y}),n.y=a)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:i}){const{horizontal:s,vertical:r}=this.getVisibleGaps();for(const o of s){if(!Qm(o.breadthIntersection[0],o.breadthIntersection[1],e.minY,e.maxY))continue;const i=o.startEdge[0].x+o.length/2-e.center.x;if(o.length>e.width&&Ob(Math.abs(i))<=Ob(t.x)){Ob(Math.abs(i))<Ob(t.x)&&(n.length=0),t.x=Math.abs(i);const e={type:"gap_center",gap:o,nudge:i},s=n.find((({type:e})=>"gap_center"===e)),r=s&&ey(o.breadthIntersection[0],o.breadthIntersection[1],s.gap.breadthIntersection[0],s.gap.breadthIntersection[1]);s&&s.gap.length>o.length&&r?n[n.indexOf(s)]=e:s&&r||n.push(e)}const s=o.startNode.pageBounds.minX-o.length-e.maxX;Ob(Math.abs(s))<=Ob(t.x)&&(Ob(Math.abs(s))<Ob(t.x)&&(n.length=0),t.x=Math.abs(s),n.push({type:"gap_duplicate",gap:o,protrusionDirection:"left",nudge:s}));const r=o.endNode.pageBounds.maxX+o.length-e.minX;Ob(Math.abs(r))<=Ob(t.x)&&(Ob(Math.abs(r))<Ob(t.x)&&(n.length=0),t.x=Math.abs(r),n.push({type:"gap_duplicate",gap:o,protrusionDirection:"right",nudge:r}))}for(const o of r){if(!Qm(o.breadthIntersection[0],o.breadthIntersection[1],e.minX,e.maxX))continue;const n=o.startEdge[0].y+o.length/2-e.center.y;if(o.length>e.height&&Ob(Math.abs(n))<=Ob(t.y)){Ob(Math.abs(n))<Ob(t.y)&&(i.length=0),t.y=Math.abs(n);const e={type:"gap_center",gap:o,nudge:n},s=i.find((({type:e})=>"gap_center"===e)),r=s&&Qm(s.gap.breadthIntersection[0],s.gap.breadthIntersection[1],o.breadthIntersection[0],o.breadthIntersection[1]);s&&s.gap.length>o.length&&r?i[i.indexOf(s)]=e:s&&r||i.push(e);continue}const s=o.startNode.pageBounds.minY-o.length-e.maxY;Ob(Math.abs(s))<=Ob(t.y)&&(Ob(Math.abs(s))<Ob(t.y)&&(i.length=0),t.y=Math.abs(s),i.push({type:"gap_duplicate",gap:o,protrusionDirection:"top",nudge:s}));const r=o.endNode.pageBounds.maxY+o.length-e.minY;Ob(Math.abs(r))<=Ob(t.y)&&(Ob(Math.abs(r))<Ob(t.y)&&(i.length=0),t.y=Math.abs(r),i.push({type:"gap_duplicate",gap:o,protrusionDirection:"bottom",nudge:r}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const n={},i={};if(e.length>0)for(const s of e)if("points"===s.type){const e=Ob(s.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(s.points)}if(t.length>0)for(const s of t)if("points"===s.type){const e=Ob(s.points.otherPoint.y);i[e]||(i[e]=[]),i[e].push(s.points)}return Object.values(n).concat(Object.values(i)).map((e=>({id:sv(),type:"points",points:hd(e.map((e=>Am.From(e.otherPoint))).concat(e.map((e=>Am.From(e.thisPoint)))),((e,t)=>e.equals(t)))})))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),r={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},o=[];if(t.length>0)for(const a of t){if("points"===a.type)continue;const{gap:{breadthIntersection:t,startEdge:n,startNode:i,endNode:l,length:c,endEdge:d}}=a;switch(a.type){case"gap_center":{const a=(c-e.width)/2,h=ey(t[0],t[1],e.minY,e.maxY);o.push({type:"gaps",direction:"horizontal",id:sv(),gaps:[...Db(s,i.id,a,"backward",h),{startEdge:n,endEdge:r.left},{startEdge:r.right,endEdge:d},...Db(s,l.id,a,"forward",h)]});break}case"gap_duplicate":{const h=ey(t[0],t[1],e.minY,e.maxY);o.push({type:"gaps",direction:"horizontal",id:sv(),gaps:"left"===a.protrusionDirection?[{startEdge:r.right,endEdge:n.map((e=>e.clone().addXY(-i.pageBounds.width,0)))},{startEdge:n,endEdge:d},...Db(s,l.id,c,"forward",h)]:[...Db(s,i.id,c,"backward",h),{startEdge:n,endEdge:d},{startEdge:d.map((e=>e.clone().addXY(a.gap.endNode.pageBounds.width,0))),endEdge:r.left}]});break}}}if(n.length>0)for(const a of n){if("points"===a.type)continue;const{gap:{breadthIntersection:t,startEdge:n,startNode:s,endNode:l,length:c,endEdge:d}}=a;switch(a.type){case"gap_center":{const l=(c-e.height)/2,h=ey(t[0],t[1],e.minX,e.maxX);o.push({type:"gaps",direction:"vertical",id:sv(),gaps:[...Db(i,s.id,l,"backward",h),{startEdge:n,endEdge:r.top},{startEdge:r.bottom,endEdge:d},...Db(i,a.gap.endNode.id,l,"forward",h)]});break}case"gap_duplicate":{const h=ey(t[0],t[1],e.minX,e.maxX);o.push({type:"gaps",direction:"vertical",id:sv(),gaps:"top"===a.protrusionDirection?[{startEdge:r.bottom,endEdge:n.map((e=>e.clone().addXY(0,-s.pageBounds.height)))},{startEdge:n,endEdge:d},...Db(i,l.id,c,"forward",h)]:[...Db(i,s.id,c,"backward",h),{startEdge:n,endEdge:d},{startEdge:d.map((e=>e.clone().addXY(0,l.pageBounds.height))),endEdge:r.top}]})}}}return function(e){e.sort(((e,t)=>t.gaps.length-e.gaps.length));for(let t=e.length-1;t>0;t--){const n=e[t];for(let i=t-1;i>=0;i--){const s=e[i];if(s.direction===n.direction&&n.gaps.every((e=>s.gaps.some((t=>Ob(e.startEdge[0].x)===Ob(t.startEdge[0].x)&&Ob(e.startEdge[0].y)===Ob(t.startEdge[0].y)&&Ob(e.startEdge[1].x)===Ob(t.startEdge[1].x)&&Ob(e.startEdge[1].y)===Ob(t.startEdge[1].y)))&&s.gaps.some((t=>Ob(e.endEdge[0].x)===Ob(t.endEdge[0].x)&&Ob(e.endEdge[0].y)===Ob(t.endEdge[0].y)&&Ob(e.endEdge[1].x)===Ob(t.endEdge[1].x)&&Ob(e.endEdge[1].y)===Ob(t.endEdge[1].y)))))){e.splice(t,1);break}}}}(o),o}}function Lb(e,t){const{minX:n,maxX:i,minY:s,maxY:r}=t,o=[];switch(e){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:n,y:s})}switch(e){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:i,y:s})}switch(e){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:i,y:r})}switch(e){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:n,y:r})}return o}Ab([ju],Rb.prototype,"getSnapPointsCache"),Ab([ju],Rb.prototype,"getSnappablePoints"),Ab([ju],Rb.prototype,"getSnappableGapNodes"),Ab([ju],Rb.prototype,"getVisibleGaps");var zb=Object.defineProperty,Fb=Object.getOwnPropertyDescriptor;const Nb=()=>null,$b=()=>[];class Bb{constructor(e){b(this,"editor"),this.manager=e,this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",(t=>{const n=e.getShapeUtil(t).getHandleSnapGeometry(t);return{outline:void 0===n.outline?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:n.getSelfSnapOutline??Nb,getSelfSnapPoints:n.getSelfSnapPoints??$b}}))}*iterateSnapPointsInPageSpace(e,t){var n,i;const s=null==(n=this.getSnapGeometryCache().get(e))?void 0:n.getSelfSnapPoints(t);if(s&&s.length){const t=bd(this.editor.getShapePageTransform(e));for(const e of s)yield t.applyToPoint(e)}for(const r of this.manager.getSnappableShapes()){if(r===e)continue;const t=null==(i=this.getSnapGeometryCache().get(r))?void 0:i.points;if(!t||!t.length)continue;const n=bd(this.editor.getShapePageTransform(r));for(const e of t)yield n.applyToPoint(e)}}*iterateSnapOutlines(e,t){var n,i;const s=null==(n=this.getSnapGeometryCache().get(e))?void 0:n.getSelfSnapOutline(t);s&&(yield{shapeId:e,outline:s});for(const r of this.manager.getSnappableShapes()){if(r===e)continue;const t=null==(i=this.getSnapGeometryCache().get(r))?void 0:i.outline;t&&(yield{shapeId:r,outline:t})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){const i=this.manager.getSnapThreshold();let s=i,r=null;for(const l of this.iterateSnapPointsInPageSpace(e,t))Am.DistMin(n,l,s)&&(s=Am.Dist(n,l),r=l);if(r)return r;let o=i,a=null;for(const{shapeId:l,outline:c}of this.iterateSnapOutlines(e,t)){const e=bd(this.editor.getShapePageTransform(l)),t=this.editor.getPointInShapeSpace(l,n),i=c.nearestPoint(t),s=e.applyToPoint(i);Am.DistMin(n,s,o)&&(o=Am.Dist(n,s),a=s)}return a||null}snapHandle({currentShapeId:e,handle:t}){const n=bd(this.editor.getShapePageTransform(e)).applyToPoint(t),i=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n});return i?(this.manager.setIndicators([{id:sv(),type:"points",points:[i]}]),{nudge:Am.Sub(i,n)}):null}}((e,t,n,i)=>{for(var s,r=Fb(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);r&&zb(t,n,r)})([ju],Bb.prototype,"getSnapGeometryCache");var Ub=Object.defineProperty,Kb=Object.getOwnPropertyDescriptor,Hb=(e,t,n,i)=>{for(var s,r=Kb(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);return r&&Ub(t,n,r),r};class Vb{constructor(e){b(this,"shapeBounds"),b(this,"handles"),b(this,"_snapIndicators",xu("snapLines",void 0)),this.editor=e,this.shapeBounds=new Rb(this),this.handles=new Bb(this)}getIndicators(){return this._snapIndicators.get()??qh}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),n=e.getSelectedShapeIds(),i=new Set,s=r=>{if(Qp(r)){const t=e.getShape(r);t&&e.isShapeOfType(t,"frame")&&i.add(r)}const o=e.getSortedChildIdsForParent(r);for(const a of o){if(n.includes(a))continue;const r=e.getShape(a);if(!r)continue;if(!e.getShapeUtil(r).canSnap(r))continue;const o=e.getShapePageBounds(a);o&&t.includes(o)&&(e.isShapeOfType(r,"group")?s(a):i.add(a))}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Hb([ju],Vb.prototype,"getSnapThreshold"),Hb([ju],Vb.prototype,"getSnappableShapes"),Hb([ju],Vb.prototype,"getCurrentCommonAncestor");const Wb=/\r?\n|\r/g;function Yb(e){return e.replace(Wb,"\n").split("\n").map((e=>e||" ")).join("\n")}const Gb={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},Xb=/\s/;class qb{constructor(e){b(this,"baseElm"),b(this,"measureText",((e,t)=>{var n;const i=null==(n=this.baseElm)?void 0:n.cloneNode();this.baseElm.insertAdjacentElement("afterend",i),i.setAttribute("dir","auto"),i.style.setProperty("unicode-bidi","plaintext"),i.style.setProperty("font-family",t.fontFamily),i.style.setProperty("font-style",t.fontStyle),i.style.setProperty("font-weight",t.fontWeight),i.style.setProperty("font-size",t.fontSize+"px"),i.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),i.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),i.style.setProperty("min-width",null===t.minWidth?null:t.minWidth+"px"),i.style.setProperty("padding",t.padding),i.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),i.textContent=Yb(e);const s=i.scrollWidth,r=i.getBoundingClientRect();return i.remove(),{x:0,y:0,w:r.width,h:r.height,scrollWidth:s}})),this.editor=e;const t=this.editor.getContainer(),n=document.createElement("div");n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.tabIndex=-1,t.appendChild(n),this.baseElm=n,e.disposables.add((()=>{n.remove()}))}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const n=[],i=e.getBoundingClientRect(),s=-i.left,r=-i.top,o=new Range,a=e.childNodes[0];let l=0,c=null,d=null,h=0,u=0,p=!1;for(const g of e.childNodes)if(g.nodeType===Node.TEXT_NODE)for(const e of g.textContent??""){o.setStart(a,l),o.setEnd(a,l+e.length);const i=o.getClientRects(),g=i[i.length-1],f=g.top+r,m=g.left+s,y=g.right+s,x=m<u,w=Xb.test(e);if(w===d&&f===h&&c)x&&(c.box.x=m),c.box.w=x?c.box.w+g.width:y-c.box.x,c.text+=e;else{if(c){if(t&&f!==h){p=!0;break}n.push(c)}c={box:{x:m,y:f,w:g.width,h:g.height},text:e},u=m}"\n"===e&&(u=0),d=w,h=f,l+=e.length}return c&&n.push(c),{spans:n,didTruncate:p}}measureTextSpans(e,t){var n;if(""===e)return[];const i=null==(n=this.baseElm)?void 0:n.cloneNode();this.baseElm.insertAdjacentElement("afterend",i);const s=Math.ceil(t.width-2*t.padding);i.setAttribute("dir","auto"),i.style.setProperty("unicode-bidi","plaintext"),i.style.setProperty("width",`${s}px`),i.style.setProperty("height","min-content"),i.style.setProperty("font-size",`${t.fontSize}px`),i.style.setProperty("font-family",t.fontFamily),i.style.setProperty("font-weight",t.fontWeight),i.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),i.style.setProperty("text-align",Gb[t.textAlign]);const r="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;r&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all"));const o=Yb(e);i.textContent=o;const{spans:a,didTruncate:l}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:r});if("truncate-ellipsis"===t.overflow&&l){i.textContent="â¦";const e=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",s-e+"px"),i.textContent=o;const n=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,r=n[n.length-1];return n.push({text:"â¦",box:{x:Math.min(r.box.x+r.box.w,t.width-t.padding-e),y:r.box.y,w:e,h:r.box.h}}),n}return i.remove(),a}}const Zb=Mh;class Jb{constructor(e){b(this,"cancelRaf"),b(this,"isPaused",!0),b(this,"now",0),b(this,"start",(()=>{var e;this.isPaused=!1,null==(e=this.cancelRaf)||e.call(this),this.cancelRaf=Zb(this.tick),this.now=Date.now()})),b(this,"tick",(()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=Zb(this.tick)})),b(this,"dispose",(()=>{var e;this.isPaused=!0,null==(e=this.cancelRaf)||e.call(this)})),b(this,"prevPoint",new Am),b(this,"updatePointerVelocity",(e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:i}}}=this;if(0===e)return;const s=Am.Sub(n,t);this.prevPoint=n.clone();const r=s.len(),o=r?s.div(r):new Am(0,0),a=i.clone().lrp(o.mul(r/e),.5);Math.abs(a.x)<.01&&(a.x=0),Math.abs(a.y)<.01&&(a.y=0),i.equals(a)||(this.editor.inputs.pointerVelocity=a)})),this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var Qb=Object.defineProperty,eS=Object.getOwnPropertyDescriptor,tS=(e,t,n,i)=>{for(var s,r=eS(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);return r&&Qb(t,n,r),r};class nS{constructor(e,t){var n;if(b(this,"systemColorScheme",xu("systemColorScheme","light")),b(this,"updateUserPreferences",(e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})})),this.user=e,this.inferDarkMode=t,window){const e=null==(n=window.matchMedia)?void 0:n.call(window,"(prefers-color-scheme: dark)");(null==e?void 0:e.matches)&&this.systemColorScheme.set("dark"),null==e||e.addEventListener("change",(e=>{e.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")}))}}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??dv.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??dv.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??dv.name}getLocale(){return this.user.userPreferences.get().locale??dv.locale}getColor(){return this.user.userPreferences.get().color??dv.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??dv.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??dv.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??dv.isDynamicSizeMode}}tS([ju],nS.prototype,"getUserPreferences"),tS([ju],nS.prototype,"getIsDarkMode"),tS([ju],nS.prototype,"getEdgeScrollSpeed"),tS([ju],nS.prototype,"getAnimationSpeed"),tS([ju],nS.prototype,"getId"),tS([ju],nS.prototype,"getName"),tS([ju],nS.prototype,"getLocale"),tS([ju],nS.prototype,"getColor"),tS([ju],nS.prototype,"getIsSnapMode"),tS([ju],nS.prototype,"getIsWrapMode"),tS([ju],nS.prototype,"getIsDynamicResizeMode");const iS={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},sS=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class rS{constructor(e,t){b(this,"performanceTracker"),b(this,"id"),b(this,"type"),b(this,"shapeType"),b(this,"initial"),b(this,"children"),b(this,"parent"),b(this,"_path"),b(this,"_current"),b(this,"_isActive"),b(this,"transition",((e,t={})=>{var n;const i=e.split(".");let s=this;for(let r=0;r<i.length;r++){const e=i[r],o=s.getCurrent(),a=null==(n=s.children)?void 0:n[e];if(!a)throw Error(`${s.id} - no child state exists with the id ${e}.`);if((null==o?void 0:o.id)!==a.id&&(null==o||o.exit(t,e),s._current.set(a),a.enter(t,(null==o?void 0:o.id)||"initial"),!a.getIsActive()))break;s=a}return this})),b(this,"handleEvent",(e=>{var t;const n=iS[e.name],i=this._current.__unsafe__getWithoutCapture();null==(t=this[n])||t.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&i&&i===this._current.__unsafe__getWithoutCapture()&&i.handleEvent(e)})),b(this,"enter",((e,t)=>{var n;if(vy.measurePerformance.get()&&sS.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),null==(n=this.onEnter)||n.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const n=this.children[this.initial];this._current.set(n),n.enter(e,t)}})),b(this,"exit",((e,t)=>{var n,i;vy.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),null==(n=this.onExit)||n.call(this,e,t),this.getIsActive()||null==(i=this.getCurrent())||i.exit(e,t)})),b(this,"_currentToolIdMask",xu("curent tool id mask",void 0)),b(this,"onWheel"),b(this,"onPointerDown"),b(this,"onPointerMove"),b(this,"onLongPress"),b(this,"onPointerUp"),b(this,"onDoubleClick"),b(this,"onTripleClick"),b(this,"onQuadrupleClick"),b(this,"onRightClick"),b(this,"onMiddleClick"),b(this,"onKeyDown"),b(this,"onKeyUp"),b(this,"onKeyRepeat"),b(this,"onCancel"),b(this,"onComplete"),b(this,"onInterrupt"),b(this,"onTick"),b(this,"onEnter"),b(this,"onExit"),this.editor=e;const{id:n,children:i,initial:s}=this.constructor;this.id=n,this._isActive=xu("toolIsActive"+this.id,!1),this._current=xu("toolState"+this.id,void 0),this._path=ju("toolPath"+this.id,(()=>{const e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")})),this.parent=t??{},this.parent?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map((e=>[e.id,new e(this.editor,this)]))),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map((e=>[e.id,new e(this.editor,this)]))),this._current.set(this.children[this.initial]))),this.performanceTracker=new dd}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}b(rS,"id"),b(rS,"initial"),b(rS,"children");class oS extends rS{constructor(){super(...arguments),b(this,"onKeyDown",(e=>{var t;if("KeyZ"===e.code)if(!e.shiftKey&&!e.ctrlKey){const n=this.getCurrent();n&&"idle"===(null==(t=n.getCurrent())?void 0:t.id)&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:n.id})}}))}}b(oS,"id","root"),b(oS,"initial",""),b(oS,"children",(()=>[]));var aS=Object.defineProperty,lS=Object.getOwnPropertyDescriptor,cS=(e,t,n,i)=>{for(var s,r=lS(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);return r&&aS(t,n,r),r};class dS extends _v{constructor({store:e,user:t,shapeUtils:n,bindingUtils:i,tools:s,getContainer:r,cameraOptions:o,assetOptions:a,initialState:l,autoFocus:c,inferDarkMode:d,options:h}){super(),b(this,"options"),b(this,"store"),b(this,"root"),b(this,"disposables",new Set),b(this,"isDisposed",!1),b(this,"_tickManager"),b(this,"snaps"),b(this,"timers"),b(this,"user"),b(this,"textMeasure"),b(this,"environment"),b(this,"scribbles"),b(this,"sideEffects"),b(this,"edgeScrollManager"),b(this,"focusManager"),b(this,"getContainer"),b(this,"shapeUtils"),b(this,"styleProps"),b(this,"bindingUtils"),b(this,"history"),b(this,"_crashingError",null),b(this,"_updateInstanceState",((e,t)=>{this.batch((()=>{this.store.put([{...this.getInstanceState(),...e}])}),t)})),b(this,"_isChangingStyleTimeout",-1),b(this,"setCursor",(e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this))),b(this,"_updateCurrentPageState",((e,t)=>{this.batch((()=>{this.store.update(e.id??this.getCurrentPageState().id,(t=>({...t,...e})))}),{history:"ignore",...t})})),b(this,"_cameraOptions",xu("camera options",hy)),b(this,"_viewportAnimation",null),b(this,"_willSetInitialBounds",!0),b(this,"_isLockedOnFollowingUser",xu("isLockedOnFollowingUser",!1)),b(this,"_cameraState",xu("camera state","idle")),b(this,"_cameraStateTimeoutRemaining",0),b(this,"_decayCameraStateTimeout",(e=>{this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))})),b(this,"_tickCameraState",(()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this._cameraState.__unsafe__getWithoutCapture()&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))})),b(this,"_currentPageShapeIds"),b(this,"_assetOptions",xu("asset options",uy)),b(this,"_parentIdsToChildIds"),b(this,"animatingShapes",new Map),b(this,"_updateShapes",(e=>{this.getInstanceState().isReadonly||this.batch((()=>{var t,n;const i=[];let s,r;for(let o=0,a=e.length;o<a;o++){const a=e[o];a&&(s=this.getShape(a.id),s&&(r=uS(s,a),r!==s&&(r=(null==(n=(t=this.getShapeUtil(s)).onBeforeUpdate)?void 0:n.call(t,s,r))??r,i.push(r))))}this.store.put(i)}))})),b(this,"externalAssetContentHandlers",{file:null,url:null}),b(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),b(this,"inputs",{originPagePoint:new Am,originScreenPoint:new Am,previousPagePoint:new Am,previousScreenPoint:new Am,currentPagePoint:new Am,currentScreenPoint:new Am,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new Am}),b(this,"_clickManager",new xb(this)),b(this,"_prevCursor","default"),b(this,"_shiftKeyTimeout",-1),b(this,"_setShiftKeyTimeout",(()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})})),b(this,"_altKeyTimeout",-1),b(this,"_setAltKeyTimeout",(()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})})),b(this,"_ctrlKeyTimeout",-1),b(this,"_setCtrlKeyTimeout",(()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})})),b(this,"_restoreToolId","select"),b(this,"_pinchStart",1),b(this,"_didPinch",!1),b(this,"_selectedShapeIdsAtPointerDown",[]),b(this,"_longPressTimeout",-1),b(this,"capturedPointerId",null),b(this,"performanceTracker"),b(this,"performanceTrackerTimeout",-1),b(this,"dispatch",(e=>(this._pendingEventsForNextTick.push(e),"pointer"===e.type&&"pointer_move"===e.name||"wheel"===e.type||"pinch"===e.type||this._flushEventsForTick(0),this))),b(this,"_pendingEventsForNextTick",[]),b(this,"_flushEventForTick",(e=>{if(this.getCrashingError())return this;const{inputs:t}=this,{type:n}=e;if("misc"===e.type)return"cancel"!==e.name&&"complete"!==e.name||(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),void this.root.handleEvent(e);e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:i,currentPagePoint:s}=t;t.isPointing||(t.isDragging=!1);const r=this.store.unsafeGetWithoutCapture(Ug),o=this.store.get(this._getCurrentPageStateId()),a=this._cameraOptions.__unsafe__getWithoutCapture();switch(n){case"pinch":if(a.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;return void(t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...o.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt()));case"pinch":{if(!t.isPinching)return;const{point:{z:n=1},delta:{x:i,y:s}}=e,{x:o,y:l}=Am.SubXY(e.point,r.screenBounds.x,r.screenBounds.y);this.stopCameraAnimation(),r.followingUserId&&this.stopFollowingUser();const{x:c,y:d,z:h}=nu((()=>this.getCamera())),{panSpeed:u,zoomSpeed:p}=a;return void this._setCamera(new Am(c+i*u/h-o/h+o/(n*p),d+s*u/h-l/h+l/(n*p),n*p),{immediate:!0})}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:e}=this;return this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],void(this._didPinch&&(this._didPinch=!1,e.length>0&&this.once("tick",(()=>{this._didPinch||this.setSelectedShapes(e)}))))}}case"wheel":if(a.isLocked)return;if(this._updateInputsFromEvent(e),this.getIsMenuOpen());else{const{panSpeed:n,zoomSpeed:i,wheelBehavior:s}=a;if("none"!==s){this.stopCameraAnimation(),r.followingUserId&&this.stopFollowingUser();const{x:o,y:a,z:l}=nu((()=>this.getCamera())),{x:c,y:d,z:h=0}=e.delta;let u=s;switch(t.ctrlKey&&(u="pan"===s?"zoom":"pan"),u){case"zoom":{const{x:e,y:t}=this.inputs.currentScreenPoint;let n=h;"zoom"===s&&(n=Math.abs(d)>10?10*Math.sign(d)/100:d/100);const r=l+(n??0)*i*l;return this._setCamera(new Am(o+(e/r-e)-(e/l-e),a+(t/r-t)-(t/l-t),r),{immediate:!0}),void this.maybeTrackPerformance("Zooming")}case"pan":return this._setCamera(new Am(o+c*n/l,a+d*n/l,l),{immediate:!0}),void this.maybeTrackPerformance("Panning")}}}break;case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:n}=e,{isPenMode:o}=r;switch(e.name){case"pointer_down":if(o&&!n)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout((()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})}),this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!o&&n&&this.updateInstanceState({isPenMode:!0}),5===e.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!n&&o)return;const{x:e,y:l,z:c}=nu((()=>this.getCamera()));if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:t,previousScreenPoint:n}=this.inputs,{panSpeed:i}=a,s=Am.Sub(t,n);return this.setCamera(new Am(e+s.x*i/c,l+s.y*i/c,c),{immediate:!0}),void this.maybeTrackPerformance("Panning")}t.isPointing&&!t.isDragging&&Am.Dist2(i,s)*this.getZoomLevel()>(r.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/c&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),this.getIsMenuOpen())return;if(r.isPenMode&&!n)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1);const n=this.inputs.pointerVelocity,i=Math.min(2,n.len());switch(e.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}i>0&&this.slideCamera({speed:i,direction:n})}else 5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),e.name){case"key_down":t.keys.add(e.code),"Space"!==e.code||e.ctrlKey||(this.inputs.isPanning||(this._prevCursor=r.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break;case"key_up":t.keys.delete(e.code),"Space"===e.code&&(this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===e.type){1===e.button?e.name="middle_click":e.button===my&&(e.name="right_click");const{isPenMode:t}=this.store.unsafeGetWithoutCapture(Ug);if(e.isPen===t){const t=this._clickManager.handlePointerEvent(e);if(e.name!==t.name)return this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),void this.emit("event",t)}}return this.root.handleEvent(e),this.emit("event",e),this})),this.options={...ab,...h},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new Pb({store:e,annotateError:e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)}}),this.snaps=new Vb(this),this.timers=new Ah,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...hy,...o}),this._assetOptions.set({...uy,...a}),this.user=new nS(t??kv(),d??!1),this.getContainer=r??(()=>document.body),this.textMeasure=new qb(this),this._tickManager=new Jb(this);class u extends oS{}b(u,"initial",l??""),this.root=new u(this),this.root.children={};const p=ob(n),g={},f={},m=new Map;for(const b of p){const e=new b(this);g[b.type]=e;const t=tg(b.props??{});f[b.type]=t;for(const n of t.keys())if(m.has(n.id)){if(m.get(n.id)!==n)throw Error(`Multiple style props with id "${n.id}" in use. Style prop IDs must be unique.`)}else m.set(n.id,n)}this.shapeUtils=g,this.styleProps=f;const y=zv(i),x={};for(const b of y){const e=new b(this);x[b.type]=e}this.bindingUtils=x;for(const b of[...s]){if(Kd(this.root.children,b.id))throw Error(`Can't override tool with id "${b.id}"`);this.root.children[b.id]=new b(this,this.root)}this.environment=new vb(this),this.scribbles=new Eb(this);const w=(e,t)=>{let n=null;const i=e.selectedShapeIds.filter((e=>!t.has(e)));i.length!==e.selectedShapeIds.length&&(n||(n={...e}),n.selectedShapeIds=i);const s=e.erasingShapeIds.filter((e=>!t.has(e)));s.length!==e.erasingShapeIds.length&&(n||(n={...e}),n.erasingShapeIds=s),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(n||(n={...e}),n.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(n||(n={...e}),n.editingShapeId=null);const r=e.hintingShapeIds.filter((e=>!t.has(e)));return r.length!==e.hintingShapeIds.length&&(n||(n={...e}),n.hintingShapeIds=r),e.focusedGroupId&&t.has(e.focusedGroupId)&&(n||(n={...e}),n.focusedGroupId=null),n};this.sideEffects=this.store.sideEffects;let v=new Map;const S=new Set,k=new Set;let C=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler((()=>{var e,t,n,i;S.clear();for(const s of k){k.delete(s);const t=this.getShape(s);if(!t)continue;const n=this.getShapeUtil(t),i=null==(e=n.onChildrenChange)?void 0:e.call(n,t);(null==i?void 0:i.length)&&this.updateShapes(i)}if(C.size){const e=C;C=new Set;for(const n of e){const e=this.getBindingUtil(n);null==(t=e.onOperationComplete)||t.call(e)}}if(v.size){const e=v;v=new Map;for(const t of e.values())null==(i=(n=this.getBindingUtil(t.binding)).onAfterDelete)||i.call(n,t)}this.emit("update")}))),this.disposables.add(this.sideEffects.register({shape:{afterChange:(e,t)=>{var n,i,s,r;for(const o of this.getBindingsInvolvingShape(t))C.add(o.type),o.fromId===t.id&&(null==(i=(n=this.getBindingUtil(o)).onAfterChangeFromShape)||i.call(n,{binding:o,shapeBefore:e,shapeAfter:t})),o.toId===t.id&&(null==(r=(s=this.getBindingUtil(o)).onAfterChangeToShape)||r.call(s,{binding:o,shapeBefore:e,shapeAfter:t}));if(e.parentId!==t.parentId){const e=e=>{var t,n,i,s;const r=this.getShape(e);if(r)for(const o of this.getBindingsInvolvingShape(r))C.add(o.type),o.fromId===r.id&&(null==(n=(t=this.getBindingUtil(o)).onAfterChangeFromShape)||n.call(t,{binding:o,shapeBefore:r,shapeAfter:r})),o.toId===r.id&&(null==(s=(i=this.getBindingUtil(o)).onAfterChangeToShape)||s.call(i,{binding:o,shapeBefore:r,shapeAfter:r}))};e(t.id),this.visitDescendants(t.id,e)}if(e.parentId!==t.parentId&&zg(t.parentId)){const n=new Set([e.id]);this.visitDescendants(e.id,(e=>{n.add(e)}));for(const e of this.getPageStates()){if(e.pageId===t.parentId)continue;const i=w(e,n);i&&this.store.put([i])}}e.parentId&&Qp(e.parentId)&&k.add(e.parentId),t.parentId!==e.parentId&&Qp(t.parentId)&&k.add(t.parentId)},beforeDelete:e=>{var t,n,i,s;if(S.has(e.id))return;e.parentId&&Qp(e.parentId)&&k.add(e.parentId),S.add(e.id);const r=[];for(const l of this.getBindingsInvolvingShape(e)){C.add(l.type),r.push(l.id);const o=this.getBindingUtil(l);l.fromId===e.id?(null==(t=o.onBeforeIsolateToShape)||t.call(o,{binding:l,removedShape:e}),null==(n=o.onBeforeDeleteFromShape)||n.call(o,{binding:l,shape:e})):(null==(i=o.onBeforeIsolateFromShape)||i.call(o,{binding:l,removedShape:e}),null==(s=o.onBeforeDeleteToShape)||s.call(o,{binding:l,shape:e}))}r.length&&this.deleteBindings(r);const o=new Set([e.id]),a=ud(this.getPageStates().map((e=>w(e,o))));a.length&&this.store.put(a)}},binding:{beforeCreate:e=>{var t,n;const i=null==(n=(t=this.getBindingUtil(e)).onBeforeCreate)?void 0:n.call(t,{binding:e});return i||e},afterCreate:e=>{var t,n;C.add(e.type),null==(n=(t=this.getBindingUtil(e)).onAfterCreate)||n.call(t,{binding:e})},beforeChange:(e,t)=>{var n,i;const s=null==(i=(n=this.getBindingUtil(t)).onBeforeChange)?void 0:i.call(n,{bindingBefore:e,bindingAfter:t});return s||t},afterChange:(e,t)=>{var n,i;C.add(t.type),null==(i=(n=this.getBindingUtil(t)).onAfterChange)||i.call(n,{bindingBefore:e,bindingAfter:t})},beforeDelete:e=>{var t,n;null==(n=(t=this.getBindingUtil(e)).onBeforeDelete)||n.call(t,{binding:e})},afterDelete:e=>{var t,n;null==(n=(t=this.getBindingUtil(e)).onAfterDelete)||n.call(t,{binding:e}),C.add(e.type)}},page:{afterCreate:e=>{const t=Ig.createId(e.id),n=Wg.createId(e.id);this.store.has(t)||this.store.put([Ig.create({id:t})]),this.store.has(n)||this.store.put([Wg.create({id:n,pageId:e.id})])},afterDelete:(e,t)=>{var n,i;if((null==(n=this.getInstanceState())?void 0:n.currentPageId)===e.id){const n=null==(i=this.getPages().find((t=>t.id!==e.id)))?void 0:i.id;n?this.store.put([{...this.getInstanceState(),currentPageId:n}]):"user"===t&&this.store.ensureStoreIsUsable()}const s=Ig.createId(e.id),r=Wg.createId(e.id);this.store.remove([s,r])}},instance:{afterChange:(e,t,n)=>{var i;if(!this.store.has(t.currentPageId)){const s=this.store.has(e.currentPageId)?e.currentPageId:null==(i=this.getPages()[0])?void 0:i.id;s?this.store.update(t.id,(e=>({...e,currentPageId:s}))):"user"===n&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(e,t)=>{if((null==e?void 0:e.selectedShapeIds)!==(null==t?void 0:t.selectedShapeIds)){const e=t.selectedShapeIds.filter((e=>{var n,i;let s=null==(n=this.getShape(e))?void 0:n.parentId;for(;Qp(s);){if(t.selectedShapeIds.includes(s))return!1;s=null==(i=this.getShape(s))?void 0:i.parentId}return!0}));let n=null;if(e.length>0){const t=this.findCommonAncestor(ud(e.map((e=>this.getShape(e)))),(e=>this.isShapeOfType(e,"group")));t&&(n=t)}else(null==t?void 0:t.focusedGroupId)&&(n=t.focusedGroupId);e.length===t.selectedShapeIds.length&&n===t.focusedGroupId||this.store.put([{...t,selectedShapeIds:e,focusedGroupId:n??null}])}}}})),this._currentPageShapeIds=((e,t)=>{const n=e.query.ids("shape");let i=null;function s(){const s=t();return i=s,new Set([...n.get()].filter((t=>gb(e,s,e.get(t)))))}return ju("_shapeIdsInCurrentPage",((n,r)=>{if(bu(n))return s();const o=t();if(o!==i)return s();const a=e.history.getDiffSince(r);if(a===Jh)return s();const l=new oc(n);for(const t of a){for(const n of Object.values(t.added))Jp(n)&&gb(e,o,n)&&l.add(n.id);for(const[n,i]of Object.values(t.updated))Jp(i)&&(gb(e,o,i)?l.add(i.id):l.remove(i.id));for(const e of Object.keys(t.removed))Qp(e)&&l.remove(e)}const c=l.get();return c?ku(c.value,c.diff):n}))})(this.store,(()=>this.getCurrentPageId())),this._parentIdsToChildIds=(e=>{const t=e.query.ids("shape"),n=e.query.filterHistory("shape");function i(){const n={},i=t.get(),s=Array(i.size);return i.forEach((t=>s.push(e.get(t)))),s.sort(mh),s.forEach((e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)})),n}return ju("parentsToChildrenWithIndexes",((t,s)=>{if(bu(t))return i();const r=n.getDiffSince(s);if(r===Jh)return i();if(0===r.length)return t;let o=null;const a=e=>{o||(o={...t}),o[e]?o[e]===t[e]&&(o[e]=[...o[e]]):o[e]=[]},l=new Set;let c;for(let e=0,n=r.length;e<n;e++){c=r[e];for(const e of Object.values(c.added))Jp(e)&&(a(e.parentId),o[e.parentId].push(e.id),l.add(o[e.parentId]));for(const[e,t]of Object.values(c.updated))if(Jp(t)&&Jp(e))if(e.parentId!==t.parentId)a(e.parentId),a(t.parentId),o[e.parentId].splice(o[e.parentId].indexOf(t.id),1),o[t.parentId].push(t.id),l.add(o[t.parentId]);else if(e.index!==t.index){a(t.parentId);const e=o[t.parentId].indexOf(t.id);o[t.parentId][e]=t.id,l.add(o[t.parentId])}for(const e of Object.values(c.removed))Jp(e)&&(a(e.parentId),o[e.parentId].splice(o[e.parentId].indexOf(e.id),1))}for(const n of l){const t=ud(n.map((t=>e.get(t))));t.sort(mh),n.splice(0,n.length,...t.map((e=>e.id)))}return o??t}))})(this.store),this.disposables.add(this.store.listen((e=>{this.emit("change",e)}))),this.disposables.add(this.history.dispose),this.history.ignore((()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})})),l&&void 0===this.root.children[l])throw Error(`No state found for initialState "${l}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new wb(this),this.focusManager=new bb(this,c),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame((()=>{this._tickManager.start()})),this.performanceTracker=new dd}dispose(){this.disposables.forEach((e=>e())),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t="string"==typeof e?e:e.type,n=Hd(this.shapeUtils,t);return vd(n,`No shape util found for type "${t}"`),n}getBindingUtil(e){const t="string"==typeof e?e:e.type,n=Hd(this.bindingUtils,t);return vd(n,`No binding util found for type "${t}"`),n}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return this.history.mark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}batch(e,t){return this.history.batch(e,t),this}annotateError(e,{origin:t,willCrashApp:n,tags:i,extras:s}){const r=this.createErrorAnnotations(t,n);return Cd(e,{tags:{...r.tags,...i},extras:{...r.extras,...s}}),n&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:n?this.getShape(n):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const e=t.pop();if(!e)return!0;const i=n.getCurrent();if((null==i?void 0:i.id)!==e)return!1;if(0===t.length)return!0;n=i}return!1}isInAny(...e){return e.some((e=>this.isIn(e)))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var t;const n=e.split(".").reverse();let i=this.root;for(;n.length>0;){const e=n.pop();if(!e)return i;const s=null==(t=i.children)?void 0:t[e];if(!s)return;i=s}return i}getDocumentSettings(){return this.store.get(af)}updateDocumentSettings(e){return this.history.ignore((()=>{this.store.put([{...this.getDocumentSettings(),...e}])})),this}getInstanceState(){return this.store.get(Ug)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout((()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})}),2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){const t=new Set(this.getOpenMenus());return t.has(e)||(t.add(e),this.updateInstanceState({openMenus:[...t]})),this}deleteOpenMenu(e){const t=new Set(this.getOpenMenus());return t.has(e)&&(t.delete(e),this.updateInstanceState({openMenus:[...t]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Wg.createId(this.getCurrentPageId())}updateCurrentPageState(e,t){return this._updateCurrentPageState(e,t),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return ud(e.map((e=>this.store.get(e))))}setSelectedShapes(e){return this.batch((()=>{const t=e.map((e=>"string"==typeof e?e:e.id)),{selectedShapeIds:n}=this.getCurrentPageState(),i=new Set(n);if(t.length===i.size&&t.every((e=>i.has(e))))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])}),{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t="string"==typeof e?e:(null==e?void 0:e.id)??null,n=this.getShape(t);if(!n)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(n,(e=>i.includes(e.id)))}select(...e){const t="string"==typeof e[0]?e:e.map((e=>e.id));return this.setSelectedShapes(t),this}deselect(...e){const t="string"==typeof e[0]?e:e.map((e=>e.id)),n=this.getSelectedShapeIds();return n.length>0&&t.length>0&&this.setSelectedShapes(n.filter((e=>!t.includes(e)))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return(null==(e=this.getOnlySelectedShape())?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return 1===e.length?e[0]:null}getSelectionPageBounds(){const e=this.getCurrentPageState().selectedShapeIds;return 0===e.length?null:Ux.Common(ud(e.map((e=>this.getShapePageBounds(e)))))}getSelectionRotation(){const e=this.getSelectedShapeIds();let t=!1,n=0;for(let i=0,s=e.length;i<s;i++){const s=this.getShapePageTransform(e[i]);if(s)if(t){if(s.rotation()!==n)return 0}else t=!0,n=s.rotation()}return n}getSelectionRotatedPageBounds(){const e=this.getSelectedShapeIds();if(0===e.length)return;const t=this.getSelectionRotation();if(0===t)return this.getSelectionPageBounds();if(1===e.length){const t=this.getShapeGeometry(e[0]).bounds.clone(),n=this.getShapePageTransform(e[0]);return t.point=n.applyToPoint(t.point),t}const n=Ux.FromPoints(this.getSelectedShapeIds().flatMap((e=>{const t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).bounds.corners):[]})).map((e=>e.rot(-t))));return n.point=n.point.rot(t),n}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:n}=this.pageToScreen(e.point),i=this.getZoomLevel();return new Ux(t,n,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t="string"==typeof e?e:(null==e?void 0:e.id)??null;if(null!==t){const e=this.getShape(t);if(!e)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(e,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${e.type}`)}return t===this.getFocusedGroupId()?this:this.batch((()=>{this.store.update(this.getCurrentPageState().id,(e=>({...e,focusedGroupId:t})))}),{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,(e=>this.isShapeOfType(e,"group")));this.setFocusedGroup((null==t?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t="string"==typeof e?e:(null==e?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const e=this.getShape(t);if(e&&this.getShapeUtil(e).canEdit(e))return this._updateCurrentPageState({editingShapeId:t}),this}this._updateCurrentPageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t="string"==typeof e?e:(null==e?void 0:e.id)??null;return t===this.getHoveredShapeId()||this.updateCurrentPageState({hoveredShapeId:t},{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return ud(this.getHintingShapeIds().map((e=>this.getShape(e))))}setHintingShapes(e){const t="string"==typeof e[0]?e:e.map((e=>e.id));return this.updateCurrentPageState({hintingShapeIds:hd(t)},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return ud(this.getErasingShapeIds().map((e=>this.getShape(e))))}setErasingShapes(e){const t="string"==typeof e[0]?e:e.map((e=>e.id));t.sort();const n=this.getErasingShapeIds();return this.history.ignore((()=>{if(t.length===n.length){for(let e=0;e<t.length;e++)if(t[e]!==n[e]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})})),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t="string"==typeof e?e:(null==e?void 0:e.id)??null;if(t!==this.getCroppingShapeId())if(t){const e=this.getShape(t),n=this.getShapeUtil(e);e&&n.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:t})}else this.updateCurrentPageState({croppingShapeId:null});return this}getCameraId(){return Ig.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this.getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find((t=>t.userId===e));if(!t)return null;const{w:n,h:i}=t.screenBounds,{x:s,y:r,z:o}=t.camera,a=new Ux(-s,-r,n/o,i/o),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints)return 1;if("default"===e.constraints.initialZoom)return 1;const{zx:t,zy:n}=fS(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw wd(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints)return 1;if("default"===e.constraints.baseZoom)return 1;const{zx:t,zy:n}=fS(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw wd(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var t;const n=Rh({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return(null==(t=n.zoomSteps)?void 0:t.length)<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this}getConstrainedCamera(e,t){const n=this.getCamera();let{x:i,y:s,z:r=n.z}=e;if(!(null==t?void 0:t.force)){const e=this.getCameraOptions(),o=e.zoomSteps[0],a=pd(e.zoomSteps),l=this.getViewportScreenBounds();if(e.constraints){const{constraints:c}=e,d=Math.min(c.padding.y,l.w/2),h=Math.min(c.padding.x,l.h/2),u=Ux.From(e.constraints.bounds),p=(l.w-2*h)/u.w,g=(l.h-2*d)/u.h,f=this.getBaseZoom(),m=a*f,y=o*f;if((null==t?void 0:t.reset)&&(r=this.getInitialZoom()),r<y||r>m){const{x:e,y:t,z:o}=n,a=-e+l.w/o/2,c=-t+l.h/o/2;r=$m(r,y,m);i=e+(-e+l.w/r/2)-a,s=t+(-t+l.h/r/2)-c}const x=h/r-u.x,w=d/r-u.y,v=(l.w-2*h)/r-u.w,b=(l.h-2*d)/r-u.h,S=x+v*c.origin.x,k=w+b*c.origin.y,C="string"==typeof c.behavior?c.behavior:c.behavior.x,_="string"==typeof c.behavior?c.behavior:c.behavior.y;if(null==t?void 0:t.reset)i=S,s=k;else{switch(C){case"fixed":i=S;break;case"contain":i=r<p?S:$m(i,x+v,x);break;case"inside":i=r<p?$m(i,x,(l.w-h)/r-u.w):$m(i,x+v,x);break;case"outside":i=$m(i,h/r-u.w,(l.w-h)/r);break;case"free":break;default:throw wd(C)}switch(_){case"fixed":s=k;break;case"contain":s=r<g?k:$m(s,w+b,w);break;case"inside":s=r<g?$m(s,w,(l.h-d)/r-u.h):$m(s,w+b,w);break;case"outside":s=$m(s,d/r-u.h,(l.h-d)/r);break;case"free":break;default:throw wd(_)}}}else if(r>a||r<o){const{x:e,y:t,z:c}=n;r=$m(r,o,a),i=e+(-e+l.w/r/2)-(-e+l.w/c/2),s=t+(-t+l.h/r/2)-(-t+l.h/c/2)}}return{x:i,y:s,z:r}}_setCamera(e,t){const n=this.getCamera(),{x:i,y:s,z:r}=this.getConstrainedCamera(e,t);return n.x===i&&n.y===s&&n.z===r||this.batch((()=>{const e={...n,x:i,y:s,z:r};this.history.ignore((()=>{this.store.put([e])}));const{currentScreenPoint:o,currentPagePoint:a}=this.inputs,{screenBounds:l}=this.store.unsafeGetWithoutCapture(Ug);if(o.x/r-i!==a.x||o.y/r-s!==a.y){const e={type:"pointer",target:"canvas",name:"pointer_move",point:Am.AddXY(o,l.x,l.y),pointerId:gy,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};(null==t?void 0:t.immediate)?this._flushEventForTick(e):this.dispatch(e)}this._tickCameraState()})),this}setCamera(e,t){const{isLocked:n}=this._cameraOptions.__unsafe__getWithoutCapture();if(n&&!(null==t?void 0:t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=Am.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),void 0!==i.z&&Number.isFinite(i.z)||(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(i,t);if(null==t?void 0:t.animation){const{width:e,height:n}=this.getViewportScreenBounds();this._animateToViewport(new Ux(-s.x,-s.y,e/s.z,n/s.z),t)}else this._setCamera(s,{...t,force:!0});return this}centerOnPoint(e,t){if(this.getCameraOptions().isLocked)return this;const{width:n,height:i}=this.getViewportPageBounds();return this.setCamera(new Am(-(e.x-n/2),-(e.y-i/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const n=Ux.Common(ud(t.map((e=>this.getShapePageBounds(e)))));return this.zoomToBounds(n,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:n,constraints:i}=this.getCameraOptions();if(n)return this;const s=this.getCamera(),{x:r,y:o,z:a}=s,{x:l,y:c}=e;let d=1;if(i){const e=this.getInitialZoom();a!==e&&(d=e)}return this.setCamera(new Am(r+(l/d-l)-(l/a-l),o+(c/d-c)-(c/a-c),d),t),this}zoomIn(e=this.getViewportScreenCenter(),t){if(this.getCameraOptions().isLocked)return this;const{x:n,y:i,z:s}=this.getCamera(),{zoomSteps:r}=this.getCameraOptions();if(null!==r&&r.length>1){const o=this.getBaseZoom();let a=pd(r)*o;for(let e=1;e<r.length;e++){const t=r[e-1]*o,n=r[e]*o;if(!(n-s<=(n-t)/2)){a=n;break}}this.setCamera(new Am(n+(e.x/a-e.x)-(e.x/s-e.x),i+(e.y/a-e.y)-(e.y/s-e.y),a),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){if(this.getCameraOptions().isLocked)return this;const{zoomSteps:n}=this.getCameraOptions();if(null!==n&&n.length>1){const i=this.getBaseZoom(),{x:s,y:r,z:o}=this.getCamera();let a=n[0]*i;for(let e=n.length-1;e>0;e--){const t=n[e-1]*i,s=n[e]*i;if(!(s-o>=(s-t)/2)){a=t;break}}this.setCamera(new Am(s+(e.x/a-e.x)-(e.x/o-e.x),r+(e.y/a-e.y)-(e.y/o-e.y),a),t)}return this}zoomToSelection(e){if(this.getCameraOptions().isLocked)return this;const t=this.getSelectionPageBounds();return t&&this.zoomToBounds(t,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const n=this._cameraOptions.__unsafe__getWithoutCapture();if(n.isLocked)return this;const i=this.getViewportScreenBounds(),s=(null==t?void 0:t.inset)??Math.min(128,.28*i.width),r=this.getBaseZoom(),o=n.zoomSteps[0],a=pd(n.zoomSteps);let l=$m(Math.min((i.width-s)/e.w,(i.height-s)/e.h),o*r,a*r);return void 0!==(null==t?void 0:t.targetZoom)&&(l=Math.min(t.targetZoom,l)),this.setCamera(new Am(-e.x+(i.width-e.w*l)/2/l,-e.y+(i.height-e.h*l)/2/l,l),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:n,duration:i,start:s,end:r}=this._viewportAnimation;if(t>i)return this.off("tick",this._animateViewport),this._viewportAnimation=null,void this._setCamera(new Am(-r.x,-r.y,this.getViewportScreenBounds().width/r.width));const o=n(1-(i-t)/i),a=s.minX+(r.minX-s.minX)*o,l=s.minY+(r.minY-s.minY)*o,c=s.maxX+(r.maxX-s.maxX)*o;this._setCamera(new Am(-a,-l,this.getViewportScreenBounds().width/(c-a)),{force:!0})}_animateToViewport(e,t={animation:py}){const{animation:n,...i}=t;if(!n)return;const{duration:s=0,easing:r=Mm.easeInOutCubic}=n,o=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===s||0===o?this._setCamera(new Am(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:s/o,easing:r,start:a.clone(),end:e.clone()},this.once("stop-camera-animation",(()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null})),this.on("tick",this._animateViewport),this)}slideCamera(e={}){if(this.getCameraOptions().isLocked)return this;if(0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();const{speed:t,friction:n=this.options.cameraSlideFriction,direction:i,speedThreshold:s=.01}=e;let r=Math.min(t,1);const o=()=>{this.off("tick",a),this.off("stop-camera-animation",o)};this.once("stop-camera-animation",o);const a=e=>{const{x:t,y:a,z:l}=this.getCamera(),c=Am.Mul(i,r*e/l);r*=1-n,r<s?o():this._setCamera(new Am(t+c.x,a+c.y,l))};return this.on("tick",a),this}zoomToUser(e,t={animation:{duration:500}}){const n=this.getCollaborators().find((t=>t.userId===e));return n?(this.batch((()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=n.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(n.currentPageId),t&&t.animation&&!i&&(t.animation=void 0),this.centerOnPoint(n.cursor,t);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,e]}),this.timers.setTimeout((()=>{const t=[...this.getInstanceState().highlightedUserIds],n=t.indexOf(e);n<0||(t.splice(n,1),this.updateInstanceState({highlightedUserIds:t}))}),this.options.collaboratorIdleTimeoutMs)})),this):this}updateViewportScreenBounds(e,t=!1){e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const n=[0!==e.minY,!Um(document.body.scrollWidth,e.maxX,1),!Um(document.body.scrollHeight,e.maxY,1),0!==e.minX],{screenBounds:i,insets:s}=this.getInstanceState();if(e.equals(i)&&n.every(((e,t)=>e===s[t])))return this;const{_willSetInitialBounds:r}=this;if(this._willSetInitialBounds=!1,r)this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const t=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.centerOnPoint(t)}else this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this._setCamera(Am.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:n,h:i}=this.getInstanceState().screenBounds;return new Ux(e,t,n,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new Am(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:i,z:s}=this.getCamera();return new Ux(-n,-i,e/s,t/s)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(Ug),{x:n,y:i,z:s=1}=this.getCamera();return new Am((e.x-t.x)/s-n,(e.y-t.y)/s-i,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(Ug),{x:n,y:i,z:s=1}=this.getCamera();return new Am((e.x+n)*s+t.x,(e.y+i)*s+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:n,z:i=1}=this.getCamera();return new Am((e.x+t)*i,(e.y+n)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",(()=>({userId:{neq:this.user.getId()}})))}getCollaborators(){const e=this._getCollaboratorsQuery().get();if(!e.length)return qh;return[...new Set(e.map((e=>e.userId)))].sort().map((t=>e.filter((e=>e.userId===t)).sort(((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp))[0]))}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter((t=>t.currentPageId===e))}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter((t=>t.userId===e));if(!t.length)return console.warn("User not found"),this;const n=this.user.getId();if(n||console.warn("You should set the userId for the current instance before following a user"),t.some((e=>e.followingUserId===n)))return this;const i=ju("latestLeaderPresence",(()=>this.getCollaborators().find((t=>t.userId===e))));return fu((()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const t=cu("update current page",(()=>{const e=i.get();e?e.currentPageId!==this.getCurrentPageId()&&this.getPage(e.currentPageId)&&this.history.ignore((()=>{this.store.put([{...this.getInstanceState(),currentPageId:e.currentPageId}]),this._isLockedOnFollowingUser.set(!0)})):this.stopFollowingUser()})),n=()=>{t(),this._isLockedOnFollowingUser.set(!1),this.off("frame",s),this.off("stop-following",n)},s=()=>{if(!i.get())return void this.stopFollowingUser();if(this._isLockedOnFollowingUser.get())return;const e=this.user.getAnimationSpeed();if(0===e)return void this._isLockedOnFollowingUser.set(!0);const t=this.getViewportPageBoundsForFollowing();if(!t)return void this.stopFollowingUser();const n=this.getViewportPageBounds(),s=Math.abs(t.minX-n.minX)+Math.abs(t.maxX-n.maxX),r=Math.abs(t.minY-n.minY)+Math.abs(t.maxY-n.maxY);if(s<this.options.followChaseViewportSnap&&r<this.options.followChaseViewportSnap)return void this._isLockedOnFollowingUser.set(!0);const o=$m(.5*e,.1,.8),a=new Ux($d(n.minX,t.minX,o),$d(n.minY,t.minY,o),$d(n.width,t.width,o),$d(n.height,t.height,o)),l=new Am(-a.x,-a.y,this.getViewportScreenBounds().width/a.width);this.stopCameraAnimation(),this._setCamera(l)};this.once("stop-following",n),this.addListener("frame",s),s()})),this}stopFollowingUser(){return this.history.ignore((()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")})),this}getUnorderedRenderingShapes(e){const t=[];let n=2*this.options.maxShapesPerPage,i=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),r=(o,a,l)=>{const c=this.getShape(o);if(!c)return;a*=c.opacity;let d=!1;const h=this.getShapeUtil(c);e&&(d=!l&&s.includes(o),d&&(a*=.32)),t.push({id:o,shape:c,util:h,index:n,backgroundIndex:i,opacity:a}),n+=1,i+=1;const u=this.getSortedChildIdsForParent(o);if(!u.length)return;let p=null;h.providesBackgroundForChildren(c)&&(p=i,i=n,n+=this.options.maxShapesPerPage);for(const e of u)r(e,a,l||d);null!==p&&(i=p)},o=e?[this.getCurrentPage()]:this.getPages();for(const a of o)for(const e of this.getSortedChildIdsForParent(a.id))r(e,1,!1);return t}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(yh)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(mh)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get("string"==typeof e?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t="string"==typeof e?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map((e=>e.id)))}setCurrentPage(e){const t="string"==typeof e?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.batch((()=>this.store.put([{...this.getInstanceState(),currentPageId:t}])),{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){if(this.getInstanceState().isReadonly)return this;return this.getPage(e.id)?this.batch((()=>this.store.update(e.id,(t=>({...t,...e}))))):this}createPage(e){return this.history.batch((()=>{if(this.getInstanceState().isReadonly)return;if(this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),n=function(e,t){var n;let i=e;const s=new Set(t);for(;s.has(i);)i=(null==(n=/^.*(\d+)$/.exec(i))?void 0:n[1])?i.replace(/(\d+)(?=\D?)$/,(e=>(+e+1).toString())):`${i} 1`;return i}(e.name??"Page 1",t.map((e=>e.name)));let i=e.index;i&&!t.some((e=>e.index===i))||(i=gh(t[t.length-1].index));const s=Lg.create({meta:{},...e,name:n,index:i});this.store.put([s])})),this}deletePage(e){const t="string"==typeof e?e:e.id;return this.batch((()=>{if(this.getInstanceState().isReadonly)return;const e=this.getPages();if(1===e.length)return;const n=this.getPage(t);if(n){if(t===this.getCurrentPageId()){const n=e.findIndex((e=>e.id===t)),i=e[n-1]??e[n+1];this.setCurrentPage(i.id)}this.store.remove([n.id])}})),this}duplicatePage(e,t=Lg.createId()){if(this.getPages().length>=this.options.maxPages)return this;const n="string"==typeof e?e:e.id,i=this.getPage(n);if(!i)return this;const s={...this.getCamera()},r=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.batch((()=>{var e;const n=this.getPages(),o=ph(i.index,null==(e=n[n.indexOf(i)+1])?void 0:e.index);if(this.createPage({name:i.name+" Copy",id:t,index:o}),this.setCurrentPage(t),this.setCamera(s),r)return this.putContentOntoCurrentPage(r)})),this}renamePage(e,t){const n="string"==typeof e?e:e.id;return this.getInstanceState().isReadonly||this.updatePage({id:n,name:t}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getInstanceState().isReadonly||e.length<=0||this.history.ignore((()=>this.store.put(e))),this}updateAssets(e){return this.getInstanceState().isReadonly||e.length<=0||this.history.ignore((()=>{this.store.put(e.map((e=>({...this.store.get(e.id),...e}))))})),this}deleteAssets(e){if(this.getInstanceState().isReadonly)return this;const t="string"==typeof e[0]?e:e.map((e=>e.id));return t.length<=0||this.history.ignore((()=>this.store.remove(t))),this}getAsset(e){return this.store.get("string"==typeof e?e:e.id)}async resolveAssetUrl(e,t){if(!e)return"";const n=this.getAsset(e);if(!n)return"";const{screenScale:i,shouldResolveToOriginalImage:s}=t,r=Math.max(.125,(o=i||1,Math.pow(2,Math.ceil(Math.log2(o)))));var o;const a="connection"in navigator?navigator.connection.effectiveType:null,l=this.getInstanceState().devicePixelRatio;return await this._assetOptions.get().onResolveAsset(n,{screenScale:i||1,steppedScreenScale:r,dpr:l,networkEffectiveType:a,shouldResolveToOriginalImage:s})}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",(e=>this.getShapeUtil(e).getGeometry(e)),((e,t)=>e.props===t.props))}getShapeGeometry(e){return this._getShapeGeometryCache().get("string"==typeof e?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",(e=>{var t,n;return null==(n=(t=this.getShapeUtil(e)).getHandles)?void 0:n.call(t,e)}))}getShapeHandles(e){return this._getShapeHandlesCache().get("string"==typeof e?e:e.id)}getShapeLocalTransform(e){const t="string"==typeof e?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return Vx.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",(e=>{if(zg(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??Vx.Identity();return Vx.Compose(t,this.getShapeLocalTransform(e))}))}getShapeParentTransform(e){const t="string"==typeof e?e:e.id,n=this.getShape(t);return!n||zg(n.parentId)?Vx.Identity():this._getShapePageTransformCache().get(n.parentId)??Vx.Identity()}getShapePageTransform(e){const t="string"==typeof e?e:e.id;return this._getShapePageTransformCache().get(t)??Vx.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",(e=>{const t=this._getShapePageTransformCache().get(e.id);if(!t)return new Ux;return Ux.FromPoints(Vx.applyToPoints(t,this.getShapeGeometry(e).vertices))}))}getShapePageBounds(e){return this._getShapePageBoundsCache().get("string"==typeof e?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",(e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";const n=this._getShapePageTransformCache().get(e.id);if(!n)return;return`polygon(${Vx.applyToPoints(Vx.Inverse(n),t).map((e=>`${e.x}px ${e.y}px`)).join(",")})`}))}getShapeClipPath(e){return this._getShapeClipPathCache().get("string"==typeof e?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",(e=>{if(zg(e.parentId))return;const t=this.getShapeAncestors(e.id).filter((e=>this.isShapeOfType(e,"frame")));if(0===t.length)return;return t.map((e=>this._getShapePageTransformCache().get(e.id).applyToPoints(this.getShapeGeometry(e).vertices))).reduce(((e,t)=>{if(!t||!e)return;const n=Yv(e,t);return n?n.map(Am.Cast):[]}))}))}getShapeMask(e){return this._getShapeMaskCache().get("string"==typeof e?e:e.id)}getShapeMaskedPageBounds(e){return"string"!=typeof e&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",(e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const n=this._getShapeMaskCache().get(e.id);if(n){if(0===n.length)return;const{corners:e}=t;if(e.every(((e,t)=>e&&Am.Equals(e,n[t]))))return t.clone();const i=Yv(n,e);if(!i)return;return Ux.FromPoints(i)}return t}))}getShapeAncestors(e,t=[]){const n="string"==typeof e?e:e.id,i=this.getShape(n);if(!i)return t;const s=i.parentId;if(zg(s))return t.reverse(),t;const r=this.store.get(s);return r?(t.push(r),this.getShapeAncestors(r,t)):t}findShapeAncestor(e,t){const n="string"==typeof e?e:e.id,i=this.getShape(n);if(!i)return;const s=i.parentId;if(zg(s))return;const r=this.getShape(s);return r?t(r)?r:this.findShapeAncestor(r,t):void 0}hasAncestor(e,t){const n="string"==typeof e?e:null==e?void 0:e.id,i=n&&this.getShape(n);return!!i&&(i.parentId===t||this.hasAncestor(this.getShapeParent(i),t))}findCommonAncestor(e,t){var n;if(0===e.length)return;const i=ud(("string"==typeof e[0]?e:e.map((e=>e.id))).map((e=>this.getShape(e))));if(1===i.length){const e=i[0].parentId;if(zg(e))return;return t?null==(n=this.findShapeAncestor(i[0],t))?void 0:n.id:e}const[s,...r]=i;let o=this.getShapeParent(s);for(;o;)if(!t||t(o)){if(r.every((e=>this.hasAncestor(e,o.id))))return o.id;o=this.getShapeParent(o)}else o=this.getShapeParent(o)}isShapeOrAncestorLocked(e){const t="string"==typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}_notVisibleShapes(){return(e=>{function t(e){const t=e.getCurrentPageShapeIds(),n=e.getViewportPageBounds(),i=new Set;return t.forEach((t=>{(function(e,t,n){const i=e.getShapeMaskedPageBounds(t);return void 0===i||!n.includes(i)})(e,t,n)&&i.add(t)})),i}return ju("getCulledShapes",(n=>{if(bu(n))return t(e);const i=t(e);if(n.size!==i.size)return i;for(const e of n)if(!i.has(e))return i;return n}))})(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),n=this.getEditingShapeId(),i=new Set(e);return n&&i.delete(n),t.forEach((e=>{i.delete(e)})),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach((t=>{const n=this.getShapeMaskedPageBounds(t);n&&(e=e?e.expand(n):n.clone())})),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter((e=>"group"!==e.type&&t.includes(e.id))).reverse().find((t=>this.isPointInShape(t,e,{hitInside:!0,margin:0})))}getShapeAtPoint(e,t={}){const n=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:s,margin:r=0,hitLocked:o=!1,hitLabels:a=!1,hitInside:l=!1,hitFrameInside:c=!1}=t;let d=1/0,h=null,u=1/0,p=null;const g=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter((t=>{if(t.isLocked&&!o||this.isShapeOfType(t,"group"))return!1;const n=this.getShapeMask(t);return!(n&&!ny(e,n))&&(!s||s(t))}));for(let f=g.length-1;f>=0;f--){const t=g[f],s=this.getShapeGeometry(t),o=s instanceof Xx,m=this.getPointInShapeSpace(t,e);if((this.isShapeOfType(t,"arrow")||this.isShapeOfType(t,"geo")&&"none"===t.props.fill)&&t.props.text.trim())for(const e of s.children)if(e.isLabel&&e.isPointInBounds(m))return t;if(this.isShapeOfType(t,"frame")){const e=s.distanceToPoint(m,l);if(Math.abs(e)<=r)return p||t;if(s.hitTestPoint(m,0,!0))return p||h||(c?t:void 0);continue}let y;if(o){let e=1/0;for(const t of s.children){if(t.isLabel&&!a)continue;const n=t.distanceToPoint(m,l);n<e&&(e=n)}y=e}else y=0===r&&(s.bounds.w<1||s.bounds.h<1)||s.bounds.containsPoint(m,r)?s.distanceToPoint(m,l):1/0;if(s.isClosed){if(y<=r){if(s.isFilled||o&&s.children[0].isFilled)return p||t;if(this.getShapePageBounds(t).contains(i))continue;if(Math.abs(y)<r)Math.abs(y)<u&&(u=Math.abs(y),p=t);else if(!p){const{area:e}=s;e<d&&(d=e,h=t)}}}else if(y<this.options.hitTestMargin/n)return t}return p||h||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter((n=>this.isPointInShape(n,e,t)))}isPointInShape(e,t,n={}){const{hitInside:i=!1,margin:s=0}=n,r="string"==typeof e?e:e.id,o=this.getShapeMask(r);return!(o&&!ny(t,o))&&this.getShapeGeometry(r).hitTestPoint(this.getPointInShapeSpace(e,t),s,i)}getPointInShapeSpace(e,t){const n="string"==typeof e?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const n="string"==typeof e?e:e.id,i=this.getShape(n);if(!i)return new Am(0,0);if(zg(i.parentId))return Am.From(t);const s=this.getShapePageTransform(i.parentId);return s?s.clone().invert().applyToPoint(t):Am.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),(e=>this.store.get(e)))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let n=0,i=t.length;n<i;n++)pS(this,t[n],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter((({id:t})=>!e.has(t)))}isShapeOfType(e,t){const n="string"==typeof e?this.getShape(e):e;return!!n&&n.type===t}getShape(e){const t="string"==typeof e?e:e.id;if(Qp(t))return this.store.get(t)}getShapeParent(e){const t="string"==typeof e?e:null==e?void 0:e.id;if(!t)return;const n=this.getShape(t);return void 0!==n&&Qp(n.parentId)?this.store.get(n.parentId):void 0}getShapeNearestSibling(e,t){if(!t)return;if(t.parentId===e.parentId)return t;return this.findShapeAncestor(t,(t=>t.parentId===e.parentId))}isShapeInPage(e,t=this.getCurrentPageId()){const n="string"==typeof e?e:e.id,i=this.getShape(n);if(!i)return!1;let s=!1;if(i.parentId===t)s=!0;else{let e=this.getShape(i.parentId);e:for(;e;){if(e.parentId===t){s=!0;break e}e=this.getShape(e.parentId)}}return s}getAncestorPageId(e){const t="string"==typeof e?e:null==e?void 0:e.id,n=t&&this.getShape(t);if(n)return zg(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}reparentShapes(e,t,n){const i="string"==typeof e[0]?e:e.map((e=>e.id));if(0===i.length)return this;const s=[],r=zg(t)?Vx.Identity():this.getShapePageTransform(t),o=r.rotation();let a=[];const l=ud(this.getSortedChildIdsForParent(t).map((e=>this.getShape(e))));if(n){const e=l.find((e=>e.index===n));if(e){const t=l[l.indexOf(e)+1];a=t?hh(n,t.index,i.length):uh(n,i.length)}else{const e=l.sort(mh).find((e=>e.index>n));a=e?hh(n,e.index,i.length):uh(n,i.length)}}else{const e=l.length&&l[l.length-1];a=e?uh(e.index,i.length):fh(i.length)}const c=r.clone().invert(),d=ud(i.map((e=>this.getShape(e)))),h=d.filter((e=>e.isLocked));h.length&&this.updateShapes(h.map((({id:e,type:t})=>({id:e,type:t,isLocked:!1}))));for(let u=0;u<d.length;u++){const e=d[u],n=this.getShapePageTransform(e);if(!n)continue;const i=n.point();if(!i)continue;const r=c.applyToPoint(i),l=n.rotation()-o;s.push({id:e.id,type:e.type,parentId:t,x:r.x,y:r.y,rotation:l,index:a[u],isLocked:e.isLocked})}return this.updateShapes(s),this}getHighestIndexForParent(e){const t="string"==typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];if(!n||0===n.length)return"a1";return gh(this.getShape(n[n.length-1]).index)}getSortedChildIdsForParent(e){const t="string"==typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];return n||qh}visitDescendants(e,t){const n="string"==typeof e?e:e.id,i=this.getSortedChildIdsForParent(n);for(const s of i)!1!==t(s)&&this.visitDescendants(s,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const n of e.map((e=>this.getShape(e))).sort(mh))t.add(n.id),this.visitDescendants(n,(e=>{t.add(e)}));return t}getDroppingOverShape(e,t=[]){const n=this.getCurrentPageShapesSorted();for(let i=n.length-1;i>=0;i--){const s=n[i];if(this.getSelectedShapeIds().includes(s.id)||!this.getShapeUtil(s).canDropShapes(s,t)||t.find((e=>e.id===s.id||this.hasAncestor(s,e.id))))continue;const r=this.getShapeMaskedPageBounds(s.id);if(r&&r.containsPoint(e)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,e),0,!0))return s}}getOutermostSelectableShape(e,t){const n="string"==typeof e?e:e.id,i=this.getShape(n);let s=i,r=i;const o=this.getFocusedGroup();for(;r;){if(this.isShapeOfType(r,"group")&&(null==o?void 0:o.id)!==r.id&&!this.hasAncestor(o,r.id)&&((null==t?void 0:t(r))??1))s=r;else if((null==o?void 0:o.id)===r.id)break;r=this.getShapeParent(r)}return s}_getBindingsIndexCache(){const e=(e=>{const{store:t}=e,n=t.query.filterHistory("binding"),i=t.query.records("binding");function s(){const e=i.get(),t=new Map;for(const n of e){const{fromId:e,toId:i}=n,s=t.get(e);s?s.push(n):t.set(e,[n]);const r=t.get(i);r?r.push(n):t.set(i,[n])}return t}return ju("arrowBindingsIndex",((e,t)=>{if(bu(e))return s();const i=e,r=n.getDiffSince(t);if(r===Jh)return s();let o;function a(e){o??(o=new Map(i));const t=o.get(e.fromId),n=null==t?void 0:t.filter((t=>t.id!==e.id));(null==n?void 0:n.length)?o.set(e.fromId,n):o.delete(e.fromId);const s=o.get(e.toId),r=null==s?void 0:s.filter((t=>t.id!==e.id));(null==r?void 0:r.length)?o.set(e.toId,r):o.delete(e.toId)}function l(e){o??(o=new Map(i));let t=o.get(e);return t?t===i.get(e)&&(t=t.slice(0),o.set(e,t)):(t=[],o.set(e,t)),t}function c(e){l(e.fromId).push(e),l(e.toId).push(e)}for(const n of r){for(const e of Wd(n.added))c(e);for(const[e,t]of Wd(n.updated))a(e),c(t);for(const e of Wd(n.removed))a(e)}return o??i}))})(this);return this.store.createComputedCache("bindingsIndex",(t=>e.get().get(t.id)))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const n="string"==typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter((e=>e.fromId===n&&e.type===t))}getBindingsToShape(e,t){const n="string"==typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter((e=>e.toId===n&&e.type===t))}getBindingsInvolvingShape(e,t){const n="string"==typeof e?e:e.id,i=this._getBindingsIndexCache().get(n)??qh;return t?i.filter((e=>e.type===t)):i}createBindings(e){const t=[];for(const n of e){const e=this.getShape(n.fromId),i=this.getShape(n.toId);if(!e||!i)continue;if(!this.canBindShapes({fromShape:e,toShape:i,binding:n}))continue;const s=this.getBindingUtil(n.type).getDefaultProps(),r=this.store.schema.types.binding.create({...n,id:n.id??Wp(),props:{...s,...n.props}});t.push(r)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const n of e){if(!n)continue;const e=this.getBinding(n.id);if(!e)continue;const i=uS(e,n);if(i===e)continue;const s=this.getShape(i.fromId),r=this.getShape(i.toId);s&&r&&(this.canBindShapes({fromShape:s,toShape:r,binding:i})&&t.push(i))}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const n=e.map((e=>"string"==typeof e?e:e.id));return t?this.store.atomic((()=>{var e,t;for(const i of n){const n=this.getBinding(i);if(!n)continue;const s=this.getBindingUtil(n);null==(e=s.onBeforeIsolateFromShape)||e.call(s,{binding:n,removedShape:this.getShape(n.toId)}),null==(t=s.onBeforeIsolateToShape)||t.call(s,{binding:n,removedShape:this.getShape(n.fromId)}),this.store.remove([i])}})):this.store.remove(n),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:n}){const i="string"==typeof e?e:e.type,s="string"==typeof t?t:t.type,r={fromShapeType:i,toShapeType:s,bindingType:"string"==typeof n?n:n.type};return i===s?this.getShapeUtil(i).canBind(r):this.getShapeUtil(i).canBind(r)&&this.getShapeUtil(s).canBind(r)}rotateShapesBy(e,t){if(("string"==typeof e[0]?e:e.map((e=>e.id))).length<=0)return this;const n=ub({editor:this});return n?(pb({delta:t,snapshot:n,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(e,t){var n,i,s;let r=e;const o=this.getShapeUtil(e);return r=uS(r,(null==(n=o.onTranslateStart)?void 0:n.call(o,r))??void 0),r=uS(r,{id:e.id,type:e.type,x:t.x,y:t.y}),r=uS(r,(null==(i=o.onTranslate)?void 0:i.call(o,e,r))??void 0),r=uS(r,(null==(s=o.onTranslateEnd)?void 0:s.call(o,e,r))??void 0),r}nudgeShapes(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(n.length<=0)return this;const i=[];for(const s of n){const e=this.getShape(s),n=Am.From(t),r=this.getShapeParentTransform(e);r&&n.rot(-r.rotation()),i.push(this.getChangesToTranslateShape(e,n.add(e)))}return this.updateShapes(i),this}duplicateShapes(e,t){return this.history.batch((()=>{const n="string"==typeof e[0]?e:e.map((e=>e.id));if(n.length<=0)return this;const i=new Set(n),s=this.getShapeAndDescendantIds(n),r=[...s].reverse(),o=new Map;for(const e of s)o.set(e,eg());const{shapesToCreate:a,bindingsToCreate:l}=gS(this,s,(e=>{const n=[];for(const t of e){const e=this.getBinding(t);if(!e)continue;const i=Wp();n.push({...e,id:i,fromId:bd(o.get(e.fromId)),toId:bd(o.get(e.toId))})}const s=[];for(const a of r){const e=bd(o.get(a)),n=this.getShape(a);if(!n)continue;let r=0,l=0;if(t&&i.has(a)){const e=this.getShapeParentTransform(n),i=new Am(t.x,t.y).rot(-e.rotation());r=i.x,l=i.y}const c=n.parentId,d=this.getSortedChildIdsForParent(c),h=d.indexOf(n.id),u=d[h+1],p=u?this.getShape(u):null,g=p?ph(n.index,p.index):gh(n.index);s.push({...n,id:e,x:n.x+r,y:n.y+l,index:g,parentId:o.get(n.parentId)??n.parentId})}return{shapesToCreate:s,bindingsToCreate:n}}));if(a.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)hS(this);else if(this.createShapes(a),this.createBindings(l),this.setSelectedShapes(ud(n.map((e=>o.get(e))))),void 0!==t){const e=this.getSelectionPageBounds(),t=this.getViewportPageBounds();e&&!t.contains(e)&&this.centerOnPoint(e.center,{animation:{duration:this.options.animationMediumMs}})}})),this}moveShapesToPage(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(0===n.length)return this;if(this.getInstanceState().isReadonly)return this;const i=this.getCurrentPageId();if(t===i)return this;if(!this.store.has(t))return this;const s=this.getContentFromCurrentPage(n);if(!s)return this;if(this.getPageShapeIds(t).size+s.shapes.length>this.options.maxShapesPerPage)return hS(this,t),this;const r=this.getCamera().z;return this.history.batch((()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:r}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)})),this}toggleLock(e){const t="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly||0===t.length)return this;let n=!0,i=!0;const s=[];for(const r of t){const e=this.getShape(r);e&&(s.push(e),e.isLocked?i=!1:n=!1)}return this.batch((()=>{i?(this.updateShapes(s.map((e=>({id:e.id,type:e.type,isLocked:!0})))),this.setSelectedShapes([])):n?this.updateShapes(s.map((e=>({id:e.id,type:e.type,isLocked:!1})))):this.updateShapes(s.map((e=>({id:e.id,type:e.type,isLocked:!0}))))})),this}sendToBack(e){const t=hb(this,"toBack","string"==typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}sendBackward(e){const t=hb(this,"backward","string"==typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}bringForward(e){const t=hb(this,"forward","string"==typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}bringToFront(e){const t=hb(this,"toFront","string"==typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}flipShapes(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;let i=ud(n.map((e=>this.getShape(e))));if(!i.length)return this;i=ud(i.map((e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map((e=>this.getShape(e))):e)).flat());const s=Ux.Common(ud(i.map((e=>this.getShapePageBounds(e))))).center;return this.batch((()=>{for(const e of i){const n=this.getShapeGeometry(e).bounds,i=this.getShapePageTransform(e.id);i&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:n,initialPageTransform:i,initialShape:e,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleOrigin:s,scaleAxisRotation:0})}})),this}stackShapes(e,t,n){const i="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;const s=i.map((e=>this.getShape(e))).filter((e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e))),r=s.length;if(0===n&&r<3||r<2)return this;const o=Object.fromEntries(s.map((e=>[e.id,this.getShapePageBounds(e)])));let a,l,c,d,h;if("horizontal"===t?(a="x",l="minX",c="maxX",d="width"):(a="y",l="minY",c="maxY",d="height"),0===n){const e=[];s.sort(((e,t)=>o[e.id][l]-o[t.id][l]));for(let n=0;n<r-1;n++){const t=s[n],i=s[n+1],r=o[t.id],a=o[i.id][l]-r[c],d=e.find((e=>e.gap===a));d?d.count++:e.push({gap:a,count:1})}let t=0;e.forEach((e=>{e.count>t&&(t=e.count,h=e.gap)})),1===t&&(h=Math.max(0,e.reduce(((e,t)=>e+t.gap*t.count),0)/(r-1)))}else h=n;const u=[];let p=o[s[0].id][c];return s.forEach(((e,t)=>{var n,i;if(0===t)return;const s={x:0,y:0};s[a]=p+h-o[e.id][a];const r=this.getShapeParent(e),l=r?Am.Rot(s,-this.getShapePageTransform(r).decompose().rotation):s,c=null==(i=(n=this.getShapeUtil(e)).onTranslateStart)?void 0:i.call(n,e);u.push(c?{...c,[a]:e[a]+l[a]}:{id:e.id,type:e.type,[a]:e[a]+l[a]}),p+=o[e.id][d]+h})),this.updateShapes(u),this}packShapes(e,t){var n,i;const s="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;if(s.length<2)return this;const r=s.map((e=>this.getShape(e))).filter((e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e))),o={},a={};let l,c,d=0;for(let k=0;k<r.length;k++)l=r[k],c=this.getShapePageBounds(l),o[l.id]=c,a[l.id]=c.clone(),d+=c.width*c.height;const h=Ux.Common(ud(Object.values(o))),u=h.width;r.sort(((e,t)=>o[t.id].height-o[e.id].height));const p=Math.max(Math.ceil(Math.sqrt(d/.95)),u),g=[new Ux(h.x,h.y,p,1/0)];let f,m,y=0,x=0;for(let k=0;k<r.length;k++){l=r[k],c=a[l.id];for(let e=g.length-1;e>=0;e--)if(f=g[e],!(c.width>f.width||c.height>f.height)){c.x=f.x,c.y=f.y,x=Math.max(x,c.maxY),y=Math.max(y,c.maxX),c.width===f.width&&c.height===f.height?(m=g.pop(),e<g.length&&(g[e]=m)):c.height===f.height?(f.x+=c.width+t,f.width-=c.width+t):c.width===f.width?(f.y+=c.height+t,f.height-=c.height+t):(g.push(new Ux(f.x+(c.width+t),f.y,f.width-(c.width+t),c.height)),f.y+=c.height+t,f.height-=c.height+t);break}}const w=Ux.Common(Object.values(a)),v=Am.Sub(h.center,w.center);let b;const S=[];for(let k=0;k<r.length;k++){l=r[k],c=o[l.id],b=a[l.id];const e=Am.Sub(b.point,c.point).add(v),t=this.getShapeParentTransform(l);t&&e.rot(-t.rotation());const s={id:l.id,type:l.type,x:l.x+e.x,y:l.y+e.y},d=null==(i=(n=this.getShapeUtil(l)).onTranslateStart)?void 0:i.call(n,{...l,...s});d?S.push({...s,...d}):S.push(s)}return S.length&&this.updateShapes(S),this}alignShapes(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;if(n.length<2)return this;const i=ud(n.map((e=>this.getShape(e)))),s=Object.fromEntries(i.map((e=>[e.id,this.getShapePageBounds(e)]))),r=Ux.Common(ud(Object.values(s))),o=[];return i.forEach((e=>{const n=s[e.id];if(!n)return;const i={x:0,y:0};switch(t){case"top":i.y=r.minY-n.minY;break;case"center-vertical":i.y=r.midY-n.minY-n.height/2;break;case"bottom":i.y=r.maxY-n.minY-n.height;break;case"left":i.x=r.minX-n.minX;break;case"center-horizontal":i.x=r.midX-n.minX-n.width/2;break;case"right":i.x=r.maxX-n.minX-n.width}const a=this.getShapeParent(e),l=a?Am.Rot(i,-this.getShapePageTransform(a).decompose().rotation):i;o.push(this.getChangesToTranslateShape(e,Am.Add(e,l)))})),this.updateShapes(o),this}distributeShapes(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;if(n.length<3)return this;const i=n.length,s=ud(n.map((e=>this.getShape(e)))),r=Object.fromEntries(s.map((e=>[e.id,this.getShapePageBounds(e)])));let o,a,l,c,d;"horizontal"===t?(o="x",a="minX",l="maxX",c="midX",d="width"):(o="y",a="minY",l="maxY",c="midY",d="height");const h=[],u=s.sort(((e,t)=>r[e.id][a]-r[t.id][a]))[0],p=s.sort(((e,t)=>r[t.id][l]-r[e.id][l]))[0],g=r[u.id][c],f=(r[p.id][c]-g)/(i-1),m=g+f;return s.filter((e=>e!==u&&e!==p)).sort(((e,t)=>r[e.id][c]-r[t.id][c])).forEach(((e,t)=>{const n={x:0,y:0};n[o]=m+f*t-r[e.id][d]/2-r[e.id][o];const i=this.getShapeParent(e),s=i?Am.Rot(n,-this.getShapePageTransform(i).rotation()):n;h.push(this.getChangesToTranslateShape(e,Am.Add(e,s)))})),this.updateShapes(h),this}stretchShapes(e,t){const n="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;if(n.length<2)return this;const i=ud(n.map((e=>this.getShape(e)))),s=Object.fromEntries(n.map((e=>[e,this.getShapeGeometry(e).bounds]))),r=Object.fromEntries(n.map((e=>[e,this.getShapePageBounds(e)]))),o=Ux.Common(ud(Object.values(r)));switch(t){case"vertical":this.batch((()=>{for(const e of i){if(this.getShapePageTransform(e).rotation()%Fm)continue;const t=s[e.id],n=r[e.id],i=new Am(0,o.minY-n.minY),a=this.getShapeParentTransform(e);a&&i.rot(-a.rotation());const{x:l,y:c}=Am.Add(i,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);const d=new Am(1,o.height/n.height);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new Am(n.center.x,o.minY),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}}));break;case"horizontal":this.batch((()=>{for(const e of i){const t=s[e.id],n=r[e.id];if(this.getShapePageTransform(e).rotation()%Fm)continue;const i=new Am(o.minX-n.minX,0),a=this.getShapeParentTransform(e);a&&i.rot(-a.rotation());const{x:l,y:c}=Am.Add(i,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);const d=new Am(o.width/n.width,1);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new Am(o.minX,n.center.y),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}}))}return this}resizeShape(e,t,n={}){var i,s,r;const o="string"==typeof e?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(t.x)||(t=new Am(1,t.y)),Number.isFinite(t.y)||(t=new Am(t.x,1));const a=n.initialShape??this.getShape(o);if(!a)return this;const l=n.scaleOrigin??(null==(i=this.getShapePageBounds(o))?void 0:i.center);if(!l)return this;const c=n.initialPageTransform?Vx.Cast(n.initialPageTransform):this.getShapePageTransform(o);if(!c)return this;const d=c.rotation();if(null==d)return this;const h=n.scaleAxisRotation??d,u=n.initialBounds??this.getShapeGeometry(o).bounds;if(!u)return this;const p=n.isAspectRatioLocked??this.getShapeUtil(a).isAspectRatioLocked(a);if(!qm(d,h))return this._resizeUnalignedShape(o,t,{...n,initialBounds:u,scaleOrigin:l,scaleAxisRotation:h,initialPageTransform:c,isAspectRatioLocked:p,initialShape:a});const g=this.getShapeUtil(a);if(p&&(t=Math.abs(t.x)>Math.abs(t.y)?new Am(t.x,Math.sign(t.y)*Math.abs(t.x)):new Am(Math.sign(t.x)*Math.abs(t.y),t.y)),g.onResize&&g.canResize(a)){const e=this._scalePagePoint(Vx.applyToPoint(c,new Am(0,0)),l,t,h),i=this.getPointInParentSpace(a.id,e),p=new Am(t.x,t.y),f=Um((d-h)%Math.PI,0);p.x=f?t.x:t.y,p.y=f?t.y:t.x;const m=Vx.applyToPoint(c,new Am),{x:y,y:x}=this.getPointInParentSpace(a.id,m);let w=a;n.skipStartAndEndCallbacks||(w=uS(a,(null==(s=g.onResizeStart)?void 0:s.call(g,a))??void 0)),w=uS(w,{id:o,type:a.type,x:i.x,y:i.y,...g.onResize({...a,x:y,y:x},{newPoint:i,handle:n.dragHandle??"bottom_right",mode:n.mode??"scale_shape",scaleX:p.x,scaleY:p.y,initialBounds:u,initialShape:a})}),n.skipStartAndEndCallbacks||(w=uS(w,(null==(r=g.onResizeEnd)?void 0:r.call(g,a,w))??void 0)),this.updateShapes([w])}else{const e=Vx.applyToPoint(c,u.center),n=this._scalePagePoint(e,l,t,h),i=this.getPointInParentSpace(a.id,e),s=this.getPointInParentSpace(a.id,n),r=Am.Sub(s,i);this.updateShapes([{id:o,type:a.type,x:a.x+r.x,y:a.y+r.y}])}return this}_scalePagePoint(e,t,n,i){const s=Am.RotWith(e,t,-i).sub(t),r=Am.MulV(s,n);return Am.Add(r,t).rotWith(t,i)}_resizeUnalignedShape(e,t,n){const{type:i}=n.initialShape,s=new Am(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?s.x=Math.sign(t.x)*Math.abs(t.y):s.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,s,{initialShape:n.initialShape,initialBounds:n.initialBounds,isAspectRatioLocked:n.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=Vx.Decompose(n.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:i,rotation:t}])}const r=Vx.applyToPoint(n.initialPageTransform,n.initialBounds.center),o=this._scalePagePoint(r,n.scaleOrigin,t,n.scaleAxisRotation),a=this.getShapePageBounds(e),l=this.getShapePageTransform(e),c=a.center,d=l.point();if(!c||!d)return this;const h=Am.Sub(o,c),u=Am.Add(d,h),{x:p,y:g}=this.getPointInParentSpace(e,u);return this.updateShapes([{id:e,type:i,x:p,y:g}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return hS(this),this;const n=this.getFocusedGroupId();return this.batch((()=>{var t,i;const s=this.getCurrentPageShapesSorted(),r=e.map((t=>{if(t.id||(t={id:eg(),...t}),!t.parentId||!this.store.has(t.parentId)&&!e.some((e=>e.id===t.parentId))){let e=this.getFocusedGroupId();for(let n=s.length-1;n>=0;n--){const i=s[n];if(this.getShapeUtil(i).canReceiveNewChildrenOfType(i,t.type)&&this.isPointInShape(i,{x:t.x??0,y:t.y??0},{margin:0,hitInside:!0})){e=i.id;break}}const i=t.parentId;if(e===t.id&&(e=n),e!==i&&((t={...t}).parentId=e,Qp(e))){const n=this.getPointInShapeSpace(this.getShape(e),{x:t.x??0,y:t.y??0});t.x=n.x,t.y=n.y,t.rotation=-this.getShapePageTransform(e).rotation()+(t.rotation??0)}}return t})),o=new Map,a=[],{opacityForNextShape:l}=this.getInstanceState();for(const e of r){const s=this.getShapeUtil(e);let r=e.index;if(!r){const t=e.parentId??n;o.has(t)||o.set(t,this.getHighestIndexForParent(t)),r=o.get(t),o.set(t,gh(r))}const c=s.getDefaultProps();for(const[t,n]of this.styleProps[e.type])c[n]=this.getStyleForNextShape(t);let d=this.store.schema.types.shape.create({...e,index:r,opacity:e.opacity??l,parentId:e.parentId??n,props:"props"in e?{...c,...e.props}:c});if(void 0===d.index)throw Error("no index!");const h=null==(i=(t=this.getShapeUtil(d)).onBeforeCreate)?void 0:i.call(t,d);h&&(d=h),a.push(d)}a.forEach((e=>{e.meta={...this.getInitialMetaForShape(e),...e.meta}})),this.store.put(a)}))}animateShape(e,t={animation:py}){return this.animateShapes([e],t)}animateShapes(e,t={animation:py}){if(!t.animation)return this;const{duration:n=500,easing:i=Mm.linear}=t.animation,s=sv();let r,o=n;const a=[];let l,c,d;for(let u=0,p=e.length;u<p;u++){if(l=e[u],!l)continue;c={partial:l,values:[]};const t=this.getShape(l.id);if(t){for(const e of["x","y","rotation"])void 0!==l[e]&&t[e]!==l[e]&&c.values.push({prop:e,from:t[e],to:l[e]});a.push(c),this.animatingShapes.set(t.id,s)}}const h=t=>{if(o-=t,o<0){const{animatingShapes:t}=this,n=e.filter((e=>e&&t.get(e.id)===s));return n.length&&this.updateShapes(n),void this.off("tick",h)}r=i(1-o/n);const{animatingShapes:l}=this,c=[];let u;for(let e=0,n=a.length;e<n;e++)d=a[e],u=l.get(d.partial.id),u===s&&c.push({id:d.partial.id,type:d.partial.type,...d.values.reduce(((e,{prop:t,from:n,to:i})=>(e[t]=n+(i-n)*r,e)),{})});this._updateShapes(c)};return this.on("tick",h),this}groupShapes(e,t={}){var n;const{groupId:i=eg(),select:s=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const r="string"==typeof e[0]?e:e.map((e=>e.id));if(r.length<=1)return this;const o=ud(this._getUnlockedShapeIds(r).map((e=>this.getShape(e)))),a=o.sort(mh).map((e=>e.id)),l=Ux.Common(ud(o.map((e=>this.getShapePageBounds(e))))),{x:c,y:d}=l.point,h=this.findCommonAncestor(o)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const u=o.filter((e=>e.parentId===h)).sort(mh),p=null==(n=u[u.length-1])?void 0:n.index;return this.batch((()=>{this.createShapes([{id:i,type:"group",parentId:h,index:p,x:c,y:d,opacity:1,props:{}}]),this.reparentShapes(a,i),s&&this.select(i)})),this}ungroupShapes(e,t={}){const{select:n=!0}=t,i="string"==typeof e[0]?e:e.map((e=>e.id));if(this.getInstanceState().isReadonly)return this;if(0===i.length)return this;if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const s=new Set,r=[];return ud(i.map((e=>this.getShape(e)))).forEach((e=>{this.isShapeOfType(e,"group")?r.push(e):s.add(e.id)})),0===r.length||this.batch((()=>{let e;for(let t=0,n=r.length;t<n;t++){e=r[t];const n=this.getSortedChildIdsForParent(e.id);for(let e=0,t=n.length;e<t;e++)s.add(n[e]);this.reparentShapes(n,e.parentId,e.index)}this.deleteShapes(r.map((e=>e.id))),n&&this.select(...s)})),this}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let n=0,i=e.length;n<i;n++){const i=e[n];if(!i)continue;const s=this.getShape(i.id);s&&(this.isShapeOrAncestorLocked(s)&&!Object.hasOwn(i,"isLocked")||(this.animatingShapes.delete(i.id),t.push(i)))}return this._updateShapes(t),this}_getUnlockedShapeIds(e){return e.filter((e=>{var t;return!(null==(t=this.getShape(e))?void 0:t.isLocked)}))}deleteShapes(e){if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=this._getUnlockedShapeIds("string"==typeof e[0]?e:e.map((e=>e.id)));if(this.getInstanceState().isReadonly)return this;if(0===t.length)return this;const n=new Set(t);for(const s of t)this.visitDescendants(s,(e=>{n.add(e)}));const i=[...n];return this.batch((()=>this.store.remove(i)))}deleteShape(e){return this.deleteShapes(["string"==typeof e?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const n=this._parentIdsToChildIds.get()[e.id];if(!n)return;for(let e=0,i=n.length;e<i;e++)this._extractSharedStyles(this.getShape(n[e]),t)}else for(const[n,i]of this.styleProps[e.type])t.applyValue(n,Hd(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new db;for(const n of e)this._extractSharedStyles(n,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){const n=this.styleProps[e.type].get(t);if(void 0!==n)return Hd(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new db;if(!e)return t;if(e.shapeType)for(const n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=n=>{const i=this.getShape(n);if(i)if(this.isShapeOfType(i,"group"))for(const e of this.getSortedChildIdsForParent(i.id))t(e);else e.push(i)};for(const i of this.getSelectedShapeIds())t(i);let n=null;for(const i of e)if(null===n)n=i.opacity;else if(n!==i.opacity)return{type:"mixed"};if(null!==n)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const n=[],i=e=>{if(this.isShapeOfType(e,"group")){const t=this.getSortedChildIdsForParent(e);for(const e of t)i(this.getShape(e))}else n.push(e)};for(const e of t)i(e);this.updateShapes(n.map((t=>({id:t.id,type:t.type,opacity:e}))))}return this}setStyleForNextShapes(e,t,n){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t){const n=this.getSelectedShapes();if(n.length>0){const i=[],s=n=>{if(this.isShapeOfType(n,"group")){const e=this.getSortedChildIdsForParent(n.id);for(const t of e)s(this.getShape(t))}else{const s=this.getShapeUtil(n),r=this.styleProps[n.type].get(e);if(r){const e={id:n.id,type:n.type,props:{[r]:t}};i.push({util:s,originalShape:n,updatePartial:e})}}};for(const e of n)s(e);this.updateShapes(i.map((({updatePartial:e})=>e)))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}async getAssetForExternalContent(e){var t,n;return await(null==(n=(t=this.externalAssetContentHandlers)[e.type])?void 0:n.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,n;return null==(n=(t=this.externalContentHandlers)[e.type])?void 0:n.call(t,e)}getContentFromCurrentPage(e){const t="string"==typeof e[0]?e:e.map((e=>e.id));if(!t)return;if(0===t.length)return;const n=this.getShapeAndDescendantIds(t);return gS(this,n,(e=>{const t=[];for(const n of e){const e=this.getBinding(n);e&&t.push(e)}const i=[],s=[];for(const a of n){const e=this.getShape(a);if(!e)continue;if(!n.has(e.parentId)){const t=this.getShapePageTransform(e.id),n=t.point();s.push({...e,x:n.x,y:n.y,rotation:t.rotation(),parentId:this.getCurrentPageId()}),i.push(e.id)}else s.push(e)}const r=[],o=new Set;for(const n of s){if(!("assetId"in n.props))continue;const e=n.props.assetId;if(!e||o.has(e))continue;o.add(e);const t=this.getAsset(e);t&&r.push(t)}return{schema:this.store.schema.serialize(),shapes:s,rootShapeIds:i,bindings:t,assets:r}}))}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map((async e=>{var n,i;if("image"!==e.type&&"video"!==e.type||(null==(n=e.props.src)?void 0:n.startsWith("data:image"))||(null==(i=e.props.src)?void 0:i.startsWith("http")))t.push(e);else{const n=Rh(e),i=await this._assetOptions.get().onResolveAsset(e,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginalImage:!0});n.props.src=await Id.blobToDataUrl(await _d(i).then((e=>e.blob()))),t.push(n)}}))),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var n,i;if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");const{select:s=!1,preserveIds:r=!1,preservePosition:o=!1}=t;let{point:a}=t;const l=this.getCurrentPageId(),{rootShapeIds:c}=e,d=[],h=[],u=[],p={store:{...Object.fromEntries(e.assets.map((e=>[e.id,e]))),...Object.fromEntries(e.shapes.map((e=>[e.id,e]))),...Object.fromEntries((null==(n=e.bindings)?void 0:n.map((e=>[e.id,e])))??[])},schema:e.schema},g=this.store.schema.migrateStoreSnapshot(p);if("error"===g.type)throw Error("Could not put content: could not migrate content");for(const I of Object.values(g.value))switch(I.typeName){case"asset":d.push(I);break;case"shape":h.push(I);break;case"binding":u.push(I)}const f=new Map(r?h.map((e=>[e.id,e.id])):h.map((e=>[e.id,eg()]))),m=new Map(r?u.map((e=>[e.id,e.id])):u.map((e=>[e.id,Wp()])));let y=this.getCurrentPageId(),x=1/0,w=[];for(const I of this.getSelectedShapes()){if(0===x)break;const e=this.isShapeOfType(I,"frame"),t=this.getShapeAncestors(I);e&&t.push(I);const n=e?t.length+1:t.length;if(n<x)x=n,w=t,y=e?I.id:I.parentId;else if(n===x){if(w.length!==t.length)throw Error(`Ancestors: ${w.length} !== ${t.length}`);if(0===w.length){y=l;break}y=l;for(let e=0;e<w.length&&t[e]===w[e];e++)y=t[e].id}}let v=!1;if(!zg(y)){const e=this.getShape(y);if(e)if(this.getViewportPageBounds().includes(this.getShapePageBounds(e))){if(1===c.length){const t=h.find((e=>e.id===c[0]));this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===(null==e?void 0:e.props.w)&&t.props.h===(null==e?void 0:e.props.h)&&(v=!0)}}else y=l;else y=l}v||(v=f.has(y)),v&&(y=this.getShape(y).parentId);let b=this.getHighestIndexForParent(y);const S=[],k=h.map((e=>{const t=f.get(e.id),n={...e,id:t};return c.includes(e.id)&&(n.parentId=l,S.push(n)),f.has(n.parentId)?n.parentId=f.get(e.parentId):(c.push(n.id),n.index=b,b=gh(b)),n}));if(k.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return hS(this),this;const C=u.map((e=>({...e,id:bd(m.get(e.id)),fromId:bd(f.get(e.fromId)),toId:bd(f.get(e.toId))}))),_=[],P=[];for(const I of d)this.store.has(I.id)||("image"!==I.type&&"video"!==I.type||!(null==(i=I.props.src)?void 0:i.startsWith("data:image"))||(P.push(Rh(I)),I.props.src=null),_.push(I));return Promise.allSettled(P.map((async e=>{const t=await(n=e.props.src,i=e.props.name,s=e.props.mimeType??"image/png",_d(n).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],i,{type:s})})));var n,i,s;const r=await this.getAssetForExternalContent({type:"file",file:t});r?this.updateAssets([{...r,id:e.id}]):this.deleteAssets([e.id])}))),this.batch((()=>{_.length>0&&this.createAssets(_),this.createShapes(k),this.createBindings(C),s&&this.select(...S.map((e=>e.id))),y!==l&&this.reparentShapes(S.map((e=>e.id)),y);const e=k.map((e=>this.getShape(e.id))),t=Ux.Common(e.map((e=>this.getShapePageBounds(e))));if(void 0===a)if(zg(y)){const e=this.getViewportPageBounds();a=o||e.includes(Ux.From(t))?t.center:e.center}else{const e=this.getShape(y);a=Vx.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}if(1===S.length){const e=S[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(a).some((t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h));)a.x+=t.w+16}const n=Ux.Common(ud(S.map((({id:e})=>this.getShapePageBounds(e))))).center,i=Am.Sub(a,n);this.updateShapes(S.map((({id:e})=>{const t=this.getShape(e),n=this.getShapeParentTransform(e).decompose().rotation,s=Am.Rot(i,-n);return{id:t.id,type:t.type,x:t.x+s.x,y:t.y+s.y}})))})),this}async getSvgElement(e,t={}){const n=await async function(e,t,n={}){var i,s;const r="string"==typeof t[0]?t:t.map((e=>e.id));if(0===r.length)return;if(!window.document)throw Error("No document");const{scale:o=1,background:a=!1,padding:l=e.options.defaultSvgPadding,preserveAspectRatio:c=!1}=n,d=n.darkMode??e.user.getIsDarkMode(),h=lg({isDarkMode:d}),u=e.getShapeAndDescendantIds(r),p=e.getUnorderedRenderingShapes(!1).filter((({id:e})=>u.has(e)));let g=null;if(n.bounds)g=n.bounds;else for(const{id:k}of p){const t=e.getShapeMaskedPageBounds(k);t&&(g?g.union(t):g=t.clone())}if(!g)return;const f=1===r.length&&e.isShapeOfType(e.getShape(r[0]),"frame")?r[0]:null;f||g.expandBy(l);const m=g.width*o,y=g.height*o;try{null==(s=(i=document.body).focus)||s.call(i)}catch(S){}const x=[],w=new Map,v={isDarkMode:d,addExportDef:e=>{if(w.has(e.key))return;const t=(async()=>{const t=await e.getElement();t&&x.push(k.jsx(C.Fragment,{children:t},x.length))})();w.set(e.key,t)}},b=(await Promise.all(p.map((async({id:t,opacity:n,index:i,backgroundIndex:s})=>{var r,o;if(t===f)return[];const a=e.getShape(t);if(e.isShapeOfType(a,"group"))return[];const l=e.getShapeUtil(a);let c=await(null==(r=l.toSvg)?void 0:r.call(l,a,v)),d=await(null==(o=l.toBackgroundSvg)?void 0:o.call(l,a,v));if(!c&&!d){const t=e.getShapePageBounds(a);c=k.jsx("rect",{width:t.w,height:t.h,fill:h.solid,stroke:h.grey.pattern,strokeWidth:1})}let u=e.getShapePageTransform(a).toCssString();"scale"in a.props&&1!==a.props.scale&&(u=`${u} scale(${a.props.scale}, ${a.props.scale})`),c&&(c=k.jsx("g",{transform:u,opacity:n,children:c},a.id)),d&&(d=k.jsx("g",{transform:u,opacity:n,children:d},`bg_${a.id}`));const p=e.getShapeMask(a.id);if(p){const e=`mask_${a.id.replace(":","_")}`;x.push(k.jsx("clipPath",{id:e,children:k.jsx("path",{d:`M${p.map((({x:e,y:t})=>`${e},${t}`)).join("L")}Z`})},x.length)),c&&(c=k.jsx("g",{clipPath:`url(#${e})`,children:c},a.id)),d&&(d=k.jsx("g",{clipPath:`url(#${e})`,children:d},`bg_${a.id}`))}const g=[];return c&&g.push({zIndex:i,element:c}),d&&g.push({zIndex:s,element:d}),g})))).flat();return await Promise.all(w.values()),{jsx:k.jsx(mb,{editor:e,context:v,children:k.jsxs("svg",{preserveAspectRatio:c||void 0,direction:"ltr",width:m,height:y,viewBox:`${g.minX} ${g.minY} ${g.width} ${g.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:a?f?h.solid:h.background:"transparent"},children:[k.jsx("defs",{children:x}),b.sort(((e,t)=>e.zIndex-t.zIndex)).map((({element:e})=>e))]})}),width:m,height:y}}(this,e,t);if(!n)return;const i=document.createDocumentFragment(),s=j(i);E.flushSync((()=>{s.render(n.jsx)}));const r=i.firstElementChild;return vd(r instanceof SVGSVGElement,"Expected an SVG element"),s.unmount(),{svg:r,width:n.width,height:n.height}}async getSvgString(e,t={}){const n=await this.getSvgElement(e,t);if(!n)return;return{svg:(new XMLSerializer).serializeToString(n.svg),width:n.width,height:n.height}}async getSvg(e,t={}){const n=await this.getSvgElement(e,t);if(n)return n.svg}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:n,previousPagePoint:i,currentScreenPoint:s,currentPagePoint:r}=this.inputs,{screenBounds:o}=this.store.unsafeGetWithoutCapture(Ug),{x:a,y:l,z:c}=this.store.unsafeGetWithoutCapture(this.getCameraId()),d=e.point.x-o.x,h=e.point.y-o.y,u=e.point.z??.5;n.setTo(s),i.setTo(r),s.set(d,h);const p=d/c-a,g=h/c-l;isFinite(p)&&isFinite(g)&&r.set(p,g,u),this.inputs.isPen="pointer"===e.type&&e.isPen,("pointer_down"===e.name||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(s),this.inputs.originPagePoint.setTo(r)),this.history.ignore((()=>{var t;this.store.put([{id:qg,typeName:"pointer",x:r.x,y:r.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===gy?(null==(t=this.store.unsafeGetWithoutCapture(qg))?void 0:t.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])}))}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return function(e){const t=Lv.get(e,Ov).get();if(!t)throw new Error("Session state is not ready yet");return{document:e.getStoreSnapshot(),session:t}}(this.store)}loadSnapshot(e){return Rv(this.store,e),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_flushEventsForTick(e){this.batch((()=>{if(this._pendingEventsForNextTick.length>0){const e=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const t of e)this._flushEventForTick(t)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)}))}maybeTrackPerformance(e){vy.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout((()=>{this.performanceTracker.stop()}),50))}}function hS(e,t=e.getCurrentPageId()){const n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:e.options.maxShapesPerPage})}function uS(e,t){if(!t)return e;let n=null;const i=Object.entries(t);for(let s=0,r=i.length;s<r;s++){const[t,r]=i[s];if(void 0!==r&&("id"!==t&&"type"!==t&&"typeName"!==t&&r!==e[t]))if(n||(n={...e}),"props"!==t&&"meta"!==t)n[t]=r;else{n[t]={...e[t]};for(const[e,i]of Object.entries(r))void 0!==i&&(n[t][e]=i)}}return n||e}function pS(e,t,n){const i=e.getShape(t);if(!i)return;n.push(i);const s=e.getSortedChildIdsForParent(t);for(let r=0,o=s.length;r<o;r++)pS(e,s[r],n)}function gS(e,t,n){let i;if(e.history.ignore((()=>{const s=e.store.extractingChanges((()=>{const s=new Set,r=new Set;for(const n of t){if(e.getShape(n))for(const i of e.getBindingsInvolvingShape(n)){const e=t.has(i.fromId),n=t.has(i.toId);e&&n?s.add(i.id):e&&n||r.add(i.id)}}e.deleteBindings([...r],{isolateShapes:!0});try{i=xd.ok(n(s))}catch(o){i=xd.err(o)}}));e.store.applyDiff($h(s))})),i.ok)return i.value;throw i.error}function fS(e,t){if(!t.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:i}}=t.constraints,s=e.getViewportScreenBounds(),r=Ux.From(t.constraints.bounds);return{zx:(s.w-2*n)/r.w,zy:(s.h-2*i)/r.h}}function mS(){const e=jm(),t=yb();return Ru("isDarkMode",(()=>(null==t?void 0:t.isDarkMode)??e.user.getIsDarkMode()),[t,e])}cS([ju],dS.prototype,"getCanUndo"),cS([ju],dS.prototype,"getCanRedo"),cS([ju],dS.prototype,"getPath"),cS([ju],dS.prototype,"getCurrentTool"),cS([ju],dS.prototype,"getCurrentToolId"),cS([ju],dS.prototype,"getDocumentSettings"),cS([ju],dS.prototype,"getInstanceState"),cS([ju],dS.prototype,"getOpenMenus"),cS([ju],dS.prototype,"getIsMenuOpen"),cS([ju],dS.prototype,"getPageStates"),cS([ju],dS.prototype,"_getPageStatesQuery"),cS([ju],dS.prototype,"getCurrentPageState"),cS([ju],dS.prototype,"_getCurrentPageStateId"),cS([ju],dS.prototype,"getSelectedShapeIds"),cS([ju],dS.prototype,"getSelectedShapes"),cS([ju],dS.prototype,"getOnlySelectedShapeId"),cS([ju],dS.prototype,"getOnlySelectedShape"),cS([ju],dS.prototype,"getSelectionPageBounds"),cS([ju],dS.prototype,"getSelectionRotation"),cS([ju],dS.prototype,"getSelectionRotatedPageBounds"),cS([ju],dS.prototype,"getSelectionRotatedScreenBounds"),cS([ju],dS.prototype,"getFocusedGroupId"),cS([ju],dS.prototype,"getFocusedGroup"),cS([ju],dS.prototype,"getEditingShapeId"),cS([ju],dS.prototype,"getEditingShape"),cS([ju],dS.prototype,"getHoveredShapeId"),cS([ju],dS.prototype,"getHoveredShape"),cS([ju],dS.prototype,"getHintingShapeIds"),cS([ju],dS.prototype,"getHintingShape"),cS([ju],dS.prototype,"getErasingShapeIds"),cS([ju],dS.prototype,"getErasingShapes"),cS([ju],dS.prototype,"getCameraId"),cS([ju],dS.prototype,"getCamera"),cS([ju],dS.prototype,"getViewportPageBoundsForFollowing"),cS([ju],dS.prototype,"getCameraForFollowing"),cS([ju],dS.prototype,"getZoomLevel"),cS([ju],dS.prototype,"getViewportScreenBounds"),cS([ju],dS.prototype,"getViewportScreenCenter"),cS([ju],dS.prototype,"getViewportPageBounds"),cS([ju],dS.prototype,"_getCollaboratorsQuery"),cS([ju],dS.prototype,"getCollaborators"),cS([ju],dS.prototype,"getCollaboratorsOnCurrentPage"),cS([ju],dS.prototype,"getRenderingShapes"),cS([ju],dS.prototype,"_getAllPagesQuery"),cS([ju],dS.prototype,"getPages"),cS([ju],dS.prototype,"getCurrentPageId"),cS([ju],dS.prototype,"getCurrentPageShapeIdsSorted"),cS([ju],dS.prototype,"_getAllAssetsQuery"),cS([ju],dS.prototype,"_getShapeGeometryCache"),cS([ju],dS.prototype,"_getShapeHandlesCache"),cS([ju],dS.prototype,"_getShapePageTransformCache"),cS([ju],dS.prototype,"_getShapePageBoundsCache"),cS([ju],dS.prototype,"_getShapeClipPathCache"),cS([ju],dS.prototype,"_getShapeMaskCache"),cS([ju],dS.prototype,"_getShapeMaskedPageBoundsCache"),cS([ju],dS.prototype,"_notVisibleShapes"),cS([ju],dS.prototype,"getCulledShapes"),cS([ju],dS.prototype,"getCurrentPageBounds"),cS([ju],dS.prototype,"getCurrentPageShapes"),cS([ju],dS.prototype,"getCurrentPageShapesSorted"),cS([ju],dS.prototype,"getCurrentPageRenderingShapesSorted"),cS([ju],dS.prototype,"_getBindingsIndexCache"),cS([ju],dS.prototype,"_getSelectionSharedStyles"),cS([ju({isEqual:(e,t)=>e.equals(t)})],dS.prototype,"getSharedStyles"),cS([ju],dS.prototype,"getSharedOpacity"),cS([ju],dS.prototype,"getIsFocused");const yS="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",xS="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",wS='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function vS(e,t,n,i,s,r=16,o=16){const a=Lm/180*(-n-t),l=Math.sin(a),c=Math.cos(a);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*c-1*l}' dy='${1*l+1*c}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${i?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${r} ${o}, pointer`}const bS=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],SS={none:()=>"none","ew-resize":(e,t,n)=>vS(xS,e,0,t,n),"ns-resize":(e,t,n)=>vS(xS,e,90,t,n),"nesw-resize":(e,t,n)=>vS(yS,e,0,t,n),"nwse-resize":(e,t,n)=>vS(yS,e,90,t,n),"nwse-rotate":(e,t,n)=>vS(wS,e,0,t,n),"nesw-rotate":(e,t,n)=>vS(wS,e,90,t,n),"senw-rotate":(e,t,n)=>vS(wS,e,180,t,n),"swne-rotate":(e,t,n)=>vS(wS,e,270,t,n)};function kS(e,t=0,n="black"){return SS[e](180*t/Lm,!1,n)}function CS(e){const t=C.useRef();return C.useLayoutEffect((()=>{t.current=e})),C.useDebugValue(e),C.useCallback(((...e)=>{const n=t.current;return vd(n,"fn does not exist"),n(...e)}),[])}const _S=(e,t)=>t.some((t=>e instanceof t));let PS,IS;const jS=new WeakMap,ES=new WeakMap,TS=new WeakMap,MS=new WeakMap,AS=new WeakMap;let OS={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ES.get(e);if("objectStoreNames"===t)return e.objectStoreNames||TS.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return LS(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function DS(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(IS||(IS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(zS(this),t),LS(jS.get(this))}:function(...t){return LS(e.apply(zS(this),t))}:function(t,...n){const i=e.call(zS(this),t,...n);return TS.set(i,t.sort?t.sort():[t]),LS(i)}}function RS(e){return"function"==typeof e?DS(e):(e instanceof IDBTransaction&&function(e){if(ES.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));ES.set(e,t)}(e),_S(e,PS||(PS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,OS):e)}function LS(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(LS(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&jS.set(t,e)})).catch((()=>{})),AS.set(t,e),t}(e);if(MS.has(e))return MS.get(e);const t=RS(e);return t!==e&&(MS.set(e,t),AS.set(t,e)),t}const zS=e=>AS.get(e);function FS(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=LS(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(LS(o.result),e.oldVersion,e.newVersion,LS(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const NS=["get","getKey","getAll","getAllKeys","count"],$S=["put","add","delete","clear"],BS=new Map;function US(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(BS.get(t))return BS.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=$S.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!NS.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return BS.set(t,r),r}OS=(e=>({...e,get:(t,n,i)=>US(t,n)||e.get(t,n,i),has:(t,n)=>!!US(t,n)||e.has(t,n)}))(OS);const KS="TLDRAW_DOCUMENT_v2",HS="TLDRAW_DB_NAME_INDEX_v2",VS={Records:"records",Schema:"schema",SessionState:"session_state"};async function WS(e,t){!function(e){const t=new Set(GS());t.add(e),wh(HS,JSON.stringify([...t]))}(e);const n=await FS(e,3,{upgrade(e){e.objectStoreNames.contains(VS.Records)||e.createObjectStore(VS.Records),e.objectStoreNames.contains(VS.Schema)||e.createObjectStore(VS.Schema),e.objectStoreNames.contains(VS.SessionState)||e.createObjectStore(VS.SessionState)}});try{return await t(n)}finally{n.close()}}async function YS({persistenceKey:e,sessionId:t,didCancel:n}){const i=KS+e;if(GS().includes(i))return await async function({persistenceKey:e,didCancel:t}){await WS(KS+e,(async e=>{const n=e.transaction([VS.SessionState],"readwrite"),i=n.objectStore(VS.SessionState),s=(await i.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt));if(s.length<10)return void(await n.done);const r=s.slice(0,s.length-10);for(const{id:t}of r)await i.delete(t);if(null==t?void 0:t())return n.abort();await n.done}))}({persistenceKey:e,didCancel:n}),await WS(i,(async e=>{var i,s;if(null==n?void 0:n())return;const r=e.transaction([VS.Records,VS.Schema,VS.SessionState],"readonly"),o=r.objectStore(VS.Records),a=r.objectStore(VS.Schema),l=r.objectStore(VS.SessionState);let c=t?null==(i=await l.get(t))?void 0:i.snapshot:null;if(!c){c=null==(s=(await l.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt)).pop())?void 0:s.snapshot}const d={records:await o.getAll(),schema:await a.get(VS.Schema),sessionStateSnapshot:c};if(!(null==n?void 0:n()))return await r.done,d;r.abort()}))}function GS(){const e=JSON.parse(xh(HS)||"[]")??[];return Array.isArray(e)?e:[]}const XS=Symbol("UPDATE_INSTANCE_STATE");const qS="undefined"==typeof BroadcastChannel?class{constructor(e){b(this,"onmessage")}postMessage(e){}close(){}}:BroadcastChannel;class ZS{constructor(e,{persistenceKey:t,sessionId:n=jv,onLoad:i,onLoadError:s},r=new qS(`tldraw-tab-sync-${t}`)){b(this,"disposables",new Set),b(this,"diffQueue",[]),b(this,"didDispose",!1),b(this,"shouldDoFullDBWrite",!0),b(this,"isReloading",!1),b(this,"persistenceKey"),b(this,"sessionId"),b(this,"serializedSchema"),b(this,"isDebugging",!1),b(this,"documentTypes"),b(this,"$sessionStateSnapshot"),b(this,"initTime",Date.now()),b(this,"isPersisting",!1),b(this,"didLastWriteError",!1),b(this,"scheduledPersistTimeout",null),this.store=e,this.channel=r,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=Ov(this.store),this.disposables.add(e.listen((({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema}),this.schedulePersist()}),{source:"user",scope:"document"})),this.disposables.add(e.listen((()=>{this.diffQueue.push(XS),this.schedulePersist()}),{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName)))}debug(...e){this.isDebugging}async connect(e,t){let n;this.debug("connecting");try{n=await YS({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(i){return t(i),window.alert("Oops! We could not access your browser's storageâand the app won't work correctly without that. We now need to reload the page and try again.\n\nKeep seeing this message?\nâ¢ If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser."),void("undefined"!=typeof window&&window.location.reload())}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){const e=Object.fromEntries(n.records.map((e=>[e.id,e]))),i=n.sessionStateSnapshot??function(e){var t;const n=[];for(const o of Object.values(e))(null==(t=o.typeName)?void 0:t.match(/^(instance.*|pointer|camera)$/))&&n.push(o);const i=n.filter((e=>"instance"===e.typeName&&e.id!==Ug))[0];if(!i)return null;const s={version:Tv,currentPageId:i.currentPageId,exportBackground:!!i.exportBackground,isFocusMode:!!i.isFocusMode,isDebugMode:!!i.isDebugMode,isToolLocked:!!i.isToolLocked,isGridMode:!1,pageStates:n.filter((e=>"instance_page_state"===e.typeName&&e.instanceId===i.id)).map((t=>{const n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}}))};try{return Mv.validate(s),s}catch(r){return null}}(e),s=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===s.type)return console.error("failed to migrate store",s),void t(new Error(`Failed to migrate store: ${s.reason}`));this.store.mergeRemoteChanges((()=>{this.store.put(Object.values(s.value).filter((e=>this.documentTypes.has(e.typeName))),"initialize")})),i&&Dv(this.store,i)}this.channel.onmessage=({data:e})=>{var n,i;this.debug("got message",e);const s=e,r=this.store.schema.getMigrationsSince(s.schema);if(!r.ok){return Date.now()-this.initTime<5e3?void t(new Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void(null==(i=null==(n=null==window?void 0:window.location)?void 0:n.reload)||i.call(n)))}if(r.value.length>0)return this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,void this.persistIfNeeded();"diff"===s.type&&(this.debug("applying diff"),fu((()=>{this.store.mergeRemoteChanges((()=>{this.store.applyDiff(s.changes),this.store.ensureStoreIsUsable()}))})))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add((()=>{this.channel.close()})),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;return void t(s)}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach((e=>e()))}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout((()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()}),this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){vd(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await async function({persistenceKey:e,schema:t,snapshot:n,sessionId:i,sessionStateSnapshot:s,didCancel:r}){const o=KS+e;await WS(o,(async e=>{const o=e.transaction([VS.Records,VS.Schema,VS.SessionState],"readwrite"),a=o.objectStore(VS.Records),l=o.objectStore(VS.Schema),c=o.objectStore(VS.SessionState);await a.clear();for(const[t,i]of Object.entries(n))await a.put(i,t);if(l.put(t.serialize(),VS.Schema),s&&i?c.put({snapshot:s,updatedAt:Date.now(),id:i},i):(s||i)&&console.error("sessionStateSnapshot and instanceId must be provided together"),null==r?void 0:r())return o.abort();await o.done}))}({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=Uh(e.filter((e=>e!==XS)));await async function({persistenceKey:e,schema:t,changes:n,sessionId:i,sessionStateSnapshot:s,didCancel:r}){const o=KS+e;await WS(o,(async e=>{const o=e.transaction([VS.Records,VS.Schema,VS.SessionState],"readwrite"),a=o.objectStore(VS.Records),l=o.objectStore(VS.Schema),c=o.objectStore(VS.SessionState);for(const[t,i]of Object.entries(n.added))await a.put(i,t);for(const[t,i]of Object.values(n.updated))await a.put(i,i.id);for(const t of Object.keys(n.removed))await a.delete(t);if(l.put(t.serialize(),VS.Schema),s&&i?c.put({snapshot:s,updatedAt:Date.now(),id:i},i):(s||i)&&console.error("sessionStateSnapshot and instanceId must be provided together"),null==r?void 0:r())return o.abort();await o.done}))}({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),window.alert("Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.\n\nKeep seeing this message?\nâ¢ If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.\nâ¢ If your hard disk is full, try clearing up some space and then reload the page."),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function JS({initialData:e,defaultName:t="",id:n,...i}={}){const s="schema"in i&&i.schema?i.schema:vm({shapes:"shapeUtils"in i&&i.shapeUtils?QS(ob(i.shapeUtils)):void 0,bindings:"bindingUtils"in i&&i.bindingUtils?QS(zv(i.bindingUtils)):void 0,migrations:"migrations"in i?i.migrations:void 0});return new Ku({id:n,schema:s,initialData:e,props:{defaultName:t}})}function QS(e){return Object.fromEntries(e.map((e=>[e.type,{props:e.props,migrations:e.migrations}])))}function ek(e){const t=JS(e);return e.snapshot&&Rv(t,e.snapshot),{store:t,opts:e}}function tk(e){const[t,n]=C.useState((()=>ek(e)));if(!Zd(t.opts,e)){const t=ek(e);return n(t),t.store}return t.store}const nk=[],ik=[],sk=[],rk=C.memo((function({store:e,components:t,className:n,user:i,...s}){const[r,o]=P.useState(null),a=C.useMemo((()=>i??kv()),[i]),l=void 0===(null==t?void 0:t.ErrorFallback)?iv:null==t?void 0:t.ErrorFallback,c={...s,shapeUtils:s.shapeUtils??nk,bindingUtils:s.bindingUtils??ik,tools:s.tools??sk,components:t};return k.jsx("div",{ref:o,draggable:!1,className:I("tl-container tl-theme__light",n),onPointerDown:Iy,tabIndex:-1,children:k.jsx(Pm,{fallback:l,onError:e=>Cd(e,{tags:{origin:"react.tldraw-before-app"}}),children:r&&k.jsx(My,{container:r,children:k.jsx(Qw,{overrides:t,children:e?e instanceof Ku?k.jsx(lk,{...c,store:e,user:a}):k.jsx(ak,{...c,store:e,user:a}):k.jsx(ok,{...c,store:e,user:a})})})})})}));function ok(e){const{defaultName:t,snapshot:n,initialData:i,shapeUtils:s,bindingUtils:r,persistenceKey:o,sessionId:a,user:l}=e,c=function({persistenceKey:e,sessionId:t,...n}){const[i,s]=C.useState(null),r=tk(n);return C.useEffect((()=>{const n=sv();if(!e)return void s({id:n,storeWithStatus:{status:"not-synced",store:r}});s({id:n,storeWithStatus:{status:"loading"}});const i=e=>{s((t=>(null==t?void 0:t.id)===n?{id:n,storeWithStatus:e}:t))},o=new ZS(r,{sessionId:t,persistenceKey:e,onLoad(){i({store:r,status:"synced-local"})},onLoadError(e){i({status:"error",error:e})}});return()=>{s((e=>(null==e?void 0:e.id)===n?null:e)),o.close()}}),[e,r,t]),(null==i?void 0:i.storeWithStatus)??{status:"loading"}}({shapeUtils:s,bindingUtils:r,initialData:i,persistenceKey:o,sessionId:a,defaultName:t,snapshot:n});return k.jsx(ak,{...e,store:c,user:l})}const ak=C.memo((function({store:e,user:t,...n}){const i=Ay();C.useLayoutEffect((()=>{"dark"===t.userPreferences.get().colorScheme&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))}),[i,t]);const{LoadingScreen:s}=ev();switch(e.status){case"error":throw e.error;case"loading":return s?k.jsx(s,{}):null}return k.jsx(lk,{...n,store:e.store,user:t})}));function lk({onMount:e,children:t,store:n,tools:i,shapeUtils:s,bindingUtils:r,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:d,assetOptions:h,options:u}){const{ErrorFallback:p}=ev(),g=Ay(),f=C.useRef(null),[m,y]=C.useState(null),x=f.current;m!==x&&y(x);const[w]=C.useState(l);C.useLayoutEffect((()=>{const e=new dS({store:n,shapeUtils:s,bindingUtils:r,tools:i,getContainer:()=>g,user:o,initialState:a,autoFocus:w,inferDarkMode:c,cameraOptions:d,assetOptions:h,options:u});return f.current=e,y(e),()=>{e.dispose()}}),[g,s,r,i,n,o,a,w,c,d,h,u]);const v=C.useSyncExternalStore(C.useCallback((e=>x?(x.on("crash",e),()=>x.off("crash",e)):()=>{}),[x]),(()=>(null==x?void 0:x.getCrashingError())??null)),{Canvas:b}=ev();return x?k.jsx(Pm,{fallback:p,onError:e=>x.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:v?k.jsx(dk,{crashingError:v}):k.jsx(Im.Provider,{value:x,children:k.jsx(ck,{onMount:e,children:t??(b?k.jsx(b,{}):null)})})}):null}function ck({children:e,onMount:t}){return function(){const e=jm(),t=Ay();C.useEffect((()=>{const n=e=>t.style.setProperty("--tl-zoom",e.toString()),i=Sd(n,100),s=new lu("useZoomCss",(()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):i(e.getZoomLevel())}));return s.attach(),s.execute(),()=>{s.detach(),i.cancel()}}),[e,t])}(),function(){const e=jm(),t=Ay(),n=mS();Du("useCursor",(()=>{const{type:i,rotation:s}=e.getInstanceState().cursor;bS.includes(i)?t.style.setProperty("--tl-cursor",`var(--tl-cursor-${i})`):t.style.setProperty("--tl-cursor",kS(i,s,n?"white":"black"))}),[e,t,n])}(),function(){const e=jm(),t=Ay(),n=mS(),i=Ru(vy.forceSrgb);P.useEffect((()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),i?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")}),[e,t,i,n])}(),function(){const[e,t]=C.useState(0);C.useEffect((()=>t((e=>e+1))),[])}(),function(e){const t=jm(),n=CS((t=>{let n;return t.history.ignore((()=>{n=null==e?void 0:e(t),t.emit("mount")})),window.tldrawReady=!0,n}));P.useLayoutEffect((()=>{if(t)return null==n?void 0:n(t)}),[t,n])}(t),k.jsx(k.Fragment,{children:e})}function dk({crashingError:e}){throw e}function hk({children:e}){return k.jsx("div",{className:"tl-loading",children:e})}function uk({children:e}){return k.jsx("div",{className:"tl-loading",children:e})}function pk({children:e,className:t="",...n}){return k.jsx("div",{...n,className:I("tl-html-container",t),children:e})}class gk{constructor(e){this.editor=e}}function fk(e,t,n={}){const{newPoint:i,handle:s,scaleX:r,scaleY:o}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=n;let h=e.props.w*r,u=e.props.h*o;const p=new Am(0,0);if(h>0){if(h<a){switch(s){case"top_left":case"left":case"bottom_left":p.x=h-a;break;case"top":case"bottom":p.x=(h-a)/2;break;default:p.x=0}h=a}}else if(p.x=h,h=-h,h<a){switch(s){case"top_left":case"left":case"bottom_left":p.x=-h;break;default:p.x=-a}h=a}if(u>0){if(u<c){switch(s){case"top_left":case"top":case"top_right":p.y=u-c;break;case"right":case"left":p.y=(u-c)/2;break;default:p.y=0}u=c}}else if(p.y=u,u=-u,u<c){switch(s){case"top_left":case"top":case"top_right":p.y=-u;break;default:p.y=-c}u=c}const{x:g,y:f}=p.rot(e.rotation).add(i);return{x:g,y:f,props:{w:Math.min(l,h),h:Math.min(d,u)}}}b(gk,"props"),b(gk,"migrations"),b(gk,"type");class mk extends tb{constructor(){super(...arguments),b(this,"onResize",((e,t)=>fk(e,t)))}getGeometry(e){return new eb({width:e.props.w,height:e.props.h,isFilled:!0})}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}}let yk=(e=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(e,"id","idle"),e),xk=(t=class extends rS{constructor(){super(...arguments),b(this,"markId",""),b(this,"wasFocusedOnEnter",!1),b(this,"onEnter",(()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()})),b(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,i=eg();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:n,x:t.x,y:t.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.cancel()}))}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const t=this.parent.shapeType,n=eg();this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(n);if(!i)return void this.cancel();let{w:s,h:r}=i.props;const o=new Am(s/2,r/2),a=this.editor.getShapeParentTransform(i);a&&o.rot(-a.rotation());let l=1;this.editor.user.getIsDynamicResizeMode()&&(l=1/this.editor.getZoomLevel(),s*=l,r*=l,o.mul(l));const c=Rh(i);c.x=i.x-o.x,c.y=i.y-o.y,c.props.w=s,c.props.h=r,"scale"in i.props&&(c.props.scale=l),this.editor.updateShape(c),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},b(t,"id","pointing"),t);class wk extends rS{constructor(){super(...arguments),b(this,"onCreate")}}function vk(e){const t=jm();return Ru("isEditing",(()=>t.getEditingShapeId()===e),[t,e])}function bk(e){const t=jm();return C.useMemo((function(){let n,i;return{onPointerDown:n=>{if(n.isKilled)return;if(n.button===my)return void t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...Ey(n)});if(0!==n.button)return;const i=ky(n.currentTarget);_y(i,n),i.addEventListener("pointerup",(function e(){i.removeEventListener("pointerup",e),Py(i,n)})),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...Ey(n)}),Iy(n)},onPointerMove:function(s){s.isKilled||0===s.button&&(s.clientX===n&&s.clientY===i||(n=s.clientX,i=s.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...Ey(s)})))},onPointerUp:n=>{n.isKilled||0===n.button&&t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...Ey(n)})}}}),[t,e])}b(wk,"id","box"),b(wk,"initial","idle"),b(wk,"children",(()=>[yk,xk]));function Sk(e,t=20){return Math.max(8,Math.ceil(e/t))}class kk extends Gx{constructor(e){super({...e,isFilled:!1,isClosed:!1}),b(this,"_center"),b(this,"radius"),b(this,"start"),b(this,"end"),b(this,"largeArcFlag"),b(this,"sweepFlag"),b(this,"measure"),b(this,"angleStart"),b(this,"angleEnd");const{center:t,sweepFlag:n,largeArcFlag:i,start:s,end:r}=e;if(s.equals(r))throw Error("Arc must have different start and end points.");this.angleStart=Am.Angle(t,s),this.angleEnd=Am.Angle(t,r),this.radius=Am.Dist(t,s),this.measure=function(e,t,n,i){const s=(t-e)%Fm*2%Fm-(t-e)%Fm;return i?(Fm-Math.abs(s))*(n?1:-1):s}(this.angleStart,this.angleEnd,n,i),this.start=s,this.end=r,this.sweepFlag=n,this.largeArcFlag=i,this._center=t}nearestPoint(e){const{_center:t,measure:n,radius:i,angleEnd:s,angleStart:r,start:o,end:a}=this,l=ay(n,r,s,t.angle(e));if(l<=0)return o;if(l>=1)return a;const c=t.clone().add(e.clone().sub(t).uni().mul(i));let d,h,u=1/0;for(const p of[o,a,c])h=Am.Dist2(e,p),h<u&&(d=p,u=h);if(!d)throw Error("nearest point not found");return d}hitTestLineSegment(e,t){const{_center:n,radius:i,measure:s,angleStart:r,angleEnd:o}=this,a=$v(e,t,n,i);return null!==a&&a.some((e=>{const t=ay(s,r,o,n.angle(e));return t>=0&&t<=1}))}getVertices(){const{_center:e,measure:t,length:n,radius:i,angleStart:s}=this,r=[];for(let o=0,a=Sk(Math.abs(n));o<a+1;o++){const n=s+o/a*t;r.push(Zm(e,i,n))}return r}getSvgPathData(e=!0){const{start:t,end:n,radius:i,largeArcFlag:s,sweepFlag:r}=this;return`${e?`M${t.toFixed()}`:""} A${i} ${i} 0 ${s} ${r} ${n.toFixed()}`}getLength(){return this.measure*this.radius}}class Ck extends Gx{constructor(e){super({isClosed:!0,...e}),b(this,"_center"),b(this,"radius"),b(this,"x"),b(this,"y"),this.config=e;const{x:t=0,y:n=0,radius:i}=e;this.x=t,this.y=n,this._center=new Am(i+t,i+n),this.radius=i}getBounds(){return new Ux(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){const{_center:e,radius:t}=this,n=[];for(let i=0,s=Sk(Fm*t);i<s;i++){const r=i/s*Fm;n.push(Zm(e,t,r))}return n}nearestPoint(e){const{_center:t,radius:n}=this;return t.equals(e)?Am.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t,n=0){const{_center:i,radius:s}=this;return null!==$v(e,t,i,s+n)}getSvgPathData(){const{_center:e,radius:t}=this;return`M${e.x+t},${e.y} a${t},${t} 0 1,0 ${2*t},0a${t},${t} 0 1,0 -${2*t},0`}}class _k extends Jv{constructor(e){const{start:t,cp1:n,cp2:i,end:s}=e;super({...e,points:[t,s]}),b(this,"a"),b(this,"b"),b(this,"c"),b(this,"d"),this.a=t,this.b=n,this.c=i,this.d=s}getVertices(){const e=[],{a:t,b:n,c:i,d:s}=this;for(let r=0,o=10;r<=o;r++){const a=r/o;e.push(new Am((1-a)*(1-a)*(1-a)*t.x+(1-a)*(1-a)*3*a*n.x+3*(1-a)*(a*a)*i.x+a*a*a*s.x,(1-a)*(1-a)*(1-a)*t.y+(1-a)*(1-a)*3*a*n.y+3*(1-a)*(a*a)*i.y+a*a*a*s.y))}return e}midPoint(){return _k.GetAtT(this,.5)}nearestPoint(e){let t,n,i,s=1/0;for(const r of this.segments)i=r.nearestPoint(e),n=Am.Dist2(i,e),n<s&&(t=i,s=n);if(!t)throw Error("nearest point not found");return t}getSvgPathData(e=!0){const{a:t,b:n,c:i,d:s}=this;return`${e?`M ${t.toFixed()} `:""} C${n.toFixed()} ${i.toFixed()} ${s.toFixed()}`}static GetAtT(e,t){const{a:n,b:i,c:s,d:r}=e;return new Am((1-t)*(1-t)*(1-t)*n.x+(1-t)*(1-t)*3*t*i.x+3*(1-t)*(t*t)*s.x+t*t*t*r.x,(1-t)*(1-t)*(1-t)*n.y+(1-t)*(1-t)*3*t*i.y+3*(1-t)*(t*t)*s.y+t*t*t*r.y)}getLength(e=32){let t,n=this.a,i=0;for(let s=1;s<=e;s++)t=_k.GetAtT(this,s/e),i+=Am.Dist(n,t),n=t;return i}}class Pk extends Gx{constructor(e){super({...e,isClosed:!1,isFilled:!1}),b(this,"points"),b(this,"_segments");const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{points:e}=this,t=e.length,n=t-2,i=1.25;for(let s=0;s<t-1;s++){const t=0===s?e[0]:e[s-1],r=e[s],o=e[s+1],a=s===n?o:e[s+2],l=r,c=0===s?t:new Am(r.x+(o.x-t.x)/6*i,r.y+(o.y-t.y)/6*i),d=s===n?o:new Am(o.x-(a.x-r.x)/6*i,o.y-(a.y-r.y)/6*i),h=o;this._segments.push(new _k({start:l,cp1:c,cp2:d,end:h}))}}return this._segments}getLength(){return this.segments.reduce(((e,t)=>e+t.length),0)}getVertices(){const e=this.segments.reduce(((e,t)=>e.concat(t.vertices)),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t,n,i,s=1/0;for(const r of this.segments)i=r.nearestPoint(e),n=Am.Dist2(i,e),n<s&&(t=i,s=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.segments.some((n=>n.hitTestLineSegment(e,t)))}getSvgPathData(){let e=this.segments.reduce(((e,t,n)=>e+t.getSvgPathData(0===n)),"");return this.isClosed&&(e+="Z"),e}}class Ik extends Gx{constructor(e){super({...e,isClosed:!0}),b(this,"w"),b(this,"h"),b(this,"_edges"),this.config=e;const{width:t,height:n}=e;this.w=t,this.h=n}get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){const i=e[t],s=e[(t+1)%n];this._edges.push(new Zv({start:i,end:s}))}}return this._edges}getVertices(){const e=Math.max(1,this.w)/2,t=Math.max(1,this.h)/2,n=Math.pow(e-t,2)/Math.pow(e+t,2),i=Sk(Lm*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))),s=Fm/i,r=Math.cos(s),o=Math.sin(s);let a=0,l=1,c=0,d=1;const h=Array(i);for(let u=0;u<i;u++)h[u]=new Am(e+e*l,t+t*a),c=o*l+r*a,d=r*l-o*a,a=c,l=d;return h}nearestPoint(e){let t,n,i,s=1/0;for(const r of this.edges)i=r.nearestPoint(e),n=Am.Dist2(i,e),n<s&&(t=i,s=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.edges.some((n=>n.hitTestLineSegment(e,t)))}getBounds(){return new Ux(0,0,this.w,this.h)}getLength(){const{w:e,h:t}=this,n=e/2,i=t/2;return Km(Math.max(0,n),Math.max(0,i))}getSvgPathData(e=!1){const{w:t,h:n}=this,i=t/2,s=n/2,r=Math.max(0,i),o=Math.max(0,s);return`${e?`M${i-r},${s}`:""} a${r},${o},0,1,1,${2*r},0a${r},${o},0,1,1,-${2*r},0`}}class jk extends Gx{constructor(e){super({...e,isClosed:!0}),b(this,"w"),b(this,"h"),b(this,"a"),b(this,"b"),b(this,"c"),b(this,"d"),this.config=e;const{width:t,height:n}=e;if(this.w=t,this.h=n,n>t){const e=t/2;this.a=new kk({start:new Am(0,e),end:new Am(t,e),center:new Am(t/2,e),sweepFlag:1,largeArcFlag:1}),this.b=new Zv({start:new Am(t,e),end:new Am(t,n-e)}),this.c=new kk({start:new Am(t,n-e),end:new Am(0,n-e),center:new Am(t/2,n-e),sweepFlag:1,largeArcFlag:1}),this.d=new Zv({start:new Am(0,n-e),end:new Am(0,e)})}else{const e=n/2;this.a=new kk({start:new Am(e,n),end:new Am(e,0),center:new Am(e,e),sweepFlag:1,largeArcFlag:1}),this.b=new Zv({start:new Am(e,0),end:new Am(t-e,0)}),this.c=new kk({start:new Am(t-e,0),end:new Am(t-e,n),center:new Am(t-e,e),sweepFlag:1,largeArcFlag:1}),this.d=new Zv({start:new Am(t-e,n),end:new Am(e,n)})}}nearestPoint(e){let t,n,i,s=1/0;const{a:r,b:o,c:a,d:l}=this;for(const c of[r,o,a,l])i=c.nearestPoint(e),n=Am.Dist2(i,e),n<s&&(t=i,s=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){const{a:n,b:i,c:s,d:r}=this;return[n,i,s,r].some((n=>n.hitTestLineSegment(e,t)))}getVertices(){const{a:e,b:t,c:n,d:i}=this;return[e,t,n,i].reduce(((e,t)=>(e.push(...t.vertices),e)),[])}getBounds(){return new Ux(0,0,this.w,this.h)}getLength(){const{h:e,w:t}=this;return e>t?2*(Lm*(t/2)+(e-t)):2*(Lm*(e/2)+(t-e))}getSvgPathData(){const{a:e,b:t,c:n,d:i}=this;return[e,t,n,i].map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}}"undefined"!=typeof window&&(window.__tldraw__hardReset=async function({shouldReload:e=!0}={}){!function(){try{sessionStorage.clear()}catch{}}(),await Promise.all(GS().map((e=>function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(e=>t(e.oldVersion,e))),LS(n).then((()=>{}))}(e)))),function(){try{localStorage.clear()}catch{}}(),e&&window.location.reload()});const Ek="TLDRAW_ASSET_STORE_v1",Tk={Assets:"assets"};async function Mk(e,t){const n=await FS(e,1,{upgrade(e){e.objectStoreNames.contains(Tk.Assets)||e.createObjectStore(Tk.Assets)}});try{return await t(n)}finally{n.close()}}function Ak({children:e}){const t=jm();return Ru("shouldDisplayHandles",(()=>{if(t.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(t.isInAny("select.editing_shape")){const e=t.getOnlySelectedShape();return e&&t.isShapeOfType(e,"note")}return!1}),[t])?k.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null}const{PI:Ok}=Math,Dk=Ok+1e-4;function Rk(e,t={}){const{size:n=16,smoothing:i=.5}=t;if(0===e.length||n<=0)return{left:[],right:[]};const s=e[0],r=e[e.length-1],o=r.runningLength,a=Math.pow(n*i,2),l=[],c=[];let d,h=e[0].vector,u=e[0].point,p=u,g=u,f=p,m=!1;for(let y=0;y<e.length;y++){d=e[y];const{point:t,vector:n}=e[y],i=d.vector.dpr(h),x=(y<e.length-1?e[y+1]:e[y]).vector,w=y<e.length-1?x.dpr(d.vector):1,v=null!==w&&w<.2;if(i<0&&!m||v){if(w>-.62&&o-d.runningLength>d.radius){const e=h.clone().mul(d.radius);h.clone().cpr(x)<0?(g=Am.Add(t,e),f=Am.Sub(t,e)):(g=Am.Sub(t,e),f=Am.Add(t,e)),l.push(g),c.push(f)}else{const e=h.clone().mul(d.radius).per(),t=Am.Sub(d.input,e);for(let n=1/13,i=0;i<1;i+=n)g=Am.RotWith(t,d.input,Dk*i),l.push(g),f=Am.RotWith(t,d.input,Dk+Dk*-i),c.push(f)}u=g,p=f,v&&(m=!0);continue}if(m=!1,d===s||d===r){const e=Am.Per(n).mul(d.radius);l.push(Am.Sub(t,e)),c.push(Am.Add(t,e));continue}const b=Am.Lrp(x,n,w).per().mul(d.radius);g=Am.Sub(t,b),(y<=1||Am.Dist2(u,g)>a)&&(l.push(g),u=g),f=Am.Add(t,b),(y<=1||Am.Dist2(p,f)>a)&&(c.push(f),p=f),h=n}return{left:l,right:c}}function Lk(e,t={}){const{size:n=16,start:i={},end:s={},last:r=!1}=t,{cap:o=!0}=i,{cap:a=!0}=s;if(0===e.length||n<=0)return[];const l=e[0],c=e[e.length-1],d=c.runningLength,h=!1===i.taper?0:!0===i.taper?Math.max(n,d):i.taper,u=!1===s.taper?0:!0===s.taper?Math.max(n,d):s.taper,{left:p,right:g}=Rk(e,t),f=l.point,m=e.length>1?e[e.length-1].point:Am.AddXY(l.point,1,1);if(1===e.length&&(!h&&!u||r)){const e=Am.Add(f,Am.Sub(f,m).uni().per().mul(-l.radius)),t=[];for(let n=1/13,i=n;i<=1;i+=n)t.push(Am.RotWith(e,f,2*Dk*i));return t}const y=[];if(h||u&&1===e.length);else if(o)for(let v=1/8,b=v;b<=1;b+=v){const e=Am.RotWith(g[0],f,Dk*b);y.push(e)}else{const e=Am.Sub(p[0],g[0]),t=Am.Mul(e,.5),n=Am.Mul(e,.51);y.push(Am.Sub(f,t),Am.Sub(f,n),Am.Add(f,n),Am.Add(f,t))}const x=[],w=c.vector.clone().per().neg();if(u||h&&1===e.length)x.push(m);else if(a){const e=Am.Add(m,Am.Mul(w,c.radius));for(let t=1/29,n=t;n<1;n+=t)x.push(Am.RotWith(e,m,3*Dk*n))}else x.push(Am.Add(m,Am.Mul(w,c.radius)),Am.Add(m,Am.Mul(w,.99*c.radius)),Am.Sub(m,Am.Mul(w,.99*c.radius)),Am.Sub(m,Am.Mul(w,c.radius)));return p.concat(x,g.reverse(),y)}const zk=.025,Fk=.01;function Nk(e,t={}){var n;const{streamline:i=.5,size:s=16,simulatePressure:r=!1}=t;if(0===e.length)return[];const o=.15+.85*(1-i);let a=e.map(Am.From),l=0;if(!r){let e=a[0];for(;e&&!(e.z>=zk);)a.shift(),e=a[0]}if(!r){let e=a[a.length-1];for(;e&&!(e.z>=Fk);)a.pop(),e=a[a.length-1]}if(0===a.length)return[{point:Am.From(e[0]),input:Am.From(e[0]),pressure:r?.5:.15,vector:new Am(1,1),distance:0,runningLength:0,radius:1}];let c=a[1];for(;c&&!(Am.Dist2(c,a[0])>(s/3)**2);)a[0].z=Math.max(a[0].z,c.z),a.splice(1,1),c=a[1];const d=a.pop();for(c=a[a.length-1];c&&!(Am.Dist2(c,d)>(s/3)**2);)a.pop(),c=a[a.length-1],l++;a.push(d);const h=t.last||!t.simulatePressure||a.length>1&&Am.Dist2(a[a.length-1],a[a.length-2])<s**2||l>0;if(2===a.length&&t.simulatePressure){const e=a[1];a=a.slice(0,-1);for(let t=1;t<5;t++){const n=Am.Lrp(a[0],e,t/4);n.z=(a[0].z+(e.z-a[0].z))*t/4,a.push(n)}}const u=[{point:a[0],input:a[0],pressure:r?.5:a[0].z,vector:new Am(1,1),distance:0,runningLength:0,radius:1}];let p,g,f=0,m=u[0];h&&i>0&&a.push(a[a.length-1].clone());for(let y=1,x=a.length;y<x;y++)p=!o||t.last&&y===x-1?a[y].clone():a[y].clone().lrp(m.point,1-o),m.point.equals(p)||(g=Am.Dist(p,m.point),f+=g,y<4&&f<s||(m={input:a[y],point:p,pressure:r?.5:a[y].z,vector:Am.Sub(m.point,p).uni(),distance:g,runningLength:f,radius:1},u.push(m)));if((null==(n=u[1])?void 0:n.vector)&&(u[0].vector=u[1].vector.clone()),f<1){const e=Math.max(.5,...u.map((e=>e.pressure)));u.forEach((t=>t.pressure=e))}return u}const{min:$k}=Math,Bk=.275;function Uk(e,t){const{size:n=16,thinning:i=.5,simulatePressure:s=!0,easing:r=e=>e,start:o={},end:a={}}=t,{easing:l=Mm.easeOutQuad}=o,{easing:c=Mm.easeOutCubic}=a,d=e[e.length-1].runningLength;let h,u,p=e[0].pressure;if(!s&&d<n){const t=e.reduce(((e,t)=>Math.max(e,t.pressure)),.5);return e.forEach((e=>{e.pressure=t,e.radius=n*r(.5-i*(.5-e.pressure))})),e}{let t;for(let i=0,r=e.length;i<r&&(u=e[i],!(u.runningLength>5*n));i++){const e=$k(1,u.distance/n);if(s){const n=$k(1,1-e);t=$k(1,p+e*Bk*(n-p))}else t=$k(1,p+.5*(u.pressure-p));p+=.5*(t-p)}for(let o=0;o<e.length;o++){if(u=e[o],i){let{pressure:e}=u;const t=$k(1,u.distance/n);if(s){const n=$k(1,1-t);e=$k(1,p+t*Bk*(n-p))}else e=$k(1,p+t*Bk*(e-p));u.radius=n*r(.5-i*(.5-e)),p=e}else u.radius=n/2;void 0===h&&(h=u.radius)}}const g=!1===o.taper?0:!0===o.taper?Math.max(n,d):o.taper,f=!1===a.taper?0:!0===a.taper?Math.max(n,d):a.taper;if(g||f)for(let m=0;m<e.length;m++){u=e[m];const{runningLength:t}=u,n=t<g?l(t/g):1,i=d-t<f?c((d-t)/f):1;u.radius=Math.max(.01,u.radius*Math.min(n,i))}return e}function Kk({scribble:e,zoom:t,color:n,opacity:i,className:s}){if(!e.points.length)return null;const r=function(e,t={}){return Lk(Uk(Nk(e,t),t),t)}(e.points,{size:e.size/t,start:{taper:e.taper,easing:Mm.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});let o;if(r.length<4){const n=e.size/t/2,{x:i,y:s}=e.points[e.points.length-1];o=`M ${i-n},${s} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${2*-n},0`}else o=Rw(r);return k.jsx("svg",{className:s?I("tl-overlays__item",s):s,children:k.jsx("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${e.color})`,opacity:i??e.opacity})})}const Hk=({bounds:e,rotation:t})=>{const n=jm();return Ru("should display",(()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing")),[n])?k.jsx(zw,{bounds:e,rotation:t}):null};function Vk(){const e=jm();return Ru("isReadonlyMode",(()=>e.getInstanceState().isReadonly),[e])}function Wk({size:e,width:t,height:n,hideAlternateHandles:i}){const s=iy(e/3),r=s/2;return k.jsxs("svg",{className:"tl-overlays__item",children:[k.jsx("polyline",{className:"tl-corner-crop-handle",points:`\n\t\t\t\t\t\t${iy(0-r)},${iy(e)} \n\t\t\t\t\t\t${iy(0-r)},${iy(0-r)} \n\t\t\t\t\t\t${iy(e)},${iy(0-r)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),k.jsx("line",{className:I("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:iy(t/2-e),y1:iy(0-r),x2:iy(t/2+e),y2:iy(0-r),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),k.jsx("polyline",{className:I("tl-corner-crop-handle",{"tl-hidden":i}),points:`\n\t\t\t\t\t\t${iy(t-e)},${iy(0-r)} \n\t\t\t\t\t\t${iy(t+r)},${iy(0-r)} \n\t\t\t\t\t\t${iy(t+r)},${iy(e)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),k.jsx("line",{className:I("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:iy(t+r),y1:iy(n/2-e),x2:iy(t+r),y2:iy(n/2+e),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),k.jsx("polyline",{className:"tl-corner-crop-handle",points:`\n\t\t\t\t\t\t${iy(t+r)},${iy(n-e)} \n\t\t\t\t\t\t${iy(t+r)},${iy(n+r)}\n\t\t\t\t\t\t${iy(t-e)},${iy(n+r)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),k.jsx("line",{className:I("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:iy(t/2-e),y1:iy(n+r),x2:iy(t/2+e),y2:iy(n+r),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),k.jsx("polyline",{className:I("tl-corner-crop-handle",{"tl-hidden":i}),points:`\n\t\t\t\t\t\t${iy(0+e)},${iy(n+r)} \n\t\t\t\t\t\t${iy(0-r)},${iy(n+r)}\n\t\t\t\t\t\t${iy(0-r)},${iy(n-e)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),k.jsx("line",{className:I("tl-corner-crop-edge-handle",{"tl-hidden":i}),x1:iy(0-r),y1:iy(n/2-e),x2:iy(0-r),y2:iy(n/2+e),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Yk=Ou((function({bounds:e,rotation:t}){const n=jm(),i=C.useRef(null),s=Vk(),r=bk("top"),o=bk("right"),a=bk("bottom"),l=bk("left"),c=bk("top_left"),d=bk("top_right"),h=bk("bottom_right"),u=bk("bottom_left"),p=!n.getIsMenuOpen()&&"default"===n.getInstanceState().cursor.type,g=n.getInstanceState().isCoarsePointer,f=n.getOnlySelectedShape(),m=f&&n.isShapeOrAncestorLocked(f),y=f?n.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(Tm(i,null==e?void 0:e.x,null==e?void 0:e.y,1,n.getSelectionRotation(),{x:-y,y:-y}),!e)return null;e=e.clone().expandBy(y).zeroFix();const x=n.getZoomLevel(),w=n.getInstanceState().isChangingStyle,v=e.width,b=e.height,S=8/x,_=v<2*S,P=b<2*S,j=v<4*S,E=b<4*S,T=v<5*S,M=b<5*S,A=g?1.75:1,O=6/x*A,D=(j?O/2:O)*(.75*A),R=(E?O/2:O)*(.75*A),L=!(f&&n.getShapeUtil(f).hideSelectionBoundsFg(f)||w);let z=L&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||L&&n.isIn("select.resizing")&&f&&n.isShapeOfType(f,"text");f&&z&&n.environment.isFirefox&&n.isShapeOfType(f,"embed")&&(z=!1);const F=n.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!w&&!s,N=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!s,$=!g&&!(_||P)&&(N||F)&&(!f||!n.getShapeUtil(f).hideRotateHandle(f))&&!m,B=g&&(!j||!E)&&(N||F)&&(!f||!n.getShapeUtil(f).hideRotateHandle(f))&&!m,U=N&&(!f||n.getShapeUtil(f).canResize(f)&&!n.getShapeUtil(f).hideResizeHandles(f))&&!F&&!m,K=_||P,H=_&&P,V=T||M,W=U||F,Y=!$,G=!N||!B,X=!N||!W,q=!N||!W||K,Z=!N||!W||K,J=!N||!W||H&&!F;let Q=!0,ee=!0;if(F)Q=V,ee=V;else if(U){Q=K||H||g;const e=g&&f&&"text"===f.type;ee=Q&&!e}const te=Math.min(24/x,b-3*R),ne=N&&g&&f&&n.isShapeOfType(f,"text")&&te*x>=4;return k.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:k.jsxs("g",{ref:i,children:[z&&k.jsx("rect",{className:"tl-selection__fg__outline",width:iy(v),height:iy(b)}),k.jsx(Gk,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:O,corner:"top_left_rotate",cursor:p?kS("nwse-rotate",t):void 0,isHidden:Y}),k.jsx(Gk,{"data-testid":"selection.rotate.top-right",cx:v+3*O,cy:0,targetSize:O,corner:"top_right_rotate",cursor:p?kS("nesw-rotate",t):void 0,isHidden:Y}),k.jsx(Gk,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:b+3*O,targetSize:O,corner:"bottom_left_rotate",cursor:p?kS("swne-rotate",t):void 0,isHidden:Y}),k.jsx(Gk,{"data-testid":"selection.rotate.bottom-right",cx:v+3*O,cy:b+3*O,targetSize:O,corner:"bottom_right_rotate",cursor:p?kS("senw-rotate",t):void 0,isHidden:Y}),k.jsx(qk,{"data-testid":"selection.rotate.mobile",cx:j?1.5*-O:v/2,cy:j?b/2:1.5*-O,size:S,isHidden:G}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:iy(0-(E?2*R:R)),width:iy(v),height:iy(Math.max(1,2*R)),style:p?{cursor:kS("ns-resize",t)}:void 0,...r}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:iy(v-(j?0:D)),y:0,height:iy(b),width:iy(Math.max(1,2*D)),style:p?{cursor:kS("ew-resize",t)}:void 0,...o}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:iy(b-(E?0:R)),width:iy(v),height:iy(Math.max(1,2*R)),style:p?{cursor:kS("ns-resize",t)}:void 0,...a}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:iy(0-(j?2*D:D)),y:0,height:iy(b),width:iy(Math.max(1,2*D)),style:p?{cursor:kS("ew-resize",t)}:void 0,...l}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":X}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:iy(0-(j?2*D:1.5*D)),y:iy(0-(E?2*R:1.5*R)),width:iy(3*D),height:iy(3*R),style:p?{cursor:kS("nwse-resize",t)}:void 0,...c}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":q}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:iy(v-(j?0:1.5*D)),y:iy(0-(E?2*R:1.5*R)),width:iy(3*D),height:iy(3*R),style:p?{cursor:kS("nesw-resize",t)}:void 0,...d}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:iy(v-(j?D:1.5*D)),y:iy(b-(E?R:1.5*R)),width:iy(3*D),height:iy(3*R),style:p?{cursor:kS("nwse-resize",t)}:void 0,...h}),k.jsx("rect",{className:I("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:iy(0-(j?3*D:1.5*D)),y:iy(b-(E?0:1.5*R)),width:iy(3*D),height:iy(3*R),style:p?{cursor:kS("nesw-resize",t)}:void 0,...u}),U&&k.jsxs(k.Fragment,{children:[k.jsx("rect",{"data-testid":"selection.resize.top-left",className:I("tl-corner-handle",{"tl-hidden":X}),"aria-label":"top_left handle",x:iy(0-S/2),y:iy(0-S/2),width:iy(S),height:iy(S)}),k.jsx("rect",{"data-testid":"selection.resize.top-right",className:I("tl-corner-handle",{"tl-hidden":q}),"aria-label":"top_right handle",x:iy(v-S/2),y:iy(0-S/2),width:iy(S),height:iy(S)}),k.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:I("tl-corner-handle",{"tl-hidden":J}),"aria-label":"bottom_right handle",x:iy(v-S/2),y:iy(b-S/2),width:iy(S),height:iy(S)}),k.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:I("tl-corner-handle",{"tl-hidden":Z}),"aria-label":"bottom_left handle",x:iy(0-S/2),y:iy(b-S/2),width:iy(S),height:iy(S)})]}),ne&&k.jsxs(k.Fragment,{children:[k.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:iy(0-S/4),y:iy(b/2-te/2),rx:S/4,width:iy(S/2),height:iy(te)}),k.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:S/4,x:iy(v-S/4),y:iy(b/2-te/2),width:iy(S/2),height:iy(te)})]}),F&&k.jsx(Wk,{size:S,width:v,height:b,hideAlternateHandles:V})]})})})),Gk=function({cx:e,cy:t,targetSize:n,corner:i,cursor:s,isHidden:r,"data-testid":o}){const a=bk(i);return k.jsx("rect",{className:I("tl-transparent","tl-rotate-corner",{"tl-hidden":r}),"data-testid":o,"aria-label":`${i} target`,pointerEvents:"all",x:iy(e-3*n),y:iy(t-3*n),width:iy(Math.max(1,3*n)),height:iy(Math.max(1,3*n)),cursor:s,...a})},Xk=Math.sqrt(Math.PI),qk=function({cx:e,cy:t,size:n,isHidden:i,"data-testid":s}){const r=bk("mobile_rotate"),o=jm(),a=Ru("zoom level",(()=>o.getZoomLevel()),[o]),l=Math.max(1/a*14,20/Math.max(1,a));return k.jsxs("g",{children:[k.jsx("circle",{"data-testid":s,pointerEvents:"all",className:I("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:l,...r}),k.jsx("circle",{className:I("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:n/Xk})]})};function Zk(e,t,n){const{arrowheadStart:i,arrowheadEnd:s}=t.props,r=oC(e,t,n),o=r.start.clone(),a=r.end.clone(),l=Am.Med(o,a);if(Am.Equals(o,a))return{bindings:n,isStraight:!0,start:{handle:o,point:o,arrowhead:t.props.arrowheadStart},end:{handle:a,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=Am.Sub(a,o).uni(),d=tC(e,t,"start"),h=tC(e,t,"end"),u=e.getShapePageTransform(t);Jk(a,r.start,u,h),Jk(o,r.end,u,d);let p=0,g=0,f=0,m=0,y=cC*t.props.scale;const x=d&&h&&d.shape===h.shape,w=d&&h?pC(e,d.shape.id,h.shape.id):"safe";"safe"!==w||!d||!h||x||d.isExact||h.isExact||(h.didIntersect&&!d.didIntersect?d.isClosed&&o.setTo(a.clone().add(c.clone().mul(cC*t.props.scale))):h.didIntersect||h.isClosed&&a.setTo(o.clone().sub(c.clone().mul(cC*t.props.scale))));const v=Am.Sub(a,o),b=Am.Len(v)?v.uni():Am.From(v),S=!Am.Equals(b,c);x||("start-contains-end"!==w&&d&&"none"!==i&&!d.isExact&&(f=uC[t.props.size]/2+("size"in d.shape.props?uC[d.shape.props.size]/2:0),p=(dC+f)*t.props.scale,y+=f*t.props.scale),"end-contains-start"!==w&&h&&"none"!==s&&!h.isExact&&(m=uC[t.props.size]/2+("size"in h.shape.props?uC[h.shape.props.size]/2:0),g=(dC+m)*t.props.scale,y+=m*t.props.scale));const k=o.clone().add(b.clone().mul(p*(S?-1:1))),C=a.clone().sub(b.clone().mul(g*(S?-1:1)));Am.DistMin(k,C,y)&&(0!==p&&0!==g?(p*=-1.5,g*=-1.5):0!==p?p*=-1:0!==g&&(g*=-1)),o.add(b.clone().mul(p*(S?-1:1))),a.sub(b.clone().mul(g*(S?-1:1))),S?(d&&h&&a.setTo(Am.Add(o,b.clone().mul(-cC*t.props.scale))),l.setTo(Am.Med(r.start,r.end))):l.setTo(Am.Med(o,a));const _=Am.Dist(o,a);return{bindings:n,isStraight:!0,start:{handle:r.start,point:o,arrowhead:t.props.arrowheadStart},end:{handle:r.end,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:_>0,length:_}}function Jk(e,t,n,i){if(void 0===i)return;if(i.isExact)return;const s=Vx.applyToPoint(n,t),r=Vx.applyToPoint(n,e),o=Vx.applyToPoint(Vx.Inverse(i.transform),s),a=Vx.applyToPoint(Vx.Inverse(i.transform),r),l=i.isClosed,c=(l?Uv:Bv)(o,a,i.outline);let d;if(null!==c&&(d=c.sort(((e,t)=>Am.Dist2(e,o)-Am.Dist2(t,o)))[0]??(l?void 0:a)),void 0===d)return;const h=Vx.applyToPoint(i.transform,d),u=Vx.applyToPoint(Vx.Inverse(n),h);e.setTo(u),i.didIntersect=!0}function Qk(e,t,n){const{arrowheadEnd:i,arrowheadStart:s}=t.props,r=t.props.bend;if(Math.abs(r)>Math.abs(t.props.bend*(hC*t.props.scale)))return Zk(e,t,n);const o=oC(e,t,n),a=Am.Med(o.start,o.end),l=Am.Sub(o.end,o.start),c=Am.Len(l)?l.uni():Am.From(l),d=Am.Add(a,c.per().mul(-r)),h=tC(e,t,"start"),u=tC(e,t,"end"),p=o.start.clone(),g=o.end.clone(),f=d.clone();if(Am.Equals(p,g))return{bindings:n,isStraight:!0,start:{handle:p,point:p,arrowhead:t.props.arrowheadStart},end:{handle:g,point:g,arrowhead:t.props.arrowheadEnd},middle:f,isValid:!1,length:0};const m=t.props.bend<0,y=m?Vm:Wm,x=eC(p,g,f),w=Am.Angle(x.center,p),v=Am.Angle(x.center,g),b=y(w,v);if(0===x.length||0===x.size||!ry(x.length)||!ry(x.size))return Zk(e,t,n);const S=p.clone(),k=g.clone(),C=f.clone(),_=e.getShapePageTransform(t);let P=0,I=0,j=cC*t.props.scale;if(h&&!h.isExact){const n=Vx.applyToPoint(_,S),i=Vx.applyToPoint(_,x.center),r=Vx.applyToPoint(_,k),o=Vx.Inverse(h.transform),a=Vx.applyToPoint(o,n),l=Vx.applyToPoint(o,i),c=Vx.applyToPoint(o,r),{isClosed:d}=h;let u,p=(d?Kv:Hv)(l,x.radius,h.outline);if(p){const e=l.angle(a),t=l.angle(c),n=y(e,t);p=p.filter((t=>y(e,l.angle(t))<=n));const i=.25*n;p.sort(d?(t,n)=>Math.abs(y(e,l.angle(t))-i)<Math.abs(y(e,l.angle(n))-i)?-1:1:(t,n)=>y(e,l.angle(t))<y(e,l.angle(n))?-1:1),u=p[0]??(d?void 0:a)}else u=d?void 0:a;if(u&&(S.setTo(e.getPointInShapeSpace(t,Vx.applyToPoint(h.transform,u))),h.didIntersect=!0,"none"!==s)){const e=uC[t.props.size]/2+("size"in h.shape.props?uC[h.shape.props.size]/2:0);P=(dC+e)*t.props.scale,j+=e*t.props.scale}}if(u&&!u.isExact){const n=Vx.applyToPoint(_,S),s=Vx.applyToPoint(_,k),r=Vx.applyToPoint(_,x.center),o=Vx.Inverse(u.transform),a=Vx.applyToPoint(o,n),l=Vx.applyToPoint(o,r),c=Vx.applyToPoint(o,s),d=u.isClosed;let h,p=(d?Kv:Hv)(l,x.radius,u.outline);if(p){const e=l.angle(a),t=l.angle(c),n=y(e,t),i=.75*n;p=p.filter((t=>y(e,l.angle(t))<=n)),p.sort(d?(t,n)=>Math.abs(y(e,l.angle(t))-i)<Math.abs(y(e,l.angle(n))-i)?-1:1:(t,n)=>y(e,l.angle(t))<y(e,l.angle(n))?-1:1),h=p[0]?p[0]:d?void 0:c}else h=d?void 0:c;if(h&&(k.setTo(e.getPointInShapeSpace(t,Vx.applyToPoint(u.transform,h))),u.didIntersect=!0,"none"!==i)){const e=uC[t.props.size]/2+("size"in u.shape.props?uC[u.shape.props.size]/2:0);I=(dC+e)*t.props.scale,j+=e*t.props.scale}}let E=Am.Angle(x.center,S),T=Am.Angle(x.center,k),M=y(E,T),A=M*x.radius;const O=S.clone(),D=k.clone();if(0!==P&&O.setTo(x.center).add(Am.FromAngle(E+M*(P/A*(m?1:-1))).mul(x.radius)),0!==I&&D.setTo(x.center).add(Am.FromAngle(T+M*(I/A*(m?-1:1))).mul(x.radius)),Am.DistMin(O,D,j)&&(0!==P&&0!==I?(P*=-1.5,I*=-1.5):0!==P?P*=-2:0!==I&&(I*=-2)),0!==P&&S.setTo(x.center).add(Am.FromAngle(E+M*(P/A*(m?1:-1))).mul(x.radius)),0!==I&&k.setTo(x.center).add(Am.FromAngle(T+M*(I/A*(m?-1:1))).mul(x.radius)),h&&u&&!h.isExact&&!u.isExact){E=Am.Angle(x.center,S),T=Am.Angle(x.center,k),M=y(E,T),A=M*x.radius;const n=pC(e,h.shape.id,u.shape.id);"double-bound"===n&&A<30?(S.setTo(p),k.setTo(g),C.setTo(f)):"safe"===n&&(h&&!h.didIntersect&&S.setTo(p),(u&&!u.didIntersect||y(w,E)>y(w,T))&&k.setTo(x.center).add(Am.FromAngle(E+M*(Math.min(.9,cC*t.props.scale/A)*(m?1:-1))).mul(x.radius)))}!function(e,t,n,i,s,r,o){const a=Am.Angle(e,n),l=Am.Angle(e,i);let c=Vm(a,l);o||(c=Fm-c);if(s.setTo(e).add(Am.FromAngle(a+c*(.5*(o?1:-1))).mul(t)),c>r){s.rotWith(e,Lm);const t=i.clone();i.setTo(n),n.setTo(t)}}(x.center,x.radius,S,k,C,b,m),S.equals(k)&&(S.setTo(C.clone().addXY(1,1)),k.setTo(C.clone().subXY(1,1))),p.setTo(S),g.setTo(k),f.setTo(C);const R=eC(p,g,f);return{bindings:n,isStraight:!1,start:{point:p,handle:o.start,arrowhead:t.props.arrowheadStart},end:{point:g,handle:o.end,arrowhead:t.props.arrowheadEnd},middle:f,handleArc:x,bodyArc:R,isValid:0!==R.length&&isFinite(R.center.x)&&isFinite(R.center.y)}}function eC(e,t,n){const i=ly(e,t,n),s=Am.Dist(i,e),r=+Am.Clockwise(e,n,t),o=((e.y-t.y)**2+(e.x-t.x)**2)**.5,a=((t.y-n.y)**2+(t.x-n.x)**2)**.5,l=((n.y-e.y)**2+(n.x-e.x)**2)**.5,c=2*Math.acos((a*a+l*l-o*o)/(2*a*l)),d=(Fm-c)*(r?1:-1);return{center:i,radius:s,size:d,length:d*s,largeArcFlag:+(Lm>c),sweepFlag:r}}function tC(e,t,n){const i=e.getBindingsFromShape(t,"arrow").find((e=>e.props.terminal===n));if(!i)return;const s=e.getShape(i.toId);if(!s)return;const r=e.getShapePageTransform(s),o=e.getShapeGeometry(s),a=o instanceof Xx?o.children[0].vertices:o.vertices;return{shape:s,transform:r,isClosed:o.isClosed,isExact:i.props.isExact,didIntersect:!1,outline:a}}function nC(e,t,n,i){const s=e.getShape(n.toId);if(s){const{point:r,size:o}=e.getShapeGeometry(s).bounds,a=Am.Add(r,Am.MulV(n.props.isPrecise||i?n.props.normalizedAnchor:{x:.5,y:.5},o)),l=Vx.applyToPoint(e.getShapePageTransform(s),a);return Vx.applyToPoint(Vx.Inverse(t),l)}return new Am(0,0)}function iC(e,t){const n=e.getBindingsFromShape(t,"arrow");return{start:n.find((e=>"start"===e.props.terminal)),end:n.find((e=>"end"===e.props.terminal))}}const sC=function(e,t,n){const i=new fd;return{get:(s,r)=>i.get(s,(()=>(s instanceof Ku?s:s.store).createComputedCache(e,(e=>t(s,e)),n))).get(r)}}("arrow info",((e,t)=>{const n=iC(e,t);return function(e){return Math.abs(e.props.bend)<8*e.props.scale}(t)?Zk(e,t,n):Qk(e,t,n)}));function rC(e,t){const n="string"==typeof t?t:t.id;return sC.get(e,n)}function oC(e,t,n){var i,s;const r=e.getShapePageTransform(t),o=pC(e,null==(i=n.start)?void 0:i.toId,null==(s=n.end)?void 0:s.toId);return{start:n.start?nC(e,r,n.start,"double-bound"===o||"start-contains-end"===o):Am.From(t.props.start),end:n.end?nC(e,r,n.end,"double-bound"===o||"end-contains-start"===o):Am.From(t.props.end)}}function aC(e,t,n,i){const s="string"==typeof t?t:t.id,r="string"==typeof n?n:n.id,o=e.getBindingsFromShape(s,"arrow").filter((e=>e.props.terminal===i.terminal));o.length>1&&e.deleteBindings(o.slice(1));const a=o[0];a?e.updateBinding({...a,toId:r,props:i}):e.createBinding({type:"arrow",fromId:s,toId:r,props:i})}function lC(e,t,n){const i=e.getBindingsFromShape(t,"arrow").filter((e=>e.props.terminal===n));e.deleteBindings(i)}const cC=10,dC=10,hC=10,uC={s:2,m:3.5,l:5,xl:10};function pC(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";const i=e.getShapePageBounds(t),s=e.getShapePageBounds(n);if(i&&s){if(i.contains(s))return"start-contains-end";if(s.contains(i))return"end-contains-start"}return"safe"}class gC extends gk{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){mC(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){mC(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){mC(this.editor,e)}onAfterChangeToShape({binding:e}){fC(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&yC({editor:this.editor,arrow:t,terminal:e.props.terminal})}}function fC(e,t){var n;const i=e.getShape(t);if(!i)return;const s=iC(e,i),{start:r,end:o}=s,a=r?e.getShape(r.toId):void 0,l=o?e.getShape(o.toId):void 0,c=e.getAncestorPageId(i);if(!c)return;let d;if(a&&l)d=e.findCommonAncestor([a,l])??c;else{if(!a&&!l)return;{const e=null==(n=a||l)?void 0:n.parentId;d=e&&e===i.parentId?i.parentId:c}}d&&d!==i.parentId&&e.reparentShapes([t],d);const h=e.getShape(t);if(!h)throw Error("no reparented arrow");const u=e.getShapeNearestSibling(h,a),p=e.getShapeNearestSibling(h,l);let g,f;if(u&&p)g=u.index>p.index?u:p;else if(u&&!p)g=u;else{if(!p||u)return;g=p}const m=e.getSortedChildIdsForParent(g.parentId).map((t=>e.getShape(t))).filter((e=>e.index>g.index));if(m.length){const e=m.find((e=>"arrow"!==e.type));if(h.index>g.index&&(!e||h.index<e.index))return;f=ph(g.index,m[0].index)}else f=gh(g.index);f!==h.index&&e.updateShapes([{id:t,type:"arrow",index:f}])}function mC(e,t){const n=iC(e,t);for(const i of["start","end"]){const s=n[i];if(!s)continue;const r=e.getShape(s.toId),o=e.getAncestorPageId(t)===e.getAncestorPageId(r);r&&o||yC({editor:e,arrow:t,terminal:i,unbind:!0})}fC(e,t.id)}function yC({editor:e,arrow:t,terminal:n,unbind:i=!1,useHandle:s=!1}){const r=rC(e,t);if(!r)throw new Error("expected arrow info");const o=s?r.start.handle:r.start.point,a=s?r.end.handle:r.end.point,l="start"===n?o:a,c={id:t.id,type:"arrow",props:{[n]:{x:l.x,y:l.y},bend:t.props.bend}};if(!r.isStraight){const e="start"===n?o:r.start.handle,i="end"===n?a:r.end.handle,s=Am.Med(e,i),l=Am.Sub(e,i).per().uni().mul(2*r.handleArc.radius*Math.sign(t.props.bend)),d=$v(r.handleArc.center,Am.Add(s,l),r.handleArc.center,r.handleArc.radius);vd(1===(null==d?void 0:d.length));const h=Am.Dist(s,d[0])*Math.sign(t.props.bend);Um(h,c.props.bend)||(c.props.bend=h)}e.updateShape(c),i&&lC(e,t,n)}b(gC,"type","arrow"),b(gC,"props",kg),b(gC,"migrations",Cg);const xC=[gC],wC={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},vC={s:2,m:3.5,l:5,xl:10},bC={s:18,m:24,l:36,xl:44},SC={s:18,m:22,l:26,xl:32},kC={s:18,m:20,l:24,xl:28},CC={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},_C=20,PC=4.25,IC=16;function jC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function EC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jC(Object(n),!0).forEach((function(t){TC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TC(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MC(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function AC(e,t){return function(e){if(Array.isArray(e))return e}(e)||
/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */
function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,s,r,o,a=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(d){c=!0,s=d}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}(e,t)||DC(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function OC(e){return function(e){if(Array.isArray(e))return RC(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||DC(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function DC(e,t){if(e){if("string"==typeof e)return RC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?RC(e,t):void 0}}function RC(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function LC(e){var t,n,i=e.sizes.shift(),s=Math.max(Math.ceil(i[0]),1),r=Math.max(Math.ceil(i[1]),1),o=[s-1,r-1,1,1],a=Date.now(),l="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;l?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(s,r)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=s,n.height=r);var c=t.getContext("2d"),d=n.getContext("2d");d&&(d.fillRect.apply(d,o),c.drawImage(n,s-1,r-1,1,1,0,0,1,1));var h=c&&0!==c.getImageData(0,0,1,1).data[3],u=Date.now()-a;return[t,n].forEach((function(e){e.height=0,e.width=0})),l?(postMessage({width:s,height:r,benchmark:u,isTestPass:h}),!h&&e.sizes.length&&LC(e)):h?e.onSuccess(s,r,u):(e.onError(s,r,u),e.sizes.length&&LC(e)),h}var zC=[16384,14188,11402,11180,10836,8192,4096,1],FC=[8388607,65535,32767,16384,8192,4096,1],NC=[4194303,65535,32767,16384,8192,4096,1],$C=["onError","onSuccess"],BC={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},UC={};function KC(e){var t=e.width===e.height,n=1===e.height,i=1===e.width,s=[];if(e.width&&e.height)for(var r=e.min||BC.min,o=e.step||BC.step,a=Math.max(e.width,e.height);a>=r;){var l=t||n?a:1,c=t||i?a:1;s.push([l,c]),a-=o}else e.sizes.forEach((function(e){var r=t||n?e:1,o=t||i?e:1;s.push([r,o])}));return s}function HC(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,i=Date.now(),s=e.onError,r=e.onSuccess,o=MC(e,$C),a=null;if(!t)return!1;if(e.useWorker&&n){var l="\n            var canvasTest = ".concat(LC.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),c=new Blob([l],{type:"application/javascript"}),d=URL.createObjectURL(c);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(e){var t=e.data,n=t.width,s=t.height,r=t.benchmark;t.isTestPass?(UC[i].onSuccess(n,s,r),delete UC[i]):UC[i].onError(n,s,r)}}return e.usePromise?new Promise((function(t,n){var l=EC(EC({},e),{},{onError:function(t,i,r){var o;if(0===e.sizes.length)o=!0;else{var a=AC(e.sizes.slice(-1),1),l=AC(a[0],2),c=l[0],d=l[1];o=t===c&&i===d}s(t,i,r),o&&n({width:t,height:i,benchmark:r})},onSuccess:function(e,n,i){r(e,n,i),t({width:e,height:n,benchmark:i})}});if(a){var c=l.onError,d=l.onSuccess;UC[i]={onError:c,onSuccess:d},a.postMessage(o)}else LC(l)})):a?(UC[i]={onError:s,onSuccess:r},void a.postMessage(o)):LC(e)}var VC={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=KC({width:e.max,height:e.max,min:e.min,step:e.step,sizes:OC(zC)});return HC(EC(EC(EC({},BC),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=KC({width:1,height:e.max,min:e.min,step:e.step,sizes:OC(FC)});return HC(EC(EC(EC({},BC),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=KC({width:e.max,height:1,min:e.min,step:e.step,sizes:OC(NC)});return HC(EC(EC(EC({},BC),e),{},{sizes:t}))},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=EC(EC({},BC),e);return t.sizes=OC(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),HC(t)}};let WC=null;function YC(){return WC||(WC=async function(){const e=await VC.maxWidth({usePromise:!0}),t=await VC.maxHeight({usePromise:!0}),n=await VC.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}()),WC}const GC=8192,XC=16777216;const qC=e=>e.split("*").map((e=>function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e))).join(".+"),ZC=(e,t)=>!!e.find((e=>{const n=new RegExp(qC(e));return t.match(n)}));function JC(e){return function(e){const t=new URL(e).host.replace("www.","");for(const n of Df)if(ZC(n.hostnames,t)){const t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}(e)??function(e){const t=new URL(e).host.replace("www.","");for(const n of Df)if(ZC(n.hostnames,t)){const t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}(e)}function QC(e){try{return JC(e)}catch(t){console.error(t)}}
/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const e_="  ",t_=class e{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(t,n){const i=t.ownerDocument,s=i.activeElement;s!==t&&t.focus(),i.execCommand("insertText",!1,n)||e.insertTextFirefox(t,n),s===i.body?t.blur():s instanceof HTMLElement&&s!==t&&s.focus()}static set(t,n){t.select(),e.insert(t,n)}static getSelection(e){const{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(t,n,i){const{selectionStart:s,selectionEnd:r}=t,o=e.getSelection(t);e.insert(t,n+o+(i??n)),t.selectionStart=(s||0)+n.length,t.selectionEnd=(r||0)+n.length}static replace(t,n,i){let s=0;t.value.replace(n,((...n)=>{const r=s+n[n.length-2],o=n[0].length;t.selectionStart=r,t.selectionEnd=r+o;const a="string"==typeof i?i:i(...n);return e.insert(t,a),t.selectionStart=r,s+=a.length-o,a}))}static findLineEnd(e,t){const n=e.lastIndexOf("\n",t-1)+1;return"\t"!==e.charAt(n)?t:n+1}static indent(t){var n;const{selectionStart:i,selectionEnd:s,value:r}=t,o=r.slice(i,s),a=null==(n=/\n/g.exec(o))?void 0:n.length;if(a&&a>0){const n=r.lastIndexOf("\n",i-1)+1,o=t.value.slice(n,s-1),a=o.replace(/^|\n/g,`$&${e_}`),l=a.length-o.length;t.setSelectionRange(n,s-1),e.insert(t,a),t.setSelectionRange(i+1,s+l)}else e.insert(t,e_)}static unindent(t){const{selectionStart:n,selectionEnd:i,value:s}=t,r=s.lastIndexOf("\n",n-1)+1,o=e.findLineEnd(s,i),a=t.value.slice(r,o),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;t.setSelectionRange(r,o),e.insert(t,l);const d=/\t| {1,2}/.exec(s.slice(r,n)),h=d?d[0].length:0,u=n-h;t.setSelectionRange(n-h,Math.max(u,i-c))}static indentCE(e){var t;const n=window.getSelection(),i=e.innerText,s=i_(e)??0,r=i_(e)??0,o=i.slice(s,r),a=null==(t=/\n/g.exec(o))?void 0:t.length;if(a&&a>0){const t=i.lastIndexOf("\n",s-1)+1,o=i.slice(t,r-1),a=o.replace(/^|\n/g,`$&${e_}`).length-o.length;n&&n.setBaseAndExtent(e,s+1,e,r+a)}else{const t=window.getSelection();e.innerText=i.slice(0,s)+e_+i.slice(s),null==t||t.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(t){const n=window.getSelection(),i=t.innerText,s=i_(t)??0,r=i_(t)??0,o=i.lastIndexOf("\n",s-1)+1,a=e.findLineEnd(i,r),l=i.slice(o,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-c.length;if(n){n.setBaseAndExtent(t,o,t,a);const e=/\t| {1,2}/.exec(i.slice(o,s)),l=e?e[0].length:0,c=s-l;n.setBaseAndExtent(t,s-l,t,Math.max(c,r-d))}}static normalizeText(t){return t.replace(e.fixNewLines,"\n")}static normalizeTextForDom(t){return t.replace(e.fixNewLines,"\n").split("\n").map((e=>e||" ")).join("\n")}};b(t_,"fixNewLines",/\r?\n|\r/g);let n_=t_;function i_(e){if(void 0===window.getSelection)return;const t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){const i=t.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),n=s.toString().length}return n}const s_=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function r_(e){return s_.test(e)}function o_(e){return function(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}(function(e){const t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(const i of t)if(i.trim().length>0){const e=i.length-i.trimStart().length;n=Math.min(n,e)}return t.map((e=>e.slice(n))).join("\n")}(function(e){return e.replace(/\t/g,e_)}(e)))}function a_(e,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s},{toasts:r,msg:o},a){e.registerExternalAssetHandler("file",(async({file:e})=>{const r=e.name;let o=e;const l=i.includes(o.type),c=s.includes(o.type);vd(l||c,`File type not allowed: ${o.type}`),vd(o.size<=n,`File size too big: ${(o.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),"video/quicktime"===o.type&&(o=new Blob([o],{type:"video/mp4"}));let d=l?await Nd.getImageSize(o):await Nd.getVideoSize(o);const h=await Nd.isAnimated(o)||c,u=await function(e){const t=new DataView(e);let n=0;for(let i=0;i<t.byteLength;i++)n=(n<<5)-n+t.getUint8(i),n|=0;return n+""}(await o.arrayBuffer());if(isFinite(t)){const e=function(e,t){const n=e.w/t.w,i=e.h/t.h;return n<=1&&i<=1?e:n>i?{w:e.w/n,h:e.h/n}:{w:e.w/i,h:e.h/i}}(d,{w:t,h:t});d!==e&&Nd.isStaticImageType(o.type)&&(d=e)}const p=kf.createId(u),g={id:p,type:l?"image":"video",typeName:"asset",props:{name:r,src:"",w:d.w,h:d.h,fileSize:o.size,mimeType:o.type,isAnimated:h}};return a?(g.props.src=p,await async function({persistenceKey:e,assetId:t,blob:n}){const i=Ek+e;await Mk(i,(async e=>{const i=e.transaction([Tk.Assets],"readwrite"),s=i.objectStore(Tk.Assets);await s.put(n,t),await i.done}))}({persistenceKey:a,assetId:p,blob:o})):g.props.src=await Id.blobToDataUrl(o),kf.create(g)})),e.registerExternalAssetHandler("url",(async({url:e})=>{var t,n,i,s,a;let l;try{const r=await _d(e,{method:"GET",mode:"no-cors"}),o=await r.text(),c=(new DOMParser).parseFromString(o,"text/html");l={image:(null==(t=c.head.querySelector('meta[property="og:image"]'))?void 0:t.getAttribute("content"))??"",favicon:(null==(n=c.head.querySelector('link[rel="apple-touch-icon"]'))?void 0:n.getAttribute("href"))??(null==(i=c.head.querySelector('link[rel="icon"]'))?void 0:i.getAttribute("href"))??"",title:(null==(s=c.head.querySelector('meta[property="og:title"]'))?void 0:s.getAttribute("content"))??e,description:(null==(a=c.head.querySelector('meta[property="og:description"]'))?void 0:a.getAttribute("content"))??""},l.image.startsWith("/")&&(l.image=new URL(l.image,e).href),l.favicon.startsWith("/")&&(l.favicon=new URL(l.favicon,e).href)}catch(c){console.error(c),r.addToast({title:o("assets.url.failed"),severity:"error"}),l={image:"",favicon:"",title:"",description:""}}return{id:kf.createId(jd(e)),typeName:"asset",type:"bookmark",props:{src:e,description:l.description,image:l.image,favicon:l.favicon,title:l.title},meta:{}}})),e.registerExternalContentHandler("svg-text",(async({point:t,text:n})=>{const i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),s=(new DOMParser).parseFromString(n,"image/svg+xml").querySelector("svg");if(!s)throw new Error("No <svg/> element present");let r=parseFloat(s.getAttribute("width")||"0"),o=parseFloat(s.getAttribute("height")||"0");if(!r||!o){document.body.appendChild(s);const e=s.getBoundingClientRect();document.body.removeChild(s),r=e.width,o=e.height}const a=await e.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");l_(e,[a],i)})),e.registerExternalContentHandler("embed",(({point:t,url:n,embed:i})=>{const s=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),{width:r,height:o}=i,a=eg(),l={id:a,type:"embed",x:s.x-(r||450)/2,y:s.y-(o||450)/2,props:{w:r,h:o,url:n}};e.createShapes([l]).select(a)})),e.registerExternalContentHandler("files",(async({point:t,files:a})=>{const l=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),c=new Am(l.x,l.y),d=[];await Promise.all(a.map((async(t,a)=>{if(t.size>n)return console.warn(`File size too big: ${(t.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!t.type)throw new Error("No mime type");if(!i.concat(s).includes(t.type))return console.warn(`${t.name} not loaded - Extension not allowed.`),null;try{const n=await e.getAssetForExternalContent({type:"file",file:t});if(!n)throw Error("Could not create an asset");d[a]=n}catch(l){return r.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(l),null}}))),l_(e,ud(d),c)})),e.registerExternalContentHandler("text",(async({point:t,text:n})=>{const i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),s=e.getShapeUtil("text").getDefaultProps(),r=o_(n),o=e.getOnlySelectedShape();if(o&&"text"in o.props)return void e.updateShapes([{id:o.id,type:o.type,props:{text:r}}]);let a,l,c,d="middle";const h=r.split("\n").length>1,u=r_(r);h&&(d=h?u?"end":"start":"middle");const p=e.textMeasure.measureText(r,{...wC,fontFamily:CC[s.font],fontSize:bC[s.size],maxWidth:null}),g=Math.min(h?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(p.w>g){const t=e.textMeasure.measureText(r,{...wC,fontFamily:CC[s.font],fontSize:bC[s.size],maxWidth:g});a=t.w,l=t.h,c=!1,d=u?"end":"start"}else a=p.w,l=p.h,c=!0;i.y-l/2<e.getViewportPageBounds().minY+40&&(i.y=e.getViewportPageBounds().minY+40+l/2),e.createShapes([{id:eg(),type:"text",x:i.x-a/2,y:i.y-l/2,props:{text:r,textAlign:d,autoSize:c,w:a}}])})),e.registerExternalContentHandler("url",(async({point:t,url:n})=>{const i=QC(n);if(i)return e.putExternalContent({type:"embed",url:i.url,point:t,embed:i.definition});const s=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),a=kf.createId(jd(n)),l=function(e,t,n){const i={id:eg(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.batch((()=>{e.createShapes([i]).select(i.id),c_(e,n)})),e.getShape(i.id)}(e,n,s);let c=e.getAsset(a),d=!1;if(!c){d=!0;try{const t=await e.getAssetForExternalContent({type:"url",url:n});if(!t)throw Error("Could not create an asset");c=t}catch(h){return void r.addToast({title:o("assets.url.failed"),severity:"error"})}}e.batch((()=>{d&&e.createAssets([c]),e.updateShapes([{id:l.id,type:l.type,props:{assetId:c.id}}])}))}))}async function l_(e,t,n){if(!t.length)return[];const i=Am.From(n),s=[];for(let r=0;r<t.length;r++){const e=t[r];switch(e.type){case"bookmark":s.push({id:eg(),type:"bookmark",x:i.x,y:i.y,opacity:1,props:{assetId:e.id,url:e.props.src}}),i.x+=300;break;case"image":s.push({id:eg(),type:"image",x:i.x,y:i.y,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),i.x+=e.props.w;break;case"video":s.push({id:eg(),type:"video",x:i.x,y:i.y,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),i.x+=e.props.w}}return e.batch((()=>{const i=t.filter((t=>!e.getAsset(t.id)));i.length&&e.createAssets(i),e.createShapes(s).select(...s.map((e=>e.id))),c_(e,n)})),s.map((e=>e.id))}function c_(e,t){const n=e.getViewportPageBounds();let i=e.getSelectionPageBounds();if(i){const n=i.center.sub(t);e.updateShapes(e.getSelectedShapes().map((t=>{const i=e.getShapeParentTransform(t).decompose().rotation,s=Am.Rot(n,-i);return{id:t.id,type:t.type,x:t.x-s.x,y:t.y-s.y}})))}i=e.getSelectionPageBounds(),i&&!n.contains(i)&&e.zoomToSelection()}const d_=new fd,h_=e=>async t=>t&&t.props.src?e&&t.props.src.startsWith("asset:")?await d_.get(t,(async()=>await async function(e,t){const n=await async function({persistenceKey:e,assetId:t}){const n=Ek+e;return await Mk(n,(async e=>{const n=e.transaction([Tk.Assets],"readwrite").objectStore(Tk.Assets);return await n.get(t)}))}({assetId:t,persistenceKey:e});if(n)return URL.createObjectURL(n);return null}(e,t.id))):"video"===t.type?t.props.src:"image"!==t.type?null:t.props.src:null;let u_=(n=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")})),b(this,"onKeyUp",(e=>{var t;if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null==(t=this.editor.root.getCurrent())||t.transition("editing_shape",{...e,target:"shape",shape:n}))}}))}},b(n,"id","idle"),n),p_=(i=class extends rS{constructor(){super(...arguments),b(this,"shape"),b(this,"markId",""),b(this,"onEnter",(()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:e,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()})),b(this,"onExit",(()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()})),b(this,"onPointerMove",(()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}})),b(this,"onPointerUp",(()=>{this.cancel()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()})),b(this,"preciseTimeout",-1),b(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var e;const{originPagePoint:t}=this.editor.inputs,n=eg();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShape({id:n,type:"arrow",x:t.x,y:t.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(n);if(!i)throw Error("expected shape");const s=this.editor.getShapeHandles(i);if(!s)throw Error("expected handles for arrow");const r=this.editor.getShapeUtil("arrow"),o=this.shape,a=s.find((e=>"start"===e.id)),l=null==(e=r.onHandleDrag)?void 0:e.call(r,i,{handle:{...a,x:0,y:0},isPrecise:!0,initial:o});l&&this.editor.updateShapes([l]),this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){var e,t;const n=this.shape;if(!n)throw Error("expected shape");const i=this.editor.getShapeHandles(n);if(!i)throw Error("expected handles for arrow");{const t=this.editor.getShapeUtil("arrow"),s=this.shape,r=i.find((e=>"start"===e.id)),o=null==(e=t.onHandleDrag)?void 0:e.call(t,n,{handle:{...r,x:0,y:0},isPrecise:this.didTimeout,initial:s});o&&this.editor.updateShapes([o])}{const e=this.editor.getShapeUtil("arrow"),s=this.shape,r=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),o=i.find((e=>"end"===e.id)),a=null==(t=e.onHandleDrag)?void 0:t.call(e,this.editor.getShape(n),{handle:{...o,x:r.x,y:r.y},isPrecise:!1,initial:s});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(n.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout((()=>{this.getIsActive()&&(this.didTimeout=!0)}),320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},b(i,"id","pointing"),i);class g_ extends rS{constructor(){super(...arguments),b(this,"shapeType","arrow")}}b(g_,"id","arrow"),b(g_,"initial","idle"),b(g_,"children",(()=>[u_,p_]));class f_ extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"initialShape"),b(this,"shapeType","highlight"===this.parent.id?"highlight":"draw"),b(this,"util",this.editor.getShapeUtil(this.shapeType)),b(this,"isPen",!1),b(this,"isPenOrStylus",!1),b(this,"segmentMode","free"),b(this,"didJustShiftClickToExtendPreviousShapeLine",!1),b(this,"pagePointWhereCurrentSegmentChanged",{}),b(this,"pagePointWhereNextSegmentChanged",null),b(this,"lastRecordedPoint",{}),b(this,"mergeNextPoint",!1),b(this,"currentLineLength",0),b(this,"canDraw",!1),b(this,"markId",null),b(this,"onEnter",(e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()})),b(this,"onPointerMove",(()=>{const{inputs:e}=this.editor;if(this.isPen&&!e.isPen){if(this.markId)return this.editor.bailToMark(this.markId),void this.startShape()}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?Am.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())})),b(this,"onKeyDown",(e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()})),b(this,"onKeyUp",(e=>{if("Shift"===e.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()})),b(this,"onExit",(()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}))}canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;const n=vC[t],i=e[0].points[0],s=e[e.length-1],r=s.points[s.points.length-1];return i!==r&&this.currentLineLength>4*n&&Am.DistMin(i,r,2*n)}startShape(){const{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+sv(),this.editor.mark(this.markId);const{z:n=.5}=this.info.point;this.isPen=t,this.isPenOrStylus=t||n>0&&n<.5||n>.5&&n<1;const i=this.isPenOrStylus?1.25*n:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;const n=pd(t.props.segments);if(!n)throw Error("Expected a previous segment!");const s=pd(n.points);if(!s)throw Error("Expected a previous point!");const{x:r,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),a={type:this.segmentMode,points:[{x:s.x,y:s.y,z:+i.toFixed(2)},{x:r,y:o,z:+i.toFixed(2)}]},l=Vx.applyToPoint(this.editor.getShapePageTransform(t.id),s);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;const c=[...t.props.segments,a];this.currentLineLength<4*vC[t.props.size]&&(this.currentLineLength=this.getLineLength(c));const d={id:t.id,type:this.shapeType,props:{segments:c}};return this.canClose()&&(d.props.isClosed=this.getIsClosed(c,t.props.size)),void this.editor.updateShapes([d])}}this.pagePointWhereCurrentSegmentChanged=e.clone();const s=eg();this.editor.createShapes([{id:s,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(s)}updateDrawingShape(){const{initialShape:e}=this,{inputs:t}=this.editor;if(!e)return;const{id:n,props:{size:i}}=e,s=this.editor.getShape(n);if(!s)return;const{segments:r}=s.props,{x:o,y:a,z:l}=this.editor.getPointInShapeSpace(s,t.currentPagePoint).toFixed(),c={x:o,y:a,z:this.isPenOrStylus?+(1.25*t.currentPagePoint.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(Am.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const e=pd(r);if(!e)throw Error("Expected a previous segment!");const t=pd(e.points);if(!t)throw Error("Expected a previous last point!");let o;const a=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===e.type){this.currentLineLength+=Am.Dist(t,a),o={type:"straight",points:[{...t},a]};const e=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=Vx.applyToPoint(e,t)}else o={type:"straight",points:[a,c]};const l={id:n,type:this.shapeType,props:{segments:[...r,o]}};this.canClose()&&(l.props.isClosed=this.getIsClosed(r,i)),this.editor.updateShapes([l])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(Am.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const e=r.slice(),t=pd(e[e.length-1].points);if(!t)throw Error("No previous point!");const o={type:"free",points:[...Am.PointsBetween(t,c,6).map((e=>({x:sy(e.x),y:sy(e.y),z:sy(e.z)})))]},a=[...e,o];this.currentLineLength<4*vC[s.props.size]&&(this.currentLineLength=this.getLineLength(a));const l={id:n,type:this.shapeType,props:{segments:a}};this.canClose()&&(l.props.isClosed=this.getIsClosed(a,i)),this.editor.updateShapes([l])}break}case"straight":{const e=r.slice(),t=e[e.length-1],{pagePointWhereCurrentSegmentChanged:o}=this,{ctrlKey:a,currentPagePoint:l}=this.editor.inputs;if(!o)throw Error("We should have a point where the segment changed");let c,d=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(d=!a,this.didJustShiftClickToExtendPreviousShapeLine=!1):d=!a;let h,u=this.editor.getPointInShapeSpace(s,l).toFixed().toJson(),p=!1;if((this.editor.user.getIsSnapMode()?!a:a)&&e.length>2){let e,t=8/this.editor.getZoomLevel();for(let n=0,i=r.length-2;n<i;n++){const i=r[n];if(!i)break;if("free"===i.type)continue;const s=i.points[0],o=pd(i.points);if(!s||!o)continue;const a=Am.NearestPointOnLineSegment(s,o,u);if(Am.DistMin(a,u,t)){e=a.toFixed().toJson(),t=Am.Dist(a,u),h=i;break}}e&&(p=!0,u=e)}if(p&&h){const e=this.editor.getShapePageTransform(s),t=h.points[0],n=pd(h.points);if(!n)throw Error("Expected a last point!");const i=Vx.applyToPoint(e,t),r=Vx.applyToPoint(e,n),o=Vx.applyToPoint(e,u);this.editor.snaps.setIndicators([{id:sv(),type:"points",points:[i,o,r]}])}else{if(this.editor.snaps.clearIndicators(),d){const e=Am.Angle(o,l),t=Xm(e,24)-e;c=Am.RotWith(l,o,t)}else c=l;u=this.editor.getPointInShapeSpace(s,c).toFixed().toJson()}this.currentLineLength+=Am.Dist(t.points[0],u),e[e.length-1]={...t,type:"straight",points:[t.points[0],u]};const g={id:n,type:this.shapeType,props:{segments:e}};this.canClose()&&(g.props.isClosed=this.getIsClosed(r,i)),this.editor.updateShapes([g]);break}case"free":{const e=r.slice(),o=e[e.length-1],a=[...o.points];if(a.length&&this.mergeNextPoint){const{z:e}=a[a.length-1];a[a.length-1]={x:c.x,y:c.y,z:e?Math.max(e,c.z):c.z}}else this.currentLineLength+=Am.Dist(a[a.length-1],c),a.push(c);e[e.length-1]={...o,points:a},this.currentLineLength<4*vC[s.props.size]&&(this.currentLineLength=this.getLineLength(e));const d={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(d.props.isClosed=this.getIsClosed(e,i)),this.editor.updateShapes([d]),a.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);const e=eg(),i=this.editor.getShape(n).props;this.editor.createShapes([{id:e,type:this.shapeType,x:sy(t.currentPagePoint.x),y:sy(t.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:i.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*l).toFixed():.5}]}]}}]),this.initialShape=Rh(this.editor.getShape(e)),this.mergeNextPoint=!1,this.lastRecordedPoint=t.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let t=0;for(const n of e)for(let e=0;e<n.points.length-1;e++){const i=n.points[e],s=n.points[e+1];t+=Am.Dist2(s,i)}return Math.sqrt(t)}complete(){if(!this.canDraw)return void this.cancel();const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}b(f_,"id","drawing");let m_=(s=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("drawing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(s,"id","idle"),s);class y_ extends rS{constructor(){super(...arguments),b(this,"shapeType","draw"),b(this,"onExit",(()=>{this.children.drawing.initialShape=void 0}))}}b(y_,"id","draw"),b(y_,"initial","idle"),b(y_,"children",(()=>[m_,f_]));class x_ extends wk{constructor(){super(...arguments),b(this,"shapeType","frame"),b(this,"onCreate",(e=>{if(!e)return;const t=this.editor.getShapePageBounds(e),n=[],i=this.editor.getShapeAncestors(e).map((e=>e.id));this.editor.getSortedChildIdsForParent(e.parentId).map((s=>{const r=this.editor.getShape(s);if(!r)return;if(r.id===e.id)return;if(r.isLocked)return;const o=this.editor.getShapePageBounds(r);o&&t.contains(o)&&function(e,t,n){if(t.includes(e.id))return!1;if(e.parentId===n.parentId)return!0;return!1}(r,i,e)&&n.push(r.id)})),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}))}}b(x_,"id","frame"),b(x_,"initial","idle");let w_=(r=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onKeyUp",(e=>{var t;if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null==(t=this.editor.root.getCurrent())||t.transition("editing_shape",{...e,target:"shape",shape:n}))}})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(r,"id","idle"),r),v_=(o=class extends rS{constructor(){super(...arguments),b(this,"markId",""),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=eg();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Kf),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.cancel()}))}complete(){const{originPagePoint:e}=this.editor.inputs,t=eg();this.markId=`creating:${t}`,this.editor.mark(this.markId);const n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(Kf),s="star"===i?{w:200,h:190}:"cloud"===i?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Kf),scale:n,...s}}]);const r=this.editor.getShape(t);if(!r)return;const{w:o,h:a}=r.props,l=new Am(o/2,a/2).mul(n),c=this.editor.getShapeParentTransform(r);c&&l.rot(-c.rotation()),this.editor.select(t),this.editor.updateShape({id:r.id,type:"geo",x:r.x-l.x,y:r.y-l.y,props:{geo:this.editor.getStyleForNextShape(Kf),w:o*n,h:a*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},b(o,"id","pointing"),o);class b_ extends rS{constructor(){super(...arguments),b(this,"shapeType","geo")}}b(b_,"id","geo"),b(b_,"initial","idle"),b(b_,"children",(()=>[w_,v_]));class S_ extends rS{constructor(){super(...arguments),b(this,"shapeType","highlight"),b(this,"onExit",(()=>{this.children.drawing.initialShape=void 0}))}}b(S_,"id","highlight"),b(S_,"initial","idle"),b(S_,"children",(()=>[m_,f_]));let k_=(a=class extends rS{constructor(){super(...arguments),b(this,"shapeId",""),b(this,"onEnter",(e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onPointerDown",(()=>{this.parent.transition("pointing",{shapeId:this.shapeId})})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(a,"id","idle"),a);let C_=(l=class extends rS{constructor(){super(...arguments),b(this,"shape",{}),b(this,"markId"),b(this,"onEnter",(e=>{const{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&t.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const e=this.editor.getShapeHandles(this.shape);if(!e)return;const t=e.filter((e=>"vertex"===e.type)).sort(mh),s=t[t.length-1],r=t[t.length-2],o=Vx.applyToPoint(this.editor.getShapeParentTransform(this.shape),new Am(this.shape.x,this.shape.y)),a=Am.Sub(n,o).addXY(.1,.1),l=Rh(this.shape.props.points);if(Am.DistMin(s,r,2)||Am.DistMin(a,s,2))l[s.id]={id:s.id,index:s.index,x:a.x,y:a.y};else{const e=gh(s.index);l[e]={id:e,index:e,x:a.x,y:a.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:l}}])}else{const e=eg();this.markId=`creating:${e}`,this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(e),this.shape=this.editor.getShape(e)}})),b(this,"onPointerMove",(()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=pd(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}))}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},b(l,"id","pointing"),l);class __ extends rS{constructor(){super(...arguments),b(this,"shapeType","line")}}b(__,"id","line"),b(__,"initial","idle"),b(__,"children",(()=>[k_,C_]));let P_=(c=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(c,"id","idle"),c);function I_(e,t){var n;const i=new Set;for(const r of t){const t=e.getShape(r);if(!t)continue;e.getShapeUtil(t).onDragShapesOut&&i.add(t);const n=e.getShape(t.parentId);n&&(e.getShapeUtil(n).onDragShapesOut&&i.add(n))}const s=new Map;for(const r of i){const t=j_(e,r);t.length&&s.set(r,t)}for(const[r,o]of s){const t=e.getShapeUtil(r),i=ud(o.map((t=>e.getShape(t))));null==(n=t.onDragShapesOut)||n.call(t,r,i)}}function j_(e,t){const n=e.getSortedChildIdsForParent(t.id);if(0===n.length)return[];const i=e.getShapePageBounds(t);if(!i)return[];let s,r,o;const a=[];for(const l of n){const n=e.getShapePageBounds(l);if(!n)continue;if(!i.includes(n)){a.push(l);continue}s??(s=e.getShapeGeometry(t)),r??(r=e.getShapePageTransform(t)),o??(o=r.applyToPoints(s.vertices));const c=e.getShapePageTransform(l).clone().invert().applyToPoints(o),{vertices:d,isClosed:h}=e.getShapeGeometry(l);if(!d.some((e=>ny(e,c)))){if(h){if(Xv(c,d))continue}else if(qv(c,d))continue;a.push(l)}}return a}function E_(e,t,n=!1){e.select(t),e.setEditingShape(t),e.setCurrentTool("select.editing_shape",{target:"shape",shape:t}),n&&e.emit("select-all-text",{shapeId:t.id}),M_(e)}const T_=16;function M_(e){const t=e.getSelectionPageBounds(),n=e.getViewportPageBounds();if(t&&!n.contains(t)){const i=t.clone().expandBy(T_/e.getZoomLevel()).expand(n),s=n.clone().translate({x:2*(i.center.x-n.center.x),y:2*(i.center.y-n.center.y)});e.zoomToBounds(s,{animation:{duration:e.options.animationMediumMs},inset:0})}}const A_=20,O_=200,D_=new Am(O_/2,O_/2),R_=[[["a1"],new Am(.5*O_,-.5*O_-A_)],[["a2"],new Am(1.5*O_+A_,.5*O_)],[["a3"],new Am(.5*O_,1.5*O_+A_)],[["a4"],new Am(-.5*O_-A_,.5*O_)]];function L_(e,t,n,i,s){return Object.fromEntries(function(e){if(1===e)return R_;const t=O_*e,n=A_*e;return[[["a1"],new Am(.5*t,-.5*t-n)],[["a2"],new Am(1.5*t+n,.5*t)],[["a3"],new Am(.5*t,1.5*t+n)],[["a4"],new Am(-.5*t-n,.5*t)]]}(s).map((([s,r],o)=>{const a=r.clone();return 0===o&&i?a.y-=i:2===o&&n&&(a.y+=n),[s,a.rot(t).add(e)]})))}function z_(e,t,n,i){const s=new Set(e.getSelectedShapeIds()),r=(O_+A_+i)**2,o=new Map,a=[];for(const d of e.getCurrentPageShapes()){if(!e.isShapeOfType(d,"note")||n!==d.props.scale||s.has(d.id))continue;const r=e.getShapePageTransform(d.id);t===r.rotation()&&(o.set(d,e.getShapePageBounds(d).center),a.push(...Object.values(L_(r.point(),t,d.props.growY,i,n))))}const l=a.length;let c;for(const[d,h]of o)for(let t=0;t<l;t++)c=a[t],c&&(Am.Dist2(h,c)>r||e.isPointInShape(d,c)&&(a[t]=void 0));return ud(a)}function F_(e,t,n,i,s=!1){let r;const o=e.getCurrentPageShapesSorted(),a=(O_+A_**2)**t.props.scale;for(let l=o.length-1;l>=0;l--){const i=o[l];if("note"===i.type&&i.id!==t.id){const t=e.getShapePageBounds(i);if(t&&Am.Dist2(t.center,n)<a&&e.isPointInShape(i,n)){r=i;break}}}if(e.complete(),!r||s){e.mark("creating note shape");const s=eg();e.createShape({id:s,type:"note",x:n.x,y:n.y,rotation:i,opacity:t.opacity,props:{...t.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const o=e.getShape(s);if(!o)return;const a=e.getPointInParentSpace(o,Am.Sub(n,Am.Rot(D_.clone().mul(o.props.scale),i)));e.updateShape({id:s,type:"note",x:a.x,y:a.y}),r=e.getShape(s)}return M_(e),r}let N_=(d=class extends rS{constructor(){super(...arguments),b(this,"dragged",!1),b(this,"info",{}),b(this,"wasFocusedOnEnter",!1),b(this,"markId",""),b(this,"shape",{}),b(this,"onEnter",(()=>{const{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){const t=eg();this.markId=`creating:${t}`,e.mark(this.markId);const n=this.editor.inputs.originPagePoint.clone(),i=$_(this.editor,n,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&n.sub(i),this.shape=B_(this.editor,t,n)}})),b(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const e=eg(),t=this.editor.inputs.originPagePoint.clone(),n=$_(this.editor,t,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);n&&t.sub(n),this.shape=B_(this.editor,e,t)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()}))}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},b(d,"id","pointing"),d);function $_(e,t,n){let i,s=10/e.getZoomLevel();for(const r of z_(e,0,n,0)){const e=Am.Sub(t,r),n=e.len();n<s&&(s=n,i=e)}return i}function B_(e,t,n){e.createShape({id:t,type:"note",x:n.x,y:n.y,props:{scale:e.user.getIsDynamicResizeMode()?1/e.getZoomLevel():1}}).select(t);const i=e.getShape(t),s=e.getShapeGeometry(i).bounds;return e.updateShapes([{id:t,type:"note",x:i.x-s.width/2,y:i.y-s.height/2}]),e.getShape(t)}class U_ extends rS{constructor(){super(...arguments),b(this,"shapeType","note")}}b(U_,"id","note"),b(U_,"initial","idle"),b(U_,"children",(()=>[P_,N_]));const K_=Pc((function(e){const t=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),renderingOnly:!0});if(!t)return e.setHoveredShape(null);let n;const i=e.getOutermostSelectableShape(t);return n=i===t||i.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(i.id)?t:i,e.setHoveredShape(n.id)}),32);let H_=(h=class extends rS{constructor(){super(...arguments),b(this,"onPointerMove",(e=>{switch(e.target){case"shape":case"canvas":K_(this.editor)}})),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})})),b(this,"onExit",(()=>{K_.cancel()})),b(this,"onKeyDown",(e=>{var t;if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null==(t=this.editor.root.getCurrent())||t.transition("editing_shape",{...e,target:"shape",shape:n}))}})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(h,"id","idle"),h),V_=(u=class extends rS{constructor(){super(...arguments),b(this,"shape"),b(this,"markId",""),b(this,"onExit",(()=>{this.editor.setHintingShapes([])})),b(this,"onPointerMove",(e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:t}}=this.editor,n=eg();this.markId=`creating:${n}`,this.editor.mark(this.markId);const i=this.createTextShape(n,t,!1);if(!i)return void this.cancel();this.shape=this.editor.getShape(i),this.editor.select(n),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}complete(){var e;this.editor.mark("creating text shape");const t=eg(),{currentPagePoint:n}=this.editor.inputs;this.createTextShape(t,n,!0)&&(this.editor.select(t),this.editor.setEditingShape(t),this.editor.setCurrentTool("select"),null==(e=this.editor.root.getCurrent())||e.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,t,n){this.editor.createShape({id:e,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:n,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(e);if(!i)return void this.cancel();const s=this.editor.getShapePageBounds(i),r=new Am;if(n)switch(i.props.textAlign){case"start":r.x=0;break;case"middle":r.x=-s.width/2;break;case"end":r.x=-s.width}else r.x=0;if(r.y=-s.height/2,Qp(i.parentId)){const e=this.editor.getShapeParentTransform(i);r.rot(-e.rotation())}return this.editor.updateShape({...i,x:i.x+r.x,y:i.y+r.y}),i}},b(u,"id","pointing"),u);class W_ extends rS{constructor(){super(...arguments),b(this,"shapeType","text")}}b(W_,"id","text"),b(W_,"initial","idle"),b(W_,"children",(()=>[H_,V_]));const Y_=[W_,y_,b_,U_,__,x_,g_,S_];function G_(){return lg({isDarkMode:mS()})}function X_(e){return{key:`${pg.id}:${e}`,getElement:async()=>{const t=function(e){const t=gg[e];for(const n of document.fonts)if(t.includes(n.family))return n;return null}(e);if(!t)return null;const n=t.$$_url,i=t.$$_fontface;if(!n||!i)return null;const s=await(await _d(n)).blob(),r=await Id.blobToDataUrl(s),o=i.replace(n,r);return k.jsx("style",{children:o})}}}function q_(e){return{key:`${pg.id}:${e}`,getElement:async()=>"pattern"!==e?null:k.jsx(Z_,{})}}function Z_(){const e=G_(),t=8/12;return k.jsxs(k.Fragment,{children:[k.jsxs("mask",{id:"hash_pattern_mask",children:[k.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),k.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[k.jsx("line",{x1:1*t,y1:2,x2:2,y2:1*t}),k.jsx("line",{x1:5*t,y1:7*t,x2:7*t,y2:5*t}),k.jsx("line",{x1:6,y1:11*t,x2:11*t,y2:6})]})]}),k.jsx("pattern",{id:sP(1,e.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:k.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:e.solid,mask:"url(#hash_pattern_mask)"})})]})}function J_(){return{key:`${pg.id}:pattern`,component:aP}}const Q_=8,eP=(e,t,n)=>new Promise(((i,s)=>{const r=Q_*t*e,o=document.createElement("canvas");o.width=r,o.height=r;const a=o.getContext("2d");if(!a)return;a.fillStyle=n?ag.darkMode.solid:ag.lightMode.solid,a.fillRect(0,0,r,r),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;const l=8/12,c=n=>n*t*e;a.beginPath(),a.moveTo(c(1*l),c(2)),a.lineTo(c(2),c(1*l)),a.moveTo(c(5*l),c(7*l)),a.lineTo(c(7*l),c(5*l)),a.moveTo(c(6),c(11*l)),a.lineTo(c(11*l),c(6)),a.stroke(),o.toBlob((e=>{!e||vy.throwToBlob.get()?s():i(e)}))})),tP=(e,t)=>{const n=document.createElement("canvas");n.width=e[0],n.height=e[1];const i=n.getContext("2d");return i?(t(i),n.toDataURL()):""};let nP=null;function iP(e){return Math.ceil(Math.log2(Math.max(1,e)))}function sP(e,t){return`tldraw_hash_pattern_${t}_${iP(e)}`}function rP(e){const t=[],n=iP(e);for(let i=0;i<=n;i++)t.push(Math.pow(2,i));return t}function oP(e){const t=(nP||(nP={white:tP([1,1],(e=>{e.fillStyle="#f8f9fa",e.fillRect(0,0,1,1)})),black:tP([1,1],(e=>{e.fillStyle="#212529",e.fillRect(0,0,1,1)}))}),nP);return rP(e).flatMap((e=>[{zoom:e,url:t.white,theme:"light"},{zoom:e,url:t.black,theme:"dark"}]))}function aP(){const e=jm(),t=C.useRef(null),{defs:n,isReady:i}=function(){const e=jm(),t=Ru("devicePixelRatio",(()=>e.getInstanceState().devicePixelRatio),[e]),n=Ru("maxZoom",(()=>Math.ceil(pd(e.getCameraOptions().zoomSteps))),[e]),[i,s]=C.useState(!1),[r,o]=C.useState((()=>oP(n)));return C.useEffect((()=>{const e=Promise.all(rP(n).flatMap((e=>[eP(t,e,!1).then((t=>({zoom:e,theme:"light",url:URL.createObjectURL(t)}))),eP(t,e,!0).then((t=>({zoom:e,theme:"dark",url:URL.createObjectURL(t)})))])));let i=!1;return e.then((e=>{i||(o(e),s(!0))})),()=>{i=!0,s(!1),e.then((e=>{for(const{url:t}of e)URL.revokeObjectURL(t)}))}}),[t,n]),{defs:k.jsx(k.Fragment,{children:r.map((e=>{const t=sP(e.zoom,e.theme);return k.jsx("pattern",{id:t,width:Q_,height:Q_,patternUnits:"userSpaceOnUse",children:k.jsx("image",{href:e.url,width:Q_,height:Q_})},t)}))}),isReady:i}}();return C.useEffect((()=>{if(i&&e.environment.isSafari){const n=lP(t.current);n&&e.timers.requestAnimationFrame((()=>{n.style.display="none",e.timers.requestAnimationFrame((()=>{n.style.display=""}))}))}}),[e,i]),k.jsx("g",{ref:t,"data-testid":i?"ready-pattern-fill-defs":void 0,children:n})}function lP(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?lP(e.parentElement):null}const cP=P.memo((function({theme:e,d:t,color:n,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return k.jsx("path",{fill:e[n].semi,d:t});case"semi":return k.jsx("path",{fill:e.solid,d:t});case"fill":return k.jsx("path",{fill:e[n].fill,d:t});case"pattern":return k.jsx(dP,{theme:e,color:n,fill:i,d:t,scale:s})}}));function dP({d:e,color:t,theme:n}){const i=jm(),s=yb(),r=Ru("zoomLevel",(()=>i.getZoomLevel()),[i]),o=i.getZoomLevel()<=.18;return k.jsxs(k.Fragment,{children:[k.jsx("path",{fill:n[t].pattern,d:e}),k.jsx("path",{fill:s?`url(#${sP(1,n.id)})`:o?n[t].semi:`url(#${sP(r,n.id)})`,d:e})]})}function hP(e,t,n){const{padding:i=0}=n;if(0===t.length)return null;const s=Ux.From(t[0].box);for(const{box:d}of t)s.union(d);const r=i+(n.offsetX??0),o=(n.offsetY??0)+n.fontSize/2+("start"===n.verticalTextAlign?i:"end"===n.verticalTextAlign?n.height-i-s.height:(Math.ceil(n.height)-s.height)/2);let a=null;const l=[];for(const{text:d,box:h}of t){null!==a&&h.y>a&&l.push(k.jsx("tspan",{alignmentBaseline:"mathematical",x:r,y:h.y+o,children:"\n"},l.length)),l.push(k.jsx("tspan",{alignmentBaseline:"mathematical",x:h.x+r,y:h.y+o,unicodeBidi:"plaintext",children:(c=d,c.replace(/\s/g,"Â "))},l.length)),a=h.y}var c;return k.jsx("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontFamily,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:l})}function uP({fontSize:e,font:t,align:n,verticalAlign:i,text:s,labelColor:r,bounds:o,padding:a=16,stroke:l=!0}){const c=jm(),d=G_(),h={fontSize:e,fontFamily:gg[t],textAlign:n,verticalTextAlign:i,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:wC.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:r,stroke:void 0,strokeWidth:void 0},u=c.textMeasure.measureTextSpans(s,h),p=function(e,t,n,i){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){const s=Ux.From(n[0].box);for(const{box:e}of n)s.union(e);if("start-legacy"===e)return(i-2*t-s.width)/2;if("end-legacy"===e)return-(i-2*t-s.width)/2}}(n,a,u,o.width);p&&(h.offsetX=p),h.offsetX+=o.x,h.offsetY+=o.y;const g=hP(0,u,h);let f=null;return l&&(h.fill=d.background,h.stroke=d.background,h.strokeWidth=2,f=hP(0,u,h)),k.jsxs(k.Fragment,{children:[f,g]})}const pP=C.forwardRef((function({isEditing:e,text:t,handleFocus:n,handleChange:i,handleKeyDown:s,handleBlur:r,handleInputPointerDown:o,handleDoubleClick:a},l){return k.jsx("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:n,onChange:i,onKeyDown:s,onBlur:r,onTouchEnd:Iy,onContextMenu:e?Iy:void 0,onPointerDown:o,onDoubleClick:a,onDragStart:Cy})}));const gP=P.memo((function({id:e,type:t,text:n,labelColor:i,font:s,fontSize:r,lineHeight:o,align:a,verticalAlign:l,wrap:c,isSelected:d,padding:h=0,onKeyDown:u,classNamePrefix:p,style:g,textWidth:f,textHeight:m}){const{rInput:y,isEmpty:x,isEditing:w,isEditingAnything:v,...b}=function(e,t,n){const i=jm(),s=C.useRef(null),r=Ru("isEditing",(()=>i.getEditingShapeId()===e),[i]),o=Ru("isEditingAnything",(()=>!!i.getEditingShapeId()),[i]);C.useEffect((()=>{function t({shapeId:t}){var n;t===e&&(null==(n=s.current)||n.select())}return i.on("select-all-text",t),()=>{i.off("select-all-text",t)}}),[i,e,r]),C.useEffect((()=>{var e,t,n,o;r&&(document.activeElement!==s.current&&(null==(e=s.current)||e.focus()),i.getInstanceState().isCoarsePointer&&(null==(t=s.current)||t.select()),i.environment.isSafari&&(null==(n=s.current)||n.blur(),null==(o=s.current)||o.focus()))}),[i,r]);const a=C.useCallback((t=>{i.getEditingShapeId()===e&&"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&i.complete()}),[i,e]),l=C.useCallback((n=>{if(i.getEditingShapeId()!==e)return;let s=n_.normalizeText(n.currentTarget.value);const r=s.replace(/\t/g,e_);if(r!==s){const e=n.currentTarget.selectionStart;n.currentTarget.value=r,n.currentTarget.selectionStart=e+(r.length-s.length),n.currentTarget.selectionEnd=e+(r.length-s.length),s=r}i.updateShape({id:e,type:t,props:{text:s}})}),[i,e,t]),c=C.useCallback((t=>{i.dispatch({...Ey(t),type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(e)}),Iy(t)}),[i,e]);return{rInput:s,handleFocus:yd,handleBlur:yd,handleKeyDown:a,handleChange:l,handleInputPointerDown:c,handleDoubleClick:Iy,isEmpty:0===n.trim().length,isEditing:r,isEditingAnything:o}}(e,t,n),[S,_]=C.useState(n);C.useEffect((()=>{w||_(n)}),[w,n]);const P=n_.normalizeTextForDom(n),I=P.length>0,j=function(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}(a);if(!w&&!I)return null;const E=p||"tl-text";return k.jsx("div",{className:`${E}-label tl-text-wrapper`,"data-font":s,"data-align":a,"data-hastext":!x,"data-isediting":w,"data-iseditinganything":v,"data-textwrap":!!c,"data-isselected":d,style:{justifyContent:"middle"===a||j?"center":a,alignItems:"middle"===l?"center":l,padding:h,...g},children:k.jsxs("div",{className:`${E}-label__inner tl-text-content__wrapper`,style:{fontSize:r,lineHeight:Math.floor(r*o)+"px",minHeight:Math.floor(r*o)+"px",minWidth:Math.ceil(f||0),color:i,width:f?Math.ceil(f):void 0,height:m?Math.ceil(m):void 0},children:[k.jsx("div",{className:`${E} tl-text tl-text-content`,dir:"auto",children:P.split("\n").map(((e,t)=>k.jsx("div",{dir:"auto",children:e},t)))}),(v||d)&&k.jsx(pP,{ref:y,text:n,isEditing:w,...b,handleKeyDown:u??b.handleKeyDown},S)]})})}));function fP(e,t,n={}){const{closed:i=!1,snap:s=1,start:r="outset",end:o="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,d=0,h=1,u=0,p=0;switch(l){case"dashed":h=1,c=Math.min(t*a,e/4);break;case"dotted":h=100,c=t/h;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return i||("outset"===r?(e+=c/2,p+=c/2):"skip"===r&&(e-=c,p-=c),"outset"===o?e+=c/2:"skip"===o&&(e-=c)),d=Math.floor(e/c/(2*h)),d-=d%s,d<3&&"dashed"===l?e/t<4?(c=e,d=1,u=0):(c=e*(1/3),u=e*(1/3)):(c=e/d/(2*h),i?(p=c/2,u=(e-d*c)/d):u=(e-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,u].join(" "),strokeDashoffset:p.toString()}}const mP=new WeakMap;function yP(e,t){const n=mP.get(t);if(n)return n;const i=rC(e,t);let s=0,r=0;const o=i.isStraight?new Zv({start:Am.From(i.start.point),end:Am.From(i.end.point)}):new kk({center:Am.Cast(i.handleArc.center),start:Am.Cast(i.start.point),end:Am.Cast(i.end.point),sweepFlag:i.bodyArc.sweepFlag,largeArcFlag:i.bodyArc.largeArcFlag});if(t.props.text.trim()){const n=o.bounds,i=SP(t),{w:a,h:l}=e.textMeasure.measureText(t.props.text,{...wC,fontFamily:CC[t.props.font],fontSize:i,maxWidth:null});if(s=a,r=l,n.width>n.height){s=Math.max(Math.min(a,64),Math.min(n.width-64,a));const{w:o,h:l}=e.textMeasure.measureText(t.props.text,{...wC,fontFamily:CC[t.props.font],fontSize:i,maxWidth:s});s=o,r=l}if(s>16*i){s=16*i;const{w:n,h:o}=e.textMeasure.measureText(t.props.text,{...wC,fontFamily:CC[t.props.font],fontSize:i,maxWidth:s});s=n,r=o}}const a=new Am(s,r).addScalar(2*PC*t.props.scale);return mP.set(t,a),a}function xP(e){const t=vC[e.props.size];return(_C+2*(t-vC.s)+(t===vC.xl?20:0))*e.props.scale}function wP(e,t){let n;const i=[],s=rC(e,t),r=!!s.bindings.start,o=!!s.bindings.end,a="none"!==s.start.arrowhead,l="none"!==s.end.arrowhead;if(s.isStraight){const i=function(e,t,n){const i=yP(e,t),s=xP(t),r=Am.Nudge(n.start.point,n.end.point,s),o=Am.Nudge(n.end.point,n.start.point,s),a=Uv(r,o,Ux.FromCenter(n.middle,i).corners);if(!a||2!==a.length)return{start:.5,end:.5};let[l,c]=a;Am.Dist2(l,r)>Am.Dist2(c,r)&&([c,l]=a);const d=r.add(Am.Sub(n.middle,l)),h=o.add(Am.Sub(n.middle,c));return{start:Am.Dist(n.start.point,d)/n.length,end:Am.Dist(n.start.point,h)/n.length}}(e,t,s);let c=$m(t.props.labelPosition,a||r?i.start:0,l||o?i.end:1);c=c>=.48&&c<=.52?.5:c,n=Am.Lrp(s.start.point,s.end.point,c)}else{const c=function(e,t,n){const i=yP(e,t),s=xP(t),r=Math.sign(t.props.bend),o=s/n.handleArc.radius*r,a=Am.Angle(n.bodyArc.center,n.start.point)-o,l=Am.Angle(n.bodyArc.center,n.end.point)+o,c=Zm(n.bodyArc.center,n.bodyArc.radius,a),d=Zm(n.bodyArc.center,n.bodyArc.radius,l),h=[],u=vP(n.bodyArc.center,n.bodyArc.radius,a,l,r,Ux.FromCenter(c,i).corners);h.push(new Qv({points:Ux.FromCenter(c,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const p=vP(n.bodyArc.center,n.bodyArc.radius,a,l,r,Ux.FromCenter(d,i).corners);h.push(new Qv({points:Ux.FromCenter(d,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const b of[...u??[],...p??[],c,d])h.push(new Ck({x:b.x-3,y:b.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(u&&bP(n.start.point,u))??n.middle,f=(p&&bP(n.end.point,p))??n.middle,m=Am.Angle(n.bodyArc.center,n.start.point),y=Am.Angle(n.bodyArc.center,n.end.point),x=Am.Angle(n.bodyArc.center,g),w=Am.Angle(n.bodyArc.center,f);if(oy(m,x,r)>oy(m,w,r))return{start:.5,end:.5,dbg:h};const v=oy(m,y,r);return{start:oy(m,x,r)/v,end:oy(m,w,r)/v,dbg:h}}(e,t,s);c.dbg&&i.push(...c.dbg);let d=$m(t.props.labelPosition,a||r?c.start:0,l||o?c.end:1);d=d>=.48&&d<=.52?.5:d;const h=function(e,t,n,i){const s=oy(e,t,n);return e+s*i*n*-1}(Am.Angle(s.bodyArc.center,s.start.point),Am.Angle(s.bodyArc.center,s.end.point),Math.sign(t.props.bend),d);n=Zm(s.bodyArc.center,s.bodyArc.radius,h)}const c=yP(e,t);return{box:Ux.FromCenter(n,c),debugGeom:i}}function vP(e,t,n,i,s,r){const o=Kv(e,t,r),a=oy(n,i,s);return null==o?void 0:o.filter((t=>{const i=oy(n,Am.Angle(e,t),s);return i>=0&&i<=a}))}function bP(e,t){let n=null,i=-1/0;for(const s of t){const t=Am.Dist2(e,s);t>i&&(n=s,i=t)}return n}function SP(e){return kC[e.props.size]*e.props.scale}function kP(e,t,n){const i="end"===t?e.end.point:e.start.point,s="end"===t?e.start.point:e.end.point,r=e.isStraight?Am.Dist(s,i):Math.abs(e.bodyArc.length),o=Math.max(Math.min(r/5,3*n),n);let a;if(e.isStraight)a=Am.Nudge(i,s,o);else{const n=function(e,t,n,i){let s=n.x-e.x,r=n.y-e.y;const o=Math.sqrt(s*s+r*r),a=(o*o-i*i+t*t)/(2*o),l=Math.sqrt(t*t-a*a);return s/=o,r/=o,[new Am(e.x+s*a-r*l,e.y+r*a+s*l),new Am(e.x+s*a+r*l,e.y+r*a-s*l)]}(i,o,e.handleArc.center,e.handleArc.radius);a="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return Am.IsNaN(a)&&(a=e.start.point),{point:i,int:a}}function CP(e,t,n){const i="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===i)return;const s=kP(e,t,n);if(s){switch(i){case"bar":return function({int:e,point:t}){const n=Am.Sub(e,t).div(2),i=Am.Add(t,Am.Rot(n,zm)),s=Am.Sub(t,Am.Rot(n,zm));return`M ${i.x} ${i.y} L ${s.x} ${s.y}`}(s);case"square":return function({int:e,point:t}){const n=Am.Lrp(t,e,.85),i=Am.Sub(n,t).div(2),s=Am.Add(t,Am.Rot(i,zm)),r=Am.Sub(t,Am.Rot(i,zm)),o=Am.Add(n,Am.Rot(i,zm)),a=Am.Sub(n,Am.Rot(i,zm));return`M ${s.x} ${s.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${r.x} ${r.y} Z`}(s);case"diamond":return function({point:e,int:t}){const n=Am.Lrp(e,t,.75),i=Am.RotWith(n,e,Lm/4),s=Am.RotWith(n,e,-Lm/4),r=Am.Lrp(i,s,.5);return r.add(Am.Sub(r,e)),`M ${r.x} ${r.y} L ${i.x} ${i.y} ${e.x} ${e.y} L ${s.x} ${s.y} Z`}(s);case"dot":return function({point:e,int:t}){const n=Am.Lrp(e,t,.45),i=Am.Dist(n,e);return`M ${n.x-i},${n.y}\n  a ${i},${i} 0 1,0 ${2*i},0\n  a ${i},${i} 0 1,0 -${2*i},0 `}(s);case"inverted":return function({point:e,int:t}){const n=Am.Sub(t,e).div(2),i=Am.Add(e,Am.Rot(n,zm)),s=Am.Sub(e,Am.Rot(n,zm));return`M ${i.x} ${i.y} L ${t.x} ${t.y} L ${s.x} ${s.y} Z`}(s);case"arrow":return function({point:e,int:t}){const n=Am.RotWith(t,e,Lm/6),i=Am.RotWith(t,e,-Lm/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${i.x} ${i.y}`}(s);case"triangle":return function({point:e,int:t}){const n=Am.RotWith(t,e,Lm/6),i=Am.RotWith(t,e,-Lm/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}(s)}return""}}function _P(e){const{start:t,end:n,handleArc:{radius:i,largeArcFlag:s,sweepFlag:r}}=e;return`M${t.handle.x},${t.handle.y} A${i} ${i} 0 ${s} ${r} ${n.handle.x},${n.handle.y}`}function PP(e){const{start:t,end:n,bodyArc:{radius:i,largeArcFlag:s,sweepFlag:r}}=e;return`M${t.point.x},${t.point.y} A${i} ${i} 0 ${s} ${r} ${n.point.x},${n.point.y}`}function IP(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function jP(e){return IP(e.start.handle,e.end.handle)}function EP(e){return IP(e.start.point,e.end.point)}let TP=0;class MP extends tb{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"canSnap",(()=>!1)),b(this,"hideResizeHandles",(()=>!0)),b(this,"hideRotateHandle",(()=>!0)),b(this,"hideSelectionBoundsBg",(()=>!0)),b(this,"hideSelectionBoundsFg",(()=>!0)),b(this,"canBeLaidOut",(e=>{const t=iC(this.editor,e);return!t.start&&!t.end})),b(this,"onHandleDrag",((e,{handle:t,isPrecise:n})=>{const i=t.id,s=iC(this.editor,e);if("middle"===i){const{start:n,end:i}=oC(this.editor,e,s),r=Am.Sub(i,n),o=Am.Per(r),a=Am.Med(i,n),l=Am.Sub(a,o),c=Am.Add(a,o),d=Am.NearestPointOnLineSegment(l,c,t,!1);let h=Am.Dist(d,a);return Am.Clockwise(d,i,a)&&(h*=-1),{id:e.id,type:e.type,props:{bend:h}}}const r={id:e.id,type:"arrow",props:{}},o=s[i],a=s["start"===i?"end":"start"];if(this.editor.inputs.ctrlKey)return lC(this.editor,e,i),r.props[i]={x:t.x,y:t.y},r;const l=this.editor.getShapePageTransform(e.id).applyToPoint(t),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:t=>!t.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:t,binding:"arrow"})});if(!c)return lC(this.editor,e,i),r.props[i]={x:t.x,y:t.y},r;const d=this.editor.getShapeGeometry(c),h=Ux.ZeroFix(d.bounds),u=this.editor.getShapePageTransform(r.id).applyToPoint(t),p=this.editor.getPointInShapeSpace(c,u);let g=n;g||(!o||o&&c.id!==o.toId)&&(g=this.editor.inputs.pointerVelocity.len()<.5),n||(d.isClosed||(g=!0),a&&c.id===a.toId&&a.props.isPrecise&&(g=!0));const f={x:(p.x-h.minX)/h.width,y:(p.y-h.minY)/h.height};g&&Am.Dist(p,h.center)<Math.max(4,Math.min(.15*Math.min(h.width,h.height),16))/this.editor.getZoomLevel()&&(f.x=.5,f.y=.5);const m={terminal:i,normalizedAnchor:f,isPrecise:g,isExact:this.editor.inputs.altKey};aC(this.editor,e,c.id,m),this.editor.setHintingShapes([c.id]);const y=iC(this.editor,e);return y.start&&y.end&&y.start.toId===y.end.toId&&Am.Equals(y.start.props.normalizedAnchor,y.end.props.normalizedAnchor)&&aC(this.editor,e,y.end.toId,{...y.end.props,normalizedAnchor:{x:y.end.props.normalizedAnchor.x+.05,y:y.end.props.normalizedAnchor.y}}),r})),b(this,"onTranslateStart",(e=>{const t=iC(this.editor,e),n=oC(this.editor,e,t),i=this.editor.getShapePageTransform(e.id),s=this.editor.getSelectedShapeIds();if(!(t.start&&(s.includes(t.start.toId)||this.editor.isAncestorSelected(t.start.toId))||t.end&&(s.includes(t.end.toId)||this.editor.isAncestorSelected(t.end.toId)))){OP.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:qd(n,((e,n)=>{const s=t[e];return s?{binding:s,shapePosition:n,pagePosition:i.applyToPoint(n)}:null}))}),t.start&&(yC({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),t.end&&yC({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const e of["start","end"]){const n=t[e];n&&this.editor.updateBinding({...n,props:{...n.props,isPrecise:!0}})}}})),b(this,"onTranslate",((e,t)=>{const n=OP.get(e);if(!n)return;const i=this.editor.getShapePageTransform(t.id),s=Am.Sub(i.applyToPoint(t),n.pagePosition);for(const r of Object.values(n.terminalBindings)){if(!r)continue;const e=Am.Add(r.pagePosition,Am.Mul(s,.5)),n=this.editor.getShapeAtPoint(e,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:e,binding:"arrow"})});if((null==n?void 0:n.id)===r.binding.toId){const i=Ux.ZeroFix(this.editor.getShapeGeometry(n).bounds),s=this.editor.getPointInShapeSpace(n,e),o={x:(s.x-i.minX)/i.width,y:(s.y-i.minY)/i.height};aC(this.editor,t,n.id,{...r.binding.props,normalizedAnchor:o,isPrecise:!0})}else lC(this.editor,t,r.binding.props.terminal)}})),b(this,"_resizeInitialBindings",new fd),b(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:i}=t,s=this._resizeInitialBindings.get(e,(()=>iC(this.editor,e))),r=oC(this.editor,e,s),{start:o,end:a}=Rh(e.props);let{bend:l}=e.props;s.start||(o.x=r.start.x*n,o.y=r.start.y*i),s.end||(a.x=r.end.x*n,a.y=r.end.y*i);const c=Math.abs(n),d=Math.abs(i),h=(null==s?void 0:s.start)?Am.From(s.start.props.normalizedAnchor):null,u=(null==s?void 0:s.end)?Am.From(s.end.props.normalizedAnchor):null;n<0&&i>=0?(0!==l&&(l*=-1,l*=Math.max(c,d)),h&&(h.x=1-h.x),u&&(u.x=1-u.x)):n>=0&&i<0?(0!==l&&(l*=-1,l*=Math.max(c,d)),h&&(h.y=1-h.y),u&&(u.y=1-u.y)):n>=0&&i>=0?0!==l&&(l*=Math.max(c,d)):n<0&&i<0&&(0!==l&&(l*=Math.max(c,d)),h&&(h.x=1-h.x,h.y=1-h.y),u&&(u.x=1-u.x,u.y=1-u.y)),s.start&&h&&aC(this.editor,e,s.start.toId,{...s.start.props,normalizedAnchor:h.toJson()}),s.end&&u&&aC(this.editor,e,s.end.toId,{...s.end.props,normalizedAnchor:u.toJson()});return{props:{start:o,end:a,bend:l}}})),b(this,"onDoubleClickHandle",((e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}})),b(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:i.trimEnd()}}])}))}canBind({toShapeType:e}){return"arrow"!==e}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const t=rC(this.editor,e),n=[],i=t.isStraight?new Zv({start:Am.From(t.start.point),end:Am.From(t.end.point)}):new kk({center:Am.Cast(t.handleArc.center),start:Am.Cast(t.start.point),end:Am.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});let s;if(e.props.text.trim()){const t=wP(this.editor,e);n.push(...t.debugGeom),s=new eb({x:t.box.x,y:t.box.y,width:t.box.w,height:t.box.h,isFilled:!0,isLabel:!0})}return new Xx({children:[...s?[i,s]:[i],...n]})}getHandles(e){const t=rC(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y}].filter(Boolean)}component(e){const t=G_(),n=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,s=rC(this.editor,e);if(!(null==s?void 0:s.isValid))return null;const r=wP(this.editor,e),o=e.id===this.editor.getOnlySelectedShapeId(),a=this.editor.getEditingShapeId()===e.id||e.props.text;return k.jsxs(k.Fragment,{children:[k.jsx(Fv,{id:e.id,style:{minWidth:50,minHeight:50},children:k.jsx(AP,{shape:e,shouldDisplayHandles:i&&(null==n?void 0:n.id)===e.id})}),a&&k.jsx(gP,{id:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:SP(e),lineHeight:wC.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:t[e.props.labelColor].solid,textWidth:r.box.w,isSelected:o,padding:0,style:{transform:`translate(${r.box.center.x}px, ${r.box.center.y}px)`}})]})}indicator(e){const t=vk(e.id),n=rC(this.editor,e);if(!n)return null;const{start:i,end:s}=oC(this.editor,e,null==n?void 0:n.bindings),r=this.editor.getShapeGeometry(e),o=r.bounds,a=e.props.text.trim()?r.children[1]:null;if(Am.Equals(i,s))return null;const l=vC[e.props.size]*e.props.scale,c=n.start.arrowhead&&CP(n,"start",l),d=n.end.arrowhead&&CP(n,"end",l),h=n.isStraight?EP(n):PP(n),u=c&&"arrow"!==n.start.arrowhead||d&&"arrow"!==n.end.arrowhead||!!a,p=(e.id+"_clip").replace(":","_");return t&&a?k.jsx("rect",{x:iy(a.x),y:iy(a.y),width:a.w,height:a.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale}):k.jsxs("g",{children:[u&&k.jsx("defs",{children:k.jsxs("mask",{id:p,children:[k.jsx("rect",{x:o.minX-100,y:o.minY-100,width:o.w+200,height:o.h+200,fill:"white"}),a&&k.jsx("rect",{x:iy(a.x),y:iy(a.y),width:a.w,height:a.h,fill:"black",rx:3.5*e.props.scale,ry:3.5*e.props.scale}),c&&k.jsx("path",{d:c,fill:"arrow"===n.start.arrowhead?"none":"black",stroke:"none"}),d&&k.jsx("path",{d:d,fill:"arrow"===n.end.arrowhead?"none":"black",stroke:"none"})]})}),k.jsxs("g",{...u?{mask:`url(#${p})`}:void 0,children:[u&&k.jsx("rect",{x:o.minX-100,y:o.minY-100,width:o.width+200,height:o.height+200,opacity:0}),k.jsx("path",{d:h})]}),c&&k.jsx("path",{d:c}),d&&k.jsx("path",{d:d}),a&&k.jsx("rect",{x:iy(a.x),y:iy(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5})]})}toSvg(e,t){t.addExportDef(q_(e.props.fill)),e.props.text&&t.addExportDef(X_(e.props.font));const n=lg(t),i=1/e.props.scale;return k.jsxs("g",{transform:`scale(${i})`,children:[k.jsx(AP,{shape:e,shouldDisplayHandles:!1}),k.jsx(uP,{fontSize:SP(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:n[e.props.labelColor].solid,bounds:wP(this.editor,e).box,padding:4*e.props.scale})]})}getCanvasSvgDefs(){return[J_(),{key:"arrow:dot",component:DP},{key:"arrow:cross",component:RP}]}}b(MP,"type","arrow"),b(MP,"props",wg),b(MP,"migrations",Sg);const AP=Ou((function({shape:e,shouldDisplayHandles:t}){const n=jm(),i=G_(),s=rC(n,e),r=Ux.ZeroFix(n.getShapeGeometry(e).bounds),o=iC(n,e),a=P.useMemo((()=>n.environment.isSafari?TP+=1:0),[e]);if(!(null==s?void 0:s.isValid))return null;const l=vC[e.props.size]*e.props.scale,c=s.start.arrowhead&&CP(s,"start",l),d=s.end.arrowhead&&CP(s,"end",l),h=s.isStraight?EP(s):PP(s);let u=null;if(t){const t=2/n.getZoomLevel(),{strokeDasharray:i,strokeDashoffset:r}=fP(function(e,t){const n=rC(e,t);return n.isStraight?Am.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}(n,e),t,{end:"skip",start:"skip",lengthRatio:2.5});u=o.start||o.end?k.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?jP(s):_P(s),strokeDasharray:i,strokeDashoffset:r,strokeWidth:t,markerStart:o.start?o.start.props.isExact?"":o.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:o.end?o.end.props.isExact?"":o.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:p,strokeDashoffset:g}=fP(s.isStraight?s.length:Math.abs(s.bodyArc.length),l,{style:e.props.dash}),f=wP(n,e),m=!("none"===s.start.arrowhead||"arrow"===s.start.arrowhead),y=!("none"===s.end.arrowhead||"arrow"===s.end.arrowhead),x=(e.id+"_clip_"+a).replace(":","_");return k.jsxs(k.Fragment,{children:[k.jsx("defs",{children:k.jsxs("mask",{id:x,children:[k.jsx("rect",{x:iy(-100+r.minX),y:iy(-100+r.minY),width:iy(r.width+200),height:iy(r.height+200),fill:"white"}),e.props.text.trim()&&k.jsx("rect",{x:f.box.x,y:f.box.y,width:f.box.w,height:f.box.h,fill:"black",rx:4,ry:4}),c&&m&&k.jsx("path",{d:c,fill:"arrow"===s.start.arrowhead?"none":"black",stroke:"none"}),d&&y&&k.jsx("path",{d:d,fill:"arrow"===s.end.arrowhead?"none":"black",stroke:"none"})]})}),k.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[u,k.jsxs("g",{mask:`url(#${x})`,children:[k.jsx("rect",{x:iy(r.minX-100),y:iy(r.minY-100),width:iy(r.width+200),height:iy(r.height+200),opacity:0}),k.jsx("path",{d:h,strokeDasharray:p,strokeDashoffset:g})]}),c&&m&&"none"!==e.props.fill&&k.jsx(cP,{theme:i,d:c,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&y&&"none"!==e.props.fill&&k.jsx(cP,{theme:i,d:d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),c&&k.jsx("path",{d:c}),d&&k.jsx("path",{d:d})]})]})})),OP=new WeakMap;function DP(){return k.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:k.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function RP(){return k.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[k.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),k.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const LP="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function zP({url:e,zoomLevel:t}){return k.jsx("a",{className:I("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:Iy,onPointerUp:Iy,title:e,draggable:!1,children:k.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${LP}") center 100% / 100% no-repeat`,WebkitMask:`url("${LP}") center 100% / 100% no-repeat`}})})}const FP="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",NP=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function $P(e){return NP.map((t=>{const{offsetX:n,offsetY:i,blur:s,spread:r,color:o}=t,a=new Am(n,i),{x:l,y:c}=a.rot(-e);return`${l}px ${c}px ${s}px ${r}px ${o}`})).join(", ")}class BP extends mk{constructor(){super(...arguments),b(this,"canResize",(()=>!1)),b(this,"hideSelectionBoundsFg",(()=>!0)),b(this,"onBeforeCreate",(e=>UP(this.editor,e))),b(this,"onBeforeUpdate",((e,t)=>{if(e.props.url!==t.props.url){if(!Op.isValid(t.props.url))return{...t,props:{...t.props,url:e.props.url}};!function(e,t){const{url:n}=t.props,i=kf.createId(jd(n));e.getAsset(i)?t.props.assetId!==i&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:i}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),HP(e,t))}(this.editor,t)}if(e.props.assetId!==t.props.assetId)return UP(this.editor,t)}))}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){const t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=this.editor.getShapePageTransform(e).rotation(),i=KP(e);return k.jsx(pk,{children:k.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:$P(n)},children:[(!t||t.props.image)&&k.jsxs("div",{className:"tl-bookmark__image_container",children:[t?k.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:null==t?void 0:t.props.image,alt:(null==t?void 0:t.props.title)||""}):k.jsx("div",{className:"tl-bookmark__placeholder"}),(null==t?void 0:t.props.image)&&k.jsx(zP,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),k.jsxs("div",{className:"tl-bookmark__copy_container",children:[(null==t?void 0:t.props.title)?k.jsx("h2",{className:"tl-bookmark__heading",children:t.props.title}):null,(null==t?void 0:t.props.description)&&(null==t?void 0:t.props.image)?k.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,k.jsxs("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Iy,onPointerUp:Iy,onClick:Iy,children:[(null==t?void 0:t.props.favicon)?k.jsx("img",{className:"tl-bookmark__favicon",src:null==t?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${i}`}):k.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${FP}") center 100% / 100% no-repeat`,WebkitMask:`url("${FP}") center 100% / 100% no-repeat`}}),k.jsx("span",{children:i})]})]})]})})}indicator(e){return k.jsx("rect",{width:iy(e.props.w),height:iy(e.props.h),rx:"6",ry:"6"})}}function UP(e,t){const n=t.props.assetId?e.getAsset(t.props.assetId):null;let i=320;return n&&(n.props.image||(i=n.props.title?101:46)),{...t,props:{...t.props,h:i}}}b(BP,"type","bookmark"),b(BP,"props",Cf),b(BP,"migrations",Pf);const KP=e=>{try{return new URL(e.props.url).hostname.replace(/^www\./,"")}catch(t){return e.props.url}};const HP=Sd((async(e,t)=>{if(e.isDisposed)return;const{url:n}=t.props,i=await e.getAssetForExternalContent({type:"url",url:n});i&&e.batch((()=>{e.createAssets([i]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:i.id}}])}))}),500);function VP(e,t=!1){const n=e.length;if(n<2)return"";let i=e[0].point,s=e[1].point;if(2===n)return`M${Dm(i)}L${Dm(s)}`;let r="";for(let o=2,a=n-1;o<a;o++)i=e[o].point,s=e[o+1].point,r+=Rm(i,s);return t?`M${Rm(e[0].point,e[1].point)}Q${Dm(e[1].point)}${Rm(e[1].point,e[2].point)}T${r}${Rm(e[n-1].point,e[0].point)}${Rm(e[0].point,e[1].point)}Z`:`M${Dm(e[0].point)}Q${Dm(e[1].point)}${Rm(e[1].point,e[2].point)}${e.length>3?"T":""}${r}L${Dm(e[n-1].point)}`}function WP(e,t={}){const{start:n={},end:i={}}=t,{cap:s=!0}=n,{cap:r=!0}=i;vd(!n.taper&&!i.taper,"cap taper not supported here"),vd(!n.easing&&!i.easing,"cap easing not supported here"),vd(s&&r,"cap must be true");const o=Nk(e,t);Uk(o,t);const a=function(e){if(e.length<=2)return[e];const t=[];let n,i,s,r,o,a=[e[0]],l=Am.Sub(e[1].point,e[0].point).uni();for(let c=1,d=e.length;c<d-1;c++)if(s=e[c-1],r=e[c],o=e[c+1],n=Am.Sub(o.point,r.point).uni(),i=Am.Dpr(l,n),l=n,i<-.8){const e={...r,point:r.input};a.push(e),t.push(YP(a)),a=[e]}else a.push(r),i>.7||(Am.Dist2(s.point,r.point)+Am.Dist2(r.point,o.point))/((s.radius+r.radius+o.radius)/3)**2<1.5&&(a.push(r),t.push(YP(a)),a=[r]);return a.push(e[e.length-1]),t.push(YP(a)),t}(o);let l="";for(const c of a)l+=GP(c,t);return l}function YP(e){const t=e[0];let n;for(;e.length>2&&(n=e[1],Am.Dist2(t.point,n.point)<((t.radius+n.radius)/2*.5)**2);)e.splice(1,1);const i=e[e.length-1];let s;for(;e.length>2&&(s=e[e.length-2],Am.Dist2(i.point,s.point)<((i.radius+s.radius)/2*.5)**2);)e.splice(e.length-2,1);return e.length>1&&(e[0]={...e[0],vector:Am.Sub(e[0].point,e[1].point).uni()},e[e.length-1]={...e[e.length-1],vector:Am.Sub(e[e.length-2].point,e[e.length-1].point).uni()}),e}function GP(e,t={}){if(0===e.length)return"";if(1===e.length)return n=e[0].point.x,i=e[0].point.y,s=e[0].radius,"M "+n+" "+i+" m -"+s+", 0 a "+s+","+s+" 0 1,1 "+2*s+",0 a "+s+","+s+" 0 1,1 -"+2*s+",0";var n,i,s;const{left:r,right:o}=Rk(e,t);o.reverse();let a=`M${Dm(r[0])}T`;for(let l=1;l<r.length;l++)a+=Rm(r[l-1],r[l]);{const t=e[e.length-1],n=t.radius,i=t.vector.clone().per().neg(),s=Am.Add(t.point,Am.Mul(i,n)),r=Am.Add(t.point,Am.Mul(i,-n));a+=`${Dm(s)}A${iy(n)},${iy(n)} 0 0 1 ${Dm(r)}T`}for(let l=1;l<o.length;l++)a+=Rm(o[l-1],o[l]);{const t=e[0],n=t.radius,i=t.vector.clone().per(),s=Am.Add(t.point,Am.Mul(i,n)),r=Am.Add(t.point,Am.Mul(i,-n));a+=`${Dm(s)}A${iy(n)},${iy(n)} 0 0 1 ${Dm(r)}Z`}return a}const XP=e=>.65*e+.35*Nm(e*Lm/2),qP=e=>({size:e,thinning:.5,streamline:Ud(e,[9,16],[.64,.74],!0),smoothing:.62,easing:Mm.easeOutSine,simulatePressure:!0}),ZP=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:XP}),JP=e=>({size:e,thinning:0,streamline:Ud(e,[9,16],[.68,.74],!0),smoothing:.62,simulatePressure:!1,easing:Mm.linear}),QP=e=>({size:e,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Mm.linear});function eI({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Mm.easeOutSine,last:t}}function tI(e,t,n,i){const s=e.isComplete||n;return i?e.isPen?{...QP(t),last:s}:{...JP(t),last:s}:"draw"===e.dash?e.isPen?{...ZP(t),last:s}:{...qP(t),last:s}:{...JP(t),last:s}}function nI(e){const t=[];for(const n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(Am.Cast));else{const e=Math.max(4,Math.floor(Am.Dist(n.points[0],n.points[1])/16));t.push(...Am.PointsBetween(n.points[0],n.points[1],e))}return t}function iI(e,t){return{draw:"none",solid:"none",dotted:"0.1 "+2*t,dashed:`${2*t} ${2*t}`}[e.props.dash]}class sI extends tb{constructor(){super(...arguments),b(this,"hideResizeHandles",(e=>oI(e))),b(this,"hideRotateHandle",(e=>oI(e))),b(this,"hideSelectionBoundsFg",(e=>oI(e))),b(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:i}=t,s=[];for(const r of e.props.segments)s.push({...r,points:r.points.map((({x:e,y:t,z:s})=>({x:sy(n*e),y:sy(i*t),z:s})))});return{props:{segments:s}}}))}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=nI(e.props.segments),n=(vC[e.props.size]+1)*e.props.scale;if(1===e.props.segments.length){const e=Ux.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new Ck({x:-n,y:-n,radius:n,isFilled:!0})}const i=Nk(t,tI(e.props,n,e.props.isPen,!0)).map((e=>e.point));return e.props.isClosed?new Qv({points:i,isFilled:"none"!==e.props.fill}):new Jv({points:i})}component(e){return k.jsx(Fv,{id:e.id,children:k.jsx(aI,{shape:e,zoomLevel:this.editor.getZoomLevel()})})}indicator(e){var t;const n=nI(e.props.segments);let i=(vC[e.props.size]+1)*e.props.scale;const s=this.editor.getZoomLevel();s<.5&&s<1.5/i||e.props.isPen||"draw"!==e.props.dash||1!==n.length||(i+=Bd(e.id)()*(i/6));const r=e.props.isComplete||"straight"===(null==(t=pd(e.props.segments))?void 0:t.type),o=Nk(n,tI(e.props,i,r,!0)),a=o.length>1?VP(o,e.props.isClosed):rI(n[0],i);return k.jsx("path",{d:a})}toSvg(e,t){t.addExportDef(q_(e.props.fill));const n=1/e.props.scale;return k.jsx("g",{transform:`scale(${n})`,children:k.jsx(aI,{shape:e,zoomLevel:1})})}getCanvasSvgDefs(){return[J_()]}expandSelectionOutlinePx(e){const t="draw"===e.props.dash?1.6:1;return vC[e.props.size]*t/2*e.props.scale}}function rI(e,t){const n=.5*(t+1);return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function oI(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function aI({shape:e,zoomLevel:t}){var n;const i=G_(),s=nI(e.props.segments),r=e.props.isComplete||"straight"===(null==(n=pd(e.props.segments))?void 0:n.type);let o=(vC[e.props.size]+1)*e.props.scale;const a=t<.5&&t<1.5/o;a||e.props.isPen||"draw"!==e.props.dash||1!==s.length||(o+=Bd(e.id)()*(o/6));const l=tI(e.props,o,r,a);if(!a&&"draw"===e.props.dash)return k.jsxs(k.Fragment,{children:[e.props.isClosed&&e.props.fill&&s.length>1?k.jsx(cP,{d:VP(Nk(s,l),e.props.isClosed),theme:i,color:e.props.color,fill:e.props.isClosed?e.props.fill:"none",scale:e.props.scale}):null,k.jsx("path",{d:WP(s,l),strokeLinecap:"round",fill:i[e.props.color].solid})]});const c=Nk(s,l),d=c.length<2,h=d?rI(s[0],0):VP(c,e.props.isClosed);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{d:h,theme:i,color:e.props.color,fill:d||e.props.isClosed?e.props.fill:"none",scale:e.props.scale}),k.jsx("path",{d:h,strokeLinecap:"round",fill:d?i[e.props.color].solid:"none",stroke:i[e.props.color].solid,strokeWidth:o,strokeDasharray:d?"none":iI(e,o),strokeDashoffset:"0"})]})}b(sI,"type","draw"),b(sI,"props",jf),b(sI,"migrations",Tf);class lI extends mk{constructor(){super(...arguments),b(this,"hideSelectionBoundsFg",(e=>!this.canResize(e))),b(this,"canEdit",(()=>!0)),b(this,"canResize",(e=>{var t,n;return!!(null==(n=null==(t=QC(e.props.url))?void 0:t.definition)?void 0:n.doesResize)})),b(this,"canEditInReadOnly",(()=>!0)),b(this,"isAspectRatioLocked",(e=>{const t=QC(e.props.url);return(null==t?void 0:t.definition.isAspectRatioLocked)??!1})),b(this,"onResize",((e,t)=>{const n=this.isAspectRatioLocked(e),i=QC(e.props.url);let s=(null==i?void 0:i.definition.minWidth)??200,r=(null==i?void 0:i.definition.minHeight)??200;if(n){const t=e.props.w/e.props.h;t>1?s*=t:r/=t}return function(e,t,n={}){const{newPoint:i,handle:s,scaleX:r,scaleY:o}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=n;let h=e.props.w*r,u=e.props.h*o;const p=new Am(0,0);if(h>0){if(h<a){switch(s){case"top_left":case"left":case"bottom_left":p.x=h-a;break;case"top":case"bottom":p.x=(h-a)/2;break;default:p.x=0}h=a}}else if(p.x=h,h=-h,h<a){switch(s){case"top_left":case"left":case"bottom_left":p.x=-h;break;default:p.x=-a}h=a}if(u>0){if(u<c){switch(s){case"top_left":case"top":case"top_right":p.y=u-c;break;case"right":case"left":p.y=(u-c)/2;break;default:p.y=0}u=c}}else if(p.y=u,u=-u,u<c){switch(s){case"top_left":case"top":case"top_right":p.y=-u;break;default:p.y=-c}u=c}const{x:g,y:f}=p.rot(e.rotation).add(i);return{x:g,y:f,props:{w:Math.min(l,h),h:Math.min(d,u)}}}(e,t,{minWidth:s,minHeight:r})}))}getDefaultProps(){return{w:300,h:300,url:""}}component(e){const{w:t,h:n,url:i}=e.props,s=vk(e.id),r=C.useMemo((()=>JC(i)),[i]),o=Ru("is hovering",(()=>{const{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){const t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1}),[]),a=this.editor.getShapePageTransform(e).rotation(),l=s||o;if("undefined"!=typeof window&&(window!==window.top||window.self!==window.parent)&&"tldraw"===(null==r?void 0:r.definition.type))return null;if("github_gist"===(null==r?void 0:r.definition.type)){const i=r.url.split("/").pop();if(!i)throw Error("No gist id!");return k.jsx(pk,{className:"tl-embed-container",id:e.id,children:k.jsx(cI,{id:i,width:iy(t),height:iy(n),isInteractive:l,pageRotation:a})})}const c=(d={...Rf,...(null==r?void 0:r.definition.overridePermissions)??{}},Object.entries(d).filter((([e,t])=>t)).map((([e])=>e)).join(" "));var d;return k.jsx(pk,{className:"tl-embed-container",id:e.id,children:(null==r?void 0:r.definition)?k.jsx("iframe",{className:"tl-embed",sandbox:c,src:r.embedUrl,width:iy(t),height:iy(n),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:l?"auto":"none",zIndex:l?"":"-1",boxShadow:$P(a),borderRadius:(null==r?void 0:r.definition.overrideOutlineRadius)??8,background:null==r?void 0:r.definition.backgroundColor}}):null})}indicator(e){const t=C.useMemo((()=>QC(e.props.url)),[e.props.url]);return k.jsx("rect",{width:iy(e.props.w),height:iy(e.props.h),rx:(null==t?void 0:t.definition.overrideOutlineRadius)??8,ry:(null==t?void 0:t.definition.overrideOutlineRadius)??8})}}function cI({id:e,file:t,isInteractive:n,width:i,height:s,style:r,pageRotation:o}){return k.jsx("iframe",{className:"tl-embed",draggable:!1,width:iy(i),height:iy(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...r,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:$P(o)},srcDoc:`\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<base target="_blank">\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script src=https://gist.github.com/${e}.js${t?`?file=${t}`:""}><\/script>\n\t\t\t\t\t<style type="text/css">\n\t\t\t\t\t\t* { margin: 0px; }\n\t\t\t\t\t\ttable { height: 100%; background-color: red; }\n\t\t\t\t\t\t.gist { background-color: none; height: 100%;  }\n\t\t\t\t\t\t.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }\n\t\t\t\t\t</style>\n\t\t\t\t</body>\n\t\t\t</html>`})}b(lI,"type","embed"),b(lI,"props",Lf),b(lI,"migrations",Ff);const dI=C.forwardRef((({id:e,name:t,isEditing:n},i)=>{const s=jm(),r=C.useCallback((e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(Iy(e),e.currentTarget.blur(),s.setEditingShape(null))}),[s]),o=C.useCallback((t=>{const n=s.getShape(e);if(!n)return;const i=n.props.name,r=t.currentTarget.value.trim();i!==r&&s.updateShapes([{id:e,type:"frame",props:{name:r}}])}),[e,s]),a=C.useCallback((t=>{const n=s.getShape(e);if(!n)return;const i=n.props.name,r=t.currentTarget.value;i!==r&&s.updateShapes([{id:e,type:"frame",props:{name:r}}])}),[e,s]);return k.jsxs("div",{className:"tl-frame-label "+(n?"tl-frame-label__editing":""),children:[k.jsx("input",{className:"tl-frame-name-input",ref:i,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:r,onBlur:o,onChange:a}),uI(t,"Frame")+String.fromCharCode(8203)]})})),hI=function({id:e,name:t,width:n,height:i}){const s=jm(),r=Ru("shape rotation",(()=>Hm(s.getShapePageTransform(e).rotation())),[s,e]),o=vk(e),a=C.useRef(null),l=C.useCallback((t=>{const n=Ey(t);s.getEditingShapeId()!==e&&(s.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(e),...n}),t.preventDefault())}),[s,e]);C.useEffect((()=>{const e=a.current;e&&o&&(e.focus(),e.select())}),[a,o]);const c=((r+Math.PI/4)*(2/Math.PI)+4)%4,d=["top","left","bottom","right"][Math.floor(c)];let h;switch(d){case"top":h="";break;case"right":h=`translate(${iy(n)}px, 0px) rotate(90deg)`;break;case"bottom":h=`translate(${iy(n)}px, ${iy(i)}px) rotate(180deg)`;break;case"left":h=`translate(0px, ${iy(i)}px) rotate(270deg)`}return k.jsx("div",{className:"tl-frame-heading",style:{overflow:o?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${"top"===d||"bottom"===d?Math.ceil(n):Math.ceil(i)}px + var(--space-5))`,bottom:"100%",transform:`${h} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:k.jsx("div",{className:"tl-frame-heading-hit-area",children:k.jsx(dI,{ref:a,id:e,name:t,isEditing:o})})})};function uI(e,t){return e.match(/^\s*$/)?t:e}class pI extends mk{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"canReceiveNewChildrenOfType",((e,t)=>!e.isLocked)),b(this,"canDropShapes",((e,t)=>!e.isLocked)),b(this,"onDragShapesOver",((e,t)=>{t.every((t=>t.parentId===e.id))||this.editor.reparentShapes(t,e.id)})),b(this,"onDragShapesOut",((e,t)=>{const n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())})),b(this,"onResize",((e,t)=>fk(e,t)))}getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new eb({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const t=this.editor.getShapeGeometry(e).bounds,n=G_(),i=Ru("is creating this shape",(()=>{const t=this.editor.getStateDescendant("select.resizing");if(!t)return!1;if(!t.getIsActive())return!1;const n=null==t?void 0:t.info;return!!n&&(n.isCreating&&this.editor.getOnlySelectedShapeId()===e.id)}),[e.id]);return k.jsxs(k.Fragment,{children:[k.jsx(Fv,{children:k.jsx("rect",{className:I("tl-frame__body",{"tl-frame__creating":i}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),i?null:k.jsx(hI,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const n=lg({isDarkMode:t.isDarkMode}),i=((Hm(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;let s;switch(Math.floor(i)){case 0:s="";break;case 3:s=`translate(${iy(e.props.w)}, 0) rotate(90)`;break;case 2:s=`translate(${iy(e.props.w)}, ${iy(e.props.h)}) rotate(180)`;break;case 1:s=`translate(0, ${iy(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const r={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},o=this.editor.textMeasure.measureTextSpans(uI(e.props.name,"Frame")+String.fromCharCode(8203),r),a=o[0],l=pd(o),c=l.box.w+l.box.x-a.box.x,d=hP(this.editor,o,{offsetY:-r.height-2,...r});return k.jsxs(k.Fragment,{children:[k.jsx("rect",{width:e.props.w,height:e.props.h,fill:n.solid,stroke:n.black.solid,strokeWidth:1,rx:1,ry:1}),k.jsxs("g",{transform:s,children:[k.jsx("rect",{x:-8,y:-r.height-4,width:c+16,height:r.height,fill:n.background,rx:4,ry:4}),d]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return k.jsx("rect",{width:iy(t.width),height:iy(t.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}function gI(e,t){return e>t?2*(Lm*(t/2)+(e-t)):2*(Lm*(e/2)+(t-e))}function fI(e,t){return mI(e,t).map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}function mI(e,t){const n=e/4,i=t/4;return[new _k({start:new Am(e/2,t),cp1:new Am(1.5*n,3*i),cp2:new Am(0,2.5*i),end:new Am(0,1.2*i)}),new _k({start:new Am(0,1.2*i),cp1:new Am(0,.32*-i),cp2:new Am(1.85*n,.32*-i),end:new Am(e/2,.9*i)}),new _k({start:new Am(e/2,.9*i),cp1:new Am(2.15*n,.32*-i),cp2:new Am(e,.32*-i),end:new Am(e,1.2*i)}),new _k({start:new Am(e,1.2*i),cp1:new Am(e,2.5*i),cp2:new Am(2.5*n,3*i),end:new Am(e/2,t)})]}function yI(e,t,n,i){return VP(function(e,t,n,i){const s=Bd(e),r=t/2,o=n/2,a=Km(r,o),l=[],c=Fm*s(),d=Fm+zm/2+Math.abs(s())*zm,h=Math.max(16,a/10);for(let u=0;u<h;u++){const e=u/(h-1),i=c+e*d,a=Math.cos(i),p=Math.sin(i);l.push(new Am(r*a+.5*t+.05*s(),o*p+n/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?Mm.easeInOutSine(e):Mm.easeInExpo(e)))/2)))}return Nk(l,function(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}(i))}(e,t,n,i))}function xI(e){let t="M";let n,i,s;for(let r=0,o=e.length;r<o;r+=3)n=e[r],i=e[r+1],s=e[r+2],t+=`${Dm(n)}L${Dm(i)}Q${Dm(s)}`;return t+=`${Dm(e[0])}`,t}function wI(e,t,n,i,s){const r=[],o=Bd(e);let a,l=t[0];const c=t.length;for(let d=0,h=c*s;d<h;d++){a=Am.AddXY(t[(d+1)%c],o()*n,o()*n);const e=Am.Sub(a,l),s=Am.Len(e),h=Am.Div(e,s).mul(Math.min(s/4,i));r.push(Am.Add(l,h),Am.Add(a,h.neg()),a),l=a}return r}b(pI,"type","frame"),b(pI,"props",Nf),b(pI,"migrations",$f);const vI={s:50,m:70,l:100,xl:130},bI=.2;function SI(e,t,n,i){const s=Bd(n),r=gI(e,t),o=Math.max(Math.ceil(r/vI[i]),6,Math.ceil(r/Math.min(e,t))),a=r/o*bI,l=Math.max(e-2*a,1),c=Math.max(t-2*a,1),d=gI(l,c)/o,h=(e-l)/2,u=(t-c)/2,p=function(e,t,n){const i=Math.min(e,t)/2,s=Math.max(e,t)-2*i,r=(Math.PI*(2*i)+2*s)/n,o=e>t?[{type:"straight",start:new Am(i,0),delta:new Am(1,0)},{type:"arc",center:new Am(e-i,i),startAngle:-Lm/2},{type:"straight",start:new Am(e-i,t),delta:new Am(-1,0)},{type:"arc",center:new Am(i,i),startAngle:Lm/2}]:[{type:"straight",start:new Am(e,i),delta:new Am(0,1)},{type:"arc",center:new Am(i,t-i),startAngle:0},{type:"straight",start:new Am(0,t-i),delta:new Am(0,-1)},{type:"arc",center:new Am(i,i),startAngle:Lm}];let a=0;const l=[];for(let c=0;c<n;c++){const e=o[0];"straight"===e.type?l.push(Am.Add(e.start,Am.Mul(e.delta,a))):l.push(Zm(e.center,i,e.startAngle+a/i)),a+=r;let t="straight"===e.type?s:Lm*i;for(;a>t;)a-=t,o.push(o.shift()),t="straight"===o[0].type?s:Lm*i}return l}(l,c,o).map((e=>e.addXY(h,u))),g=e<20?0:.3*a,f=t<20?0:.3*a,m=p.slice(0);for(let x=0;x<Math.floor(o/2);x++)m[x]=Am.AddXY(m[x],s()*g,s()*f),m[o-x-1]=Am.AddXY(m[o-x-1],s()*g,s()*f);const y=[];for(let x=0;x<m.length;x++){const n=x===m.length-1?0:x+1,i=m[x],s=m[n],r=p[x],o=p[n],a=Am.Dist(r,o),l=d-a,c=Am.Dist(i,s)/a,g=(Math.max(h,u)+l)*c,f=Am.Lrp(r,o,.5).add(Am.Sub(o,r).uni().per().mul(g));f.x<0?f.x=0:f.x>e&&(f.x=e),f.y<0?f.y=0:f.y>t&&(f.y=t);const w=ly(i,s,f),v=Am.Dist(w||Am.Average([i,s]),i);y.push({leftPoint:i,rightPoint:s,arcPoint:f,center:w,radius:v})}return y}function kI(e,t,n,i){const s=[],r=SI(e,t,n,i);for(const{center:o,radius:a,leftPoint:l,rightPoint:c}of r)s.push(...cy(l,c,o,a,10));return s}function CI(e,t,n,i){const s=SI(e,t,n,i);let r=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:a,radius:l,center:c}of s){if(null===c){r+=` L${a.toFixed()}`;continue}const e=Am.Clockwise(o,a,c)?"0":"1";r+=` A${iy(l)},${iy(l)} 0 ${e},1 ${a.toFixed()}`}return r+=" Z",r}const _I={s:.5,m:.7,l:.9,xl:1.6};function PI(e,t){switch(e.geo){case"x-box":return function(e,t,n,i){const s="draw"===i?.62:0;if("dashed"===i)return[[new Am(0,0),new Am(e/2,t/2)],[new Am(e,t),new Am(e/2,t/2)],[new Am(0,t),new Am(e/2,t/2)],[new Am(e,0),new Am(e/2,t/2)]];const r=t=>Math.max(0,Math.min(e,t)),o=e=>Math.max(0,Math.min(t,e));return[[new Am(r(n*s),o(n*s)),new Am(r(e-n*s),o(t-n*s))],[new Am(r(n*s),o(t-n*s)),new Am(r(e-n*s),o(n*s))]]}(e.w,e.h,t,e.dash);case"check-box":return function(e,t){const n=.82*Math.min(e,t),i=(e-n)/2,s=(t-n)/2,r=t=>Math.max(0,Math.min(e,t)),o=e=>Math.max(0,Math.min(t,e));return[[new Am(r(i+.25*n),o(s+.52*n)),new Am(r(i+.45*n),o(s+.82*n))],[new Am(r(i+.45*n),o(s+.82*n)),new Am(r(i+.82*n),o(s+.22*n))]]}(e.w,e.h);default:return}}function II({shape:e,shouldScale:t}){const n=t?e.props.scale:1,i=jm(),s=G_(),{id:r,props:o}=e,{w:a,color:l,fill:c,dash:d,growY:h,size:u}=o,p=vC[u]*n,g=o.h+h;switch(o.geo){case"cloud":if("solid"===d){const e=CI(a,g,r,u);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),k.jsx("path",{d:e,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}if("draw"===d){const e=function(e,t,n,i){const s=Bd(n),r=_I[i],o=SI(e,t,n,i),a=o.reduce(((e,t)=>e+Am.Dist2(t.leftPoint,t.rightPoint)),0)/o.length>(15*r)**2?e=>e.addXY(s()*r*2,s()*r*2):e=>e;let l=`M${o[0].leftPoint.toFixed()}`,c=a(o[0].leftPoint),d=`M${c.toFixed()}`;for(const{leftPoint:h,center:u,rightPoint:p,radius:g,arcPoint:f}of o){if(null===u){l+=` L${p.toFixed()}`;const e=a(p);d+=` L${e.toFixed()}`,c=e;continue}const e=Am.Clockwise(h,p,u)?"0":"1";l+=` A${iy(g)},${iy(g)} 0 ${e},1 ${p.toFixed()}`;const t=a(p),n=ly(c,t,a(f));if(!Number.isFinite(n.x)||!Number.isFinite(n.y)){d+=` L${t.toFixed()}`,c=t;continue}const i=Math.abs(Am.Dist(n,c));d+=` A${iy(i)},${iy(i)} 0 ${e},1 ${t.toFixed()}`,c=t}return l+d+" Z"}(a,g,r,u);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),k.jsx("path",{d:e,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}{const e=CI(a,g,r,u),t=SI(a,g,r,u);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),k.jsx("g",{strokeWidth:p,stroke:s[l].solid,fill:"none",pointerEvents:"all",children:t.map((({leftPoint:e,rightPoint:t,center:n,radius:i},s)=>{const r=n?i*Hm(Hm(Am.Angle(n,t))-Hm(Am.Angle(n,e))):Am.Dist(e,t),{strokeDasharray:o,strokeDashoffset:a}=fP(r,p,{style:d,start:"outset",end:"outset"});return k.jsx("path",{d:n?`M${e.x},${e.y}A${i},${i},0,0,1,${t.x},${t.y}`:`M${e.x},${e.y}L${t.x},${t.y}`,strokeDasharray:o,strokeDashoffset:a},s)}))})]})}case"ellipse":{const r=t?i.getShapeGeometry(e):i.getShapeUtil(e).getGeometry(e),o=r.getSvgPathData(!0);if("dashed"===d||"dotted"===d){const e=r.length,{strokeDasharray:t,strokeDashoffset:i}=fP(e<64?2*e:e,p,{style:d,snap:4,closed:!0});return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:o,color:l,fill:c,scale:n}),k.jsx("path",{d:o,strokeWidth:p,fill:"none",stroke:s[l].solid,strokeDasharray:t,strokeDashoffset:i})]})}{const r=(t?i.getShapeGeometry(e):i.getShapeUtil(e).getGeometry(e)).getSvgPathData(!0);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:r,color:l,fill:c,scale:n}),k.jsx("path",{d:r,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}}case"oval":{const r=t?i.getShapeGeometry(e):i.getShapeUtil(e).getGeometry(e),o=r.getSvgPathData(!0);if("dashed"===d||"dotted"===d){const e=r.getLength(),{strokeDasharray:t,strokeDashoffset:i}=fP(e<64?2*e:e,p,{style:d,snap:4,start:"outset",end:"outset",closed:!0});return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:o,color:l,fill:c,scale:n}),k.jsx("path",{d:o,strokeWidth:p,fill:"none",stroke:s[l].solid,strokeDasharray:t,strokeDashoffset:i})]})}return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:o,color:l,fill:c,scale:n}),k.jsx("path",{d:o,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}case"heart":if("dashed"===d||"dotted"===d||"solid"===d){const e=fI(a,g),t=mI(a,g);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),t.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:i}=fP(e.length,p,{style:d,snap:1,start:"outset",end:"outset",closed:!0});return k.jsx("path",{d:e.getSvgPathData(),strokeWidth:p,fill:"none",stroke:s[l].solid,strokeDasharray:n,strokeDashoffset:i,pointerEvents:"all"},`curve_${t}`)}))]})}{const t=function(e,t,n,i){const s=e/4,r=t/4,o=Bd(i),a=.75*n,l=e=>e.addXY(o()*a,o()*a),c=new Am(e/2,t),d=new Am(0,1.2*r),h=new Am(e/2,.9*r),u=new Am(e,1.2*r),p=l(new Am(e/2,t)),g=l(new Am(0,1.2*r)),f=l(new Am(e/2,.9*r)),m=l(new Am(e,1.2*r));return[new _k({start:c,cp1:new Am(1.5*s,3*r),cp2:new Am(0,2.5*r),end:d}),new _k({start:d,cp1:new Am(0,.32*-r),cp2:new Am(1.85*s,.32*-r),end:h}),new _k({start:h,cp1:new Am(2.15*s,.32*-r),cp2:new Am(e,.32*-r),end:u}),new _k({start:u,cp1:new Am(e,2.5*r),cp2:new Am(2.5*s,3*r),end:p}),new _k({start:p,cp1:new Am(1.5*s,3*r),cp2:new Am(0,2.5*r),end:g}),new _k({start:g,cp1:new Am(0,.32*-r),cp2:new Am(1.85*s,.32*-r),end:f}),new _k({start:f,cp1:new Am(2.15*s,.32*-r),cp2:new Am(e,.32*-r),end:m}),new _k({start:m,cp1:new Am(e,2.5*r),cp2:new Am(2.5*s,3*r),end:c})].map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}(a,g,p,e.id);return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:t,color:l,fill:c,scale:n}),k.jsx("path",{d:t,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}default:{const o=t?i.getShapeGeometry(e):i.getShapeUtil(e).getGeometry(e),a=o instanceof Xx?o.children[0].vertices:o.vertices,h=PI(e.props,p);if("solid"===d){let e="M"+a[0]+"L"+a.slice(1)+"Z";if(h)for(const[t,n]of h)e+=`M${t.x},${t.y}L${n.x},${n.y}`;return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),k.jsx("path",{d:e,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}if("dashed"===d||"dotted"===d){const e="M"+a[0]+"L"+a.slice(1)+"Z";return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:e,color:l,fill:c,scale:n}),k.jsxs("g",{strokeWidth:p,stroke:s[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(a.length)).map(((e,t)=>{const n=Am.ToFixed(a[t]),i=Am.ToFixed(a[(t+1)%a.length]),s=Am.Dist(n,i),{strokeDasharray:r,strokeDashoffset:o}=fP(s,p,{style:d,start:"outset",end:"outset"});return k.jsx("line",{x1:n.x,y1:n.y,x2:i.x,y2:i.y,strokeDasharray:r,strokeDashoffset:o},t)})),h&&h.map((([e,t],n)=>{const i=Am.Dist(e,t),{strokeDasharray:r,strokeDashoffset:o}=fP(i,p,{style:d,start:"skip",end:"skip",snap:"dotted"===d?4:void 0});return k.jsx("path",{d:`M${e.x},${e.y}L${t.x},${t.y}`,stroke:s[l].solid,strokeWidth:p,fill:"none",strokeDasharray:r,strokeDashoffset:o},`line_fg_${n}`)}))]})]})}if("draw"===d){let e=xI(wI(r,a,p/3,2*p,2));if(h)for(const[n,i]of h)e+=`M${n.toFixed()}L${i.toFixed()}`;const t=xI(wI(r,a,0,2*p,1));return k.jsxs(k.Fragment,{children:[k.jsx(cP,{theme:s,d:t,color:l,fill:c,scale:n}),k.jsx("path",{d:e,stroke:s[l].solid,strokeWidth:p,fill:"none"})]})}}}}const jI=51;class EI extends mk{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:i.trimEnd()}}])})),b(this,"onResize",((e,{handle:t,newPoint:n,scaleX:i,scaleY:s,initialShape:r})=>{let o=r.props.w*i,a=(r.props.h+r.props.growY)*s,l=0,c=0;if(e.props.text.trim()){let t=Math.max(Math.abs(o),jI),n=Math.max(Math.abs(a),jI);t<jI&&n===jI&&(t=jI),t===jI&&n<jI&&(n=jI);const i=TI(this.editor,{...e,props:{...e.props,w:t,h:n}}),s=Math.max(Math.abs(o),i.w)*Math.sign(o),r=Math.max(Math.abs(a),i.h)*Math.sign(a);l=Math.abs(s)-Math.abs(o),c=Math.abs(r)-Math.abs(a),o=s,a=r}const d=new Am(0,0);i<0&&(d.x+=o),"left"!==t&&"top_left"!==t&&"bottom_left"!==t||(d.x+=i<0?l:-l),s<0&&(d.y+=a),"top"!==t&&"top_left"!==t&&"top_right"!==t||(d.y+=s<0?c:-c);const{x:h,y:u}=d.rot(e.rotation).add(n);return{x:h,y:u,props:{w:Math.max(Math.abs(o),1),h:Math.max(Math.abs(a),1),growY:0}}})),b(this,"onBeforeCreate",(e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h,n=TI(this.editor,e).h;let i=null;return n>t?i=n-t:e.props.growY&&(i=0),null!==i?{...e,props:{...e.props,growY:i}}:void 0})),b(this,"onBeforeUpdate",((e,t)=>{const n=e.props.text,i=t.props.text;if(n===i&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!i)return{...t,props:{...t.props,growY:0}};const s=e.props.w,r=e.props.h,o=TI(this.editor,t),a=o.w,l=o.h;if(!n&&i&&1===i.length){let n=Math.max(s,a),i=Math.max(r,l);return e.props.w<jI&&e.props.h<jI&&(n=Math.max(n,jI),i=Math.max(i,jI),n=Math.max(n,i),i=Math.max(n,i)),{...t,props:{...t.props,w:n,h:i,growY:0}}}let c=null;return l>r?c=l-r:e.props.growY&&(c=0),null!==c?{...t,props:{...t.props,growY:c,w:Math.max(t.props.w,a)}}:a>e.props.w?{...t,props:{...t.props,w:a}}:void 0})),b(this,"onDoubleClick",(e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}))}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),i=t/2,s=n/2,r=vC[e.props.size]*e.props.scale,o="none"!==e.props.fill;let a;switch(e.props.geo){case"cloud":a=new Qv({points:kI(t,n,e.id,e.props.size),isFilled:o});break;case"triangle":a=new Qv({points:[new Am(i,0),new Am(t,n),new Am(0,n)],isFilled:o});break;case"diamond":a=new Qv({points:[new Am(i,0),new Am(t,s),new Am(i,n),new Am(0,s)],isFilled:o});break;case"pentagon":a=new Qv({points:Jm(t,n,5),isFilled:o});break;case"hexagon":a=new Qv({points:Jm(t,n,6),isFilled:o});break;case"octagon":a=new Qv({points:Jm(t,n,8),isFilled:o});break;case"ellipse":a=new Ik({width:t,height:n,isFilled:o});break;case"oval":a=new jk({width:t,height:n,isFilled:o});break;case"star":{const e=5,i=Fm/e/2,s=2*Math.floor(e/4),r=2*e-s,l=0,c=2*Math.floor(e/2),d=Math.cos(s*i-zm)*t/2,h=Math.cos(r*i-zm)*t/2,u=Math.sin(l*i-zm)*n/2,p=Math.sin(c*i-zm)*n/2,g=t-Math.abs(d-h),f=n-Math.abs(p-u),m=1,y=(t-(t/2+h-(t/2-d)))/2,x=(n-(n/2+u-(n/2-p)))/2,w=(t+g)/2,v=(n+f)/2,b=w*m/2,S=v*m/2;a=new Qv({points:Array.from(Array(2*e)).map(((e,t)=>{const n=t*i-zm;return new Am(y+(t%2?b:w)*Math.cos(n),x+(t%2?S:v)*Math.sin(n))})),isFilled:o});break}case"rhombus":{const e=Math.min(.38*t,.38*n);a=new Qv({points:[new Am(e,0),new Am(t,0),new Am(t-e,n),new Am(0,n)],isFilled:o});break}case"rhombus-2":{const e=Math.min(.38*t,.38*n);a=new Qv({points:[new Am(0,0),new Am(t-e,0),new Am(t,n),new Am(e,n)],isFilled:o});break}case"trapezoid":{const e=Math.min(.38*t,.38*n);a=new Qv({points:[new Am(e,0),new Am(t-e,0),new Am(t,n),new Am(0,n)],isFilled:o});break}case"arrow-right":{const e=.38*Math.min(t,n),i=.16*n;a=new Qv({points:[new Am(0,i),new Am(t-e,i),new Am(t-e,0),new Am(t,n/2),new Am(t-e,n),new Am(t-e,n-i),new Am(0,n-i)],isFilled:o});break}case"arrow-left":{const e=.38*Math.min(t,n),i=.16*n;a=new Qv({points:[new Am(e,0),new Am(e,i),new Am(t,i),new Am(t,n-i),new Am(e,n-i),new Am(e,n),new Am(0,n/2)],isFilled:o});break}case"arrow-up":{const e=.16*t,i=.38*Math.min(t,n);a=new Qv({points:[new Am(t/2,0),new Am(t,i),new Am(t-e,i),new Am(t-e,n),new Am(e,n),new Am(e,i),new Am(0,i)],isFilled:o});break}case"arrow-down":{const e=.16*t,i=.38*Math.min(t,n);a=new Qv({points:[new Am(e,0),new Am(t-e,0),new Am(t-e,n-i),new Am(t,n-i),new Am(t/2,n),new Am(0,n-i),new Am(e,n-i)],isFilled:o});break}case"check-box":case"x-box":case"rectangle":a=new eb({width:t,height:n,isFilled:o});break;case"heart":{const e=mI(t,n).reduce(((e,t)=>(e.push(...t.vertices),e)),[]);a=new Qv({points:e,isFilled:o});break}default:wd(e.props.geo)}const l=TI(this.editor,e),c=Math.min(100,t/2),d=Math.min(SC[e.props.size]*e.props.scale*wC.lineHeight+2*IC,n/2),h=Math.min(t,Math.max(l.w,Math.min(c,Math.max(1,t-8)))),u=Math.min(n,Math.max(l.h,Math.min(d,Math.max(1,t-8)))),p=PI(e.props,r),g=p?p.map((e=>new Jv({points:e}))):[];return new Xx({children:[a,new eb({x:"start"===e.props.align?0:"end"===e.props.align?t-h:(t-h)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?n-u:(n-u)/2,width:h,height:u,isFilled:!0,isLabel:!0}),...g]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:wd(e.props.geo)}}component(e){const{id:t,type:n,props:i}=e,{fill:s,font:r,align:o,verticalAlign:a,size:l,text:c}=i,d=e.id===this.editor.getOnlySelectedShapeId(),h=G_(),u=null!==this.editor.getEditingShapeId()||e.props.text;return k.jsxs(k.Fragment,{children:[k.jsx(Fv,{id:t,children:k.jsx(II,{shape:e,shouldScale:!0})}),u&&k.jsx(pk,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:k.jsx(gP,{id:t,type:n,font:r,fontSize:SC[l]*e.props.scale,lineHeight:wC.lineHeight,padding:16*e.props.scale,fill:s,align:o,verticalAlign:a,text:c,isSelected:d,labelColor:h[i.labelColor].solid,wrap:!0})}),e.props.url&&k.jsx(zP,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:t,props:n}=e,{w:i,size:s}=n,r=n.h+n.growY,o=vC[s],a=this.editor.getShapeGeometry(e);switch(n.geo){case"ellipse":return"draw"===n.dash?k.jsx("path",{d:yI(t,i,r,o)}):k.jsx("path",{d:a.getSvgPathData(!0)});case"heart":return k.jsx("path",{d:fI(i,r)});case"oval":return k.jsx("path",{d:a.getSvgPathData(!0)});case"cloud":return k.jsx("path",{d:CI(i,r,t,s)});default:{const i=this.editor.getShapeGeometry(e),s=i instanceof Xx?i.children[0].vertices:i.vertices;let r;if("draw"===n.dash){r=xI(wI(t,s,0,2*o*e.props.scale,1))}else r="M"+s[0]+"L"+s.slice(1)+"Z";const a=PI(e.props,o);if(a)for(const[e,t]of a)r+=`M${e.x},${e.y}L${t.x},${t.y}`;return k.jsx("path",{d:r})}}}toSvg(e,t){const n={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},i=n.props;let s;if(t.addExportDef(q_(i.fill)),i.text){t.addExportDef(X_(i.font));const e=lg(t),n=new Ux(0,0,i.w,i.h+i.growY);s=k.jsx(uP,{fontSize:SC[i.size],font:i.font,align:i.align,verticalAlign:i.verticalAlign,text:i.text,labelColor:e[i.labelColor].solid,bounds:n,padding:16})}return k.jsxs(k.Fragment,{children:[k.jsx(II,{shouldScale:!1,shape:n}),s]})}getCanvasSvgDefs(){return[J_()]}}function TI(e,t){const n=t.props.text;if(!n)return{w:0,h:0};const i=e.textMeasure.measureText("w",{...wC,fontFamily:CC[t.props.font],fontSize:SC[t.props.size]*t.props.scale,maxWidth:100}),s=e.textMeasure.measureText(n,{...wC,fontFamily:CC[t.props.font],fontSize:SC[t.props.size]*t.props.scale,minWidth:i.w,maxWidth:Math.max(0,Math.ceil(i.w+{s:2,m:3.5,l:5,xl:10}[t.props.size]),Math.ceil(t.props.w-2*IC))});return{w:s.w+2*IC,h:s.h+2*IC}}b(EI,"type","geo"),b(EI,"props",Hf),b(EI,"migrations",Wf);class MI extends tb{constructor(){super(...arguments),b(this,"hideResizeHandles",(e=>DI(e))),b(this,"hideRotateHandle",(e=>DI(e))),b(this,"hideSelectionBoundsFg",(e=>DI(e))),b(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:i}=t,s=[];for(const r of e.props.segments)s.push({...r,points:r.points.map((({x:e,y:t,z:s})=>({x:n*e,y:i*t,z:s})))});return{props:{segments:s}}}))}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=OI(e);if(DI(e))return new Ck({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:n,sw:i}=AI(e,t,!0),s=eI({strokeWidth:i,showAsComplete:!0});return Uk(n,s),new Qv({points:Lk(n,s),isFilled:!0})}component(e){const t=LI(this.editor,e),n=OI(e);return k.jsx(Fv,{id:e.id,children:k.jsx(RI,{shape:e,forceSolid:t,strokeWidth:n,opacity:.35})})}backgroundComponent(e){const t=LI(this.editor,e),n=OI(e);return k.jsx(Fv,{id:e.id,children:k.jsx(RI,{shape:e,forceSolid:t,strokeWidth:n,opacity:.82})})}indicator(e){const t=LI(this.editor,e),n=OI(e),{strokePoints:i,sw:s}=AI(e,n,t),r=nI(e.props.segments);let o;return o=i.length<2?function(e,t){const n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}(r[0],s):VP(i,!1),k.jsx("path",{d:o})}toSvg(e){const t=OI(e),n=t<1.5,i=1/e.props.scale;return k.jsx("g",{transform:`scale(${i})`,children:k.jsx(RI,{forceSolid:n,strokeWidth:t,shape:e,opacity:.35})})}toBackgroundSvg(e){const t=OI(e),n=t<1.5,i=1/e.props.scale;return k.jsx("g",{transform:`scale(${i})`,children:k.jsx(RI,{forceSolid:n,strokeWidth:t,shape:e,opacity:.82})})}}function AI(e,t,n){var i;const s=nI(e.props.segments),r=e.props.isComplete||"straight"===(null==(i=pd(e.props.segments))?void 0:i.type);let o=t;n||e.props.isPen||1!==s.length||(o+=Bd(e.id)()*(t/6));return{strokePoints:Nk(s,eI({strokeWidth:o,showAsComplete:r})),sw:o}}function OI(e){return 1.12*bC[e.props.size]*e.props.scale}function DI(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function RI({strokeWidth:e,forceSolid:t,shape:n,opacity:i}){var s;const r=G_(),o=nI(n.props.segments);let a=e;t||n.props.isPen||1!==o.length||(a+=Bd(n.id)()*(a/6));const l=Nk(o,eI({strokeWidth:a,showAsComplete:n.props.isComplete||"straight"===(null==(s=pd(n.props.segments))?void 0:s.type)})),c=l.length>1?VP(l,!1):`M ${(d=n.props.segments[0].points[0]).x} ${d.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`;var d;const h=function(){const[e,t]=C.useState(!1);return C.useEffect((()=>{const e=CSS.supports("color","color(display-p3 1 1 1)"),n=matchMedia("(color-gamut: p3)");t(e&&n.matches);const i=()=>t(e&&n.matches);return n.addEventListener("change",i),()=>n.removeEventListener("change",i)}),[]),Ru(vy.forceSrgb)||!e?"srgb":"p3"}(),u=r[n.props.color].highlight[h];return k.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:u,strokeWidth:a,opacity:i})}function LI(e,t){return Ru("forceSolid",(()=>OI(t)/e.getZoomLevel()<1.5),[e])}function zI(){return k.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[k.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),k.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),k.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function FI(e,t,n){const i=jm(),[s,r]=C.useState(null),o=t?i.getAsset(t):null,a=i.getCulledShapes().has(e),l=o&&"w"in o.props?n/o.props.w:1,c=Ru("zoom level",(()=>i.getZoomLevel()*l),[i,l]);return C.useEffect((()=>{if(a)return;let e=!1;const n=i.timers.setTimeout((async()=>{const n=await i.resolveAssetUrl(t,{screenScale:c});e||r(n)}),500);return()=>{clearTimeout(n),e=!0}}),[t,null==o?void 0:o.props.src,a,c,i]),{asset:o,url:s}}function NI(){const[e,t]=C.useState(!1);return C.useEffect((()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{t(e.matches)};return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)}),[]),e}b(MI,"type","highlight"),b(MI,"props",Xf),b(MI,"migrations",qf);class $I extends mk{constructor(){super(...arguments),b(this,"isAspectRatioLocked",(()=>!0)),b(this,"canCrop",(()=>!0)),b(this,"onDoubleClick",(e=>{const t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(!t)return;t.props.src&&this.isAnimated(e)&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])})),b(this,"onDoubleClickEdge",(e=>{const t=e.props;if(!t)return;if(this.editor.getCroppingShapeId()!==e.id)return;const n=Rh(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},i=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,s=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,r=new Am(n.topLeft.x*i,n.topLeft.y*s).rot(e.rotation),o={id:e.id,type:e.type,x:e.x-r.x,y:e.y-r.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:s}};this.editor.updateShapes([o])}))}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}isAnimated(e){const t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return!!t&&("mimeType"in t.props&&Nd.isAnimatedImageType(null==t?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated)}component(e){var t;const n=this.editor.getCroppingShapeId()===e.id,i=NI(),[s,r]=C.useState(""),[o,a]=C.useState(""),l=e.id===this.editor.getOnlySelectedShapeId(),{asset:c,url:d}=FI(e.id,e.props.assetId,e.props.w);if(C.useEffect((()=>{if(d){let e=!1;const t=Pd();return t.onload=()=>{e||a(d)},t.src=d,()=>{e=!0}}}),[d,e]),C.useEffect((()=>{if(d&&this.isAnimated(e)){let e=!1;const t=Pd();return t.onload=()=>{if(e)return;const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i&&(i.drawImage(t,0,0),r(n.toDataURL()),a(d))},t.crossOrigin="anonymous",t.src=d,()=>{e=!0}}}),[i,d,e]),"bookmark"===(null==c?void 0:c.type))throw Error("Bookmark assets can't be rendered as images");const h=l&&n&&this.editor.isIn("select.crop"),u=i&&((null==(t=null==c?void 0:c.props.mimeType)?void 0:t.includes("video"))||this.isAnimated(e)),p=BI(e);return(null==c?void 0:c.props.src)?o?k.jsxs(k.Fragment,{children:[h&&k.jsx("div",{style:p,children:k.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||u?s:o,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),k.jsxs(pk,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[k.jsxs("div",{className:"tl-image-container",style:p,children:[k.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||u?s:o,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(e)&&!e.props.playing&&k.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),e.props.url&&k.jsx(zP,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:k.jsxs(pk,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:c?"transparent":"var(--color-low)",border:c?"none":"1px solid var(--color-low-border)"},children:[k.jsx("div",{className:"tl-image-container",style:p,children:c?null:k.jsx(zI,{})}),"url"in e.props&&e.props.url&&k.jsx(zP,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:k.jsx("rect",{width:iy(e.props.w),height:iy(e.props.h)})}async toSvg(e){if(!e.props.assetId)return null;if(!this.editor.getAsset(e.props.assetId))return null;let t=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginalImage:!0});if(!t)return null;(t.startsWith("blob:")||t.startsWith("http")||t.startsWith("/")||t.startsWith("./"))&&(t=await async function(e){const t=await _d(e),n=await t.blob();return Id.blobToDataUrl(n)}(t)||"");const n=BI(e),i=e.props.crop;if(n.transform&&i){const{transform:s,width:r,height:o}=n,a=(i.bottomRight.x-i.topLeft.x)*r,l=(i.bottomRight.y-i.topLeft.y)*o,c=[new Am(0,0),new Am(a,0),new Am(a,l),new Am(0,l)],d=`cropClipPath_${e.id.replace(":","_")}`;return k.jsxs(k.Fragment,{children:[k.jsx("defs",{children:k.jsx("clipPath",{id:d,children:k.jsx("polygon",{points:c.map((e=>`${e.x},${e.y}`)).join(" ")})})}),k.jsx("g",{clipPath:`url(#${d})`,children:k.jsx("image",{href:t,width:r,height:o,style:{transform:s}})})]})}return k.jsx("image",{href:t,width:e.props.w,height:e.props.h})}}function BI(e){const t=e.props.crop,n=null==t?void 0:t.topLeft;if(!n)return{width:e.props.w,height:e.props.h};const i=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,s=1/(t.bottomRight.y-t.topLeft.y)*e.props.h;return{transform:`translate(${-n.x*i}px, ${-n.y*s}px)`,width:i,height:s}}function UI(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function KI(e,t,n){return Nk(t.vertices,UI(n))}function HI(e,t,n){const i=function(e,t,n){const i=UI(n);return Lk(Uk(KI(0,t,n),i),i)}(0,t,n);return Rw(i)}function VI(e,t,n){let i=`M ${Dm(t[0])}L`,s=`M ${Dm(t[0])}L`;const r=n/3,o=2*n,a=Bd(e);let l,c,d=t[0],h=t[0];for(let u=0,p=t.length-1;u<p;u++){l=t[u+1],c=Am.AddXY(t[u+1],a()*r,a()*r);const e=Am.Sub(l,d),n=Am.Len(e),g=Am.Div(e,n).mul(Math.min(n/4,o)),f=Am.Add(d,g),m=Am.Add(l,g.neg()),y=Am.Sub(c,h),x=Am.Len(y),w=Am.Div(y,x).mul(Math.min(x/4,o)),v=Am.Add(h,w),b=Am.Add(c,w.neg());u===p-1?(i+=`${Dm(f)}L ${Dm(l)}`,s+=`${Dm(v)}L ${Dm(c)}`):(i+=`${Dm(f)}L ${Dm(m)}Q ${Dm(l)}`,s+=`${Dm(v)}L ${Dm(b)}Q ${Dm(c)}`,d=l,h=c)}return[i,i+s]}b($I,"type","image"),b($I,"props",Jf),b($I,"migrations",em);const WI=new fd;class YI extends tb{constructor(){super(...arguments),b(this,"hideResizeHandles",(()=>!0)),b(this,"hideRotateHandle",(()=>!0)),b(this,"hideSelectionBoundsFg",(()=>!0)),b(this,"hideSelectionBoundsBg",(()=>!0)),b(this,"onResize",((e,t)=>{const{scaleX:n,scaleY:i}=t;return{props:{points:qd(e.props.points,((e,{id:t,index:s,x:r,y:o})=>({id:t,index:s,x:r*n,y:o*i})))}}})),b(this,"onHandleDrag",((e,{handle:t})=>{if("vertex"===t.type)return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:t.x,y:t.y}}}}}))}getDefaultProps(){const[e,t]=fh(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return XI(e)}getHandles(e){return WI.get(e.props,(()=>{const t=XI(e),n=GI(e),i=n.map((e=>({...e,id:e.index,type:"vertex",canSnap:!0})));for(let e=0;e<n.length-1;e++){const s=ph(n[e].index,n[e+1].index),r=t.segments[e].midPoint();i.push({id:s,type:"create",index:s,x:r.x,y:r.y,canSnap:!0})}return i.sort(mh)}))}component(e){return k.jsx(Fv,{id:e.id,children:k.jsx(qI,{shape:e})})}indicator(e){const t=vC[e.props.size]*e.props.scale,n=XI(e),{dash:i}=e.props;let s;if("line"===e.props.spline){const r=n.points;if("solid"===i||"dotted"===i||"dashed"===i)s="M"+r[0]+"L"+r.slice(1);else{const[n]=VI(e.id,r,t);s=n}}else s=function(e,t,n){if("draw"===e.props.dash)return VP(KI(0,t,n));return t.getSvgPathData()}(e,n,t);return k.jsx("path",{d:s})}toSvg(e){return k.jsx(qI,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=GI(e);return{points:t,getSelfSnapPoints:n=>{const i=this.getHandles(e).filter((e=>"vertex"===e.type)).findIndex((e=>e.id===n.id));return t.filter(((e,t)=>Math.abs(t-i)>1)).map(Am.From)},getSelfSnapOutline:t=>{const n=this.getHandles(e).filter((e=>"vertex"===e.type)).findIndex((e=>e.id===t.id)),i=XI(e).segments.filter(((e,t)=>t!==n-1&&t!==n));return i.length?new Xx({children:i}):null}}}}function GI(e){return Object.values(e.props.points).sort(mh)}function XI(e){const t=GI(e).map(Am.From);switch(e.props.spline){case"cubic":return new Pk({points:t});case"line":return new Jv({points:t})}}function qI({shape:e,shouldScale:t=!1}){const n=G_(),i=XI(e),{dash:s,color:r,size:o}=e.props,a=1/e.props.scale,l=t?a:1,c=vC[o]*e.props.scale;if("line"===e.props.spline){if("solid"===s){const e=i.points,t="M"+e[0]+"L"+e.slice(1);return k.jsx("path",{d:t,stroke:n[r].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}if("dashed"===s||"dotted"===s)return k.jsx("g",{stroke:n[r].solid,strokeWidth:c,transform:`scale(${l})`,children:i.segments.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=fP(e.length,c,{style:s,start:t>0?"outset":"none",end:t<i.segments.length-1?"outset":"none"});return k.jsx("path",{strokeDasharray:n,strokeDashoffset:r,d:e.getSvgPathData(!0),fill:"none"},t)}))});if("draw"===s){const t=i.points,[s,o]=VI(e.id,t,c);return k.jsx("path",{d:o,stroke:n[r].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}}if("cubic"===e.props.spline){const e=i.getSvgPathData();if("solid"===s)return k.jsx("path",{strokeWidth:c,stroke:n[r].solid,fill:"none",d:e,transform:`scale(${l})`});if("dashed"===s||"dotted"===s)return k.jsx("g",{stroke:n[r].solid,strokeWidth:c,transform:`scale(${l})`,children:i.segments.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=fP(e.length,c,{style:s,start:t>0?"outset":"none",end:t<i.segments.length-1?"outset":"none"});return k.jsx("path",{strokeDasharray:n,strokeDashoffset:r,d:e.getSvgPathData(),fill:"none"},t)}))});if("draw"===s)return k.jsx("path",{d:HI(0,i,c),strokeWidth:1,stroke:n[r].solid,fill:n[r].solid,transform:`scale(${l})`})}}b(YI,"type","line"),b(YI,"props",im),b(YI,"migrations",rm);const ZI=C.createContext(null);function JI({assetUrls:e,children:t}){return C.useEffect((()=>{for(const t of Object.values(e.icons)){const e=Pd();e.src=t,e.decode()}for(const t of Object.values(e.embedIcons)){const e=Pd();e.src=t,e.decode()}}),[e]),k.jsx(ZI.Provider,{value:e,children:t})}function QI(){const e=C.useContext(ZI);if(!e)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return e}const ej={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new projectâ¦","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},tj=new Set(["ar","fa","he","ur","ku"]),nj={locale:"en",label:"English",messages:ej,dir:"ltr"};const ij=C.createContext(null);function sj(){const e=C.useContext(ij);if(!e)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return e}const rj=Ou((function({overrides:e,children:t}){const n=jm().user.getLocale(),i=QI(),[s,r]=C.useState((()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...ej,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:ej}));return C.useEffect((()=>{let t=!1;return async function(){const s=await async function(e,t){if(!(await _d(t.translations.en)).ok)return console.warn("No main translations found."),nj;if("en"===e)return nj;const n=bm.find((t=>t.locale===e));if(!n)return console.warn(`No translation found for locale ${e}`),nj;const i=await _d(t.translations[n.locale]),s=await i.json();if(!s)return console.warn(`No messages found for locale ${e}`),nj;const r=[];for(const o in nj.messages)s[o]||r.push(o);return r.length,{locale:e,label:n.label,dir:tj.has(n.locale)?"rtl":"ltr",messages:{...nj.messages,...s}}}(n,i);s&&!t&&(e&&e[n]?r({...s,messages:{...s.messages,...e[n]}}):r(s))}(),()=>{t=!0}}),[i,n,e]),k.jsx(ij.Provider,{value:s,children:t})}));function oj(){const e=sj();return C.useCallback((function(t){return e.messages[t]??t}),[e])}class aj extends tb{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"hideResizeHandles",(()=>!0)),b(this,"hideSelectionBoundsFg",(()=>!1)),b(this,"onBeforeCreate",(e=>lj(this.editor,e))),b(this,"onBeforeUpdate",((e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return lj(this.editor,t)})),b(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:i.trimEnd()}}])}))}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:n}=dj(this.editor,e),{scale:i}=e.props,s=t*i,r=n*i,o=O_*i,a=hj(e);return new Xx({children:[new eb({width:o,height:a,isFilled:!0}),new eb({x:"start"===e.props.align?0:"end"===e.props.align?o-r:(o-r)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?a-s:(a-s)/2,width:r,height:s,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const n=this.editor.getZoomLevel();if(n*t<.25)return[];const i=hj(e),s=O_*t,r=0/n*t;return n*t<.5?[{id:"bottom",index:"a3",type:"clone",x:s/2,y:i+r}]:[{id:"top",index:"a1",type:"clone",x:s/2,y:-r},{id:"right",index:"a2",type:"clone",x:s+r,y:i/2},{id:"bottom",index:"a3",type:"clone",x:s/2,y:i+r},{id:"left",index:"a4",type:"clone",x:-r,y:i/2}]}component(e){const{id:t,type:n,props:{scale:i,color:s,font:r,size:o,align:a,text:l,verticalAlign:c,fontSizeAdjustment:d}}=e,h=function(e){const t=jm(),n=sj();return C.useCallback((i=>{const s=t.getShape(e);if(!s)return;const r="Tab"===i.key,o=(i.metaKey||i.ctrlKey)&&"Enter"===i.key;if(r||o){i.preventDefault();const a=t.getShapePageTransform(e),l=a.rotation(),c=!("rtl"!==n.dir&&!r_(s.props.text)),d=(O_+t.options.adjacentShapeMargin+(o&&!i.shiftKey?s.props.growY:0))*s.props.scale,h=new Am(r?i.shiftKey!=c?-1:1:0,o?i.shiftKey?-1:1:0).mul(d).add(D_.clone().mul(s.props.scale)).rot(l).add(a.point()),u=F_(t,s,h,l);u&&(t.mark("editing adjacent shape"),E_(t,u,!0))}}),[e,t,n.dir])}(t),u=G_(),p=O_*i,g=hj(e),f=Ru("shape rotation",(()=>{var e;return(null==(e=this.editor.getShapePageTransform(t))?void 0:e.rotation())??0}),[this.editor]),m=Ru("zoom",(()=>this.editor.getZoomLevel()<.35/i),[i,this.editor]),y=e.id===this.editor.getOnlySelectedShapeId();return k.jsxs(k.Fragment,{children:[k.jsx("div",{id:t,className:"tl-note__container",style:{width:p,height:g,backgroundColor:u[s].note.fill,borderBottom:m?3*i+"px solid rgb(15, 23, 31, .2)":"none",boxShadow:m?"none":uj(e.id,f,i)},children:k.jsx(gP,{id:t,type:n,font:r,fontSize:(d||SC[o])*i,lineHeight:wC.lineHeight,align:a,verticalAlign:c,text:l,isNote:!0,isSelected:y,labelColor:u[s].note.text,wrap:!0,padding:16*i,onKeyDown:h})}),"url"in e.props&&e.props.url&&k.jsx(zP,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{scale:t}=e.props;return k.jsx("rect",{rx:t,width:iy(O_*t),height:iy(hj(e))})}toSvg(e,t){t.addExportDef(X_(e.props.font)),e.props.text&&t.addExportDef(X_(e.props.font));const n=lg({isDarkMode:t.isDarkMode}),i=function(e){return new Ux(0,0,O_,O_+e.props.growY)}(e);return k.jsxs(k.Fragment,{children:[k.jsx("rect",{x:5,y:5,rx:1,width:O_-10,height:i.h,fill:"rgba(0,0,0,.1)"}),k.jsx("rect",{rx:1,width:O_,height:i.h,fill:n[e.props.color].note.fill}),k.jsx(uP,{fontSize:e.props.fontSizeAdjustment||SC[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:n[e.props.color].note.text,bounds:i,stroke:!1})]})}}function lj(e,t){const{labelHeight:n,fontSizeAdjustment:i}=dj(e,t),s=Math.max(0,n-O_);if(s!==t.props.growY||i!==t.props.fontSizeAdjustment)return{...t,props:{...t.props,growY:s,fontSizeAdjustment:i}}}b(aj,"type","note"),b(aj,"props",om),b(aj,"migrations",lm);const cj=new fd;function dj(e,t){return cj.get(t,(()=>function(e,t){const{text:n}=t.props;if(!n)return{labelHeight:SC[t.props.size]*wC.lineHeight+2*IC,labelWidth:100,fontSizeAdjustment:0};const i=SC[t.props.size];let s=0,r=0,o=O_,a=O_;do{s=Math.min(i,i-r);const l=e.textMeasure.measureText(n,{...wC,fontFamily:CC[t.props.font],fontSize:s,maxWidth:O_-2*IC-1,disableOverflowWrapBreaking:!0});if(o=l.h+2*IC,a=l.w+2*IC,s<=14){const i=e.textMeasure.measureText(n,{...wC,fontFamily:CC[t.props.font],fontSize:s,maxWidth:O_-2*IC-1});o=i.h+2*IC,a=i.w+2*IC;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(r++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:s}}(e,t)))}function hj(e){return(O_+e.props.growY)*e.props.scale}function uj(e,t,n){const i=Bd(e),s=Math.abs(i())+.5,r=Math.cos(t),o=5*n,a=4*n,l=6*n,c=7*n;return`0px ${o-s}px ${o}px -${o}px rgba(15, 23, 31, .6),\n\t0px ${(a+s*c)*Math.max(0,r)}px ${l+s*c}px -${a+s*l}px rgba(15, 23, 31, ${(.3+.1*s).toFixed(2)}), \n\t0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+.005*i())*((1+r)/2)).toFixed(2)})`}function pj(e,{initialBounds:t,scaleX:n,scaleY:i,newPoint:s}){const r=Math.max(.01,Math.min(Math.abs(n),Math.abs(i))),o=new Am(0,0);n<0&&(o.x=-t.width*r),i<0&&(o.y=-t.height*r);const{x:a,y:l}=Am.Add(s,o.rot(e.rotation));return{x:a,y:l,props:{scale:r*e.props.scale}}}const gj=new fd;class fj extends tb{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"isAspectRatioLocked",(()=>!0)),b(this,"onResize",((e,t)=>{const{newPoint:n,initialBounds:i,initialShape:s,scaleX:r,handle:o}=t;if("scale_shape"===t.mode||"right"!==o&&"left"!==o)return{id:e.id,type:e.type,...pj(e,t)};{const t=Math.max(1,Math.abs(i.width*r)),{x:o,y:a}=r<0?Am.Sub(n,Am.FromAngle(e.rotation).mul(t)):n;return{id:e.id,type:e.type,x:o,y:a,props:{w:t/s.props.scale,autoSize:!1}}}})),b(this,"onEditEnd",(e=>{const{id:t,type:n,props:{text:i}}=e,s=e.props.text.trimEnd();0===s.length?this.editor.deleteShapes([e.id]):s!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:i.trimEnd()}}])})),b(this,"onBeforeUpdate",((e,t)=>{if(!t.props.autoSize)return;const n=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=e.props.text!==t.props.text;if(!n&&!i)return;const s=this.getMinDimensions(e),r=mj(this.editor,t.props),o=s.width*e.props.scale,a=s.height*e.props.scale,l=r.width*t.props.scale,c=r.height*t.props.scale;let d;switch(t.props.textAlign){case"middle":d=new Am((l-o)/2,i?0:(c-a)/2);break;case"end":d=new Am(l-o,i?0:(c-a)/2);break;default:if(i)break;d=new Am(0,(c-a)/2)}if(d){d.rot(t.rotation);const{x:e,y:n}=t;return{...t,x:e-d.x,y:n-d.y,props:{...t.props,w:l}}}return{...t,props:{...t.props,w:l}}}))}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return gj.get(e.props,(e=>mj(this.editor,e)))}getGeometry(e){const{scale:t}=e.props,{width:n,height:i}=this.getMinDimensions(e);return new eb({width:n*t,height:i*t,isFilled:!0,isLabel:!0})}component(e){const{id:t,props:{font:n,size:i,text:s,color:r,scale:o,textAlign:a}}=e,{width:l,height:c}=this.getMinDimensions(e),d=e.id===this.editor.getOnlySelectedShapeId(),h=G_(),u=function(e){const t=jm();return C.useCallback((n=>{if(t.getEditingShapeId()===e)switch(n.key){case"Enter":(n.ctrlKey||n.metaKey)&&t.complete();break;case"Tab":Cy(n),n.shiftKey?n_.unindent(n.currentTarget):n_.indent(n.currentTarget)}}),[t,e])}(t);return k.jsx(gP,{id:t,classNamePrefix:"tl-text-shape",type:"text",font:n,fontSize:bC[i],lineHeight:wC.lineHeight,align:a,verticalAlign:"middle",text:s,labelColor:h[r].solid,isSelected:d,textWidth:l,textHeight:c,style:{transform:`scale(${o})`,transformOrigin:"top left"},wrap:!0,onKeyDown:u})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,n=jm();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:k.jsx("rect",{width:iy(t.width),height:iy(t.height)})}toSvg(e,t){t.addExportDef(X_(e.props.font)),e.props.text&&t.addExportDef(X_(e.props.font));const n=this.editor.getShapeGeometry(e).bounds,i=n.width/(e.props.scale??1),s=n.height/(e.props.scale??1),r=lg(t);return k.jsx(uP,{fontSize:bC[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:r[e.props.color].solid,bounds:new Ux(0,0,i,s),padding:0})}}function mj(e,t){const{font:n,text:i,autoSize:s,size:r,w:o}=t,a=s?16:Math.max(16,o),l=bC[r],c=s?null:Math.floor(Math.max(a,o)),d=e.textMeasure.measureText(i,{...wC,fontFamily:CC[n],fontSize:l,maxWidth:c});return s&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(l,d.h)}}b(fj,"type","text"),b(fj,"props",dm),b(fj,"migrations",um);class yj extends mk{constructor(){super(...arguments),b(this,"canEdit",(()=>!0)),b(this,"isAspectRatioLocked",(()=>!0))}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:t}=this,n=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,{asset:i,url:s}=FI(e.id,e.props.assetId,e.props.w),{time:r,playing:o}=e.props,a=vk(e.id),l=NI(),c=C.useRef(null),d=C.useCallback((n=>{const i=n.currentTarget;i&&t.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:i.currentTime}}])}),[e.id,t]),h=C.useCallback((n=>{const i=n.currentTarget;i&&t.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:i.currentTime}}])}),[e.id,t]),u=C.useCallback((n=>{const i=n.currentTarget;i&&a&&t.updateShapes([{type:"video",id:e.id,props:{time:i.currentTime}}])}),[a,e.id,t]),[p,g]=C.useState(!1),f=C.useCallback((e=>{const t=e.currentTarget;t&&(r!==t.currentTime&&(t.currentTime=r),o||t.pause(),g(!0))}),[o,r]);return C.useEffect((()=>{const e=c.current;e&&(p&&!a&&r!==e.currentTime&&(e.currentTime=r),a&&document.activeElement!==e&&e.focus())}),[a,p,r]),C.useEffect((()=>{if(l){const e=c.current;if(!e)return;e.pause(),e.currentTime=0}}),[c,l]),k.jsxs(k.Fragment,{children:[k.jsx(pk,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:i?"transparent":"var(--color-low)",border:i?"none":"1px solid var(--color-low-border)"},children:k.jsx("div",{className:"tl-counter-scaled",children:k.jsx("div",{className:"tl-video-container",children:(null==i?void 0:i.props.src)?s?k.jsx("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&n,onPlay:d,onPause:h,onTimeUpdate:u,onLoadedData:f,hidden:!p,children:k.jsx("source",{src:s})}):null:k.jsx(zI,{})})})}),"url"in e.props&&e.props.url&&k.jsx(zP,{url:e.props.url,zoomLevel:t.getZoomLevel()})]})}indicator(e){return k.jsx("rect",{width:iy(e.props.w),height:iy(e.props.h)})}toSvg(e){return k.jsx("image",{href:xj(e.id),width:e.props.w,height:e.props.h})}}function xj(e){const t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){const e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e.toDataURL("image/png")}throw new Error("Video with not found when attempting serialization.")}b(yj,"type","video"),b(yj,"props",pm),b(yj,"migrations",fm);const wj=[fj,BP,sI,EI,aj,YI,pI,MP,MI,lI,$I,yj];class vj extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"scribbleId","id"),b(this,"markId",""),b(this,"excludedShapeIds",new Set),b(this,"onEnter",(e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter((e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){const n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1})).map((e=>e.id)));const n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()})),b(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)})),b(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),b(this,"onPointerMove",(()=>{this.update()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()}))}update(){const{editor:e,excludedShapeIds:t}=this,n=e.getErasingShapeIds(),i=e.getZoomLevel(),s=e.getCurrentPageShapes(),{inputs:{currentPagePoint:r,previousPagePoint:o}}=e;this.pushPointToScribble();const a=new Set(n),l=this.editor.options.hitTestMargin/i;for(const c of s){if(e.isShapeOfType(c,"group"))continue;const t=e.getShapeMask(c.id);if(t&&!ny(r,t))continue;const n=e.getShapeGeometry(c),i=e.getShapePageTransform(c);if(!n||!i)continue;const s=i.clone().invert(),d=s.applyToPoint(o),h=s.applyToPoint(r),{bounds:u}=n;u.minX-l>Math.max(d.x,h.x)||u.minY-l>Math.max(d.y,h.y)||u.maxX+l<Math.min(d.x,h.x)||u.maxY+l<Math.min(d.y,h.y)||n.hitTestLineSegment(d,h,l)&&a.add(e.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...a].filter((e=>!t.has(e))))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}b(vj,"id","erasing");let bj=(p=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(p,"id","idle"),p),Sj=(g=class extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,i=new Set,s=i.size;for(let r=t.length-1;r>=0;r--){const o=t[r];if(!this.editor.isShapeOrAncestorLocked(o)&&!this.editor.isShapeOfType(o,"group")&&this.editor.isPointInShape(o,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&i.size>s)break;i.add(e.id)}}this.editor.setErasingShapes([...i])})),b(this,"onLongPress",(e=>{this.startErasing(e)})),b(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.startErasing(e)})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.cancel()}))}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},b(g,"id","pointing"),g);class kj extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})}))}}b(kj,"id","eraser"),b(kj,"initial","idle"),b(kj,"children",(()=>[bj,Sj,vj]));class Cj extends rS{constructor(){super(...arguments),b(this,"initialCamera",new Am),b(this,"onEnter",(()=>{this.initialCamera=Am.From(this.editor.getCamera()),this.update()})),b(this,"onPointerMove",(()=>{this.update()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.parent.transition("idle")})),b(this,"onComplete",(()=>{this.complete()}))}update(){const{initialCamera:e,editor:t}=this,{currentScreenPoint:n,originScreenPoint:i}=t.inputs,s=Am.Sub(n,i).div(t.getZoomLevel());0!==s.len2()&&t.setCamera(e.clone().add(s))}complete(){const{editor:e}=this,{pointerVelocity:t}=e.inputs,n=Math.min(t.len(),2);n>.1&&this.editor.slideCamera({speed:n,direction:t}),this.parent.transition("idle")}}b(Cj,"id","dragging");let _j=(f=class extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.editor.setCursor({type:"grab",rotation:0})})),b(this,"onPointerDown",(e=>{this.parent.transition("pointing",e)})),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select")}))}},b(f,"id","idle"),f),Pj=(m=class extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})})),b(this,"onLongPress",(()=>{this.startDragging()})),b(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.startDragging()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.complete()}))}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},b(m,"id","pointing"),m);class Ij extends rS{constructor(){super(...arguments),b(this,"onDoubleClick",(e=>{if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{animation:{duration:220,easing:Mm.easeOutQuint}})}})),b(this,"onTripleClick",(e=>{if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{animation:{duration:320,easing:Mm.easeOutQuint}})}})),b(this,"onQuadrupleClick",(e=>{if("settle"===e.phase){const e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({animation:{duration:400,easing:Mm.easeOutQuint}}):this.editor.resetZoom(t,{animation:{duration:320,easing:Mm.easeOutQuint}})}}))}}b(Ij,"id","hand"),b(Ij,"initial","idle"),b(Ij,"children",(()=>[_j,Pj,Cj]));let jj=(y=class extends rS{constructor(){super(...arguments),b(this,"onPointerDown",(e=>{this.parent.transition("lasering",e)}))}},b(y,"id","idle"),y);class Ej extends rS{constructor(){super(...arguments),b(this,"scribbleId","id"),b(this,"onEnter",(()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()})),b(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),b(this,"onPointerMove",(()=>{this.pushPointToScribble()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()}))}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}b(Ej,"id","lasering");class Tj extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.editor.setCursor({type:"cross",rotation:0})}))}}b(Tj,"id","laser"),b(Tj,"initial","idle"),b(Tj,"children",(()=>[jj,Ej]));class Mj extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"initialSelectedShapeIds",[]),b(this,"excludedShapeIds",new Set),b(this,"isWrapMode",!1),b(this,"initialStartShape",null),b(this,"onEnter",(e=>{const{altKey:t,currentPagePoint:n}=this.editor.inputs;this.isWrapMode=this.editor.user.getIsWrapMode(),t?this.parent.transition("scribble_brushing",e):(this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter((e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e))).map((e=>e.id))),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.hitTestShapes())})),b(this,"onExit",(()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})})),b(this,"onTick",(({elapsed:e})=>{const{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)})),b(this,"onPointerMove",(()=>{this.hitTestShapes()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)})),b(this,"onKeyDown",(e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()})),b(this,"onKeyUp",(()=>{this.hitTestShapes()})),b(this,"onInterrupt",(()=>{this.editor.updateInstanceState({brush:null})}))}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:t,isWrapMode:n}=this,{inputs:{originPagePoint:i,currentPagePoint:s,shiftKey:r,ctrlKey:o}}=e,a=new Set(r?this.initialSelectedShapeIds:[]),l=n?!o:o,c=Ux.FromPoints([i,s]),{corners:d}=c;let h,u,p,g,f,m;const y=e.getCurrentPageShapes(),x=e.getCurrentPageId();e:for(let b=0,S=y.length;b<S;b++)if(p=y[b],!t.has(p.id)&&!a.has(p.id)&&(g=e.getShapePageBounds(p),g))if(c.contains(g))this.handleHit(p,s,x,a,d);else if(!l&&!e.isShapeOfType(p,"frame")&&c.collides(g)){if(f=e.getShapePageTransform(p),!f)continue e;m=f.clone().invert().applyToPoints(d);const t=e.getShapeGeometry(p);t:for(let e=0;e<4;e++)if(h=m[e],u=m[(e+1)%4],t.hitTestLineSegment(h,u,0)){this.handleHit(p,s,x,a,d);break t}}e.getInstanceState().isCoarsePointer;const w=e.getInstanceState().brush;w&&c.equals(w)||e.updateInstanceState({brush:{...c.toJson()}});const v=e.getSelectedShapeIds();(v.length!==a.size||v.some((e=>!a.has(e))))&&e.setSelectedShapes(Array.from(a))}handleHit(e,t,n,i,s){if(e.parentId===n)return void i.add(e.id);const r=this.editor.getOutermostSelectableShape(e),o=this.editor.getShapeMask(r.id);(!o||Xv(o,s)||ny(t,o))&&i.add(r.id)}}b(Mj,"id","brushing");const Aj={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Oj extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e,this.updateCursor()})),b(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.startResizing()})),b(this,"onLongPress",(()=>{this.startResizing()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(){const e=this.editor.getSelectedShapes(),t=Aj[this.info.handle];this.editor.setCursor({type:t,rotation:1===e.length?this.editor.getSelectionRotation():0})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b(Oj,"id","pointing_resize_handle");class Dj extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"markId",""),b(this,"snapshot",{}),b(this,"onEnter",(e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()})),b(this,"onPointerMove",(()=>{this.updateShapes()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"getDefaultCrop",(()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}})))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const e=Aj[this.info.handle];this.editor.setCursor({type:e,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e)return;if(!this.editor.getShapeUtil("image"))return;const n=e.props,i=this.editor.inputs.currentPagePoint.clone().sub(t),s=this.editor.inputs.originPagePoint.clone().sub(t),r=i.clone().sub(s).rot(-e.rotation),o=n.crop??this.getDefaultCrop(),a=Rh(o),l=new Am(e.x,e.y),c=new Am(0,0),d=1/(o.bottomRight.x-o.topLeft.x)*n.w,h=1/(o.bottomRight.y-o.topLeft.y)*n.h;let u=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":if(h<8)break;u=!0,a.topLeft.y=a.topLeft.y+r.y/h;h*(a.bottomRight.y-a.topLeft.y)<8?(a.topLeft.y=a.bottomRight.y-8/h,c.y=(a.topLeft.y-o.topLeft.y)*h):a.topLeft.y<=0?(a.topLeft.y=0,c.y=(a.topLeft.y-o.topLeft.y)*h):c.y=r.y;break;case"bottom":case"bottom_left":case"bottom_right":if(h<8)break;u=!0,a.bottomRight.y=Math.min(1,a.bottomRight.y+r.y/h);h*(a.bottomRight.y-a.topLeft.y)<8&&(a.bottomRight.y=a.topLeft.y+8/h);break}switch(this.info.handle){case"left":case"top_left":case"bottom_left":if(d<8)break;u=!0,a.topLeft.x=a.topLeft.x+r.x/d;d*(a.bottomRight.x-a.topLeft.x)<8?(a.topLeft.x=a.bottomRight.x-8/d,c.x=(a.topLeft.x-o.topLeft.x)*d):a.topLeft.x<=0?(a.topLeft.x=0,c.x=(a.topLeft.x-o.topLeft.x)*d):c.x=r.x;break;case"right":case"top_right":case"bottom_right":if(d<8)break;u=!0,a.bottomRight.x=Math.min(1,a.bottomRight.x+r.x/d);d*(a.bottomRight.x-a.topLeft.x)<8&&(a.bottomRight.x=a.topLeft.x+8/d);break}if(!u)return;l.add(c.rot(e.rotation));const p={id:e.id,type:e.type,x:l.x,y:l.y,props:{crop:a,w:(a.bottomRight.x-a.topLeft.x)*d,h:(a.bottomRight.y-a.topLeft.y)*h}};this.editor.updateShapes([p]),this.updateCursor()}complete(){this.updateShapes(),I_(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),s=Am.RotWith(i.getHandlePoint(this.info.handle),i.point,e);return{shape:n,cursorHandleOffset:Am.Sub(t,s)}}}function Rj(e,t=!1){const n=e.getZoomLevel(),{inputs:{currentPagePoint:i}}=e;return e.getShapeAtPoint(i,{hitInside:!1,hitLabels:t,margin:e.options.hitTestMargin/n,renderingOnly:!0})??e.getSelectedShapeAtPoint(i)}function Lj(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");const{crop:i}=t.props;if(!i)return;const s=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===s?n.x=0:"y"===s&&(n.y=0),n.rot(-t.rotation);const r=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,o=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,a=i.bottomRight.y-i.topLeft.y,l=i.bottomRight.x-i.topLeft.x,c=Rh(i);c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/r)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/o)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a;return{id:t.id,type:t.type,props:{crop:c}}}b(Dj,"id","cropping");let zj=(x=class extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)})),b(this,"onExit",(()=>{this.editor.setCursor({type:"default",rotation:0})})),b(this,"onCancel",(()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})})),b(this,"onPointerDown",(e=>{var t;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey)return this.cancel(),void this.editor.root.handleEvent(e);switch(e.target){case"canvas":{const t=Rj(this.editor);if(t&&!this.editor.isShapeOfType(t,"group"))return void this.onPointerDown({...e,shape:t,target:"shape"});this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId())return void this.editor.setCurrentTool("select.crop.pointing_crop",e);(null==(t=this.editor.getShapeUtil(e.shape))?void 0:t.canCrop(e.shape))?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}})),b(this,"onDoubleClick",(e=>{var t;if(this.editor.inputs.shiftKey||"up"!==e.phase)return;const n=this.editor.getCroppingShapeId();if(!n)return;const i=this.editor.getShape(n);if(!i)return;const s=this.editor.getShapeUtil(i);s&&("selection"!==e.target?(this.cancel(),this.editor.root.handleEvent(e)):null==(t=s.onDoubleClickEdge)||t.call(s,i))})),b(this,"onKeyDown",(()=>{this.nudgeCroppingImage(!1)})),b(this,"onKeyRepeat",(()=>{this.nudgeCroppingImage(!0)})),b(this,"onKeyUp",(e=>{if("Enter"===e.code)this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}))}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),i=new Am(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new Am(0,0)))return;n&&i.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const r=Lj(this.editor,s,i);r&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([r]))}},b(x,"id","idle"),x);class Fj extends rS{constructor(){super(...arguments),b(this,"onCancel",(()=>{this.editor.setCurrentTool("select.crop.idle",{})})),b(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)})),b(this,"onPointerUp",(e=>{this.editor.setCurrentTool("select.crop.idle",e)}))}}b(Fj,"id","pointing_crop");class Nj extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const t=this.editor.getSelectedShapes()[0];if(!t)return;const n=Aj[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(t.id)})),b(this,"onExit",(()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)})),b(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.startCropping()})),b(this,"onLongPress",(()=>{this.startCropping()})),b(this,"onPointerUp",(()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}b(Nj,"id","pointing_crop_handle");class $j extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"markId","translating crop"),b(this,"snapshot",{}),b(this,"onEnter",(e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()})),b(this,"onExit",(()=>{this.editor.setCursor({type:"default",rotation:0})})),b(this,"onPointerMove",(()=>{this.updateShapes()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onKeyDown",(e=>{switch(e.key){case"Alt":case"Shift":return void this.updateShapes()}})),b(this,"onKeyUp",(e=>{switch(e.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}))}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,i=n.clone().sub(t),s=Lj(this.editor,e,i);s&&this.editor.updateShapes([s])}}b($j,"id","translating_crop");class Bj extends rS{constructor(){super(...arguments),b(this,"markId",""),b(this,"onEnter",(()=>{this.didCancel=!1,this.markId=this.editor.history.mark()})),b(this,"didCancel",!1),b(this,"onExit",(()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.history.squashToMark(this.markId)})),b(this,"onCancel",(()=>{this.didCancel=!0}))}}b(Bj,"id","crop"),b(Bj,"initial","idle"),b(Bj,"children",(()=>[zj,$j,Fj,Nj,Dj]));class Uj extends rS{constructor(){super(...arguments),b(this,"shapeId",""),b(this,"initialHandle",{}),b(this,"initialAdjacentHandle",null),b(this,"initialPagePoint",{}),b(this,"markId",""),b(this,"initialPageTransform"),b(this,"initialPageRotation"),b(this,"info",{}),b(this,"isPrecise",!1),b(this,"isPreciseId",null),b(this,"pointingId",null),b(this,"onEnter",(e=>{const{shape:t,isCreating:n,handle:i}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId=n?`creating:${t.id}`:"dragging handle",n||this.editor.mark(this.markId),this.initialHandle=Rh(i),this.editor.isShapeOfType(t,"line")&&"create"===this.initialHandle.type){this.editor.updateShape({...t,props:{points:{...t.props.points,[i.index]:{id:i.index,index:i.index,x:i.x,y:i.y}}}});const e=this.editor.getShapeHandles(t).find((e=>e.index===i.index));this.initialHandle=Rh(e)}this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:n?"cross":"grabbing",rotation:0});const s=this.editor.getShapeHandles(t).sort(mh),r=s.findIndex((t=>t.id===e.handle.id));this.initialAdjacentHandle=null;for(let o=r+1;o<s.length;o++){const t=s[o];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}if(!this.initialAdjacentHandle)for(let o=s.length-1;o>=0;o--){const t=s[o];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}if(this.editor.isShapeOfType(t,"arrow")){const n=iC(this.editor,t)[e.handle.id];this.isPrecise=!1,n?(this.editor.setHintingShapes([n.toId]),this.isPrecise=n.props.isPrecise,this.isPrecise?this.isPreciseId=n.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)})),b(this,"exactTimeout",-1),b(this,"onPointerMove",(()=>{this.update()})),b(this,"onKeyDown",(()=>{this.update()})),b(this,"onKeyUp",(()=>{this.update()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.update(),this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}))}resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout((()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1}),750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),I_(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;this.editor.getInstanceState().isToolLocked&&e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle")}update(){var e;const{editor:t,shapeId:n,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:r,initialAdjacentHandle:o}=this,a=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:c,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:u,altKey:p,pointerVelocity:g}}=t,f=this.info.shape,m=t.getShape(n);if(!m)return;const y=t.getShapeUtil(m);let x=d.clone().sub(i).rot(-r).add(s);if(h&&o&&"middle"!==s.id){const e=Am.Angle(o,x),t=Xm(e,24)-e;x=Am.RotWith(x,o,t)}t.snaps.clearIndicators();let w={...s,x:x.x,y:x.y};if(s.canSnap&&(l?!u:u)){if(!t.getShapePageTransform(m.id))throw Error("Expected a page transform");const e=c.handles.snapHandle({currentShapeId:n,handle:w});e&&(e.nudge.rot(-t.getShapeParentTransform(m).rotation()),x.add(e.nudge),w={...s,x:x.x,y:x.y})}const v=null==(e=y.onHandleDrag)?void 0:e.call(y,m,{handle:w,isPrecise:this.isPrecise||p,initial:f}),b={id:m.id,type:m.type,...v};if("vertex"===s.type&&this.editor.isShapeOfType(m,"arrow")){const e=iC(t,m)[s.id];e?a[0]!==e.toId&&(t.setHintingShapes([e.toId]),this.pointingId=e.toId,this.isPrecise=g.len()<.5||p,this.isPreciseId=this.isPrecise?e.toId:null,this.resetExactTimeout()):a.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}v&&t.updateShapes([b])}}function Kj(e){return e.isLabel?[e]:e instanceof Xx?e.children.filter((e=>e.isLabel)):[]}b(Uj,"id","dragging_handle");class Hj extends rS{constructor(){super(...arguments),b(this,"hitShapeForPointerUp",null),b(this,"onEnter",(()=>{const e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,K_(this.editor),this.editor.select(e)})),b(this,"onExit",(()=>{var e;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),K_.cancel();const n=this.editor.getShape(t),i=this.editor.getShapeUtil(n);null==(e=i.onEditEnd)||e.call(i,n)})),b(this,"onPointerMove",(e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;if(this.hitShapeForPointerUp.isLocked)return;return this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),void(this.hitShapeForPointerUp=null)}switch(e.target){case"shape":case"canvas":return void K_(this.editor)}})),b(this,"onPointerDown",(e=>{switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{const t=Rj(this.editor,!0);if(t)return void this.onPointerDown({...e,shape:t,target:"shape"});break}case"shape":{const{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");const i=Kj(this.editor.getShapeUtil(t).getGeometry(t)),s=1===i.length?i[0]:void 0,r=this.editor.isShapeOfType(n,"text")&&""===n.props.text.trim();if(!s||r)return t.id!==n.id?void this.parent.transition("pointing_shape",e):void(this.editor.isShapeOfType(t,"frame")&&this.editor.setEditingShape(null));{const e=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(s.bounds.containsPoint(e,0)&&s.hitTestPoint(e))return t.id===n.id?void 0:(this.hitShapeForPointerUp=t,this.editor.mark("editing on pointer up"),void this.editor.select(t.id))}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)})),b(this,"onPointerUp",(e=>{const t=this.hitShapeForPointerUp;if(!t)return;this.hitShapeForPointerUp=null;const n=this.editor.getShapeUtil(t);t.isLocked||(!this.editor.getInstanceState().isReadonly||n.canEditInReadOnly(t)?(this.editor.select(t.id),this.editor.setEditingShape(t.id),K_(this.editor)):this.parent.transition("pointing_shape",e))})),b(this,"onComplete",(e=>{this.parent.transition("idle",e)})),b(this,"onCancel",(e=>{this.parent.transition("idle",e)}))}}function Vj(e){const t=e.getOnlySelectedShape();return!(!t||e.isShapeOrAncestorLocked(t)||!e.getShapeUtil(t).canCrop(t))}function Wj(e){const t=e.getSelectedShapeIds(),{shiftKey:n,altKey:i,currentPagePoint:s}=e.inputs,r=e.getShapeAtPoint(s,{hitInside:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(r){const s=e.getOutermostSelectableShape(r);if(n&&!i)e.cancelDoubleClick(),t.includes(s.id)?(e.mark("deselecting shape"),e.deselect(s)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,s.id]));else{let n;n=s===r||s.id===e.getFocusedGroupId()||t.includes(s.id)?r:s,n&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());const n=e.getFocusedGroupId();if(Qp(n)){const t=e.getShape(n);e.isPointInShape(t,s,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}b(Hj,"id","editing_shape");const Yj=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let Gj=(w=class extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{this.parent.setCurrentToolIdMask(void 0),K_(this.editor),this.editor.setCursor({type:"default",rotation:0})})),b(this,"onExit",(()=>{K_.cancel()})),b(this,"onPointerMove",(()=>{K_(this.editor)})),b(this,"onPointerDown",(e=>{if(this.editor.getIsMenuOpen())return;const t=e.ctrlKey&&Vj(this.editor);if(e.ctrlKey&&!t)return"shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)?void this.parent.transition("pointing_shape",e):void this.parent.transition("brushing",e);switch(e.target){case"canvas":{const t=Rj(this.editor);if(t&&!t.isLocked)return void this.onPointerDown({...e,shape:t,target:"shape"});const n=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((n.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&Jj(this.editor,s))return void this.onPointerDown({...e,target:"selection"});this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:t}=e;if(this.isOverArrowLabelTest(t)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("crop.pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{const t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked)return void this.onPointerDown({...e,shape:t,target:"shape"});this.parent.transition("pointing_selection",e)}}}})),b(this,"onDoubleClick",(e=>{var t,n,i,s;if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),i=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group"))return void Wj(this.editor);{const e=this.editor.getShape(n.parentId);if(e&&this.editor.isShapeOfType(e,"group")&&(!i||e.id!==i))return void Wj(this.editor)}return void this.onDoubleClick({...e,shape:n,target:"shape"})}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const n=this.editor.getOnlySelectedShape();if(n){const i=this.editor.getShapeUtil(n);if(!this.canInteractWithShapeInReadOnly(n))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){const e=null==(t=i.onDoubleClickEdge)?void 0:t.call(i,n);if(e)return this.editor.mark("double click edge"),this.editor.updateShapes([e]),void I_(this.editor,[n.id])}if(i.canCrop(n)&&!this.editor.isShapeOrAncestorLocked(n))return void this.parent.transition("crop",e);this.shouldStartEditingShape(n)&&this.startEditingShape(n,e,!0)}break}case"shape":{const{shape:t}=e,s=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getInstanceState().isReadonly)break;if(s.onDoubleClick){const r=null==(n=s.onDoubleClick)?void 0:n.call(s,t);if(r)return void this.editor.updateShapes([r]);if(s.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t))return this.editor.mark("select and crop"),this.editor.select(null==(i=e.shape)?void 0:i.id),void this.parent.transition("crop",e)}this.shouldStartEditingShape(t)?this.startEditingShape(t,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:t,handle:n}=e,i=this.editor.getShapeUtil(t),r=null==(s=i.onDoubleClickHandle)?void 0:s.call(i,t,n);r?this.editor.updateShapes([r]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}}})),b(this,"onRightClick",(e=>{switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(n)return void this.onRightClick({...e,shape:n,target:"shape"});const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:r}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&Jj(this.editor,r))return void this.onRightClick({...e,target:"selection"});this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,i=this.editor.getOutermostSelectableShape(n,(e=>!t.includes(e.id)));t.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}})),b(this,"onCancel",(()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())})),b(this,"onKeyDown",(e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":return void this.nudgeSelectedShapes(!1)}if(vy.editOnType.get()&&!Yj.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t))return void this.startEditingShape(t,{...e,target:"shape",shape:t},!0)}})),b(this,"onKeyRepeat",(e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}})),b(this,"onKeyUp",(e=>{switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every((e=>this.editor.isShapeOfType(e,"group"))))return void this.editor.setSelectedShapes(t.flatMap((e=>this.editor.getSortedChildIdsForParent(e.id))));const n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n))return void this.startEditingShape(n,{...e,target:"shape",shape:n},!0);Vj(this.editor)&&this.parent.transition("crop",e);break}}})),b(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!!e&&((!this.editor.isShapeOrAncestorLocked(e)||"embed"===e.type)&&(!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)))}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),E_(this.editor,e,n),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const n=this.editor.getShapeGeometry(e).children[1];if(n&&ny(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const t=eg(),{x:n,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:i,props:{text:"",autoSize:!0}}]);const s=this.editor.getShape(t);if(!s)return;const r=this.editor.getShapeUtil(s);this.editor.getInstanceState().isReadonly&&!r.canEditInReadOnly(s)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),i=new Am(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new Am(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:s}=this.editor.getDocumentSettings(),r=this.editor.getInstanceState().isGridMode?n?s*Zj:s:n?Xj:qj,o=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(o,i.mul(r)),I_(this.editor,o)}canInteractWithShapeInReadOnly(e){if(!this.editor.getInstanceState().isReadonly)return!0;return!!this.editor.getShapeUtil(e).canEditInReadOnly(e)}},b(w,"id","idle"),w);const Xj=10,qj=1,Zj=5;function Jj(e,t){const n=e.getSelectionRotatedPageBounds();if(!n)return!1;const i=e.getSelectionRotation();return i?ny(t,n.corners.map((e=>Am.RotWith(e,n.point,i)))):n.containsPoint(t)}class Qj extends rS{constructor(){super(...arguments),b(this,"shapeId",""),b(this,"markId",""),b(this,"wasAlreadySelected",!1),b(this,"didDrag",!1),b(this,"info",{}),b(this,"onEnter",(e=>{const{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===t.id,this.updateCursor();const n=this.editor.getShapeGeometry(t).children[1];if(!n)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);const{currentPagePoint:i}=this.editor.inputs,s=this.editor.getPointInShapeSpace(t,i);this._labelDragOffset=Am.Sub(n.center,s),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})})),b(this,"_labelDragOffset",new Am(0,0)),b(this,"onPointerMove",(()=>{const{isDragging:e}=this.editor.inputs;if(!e)return;const t=this.editor.getShape(this.shapeId);if(!t)return;const n=rC(this.editor,t),i=this.editor.getShapeGeometry(t),s=i.children[0],r=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),o=s.nearestPoint(Am.Add(r,this._labelDragOffset));let a;if(n.isStraight){const e=Am.Dist(n.start.point,n.end.point);a=1-Am.Dist(n.end.point,o)/e}else{const{_center:e,measure:t,angleEnd:n,angleStart:s}=i.children[0];a=ay(t,s,n,e.angle(o))}isNaN(a)&&(a=.5),this.didDrag=!0,this.editor.updateShape({id:t.id,type:t.type,props:{labelPosition:a}})})),b(this,"onPointerUp",(()=>{const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b(Qj,"id","pointing_arrow_label");class eE extends rS{constructor(){super(...arguments),b(this,"onEnter",(()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())})),b(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)})),b(this,"onPointerUp",(()=>{Wj(this.editor),this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onInterrupt",(()=>{this.parent.transition("idle")}))}complete(){this.parent.transition("idle")}}b(eE,"id","pointing_canvas");class tE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e;const{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){const n=iC(this.editor,t)[e.handle.id];n&&this.editor.setHintingShapes([n.toId])}this.editor.setCursor({type:"grabbing",rotation:0})})),b(this,"onExit",(()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})})),b(this,"onPointerUp",(()=>{const{shape:e,handle:t}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:n}=this,i=nE(n,e,t,!1);if(i)return void E_(n,i,!0)}this.parent.transition("idle",this.info)})),b(this,"onPointerMove",(()=>{const{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()})),b(this,"onLongPress",(()=>{this.startDraggingHandle()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}startDraggingHandle(){const{editor:e}=this;if(e.getInstanceState().isReadonly)return;const{shape:t,handle:n}=this.info;if(e.isShapeOfType(t,"note")){const i=nE(e,t,n,!0);if(i){const n=e.getPointInParentSpace(i,e.inputs.originPagePoint).sub(Am.Rot(D_.clone().mul(t.props.scale),i.rotation));return e.updateShape({...i,x:n.x,y:n.y}),void e.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{E_(e,i,!0)}})}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}function nE(e,t,n,i){const s=e.getShapePageTransform(t.id),r=s.point(),o=s.rotation(),a=L_(r,o,t.props.growY,0,t.props.scale)[n.index];if(a)return F_(e,t,a,o,i)}b(tE,"id","pointing_handle");class iE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})})),b(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.startRotating()})),b(this,"onLongPress",(()=>{this.startRotating()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}updateCursor(){this.editor.setCursor({type:Aj[this.info.handle],rotation:this.editor.getSelectionRotation()})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b(iE,"id","pointing_rotate_handle");class sE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e})),b(this,"onPointerUp",(e=>{Wj(this.editor),this.parent.transition("idle",e)})),b(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.startTranslating(e)})),b(this,"onLongPress",(e=>{this.startTranslating(e)})),b(this,"onDoubleClick",(e=>{var t,n;const i=this.editor.getHoveredShape(),s=i&&!this.editor.isShapeOfType(i,"group")?i:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(s)return this.parent.transition("idle"),void(null==(n=(t=this.parent).onDoubleClick)||n.call(t,{...e,target:"shape",shape:this.editor.getShape(s)}))})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}cancel(){this.parent.transition("idle")}}b(sE,"id","pointing_selection");class rE extends rS{constructor(){super(...arguments),b(this,"hitShape",{}),b(this,"hitShapeForPointerUp",{}),b(this,"isDoubleClick",!1),b(this,"didSelectOnEnter",!1),b(this,"onEnter",(e=>{const t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s,shiftKey:r,altKey:o}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;const a=this.editor.getOutermostSelectableShape(e.shape),l=this.editor.findShapeAncestor(a,(e=>t.includes(e.id)));if(this.editor.getShapeUtil(e.shape).onClick||a.id===i||t.includes(a.id)||l||t.length>1&&(null==n?void 0:n.containsPoint(s)))return this.didSelectOnEnter=!1,void(this.hitShapeForPointerUp=a);this.didSelectOnEnter=!0,r&&!o?(this.editor.cancelDoubleClick(),t.includes(a.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,a.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([a.id]))})),b(this,"onPointerUp",(e=>{var t;const n=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:r,shiftKey:o}}=this.editor,a=this.editor.getShapeAtPoint(r,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){const s=this.editor.getShapeUtil(l);if(s.onClick){const n=null==(t=s.onClick)?void 0:t.call(s,l);if(n)return this.editor.mark("shape on click"),this.editor.updateShapes([n]),void this.parent.transition("idle",e)}if(l.id===i)return n.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),void this.parent.transition("idle",e)}if(!this.didSelectOnEnter){const e=this.editor.getOutermostSelectableShape(a,(e=>!n.includes(e.id)));if(n.includes(e.id))if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(n.includes(l.id)){if(1===n.length){const e=Kj(this.editor.getShapeUtil(l).getGeometry(l)),t=1===e.length?e[0]:void 0;if(t){const e=this.editor.getPointInShapeSpace(l,r);if(t.bounds.containsPoint(e,0)&&t.hitTestPoint(e))return void this.editor.batch((()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);const e=this.editor.getShapeUtil(l);this.editor.getInstanceState().isReadonly&&!e.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))}))}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l);else if(o){const t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter((e=>!t.find((t=>t.id===e)))),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)})),b(this,"onDoubleClick",(()=>{this.isDoubleClick=!0})),b(this,"onPointerMove",(e=>{this.editor.inputs.isDragging&&this.startTranslating(e)})),b(this,"onLongPress",(e=>{this.startTranslating(e)})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.cancel()})),b(this,"onInterrupt",(()=>{this.cancel()}))}startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",e))}cancel(){this.parent.transition("idle")}}b(rE,"id","pointing_shape");class oE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"markId",""),b(this,"didHoldCommand",!1),b(this,"creationCursorOffset",{x:0,y:0}),b(this,"snapshot",{}),b(this,"onEnter",(e=>{const{isCreating:t=!1,creationCursorOffset:n={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=n,this.snapshot=this._createSnapshot(),t?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()})),b(this,"onTick",(({elapsed:e})=>{const{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)})),b(this,"onPointerMove",(()=>{this.updateShapes()})),b(this,"onKeyDown",(()=>{this.updateShapes()})),b(this,"onKeyUp",(()=>{this.updateShapes()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()})),b(this,"_createSnapshot",(()=>{const e=this.editor.getSelectedShapeIds(),t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,i=this.editor.getSelectionRotatedPageBounds(),s=Am.RotWith(i.getHandlePoint(this.info.handle),i.point,t),r=Am.Sub(n,s),o=new Map,a=[];e.forEach((t=>{const n=this.editor.getShape(t);if(n){if("frame"===n.type&&a.push({id:t,children:ud(this.editor.getSortedChildIdsForParent(n).map((e=>this.editor.getShape(e))))}),o.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,(e=>{const t=this.editor.getShape(e);if(t&&(o.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1}))}}));const l=![...o.values()].some((e=>!qm(e.pageRotation,t)||e.isAspectRatioLocked));return{shapeSnapshots:o,selectionBounds:i,cursorHandleOffset:r,selectionRotation:t,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:a}})),b(this,"_createShapeSnapshot",(e=>{const t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:Vx.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var e,t;I_(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate?null==(t=(e=this.info).onCreate)||t.call(e,this.editor.getOnlySelectedShape()):this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((({shape:e})=>{var n;const i=this.editor.getShapeUtil(e),s=null==(n=i.onResizeStart)?void 0:n.call(i,e);s&&t.push(s)})),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((({shape:e})=>{var n;const i=this.editor.getShape(e.id),s=this.editor.getShapeUtil(e),r=null==(n=s.onResizeEnd)?void 0:n.call(s,e,i);r&&t.push(r)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:i,selectionBounds:s,cursorHandleOffset:r,selectedShapeIds:o,selectionRotation:a,canShapesDeform:l}=this.snapshot;let c=t||!l;if(1===i.size){const e=[...i.values()][0];this.editor.isShapeOfType(e.shape,"text")&&(c=!("left"===this.info.handle||"right"===this.info.handle))}const{ctrlKey:d}=this.editor.inputs,h=this.editor.inputs.currentPagePoint.clone().sub(r).sub(this.creationCursorOffset),u=this.editor.inputs.originPagePoint.clone().sub(r);if(this.editor.getInstanceState().isGridMode&&!d){const{gridSize:e}=this.editor.getDocumentSettings();h.snapToGrid(e)}const p=this.info.handle,g=lE(p,Math.PI);this.editor.snaps.clearIndicators();if((this.editor.user.getIsSnapMode()?!d:d)&&a%zm==0){const{nudge:t}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:Am.Sub(h,u),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:lE(p,a),isAspectRatioLocked:c,isResizingFromCenter:e});h.add(t)}const f=Am.RotWith(e?s.center:s.getHandlePoint(g),s.point,a),m=Am.Sub(h,f).rot(-a),y=Am.Sub(u,f).rot(-a),x=Am.DivV(m,y);Number.isFinite(x.x)||(x.x=1),Number.isFinite(x.y)||(x.y=1);const w="top"===p||"bottom"===p,v="left"===p||"right"===p;c?v?x.y=Math.abs(x.x):w?x.x=Math.abs(x.y):Math.abs(x.x)>Math.abs(x.y)?x.y=Math.abs(x.x)*(x.y<0?-1:1):x.x=Math.abs(x.y)*(x.x<0?-1:1):(w&&(x.x=1),v&&(x.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:x.x<0,isFlippedY:x.y<0,rotation:a});for(const b of i.keys()){const e=i.get(b);this.editor.resizeShape(b,x,{initialShape:e.shape,initialBounds:e.bounds,initialPageTransform:e.pageTransform,dragHandle:p,mode:1===o.length&&b===o[0]?"resize_bounds":"scale_shape",scaleOrigin:f,isAspectRatioLocked:c,scaleAxisRotation:a,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:e,children:t}of n){if(!t.length)continue;const n=i.get(e).shape,s=this.editor.getShape(e);if(!n||!s)continue;const r=s.x-n.x,o=s.y-n.y,a=new Am(r,o).rot(-n.rotation);if(0!==a.x||0!==a.y)for(const e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:e}of n)if(e.length)for(const t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:i}){const s={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":s.type="nwse-resize",t!==n&&(s.type="nesw-resize");break;case"top_right":case"bottom_left":s.type="nesw-resize",t!==n&&(s.type="nwse-resize")}s.rotation=i,this.editor.setCursor(s)}}b(oE,"id","resizing");const aE=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function lE(e,t){t%=Fm;const n=Math.round(t/(Lm/4)),i=aE.indexOf(e);return aE[(i+n)%aE.length]}const cE=Math.PI/180;class dE extends rS{constructor(){super(...arguments),b(this,"snapshot",{}),b(this,"info",{}),b(this,"markId",""),b(this,"onEnter",(e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const t=ub({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t;const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pb({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Aj[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation})})),b(this,"onExit",(()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}})),b(this,"onPointerMove",(()=>{this.update()})),b(this,"onKeyDown",(()=>{this.update()})),b(this,"onKeyUp",(()=>{this.update()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"update",(()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pb({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Aj[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation})})),b(this,"cancel",(()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})),b(this,"complete",(()=>{pb({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),I_(this.editor,this.snapshot.shapeSnapshots.map((e=>e.shape.id))),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}))}_getRotationFromPointerPosition({snapToNearestDegree:e}){const t=this.editor.getSelectionRotation(),n=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:i,currentPagePoint:s}}=this.editor,{initialCursorAngle:r,initialSelectionRotation:o}=this.snapshot;if(!n)return o;let a=o+(n.center.clone().rotWith(n.point,t).angle(s)-r);if(i)a=Xm(a,24);else if(e&&(a=Math.round(a/cE)*cE,this.editor.getInstanceState().isCoarsePointer)){const e=Xm(a,4),t=Ym(a,e);Math.abs(t)<5*Lm/180&&(a=e)}return a-o}}b(dE,"id","rotating");class hE extends rS{constructor(){super(...arguments),b(this,"hits",new Set),b(this,"size",0),b(this,"scribbleId","id"),b(this,"initialSelectedShapeIds",new Set),b(this,"newlySelectedShapeIds",new Set),b(this,"onEnter",(()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})})),b(this,"onExit",(()=>{this.editor.scribbles.stop(this.scribbleId)})),b(this,"onPointerMove",(()=>{this.updateScribbleSelection(!0)})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onKeyDown",(()=>{this.updateScribbleSelection(!1)})),b(this,"onKeyUp",(()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"pushPointToScribble",(()=>{const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}))}updateScribbleSelection(e){const{editor:t}=this,n=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:i,originPagePoint:s,previousPagePoint:r,currentPagePoint:o}}=this.editor,{newlySelectedShapeIds:a,initialSelectedShapeIds:l}=this;e&&this.pushPointToScribble();const c=n;let d,h,u,p;for(let m=0,y=c.length;m<y;m++){if(d=c[m],t.isShapeOfType(d,"group")||a.has(d.id)||t.isShapeOrAncestorLocked(d))continue;if(h=t.getShapeGeometry(d),t.isShapeOfType(d,"frame")&&h.bounds.containsPoint(t.getPointInShapeSpace(d,s)))continue;const e=t.getShapePageTransform(d);if(!h||!e)continue;const n=e.clone().invert();u=n.applyToPoint(r),p=n.applyToPoint(o);const{bounds:i}=h;if(!(i.minX-0>Math.max(u.x,p.x)||i.minY-0>Math.max(u.y,p.y)||i.maxX+0<Math.min(u.x,p.x)||i.maxY+0<Math.min(u.y,p.y))&&h.hitTestLineSegment(u,p,0)){const e=this.editor.getOutermostSelectableShape(d),t=this.editor.getShapeMask(e.id);if(t){if(null!==Uv(r,o,t)){if(!ny(o,t))continue}}a.add(e.id)}}const g=t.getSelectedShapeIds(),f=new Set(i?[...a,...l]:[...a]);(g.length!==f.size||g.some((e=>!f.has(e))))&&this.editor.setSelectedShapes(Array.from(f))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}b(hE,"id","scribble_brushing");class uE{constructor(e){b(this,"prevDroppingShapeId",null),b(this,"droppingNodeTimer",null),b(this,"first",!0),b(this,"dispose",(()=>{this.clear()})),this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var n;this.first&&(this.editor.setHintingShapes(e.map((e=>this.editor.findShapeAncestor(e,(e=>"group"!==e.type)))).filter((e=>e))),this.prevDroppingShapeId=(null==(n=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))?void 0:n.id)??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,20,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=this.editor.timers.setTimeout((()=>{this.editor.batch((()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)})),this.droppingNodeTimer=null}),t)}handleDrag(e,t,n){var i,s,r,o,a;t=ud(t.map((e=>this.editor.getShape(e.id))));const l=(null==(i=this.editor.getDroppingOverShape(e,t))?void 0:i.id)??null;if(l===this.prevDroppingShapeId)return void this.hintParents(t);const{prevDroppingShapeId:c}=this,d=c&&this.editor.getShape(c),h=l&&this.editor.getShape(l);d&&(null==(r=(s=this.editor.getShapeUtil(d)).onDragShapesOut)||r.call(s,d,t)),h&&(null==(a=(o=this.editor.getShapeUtil(h)).onDragShapesOver)||a.call(o,h,t)),this.hintParents(t),null==n||n(),this.prevDroppingShapeId=l}hintParents(e){const t=new Map;for(const i of e){const e=this.editor.findShapeAncestor(i,(e=>"group"!==e.type));e&&(t.has(e.id)||t.set(e.id,[]),t.get(e.id).push(i.id))}const n=[];for(const[i,s]of t){const e=this.editor.getShape(i);e&&(j_(this.editor,e).length<s.length&&n.push(e.id))}this.editor.setHintingShapes(n)}dropShapes(e){var t,n;const{prevDroppingShapeId:i}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),i){const s=this.editor.getShape(i);if(!s)return;null==(n=(t=this.editor.getShapeUtil(s)).onDropShapesOver)||n.call(t,s,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class pE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"selectionSnapshot",{}),b(this,"snapshot",{}),b(this,"markId",""),b(this,"isCloning",!1),b(this,"isCreating",!1),b(this,"onCreate",(()=>{})),b(this,"dragAndDropManager",new uE(this.editor)),b(this,"onEnter",(e=>{var t;const{isCreating:n=!1,onCreate:i=()=>{}}=e;(null==(t=this.editor.getSelectedShapeIds())?void 0:t.length)?(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.onCreate=i,n?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=gE(this.editor),this.isCreating||!this.editor.inputs.altKey?(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()):this.startCloning()):this.parent.transition("idle")})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()})),b(this,"onTick",(({elapsed:e})=>{const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)})),b(this,"onPointerMove",(()=>{this.updateShapes()})),b(this,"onKeyDown",(()=>{!this.editor.inputs.altKey||this.isCloning?this.updateShapes():this.startCloning()})),b(this,"onKeyUp",(()=>{this.editor.inputs.altKey||!this.isCloning?this.updateShapes():this.stopCloning()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onComplete",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()})),b(this,"updateParentTransforms",(()=>{const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach((t=>{const n=e.getShape(t.shape.id);if(!n)return null;const i=zg(n.parentId)?null:Vx.Inverse(e.getShapePageTransform(n.parentId));t.parentTransform=i}))}))}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=gE(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),I_(this.editor,this.snapshot.movingShapes.map((e=>e.id))),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?null==(e=this.onCreate)||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach((e=>{var n;const i=this.editor.getShapeUtil(e),s=null==(n=i.onTranslateStart)?void 0:n.call(i,e);s&&t.push(s)})),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const t=Am.Average(e.map((e=>this.editor.getShapePageTransform(e.id).point()))),n=Am.Sub(t,this.selectionSnapshot.averagePagePoint);Am.IsNaN(n)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map((e=>e.id)),offset:{x:n.x,y:n.y}}})}const t=[];e.forEach((e=>{var n;const i=this.editor.getShape(e.id),s=this.editor.getShapeUtil(e),r=null==(n=s.onTranslateEnd)?void 0:n.call(s,e,i);r&&t.push(r)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function({editor:e,snapshot:t}){const{inputs:n}=e,{noteSnapshot:i,noteAdjacentPositions:s,initialPageBounds:r,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:l}=t,c=e.getInstanceState().isGridMode,d=e.getDocumentSettings().gridSize,h=Am.Sub(n.currentPagePoint,n.originPagePoint),u=e.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;"x"===u?h.x=0:"y"===u&&(h.y=0);e.snaps.clearIndicators();if((e.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey)&&e.inputs.pointerVelocity.len()<.5){const{nudge:t}=e.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:r,lockedAxis:u,initialSelectionSnapPoints:o});h.add(t)}else if(i&&s){const{scale:t}=i.shape.props,n=i.pagePoint.clone().add(h).add(D_.clone().mul(t).rot(i.pageRotation));let r=10/e.getZoomLevel(),o=new Am(0,0);for(const e of s){const t=Am.Sub(n,e),i=t.len();i<r&&(r=i,o=t)}h.sub(o)}const p=Am.Add(l,h);c&&!n.ctrlKey&&p.snapToGrid(d);const g=Am.Sub(p,l);e.updateShapes(ud(a.map((({shape:e,pagePoint:t,parentTransform:n})=>{const i=Am.Add(t,g),s=n?Vx.applyToPoint(n,i):i;return{id:e.id,type:e.type,x:s.x,y:s.y}}))))}({editor:this.editor,snapshot:e});const{movingShapes:t}=e,n=[];t.forEach((e=>{var t;const i=this.editor.getShape(e.id),s=this.editor.getShapeUtil(e),r=null==(t=s.onTranslate)?void 0:t.call(s,e,i);r&&n.push(r)})),n.length>0&&this.editor.updateShapes(n)}}function gE(e){var t;const n=[],i=[],s=ud(e.getSelectedShapeIds().map((t=>{const s=e.getShape(t);if(!s)return null;n.push(s);const r=e.getShapePageTransform(t),o=r.point(),a=r.rotation();i.push(o);return{shape:s,pagePoint:o,pageRotation:a,parentTransform:Lg.isId(s.parentId)?null:Vx.Inverse(e.getShapePageTransform(s.parentId))}}))),r=e.getOnlySelectedShape();let o,a,l=[];if(r)l=e.snaps.shapeBounds.getSnapPoints(r.id);else{const t=e.getSelectionPageBounds();t&&(l=t.cornersAndCenter.map(((e,t)=>({id:"selection:"+t,x:e.x,y:e.y}))))}const{originPagePoint:c}=e.inputs,d=s.filter((t=>e.isShapeOfType(t.shape,"note")&&e.isPointInShape(t.shape,c)));if(0===d.length);else if(1===d.length)a=d[0];else{const n=e.getCurrentPageShapesSorted();a=null==(t=d.map((e=>({snapshot:e,index:n.findIndex((t=>t.id===e.shape.id))}))).sort(((e,t)=>t.index-e.index))[0])?void 0:t.snapshot}return a&&(o=z_(e,a.pageRotation,a.shape.props.scale,a.shape.props.growY??0)),{averagePagePoint:Am.Average(i),movingShapes:n,shapeSnapshots:s,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:l,noteAdjacentPositions:o,noteSnapshot:a}}b(pE,"id","translating");class fE extends rS{constructor(){super(...arguments),b(this,"reactor"),b(this,"cleanUpDuplicateProps",(()=>{const e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;const n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every((e=>n.has(e)))||this.editor.updateInstanceState({duplicateProps:null})})),b(this,"onEnter",(()=>{this.reactor=cu("clean duplicate props",(()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}}))})),b(this,"onExit",(()=>{var e;null==(e=this.reactor)||e.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}))}}b(fE,"id","select"),b(fE,"initial","idle"),b(fE,"children",(()=>[Bj,Dj,Gj,eE,rE,pE,Mj,hE,Nj,sE,Oj,Hj,oE,dE,iE,Qj,tE,Uj]));class mE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e})),b(this,"onPointerDown",(()=>{this.parent.transition("pointing",this.info)}))}}b(mE,"id","idle");class yE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onPointerMove",(()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)})),b(this,"onCancel",(()=>{this.cancel()}))}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}b(yE,"id","pointing");class xE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"zoomBrush",new Ux),b(this,"onEnter",(e=>{this.info=e,this.update()})),b(this,"onExit",(()=>{this.editor.updateInstanceState({zoomBrush:null})})),b(this,"onPointerMove",(()=>{this.update()})),b(this,"onPointerUp",(()=>{this.complete()})),b(this,"onCancel",(()=>{this.cancel()}))}update(){const{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(Ux.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){const e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}})}else{const t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:t,animation:{duration:220}})}this.parent.transition("idle",this.info)}}b(xE,"id","zoom_brushing");class wE extends rS{constructor(){super(...arguments),b(this,"info",{}),b(this,"onEnter",(e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()})),b(this,"onExit",(()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)})),b(this,"onKeyDown",(()=>{this.updateCursor()})),b(this,"onKeyUp",(e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()})),b(this,"onInterrupt",(()=>{this.complete()}))}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}b(wE,"id","zoom"),b(wE,"initial","idle"),b(wE,"children",(()=>[mE,xE,yE]));const vE=[kj,Ij,Tj,wE,fE];function bE(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(null==e||e(i),!1===n||!i.defaultPrevented)return null==t?void 0:t(i)}}function SE(...e){return t=>e.forEach((e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t)))}function kE(...e){return C.useCallback(SE(...e),e)}function CE(e,t=[]){let n=[];const i=()=>{const t=n.map((e=>C.createContext(e)));return function(n){const i=(null==n?void 0:n[e])||t;return C.useMemo((()=>({[`__scope${e}`]:{...n,[e]:i}})),[n,i])}};return i.scopeName=e,[function(t,i){const s=C.createContext(i),r=n.length;function o(t){const{scope:n,children:i,...o}=t,a=(null==n?void 0:n[e][r])||s,l=C.useMemo((()=>o),Object.values(o));return k.jsx(a.Provider,{value:l,children:i})}return n=[...n,i],o.displayName=t+"Provider",[o,function(n,o){const a=(null==o?void 0:o[e][r])||s,l=C.useContext(a);if(l)return l;if(void 0!==i)return i;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},_E(i,...t)]}function _E(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const i=n.reduce(((t,{useScope:n,scopeName:i})=>({...t,...n(e)[`__scope${i}`]})),{});return C.useMemo((()=>({[`__scope${t.scopeName}`]:i})),[i])}};return n.scopeName=t.scopeName,n}var PE=Boolean(null==globalThis?void 0:globalThis.document)?C.useLayoutEffect:()=>{},IE=T["useId".toString()]||(()=>{}),jE=0;function EE(e){const[t,n]=C.useState(IE());return PE((()=>{e||n((e=>e??String(jE++)))}),[e]),e||(t?`radix-${t}`:"")}function TE(e){const t=C.useRef(e);return C.useEffect((()=>{t.current=e})),C.useMemo((()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)}),[])}function ME({prop:e,defaultProp:t,onChange:n=()=>{}}){const[i,s]=function({defaultProp:e,onChange:t}){const n=C.useState(e),[i]=n,s=C.useRef(i),r=TE(t);return C.useEffect((()=>{s.current!==i&&(r(i),s.current=i)}),[i,s,r]),n}({defaultProp:t,onChange:n}),r=void 0!==e,o=r?e:i,a=TE(n);return[o,C.useCallback((t=>{if(r){const n="function"==typeof t?t(e):t;n!==e&&a(n)}else s(t)}),[r,e,s,a])]}var AE=C.forwardRef(((e,t)=>{const{children:n,...i}=e,s=C.Children.toArray(n),r=s.find(RE);if(r){const e=r.props.children,n=s.map((t=>t===r?C.Children.count(e)>1?C.Children.only(null):C.isValidElement(e)?e.props.children:null:t));return k.jsx(OE,{...i,ref:t,children:C.isValidElement(e)?C.cloneElement(e,void 0,n):null})}return k.jsx(OE,{...i,ref:t,children:n})}));AE.displayName="Slot";var OE=C.forwardRef(((e,t)=>{const{children:n,...i}=e;if(C.isValidElement(n)){const e=function(e){var t,n;let i=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=i&&"isReactWarning"in i&&i.isReactWarning;if(s)return e.ref;if(i=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(n);return C.cloneElement(n,{...LE(i,n.props),ref:t?SE(t,e):e})}return C.Children.count(n)>1?C.Children.only(null):null}));OE.displayName="SlotClone";var DE=({children:e})=>k.jsx(k.Fragment,{children:e});function RE(e){return C.isValidElement(e)&&e.type===DE}function LE(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...e)=>{r(...e),s(...e)}:s&&(n[i]=s):"style"===i?n[i]={...s,...r}:"className"===i&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}var zE=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((e,t)=>{const n=C.forwardRef(((e,n)=>{const{asChild:i,...s}=e,r=i?AE:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),k.jsx(r,{...s,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{});function FE(e,t){e&&E.flushSync((()=>e.dispatchEvent(t)))}var NE,$E="dismissableLayer.update",BE="dismissableLayer.pointerDownOutside",UE="dismissableLayer.focusOutside",KE=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),HE=C.forwardRef(((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:r,onInteractOutside:o,onDismiss:a,...l}=e,c=C.useContext(KE),[d,h]=C.useState(null),u=(null==d?void 0:d.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,p]=C.useState({}),g=kE(t,(e=>h(e))),f=Array.from(c.layers),[m]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=f.indexOf(m),x=d?f.indexOf(d):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,v=x>=y,b=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=TE(e),i=C.useRef(!1),s=C.useRef((()=>{}));return C.useEffect((()=>{const e=e=>{if(e.target&&!i.current){let i=function(){YE(BE,n,r,{discrete:!0})};const r={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=i,t.addEventListener("click",s.current,{once:!0})):i()}else t.removeEventListener("click",s.current);i.current=!1},r=window.setTimeout((()=>{t.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(r),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}}),[t,n]),{onPointerDownCapture:()=>i.current=!0}}((e=>{const t=e.target,n=[...c.branches].some((e=>e.contains(t)));v&&!n&&(null==s||s(e),null==o||o(e),e.defaultPrevented||null==a||a())}),u),S=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=TE(e),i=C.useRef(!1);return C.useEffect((()=>{const e=e=>{if(e.target&&!i.current){YE(UE,n,{originalEvent:e},{discrete:!1})}};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)}),[t,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}((e=>{const t=e.target;[...c.branches].some((e=>e.contains(t)))||(null==r||r(e),null==o||o(e),e.defaultPrevented||null==a||a())}),u);return function(e,t=(null==globalThis?void 0:globalThis.document)){const n=TE(e);C.useEffect((()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})}),[n,t])}((e=>{x===c.layers.size-1&&(null==i||i(e),!e.defaultPrevented&&a&&(e.preventDefault(),a()))}),u),C.useEffect((()=>{if(d)return n&&(0===c.layersWithOutsidePointerEventsDisabled.size&&(NE=u.body.style.pointerEvents,u.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),WE(),()=>{n&&1===c.layersWithOutsidePointerEventsDisabled.size&&(u.body.style.pointerEvents=NE)}}),[d,u,n,c]),C.useEffect((()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),WE())}),[d,c]),C.useEffect((()=>{const e=()=>p({});return document.addEventListener($E,e),()=>document.removeEventListener($E,e)}),[]),k.jsx(zE.div,{...l,ref:g,style:{pointerEvents:w?v?"auto":"none":void 0,...e.style},onFocusCapture:bE(e.onFocusCapture,S.onFocusCapture),onBlurCapture:bE(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:bE(e.onPointerDownCapture,b.onPointerDownCapture)})}));HE.displayName="DismissableLayer";var VE=C.forwardRef(((e,t)=>{const n=C.useContext(KE),i=C.useRef(null),s=kE(t,i);return C.useEffect((()=>{const e=i.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}}),[n.branches]),k.jsx(zE.div,{...e,ref:s})}));function WE(){const e=new CustomEvent($E);document.dispatchEvent(e)}function YE(e,t,n,{discrete:i}){const s=n.originalEvent.target,r=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),i?FE(s,r):s.dispatchEvent(r)}VE.displayName="DismissableLayerBranch";var GE=HE,XE=VE,qE="focusScope.autoFocusOnMount",ZE="focusScope.autoFocusOnUnmount",JE={bubbles:!1,cancelable:!0},QE=C.forwardRef(((e,t)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:s,onUnmountAutoFocus:r,...o}=e,[a,l]=C.useState(null),c=TE(s),d=TE(r),h=C.useRef(null),u=kE(t,(e=>l(e))),p=C.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;C.useEffect((()=>{if(i){let e=function(e){if(p.paused||!a)return;const t=e.target;a.contains(t)?h.current=t:iT(h.current,{select:!0})},t=function(e){if(p.paused||!a)return;const t=e.relatedTarget;null!==t&&(a.contains(t)||iT(h.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&iT(a)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const i=new MutationObserver(n);return a&&i.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),i.disconnect()}}}),[i,a,p.paused]),C.useEffect((()=>{if(a){sT.add(p);const t=document.activeElement;if(!a.contains(t)){const n=new CustomEvent(qE,JE);a.addEventListener(qE,c),a.dispatchEvent(n),n.defaultPrevented||(!function(e,{select:t=!1}={}){const n=document.activeElement;for(const i of e)if(iT(i,{select:t}),document.activeElement!==n)return}((e=eT(a),e.filter((e=>"A"!==e.tagName))),{select:!0}),document.activeElement===t&&iT(a))}return()=>{a.removeEventListener(qE,c),setTimeout((()=>{const e=new CustomEvent(ZE,JE);a.addEventListener(ZE,d),a.dispatchEvent(e),e.defaultPrevented||iT(t??document.body,{select:!0}),a.removeEventListener(ZE,d),sT.remove(p)}),0)}}var e}),[a,c,d,p]);const g=C.useCallback((e=>{if(!n&&!i)return;if(p.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,s=document.activeElement;if(t&&s){const t=e.currentTarget,[i,r]=function(e){const t=eT(e),n=tT(t,e),i=tT(t.reverse(),e);return[n,i]}(t);i&&r?e.shiftKey||s!==r?e.shiftKey&&s===i&&(e.preventDefault(),n&&iT(r,{select:!0})):(e.preventDefault(),n&&iT(i,{select:!0})):s===t&&e.preventDefault()}}),[n,i,p.paused]);return k.jsx(zE.div,{tabIndex:-1,...o,ref:u,onKeyDown:g})}));function eT(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function tT(e,t){for(const n of e)if(!nT(n,{upTo:t}))return n}function nT(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function iT(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}QE.displayName="FocusScope";var sT=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=rT(e,t),e.unshift(t)},remove(t){var n;e=rT(e,t),null==(n=e[0])||n.resume()}}}();function rT(e,t){const n=[...e],i=n.indexOf(t);return-1!==i&&n.splice(i,1),n}var oT=C.forwardRef(((e,t)=>{var n;const{container:i,...s}=e,[r,o]=C.useState(!1);PE((()=>o(!0)),[]);const a=i||r&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return a?M.createPortal(k.jsx(zE.div,{...s,ref:t}),a):null}));oT.displayName="Portal";var aT=e=>{const{present:t,children:n}=e,i=function(e){const[t,n]=C.useState(),i=C.useRef({}),s=C.useRef(e),r=C.useRef("none"),o=e?"mounted":"unmounted",[a,l]=function(e,t){return C.useReducer(((e,n)=>t[e][n]??e),e)}(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect((()=>{const e=lT(i.current);r.current="mounted"===a?e:"none"}),[a]),PE((()=>{const t=i.current,n=s.current;if(n!==e){const i=r.current,o=lT(t);if(e)l("MOUNT");else if("none"===o||"none"===(null==t?void 0:t.display))l("UNMOUNT");else{l(n&&i!==o?"ANIMATION_OUT":"UNMOUNT")}s.current=e}}),[e,l]),PE((()=>{if(t){const e=e=>{const n=lT(i.current).includes(e.animationName);e.target===t&&n&&E.flushSync((()=>l("ANIMATION_END")))},n=e=>{e.target===t&&(r.current=lT(i.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}l("ANIMATION_END")}),[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:C.useCallback((e=>{e&&(i.current=getComputedStyle(e)),n(e)}),[])}}(t),s="function"==typeof n?n({present:i.isPresent}):C.Children.only(n),r=kE(i.ref,function(e){var t,n;let i=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=i&&"isReactWarning"in i&&i.isReactWarning;if(s)return e.ref;if(i=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,s=i&&"isReactWarning"in i&&i.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(s));return"function"==typeof n||i.isPresent?C.cloneElement(s,{ref:r}):null};function lT(e){return(null==e?void 0:e.animationName)||"none"}aT.displayName="Presence";var cT=0;function dT(){C.useEffect((()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??hT()),document.body.insertAdjacentElement("beforeend",e[1]??hT()),cT++,()=>{1===cT&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),cT--}}),[])}function hT(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var uT="right-scroll-bar-position",pT="width-before-scroll-bar";function gT(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var fT="undefined"!=typeof window?C.useLayoutEffect:C.useEffect,mT=new WeakMap;function yT(e,t){var n=function(e,t){var n=C.useState((function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(e){var t=n.value;t!==e&&(n.value=e,n.callback(e,t))}}}}))[0];return n.callback=t,n.facade}(null,(function(t){return e.forEach((function(e){return gT(e,t)}))}));return fT((function(){var t=mT.get(n);if(t){var i=new Set(t),s=new Set(e),r=n.current;i.forEach((function(e){s.has(e)||gT(e,null)})),s.forEach((function(e){i.has(e)||gT(e,r)}))}mT.set(n,e)}),[e]),n}function xT(e){return e}var wT=function(e){var t=e.sideCar,n=O(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return C.createElement(i,A({},n))};wT.isSideCarExport=!0;var vT=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=xT);var n=[],i=!1;return{read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var s=t(e,i);return n.push(s),function(){n=n.filter((function(e){return e!==s}))}},assignSyncMedium:function(e){for(i=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){i=!0;var t=[];if(n.length){var s=n;n=[],s.forEach(e),t=n}var r=function(){var n=t;t=[],n.forEach(e)},o=function(){return Promise.resolve().then(r)};o(),n={push:function(e){t.push(e),o()},filter:function(e){return t=t.filter(e),n}}}}}(null);return t.options=A({async:!0,ssr:!1},e),t}(),bT=function(){},ST=C.forwardRef((function(e,t){var n=C.useRef(null),i=C.useState({onScrollCapture:bT,onWheelCapture:bT,onTouchMoveCapture:bT}),s=i[0],r=i[1],o=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,d=e.enabled,h=e.shards,u=e.sideCar,p=e.noIsolation,g=e.inert,f=e.allowPinchZoom,m=e.as,y=void 0===m?"div":m,x=e.gapMode,w=O(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),v=u,b=yT([n,t]),S=A(A({},w),s);return C.createElement(C.Fragment,null,d&&C.createElement(v,{sideCar:vT,removeScrollBar:c,shards:h,noIsolation:p,inert:g,setCallbacks:r,allowPinchZoom:!!f,lockRef:n,gapMode:x}),o?C.cloneElement(C.Children.only(a),A(A({},S),{ref:b})):C.createElement(y,A({},S,{className:l,ref:b}),a))}));ST.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},ST.classNames={fullWidth:pT,zeroRight:uT};function kT(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=function(){if("undefined"!=typeof __webpack_nonce__)return __webpack_nonce__}();return t&&e.setAttribute("nonce",t),e}var CT=function(){var e=0,t=null;return{add:function(n){var i,s;0==e&&(t=kT())&&(s=n,(i=t).styleSheet?i.styleSheet.cssText=s:i.appendChild(document.createTextNode(s)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},_T=function(){var e,t=(e=CT(),function(t,n){C.useEffect((function(){return e.add(t),function(){e.remove()}}),[t&&n])});return function(e){var n=e.styles,i=e.dynamic;return t(n,i),null}},PT={left:0,top:0,right:0,gap:0},IT=function(e){return parseInt(e||"",10)||0},jT=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return PT;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],i=t["padding"===e?"paddingTop":"marginTop"],s=t["padding"===e?"paddingRight":"marginRight"];return[IT(n),IT(i),IT(s)]}(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-n+t[2]-t[0])}},ET=_T(),TT="data-scroll-locked",MT=function(e,t,n,i){var s=e.left,r=e.top,o=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(i,";\n   padding-right: ").concat(a,"px ").concat(i,";\n  }\n  body[").concat(TT,"] {\n    overflow: hidden ").concat(i,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(i,";"),"margin"===n&&"\n    padding-left: ".concat(s,"px;\n    padding-top: ").concat(r,"px;\n    padding-right: ").concat(o,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(i,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(uT," {\n    right: ").concat(a,"px ").concat(i,";\n  }\n  \n  .").concat(pT," {\n    margin-right: ").concat(a,"px ").concat(i,";\n  }\n  \n  .").concat(uT," .").concat(uT," {\n    right: 0 ").concat(i,";\n  }\n  \n  .").concat(pT," .").concat(pT," {\n    margin-right: 0 ").concat(i,";\n  }\n  \n  body[").concat(TT,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},AT=function(){var e=parseInt(document.body.getAttribute(TT)||"0",10);return isFinite(e)?e:0},OT=function(e){var t=e.noRelative,n=e.noImportant,i=e.gapMode,s=void 0===i?"margin":i;C.useEffect((function(){return document.body.setAttribute(TT,(AT()+1).toString()),function(){var e=AT()-1;e<=0?document.body.removeAttribute(TT):document.body.setAttribute(TT,e.toString())}}),[]);var r=C.useMemo((function(){return jT(s)}),[s]);return C.createElement(ET,{styles:MT(r,!t,s,n?"":"!important")})},DT=!1;if("undefined"!=typeof window)try{var RT=Object.defineProperty({},"passive",{get:function(){return DT=!0,!0}});window.addEventListener("test",RT,RT),window.removeEventListener("test",RT,RT)}catch(BX){DT=!1}var LT=!!DT&&{passive:!1},zT=function(e,t){var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},FT=function(e,t){var n=t.ownerDocument,i=t;do{if("undefined"!=typeof ShadowRoot&&i instanceof ShadowRoot&&(i=i.host),NT(e,i)){var s=$T(e,i);if(s[1]>s[2])return!0}i=i.parentNode}while(i&&i!==n.body);return!1},NT=function(e,t){return"v"===e?function(e){return zT(e,"overflowY")}(t):function(e){return zT(e,"overflowX")}(t)},$T=function(e,t){return"v"===e?function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]}(t):function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t)},BT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},UT=function(e){return[e.deltaX,e.deltaY]},KT=function(e){return e&&"current"in e?e.current:e},HT=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},VT=0,WT=[];function YT(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const GT=(XT=function(e){var t=C.useRef([]),n=C.useRef([0,0]),i=C.useRef(),s=C.useState(VT++)[0],r=C.useState(_T)[0],o=C.useRef(e);C.useEffect((function(){o.current=e}),[e]),C.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var t=D([e.lockRef.current],(e.shards||[]).map(KT),!0).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(s))})),function(){document.body.classList.remove("block-interactivity-".concat(s)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(s))}))}}}),[e.inert,e.lockRef.current,e.shards]);var a=C.useCallback((function(e,t){if("touches"in e&&2===e.touches.length)return!o.current.allowPinchZoom;var s,r=BT(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-r[0],c="deltaY"in e?e.deltaY:a[1]-r[1],d=e.target,h=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===h&&"range"===d.type)return!1;var u=FT(h,d);if(!u)return!0;if(u?s=h:(s="v"===h?"h":"v",u=FT(h,d)),!u)return!1;if(!i.current&&"changedTouches"in e&&(l||c)&&(i.current=s),!s)return!0;var p=i.current||s;return function(e,t,n,i,s){var r=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),o=r*i,a=n.target,l=t.contains(a),c=!1,d=o>0,h=0,u=0;do{var p=$T(e,a),g=p[0],f=p[1]-p[2]-r*g;(g||f)&&NT(e,a)&&(h+=f,u+=g),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return d&&(Math.abs(h)<1||!s)?c=!0:d||!(Math.abs(u)<1)&&s||(c=!0),c}(p,t,e,"h"===p?l:c,!0)}),[]),l=C.useCallback((function(e){var n=e;if(WT.length&&WT[WT.length-1]===r){var i="deltaY"in n?UT(n):BT(n),s=t.current.filter((function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&(t=e.delta,s=i,t[0]===s[0]&&t[1]===s[1]);var t,s}))[0];if(s&&s.should)n.cancelable&&n.preventDefault();else if(!s){var l=(o.current.shards||[]).map(KT).filter(Boolean).filter((function(e){return e.contains(n.target)}));(l.length>0?a(n,l[0]):!o.current.noIsolation)&&n.cancelable&&n.preventDefault()}}}),[]),c=C.useCallback((function(e,n,i,s){var r={name:e,delta:n,target:i,should:s,shadowParent:YT(i)};t.current.push(r),setTimeout((function(){t.current=t.current.filter((function(e){return e!==r}))}),1)}),[]),d=C.useCallback((function(e){n.current=BT(e),i.current=void 0}),[]),h=C.useCallback((function(t){c(t.type,UT(t),t.target,a(t,e.lockRef.current))}),[]),u=C.useCallback((function(t){c(t.type,BT(t),t.target,a(t,e.lockRef.current))}),[]);C.useEffect((function(){return WT.push(r),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:u}),document.addEventListener("wheel",l,LT),document.addEventListener("touchmove",l,LT),document.addEventListener("touchstart",d,LT),function(){WT=WT.filter((function(e){return e!==r})),document.removeEventListener("wheel",l,LT),document.removeEventListener("touchmove",l,LT),document.removeEventListener("touchstart",d,LT)}}),[]);var p=e.removeScrollBar,g=e.inert;return C.createElement(C.Fragment,null,g?C.createElement(r,{styles:HT(s)}):null,p?C.createElement(OT,{gapMode:e.gapMode}):null)},vT.useMedium(XT),wT);var XT,qT=C.forwardRef((function(e,t){return C.createElement(ST,A({},e,{ref:t,sideCar:GT}))}));qT.classNames=ST.classNames;var ZT=new WeakMap,JT=new WeakMap,QT={},eM=0,tM=function(e){return e&&(e.host||tM(e.parentNode))},nM=function(e,t,n,i){var s=function(e,t){return t.map((function(t){if(e.contains(t))return t;var n=tM(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return Boolean(e)}))}(t,Array.isArray(e)?e:[e]);QT[n]||(QT[n]=new WeakMap);var r=QT[n],o=[],a=new Set,l=new Set(s),c=function(e){e&&!a.has(e)&&(a.add(e),c(e.parentNode))};s.forEach(c);var d=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))d(e);else try{var t=e.getAttribute(i),s=null!==t&&"false"!==t,l=(ZT.get(e)||0)+1,c=(r.get(e)||0)+1;ZT.set(e,l),r.set(e,c),o.push(e),1===l&&s&&JT.set(e,!0),1===c&&e.setAttribute(n,"true"),s||e.setAttribute(i,"true")}catch(h){console.error("aria-hidden: cannot operate on ",e,h)}}))};return d(t),a.clear(),eM++,function(){o.forEach((function(e){var t=ZT.get(e)-1,s=r.get(e)-1;ZT.set(e,t),r.set(e,s),t||(JT.has(e)||e.removeAttribute(i),JT.delete(e)),s||e.removeAttribute(n)})),--eM||(ZT=new WeakMap,ZT=new WeakMap,JT=new WeakMap,QT={})}},iM=function(e,t,n){void 0===n&&(n="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),s=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live]"))),nM(i,s,n,"aria-hidden")):function(){return null}},sM="Dialog",[rM,oM]=CE(sM),[aM,lM]=rM(sM),cM=e=>{const{__scopeDialog:t,children:n,open:i,defaultOpen:s,onOpenChange:r,modal:o=!0}=e,a=C.useRef(null),l=C.useRef(null),[c=!1,d]=ME({prop:i,defaultProp:s,onChange:r});return k.jsx(aM,{scope:t,triggerRef:a,contentRef:l,contentId:EE(),titleId:EE(),descriptionId:EE(),open:c,onOpenChange:d,onOpenToggle:C.useCallback((()=>d((e=>!e))),[d]),modal:o,children:n})};cM.displayName=sM;var dM="DialogTrigger";C.forwardRef(((e,t)=>{const{__scopeDialog:n,...i}=e,s=lM(dM,n),r=kE(t,s.triggerRef);return k.jsx(zE.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":jM(s.open),...i,ref:r,onClick:bE(e.onClick,s.onOpenToggle)})})).displayName=dM;var hM="DialogPortal",[uM,pM]=rM(hM,{forceMount:void 0}),gM=e=>{const{__scopeDialog:t,forceMount:n,children:i,container:s}=e,r=lM(hM,t);return k.jsx(uM,{scope:t,forceMount:n,children:C.Children.map(i,(e=>k.jsx(aT,{present:n||r.open,children:k.jsx(oT,{asChild:!0,container:s,children:e})})))})};gM.displayName=hM;var fM="DialogOverlay",mM=C.forwardRef(((e,t)=>{const n=pM(fM,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=lM(fM,e.__scopeDialog);return r.modal?k.jsx(aT,{present:i||r.open,children:k.jsx(yM,{...s,ref:t})}):null}));mM.displayName=fM;var yM=C.forwardRef(((e,t)=>{const{__scopeDialog:n,...i}=e,s=lM(fM,n);return k.jsx(qT,{as:AE,allowPinchZoom:!0,shards:[s.contentRef],children:k.jsx(zE.div,{"data-state":jM(s.open),...i,ref:t,style:{pointerEvents:"auto",...i.style}})})})),xM="DialogContent",wM=C.forwardRef(((e,t)=>{const n=pM(xM,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=lM(xM,e.__scopeDialog);return k.jsx(aT,{present:i||r.open,children:r.modal?k.jsx(vM,{...s,ref:t}):k.jsx(bM,{...s,ref:t})})}));wM.displayName=xM;var vM=C.forwardRef(((e,t)=>{const n=lM(xM,e.__scopeDialog),i=C.useRef(null),s=kE(t,n.contentRef,i);return C.useEffect((()=>{const e=i.current;if(e)return iM(e)}),[]),k.jsx(SM,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:bE(e.onCloseAutoFocus,(e=>{var t;e.preventDefault(),null==(t=n.triggerRef.current)||t.focus()})),onPointerDownOutside:bE(e.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()})),onFocusOutside:bE(e.onFocusOutside,(e=>e.preventDefault()))})})),bM=C.forwardRef(((e,t)=>{const n=lM(xM,e.__scopeDialog),i=C.useRef(!1),s=C.useRef(!1);return k.jsx(SM,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var r,o;null==(r=e.onCloseAutoFocus)||r.call(e,t),t.defaultPrevented||(i.current||null==(o=n.triggerRef.current)||o.focus(),t.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:t=>{var r,o;null==(r=e.onInteractOutside)||r.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));const a=t.target;(null==(o=n.triggerRef.current)?void 0:o.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})})),SM=C.forwardRef(((e,t)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:r,...o}=e,a=lM(xM,n),l=C.useRef(null),c=kE(t,l);return dT(),k.jsxs(k.Fragment,{children:[k.jsx(QE,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:r,children:k.jsx(HE,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":jM(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),k.jsxs(k.Fragment,{children:[k.jsx(AM,{titleId:a.titleId}),k.jsx(OM,{contentRef:l,descriptionId:a.descriptionId})]})]})})),kM="DialogTitle",CM=C.forwardRef(((e,t)=>{const{__scopeDialog:n,...i}=e,s=lM(kM,n);return k.jsx(zE.h2,{id:s.titleId,...i,ref:t})}));CM.displayName=kM;var _M="DialogDescription";C.forwardRef(((e,t)=>{const{__scopeDialog:n,...i}=e,s=lM(_M,n);return k.jsx(zE.p,{id:s.descriptionId,...i,ref:t})})).displayName=_M;var PM="DialogClose",IM=C.forwardRef(((e,t)=>{const{__scopeDialog:n,...i}=e,s=lM(PM,n);return k.jsx(zE.button,{type:"button",...i,ref:t,onClick:bE(e.onClick,(()=>s.onOpenChange(!1)))})}));function jM(e){return e?"open":"closed"}IM.displayName=PM;var EM="DialogTitleWarning",[TM,MM]=function(e,t){const n=C.createContext(t);function i(e){const{children:t,...i}=e,s=C.useMemo((()=>i),Object.values(i));return k.jsx(n.Provider,{value:s,children:t})}return i.displayName=e+"Provider",[i,function(i){const s=C.useContext(n);if(s)return s;if(void 0!==t)return t;throw new Error(`\`${i}\` must be used within \`${e}\``)}]}(EM,{contentName:xM,titleName:kM,docsSlug:"dialog"}),AM=({titleId:e})=>{const t=MM(EM),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return C.useEffect((()=>{if(e){document.getElementById(e)||console.error(n)}}),[n,e]),null},OM=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${MM("DialogDescriptionWarning").contentName}}.`;return C.useEffect((()=>{var i;const s=null==(i=e.current)?void 0:i.getAttribute("aria-describedby");if(t&&s){document.getElementById(t)||console.warn(n)}}),[n,e,t]),null},DM=cM,RM=gM,LM=mM,zM=wM;const FM=()=>{},NM=C.createContext(null);function $M({onEvent:e,children:t}){return k.jsx(NM.Provider,{value:e??FM,children:t})}function BM(){return C.useContext(NM)??FM}const UM=C.createContext(null);function KM({children:e}){const t=jm(),n=BM(),[i,s]=C.useState([]),r=C.useCallback((e=>{const i=e.id??sv();return s((t=>[...t.filter((t=>t.id!==e.id)),{...e,id:i}])),n("open-menu",{source:"dialog",id:i}),t.addOpenMenu(i),i}),[t,n]),o=C.useCallback(((e,i)=>(s((t=>t.map((t=>t.id===e?{...t,...i}:t)))),n("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e)),[t,n]),a=C.useCallback((e=>(s((t=>t.filter((t=>{var n;return t.id!==e||(null==(n=t.onClose)||n.call(t),!1)})))),n("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e)),[t,n]),l=C.useCallback((()=>{s((e=>(e.forEach((e=>{var i;null==(i=e.onClose)||i.call(e),n("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)})),[])))}),[t,n]);return k.jsx(UM.Provider,{value:{dialogs:i,addDialog:r,removeDialog:a,clearDialogs:l,updateDialog:o},children:e})}function HM(){const e=C.useContext(UM);if(!e)throw new Error("useDialogs must be used within a DialogsProvider");return e}const VM=({id:e,component:t,onClose:n})=>{const{removeDialog:i}=HM(),s=Ay(),r=C.useCallback((t=>{if(!t){if(n)try{n()}catch(BX){console.warn(BX)}i(e)}}),[e,n,i]);return k.jsx(DM,{onOpenChange:r,defaultOpen:!0,children:k.jsx(RM,{container:s,children:k.jsx(LM,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&r(!1)},children:k.jsx(zM,{dir:"ltr",className:"tlui-dialog__content",children:k.jsx(t,{onClose:()=>r(!1)})})})})})};const WM=P.memo((function(){const{dialogs:e}=HM();return k.jsx(k.Fragment,{children:e.map((e=>k.jsx(VM,{...e},e.id)))})}));function YM(){const e=jm(),t=Ru("follow",(()=>e.getInstanceState().followingUserId),[e]);return t?k.jsx(GM,{userId:t}):null}function GM({userId:e}){const t=ew(e);return t?k.jsx("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function XM(e){const t=e+"CollectionProvider",[n,i]=CE(t),[s,r]=n(t,{collectionRef:{current:null},itemMap:new Map}),o=e=>{const{scope:t,children:n}=e,i=P.useRef(null),r=P.useRef(new Map).current;return k.jsx(s,{scope:t,itemMap:r,collectionRef:i,children:n})};o.displayName=t;const a=e+"CollectionSlot",l=P.forwardRef(((e,t)=>{const{scope:n,children:i}=e,s=kE(t,r(a,n).collectionRef);return k.jsx(AE,{ref:s,children:i})}));l.displayName=a;const c=e+"CollectionItemSlot",d="data-radix-collection-item",h=P.forwardRef(((e,t)=>{const{scope:n,children:i,...s}=e,o=P.useRef(null),a=kE(t,o),l=r(c,n);return P.useEffect((()=>(l.itemMap.set(o,{ref:o,...s}),()=>{l.itemMap.delete(o)}))),k.jsx(AE,{[d]:"",ref:a,children:i})}));return h.displayName=c,[{Provider:o,Slot:l,ItemSlot:h},function(t){const n=r(e+"CollectionConsumer",t);return P.useCallback((()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${d}]`));return Array.from(n.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[n.collectionRef,n.itemMap])},i]}var qM=C.forwardRef(((e,t)=>k.jsx(zE.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}})));qM.displayName="VisuallyHidden";var ZM="ToastProvider",[JM,QM,eA]=XM("Toast"),[tA,nA]=CE("Toast",[eA]),[iA,sA]=tA(ZM),rA=e=>{const{__scopeToast:t,label:n="Notification",duration:i=5e3,swipeDirection:s="right",swipeThreshold:r=50,children:o}=e,[a,l]=C.useState(null),[c,d]=C.useState(0),h=C.useRef(!1),u=C.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${ZM}\`. Expected non-empty \`string\`.`),k.jsx(JM.Provider,{scope:t,children:k.jsx(iA,{scope:t,label:n,duration:i,swipeDirection:s,swipeThreshold:r,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:C.useCallback((()=>d((e=>e+1))),[]),onToastRemove:C.useCallback((()=>d((e=>e-1))),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:u,children:o})})};rA.displayName=ZM;var oA="ToastViewport",aA=["F8"],lA="toast.viewportPause",cA="toast.viewportResume",dA=C.forwardRef(((e,t)=>{const{__scopeToast:n,hotkey:i=aA,label:s="Notifications ({hotkey})",...r}=e,o=sA(oA,n),a=QM(n),l=C.useRef(null),c=C.useRef(null),d=C.useRef(null),h=C.useRef(null),u=kE(t,h,o.onViewportChange),p=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=o.toastCount>0;C.useEffect((()=>{const e=e=>{var t;i.every((t=>e[t]||e.code===t))&&(null==(t=h.current)||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[i]),C.useEffect((()=>{const e=l.current,t=h.current;if(g&&e&&t){const n=()=>{if(!o.isClosePausedRef.current){const e=new CustomEvent(lA);t.dispatchEvent(e),o.isClosePausedRef.current=!0}},i=()=>{if(o.isClosePausedRef.current){const e=new CustomEvent(cA);t.dispatchEvent(e),o.isClosePausedRef.current=!1}},s=t=>{!e.contains(t.relatedTarget)&&i()},r=()=>{e.contains(document.activeElement)||i()};return e.addEventListener("focusin",n),e.addEventListener("focusout",s),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",r),window.addEventListener("blur",n),window.addEventListener("focus",i),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",s),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",r),window.removeEventListener("blur",n),window.removeEventListener("focus",i)}}}),[g,o.isClosePausedRef]);const f=C.useCallback((({tabbingDirection:e})=>{const t=a().map((t=>{const n=t.ref.current,i=[n,...EA(n)];return"forwards"===e?i:i.reverse()}));return("forwards"===e?t.reverse():t).flat()}),[a]);return C.useEffect((()=>{const e=h.current;if(e){const t=t=>{var n,i,s;const r=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!r){const r=document.activeElement,o=t.shiftKey;if(t.target===e&&o)return void(null==(n=c.current)||n.focus());const a=f({tabbingDirection:o?"backwards":"forwards"}),l=a.findIndex((e=>e===r));TA(a.slice(l+1))?t.preventDefault():o?null==(i=c.current)||i.focus():null==(s=d.current)||s.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}}),[a,f]),k.jsxs(XE,{ref:l,role:"region","aria-label":s.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&k.jsx(uA,{ref:c,onFocusFromOutsideViewport:()=>{TA(f({tabbingDirection:"forwards"}))}}),k.jsx(JM.Slot,{scope:n,children:k.jsx(zE.ol,{tabIndex:-1,...r,ref:u})}),g&&k.jsx(uA,{ref:d,onFocusFromOutsideViewport:()=>{TA(f({tabbingDirection:"backwards"}))}})]})}));dA.displayName=oA;var hA="ToastFocusProxy",uA=C.forwardRef(((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:i,...s}=e,r=sA(hA,n);return k.jsx(qM,{"aria-hidden":!0,tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:e=>{var t;const n=e.relatedTarget;!(null==(t=r.viewport)?void 0:t.contains(n))&&i()}})}));uA.displayName=hA;var pA="Toast",gA=C.forwardRef(((e,t)=>{const{forceMount:n,open:i,defaultOpen:s,onOpenChange:r,...o}=e,[a=!0,l]=ME({prop:i,defaultProp:s,onChange:r});return k.jsx(aT,{present:n||a,children:k.jsx(yA,{open:a,...o,ref:t,onClose:()=>l(!1),onPause:TE(e.onPause),onResume:TE(e.onResume),onSwipeStart:bE(e.onSwipeStart,(e=>{e.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:bE(e.onSwipeMove,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)})),onSwipeCancel:bE(e.onSwipeCancel,(e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:bE(e.onSwipeEnd,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),l(!1)}))})})}));gA.displayName=pA;var[fA,mA]=tA(pA,{onClose(){}}),yA=C.forwardRef(((e,t)=>{const{__scopeToast:n,type:i="foreground",duration:s,open:r,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:u,onSwipeEnd:p,...g}=e,f=sA(pA,n),[m,y]=C.useState(null),x=kE(t,(e=>y(e))),w=C.useRef(null),v=C.useRef(null),b=s||f.duration,S=C.useRef(0),_=C.useRef(b),P=C.useRef(0),{onToastAdd:I,onToastRemove:j}=f,T=TE((()=>{var e;(null==m?void 0:m.contains(document.activeElement))&&(null==(e=f.viewport)||e.focus()),o()})),M=C.useCallback((e=>{e&&e!==1/0&&(window.clearTimeout(P.current),S.current=(new Date).getTime(),P.current=window.setTimeout(T,e))}),[T]);C.useEffect((()=>{const e=f.viewport;if(e){const t=()=>{M(_.current),null==c||c()},n=()=>{const e=(new Date).getTime()-S.current;_.current=_.current-e,window.clearTimeout(P.current),null==l||l()};return e.addEventListener(lA,n),e.addEventListener(cA,t),()=>{e.removeEventListener(lA,n),e.removeEventListener(cA,t)}}}),[f.viewport,b,l,c,M]),C.useEffect((()=>{r&&!f.isClosePausedRef.current&&M(b)}),[r,b,f.isClosePausedRef,M]),C.useEffect((()=>(I(),()=>j())),[I,j]);const A=C.useMemo((()=>m?PA(m):null),[m]);return f.viewport?k.jsxs(k.Fragment,{children:[A&&k.jsx(xA,{__scopeToast:n,role:"status","aria-live":"foreground"===i?"assertive":"polite","aria-atomic":!0,children:A}),k.jsx(fA,{scope:n,onClose:T,children:E.createPortal(k.jsx(JM.ItemSlot,{scope:n,children:k.jsx(GE,{asChild:!0,onEscapeKeyDown:bE(a,(()=>{f.isFocusedToastEscapeKeyDownRef.current||T(),f.isFocusedToastEscapeKeyDownRef.current=!1})),children:k.jsx(zE.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":r?"open":"closed","data-swipe-direction":f.swipeDirection,...g,ref:x,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:bE(e.onKeyDown,(e=>{"Escape"===e.key&&(null==a||a(e.nativeEvent),e.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,T()))})),onPointerDown:bE(e.onPointerDown,(e=>{0===e.button&&(w.current={x:e.clientX,y:e.clientY})})),onPointerMove:bE(e.onPointerMove,(e=>{if(!w.current)return;const t=e.clientX-w.current.x,n=e.clientY-w.current.y,i=Boolean(v.current),s=["left","right"].includes(f.swipeDirection),r=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,o=s?r(0,t):0,a=s?0:r(0,n),l="touch"===e.pointerType?10:2,c={x:o,y:a},u={originalEvent:e,delta:c};i?(v.current=c,IA("toast.swipeMove",h,u,{discrete:!1})):jA(c,f.swipeDirection,l)?(v.current=c,IA("toast.swipeStart",d,u,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(w.current=null)})),onPointerUp:bE(e.onPointerUp,(e=>{const t=v.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),v.current=null,w.current=null,t){const n=e.currentTarget,i={originalEvent:e,delta:t};jA(t,f.swipeDirection,f.swipeThreshold)?IA("toast.swipeEnd",p,i,{discrete:!0}):IA("toast.swipeCancel",u,i,{discrete:!0}),n.addEventListener("click",(e=>e.preventDefault()),{once:!0})}}))})})}),f.viewport)})]}):null})),xA=e=>{const{__scopeToast:t,children:n,...i}=e,s=sA(pA,t),[r,o]=C.useState(!1),[a,l]=C.useState(!1);return function(e=()=>{}){const t=TE(e);PE((()=>{let e=0,n=0;return e=window.requestAnimationFrame((()=>n=window.requestAnimationFrame(t))),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}}),[t])}((()=>o(!0))),C.useEffect((()=>{const e=window.setTimeout((()=>l(!0)),1e3);return()=>window.clearTimeout(e)}),[]),a?null:k.jsx(oT,{asChild:!0,children:k.jsx(qM,{...i,children:r&&k.jsxs(k.Fragment,{children:[s.label," ",n]})})})},wA=C.forwardRef(((e,t)=>{const{__scopeToast:n,...i}=e;return k.jsx(zE.div,{...i,ref:t})}));wA.displayName="ToastTitle";var vA=C.forwardRef(((e,t)=>{const{__scopeToast:n,...i}=e;return k.jsx(zE.div,{...i,ref:t})}));vA.displayName="ToastDescription";var bA="ToastAction",SA=C.forwardRef(((e,t)=>{const{altText:n,...i}=e;return n.trim()?k.jsx(_A,{altText:n,asChild:!0,children:k.jsx(CA,{...i,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${bA}\`. Expected non-empty \`string\`.`),null)}));SA.displayName=bA;var kA="ToastClose",CA=C.forwardRef(((e,t)=>{const{__scopeToast:n,...i}=e,s=mA(kA,n);return k.jsx(_A,{asChild:!0,children:k.jsx(zE.button,{type:"button",...i,ref:t,onClick:bE(e.onClick,s.onClose)})})}));CA.displayName=kA;var _A=C.forwardRef(((e,t)=>{const{__scopeToast:n,altText:i,...s}=e;return k.jsx(zE.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0,...s,ref:t})}));function PA(e){const t=[];return Array.from(e.childNodes).forEach((e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,i=""===e.dataset.radixToastAnnounceExclude;if(!n)if(i){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...PA(e))}})),t}function IA(e,t,n,{discrete:i}){const s=n.originalEvent.currentTarget,r=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),i?FE(s,r):s.dispatchEvent(r)}var jA=(e,t,n=0)=>{const i=Math.abs(e.x),s=Math.abs(e.y),r=i>s;return"left"===t||"right"===t?r&&i>n:!r&&s>n};function EA(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function TA(e){const t=document.activeElement;return e.some((e=>e===t||(e.focus(),document.activeElement!==t)))}var MA=gA,AA=wA,OA=vA,DA=SA,RA=CA;const LA=C.createContext(null);function zA({children:e}){const[t,n]=C.useState([]),i=C.useCallback((e=>{const t=e.id??sv();return n((n=>[...n.filter((t=>t.id!==e.id)),{...e,id:t}])),t}),[]),s=C.useCallback((e=>(n((t=>t.filter((t=>t.id!==e)))),e)),[]),r=C.useCallback((()=>{n((()=>[]))}),[]);return k.jsx(rA,{children:k.jsx(LA.Provider,{value:{toasts:t,addToast:i,removeToast:s,clearToasts:r},children:e})})}function FA(){const e=C.useContext(LA);if(!e)throw new Error("useToasts must be used within a ToastsProvider");return e}const NA=C.forwardRef((function({children:e,disabled:t,type:n,...i},s){return k.jsx("button",{ref:s,type:"button",draggable:!1,disabled:t,...i,className:I("tlui-button",`tlui-button__${n}`,i.className),children:e})}));function $A({children:e}){return k.jsx("span",{className:"tlui-button__label",children:e})}const BA=C.memo((function({small:e,invertIcon:t,icon:n,color:i,className:s,...r}){const o=QI(),a=o.icons[n]??o.icons["question-mark-circle"],l=C.useRef(null);return C.useLayoutEffect((()=>{a||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),(null==l?void 0:l.current)&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)}),[l,a,n]),"none"===n?k.jsx("div",{className:I("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s)}):k.jsx("div",{...r,ref:l,className:I("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${a}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})})),UA={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function KA({toast:e}){const{removeToast:t}=FA(),n=oj(),i=e.actions&&e.actions.length>0,s=e.icon||e.severity&&UA[e.severity];return k.jsxs(MA,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,"data-severity":e.severity,children:[s&&k.jsx("div",{className:"tlui-toast__icon",children:k.jsx(BA,{icon:s})}),k.jsxs("div",{className:"tlui-toast__main",children:[k.jsxs("div",{className:"tlui-toast__content",children:[e.title&&k.jsx(AA,{className:"tlui-toast__title",children:e.title}),e.description&&k.jsx(OA,{className:"tlui-toast__description",children:e.description})]}),e.actions&&k.jsxs("div",{className:"tlui-toast__actions",children:[e.actions.map(((e,t)=>k.jsx(DA,{altText:e.label,asChild:!0,onClick:e.onClick,children:k.jsx(NA,{type:e.type,children:k.jsx($A,{children:e.label})})},t))),k.jsx(RA,{asChild:!0,children:k.jsx(NA,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:k.jsx($A,{children:e.closeLabel??n("toast.close")})})})]})]}),!i&&k.jsx(RA,{asChild:!0,children:k.jsx(NA,{type:"normal",className:"tlui-toast__close",children:k.jsx($A,{children:e.closeLabel??n("toast.close")})})})]})}const HA=C.memo((function(){const{toasts:e}=FA();return k.jsx(k.Fragment,{children:e.map((e=>k.jsx(KA,{toast:e},e.id)))})}));function VA(){const e=jm(),{toasts:t}=FA(),[n,i]=C.useState(!1);return C.useEffect((()=>{let n=-1;return t.length?i(!0):n=e.timers.setTimeout((()=>{i(!1)}),1e3),()=>{clearTimeout(n)}}),[t.length,i,e]),n?k.jsx(dA,{className:"tlui-toast__viewport"}):null}function WA({icon:e,small:t,invertIcon:n}){return k.jsx(BA,{className:"tlui-button__icon",icon:e,small:t,invertIcon:n})}const YA=[0,390,428,468,580,640,840,1023];var GA=(e=>(e[e.ZERO=0]="ZERO",e[e.MOBILE_XXS=1]="MOBILE_XXS",e[e.MOBILE_XS=2]="MOBILE_XS",e[e.MOBILE_SM=3]="MOBILE_SM",e[e.MOBILE=4]="MOBILE",e[e.TABLET_SM=5]="TABLET_SM",e[e.TABLET=6]="TABLET",e[e.DESKTOP=7]="DESKTOP",e))(GA||{});let XA={fonts:{draw:"https://cdn.tldraw.com/2.3.0/fonts/Shantell_Sans-Tldrawish.woff2",serif:"https://cdn.tldraw.com/2.3.0/fonts/IBMPlexSerif-Medium.woff2",sansSerif:"https://cdn.tldraw.com/2.3.0/fonts/IBMPlexSans-Medium.woff2",monospace:"https://cdn.tldraw.com/2.3.0/fonts/IBMPlexMono-Medium.woff2"}};function qA(e){return C.useMemo((()=>e?{fonts:{...XA.fonts,...null==e?void 0:e.fonts}}:XA),[e])}let ZA={...XA,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map((e=>[e,`https://cdn.tldraw.com/2.3.0/icons/icon/${e}.svg`]))),translations:Object.fromEntries(bm.map((e=>[e.locale,`https://cdn.tldraw.com/2.3.0/translations/${e.locale}.json`]))),embedIcons:Object.fromEntries(Df.map((e=>[e.type,`https://cdn.tldraw.com/2.3.0/embed-icons/${e.type}.png`])))};function JA(e){return e?{fonts:Object.assign({...ZA.fonts},{...null==e?void 0:e.fonts}),icons:Object.assign({...ZA.icons},{...null==e?void 0:e.icons}),embedIcons:Object.assign({...ZA.embedIcons},{...null==e?void 0:e.embedIcons}),translations:Object.assign({...ZA.translations},{...null==e?void 0:e.translations})}:ZA}function QA({className:e,children:t}){return k.jsx("div",{className:I("tlui-dialog__header",e),children:t})}function eO({className:e,children:t}){return k.jsx(CM,{dir:"ltr",className:I("tlui-dialog__header__title",e),children:t})}function tO(){return k.jsx("div",{className:"tlui-dialog__header__close",children:k.jsx(IM,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:k.jsx(NA,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:k.jsx(WA,{small:!0,icon:"cross-2"})})})})}function nO({className:e,children:t,style:n}){return k.jsx("div",{className:I("tlui-dialog__body",e),style:n,children:t})}function iO({className:e,children:t}){return k.jsx("div",{className:I("tlui-dialog__footer",e),children:t})}const sO=C.forwardRef((function({className:e,label:t,icon:n,iconLeft:i,autoSelect:s=!1,autoFocus:r=!1,defaultValue:o,placeholder:a,onComplete:l,onValueChange:c,onCancel:d,onFocus:h,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:p=!1,children:g,value:f},m){const y=jm(),x=C.useRef(null);C.useImperativeHandle(m,(()=>x.current));const w=oj(),v=C.useRef(o??""),b=C.useRef(o??""),[S,_]=C.useState(!1),P=C.useCallback((e=>{_(!0);const t=e.currentTarget;b.current=t.value,y.timers.requestAnimationFrame((()=>{s&&t.select()})),null==h||h()}),[s,h,y.timers]),j=C.useCallback((e=>{const t=e.currentTarget.value;b.current=t,null==c||c(t)}),[c]),E=C.useCallback((e=>{switch(e.key){case"Enter":e.currentTarget.blur(),Iy(e),null==l||l(e.currentTarget.value);break;case"Escape":e.currentTarget.value=v.current,e.currentTarget.blur(),Iy(e),null==d||d(e.currentTarget.value)}}),[l,d]),T=C.useCallback((e=>{_(!1);const t=e.currentTarget.value;null==u||u(t)}),[u]);return C.useEffect((()=>{if(!y.environment.isIos)return;const e=window.visualViewport;if(S&&p&&e){const t=()=>{var e;null==(e=x.current)||e.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),y.timers.requestAnimationFrame((()=>{var e;null==(e=x.current)||e.scrollIntoView({block:"center"})})),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}}),[y,S,p]),k.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[g,t&&k.jsx("label",{children:w(t)}),i&&k.jsx(BA,{icon:i,className:"tlui-icon-left",small:!0}),k.jsx("input",{ref:x,className:I("tlui-input",e),type:"text",defaultValue:o,onKeyUp:E,onChange:j,onFocus:P,onBlur:T,autoFocus:r,placeholder:a,value:f}),n&&k.jsx(BA,{icon:n,small:!!t})]})})),rO=Ou((function({onClose:e}){const t=jm(),n=oj(),i=QI(),[s,r]=C.useState(null),[o,a]=C.useState(""),[l,c]=C.useState(null),[d,h]=C.useState(!1),u=C.useRef(-1);return k.jsxs(k.Fragment,{children:[k.jsxs(QA,{children:[k.jsx(eO,{children:s?`${n("embed-dialog.title")} â ${s.title}`:n("embed-dialog.title")}),k.jsx(tO,{})]}),s?k.jsxs(k.Fragment,{children:[k.jsxs(nO,{className:"tlui-embed-dialog__enter",children:[k.jsx(sO,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:e=>{a(e);const n=QC(e);c(n&&n.definition.type===s.type?n:null),h(!1),clearTimeout(u.current),u.current=t.timers.setTimeout((()=>h(!n)),320)}}),""===o?k.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[k.jsx("span",{children:n("embed-dialog.instruction")})," ",s.instructionLink&&k.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",k.jsx(BA,{icon:"external-link",small:!0})]})]}):k.jsx("div",{className:"tlui-embed-dialog__warning",children:d?n("embed-dialog.invalid-url"):"Â "})]}),k.jsxs(iO,{className:"tlui-dialog__footer__actions",children:[k.jsx(NA,{type:"normal",onClick:()=>{r(null),c(null),a("")},children:k.jsx($A,{children:n("embed-dialog.back")})}),k.jsx("div",{className:"tlui-embed__spacer"}),k.jsx(NA,{type:"normal",onClick:e,children:k.jsx($A,{children:n("embed-dialog.cancel")})}),k.jsx(NA,{type:"primary",disabled:!l,onClick:()=>{l&&(t.putExternalContent({type:"embed",url:o,point:t.getViewportPageBounds().center,embed:l.definition}),e())},children:k.jsx($A,{children:n("embed-dialog.create")})})]})]}):k.jsx(k.Fragment,{children:k.jsx(nO,{className:"tlui-embed-dialog__list",children:Df.map((e=>k.jsxs(NA,{type:"menu",onClick:()=>r(e),children:[k.jsx($A,{children:e.title}),k.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${i.embedIcons[e.type]})`}})]},e.type)))})})]})}));function oO(){const e=jm(),t=C.useRef();return C.useEffect((()=>{const n=window.document.createElement("input");async function i(t){const i=t.target.files;i&&0!==i.length&&(e.mark("insert media"),await e.putExternalContent({type:"files",files:Array.from(i),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.type="file",n.accept=Fd,n.multiple=!0,t.current=n,n.addEventListener("change",i),()=>{t.current=void 0,n.removeEventListener("change",i)}}),[e]),C.useCallback((()=>{var e;null==(e=t.current)||e.click()}),[t])}const aO=C.createContext(null);function lO({overrides:e,children:t}){const n=jm(),i=BM(),{addDialog:s}=HM(),r=oO(),o=C.useMemo((()=>{const t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){n.setCurrentTool("select"),i("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),i("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(e){n.setCurrentTool("eraser"),i("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),i("select-tool",{source:e,id:"draw"})}},...[...Kf.values].map((e=>({id:e,label:`tool.${e}`,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.batch((()=>{n.setStyleForNextShapes(Kf,e),n.setCurrentTool("geo"),i("select-tool",{source:t,id:`geo-${e}`})}))}}))),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),i("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),i("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),i("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),i("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(e){r(),i("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),i("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),i("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(e){s({component:rO}),i("select-tool",{source:e,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(e){n.setCurrentTool("highlight"),i("select-tool",{source:e,id:"highlight"})}}];t.push();const o=Object.fromEntries(t.map((e=>[e.id,e])));return e?e(n,o,{insertMedia:r}):o}),[e,n,i,r,s]);return k.jsx(aO.Provider,{value:o,children:t})}function cO(){const e=C.useContext(aO);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}const dO=P.createContext(null);function hO({forceMobile:e=!1,children:t}){const n=jm(),i=Ru("breakpoint",(()=>{const{width:t}=n.getViewportScreenBounds(),i=e?GA.MOBILE_SM:YA.length-1;for(let e=0;e<i;e++)if(t>YA[e]&&t<=YA[e+1])return e;return i}),[n]);return k.jsx(dO.Provider,{value:i,children:t})}function uO(){const e=C.useContext(dO);if(null===e)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return e}function pO(e){return C.useMemo((()=>e),e)}function gO(e){const t=pO(null==e?[]:Array.isArray(e)?e:[e]);return C.useMemo((()=>{const e={};for(const n of t)if(n.translations)for(const[t,i]of Yd(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,i)}return e}),[t])}function fO(e){const t=function(){const{addToast:e,removeToast:t,clearToasts:n}=FA(),{addDialog:i,clearDialogs:s,removeDialog:r,updateDialog:o}=HM(),a=uO()<GA.TABLET_SM,l=oj();return C.useMemo((()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:i,clearDialogs:s,removeDialog:r,updateDialog:o,msg:l,isMobile:a})),[i,e,s,n,l,r,t,o,a])}(),n=pO(null==e?[]:Array.isArray(e)?e:[e]);return C.useMemo((()=>function(e,t){const n={};for(const i of e)if(i.translations)for(const[e,t]of Yd(i.translations)){let i=n[e];i||(i=n[e]={}),Object.assign(i,t)}return{actions:(n,i)=>{for(const s of e)s.actions&&(i=s.actions(n,i,t));return i},tools:(n,i,s)=>{for(const r of e)r.tools&&(i=r.tools(n,i,{...t,...s}));return i},translations:n}}(n,t)),[n,t])}const mO=50;function yO(e){return Op.isValid(e)?{isValid:!0,hasProtocol:!0}:Op.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const xO=Ou((function({onClose:e}){const t=jm().getOnlySelectedShape();return t&&"url"in t.props&&"string"==typeof t.props.url?k.jsx(wO,{onClose:e,selectedShape:t}):null})),wO=Ou((function({onClose:e,selectedShape:t}){const n=jm(),i=oj(),s=C.useRef(null);C.useEffect((()=>{n.timers.requestAnimationFrame((()=>{var e;return null==(e=s.current)?void 0:e.focus()}))}),[n]);const r=C.useRef(t.props.url),[o,a]=C.useState((()=>{const e=yO(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}})),l=C.useCallback((e=>{const t=e.replace(/https?:\/\/(https?:\/\/)/,((e,t)=>t)),n=yO(t),i=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";a({actual:t,safe:i,valid:n.isValid})}),[]),c=C.useCallback((()=>{const t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())}),[n,e]),d=C.useCallback((()=>{const t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==o.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:o.safe}}]),e())}),[n,e,o]),h=C.useCallback((()=>{e()}),[e]);if(!t)return e(),null;const u=r.current&&!o.valid;return k.jsxs(k.Fragment,{children:[k.jsxs(QA,{children:[k.jsx(eO,{children:i("edit-link-dialog.title")}),k.jsx(tO,{})]}),k.jsx(nO,{children:k.jsxs("div",{className:"tlui-edit-link-dialog",children:[k.jsx(sO,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:o.actual,onValueChange:l,onComplete:d,onCancel:h}),k.jsx("div",{children:o.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),k.jsxs(iO,{className:"tlui-dialog__footer__actions",children:[k.jsx(NA,{type:"normal",onClick:h,onTouchEnd:h,children:k.jsx($A,{children:i("edit-link-dialog.cancel")})}),u?k.jsx(NA,{type:"danger",onTouchEnd:c,onClick:c,children:k.jsx($A,{children:i("edit-link-dialog.clear")})}):k.jsx(NA,{type:"primary",disabled:!o.valid,onTouchEnd:d,onClick:d,children:k.jsx($A,{children:i("edit-link-dialog.save")})})]})]})}));var vO,bO,SO={exports:{}};vO=SO,bO=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function s(e,t){if(!i[e]){i[e]={};for(var n=0;n<e.length;n++)i[e][e.charAt(n)]=n}return i[e][t]}var r={compressToBase64:function(e){if(null==e)return"";var n=r._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:r._decompress(e.length,32,(function(n){return s(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":r._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:r._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=r.compress(e),n=new Uint8Array(2*t.length),i=0,s=t.length;i<s;i++){var o=t.charCodeAt(i);n[2*i]=o>>>8,n[2*i+1]=o%256}return n},decompressFromUint8Array:function(t){if(null==t)return r.decompress(t);for(var n=new Array(t.length/2),i=0,s=n.length;i<s;i++)n[i]=256*t[2*i]+t[2*i+1];var o=[];return n.forEach((function(t){o.push(e(t))})),r.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":r._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),r._decompress(e.length,32,(function(t){return s(n,e.charAt(t))})))},compress:function(t){return r._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var i,s,r,o={},a={},l="",c="",d="",h=2,u=3,p=2,g=[],f=0,m=0;for(r=0;r<e.length;r+=1)if(l=e.charAt(r),Object.prototype.hasOwnProperty.call(o,l)||(o[l]=u++,a[l]=!0),c=d+l,Object.prototype.hasOwnProperty.call(o,c))d=c;else{if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(i=0;i<p;i++)f<<=1,m==t-1?(m=0,g.push(n(f)),f=0):m++;for(s=d.charCodeAt(0),i=0;i<8;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1}else{for(s=1,i=0;i<p;i++)f=f<<1|s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s=0;for(s=d.charCodeAt(0),i=0;i<16;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[d]}else for(s=o[d],i=0;i<p;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1;0==--h&&(h=Math.pow(2,p),p++),o[c]=u++,d=String(l)}if(""!==d){if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(i=0;i<p;i++)f<<=1,m==t-1?(m=0,g.push(n(f)),f=0):m++;for(s=d.charCodeAt(0),i=0;i<8;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1}else{for(s=1,i=0;i<p;i++)f=f<<1|s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s=0;for(s=d.charCodeAt(0),i=0;i<16;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[d]}else for(s=o[d],i=0;i<p;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(s=2,i=0;i<p;i++)f=f<<1|1&s,m==t-1?(m=0,g.push(n(f)),f=0):m++,s>>=1;for(;;){if(f<<=1,m==t-1){g.push(n(f));break}m++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:r._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,i){var s,r,o,a,l,c,d,h=[],u=4,p=4,g=3,f="",m=[],y={val:i(0),position:n,index:1};for(s=0;s<3;s+=1)h[s]=s;for(o=0,l=Math.pow(2,2),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;switch(o){case 0:for(o=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;d=e(o);break;case 1:for(o=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;d=e(o);break;case 2:return""}for(h[3]=d,r=d,m.push(d);;){if(y.index>t)return"";for(o=0,l=Math.pow(2,g),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;switch(d=o){case 0:for(o=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;h[p++]=e(o),d=p-1,u--;break;case 1:for(o=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),o|=(a>0?1:0)*c,c<<=1;h[p++]=e(o),d=p-1,u--;break;case 2:return m.join("")}if(0==u&&(u=Math.pow(2,g),g++),h[d])f=h[d];else{if(d!==p)return null;f=r+r.charAt(0)}m.push(f),h[p++]=r+f.charAt(0),r=f,0==--u&&(u=Math.pow(2,g),g++)}}};return r}(),null!=vO?vO.exports=bO:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",(function(){return bO}));const kO=S(SO.exports);async function CO(e,t,n){var i,s,r;const{elements:o,files:a}=t,l={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},c=new Map,d=new Map,h=e.getCurrentPageId(),u=new Map,p=[],g=new Set;o.forEach((e=>{if(u.set(e.id,eg()),null!==e.boundElements)for(const t of e.boundElements)"text"===t.type&&g.add(t.id)}));let f=dh;for(const v of o){if(g.has(v.id))continue;const e=u.get(v.id),t={id:e,typeName:"shape",parentId:h,index:f,x:v.x,y:v.y,rotation:0,isLocked:v.locked,opacity:_O(v.opacity),meta:{}};switch(0!==v.angle&&d.set(e,v.angle),v.groupIds&&v.groupIds.length>0?c.has(v.groupIds[0])?null==(i=c.get(v.groupIds[0]))||i.push(e):c.set(v.groupIds[0],[e]):p.push(e),v.type){case"rectangle":case"ellipse":case"diamond":{let e="",n="middle";if(null!==v.boundElements)for(const t of v.boundElements)if("text"===t.type){const i=o.find((e=>e.id===t.id));i&&(e=i.text,n=OO[i.textAlign])}const i="transparent"===v.backgroundColor?v.strokeColor:v.backgroundColor;l.shapes.push({...t,type:"geo",props:{geo:v.type,url:v.link??"",w:v.width,h:v.height,size:PO[v.strokeWidth]??"draw",color:TO[i]??"black",text:e,align:n,dash:zO(v),fill:FO(v)}});break}case"freedraw":l.shapes.push({...t,type:"draw",props:{dash:zO(v),size:PO[v.strokeWidth],color:TO[v.strokeColor]??"black",segments:[{type:"free",points:v.points.map((([e,t,n=.5])=>({x:e,y:t,z:n})))}]}});break;case"line":{if(v.points.slice().length<2)break;const e=fh(v.points.length);l.shapes.push({...t,type:"line",props:{dash:zO(v),size:PO[v.strokeWidth],color:TO[v.strokeColor]??"black",spline:v.roundness?"cubic":"line",points:{...Object.fromEntries(v.points.map((([t,n],i)=>{const s=e[i];return[s,{id:s,index:s,x:t,y:n}]})))}}});break}case"arrow":{let n="";if(null!==v.boundElements)for(const e of v.boundElements)if("text"===e.type){const t=o.find((t=>t.id===e.id));t&&(n=t.text)}const i=v.points[0],a=v.points[v.points.length-1],c=u.get(null==(s=v.startBinding)?void 0:s.elementId),d=u.get(null==(r=v.endBinding)?void 0:r.elementId);l.shapes.push({...t,type:"arrow",props:{text:n,bend:LO(v,i,a),dash:zO(v),size:PO[v.strokeWidth]??"m",color:TO[v.strokeColor]??"black",start:{x:i[0],y:i[1]},end:{x:a[0],y:a[1]},arrowheadEnd:RO[v.endArrowhead]??"none",arrowheadStart:RO[v.startArrowhead]??"none"}}),c&&l.bindings.push({id:Wp(),typeName:"binding",type:"arrow",fromId:e,toId:c,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),d&&l.bindings.push({id:Wp(),typeName:"binding",type:"arrow",fromId:e,toId:d,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:e,scale:n}=jO(v.fontSize);l.shapes.push({...t,type:"text",props:{size:e,scale:n,font:EO[v.fontFamily]??"draw",color:TO[v.strokeColor]??"black",text:v.text,textAlign:DO[v.textAlign]}});break}case"image":{const e=a[v.fileId];if(!e)break;const n=kf.createId();l.assets.push({id:n,typeName:"asset",type:"image",props:{w:v.width,h:v.height,fileSize:e.size,name:v.id??"Untitled",isAnimated:!1,mimeType:e.mimeType,src:e.dataURL},meta:{}}),l.shapes.push({...t,type:"image",props:{w:v.width,h:v.height,assetId:n}})}}f=gh(f)}const m=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(l,{point:m,select:!1,preserveIds:!0});for(const v of c.values())if(v.length>1){e.groupShapes(v);const t=e.getShape(v[0]);(null==t?void 0:t.parentId)&&Qp(t.parentId)&&p.push(t.parentId)}for(const[v,b]of d)e.select(v),e.rotateShapesBy([v],b);const y=ud(p.map((t=>e.getShape(t)))),x=Ux.Common(y.map((t=>e.getShapePageBounds(t)))),w=e.getViewportPageBounds().center;e.updateShapes(y.map((e=>{const t=(e.x??0)-(x.x+x.w/2),n=(e.y??0)-(x.y+x.h/2);return{id:e.id,type:e.type,x:w.x+t,y:w.y+n}}))),e.setSelectedShapes(p)}const _O=e=>{const t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},PO={1:"s",2:"m",3:"l",4:"xl"},IO={16:"s",20:"m",28:"l",36:"xl"};function jO(e){const t=IO[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}const EO={1:"draw",2:"sans",3:"mono"},TO={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},MO={solid:"draw",dashed:"dashed",dotted:"dotted"},AO={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},OO={left:"start",center:"middle",right:"end"},DO={left:"start",center:"middle",right:"end"},RO={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function LO(e,t,n){let i=0;if(e.points.length>2){const s=new Am(t[0],t[1]),r=new Am(n[0],n[1]),o=new Am(e.points[1][0],e.points[1][1]),a=Am.Sub(r,s),l=Am.Per(a),c=Am.Med(r,s),d=Am.Sub(c,l),h=Am.Add(c,l),u=Am.NearestPointOnLineSegment(d,h,o,!1);i=Am.Dist(u,c),Am.Clockwise(u,r,c)&&(i*=-1)}return i}const zO=e=>{let t=MO[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},FO=e=>"transparent"===e.backgroundColor?"none":AO[e.fillStyle]??"solid";async function NO(e,t,n,i){const s=(await Promise.all(t.map((async e=>await(await _d(e)).blob())))).map((e=>new File([e],"tldrawFile",{type:e.type})));e.mark("paste"),await e.putExternalContent({type:"files",files:s,point:n,ignoreParent:!1,sources:i}),t.forEach((e=>URL.revokeObjectURL(e)))}function $O(e,t,n){const i=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0),s=e.getSelectionPageBounds();e.mark("paste"),e.putContentOntoCurrentPage(t,{point:i,select:!0});const r=e.getSelectionPageBounds();s&&r&&(null==s?void 0:s.collides(r))&&(e.updateInstanceState({isChangingStyle:!0}),e.timers.setTimeout((()=>{e.updateInstanceState({isChangingStyle:!1})}),150))}async function BO(e,t,n,i){var s;try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)){if(null==(s=(await _d(t,{method:"HEAD"})).headers.get("content-type"))?void 0:s.match(/^image\//))return e.mark("paste"),void NO(e,[t])}}catch(BX){"Failed to fetch"!==BX.message&&console.error(BX)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:i})}function UO(e){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}const KO=["input","select","textarea"];function HO(e){const{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||KO.indexOf(t.tagName.toLowerCase())>-1)}const VO=e=>e.types.find((e=>e.match(/^image\//))),WO=(e,t,n,i)=>{const s=(e=>{const t=e.split(/[\n\s]/);for(const i of t)try{const e=new URL(i);if("http:"!==e.protocol&&"https:"!==e.protocol)return}catch(n){return}return Jx(t)})(t);if(s)for(const r of s)BO(e,r,n);else(e=>{try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}})(t)?BO(e,t,n):/^<svg/.test(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:i})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:i}))},YO=async(e,t,n)=>{const i=[];for(const s of t){if(VO(s))for(const e of s.types)e.match(/^image\//)&&i.push({type:"blob",source:s.getType(e)});s.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const e=await s.getType("text/html");return await Id.blobToText(e)})()}),s.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const e=await s.getType("text/uri-list");return await Id.blobToText(e)})()}),s.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const e=await s.getType("text/plain");return await Id.blobToText(e)})()})}return await GO(e,i,n)};async function GO(e,t,n){const i=t.filter((e=>("file"===e.type||"blob"===e.type)&&null!==e.source));if(i.length){const t=(await Promise.all(i.map((e=>e.source)))).filter(Boolean).map((e=>URL.createObjectURL(e)));return await NO(e,t,n)}const s=await Promise.all(t.filter((e=>"file"!==e.type)).map((e=>new Promise((t=>{const n=e;"file"!==n.type?n.source.then((e=>{var i;const s=null==(i=e.match(/<div data-tldraw[^>]*>(.*)<\/div>/))?void 0:i[1];if(s)try{const e=kO.decompressFromBase64(s);if(null===e)return void t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});{const n=JSON.parse(e);return"application/tldraw"!==n.type&&t({type:"error",data:n,reason:`found tldraw data comment but JSON was of a different type: ${n.type}`}),"string"==typeof n.data?void t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"}):void t({type:"tldraw",data:n.data})}}catch(r){return void t({type:"error",data:s,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"})}else{if("html"===n.type)return void t({type:"text",data:e,subtype:"html"});if("url"===n.type)return void t({type:"text",data:e,subtype:"url"});try{const n=JSON.parse(e);return"excalidraw/clipboard"===n.type?void t({type:"excalidraw",data:n}):void t({type:"text",data:e,subtype:"json"})}catch(r){return void t({type:"text",data:e,subtype:"text"})}}t({type:"error",data:e,reason:"unhandled case"})})):t({type:"error",data:null,reason:"unexpected file"})})))));for(const r of s)if("tldraw"===r.type)return void $O(e,r.data,n);for(const r of s)if("excalidraw"===r.type)return void CO(e,r.data,n);for(const r of s)if("text"===r.type&&"html"===r.subtype){const t=(new DOMParser).parseFromString(r.data,"text/html").querySelector("body");if(t&&1===Array.from(t.children).filter((e=>1===e.nodeType)).length&&t.firstElementChild&&"A"===t.firstElementChild.tagName&&t.firstElementChild.hasAttribute("href")&&""!==t.firstElementChild.getAttribute("href")){const i=t.firstElementChild.getAttribute("href");return void WO(e,i,n,s)}if(!s.some((e=>"text"===e.type&&"html"!==e.subtype))&&r.data.trim())return void WO(e,UO(r.data),n,s)}for(const r of s)if("text"===r.type&&"url"===r.subtype)return void BO(e,r.data,n,s);for(const r of s)if("text"===r.type&&"text"===r.subtype&&r.data.trim())return void WO(e,r.data,n,s)}const XO=async e=>{var t;const n=await e.resolveAssetsInContent(e.getContentFromCurrentPage(e.getSelectedShapeIds()));if(!n)return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText(""));const i=kO.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:n}));if("undefined"!=typeof navigator){const s=n.shapes.map((t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null)).filter(Oh);if(null==(t=navigator.clipboard)?void 0:t.write){const e=new Blob([`<div data-tldraw>${i}</div>`],{type:"text/html"});let t=s.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${i}</div>`)}};function qO(){const e=jm(),t=BM(),n=Ru("editor.isFocused",(()=>e.getInstanceState().isFocused),[e]);C.useEffect((()=>{if(!n)return;const i=async n=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||HO(e)||(Cy(n),await XO(e),t("copy",{source:"kbd"}))};async function s(n){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||HO(e)||(Cy(n),await XO(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let r=!1;const o=t=>{1===t.button&&(r=!0,e.timers.requestAnimationFrame((()=>{r=!1})))},a=n=>{r?Iy(n):null!==e.getEditingShapeId()||HO(e)||(n.clipboardData&&!e.inputs.shiftKey?(async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");const i=[];for(const s of Object.values(t.items))switch(s.kind){case"file":i.push({type:"file",source:new Promise((e=>e(s.getAsFile())))});break;case"string":"text/html"===s.type?i.push({type:"html",source:new Promise((e=>s.getAsString(e)))}):"text/plain"===s.type?i.push({type:"text",source:new Promise((e=>s.getAsString(e)))}):i.push({type:s.type,source:new Promise((e=>s.getAsString(e)))})}GO(e,i,n)})(e,n.clipboardData):navigator.clipboard.read().then((t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&YO(e,t,e.inputs.currentPagePoint)})),Cy(n),t("paste",{source:"kbd"}))};return document.addEventListener("copy",i),document.addEventListener("cut",s),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",i),document.removeEventListener("cut",s),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}}),[e,t,n])}async function ZO(e,t,n){const{type:i,quality:s,scale:r,width:o,height:a}=n;let[l,c]=await async function(e,t){if(e<=GC&&t<=GC&&e*t<=XC)return[e,t];const{maxWidth:n,maxHeight:i,maxArea:s}=await YC(),r=e/t;if(e>n&&(t=(e=n)/r),t>i&&(e=(t=i)*r),e*t>s){const n=Math.sqrt(s/(e*t));e*=n,t*=n}return[e,t]}(o*r,a*r);l=Math.floor(l),c=Math.floor(c);const d=l/o,h=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),u=await new Promise((t=>{const n=Pd();n.crossOrigin="anonymous",n.onload=async()=>{e.environment.isSafari&&await new Promise((t=>e.timers.setTimeout(t,250)));const i=document.createElement("canvas"),s=i.getContext("2d");i.width=l,i.height=c,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(n,0,0,l,c),URL.revokeObjectURL(h),t(i)},n.onerror=()=>{t(null)},n.src=h}));if(!u)return null;const p=await new Promise((e=>u.toBlob((t=>{t&&!vy.throwToBlob.get()||e(null),e(t)}),"image/"+i,s)));if(!p)return null;if("png"===i){const e=new DataView(await p.arrayBuffer());return Ad.setPhysChunk(e,d,{type:"image/"+i})}return p}async function JO(e,t,n){const i=await e.getSvgString((null==t?void 0:t.length)?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!i)throw new Error("Could not construct SVG.");return i}async function QO(e,t,n,i={}){var s;switch(n){case"svg":return null==(s=await JO(e,t,i))?void 0:s.svg;case"json":{const n=await e.resolveAssetsInContent(e.getContentFromCurrentPage(t));return JSON.stringify(n)}default:wd(n)}}async function eD({editor:e,ids:t,format:n,opts:i={}}){switch(n){case"svg":return new Blob([await QO(e,t,"svg",i)],{type:"text/plain"});case"json":return new Blob([await QO(e,t,"json",i)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await JO(e,t,i);if(!s)throw new Error("Could not construct image.");const r=await ZO(e,s.svg,{type:n,quality:1,scale:2,width:s.width,height:s.height});if(!r)throw new Error("Could not construct image.");return r}default:wd(n)}}const tD={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function nD(e,t,n="svg",i={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:s,mimeType:r}=function(e,t,n,i={}){return{blobPromise:eD({editor:e,ids:t,format:n,opts:i}),mimeType:tD[n]}}(e,t,n,i);return window.navigator.clipboard.write([new ClipboardItem({[r]:s})]).catch((e=>(console.error(e),s.then((e=>window.navigator.clipboard.write([new ClipboardItem({[r]:e})]))))))}switch(n){case"json":case"svg":return async function(e){var t,n;await(null==(n=null==(t=navigator.clipboard)?void 0:t.writeText)?void 0:n.call(t,await e()))}((async()=>QO(e,t,n,i)));case"jpeg":case"png":throw new Error("Copy not supported");default:wd(n)}}async function iD(e,t,n="png",i,s={}){if(!i&&(i=`shapes at ${sD()}`,1===t.length)){const n=e.getShape(t[0]);i=e.isShapeOfType(n,"frame")?n.props.name??"frame":`${n.id.replace(/:/,"_")} at ${sD()}`}i+=`.${n}`;const r=await eD({editor:e,ids:t,format:n,opts:s});!function(e){const t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}(new File([r],i,{type:r.type}))}function sD(){const e=new Date;return`${String(e.getFullYear()).slice(2)}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}.${String(e.getMinutes()).padStart(2,"0")}.${String(e.getSeconds()).padStart(2,"0")}`}function rD(){const e=jm(),{addToast:t}=FA(),n=oj();return C.useCallback(((i,s="png",r)=>{iD(e,i,s,r,{scale:1,background:e.getInstanceState().exportBackground}).catch((e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})}))}),[e,t,n])}const oD=C.createContext(null);function aD(e,t){if(0===e.getSelectedShapes().length)return e.getDocumentSettings().name||t}function lD({overrides:e,children:t}){const n=jm(),{addDialog:i,clearDialogs:s}=HM(),{clearToasts:r}=FA(),o=oj(),a=oO(),l=function(){const e=jm(),t=C.useRef(null),n=C.useRef(null);return C.useCallback((async function(){const i=document.createElement("div"),s=document.createElement("style"),r=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};r(t.current,n.current),t.current=i,n.current=s;const o=`tl-print-surface-${sv()}`;i.className=o,s.innerHTML=`\n\t\t\t.${o} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.${o} svg {\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t@media print {\t\t\t\t  \n\t\t\t\thtml, body {\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\tbody > * {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.tldraw__editor {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${o} {\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${o}__item {\n\t\t\t\t\tpadding: 10mm;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tpage-break-after: always;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${o}__item__main {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmax-height: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${o}__item__header {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${o}__item__footer {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\n\t\t\t\t.${o}__item__footer__hide {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t\n\t\t\t}\n\n\t\t`;const a=()=>{document.head.appendChild(s),document.body.appendChild(i)},l=()=>{e.once("tick",(()=>{r(i,s)}))};function c(e,t,n){try{i.innerHTML+=`<div class="${o}__item">\n        <div class="${o}__item__header">\n          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}\n        </div>\n        <div class="${o}__item__main">\n          ${n}\n        </div>\n        <div class="${o}__item__footer ${o}__item__footer__${t?"":"hide"}">\n          ${t??""}\n        </div>\n      </div>`}catch(s){console.error(s)}}function d(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);const h=e.getSelectedShapeIds(),u=e.getCurrentPageId(),p=e.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){const t=await e.getSvgString(h,g);if(t){const e=p.find((e=>e.id===u));c(`tldraw â ${null==e?void 0:e.name}`,null,t.svg),d()}}else{const t=e.getCurrentPage(),n=await e.getSvgString(e.getSortedChildIdsForParent(t.id),g);n&&(c(`tldraw â ${t.name}`,null,n.svg),d())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)}),[e])}(),{cut:c,copy:d,paste:h}=function(){const e=jm(),t=BM(),n=C.useCallback((async function(n){0!==e.getSelectedShapeIds().length&&(await XO(e),t("copy",{source:n}))}),[e,t]),i=C.useCallback((async function(n){0!==e.getSelectedShapeIds().length&&(await XO(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))}),[e,t]),s=C.useCallback((async function(n,i,r){null===e.getEditingShapeId()&&(Array.isArray(n)&&n[0]instanceof ClipboardItem?(YO(e,n,r),t("paste",{source:"menu"})):navigator.clipboard.read().then((e=>{s(e,i,r)})))}),[e,t]);return{copy:n,cut:i,paste:s}}(),u=function(){const e=jm(),{addToast:t}=FA(),n=oj();return C.useCallback(((i,s="svg")=>{nD(e,i,s).catch((()=>{t({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})}))}),[e,t,n])}(),p=rD(),g=o("document.default-name"),f=BM(),m=C.useMemo((()=>{function t(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function m(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}const y=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(e){m()&&(t()||(f("edit-link",{source:e}),n.mark("edit-link"),i({component:xO})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(e){f("insert-embed",{source:e}),i({component:rO})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(e){f("insert-media",{source:e}),a()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(e){f("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(e){f("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("export-as",{format:"svg",source:e}),p(t,"svg",aD(n,g)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("export-as",{format:"png",source:e}),p(t,"png",aD(n,g)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("export-as",{format:"json",source:e}),p(t,"json",aD(n,g)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("export-all-as",{format:"svg",source:e}),p(Array.from(n.getCurrentPageShapeIds()),"svg",aD(n,g)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(e){const t=Array.from(n.getCurrentPageShapeIds().values());0!==t.length&&(f("export-all-as",{format:"png",source:e}),p(t,"png",aD(n,g)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(e){const t=Array.from(n.getCurrentPageShapeIds().values());0!==t.length&&(f("export-all-as",{format:"json",source:e}),p(t,"json",aD(n,g)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("copy-as",{format:"svg",source:e}),u(t,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("copy-as",{format:"png",source:e}),u(t,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(f("copy-as",{format:"json",source:e}),u(t,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(e){if(!m())return;if(t())return;f("toggle-auto-size",{source:e}),n.mark("toggling auto size");const i=n.getSelectedShapes().filter((e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize));n.updateShapes(i.map((e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}})))),I_(n,i.map((e=>e.id)))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){f("open-embed-link",{source:e});const t=n.getSelectedShapeIds(),i="No embed shapes selected";if(1!==t.length)return void console.error(i);const s=n.getShape(t[0]);s&&n.isShapeOfType(s,"embed")?function(e,t="_blank"){tv.openWindow(e,t)}(s.props.url,"_blank"):console.error(i)}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){var t,i;if("zoom"!==(null==(t=n.root.getCurrent())?void 0:t.id)&&(f("zoom-tool",{source:e}),!n.inputs.shiftKey&&!n.inputs.ctrlKey)){const e=n.root.getCurrent();e&&"idle"===(null==(i=e.getCurrent())?void 0:i.id)&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(e){m()&&(t()||n.batch((()=>{f("convert-to-bookmark",{source:e});const t=n.getSelectedShapes(),i=[],s=[];for(const e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;const t=new Am(e.x,e.y);t.rot(-e.rotation),t.add(new Am(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);const r={id:eg(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};i.push(r),s.push(e.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(s),n.createShapes(i)})))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(e){m()&&(t()||(f("convert-to-embed",{source:e}),n.batch((()=>{const e=ud(n.getSelectedShapeIds().map((e=>n.getShape(e)))),t=[],i=[];for(const s of e){if(!n.isShapeOfType(s,"bookmark"))continue;const{url:e}=s.props,r=QC(s.props.url);if(!r)continue;if(!r.definition)continue;const{width:o,height:a}=r.definition,l=new Am(s.x,s.y);l.rot(-s.rotation),l.add(new Am(s.props.w/2-o/2,s.props.h/2-a/2)),l.rot(s.rotation);const c={id:eg(),type:"embed",x:l.x,y:l.y,rotation:s.rotation,props:{url:e,w:o,h:a}};t.push(c),i.push(s.id)}n.mark("convert shapes to embed"),n.deleteShapes(i),n.createShapes(t)}))))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(e){if(!m())return;if(t())return;f("duplicate-shapes",{source:e});const i=n.getInstanceState();let s,r;if(i.duplicateProps)s=i.duplicateProps.shapeIds,r=i.duplicateProps.offset;else{s=n.getSelectedShapeIds();const e=Ux.Common(ud(s.map((e=>n.getShapePageBounds(e)))));r=n.getCameraOptions().isLocked?{x:20,y:20}:{x:e.width+20,y:0}}n.mark("duplicate shapes"),n.duplicateShapes(s,r),i.duplicateProps&&n.updateInstanceState({duplicateProps:{...i.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(e){m()&&(t()||(f("ungroup-shapes",{source:e}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(e){if(!m())return;if(t())return;f("group-shapes",{source:e});const i=n.getOnlySelectedShape();i&&n.isShapeOfType(i,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(e){if(!m())return;f("remove-frame",{source:e});const t=n.getSelectedShapes();t.length>0&&t.every((e=>n.isShapeOfType(e,"frame")))&&(n.mark("remove-frame"),function(e,t){const n=ud(t.map((t=>e.getShape(t))).filter((t=>t&&e.isShapeOfType(t,"frame"))));if(!n.length)return;const i=[];e.batch((()=>{n.map((t=>{const n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),i.push(...n))})),e.setSelectedShapes(i),e.deleteShapes(t)}))}(n,t.map((e=>e.id))))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(e){if(!m())return;f("fit-frame-to-content",{source:e});const t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.mark("fit-frame-to-content"),function(e,t,n={}){const i=e.getShape(t);if(!i)return;const s=e.getSortedChildIdsForParent(i.id),r=ud(s.map((t=>e.getShape(t))));if(!r.length)return;const o=Ux.FromPoints(r.flatMap((t=>{const n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)}))),{padding:a=mO}=n,l=o.w+2*a,c=o.h+2*a,d=a-o.minX,h=a-o.minY;if(0===d&&0===h&&i.props.w===l&&i.props.h===c)return;const u=new Am(d,h).rot(i.rotation);e.batch((()=>{const t=s.map((t=>{const n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+d,y:n.y+h}}));t.push({id:i.id,type:i.type,x:i.x-u.x,y:i.y-u.y,props:{w:l,h:c}}),e.updateShapes(t)}))}(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"left",source:e}),n.mark("align left");const i=n.getSelectedShapeIds();n.alignShapes(i,"left"),I_(n,i)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"center-horizontal",source:e}),n.mark("align center horizontal");const i=n.getSelectedShapeIds();n.alignShapes(i,"center-horizontal"),I_(n,i)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"right",source:e}),n.mark("align right");const i=n.getSelectedShapeIds();n.alignShapes(i,"right"),I_(n,i)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"center-vertical",source:e}),n.mark("align center vertical");const i=n.getSelectedShapeIds();n.alignShapes(i,"center-vertical"),I_(n,i)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"top",source:e}),n.mark("align top");const i=n.getSelectedShapeIds();n.alignShapes(i,"top"),I_(n,i)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(e){if(!m())return;if(t())return;f("align-shapes",{operation:"bottom",source:e}),n.mark("align bottom");const i=n.getSelectedShapeIds();n.alignShapes(i,"bottom"),I_(n,i)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(e){if(!m())return;if(t())return;f("distribute-shapes",{operation:"horizontal",source:e}),n.mark("distribute horizontal");const i=n.getSelectedShapeIds();n.distributeShapes(i,"horizontal"),I_(n,i)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(e){if(!m())return;if(t())return;f("distribute-shapes",{operation:"vertical",source:e}),n.mark("distribute vertical");const i=n.getSelectedShapeIds();n.distributeShapes(i,"vertical"),I_(n,i)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(e){if(!m())return;if(t())return;f("stretch-shapes",{operation:"horizontal",source:e}),n.mark("stretch horizontal");const i=n.getSelectedShapeIds();n.stretchShapes(i,"horizontal"),I_(n,i)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(e){if(!m())return;if(t())return;f("stretch-shapes",{operation:"vertical",source:e}),n.mark("stretch vertical");const i=n.getSelectedShapeIds();n.stretchShapes(i,"vertical"),I_(n,i)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(e){if(!m())return;if(t())return;f("flip-shapes",{operation:"horizontal",source:e}),n.mark("flip horizontal");const i=n.getSelectedShapeIds();n.flipShapes(i,"horizontal"),I_(n,i)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(e){if(!m())return;if(t())return;f("flip-shapes",{operation:"vertical",source:e}),n.mark("flip vertical");const i=n.getSelectedShapeIds();n.flipShapes(i,"vertical"),I_(n,i)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(e){if(!m())return;if(t())return;f("pack-shapes",{source:e}),n.mark("pack");const i=n.getSelectedShapeIds();n.packShapes(i,n.options.adjacentShapeMargin),I_(n,i)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(e){if(!m())return;if(t())return;f("stack-shapes",{operation:"vertical",source:e}),n.mark("stack-vertical");const i=n.getSelectedShapeIds();n.stackShapes(i,"vertical",16),I_(n,i)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(e){if(!m())return;if(t())return;f("stack-shapes",{operation:"horizontal",source:e}),n.mark("stack-horizontal");const i=n.getSelectedShapeIds();n.stackShapes(i,"horizontal",16),I_(n,i)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(e){m()&&(t()||(f("reorder-shapes",{operation:"toFront",source:e}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(e){m()&&(t()||(f("reorder-shapes",{operation:"forward",source:e}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(e){m()&&(t()||(f("reorder-shapes",{operation:"backward",source:e}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(e){m()&&(t()||(f("reorder-shapes",{operation:"toBack",source:e}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(e){m()&&(t()||(n.mark("cut"),c(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){m()&&(t()||d(e))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(e){var t;null==(t=navigator.clipboard)||t.read().then((t=>{h(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)}))}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){n.batch((()=>{t()||(f("select-all-shapes",{source:e}),n.mark("select all kbd"),n.selectAll())}))}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){m()&&(t()||(f("select-none-shapes",{source:e}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:"â«,del,backspace",icon:"trash",onSelect(e){m()&&(t()||(f("delete-shapes",{source:e}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(e){if(!m())return;if(t())return;f("rotate-cw",{source:e}),n.mark("rotate-cw");const i=n.getSelectionRotation()%(zm/2),s=Um(i,0)||Um(i,zm/2),r=n.getSelectedShapeIds();n.rotateShapesBy(r,zm/2-(s?0:i)),I_(n,r)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(e){if(!m())return;if(t())return;f("rotate-ccw",{source:e}),n.mark("rotate-ccw");const i=n.getSelectionRotation()%(zm/2),s=Um(i,0),r=n.getSelectedShapeIds();n.rotateShapesBy(r,s?-zm/2:-i),I_(n,r)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){f("zoom-in",{source:e}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){f("zoom-out",{source:e}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){f("reset-zoom",{source:e}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){f("zoom-to-fit",{source:e}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){m()&&(t()||(f("zoom-to-selection",{source:e}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(e){f("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(e){const t=n.user.getIsDarkMode()?"light":"dark";f("color-scheme",{source:e,value:t}),n.user.updateUserPreferences({colorScheme:t})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(e){f("toggle-wrap-mode",{source:e}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(e){f("toggle-dynamic-size-mode",{source:e}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(e){f("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(e){f("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(e){f("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(e){f("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(e){f("unlock-all",{source:e});const t=[];for(const i of n.getCurrentPageShapes())i.isLocked&&t.push({id:i.id,type:i.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){n.timers.requestAnimationFrame((()=>{n.batch((()=>{f("toggle-focus-mode",{source:e}),s(),r(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})}))}))}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(e){f("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(e){f("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){f("print",{source:e}),l()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){f("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){f("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){f("zoom-to-content",{source:e});const t=n.getSelectionPageBounds()??n.getCurrentPageBounds();t&&n.zoomToBounds(t,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(e){n.mark("locking"),f("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}},{id:"new-page",label:"context.pages.new-page",onSelect(e){const t=Lg.createId(),i=n.getSelectedShapeIds();n.batch((()=>{n.mark("move_shapes_to_page"),n.createPage({name:o("page-menu.new-page-initial-name"),id:t}),n.moveShapesToPage(i,t)})),f("new-page",{source:e})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(e){const t=cg;n.batch((()=>{n.mark("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(t,"white"),n.setStyleForNextShapes(t,"white")})),f("set-style",{source:e,id:t.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(e){const t=ug;n.batch((()=>{n.mark("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(t,"fill"),n.setStyleForNextShapes(t,"fill")})),f("set-style",{source:e,id:t.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async e=>{const t=n.getSelectedShapeIds();if(0===t.length)return;n.mark("flattening to image"),f("flatten-to-image",{source:e});const i=await async function(e,t,n){const i=ud(t.map((t=>{const n=e.getShape(t);if(n)return void 0!==e.getShapeUtil(n.type).toSvg?n:void 0})));if(0===i.length)return;if(1===i.length){const t=i[0];if(!t)return;if(e.isShapeOfType(t,"image"))return}const s=[];if(void 0!==n){const t=i.map((t=>({shape:t,bounds:e.getShapeMaskedPageBounds(t).clone().expandBy(n)})));for(let e=0;e<t.length;e++){const n=t[e];if(0===e){s[0]={shapes:[n.shape],bounds:n.bounds};continue}let i=!1;for(const e of s)if(e.bounds.includes(n.bounds)){e.shapes.push(n.shape),e.bounds.expand(n.bounds),i=!0;break}i||s.push({shapes:[n.shape],bounds:n.bounds})}}else{const t=Ux.Common(i.map((t=>e.getShapeMaskedPageBounds(t))));s.push({shapes:i,bounds:t})}const r=e.options.flattenImageBoundsPadding;for(const a of s){void 0!==n&&a.bounds.expandBy(-n);const t=await e.getSvgString(a.shapes,{padding:r});if(!(null==t?void 0:t.svg))continue;const i=new Blob([t.svg],{type:"image/svg+xml"}),s=await e.getAssetForExternalContent({type:"file",file:new File([i],"asset.svg",{type:"image/svg+xml"})});s&&(a.asset=s)}const o=[];return fu((()=>{for(const t of s){const{asset:n,bounds:i,shapes:s}=t;if(!n)continue;const a=e.findCommonAncestor(s)??e.getCurrentPageId();if(!a)continue;let l,c,d,h="a1";for(const e of s)if(e.parentId===a){e.index>h&&(h=e.index);break}if(Qp(a)){const t=e.getShape(a);if(!t)continue;const n=e.getPointInShapeSpace(t,{x:i.x,y:i.y});d=e.getShapePageTransform(a).rotation(),n.sub(new Am(r,r).rot(-d)),l=n.x,c=n.y}else l=i.x-r,c=i.y-r,d=0;e.deleteShapes(s),e.createAssets([{...n,id:n.id}]);const u=eg();e.createShape({id:u,type:"image",index:h,parentId:a,x:l,y:c,rotation:-d,props:{assetId:n.id,w:i.w+2*r,h:i.h+2*r}}),o.push(u)}})),o}(n,t,n.options.flattenImageBoundsExpand);(null==i?void 0:i.length)&&n.setSelectedShapes(i)}}],x=function(e){return Object.fromEntries(e.map((e=>[e.id,e])))}(y);return e?e(n,x,void 0):x}),[n,f,e,i,a,p,u,c,d,h,s,r,l,o,g]);return k.jsx(oD.Provider,{value:m,children:t})}function cD(){const e=C.useContext(oD);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}function dD(e,t){return e?"string"==typeof e?e:t?e[t]??e.default:void 0:void 0}var hD="undefined"!=typeof document?C.useLayoutEffect:C.useEffect;function uD(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let n,i,s;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(i=n;0!=i--;)if(!uD(e[i],t[i]))return!1;return!0}if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(i=n;0!=i--;)if(!{}.hasOwnProperty.call(t,s[i]))return!1;for(i=n;0!=i--;){const n=s[i];if(("_owner"!==n||!e.$$typeof)&&!uD(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function pD(e){if("undefined"==typeof window)return 1;return(e.ownerDocument.defaultView||window).devicePixelRatio||1}function gD(e,t){const n=pD(e);return Math.round(t*n)/n}function fD(e){const t=C.useRef(e);return hD((()=>{t.current=e})),t}const mD=e=>({name:"arrow",options:e,fn(t){const{element:n,padding:i}="function"==typeof e?e(t):e;return n&&(s=n,{}.hasOwnProperty.call(s,"current"))?null!=n.current?V({element:n.current,padding:i}).fn(t):{}:n?V({element:n,padding:i}).fn(t):{};var s}}),yD=(e,t)=>({...N(e),options:[e,t]}),xD=(e,t)=>({...$(e),options:[e,t]}),wD=(e,t)=>({...B(e),options:[e,t]}),vD=(e,t)=>({...U(e),options:[e,t]}),bD=(e,t)=>({...K(e),options:[e,t]}),SD=(e,t)=>({...H(e),options:[e,t]}),kD=(e,t)=>({...mD(e),options:[e,t]});var CD=C.forwardRef(((e,t)=>{const{children:n,width:i=10,height:s=5,...r}=e;return k.jsx(zE.svg,{...r,ref:t,width:i,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:k.jsx("polygon",{points:"0,0 30,0 15,10"})})}));CD.displayName="Arrow";var _D=CD;function PD(e){const[t,n]=C.useState(void 0);return PE((()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const i=t[0];let s,r;if("borderBoxSize"in i){const e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;s=t.inlineSize,r=t.blockSize}else s=e.offsetWidth,r=e.offsetHeight;n({width:s,height:r})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)}),[e]),t}var ID="Popper",[jD,ED]=CE(ID),[TD,MD]=jD(ID),AD=e=>{const{__scopePopper:t,children:n}=e,[i,s]=C.useState(null);return k.jsx(TD,{scope:t,anchor:i,onAnchorChange:s,children:n})};AD.displayName=ID;var OD="PopperAnchor",DD=C.forwardRef(((e,t)=>{const{__scopePopper:n,virtualRef:i,...s}=e,r=MD(OD,n),o=C.useRef(null),a=kE(t,o);return C.useEffect((()=>{r.onAnchorChange((null==i?void 0:i.current)||o.current)})),i?null:k.jsx(zE.div,{...s,ref:a})}));DD.displayName=OD;var RD="PopperContent",[LD,zD]=jD(RD),FD=C.forwardRef(((e,t)=>{var n,i,s,r,o,a;const{__scopePopper:l,side:c="bottom",sideOffset:d=0,align:h="center",alignOffset:u=0,arrowPadding:p=0,avoidCollisions:g=!0,collisionBoundary:f=[],collisionPadding:m=0,sticky:y="partial",hideWhenDetached:x=!1,updatePositionStrategy:w="optimized",onPlaced:v,...b}=e,S=MD(RD,l),[_,P]=C.useState(null),I=kE(t,(e=>P(e))),[j,T]=C.useState(null),M=PD(j),A=(null==M?void 0:M.width)??0,O=(null==M?void 0:M.height)??0,D=c+("center"!==h?"-"+h:""),R="number"==typeof m?m:{top:0,right:0,bottom:0,left:0,...m},L=Array.isArray(f)?f:[f],z=L.length>0,N={padding:R,boundary:L.filter(UD),altBoundary:z},{refs:$,floatingStyles:B,placement:U,isPositioned:K,middlewareData:H}=function(e){void 0===e&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:i=[],platform:s,elements:{reference:r,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[d,h]=C.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[u,p]=C.useState(i);uD(u,i)||p(i);const[g,f]=C.useState(null),[m,y]=C.useState(null),x=C.useCallback((e=>{e!==S.current&&(S.current=e,f(e))}),[]),w=C.useCallback((e=>{e!==k.current&&(k.current=e,y(e))}),[]),v=r||g,b=o||m,S=C.useRef(null),k=C.useRef(null),_=C.useRef(d),P=null!=l,I=fD(l),j=fD(s),T=C.useCallback((()=>{if(!S.current||!k.current)return;const e={placement:t,strategy:n,middleware:u};j.current&&(e.platform=j.current),F(S.current,k.current,e).then((e=>{const t={...e,isPositioned:!0};M.current&&!uD(_.current,t)&&(_.current=t,E.flushSync((()=>{h(t)})))}))}),[u,t,n,j]);hD((()=>{!1===c&&_.current.isPositioned&&(_.current.isPositioned=!1,h((e=>({...e,isPositioned:!1}))))}),[c]);const M=C.useRef(!1);hD((()=>(M.current=!0,()=>{M.current=!1})),[]),hD((()=>{if(v&&(S.current=v),b&&(k.current=b),v&&b){if(I.current)return I.current(v,b,T);T()}}),[v,b,T,I,P]);const A=C.useMemo((()=>({reference:S,floating:k,setReference:x,setFloating:w})),[x,w]),O=C.useMemo((()=>({reference:v,floating:b})),[v,b]),D=C.useMemo((()=>{const e={position:n,left:0,top:0};if(!O.floating)return e;const t=gD(O.floating,d.x),i=gD(O.floating,d.y);return a?{...e,transform:"translate("+t+"px, "+i+"px)",...pD(O.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:i}}),[n,a,O.floating,d.x,d.y]);return C.useMemo((()=>({...d,update:T,refs:A,elements:O,floatingStyles:D})),[d,T,A,O,D])}({strategy:"fixed",placement:D,whileElementsMounted:(...e)=>W(...e,{animationFrame:"always"===w}),elements:{reference:S.anchor},middleware:[yD({mainAxis:d+O,alignmentAxis:u}),g&&xD({mainAxis:!0,crossAxis:!1,limiter:"partial"===y?wD():void 0,...N}),g&&vD({...N}),bD({...N,apply:({elements:e,rects:t,availableWidth:n,availableHeight:i})=>{const{width:s,height:r}=t.reference,o=e.floating.style;o.setProperty("--radix-popper-available-width",`${n}px`),o.setProperty("--radix-popper-available-height",`${i}px`),o.setProperty("--radix-popper-anchor-width",`${s}px`),o.setProperty("--radix-popper-anchor-height",`${r}px`)}}),j&&kD({element:j,padding:p}),KD({arrowWidth:A,arrowHeight:O}),x&&SD({strategy:"referenceHidden",...N})]}),[V,Y]=HD(U),G=TE(v);PE((()=>{K&&(null==G||G())}),[K,G]);const X=null==(n=H.arrow)?void 0:n.x,q=null==(i=H.arrow)?void 0:i.y,Z=0!==(null==(s=H.arrow)?void 0:s.centerOffset),[J,Q]=C.useState();return PE((()=>{_&&Q(window.getComputedStyle(_).zIndex)}),[_]),k.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:K?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[null==(r=H.transformOrigin)?void 0:r.x,null==(o=H.transformOrigin)?void 0:o.y].join(" "),...(null==(a=H.hide)?void 0:a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:k.jsx(LD,{scope:l,placedSide:V,onArrowChange:T,arrowX:X,arrowY:q,shouldHideArrow:Z,children:k.jsx(zE.div,{"data-side":V,"data-align":Y,...b,ref:I,style:{...b.style,animation:K?void 0:"none"}})})})}));FD.displayName=RD;var ND="PopperArrow",$D={top:"bottom",right:"left",bottom:"top",left:"right"},BD=C.forwardRef((function(e,t){const{__scopePopper:n,...i}=e,s=zD(ND,n),r=$D[s.placedSide];return k.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[r]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:k.jsx(_D,{...i,ref:t,style:{...i.style,display:"block"}})})}));function UD(e){return null!==e}BD.displayName=ND;var KD=e=>({name:"transformOrigin",options:e,fn(t){var n,i,s;const{placement:r,rects:o,middlewareData:a}=t,l=0!==(null==(n=a.arrow)?void 0:n.centerOffset),c=l?0:e.arrowWidth,d=l?0:e.arrowHeight,[h,u]=HD(r),p={start:"0%",center:"50%",end:"100%"}[u],g=((null==(i=a.arrow)?void 0:i.x)??0)+c/2,f=((null==(s=a.arrow)?void 0:s.y)??0)+d/2;let m="",y="";return"bottom"===h?(m=l?p:`${g}px`,y=-d+"px"):"top"===h?(m=l?p:`${g}px`,y=`${o.floating.height+d}px`):"right"===h?(m=-d+"px",y=l?p:`${f}px`):"left"===h&&(m=`${o.floating.width+d}px`,y=l?p:`${f}px`),{data:{x:m,y:y}}}});function HD(e){const[t,n="center"]=e.split("-");return[t,n]}var VD=AD,WD=DD,YD=FD,GD=BD,XD="Popover",[qD,ZD]=CE(XD,[ED]),JD=ED(),[QD,eR]=qD(XD),tR=e=>{const{__scopePopover:t,children:n,open:i,defaultOpen:s,onOpenChange:r,modal:o=!1}=e,a=JD(t),l=C.useRef(null),[c,d]=C.useState(!1),[h=!1,u]=ME({prop:i,defaultProp:s,onChange:r});return k.jsx(VD,{...a,children:k.jsx(QD,{scope:t,contentId:EE(),triggerRef:l,open:h,onOpenChange:u,onOpenToggle:C.useCallback((()=>u((e=>!e))),[u]),hasCustomAnchor:c,onCustomAnchorAdd:C.useCallback((()=>d(!0)),[]),onCustomAnchorRemove:C.useCallback((()=>d(!1)),[]),modal:o,children:n})})};tR.displayName=XD;var nR="PopoverAnchor";C.forwardRef(((e,t)=>{const{__scopePopover:n,...i}=e,s=eR(nR,n),r=JD(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=s;return C.useEffect((()=>(o(),()=>a())),[o,a]),k.jsx(WD,{...r,...i,ref:t})})).displayName=nR;var iR="PopoverTrigger",sR=C.forwardRef(((e,t)=>{const{__scopePopover:n,...i}=e,s=eR(iR,n),r=JD(n),o=kE(t,s.triggerRef),a=k.jsx(zE.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":fR(s.open),...i,ref:o,onClick:bE(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?a:k.jsx(WD,{asChild:!0,...r,children:a})}));sR.displayName=iR;var rR="PopoverPortal",[oR,aR]=qD(rR,{forceMount:void 0}),lR=e=>{const{__scopePopover:t,forceMount:n,children:i,container:s}=e,r=eR(rR,t);return k.jsx(oR,{scope:t,forceMount:n,children:k.jsx(aT,{present:n||r.open,children:k.jsx(oT,{asChild:!0,container:s,children:i})})})};lR.displayName=rR;var cR="PopoverContent",dR=C.forwardRef(((e,t)=>{const n=aR(cR,e.__scopePopover),{forceMount:i=n.forceMount,...s}=e,r=eR(cR,e.__scopePopover);return k.jsx(aT,{present:i||r.open,children:r.modal?k.jsx(hR,{...s,ref:t}):k.jsx(uR,{...s,ref:t})})}));dR.displayName=cR;var hR=C.forwardRef(((e,t)=>{const n=eR(cR,e.__scopePopover),i=C.useRef(null),s=kE(t,i),r=C.useRef(!1);return C.useEffect((()=>{const e=i.current;if(e)return iM(e)}),[]),k.jsx(qT,{as:AE,allowPinchZoom:!0,children:k.jsx(pR,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:bE(e.onCloseAutoFocus,(e=>{var t;e.preventDefault(),r.current||null==(t=n.triggerRef.current)||t.focus()})),onPointerDownOutside:bE(e.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,i=2===t.button||n;r.current=i}),{checkForDefaultPrevented:!1}),onFocusOutside:bE(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})})})),uR=C.forwardRef(((e,t)=>{const n=eR(cR,e.__scopePopover),i=C.useRef(!1),s=C.useRef(!1);return k.jsx(pR,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var r,o;null==(r=e.onCloseAutoFocus)||r.call(e,t),t.defaultPrevented||(i.current||null==(o=n.triggerRef.current)||o.focus(),t.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:t=>{var r,o;null==(r=e.onInteractOutside)||r.call(e,t),t.defaultPrevented||(i.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));const a=t.target;(null==(o=n.triggerRef.current)?void 0:o.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})})),pR=C.forwardRef(((e,t)=>{const{__scopePopover:n,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:r,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...h}=e,u=eR(cR,n),p=JD(n);return dT(),k.jsx(QE,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:r,children:k.jsx(HE,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>u.onOpenChange(!1),children:k.jsx(YD,{"data-state":fR(u.open),role:"dialog",id:u.contentId,...p,...h,ref:t,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})})),gR="PopoverClose";C.forwardRef(((e,t)=>{const{__scopePopover:n,...i}=e,s=eR(gR,n);return k.jsx(zE.button,{type:"button",...i,ref:t,onClick:bE(e.onClick,(()=>s.onOpenChange(!1)))})})).displayName=gR;function fR(e){return e?"open":"closed"}C.forwardRef(((e,t)=>{const{__scopePopover:n,...i}=e,s=JD(n);return k.jsx(GD,{...s,...i,ref:t})})).displayName="PopoverArrow";var mR=tR,yR=sR,xR=lR,wR=dR;function vR(e,t){const n=jm(),i=C.useRef(!1),s=BM(),r=C.useCallback((s=>{i.current=s,n.batch((()=>{s?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter((t=>!t.startsWith(e)))}),null==t||t(s)}))}),[n,e,t]),o=Ru("is menu open",(()=>n.getOpenMenus().includes(e)),[n,e]);return C.useEffect((()=>(i.current&&(s("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{i.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach((t=>{t.startsWith(e)&&(s("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(t))})),i.current=!1)})),[n,e,s]),[o,r]}function bR({id:e,children:t,onOpenChange:n,open:i}){const[s,r]=vR(e,n);return k.jsx(mR,{onOpenChange:r,open:i||s,children:k.jsx("div",{className:"tlui-popover",children:t})})}function SR({children:e}){return k.jsx(yR,{asChild:!0,dir:"ltr",children:e})}function kR({side:e,children:t,align:n="center",sideOffset:i=8,alignOffset:s=0}){const r=Ay();return k.jsx(xR,{container:r,children:k.jsx(wR,{className:"tlui-popover__content",side:e,sideOffset:i,align:n,alignOffset:s,dir:"ltr",children:t})})}const CR=C.createContext(null);function _R(){const e=C.useContext(CR);if(!e)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return e}function PR({type:e,sourceId:t,children:n}){return k.jsx(CR.Provider,{value:{type:e,sourceId:t},children:n})}const IR=()=>{const e=jm();return Ru("threeStackableItems",(()=>function(e){return e.getSelectedShapeIds().map((t=>e.getShape(t))).filter((t=>{if(!t)return!1;if(e.isShapeOfType(t,"arrow")){const n=iC(e,t);if(n.start||n.end)return!1}return!0}))}(e).length>2),[e])},jR=()=>{const e=jm();return Ru("isInSelectState",(()=>e.isIn("select")),[e])},ER=()=>{const e=jm();return Ru("allow group",(()=>{const t=e.getSelectedShapes();if(t.length<2)return!1;for(const n of t)if(e.isShapeOfType(n,"arrow")){const i=iC(e,n);if(i.start&&!t.some((e=>e.id===i.start.toId)))return!1;if(i.end&&!t.some((e=>e.id===i.end.toId)))return!1}return!0}),[e])},TR=()=>{const e=jm();return Ru("allowUngroup",(()=>e.getSelectedShapeIds().some((t=>{var n;return"group"===(null==(n=e.getShape(t))?void 0:n.type)}))),[e])},MR="undefined"!=typeof window&&"navigator"in window&&Boolean(navigator.clipboard)&&Boolean(navigator.clipboard.read);function AR(e,t){const n=jm();return Ru("selectedShapes",(()=>{const t=n.getSelectedShapes().filter((e=>!n.isShapeOrAncestorLocked(e))).length;return void 0===e?t:t>=e}),[n])}function OR(){const e=jm();return Ru("hasLinkShapeSelected",(()=>{const t=e.getOnlySelectedShape();return!(!t||"embed"===t.type||!("url"in t.props)||t.isLocked)}),[e])}function DR(){const e=jm();return Ru("useCanRedo",(()=>e.getCanRedo()),[e])}function RR(){const e=jm();return Ru("useCanUndo",(()=>e.getCanUndo()),[e])}var LR=C.createContext(void 0);function zR(e){const t=C.useContext(LR);return e||t||"ltr"}var FR="rovingFocusGroup.onEntryFocus",NR={bubbles:!1,cancelable:!0},$R="RovingFocusGroup",[BR,UR,KR]=XM($R),[HR,VR]=CE($R,[KR]),[WR,YR]=HR($R),GR=C.forwardRef(((e,t)=>k.jsx(BR.Provider,{scope:e.__scopeRovingFocusGroup,children:k.jsx(BR.Slot,{scope:e.__scopeRovingFocusGroup,children:k.jsx(XR,{...e,ref:t})})})));GR.displayName=$R;var XR=C.forwardRef(((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:i,loop:s=!1,dir:r,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...h}=e,u=C.useRef(null),p=kE(t,u),g=zR(r),[f=null,m]=ME({prop:o,defaultProp:a,onChange:l}),[y,x]=C.useState(!1),w=TE(c),v=UR(n),b=C.useRef(!1),[S,_]=C.useState(0);return C.useEffect((()=>{const e=u.current;if(e)return e.addEventListener(FR,w),()=>e.removeEventListener(FR,w)}),[w]),k.jsx(WR,{scope:n,orientation:i,dir:g,loop:s,currentTabStopId:f,onItemFocus:C.useCallback((e=>m(e)),[m]),onItemShiftTab:C.useCallback((()=>x(!0)),[]),onFocusableItemAdd:C.useCallback((()=>_((e=>e+1))),[]),onFocusableItemRemove:C.useCallback((()=>_((e=>e-1))),[]),children:k.jsx(zE.div,{tabIndex:y||0===S?-1:0,"data-orientation":i,...h,ref:p,style:{outline:"none",...e.style},onMouseDown:bE(e.onMouseDown,(()=>{b.current=!0})),onFocus:bE(e.onFocus,(e=>{const t=!b.current;if(e.target===e.currentTarget&&t&&!y){const t=new CustomEvent(FR,NR);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=v().filter((e=>e.focusable));QR([e.find((e=>e.active)),e.find((e=>e.id===f)),...e].filter(Boolean).map((e=>e.ref.current)),d)}}b.current=!1})),onBlur:bE(e.onBlur,(()=>x(!1)))})})})),qR="RovingFocusGroupItem",ZR=C.forwardRef(((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:i=!0,active:s=!1,tabStopId:r,...o}=e,a=EE(),l=r||a,c=YR(qR,n),d=c.currentTabStopId===l,h=UR(n),{onFocusableItemAdd:u,onFocusableItemRemove:p}=c;return C.useEffect((()=>{if(i)return u(),()=>p()}),[i,u,p]),k.jsx(BR.ItemSlot,{scope:n,id:l,focusable:i,active:s,children:k.jsx(zE.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...o,ref:t,onMouseDown:bE(e.onMouseDown,(e=>{i?c.onItemFocus(l):e.preventDefault()})),onFocus:bE(e.onFocus,(()=>c.onItemFocus(l))),onKeyDown:bE(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void c.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const i=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(i)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)?void 0:JR[i]}(e,c.orientation,c.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=h().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)s.reverse();else if("prev"===t||"next"===t){"prev"===t&&s.reverse();const r=s.indexOf(e.currentTarget);s=c.loop?(i=r+1,(n=s).map(((e,t)=>n[(i+t)%n.length]))):s.slice(r+1)}setTimeout((()=>QR(s)))}var n,i}))})})}));ZR.displayName=qR;var JR={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function QR(e,t=!1){const n=document.activeElement;for(const i of e){if(i===n)return;if(i.focus({preventScroll:t}),document.activeElement!==n)return}}var eL=GR,tL=ZR,nL=["Enter"," "],iL=["ArrowUp","PageDown","End"],sL=["ArrowDown","PageUp","Home",...iL],rL={ltr:[...nL,"ArrowRight"],rtl:[...nL,"ArrowLeft"]},oL={ltr:["ArrowLeft"],rtl:["ArrowRight"]},aL="Menu",[lL,cL,dL]=XM(aL),[hL,uL]=CE(aL,[dL,ED,VR]),pL=ED(),gL=VR(),[fL,mL]=hL(aL),[yL,xL]=hL(aL),wL=e=>{const{__scopeMenu:t,open:n=!1,children:i,dir:s,onOpenChange:r,modal:o=!0}=e,a=pL(t),[l,c]=C.useState(null),d=C.useRef(!1),h=TE(r),u=zR(s);return C.useEffect((()=>{const e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),k.jsx(VD,{...a,children:k.jsx(fL,{scope:t,open:n,onOpenChange:h,content:l,onContentChange:c,children:k.jsx(yL,{scope:t,onClose:C.useCallback((()=>h(!1)),[h]),isUsingKeyboardRef:d,dir:u,modal:o,children:i})})})};wL.displayName=aL;var vL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,...i}=e,s=pL(n);return k.jsx(WD,{...s,...i,ref:t})}));vL.displayName="MenuAnchor";var bL="MenuPortal",[SL,kL]=hL(bL,{forceMount:void 0}),CL=e=>{const{__scopeMenu:t,forceMount:n,children:i,container:s}=e,r=mL(bL,t);return k.jsx(SL,{scope:t,forceMount:n,children:k.jsx(aT,{present:n||r.open,children:k.jsx(oT,{asChild:!0,container:s,children:i})})})};CL.displayName=bL;var _L="MenuContent",[PL,IL]=hL(_L),jL=C.forwardRef(((e,t)=>{const n=kL(_L,e.__scopeMenu),{forceMount:i=n.forceMount,...s}=e,r=mL(_L,e.__scopeMenu),o=xL(_L,e.__scopeMenu);return k.jsx(lL.Provider,{scope:e.__scopeMenu,children:k.jsx(aT,{present:i||r.open,children:k.jsx(lL.Slot,{scope:e.__scopeMenu,children:o.modal?k.jsx(EL,{...s,ref:t}):k.jsx(TL,{...s,ref:t})})})})})),EL=C.forwardRef(((e,t)=>{const n=mL(_L,e.__scopeMenu),i=C.useRef(null),s=kE(t,i);return C.useEffect((()=>{const e=i.current;if(e)return iM(e)}),[]),k.jsx(ML,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:bE(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})})),TL=C.forwardRef(((e,t)=>{const n=mL(_L,e.__scopeMenu);return k.jsx(ML,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})})),ML=C.forwardRef(((e,t)=>{const{__scopeMenu:n,loop:i=!1,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:u,onDismiss:p,disableOutsideScroll:g,...f}=e,m=mL(_L,n),y=xL(_L,n),x=pL(n),w=gL(n),v=cL(n),[b,S]=C.useState(null),_=C.useRef(null),P=kE(t,_,m.onContentChange),I=C.useRef(0),j=C.useRef(""),E=C.useRef(0),T=C.useRef(null),M=C.useRef("right"),A=C.useRef(0),O=g?qT:C.Fragment,D=g?{as:AE,allowPinchZoom:!0}:void 0,R=e=>{var t,n;const i=j.current+e,s=v().filter((e=>!e.disabled)),r=document.activeElement,o=null==(t=s.find((e=>e.ref.current===r)))?void 0:t.textValue,a=function(e,t,n){const i=t.length>1&&Array.from(t).every((e=>e===t[0])),s=i?t[0]:t,r=n?e.indexOf(n):-1;let o=(a=e,l=Math.max(r,0),a.map(((e,t)=>a[(l+t)%a.length])));var a,l;1===s.length&&(o=o.filter((e=>e!==n)));const c=o.find((e=>e.toLowerCase().startsWith(s.toLowerCase())));return c!==n?c:void 0}(s.map((e=>e.textValue)),i,o),l=null==(n=s.find((e=>e.textValue===a)))?void 0:n.ref.current;!function e(t){j.current=t,window.clearTimeout(I.current),""!==t&&(I.current=window.setTimeout((()=>e("")),1e3))}(i),l&&setTimeout((()=>l.focus()))};C.useEffect((()=>()=>window.clearTimeout(I.current)),[]),dT();const L=C.useCallback((e=>{var t,n;return M.current===(null==(t=T.current)?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:i}=e;let s=!1;for(let r=0,o=t.length-1;r<t.length;o=r++){const e=t[r].x,a=t[r].y,l=t[o].x,c=t[o].y;a>i!=c>i&&n<(l-e)*(i-a)/(c-a)+e&&(s=!s)}return s}(n,t)}(e,null==(n=T.current)?void 0:n.area)}),[]);return k.jsx(PL,{scope:n,searchRef:j,onItemEnter:C.useCallback((e=>{L(e)&&e.preventDefault()}),[L]),onItemLeave:C.useCallback((e=>{var t;L(e)||(null==(t=_.current)||t.focus(),S(null))}),[L]),onTriggerLeave:C.useCallback((e=>{L(e)&&e.preventDefault()}),[L]),pointerGraceTimerRef:E,onPointerGraceIntentChange:C.useCallback((e=>{T.current=e}),[]),children:k.jsx(O,{...D,children:k.jsx(QE,{asChild:!0,trapped:s,onMountAutoFocus:bE(r,(e=>{var t;e.preventDefault(),null==(t=_.current)||t.focus({preventScroll:!0})})),onUnmountAutoFocus:o,children:k.jsx(HE,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:u,onDismiss:p,children:k.jsx(eL,{asChild:!0,...w,dir:y.dir,orientation:"vertical",loop:i,currentTabStopId:b,onCurrentTabStopIdChange:S,onEntryFocus:bE(l,(e=>{y.isUsingKeyboardRef.current||e.preventDefault()})),preventScrollOnEntryFocus:!0,children:k.jsx(YD,{role:"menu","aria-orientation":"vertical","data-state":rz(m.open),"data-radix-menu-content":"",dir:y.dir,...x,...f,ref:P,style:{outline:"none",...f.style},onKeyDown:bE(f.onKeyDown,(e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,i=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&i&&R(e.key));const s=_.current;if(e.target!==s)return;if(!sL.includes(e.key))return;e.preventDefault();const r=v().filter((e=>!e.disabled)).map((e=>e.ref.current));iL.includes(e.key)&&r.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(r)})),onBlur:bE(e.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(I.current),j.current="")})),onPointerMove:bE(e.onPointerMove,lz((e=>{const t=e.target,n=A.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>A.current?"right":"left";M.current=t,A.current=e.clientX}})))})})})})})})}));jL.displayName=_L;var AL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,...i}=e;return k.jsx(zE.div,{role:"group",...i,ref:t})}));AL.displayName="MenuGroup";var OL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,...i}=e;return k.jsx(zE.div,{...i,ref:t})}));OL.displayName="MenuLabel";var DL="MenuItem",RL="menu.itemSelect",LL=C.forwardRef(((e,t)=>{const{disabled:n=!1,onSelect:i,...s}=e,r=C.useRef(null),o=xL(DL,e.__scopeMenu),a=IL(DL,e.__scopeMenu),l=kE(t,r),c=C.useRef(!1);return k.jsx(zL,{...s,ref:l,disabled:n,onClick:bE(e.onClick,(()=>{const e=r.current;if(!n&&e){const t=new CustomEvent(RL,{bubbles:!0,cancelable:!0});e.addEventListener(RL,(e=>null==i?void 0:i(e)),{once:!0}),FE(e,t),t.defaultPrevented?c.current=!1:o.onClose()}})),onPointerDown:t=>{var n;null==(n=e.onPointerDown)||n.call(e,t),c.current=!0},onPointerUp:bE(e.onPointerUp,(e=>{var t;c.current||null==(t=e.currentTarget)||t.click()})),onKeyDown:bE(e.onKeyDown,(e=>{const t=""!==a.searchRef.current;n||t&&" "===e.key||nL.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))})}));LL.displayName=DL;var zL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,disabled:i=!1,textValue:s,...r}=e,o=IL(DL,n),a=gL(n),l=C.useRef(null),c=kE(t,l),[d,h]=C.useState(!1),[u,p]=C.useState("");return C.useEffect((()=>{const e=l.current;e&&p((e.textContent??"").trim())}),[r.children]),k.jsx(lL.ItemSlot,{scope:n,disabled:i,textValue:s??u,children:k.jsx(tL,{asChild:!0,...a,focusable:!i,children:k.jsx(zE.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...r,ref:c,onPointerMove:bE(e.onPointerMove,lz((e=>{if(i)o.onItemLeave(e);else if(o.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}}))),onPointerLeave:bE(e.onPointerLeave,lz((e=>o.onItemLeave(e)))),onFocus:bE(e.onFocus,(()=>h(!0))),onBlur:bE(e.onBlur,(()=>h(!1)))})})})})),FL=C.forwardRef(((e,t)=>{const{checked:n=!1,onCheckedChange:i,...s}=e;return k.jsx(WL,{scope:e.__scopeMenu,checked:n,children:k.jsx(LL,{role:"menuitemcheckbox","aria-checked":oz(n)?"mixed":n,...s,ref:t,"data-state":az(n),onSelect:bE(s.onSelect,(()=>null==i?void 0:i(!!oz(n)||!n)),{checkForDefaultPrevented:!1})})})}));FL.displayName="MenuCheckboxItem";var NL="MenuRadioGroup",[$L,BL]=hL(NL,{value:void 0,onValueChange:()=>{}}),UL=C.forwardRef(((e,t)=>{const{value:n,onValueChange:i,...s}=e,r=TE(i);return k.jsx($L,{scope:e.__scopeMenu,value:n,onValueChange:r,children:k.jsx(AL,{...s,ref:t})})}));UL.displayName=NL;var KL="MenuRadioItem",HL=C.forwardRef(((e,t)=>{const{value:n,...i}=e,s=BL(KL,e.__scopeMenu),r=n===s.value;return k.jsx(WL,{scope:e.__scopeMenu,checked:r,children:k.jsx(LL,{role:"menuitemradio","aria-checked":r,...i,ref:t,"data-state":az(r),onSelect:bE(i.onSelect,(()=>{var e;return null==(e=s.onValueChange)?void 0:e.call(s,n)}),{checkForDefaultPrevented:!1})})})}));HL.displayName=KL;var VL="MenuItemIndicator",[WL,YL]=hL(VL,{checked:!1}),GL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,forceMount:i,...s}=e,r=YL(VL,n);return k.jsx(aT,{present:i||oz(r.checked)||!0===r.checked,children:k.jsx(zE.span,{...s,ref:t,"data-state":az(r.checked)})})}));GL.displayName=VL;var XL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,...i}=e;return k.jsx(zE.div,{role:"separator","aria-orientation":"horizontal",...i,ref:t})}));XL.displayName="MenuSeparator";var qL=C.forwardRef(((e,t)=>{const{__scopeMenu:n,...i}=e,s=pL(n);return k.jsx(GD,{...s,...i,ref:t})}));qL.displayName="MenuArrow";var ZL="MenuSub",[JL,QL]=hL(ZL),ez=e=>{const{__scopeMenu:t,children:n,open:i=!1,onOpenChange:s}=e,r=mL(ZL,t),o=pL(t),[a,l]=C.useState(null),[c,d]=C.useState(null),h=TE(s);return C.useEffect((()=>(!1===r.open&&h(!1),()=>h(!1))),[r.open,h]),k.jsx(VD,{...o,children:k.jsx(fL,{scope:t,open:i,onOpenChange:h,content:c,onContentChange:d,children:k.jsx(JL,{scope:t,contentId:EE(),triggerId:EE(),trigger:a,onTriggerChange:l,children:n})})})};ez.displayName=ZL;var tz="MenuSubTrigger",nz=C.forwardRef(((e,t)=>{const n=mL(tz,e.__scopeMenu),i=xL(tz,e.__scopeMenu),s=QL(tz,e.__scopeMenu),r=IL(tz,e.__scopeMenu),o=C.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=r,c={__scopeMenu:e.__scopeMenu},d=C.useCallback((()=>{o.current&&window.clearTimeout(o.current),o.current=null}),[]);return C.useEffect((()=>d),[d]),C.useEffect((()=>{const e=a.current;return()=>{window.clearTimeout(e),l(null)}}),[a,l]),k.jsx(vL,{asChild:!0,...c,children:k.jsx(zL,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":s.contentId,"data-state":rz(n.open),...e,ref:SE(t,s.onTriggerChange),onClick:t=>{var i;null==(i=e.onClick)||i.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:bE(e.onPointerMove,lz((t=>{r.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||o.current||(r.onPointerGraceIntentChange(null),o.current=window.setTimeout((()=>{n.onOpenChange(!0),d()}),100))}))),onPointerLeave:bE(e.onPointerLeave,lz((e=>{var t,i;d();const s=null==(t=n.content)?void 0:t.getBoundingClientRect();if(s){const t=null==(i=n.content)?void 0:i.dataset.side,o="right"===t,l=o?-5:5,c=s[o?"left":"right"],d=s[o?"right":"left"];r.onPointerGraceIntentChange({area:[{x:e.clientX+l,y:e.clientY},{x:c,y:s.top},{x:d,y:s.top},{x:d,y:s.bottom},{x:c,y:s.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout((()=>r.onPointerGraceIntentChange(null)),300)}else{if(r.onTriggerLeave(e),e.defaultPrevented)return;r.onPointerGraceIntentChange(null)}}))),onKeyDown:bE(e.onKeyDown,(t=>{var s;const o=""!==r.searchRef.current;e.disabled||o&&" "===t.key||rL[i.dir].includes(t.key)&&(n.onOpenChange(!0),null==(s=n.content)||s.focus(),t.preventDefault())}))})})}));nz.displayName=tz;var iz="MenuSubContent",sz=C.forwardRef(((e,t)=>{const n=kL(_L,e.__scopeMenu),{forceMount:i=n.forceMount,...s}=e,r=mL(_L,e.__scopeMenu),o=xL(_L,e.__scopeMenu),a=QL(iz,e.__scopeMenu),l=C.useRef(null),c=kE(t,l);return k.jsx(lL.Provider,{scope:e.__scopeMenu,children:k.jsx(aT,{present:i||r.open,children:k.jsx(lL.Slot,{scope:e.__scopeMenu,children:k.jsx(ML,{id:a.contentId,"aria-labelledby":a.triggerId,...s,ref:c,align:"start",side:"rtl"===o.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;o.isUsingKeyboardRef.current&&(null==(t=l.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:bE(e.onFocusOutside,(e=>{e.target!==a.trigger&&r.onOpenChange(!1)})),onEscapeKeyDown:bE(e.onEscapeKeyDown,(e=>{o.onClose(),e.preventDefault()})),onKeyDown:bE(e.onKeyDown,(e=>{var t;const n=e.currentTarget.contains(e.target),i=oL[o.dir].includes(e.key);n&&i&&(r.onOpenChange(!1),null==(t=a.trigger)||t.focus(),e.preventDefault())}))})})})})}));function rz(e){return e?"open":"closed"}function oz(e){return"indeterminate"===e}function az(e){return oz(e)?"indeterminate":e?"checked":"unchecked"}function lz(e){return t=>"mouse"===t.pointerType?e(t):void 0}sz.displayName=iz;var cz=wL,dz=vL,hz=CL,uz=jL,pz=AL,gz=OL,fz=LL,mz=FL,yz=UL,xz=HL,wz=GL,vz=XL,bz=qL,Sz=ez,kz=nz,Cz=sz,_z="ContextMenu",[Pz,Iz]=CE(_z,[uL]),jz=uL(),[Ez,Tz]=Pz(_z),Mz=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:i,dir:s,modal:r=!0}=e,[o,a]=C.useState(!1),l=jz(t),c=TE(i),d=C.useCallback((e=>{a(e),c(e)}),[c]);return k.jsx(Ez,{scope:t,open:o,onOpenChange:d,modal:r,children:k.jsx(cz,{...l,dir:s,open:o,onOpenChange:d,modal:r,children:n})})};Mz.displayName=_z;var Az="ContextMenuTrigger",Oz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,disabled:i=!1,...s}=e,r=Tz(Az,n),o=jz(n),a=C.useRef({x:0,y:0}),l=C.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=C.useRef(0),d=C.useCallback((()=>window.clearTimeout(c.current)),[]),h=e=>{a.current={x:e.clientX,y:e.clientY},r.onOpenChange(!0)};return C.useEffect((()=>d),[d]),C.useEffect((()=>{i&&d()}),[i,d]),k.jsxs(k.Fragment,{children:[k.jsx(dz,{...o,virtualRef:l}),k.jsx(zE.span,{"data-state":r.open?"open":"closed","data-disabled":i?"":void 0,...s,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:i?e.onContextMenu:bE(e.onContextMenu,(e=>{d(),h(e),e.preventDefault()})),onPointerDown:i?e.onPointerDown:bE(e.onPointerDown,Kz((e=>{d(),c.current=window.setTimeout((()=>h(e)),700)}))),onPointerMove:i?e.onPointerMove:bE(e.onPointerMove,Kz(d)),onPointerCancel:i?e.onPointerCancel:bE(e.onPointerCancel,Kz(d)),onPointerUp:i?e.onPointerUp:bE(e.onPointerUp,Kz(d))})]})}));Oz.displayName=Az;var Dz=e=>{const{__scopeContextMenu:t,...n}=e,i=jz(t);return k.jsx(hz,{...i,...n})};Dz.displayName="ContextMenuPortal";var Rz="ContextMenuContent",Lz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=Tz(Rz,n),r=jz(n),o=C.useRef(!1);return k.jsx(uz,{...r,...i,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null==(n=e.onCloseAutoFocus)||n.call(e,t),!t.defaultPrevented&&o.current&&t.preventDefault(),o.current=!1},onInteractOutside:t=>{var n;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||s.modal||(o.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));Lz.displayName=Rz;var zz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(pz,{...s,...i,ref:t})}));zz.displayName="ContextMenuGroup";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(gz,{...s,...i,ref:t})})).displayName="ContextMenuLabel";var Fz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(fz,{...s,...i,ref:t})}));Fz.displayName="ContextMenuItem";var Nz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(mz,{...s,...i,ref:t})}));Nz.displayName="ContextMenuCheckboxItem";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(yz,{...s,...i,ref:t})})).displayName="ContextMenuRadioGroup";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(xz,{...s,...i,ref:t})})).displayName="ContextMenuRadioItem";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(wz,{...s,...i,ref:t})})).displayName="ContextMenuItemIndicator";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(vz,{...s,...i,ref:t})})).displayName="ContextMenuSeparator";C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(bz,{...s,...i,ref:t})})).displayName="ContextMenuArrow";var $z=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:i,open:s,defaultOpen:r}=e,o=jz(t),[a,l]=ME({prop:s,defaultProp:r,onChange:i});return k.jsx(Sz,{...o,open:a,onOpenChange:l,children:n})};$z.displayName="ContextMenuSub";var Bz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(kz,{...s,...i,ref:t})}));Bz.displayName="ContextMenuSubTrigger";var Uz=C.forwardRef(((e,t)=>{const{__scopeContextMenu:n,...i}=e,s=jz(n);return k.jsx(Cz,{...s,...i,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));function Kz(e){return t=>"mouse"!==t.pointerType?e(t):void 0}Uz.displayName="ContextMenuSubContent";var Hz=Mz,Vz=Oz,Wz=Dz,Yz=Lz,Gz=Nz;const Xz="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,qz=Xz?"â":"Ctrl",Zz=Xz?"â¥":"Alt";function Jz(e){return e.split(",")[0].split("").map((e=>{const t=e.replace(/\$/g,qz).replace(/\?/g,Zz).replace(/!/g,"â§");return t[0].toUpperCase()+t.slice(1)}))}function Qz(e){return"â "+Jz(e).join("â")}function eF(e){return k.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:k.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[k.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),k.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:k.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var tF="DropdownMenu",[nF,iF]=CE(tF,[uL]),sF=uL(),[rF,oF]=nF(tF),aF=e=>{const{__scopeDropdownMenu:t,children:n,dir:i,open:s,defaultOpen:r,onOpenChange:o,modal:a=!0}=e,l=sF(t),c=C.useRef(null),[d=!1,h]=ME({prop:s,defaultProp:r,onChange:o});return k.jsx(rF,{scope:t,triggerId:EE(),triggerRef:c,contentId:EE(),open:d,onOpenChange:h,onOpenToggle:C.useCallback((()=>h((e=>!e))),[h]),modal:a,children:k.jsx(cz,{...l,open:d,onOpenChange:h,dir:i,modal:a,children:n})})};aF.displayName=tF;var lF="DropdownMenuTrigger",cF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,disabled:i=!1,...s}=e,r=oF(lF,n),o=sF(n);return k.jsx(dz,{asChild:!0,...o,children:k.jsx(zE.button,{type:"button",id:r.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":r.open?r.contentId:void 0,"data-state":r.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...s,ref:SE(t,r.triggerRef),onPointerDown:bE(e.onPointerDown,(e=>{i||0!==e.button||!1!==e.ctrlKey||(r.onOpenToggle(),r.open||e.preventDefault())})),onKeyDown:bE(e.onKeyDown,(e=>{i||(["Enter"," "].includes(e.key)&&r.onOpenToggle(),"ArrowDown"===e.key&&r.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())}))})})}));cF.displayName=lF;var dF=e=>{const{__scopeDropdownMenu:t,...n}=e,i=sF(t);return k.jsx(hz,{...i,...n})};dF.displayName="DropdownMenuPortal";var hF="DropdownMenuContent",uF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=oF(hF,n),r=sF(n),o=C.useRef(!1);return k.jsx(uz,{id:s.contentId,"aria-labelledby":s.triggerId,...r,...i,ref:t,onCloseAutoFocus:bE(e.onCloseAutoFocus,(e=>{var t;o.current||null==(t=s.triggerRef.current)||t.focus(),o.current=!1,e.preventDefault()})),onInteractOutside:bE(e.onInteractOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,i=2===t.button||n;s.modal&&!i||(o.current=!0)})),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));uF.displayName=hF;var pF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(pz,{...s,...i,ref:t})}));pF.displayName="DropdownMenuGroup";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(gz,{...s,...i,ref:t})})).displayName="DropdownMenuLabel";var gF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(fz,{...s,...i,ref:t})}));gF.displayName="DropdownMenuItem";var fF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(mz,{...s,...i,ref:t})}));fF.displayName="DropdownMenuCheckboxItem";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(yz,{...s,...i,ref:t})})).displayName="DropdownMenuRadioGroup";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(xz,{...s,...i,ref:t})})).displayName="DropdownMenuRadioItem";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(wz,{...s,...i,ref:t})})).displayName="DropdownMenuItemIndicator";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(vz,{...s,...i,ref:t})})).displayName="DropdownMenuSeparator";C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(bz,{...s,...i,ref:t})})).displayName="DropdownMenuArrow";var mF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(kz,{...s,...i,ref:t})}));mF.displayName="DropdownMenuSubTrigger";var yF=C.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,...i}=e,s=sF(n);return k.jsx(Cz,{...s,...i,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));yF.displayName="DropdownMenuSubContent";var xF=aF,wF=cF,vF=dF,bF=uF,SF=pF,kF=gF,CF=fF,_F=e=>{const{__scopeDropdownMenu:t,children:n,open:i,onOpenChange:s,defaultOpen:r}=e,o=sF(t),[a=!1,l]=ME({prop:i,defaultProp:r,onChange:s});return k.jsx(Sz,{...o,open:a,onOpenChange:l,children:n})},PF=mF,IF=yF;function jF({id:e,children:t,modal:n=!1,debugOpen:i=!1}){const[s,r]=vR(e);return k.jsx(xF,{open:i||s,dir:"ltr",modal:n,onOpenChange:r,children:t})}function EF({children:e,...t}){return k.jsx(wF,{dir:"ltr",asChild:!0,onTouchEnd:e=>Cy(e),...t,children:e})}function TF({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:i=8,children:s}){const r=Ay();return k.jsx(vF,{container:r,children:k.jsx(bF,{className:"tlui-menu",side:e,sideOffset:n,align:t,alignOffset:i,collisionPadding:4,children:s})})}function MF({id:e,children:t}){const[n,i]=vR(e);return k.jsx(_F,{open:n,onOpenChange:i,children:t})}function AF({id:e,label:t,title:n,disabled:i}){return k.jsx(PF,{dir:"ltr",asChild:!0,disabled:i,children:k.jsxs(NA,{"data-testid":e,type:"menu",className:"tlui-menu__submenu__trigger",disabled:i,title:n,children:[k.jsx($A,{children:t}),k.jsx(WA,{icon:"chevron-right",small:!0})]})})}function OF({id:e,alignOffset:t=-1,sideOffset:n=-4,size:i="small",children:s}){const r=Ay();return k.jsx(vF,{container:r,children:k.jsx(IF,{"data-testid":e,className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:n,collisionPadding:4,"data-size":i,children:s})})}function DF({children:e}){return k.jsx(SF,{dir:"ltr",className:"tlui-menu__group",children:e})}function RF({noClose:e,children:t}){return k.jsx(kF,{dir:"ltr",asChild:!0,onClick:e?Cy:void 0,children:t})}function LF({children:e,visibleOnMobileLayout:t=!1}){const n=uO();return!t&&n<GA.MOBILE?null:k.jsx("kbd",{className:"tlui-kbd",children:Jz(e).map(((e,t)=>k.jsx("span",{children:e},t)))})}function zF({disabled:e=!1,spinner:t=!1,readonlyOk:n=!1,id:i,kbd:s,label:r,icon:o,onSelect:a,noClose:l,isSelected:c}){const{type:d,sourceId:h}=_R(),u=oj(),[p,g]=C.useState(!1);if(Vk()&&!n)return null;const f=dD(r,d),m=s?Qz(s):void 0,y=f?u(f):void 0,x=y&&m?`${y} ${m}`:y;switch(d){case"menu":return k.jsx(RF,{children:k.jsxs(NA,{type:"menu","data-testid":`${h}.${i}`,disabled:e,title:x,onClick:e=>{l&&Cy(e),p?g(!1):a(h)},children:[k.jsx($A,{children:y}),s&&k.jsx(LF,{children:s})]})});case"context-menu":return e?null:k.jsxs(Fz,{dir:"ltr",title:x,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${i}`,onSelect:e=>{l&&Cy(e),p?g(!1):a(h)},children:[k.jsx("span",{className:"tlui-button__label",draggable:!1,children:y}),s&&k.jsx(LF,{children:s}),t&&k.jsx(eF,{})]});case"panel":return k.jsxs(NA,{"data-testid":`${h}.${i}`,type:"menu",title:x,disabled:e,onClick:()=>a(h),children:[k.jsx($A,{children:y}),o&&k.jsx(WA,{icon:o})]});case"small-icons":case"icons":return k.jsx(NA,{"data-testid":`${h}.${i}`,type:"icon",title:x,disabled:e,onClick:()=>a(h),children:k.jsx(WA,{icon:o,small:"small-icons"===d})});case"keyboard-shortcuts":return s?k.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${i}`,children:[k.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:y}),k.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:k.jsx(LF,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${r}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return k.jsxs(NA,{type:"low",onClick:()=>a(h),children:[k.jsx(WA,{icon:o}),k.jsx($A,{children:y})]});case"toolbar":return k.jsx(NA,{type:"tool","data-testid":`tools.${i}`,"aria-label":f,"data-value":i,onClick:()=>a("toolbar"),title:x,onTouchStart:e=>{Cy(e),a("toolbar")},role:"radio","aria-checked":c?"true":"false",children:k.jsx(WA,{icon:o})});case"toolbar-overflow":return k.jsx(RF,{"aria-label":r,children:k.jsx(NA,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${i}`,title:x,role:"radio","aria-checked":c?"true":"false","data-value":i,children:k.jsx(WA,{icon:o})})});default:throw wd(d)}}function FF(){return k.jsxs(k.Fragment,{children:[k.jsx(NF,{}),k.jsx($F,{}),k.jsx(BF,{}),k.jsx(UF,{}),k.jsx(KF,{}),k.jsx(WF,{}),k.jsx(YF,{}),k.jsx(GF,{})]})}function NF(){const e=cD(),t=AR(2),n=jR(),i=t&&n;return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e["align-left"],disabled:!i}),k.jsx(zF,{...e["align-center-horizontal"],disabled:!i}),k.jsx(zF,{...e["align-right"],disabled:!i}),k.jsx(zF,{...e["stretch-horizontal"],disabled:!i}),k.jsx(zF,{...e["align-top"],disabled:!i}),k.jsx(zF,{...e["align-center-vertical"],disabled:!i}),k.jsx(zF,{...e["align-bottom"],disabled:!i}),k.jsx(zF,{...e["stretch-vertical"],disabled:!i})]})}function $F(){const e=cD(),t=AR(3),n=jR(),i=t&&n;return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e["distribute-horizontal"],disabled:!i}),k.jsx(zF,{...e["distribute-vertical"],disabled:!i})]})}function BF(){const e=cD(),t=IR(),n=jR(),i=t&&n;return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e["stack-horizontal"],disabled:!i}),k.jsx(zF,{...e["stack-vertical"],disabled:!i})]})}function UF(){const e=cD(),t=AR(1),n=jR(),i=t&&n;return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e["send-to-back"],disabled:!i}),k.jsx(zF,{...e["send-backward"],disabled:!i}),k.jsx(zF,{...e["bring-forward"],disabled:!i}),k.jsx(zF,{...e["bring-to-front"],disabled:!i})]})}function KF(){return uO()<GA.TABLET_SM?k.jsx(HF,{}):k.jsx(VF,{})}function HF(){const e=cD(),t=jm(),n=Ru("zoom is 1",(()=>1===t.getZoomLevel()),[t]);return k.jsx(zF,{...e["zoom-to-100"],disabled:n})}function VF(){const e=cD(),t=AR(1),n=jR(),i=t&&n;return k.jsx(zF,{...e["rotate-ccw"],disabled:!i})}function WF(){const e=cD(),t=AR(1),n=jR(),i=t&&n;return k.jsx(zF,{...e["rotate-cw"],disabled:!i})}function YF(){const e=cD(),t=OR(),n=jR(),i=t&&n;return k.jsx(zF,{...e["edit-link"],disabled:!i})}function GF(){const e=ER(),t=TR();return e?k.jsx(XF,{}):t?k.jsx(qF,{}):k.jsx(XF,{})}function XF(){const e=cD(),t=AR(2),n=jR(),i=t&&n;return k.jsx(zF,{...e.group,disabled:!i})}function qF(){const e=cD();return k.jsx(zF,{...e.ungroup})}const ZF=C.memo((function({children:e}){const t=oj(),n=uO(),i=Vk(),s=jm(),r=Ru("should display quick actions when in readonly",(()=>s.isInAny("hand","zoom")),[s]),o=e??k.jsx(FF,{});if(!i||r)return k.jsxs(bR,{id:"actions-menu",children:[k.jsx(SR,{children:k.jsx(NA,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:k.jsx(WA,{icon:"dots-vertical",small:!0})})}),k.jsx(kR,{side:n>=GA.TABLET?"bottom":"top",sideOffset:6,children:k.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:k.jsx(PR,{type:"icons",sourceId:"actions-menu",children:o})})})]})}));function JF({id:e,kbd:t,label:n,readonlyOk:i,onSelect:s,toggle:r=!1,disabled:o=!1,checked:a=!1}){const{type:l,sourceId:c}=_R(),d=Vk(),h=oj();if(d&&!i)return null;const u=dD(n,l),p=u?h(u):void 0;switch(l){case"menu":return k.jsxs(CF,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:p,onSelect:e=>{null==s||s(c),Cy(e)},disabled:o,checked:a,children:[k.jsx(BA,{small:!0,icon:r?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&k.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),t&&k.jsx(LF,{children:t})]});case"context-menu":return k.jsxs(Gz,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:p,onSelect:e=>{s(c),Cy(e)},disabled:o,checked:a,children:[k.jsx(BA,{small:!0,icon:r?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&k.jsx("span",{className:"tlui-button__label",draggable:!1,children:p}),t&&k.jsx(LF,{children:t})]},e);default:return null}}function QF({id:e,label:t,children:n}){const{type:i,sourceId:s}=_R(),r=oj(),o=dD(t,i),a=o?r(o):void 0;switch(i){case"panel":return k.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${e}`,children:n});case"menu":return k.jsx(DF,{"data-testid":`${s}-group.${e}`,children:n});case"context-menu":return k.jsx(zz,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${e}`,children:n});case"keyboard-shortcuts":return k.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${e}`,children:[k.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),k.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function eN({id:e,disabled:t=!1,label:n,size:i="small",children:s}){const{type:r,sourceId:o}=_R(),a=Ay(),l=oj(),c=n?"string"==typeof n?n:n[r]??n.default:void 0,d=c?l(c):void 0;switch(r){case"menu":return k.jsxs(MF,{id:`${o}-sub.${e}`,children:[k.jsx(AF,{id:`${o}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:t,label:d,title:d}),k.jsx(OF,{id:`${o}-sub.${d?d.toLowerCase()+"-content":""}`,size:i,children:s})]});case"context-menu":return t?null:k.jsxs(tN,{id:`${o}-sub.${e}`,children:[k.jsx(Bz,{dir:"ltr",disabled:t,asChild:!0,children:k.jsxs(NA,{"data-testid":`${o}-sub-trigger.${e}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[k.jsx($A,{children:d}),k.jsx(WA,{icon:"chevron-right",small:!0})]})}),k.jsx(Dz,{container:a,children:k.jsx(Uz,{"data-testid":`${o}-sub-content.${e}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":i,children:s})})]});default:return s}}function tN({id:e,children:t}){const[n,i]=vR(e);return k.jsx($z,{open:n,onOpenChange:i,children:t})}function nN(){const e=cD();return function(){const e=jm();return Ru("showAutoSizeToggle",(()=>{const t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize}),[e])}()?k.jsx(zF,{...e["toggle-auto-size"]}):null}function iN(){const e=cD();return OR()?k.jsx(zF,{...e["edit-link"]}):null}function sN(){const e=cD();return AR(1)?k.jsx(zF,{...e.duplicate}):null}function rN(){const e=cD(),t=jm();return Ru("should display flatten option",(()=>{if(0===t.getSelectedShapeIds().length)return!1;const e=t.getOnlySelectedShape();return!e||!t.isShapeOfType(e,"image")}),[t])?k.jsx(zF,{...e["flatten-to-image"]}):null}function oN(){const e=cD();return ER()?k.jsx(zF,{...e.group}):null}function aN(){const e=cD();return TR()?k.jsx(zF,{...e.ungroup}):null}function lN(){const e=jm(),t=cD();return Ru("allow unframe",(()=>{const t=e.getSelectedShapes();return 0!==t.length&&t.every((t=>e.isShapeOfType(t,"frame")))}),[e])?k.jsx(zF,{...t["remove-frame"]}):null}function cN(){const e=jm(),t=cD();return Ru("allow fit frame to content",(()=>{const t=e.getOnlySelectedShape();return!!t&&(e.isShapeOfType(t,"frame")&&e.getSortedChildIdsForParent(t).length>0)}),[e])?k.jsx(zF,{...t["fit-frame-to-content"]}):null}function dN(){const e=jm(),t=cD();return Ru("selected shapes",(()=>e.getSelectedShapes().length>0),[e])?k.jsx(zF,{...t["toggle-lock"]}):null}function hN(){const e=cD(),t=jm(),n=Ru("isTransparentBg",(()=>!t.getInstanceState().exportBackground),[t]);return k.jsx(JF,{...e["toggle-transparent"],checked:n,toggle:!0})}function uN(){const e=jm(),t=cD(),n=Ru("any shapes",(()=>e.getCurrentPageShapeIds().size>0),[e]);return k.jsx(zF,{...t["unlock-all"],disabled:!n})}function pN(){const e=jm(),t=Ru("zoomed to 100",(()=>1===e.getZoomLevel()),[e]),n=cD();return k.jsx(zF,{...n["zoom-to-100"],noClose:!0,disabled:t})}function gN(){const e=jm(),t=Ru("has shapes",(()=>e.getCurrentPageShapeIds().size>0),[e]),n=cD();return k.jsx(zF,{...n["zoom-to-fit"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function fN(){const e=jm(),t=Ru("has shapes",(()=>e.getSelectedShapeIds().length>0),[e]),n=cD();return k.jsx(zF,{...n["zoom-to-selection"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function mN(){return k.jsxs(QF,{id:"clipboard",children:[k.jsx(xN,{}),k.jsx(wN,{}),k.jsx(vN,{}),k.jsx(sN,{}),k.jsx(kN,{})]})}function yN(){var e;const t=jm(),n=cD(),i=Ru("atLeastOneShapeOnPage",(()=>t.getCurrentPageShapeIds().size>0),[t]);return k.jsxs(eN,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!i,children:[k.jsxs(QF,{id:"copy-as-group",children:[k.jsx(zF,{...n["copy-as-svg"]}),Boolean(null==(e=window.navigator.clipboard)?void 0:e.write)&&k.jsx(zF,{...n["copy-as-png"]}),k.jsx(zF,{...n["copy-as-json"]})]}),k.jsx(QF,{id:"copy-as-bg",children:k.jsx(hN,{})})]})}function xN(){const e=cD(),t=AR(1);return k.jsx(zF,{...e.cut,disabled:!t})}function wN(){const e=cD(),t=function(e,t){const n=jm();return Ru("selectedShapes",(()=>n.getSelectedShapes().length>=e),[n,e,t])}(1);return k.jsx(zF,{...e.copy,disabled:!t})}function vN(){const e=cD(),t=MR;return k.jsx(zF,{...e.paste,disabled:!t})}function bN(){const e=jm(),t=cD();return Ru("atLeastOneShapeOnPage",(()=>e.getCurrentPageShapeIds().size>0),[e])?k.jsxs(QF,{id:"conversions",children:[k.jsx(yN,{}),k.jsxs(eN,{id:"export-as",label:"context-menu.export-as",size:"small",children:[k.jsxs(QF,{id:"export-as-group",children:[k.jsx(zF,{...t["export-as-svg"]}),k.jsx(zF,{...t["export-as-png"]}),k.jsx(zF,{...t["export-as-json"]})]}),k.jsx(QF,{id:"export-as-bg",children:k.jsx(hN,{})})]})]}):null}function SN(){const e=cD(),t=jm(),n=Ru("atLeastOneShapeOnPage",(()=>t.getCurrentPageShapeIds().size>0),[t]);return k.jsx(zF,{...e["select-all"],disabled:!n})}function kN(){const e=cD(),t=AR(1);return k.jsx(zF,{...e.delete,disabled:!t})}function CN(){return k.jsxs(eN,{id:"edit",label:"context-menu.edit",size:"small",children:[k.jsx(oN,{}),k.jsx(aN,{}),k.jsx(rN,{}),k.jsx(iN,{}),k.jsx(cN,{}),k.jsx(lN,{}),k.jsx(MN,{}),k.jsx(TN,{}),k.jsx(nN,{}),k.jsx(dN,{})]})}function _N(){const e=AR(2),t=function(){const e=jm();return Ru("onlyFlippableShape",(()=>{const t=e.getOnlySelectedShape();return t&&(e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))}),[e])}(),n=cD();return e||t?k.jsxs(eN,{id:"arrange",label:"context-menu.arrange",size:"small",children:[e&&k.jsxs(QF,{id:"align",children:[k.jsx(zF,{...n["align-left"]}),k.jsx(zF,{...n["align-center-horizontal"]}),k.jsx(zF,{...n["align-right"]}),k.jsx(zF,{...n["align-top"]}),k.jsx(zF,{...n["align-center-vertical"]}),k.jsx(zF,{...n["align-bottom"]})]}),k.jsx(PN,{}),e&&k.jsxs(QF,{id:"stretch",children:[k.jsx(zF,{...n["stretch-horizontal"]}),k.jsx(zF,{...n["stretch-vertical"]})]}),(e||t)&&k.jsxs(QF,{id:"flip",children:[k.jsx(zF,{...n["flip-horizontal"]}),k.jsx(zF,{...n["flip-vertical"]})]}),k.jsx(IN,{})]}):null}function PN(){const e=cD();return AR(3)?k.jsxs(QF,{id:"distribute",children:[k.jsx(zF,{...e["distribute-horizontal"]}),k.jsx(zF,{...e["distribute-vertical"]})]}):null}function IN(){const e=cD(),t=AR(2),n=IR();return t?k.jsxs(QF,{id:"order",children:[k.jsx(zF,{...e.pack}),n&&k.jsx(zF,{...e["stack-horizontal"]}),n&&k.jsx(zF,{...e["stack-vertical"]})]}):null}function jN(){const e=cD();return AR(1)?k.jsx(eN,{id:"reorder",label:"context-menu.reorder",size:"small",children:k.jsxs(QF,{id:"reorder",children:[k.jsx(zF,{...e["bring-to-front"]}),k.jsx(zF,{...e["bring-forward"]}),k.jsx(zF,{...e["send-backward"]}),k.jsx(zF,{...e["send-to-back"]})]})}):null}function EN(){const e=jm(),t=Ru("pages",(()=>e.getPages()),[e]),n=Ru("current page id",(()=>e.getCurrentPageId()),[e]),{addToast:i}=FA(),s=cD(),r=BM();return AR(1)?k.jsxs(eN,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[k.jsx(QF,{id:"pages",children:t.map((t=>k.jsx(zF,{id:t.id,disabled:n===t.id,label:t.name,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);const s=e.getPage(t.id);s&&i({title:"Changed Page",description:`Moved to ${s.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(n)}}]}),r("move-to-page",{source:"context-menu"})}},t.id)))}),k.jsx(QF,{id:"new-page",children:k.jsx(zF,{...s["new-page"]})})]}):null}function TN(){const e=jm(),t=cD();return Ru("oneEmbedSelected",(()=>{const t=e.getOnlySelectedShape();return!!t&&!(!e.isShapeOfType(t,"embed")||!t.props.url||e.isShapeOrAncestorLocked(t))}),[e])?k.jsx(zF,{...t["convert-to-bookmark"]}):null}function MN(){const e=jm(),t=cD();return Ru("oneEmbeddableBookmarkSelected",(()=>{const t=e.getOnlySelectedShape();return!!t&&!(!(e.isShapeOfType(t,"bookmark")&&t.props.url&&QC(t.props.url))||e.isShapeOrAncestorLocked(t))}),[e])?k.jsx(zF,{...t["convert-to-embed"]}):null}function AN(){const e=cD(),t=jm(),n=Ru("isSnapMode",(()=>t.user.getIsSnapMode()),[t]);return k.jsx(JF,{...e["toggle-snap-mode"],checked:n})}function ON(){const e=cD(),t=jm(),n=Ru("isToolLock",(()=>t.getInstanceState().isToolLocked),[t]);return k.jsx(JF,{...e["toggle-tool-lock"],checked:n})}function DN(){const e=cD(),t=jm(),n=Ru("isGridMode",(()=>t.getInstanceState().isGridMode),[t]);return k.jsx(JF,{...e["toggle-grid"],checked:n})}function RN(){const e=cD(),t=jm(),n=Ru("isWrapMode",(()=>t.user.getIsWrapMode()),[t]);return k.jsx(JF,{...e["toggle-wrap-mode"],checked:n})}function LN(){const e=cD(),t=jm(),n=Ru("isFocusMode",(()=>t.getInstanceState().isFocusMode),[t]);return k.jsx(JF,{...e["toggle-focus-mode"],checked:n})}function zN(){const e=cD(),t=jm(),n=Ru("edgeScrollSpeed",(()=>t.user.getEdgeScrollSpeed()),[t]);return k.jsx(JF,{...e["toggle-edge-scrolling"],checked:1===n})}function FN(){const e=cD(),t=jm(),n=Ru("animationSpeed",(()=>t.user.getAnimationSpeed()),[t]);return k.jsx(JF,{...e["toggle-reduce-motion"],checked:0===n})}function NN(){const e=cD(),t=jm(),n=Ru("isDebugMode",(()=>t.getInstanceState().isDebugMode),[t]);return k.jsx(JF,{...e["toggle-debug-mode"],checked:n})}function $N(){const e=cD(),t=jm(),n=Ru("dynamic resize",(()=>t.user.getIsDynamicResizeMode()),[t]);return k.jsx(JF,{...e["toggle-dynamic-size-mode"],checked:n})}function BN(){const e=jm();return Ru("isSelectToolActive",(()=>"select"===e.getCurrentToolId()),[e])?k.jsxs(k.Fragment,{children:[k.jsxs(QF,{id:"modify",children:[k.jsx(CN,{}),k.jsx(_N,{}),k.jsx(jN,{}),k.jsx(EN,{})]}),k.jsx(mN,{}),k.jsx(bN,{}),k.jsx(QF,{id:"select-all",children:k.jsx(SN,{})})]}):null}const UN=C.memo((function({children:e}){const t=jm(),{Canvas:n}=ev(),i=C.useCallback((e=>{if(e){if(t.getInstanceState().isCoarsePointer){const e=t.getSelectedShapes(),{inputs:{currentPagePoint:n}}=t,i=t.getShapesAtPoint(n);if(!t.getSelectedShapes().length||!i.some((t=>e.includes(t)))){const e=i.filter((e=>t.isShapeOrAncestorLocked(e)));e.length&&t.select(...e.map((e=>e.id)))}}}else{const e=t.getOnlySelectedShape();e&&t.isShapeOrAncestorLocked(e)&&t.setSelectedShapes([])}}),[t]),s=Ay(),[r,o]=vR("context menu",i),a=e??k.jsx(BN,{});return k.jsxs(Hz,{dir:"ltr",onOpenChange:o,modal:!1,children:[k.jsx(Vz,{onContextMenu:void 0,dir:"ltr",children:n?k.jsx(n,{}):null}),r&&k.jsx(Wz,{container:s,children:k.jsx(Yz,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Cy,children:k.jsx(PR,{type:"context-menu",sourceId:"context-menu",children:a})})})]})}));function KN({checked:e}){return k.jsx(BA,{icon:e?"check":"none",className:"tlui-button__icon",small:!0})}function HN(){const e=jm(),{addToast:t}=FA(),{addDialog:n}=HM(),[i,s]=P.useState(!1);return k.jsxs(k.Fragment,{children:[k.jsxs(QF,{id:"items",children:[k.jsx(zF,{id:"add-toast",onSelect:()=>{t({id:sv(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),t({id:sv(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:sv(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:sv(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),k.jsx(zF,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:e})=>k.jsx(YN,{displayDontShowAgain:!0,onCancel:()=>e(),onContinue:()=>e()}),onClose:()=>{}})}}),k.jsx(zF,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>function(e,t){const n=Array(t),i=Math.floor(Math.sqrt(t));for(let s=0;s<t;s++)XN++,n[s]={id:eg("box"+XN),type:"geo",x:s%i*132,y:132*Math.floor(s/i)};e.batch((()=>{e.createShapes(n).setSelectedShapes(n.map((e=>e.id)))}))}(e,100)}),k.jsx(zF,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var t;const n=e.getSelectedShapes(),i=0===n.length?e.getRenderingShapes():n;window.alert(`Shapes ${i.length}, DOM nodes:${null==(t=document.querySelector(".tl-shapes").querySelectorAll("*"))?void 0:t.length}`)}}),(()=>{if(i)throw Error("oh no!");return null})(),k.jsx(zF,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),k.jsx(zF,{id:"hard-reset",onSelect:nv,label:"Hard reset"})]}),k.jsxs(QF,{id:"flags",children:[k.jsx(VN,{}),k.jsx(WN,{})]})]})}function VN(){const e=Object.values(vy);return e.length?k.jsx(eN,{id:"debug flags",label:"Debug Flags",children:k.jsx(QF,{id:"debug flags",children:e.map((e=>k.jsx(GN,{flag:e},e.name)))})}):null}function WN(){const e=Object.values(xy);return e.length?k.jsx(eN,{id:"feature flags",label:"Feature Flags",children:k.jsx(QF,{id:"feature flags",children:e.map((e=>k.jsx(GN,{flag:e},e.name)))})}):null}function YN({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:i="Continue",displayDontShowAgain:s=!1,onCancel:r,onContinue:o}){const[a,l]=P.useState(!1);return k.jsxs(k.Fragment,{children:[k.jsxs(QA,{children:[k.jsx(eO,{children:e}),k.jsx(tO,{})]}),k.jsx(nO,{style:{maxWidth:350},children:t}),k.jsxs(iO,{className:"tlui-dialog__footer__actions",children:[s&&k.jsxs(NA,{type:"normal",onClick:()=>l(!a),style:{marginRight:"auto"},children:[k.jsx(KN,{checked:a}),k.jsx($A,{children:"Donât show again"})]}),k.jsx(NA,{type:"normal",onClick:r,children:k.jsx($A,{children:n})}),k.jsx(NA,{type:"primary",onClick:async()=>o(),children:k.jsx($A,{children:i})})]})]})}const GN=Ou((function({flag:e,onChange:t}){const n=e.get();return k.jsx(JF,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,(e=>`${e[0]} ${e[1].toLowerCase()}`)).replace(/^[a-z]/,(e=>e.toUpperCase())),checked:n,onSelect:()=>{e.set(!n),null==t||t(!n)}})}));let XN=0;function qN({children:e}){const t=e??k.jsx(HN,{});return k.jsxs(jF,{id:"debug",children:[k.jsx(EF,{children:k.jsx(NA,{type:"icon",title:"Debug menu",children:k.jsx(WA,{icon:"dots-horizontal"})})}),k.jsx(TF,{side:"top",align:"end",alignOffset:0,children:k.jsx(PR,{type:"menu",sourceId:"debug-panel",children:t})})]})}const ZN=C.memo((function(){const{DebugMenu:e}=ZU();return k.jsxs("div",{className:"tlui-debug-panel",children:[k.jsx(JN,{}),k.jsx(QN,{}),e&&k.jsx(e,{})]})}));const JN=Ou((function(){!function(e=!0){const[t,n]=C.useState(0),i=jm();C.useEffect((()=>{if(!e)return;const t=()=>n((e=>e+1));return i.on("tick",t),()=>{i.off("tick",t)}}),[i,e])}();const e=jm(),t=e.getPath(),n=e.getHoveredShape(),i=e.getOnlySelectedShape(),s="select.idle"!==t&&t.includes("select.")?i:n,r=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${Am.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",o=t.startsWith("select.")&&!t.includes(".idle")?` / [${Am.ToInt(e.inputs.originPagePoint)}] â [${Am.ToInt(e.inputs.currentPagePoint)}] = ${Am.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return k.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${r}${o}`})}));function QN(){const e=jm(),t=Ru("show_fps",(()=>vy.showFps.get()),[vy]),n=C.useRef(null);return C.useEffect((()=>{if(!t)return;const i=250;let s=0,r=-1,o=performance.now(),a=0,l=0,c=!1;return function t(){if(l++,a=performance.now()-o,a>i){const e=Math.round(l*(i/a)*4);e>s&&(s=e);const t=.75*s;(e<t&&!c||e>=t&&c)&&(c=!c),n.current.innerHTML=`FPS ${e.toString()}`,n.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=i,l=0,o=performance.now()}r=e.timers.requestAnimationFrame(t)}(),()=>{cancelAnimationFrame(r)}}),[t,e]),t?k.jsx("div",{ref:n}):null}function e$(){const e=jm(),t=BM(),n=Ru("locale",(()=>e.user.getLocale()),[e]);return k.jsx(eN,{id:"help menu language",label:"menu.language",children:k.jsx(QF,{id:"languages",children:bm.map((({locale:i,label:s})=>k.jsx(JF,{id:`language-${i}`,title:i,label:s,checked:i===n,onSelect:()=>{e.user.updateUserPreferences({locale:i}),t("change-language",{source:"menu",locale:i})}},i)))})})}function t$(){return k.jsxs(k.Fragment,{children:[k.jsx(e$,{}),k.jsx(n$,{})]})}function n$(){const{KeyboardShortcutsDialog:e}=ZU(),{addDialog:t}=HM();return e?k.jsx(zF,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{t({component:e})}}):null}const i$=C.memo((function({children:e}){const t=oj(),n=uO(),i=e??k.jsx(t$,{});return n<GA.MOBILE?null:k.jsx("div",{className:"tlui-help-menu",children:k.jsxs(jF,{id:"help menu",children:[k.jsx(EF,{children:k.jsx(NA,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:k.jsx(WA,{icon:"question-mark",small:!0})})}),k.jsx(TF,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:k.jsx(PR,{type:"menu",sourceId:"help-menu",children:i})})]})})}));function s$(){const e=jm(),t=cD(),[n,i]=C.useState(!1),s=C.useRef(!1);return Du("toggle showback to content",(()=>{const t=s.current,n=e.getCurrentPageShapeIds();let r=!1;n.size&&(r=n.size===e.getCulledShapes().size),t!==r&&(i(r),s.current=r)}),[e]),n?k.jsx(zF,{...t["back-to-content"],onSelect:()=>{t["back-to-content"].onSelect("helper-buttons"),i(!1)}}):null}function r$(){const e=jm(),t=cD();return Ru("is pen mode",(()=>e.getInstanceState().isPenMode),[e])?k.jsx(zF,{...t["exit-pen-mode"]}):null}function o$(){const e=jm(),t=cD();return Ru("is following user",(()=>!!e.getInstanceState().followingUserId),[e])?k.jsx(zF,{...t["stop-following"]}):null}function a$(){return k.jsxs(k.Fragment,{children:[k.jsx(r$,{}),k.jsx(s$,{}),k.jsx(o$,{})]})}function l$({children:e}){const t=e??k.jsx(a$,{});return k.jsx("div",{className:"tlui-helper-buttons",children:k.jsx(PR,{type:"helper-buttons",sourceId:"helper-buttons",children:t})})}function c$(){const e=cD(),t=cO();return k.jsxs(k.Fragment,{children:[k.jsxs(QF,{label:"shortcuts-dialog.tools",id:"tools",children:[k.jsx(zF,{...e["toggle-tool-lock"]}),k.jsx(zF,{...e["insert-media"]}),k.jsx(zF,{...t.select}),k.jsx(zF,{...t.draw}),k.jsx(zF,{...t.eraser}),k.jsx(zF,{...t.hand}),k.jsx(zF,{...t.rectangle}),k.jsx(zF,{...t.ellipse}),k.jsx(zF,{...t.arrow}),k.jsx(zF,{...t.line}),k.jsx(zF,{...t.text}),k.jsx(zF,{...t.frame}),k.jsx(zF,{...t.note}),k.jsx(zF,{...t.laser})]}),k.jsxs(QF,{label:"shortcuts-dialog.preferences",id:"preferences",children:[k.jsx(zF,{...e["toggle-dark-mode"]}),k.jsx(zF,{...e["toggle-focus-mode"]}),k.jsx(zF,{...e["toggle-grid"]})]}),k.jsxs(QF,{label:"shortcuts-dialog.edit",id:"edit",children:[k.jsx(zF,{...e.undo}),k.jsx(zF,{...e.redo}),k.jsx(zF,{...e.cut}),k.jsx(zF,{...e.copy}),k.jsx(zF,{...e.paste}),k.jsx(zF,{...e["select-all"]}),k.jsx(zF,{...e.delete}),k.jsx(zF,{...e.duplicate})]}),k.jsxs(QF,{label:"shortcuts-dialog.view",id:"view",children:[k.jsx(zF,{...e["zoom-in"]}),k.jsx(zF,{...e["zoom-out"]}),k.jsx(zF,{...e["zoom-to-100"]}),k.jsx(zF,{...e["zoom-to-fit"]}),k.jsx(zF,{...e["zoom-to-selection"]})]}),k.jsxs(QF,{label:"shortcuts-dialog.transform",id:"transform",children:[k.jsx(zF,{...e["bring-to-front"]}),k.jsx(zF,{...e["bring-forward"]}),k.jsx(zF,{...e["send-backward"]}),k.jsx(zF,{...e["send-to-back"]}),k.jsx(zF,{...e.group}),k.jsx(zF,{...e.ungroup}),k.jsx(zF,{...e["flip-horizontal"]}),k.jsx(zF,{...e["flip-vertical"]}),k.jsx(zF,{...e["align-top"]}),k.jsx(zF,{...e["align-center-vertical"]}),k.jsx(zF,{...e["align-bottom"]}),k.jsx(zF,{...e["align-left"]}),k.jsx(zF,{...e["align-center-horizontal"]}),k.jsx(zF,{...e["align-right"]})]})]})}const d$=C.memo((function({children:e}){const t=oj(),n=uO(),i=e??k.jsx(c$,{});return k.jsxs(k.Fragment,{children:[k.jsxs(QA,{className:"tlui-shortcuts-dialog__header",children:[k.jsx(eO,{children:t("shortcuts-dialog.title")}),k.jsx(tO,{})]}),k.jsx(nO,{className:I("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=GA.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=GA.TABLET}),children:k.jsx(PR,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),k.jsx("div",{className:"tlui-dialog__scrim"})]})})),h$=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function u$(){const e=jm(),t=BM(),n=Ru("colorScheme",(()=>e.user.getUserPreferences().colorScheme),[e]);return k.jsx(eN,{id:"help menu color-scheme",label:"menu.theme",children:k.jsx(QF,{id:"languages",children:h$.map((({colorScheme:i,label:s})=>k.jsx(JF,{id:`color-scheme-${i}`,label:s,checked:i===n,onSelect:()=>{e.user.updateUserPreferences({colorScheme:i}),t("color-scheme",{source:"menu",value:i})}},i)))})})}function p$(){return k.jsxs(k.Fragment,{children:[k.jsx(f$,{}),k.jsx(w$,{}),k.jsx(g$,{}),k.jsx(v$,{}),k.jsx(b$,{})]})}function g$(){const e=cD();return k.jsxs(eN,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[k.jsxs(QF,{id:"export-all-as-group",children:[k.jsx(zF,{...e["export-all-as-svg"]}),k.jsx(zF,{...e["export-all-as-png"]}),k.jsx(zF,{...e["export-all-as-json"]})]}),k.jsx(QF,{id:"export-all-as-bg",children:k.jsx(hN,{})})]})}function f$(){const e=jm(),t=Ru("isSelectToolActive",(()=>"select"===e.getCurrentToolId()),[e]);return k.jsxs(eN,{id:"edit",label:"menu.edit",disabled:!t,children:[k.jsx(x$,{}),k.jsx(mN,{}),k.jsx(bN,{}),k.jsx(m$,{}),k.jsx(y$,{}),k.jsx(QF,{id:"select-all",children:k.jsx(SN,{})})]})}function m$(){return k.jsxs(QF,{id:"misc",children:[k.jsx(oN,{}),k.jsx(aN,{}),k.jsx(iN,{}),k.jsx(nN,{}),k.jsx(lN,{}),k.jsx(cN,{}),k.jsx(MN,{}),k.jsx(TN,{}),k.jsx(rN,{})]})}function y$(){return k.jsxs(QF,{id:"lock",children:[k.jsx(dN,{}),k.jsx(uN,{})]})}function x$(){const e=cD(),t=RR(),n=DR();return k.jsxs(QF,{id:"undo-redo",children:[k.jsx(zF,{...e.undo,disabled:!t}),k.jsx(zF,{...e.redo,disabled:!n})]})}function w$(){const e=cD();return k.jsx(eN,{id:"view",label:"menu.view",children:k.jsxs(QF,{id:"view-actions",children:[k.jsx(zF,{...e["zoom-in"]}),k.jsx(zF,{...e["zoom-out"]}),k.jsx(pN,{}),k.jsx(gN,{}),k.jsx(fN,{})]})})}function v$(){const e=cD();return k.jsxs(QF,{id:"extras",children:[k.jsx(zF,{...e["insert-embed"]}),k.jsx(zF,{...e["insert-media"]})]})}function b$(){return k.jsx(QF,{id:"preferences",children:k.jsxs(eN,{id:"preferences",label:"menu.preferences",children:[k.jsxs(QF,{id:"preferences-actions",children:[k.jsx(AN,{}),k.jsx(ON,{}),k.jsx(DN,{}),k.jsx(RN,{}),k.jsx(LN,{}),k.jsx(zN,{}),k.jsx(FN,{}),k.jsx($N,{}),k.jsx(NN,{})]}),k.jsx(QF,{id:"color-scheme",children:k.jsx(u$,{})}),k.jsx(QF,{id:"language",children:k.jsx(e$,{})})]})})}const S$=C.memo((function({children:e}){const t=Ay(),[n,i]=vR("main menu"),s=oj(),r=e??k.jsx(p$,{});return k.jsxs(xF,{dir:"ltr",open:n,onOpenChange:i,modal:!1,children:[k.jsx(wF,{asChild:!0,dir:"ltr",children:k.jsx(NA,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:k.jsx(WA,{icon:"menu",small:!0})})}),k.jsx(vF,{container:t,children:k.jsx(bF,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:k.jsx(PR,{type:"menu",sourceId:"main-menu",children:r})})})]})})),k$=C.memo((function(){const e=uO(),{MainMenu:t,QuickActions:n,ActionsMenu:i,PageMenu:s}=ZU();return!t&&!s&&e<6?null:k.jsx("div",{className:"tlui-menu-zone",children:k.jsxs("div",{className:"tlui-buttons__horizontal",children:[t&&k.jsx(t,{}),s&&k.jsx(s,{}),e<6?null:k.jsxs(k.Fragment,{children:[n&&k.jsx(n,{}),i&&k.jsx(i,{})]})]})})})),C$={};function _$(e){if(C$[e])return C$[e];const t=document.createElement("canvas").getContext("2d");t.fillStyle=e,t.fillRect(0,0,1,1);const[n,i,s,r]=t.getImageData(0,0,1,1).data,o=new Float32Array([n/255,i/255,s/255,r/255]);return C$[e]=o,o}function P$(e,{center:t,radius:n,numArcSegments:i=20,startAngle:s=0,endAngle:r=Fm,offset:o=0}){const a=(r-s)/i;let l=o;for(let c=s;c<r;c+=a)e[l++]=t.x,e[l++]=t.y,e[l++]=t.x+Math.cos(c)*n,e[l++]=t.y+Math.sin(c)*n,e[l++]=t.x+Math.cos(c+a)*n,e[l++]=t.y+Math.sin(c+a)*n;return e}function I$(e,t,n,i,s,r){e[t++]=n,e[t++]=i,e[t++]=n,e[t++]=i+r,e[t++]=n+s,e[t++]=i,e[t++]=n+s,e[t++]=i,e[t++]=n,e[t++]=i+r,e[t++]=n+s,e[t++]=i+r}function j$(e,t){const n=e.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(t)}}function E$(e,t,n){let i=e.vertices.length;for(;i<t+n.length;)i*=2;if(i!=e.vertices.length){const t=new Float32Array(i);t.set(e.vertices),e.vertices=t}e.vertices.set(n,t)}var T$=Object.defineProperty,M$=Object.getOwnPropertyDescriptor,A$=(e,t,n,i)=>{for(var s,r=M$(t,n),o=e.length-1;o>=0;o--)(s=e[o])&&(r=s(t,n,r)||r);return r&&T$(t,n,r),r};class O${constructor(e,t,n){b(this,"disposables",[]),b(this,"close",(()=>this.disposables.forEach((e=>e())))),b(this,"gl"),b(this,"shapeGeometryCache"),b(this,"colors"),b(this,"id",sv()),b(this,"canvasBoundingClientRect",xu("canvasBoundingClientRect",new Ux)),b(this,"originPagePoint",new Am),b(this,"originPageCenter",new Am),b(this,"isInViewport",!1),b(this,"getMinimapPagePoint",((e,t)=>{const n=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,r=t-i.y;return s*=n.width/i.width,r*=n.height/i.height,s+=n.minX,r+=n.minY,new Am(s,r,1)})),b(this,"minimapScreenPointToPagePoint",((e,t,n=!1,i=!1)=>{const{editor:s}=this,r=s.getViewportPageBounds();let{x:o,y:a}=this.getMinimapPagePoint(e,t);if(i){const e=this.editor.getCurrentPageBounds()??new Ux,t=e.minX-r.width/2,n=e.maxX+r.width/2,i=e.minY-r.height/2,s=e.maxY+r.height/2;o+=(Math.max(0,t+r.width-o)-Math.max(0,-(n-r.width-o)))/2,a+=(Math.max(0,i+r.height-a)-Math.max(0,-(s-r.height-a)))/2,o=$m(o,t,n),a=$m(a,i,s)}if(n){const{originPagePoint:e}=this;Math.abs(o-e.x)>Math.abs(a-e.y)?a=e.y:o=e.x}return new Am(o,a)})),b(this,"render",(()=>{const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const n=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,r=0;const o=this.editor.getCurrentPageShapeIdsSorted();for(let a=0,l=o.length;a<l;a++){const e=o[a],t=this.shapeGeometryCache.get(e);if(!t)continue;const i=t.length;n.has(e)?(E$(this.gl.selectedShapes,s,t),s+=i):(E$(this.gl.unselectedShapes,r,t),r+=i)}this.drawShapes(this.gl.unselectedShapes,r,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()})),this.editor=e,this.elem=t,this.container=n,this.gl=function(e){if(!e)throw new Error("Canvas element not found");const t=e.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw new Error("Failed to get webgl2 context");const n=t.createShader(t.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader");if(t.shaderSource(n,"#version 300 es\n  precision mediump float;\n  \n  in vec2 shapeVertexPosition;\n\n\tuniform vec4 canvasPageBounds;\n\n\t// taken (with thanks) from\n\t// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html\n  void main() {\n\t\t// convert the position from pixels to 0.0 to 1.0\n\t\tvec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;\n\t\n\t\t// convert from 0->1 to 0->2\n\t\tvec2 zeroToTwo = zeroToOne * 2.0;\n\t\n\t\t// convert from 0->2 to -1->+1 (clipspace)\n\t\tvec2 clipSpace = zeroToTwo - 1.0;\n\t\n\t\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  }"),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=t.createShader(t.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(t.shaderSource(i,"#version 300 es\n  precision mediump float;\n  \n\tuniform vec4 fillColor;\n  out vec4 outputColor;\n\n  void main() {\n\toutputColor = fillColor;\n  }"),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const s=t.createProgram();if(!s)throw new Error("Failed to create program");if(t.attachShader(s,n),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error("Failed to link program");t.useProgram(s);const r=t.getAttribLocation(s,"shapeVertexPosition");if(r<0)throw new Error("Failed to get shapeVertexPosition attribute location");t.enableVertexAttribArray(r);const o=t.getUniformLocation(s,"canvasPageBounds"),a=t.getUniformLocation(s,"fillColor");if(!t.createBuffer())throw new Error("Failed to create buffer");if(!t.createBuffer())throw new Error("Failed to create buffer");return{context:t,selectedShapes:j$(t,1024),unselectedShapes:j$(t,4096),viewport:j$(t,300),collaborators:j$(t,1024),prepareTriangles(e,n){t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW,0,n),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0)},drawTrianglesTransparently(e){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLES,0,e/2),t.disable(t.BLEND)},drawTriangles(e){t.drawArrays(t.TRIANGLES,0,e/2)},setFillColor(e){t.uniform4fv(a,e)},setCanvasPageBounds(e){t.uniform4fv(o,e)}}}(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",(t=>{const n=e.getShapeMaskedPageBounds(t.id);if(!n)return null;const i=new Float32Array(12);return I$(i,0,n.x,n.y,n.w,n.h),i})),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),cu("minimap render",this.render))}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:_$(e.getPropertyValue("--color-text-3").trim()),selectFill:_$(e.getPropertyValue("--color-selected").trim()),viewportFill:_$(e.getPropertyValue("--color-muted-1").trim()),background:_$(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?Ux.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new Am(e.maxX,e.maxY));return new Ux(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:n,height:i}=this.elem.getBoundingClientRect();return new Ux(e,t,n,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver((()=>{const e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)}));return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new Am(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height;let i=t.width,s=i/n;s<t.height&&(s=t.height,i=s*n);const r=new Ux(0,0,i,s);return r.center=t.center,r}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:n,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,n,i])}drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=function(e,t,n){const i=10;n=Math.min(n,Math.min(t.w,t.h)/2);const s=Ux.ExpandBy(t,-n);if(s.w<=0||s.h<=0)return P$(e,{center:t.center,radius:n,numArcSegments:40}),240;let r=0;return I$(e,r,s.minX,s.minY,s.w,s.h),r+=12,I$(e,r,s.minX,t.minY,s.w,n),r+=12,I$(e,r,s.maxX,s.minY,n,s.h),r+=12,I$(e,r,s.minX,s.maxY,s.w,n),r+=12,I$(e,r,t.minX,s.minY,n,s.h),r+=12,P$(e,{numArcSegments:i,offset:r,center:s.point,radius:n,startAngle:Lm,endAngle:1.5*Lm}),r+=60,P$(e,{numArcSegments:i,offset:r,center:Am.Add(s.point,new Am(s.w,0)),radius:n,startAngle:1.5*Lm,endAngle:Fm}),r+=60,P$(e,{numArcSegments:i,offset:r,center:Am.Add(s.point,s.size),radius:n,startAngle:0,endAngle:zm}),r+=60,P$(e,{numArcSegments:i,offset:r,center:Am.Add(s.point,new Am(0,s.h)),radius:n,startAngle:zm,endAngle:Lm}),300}(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=120,n=t*e.length;this.gl.collaborators.vertices.length<n&&(this.gl.collaborators.vertices=new Float32Array(n));const i=this.gl.collaborators.vertices;let s=0;const r=this.getZoom();for(const{cursor:o}of e)P$(i,{center:Am.From(o),radius:3*r,offset:s,numArcSegments:20}),s+=t;this.gl.prepareTriangles(this.gl.collaborators,n),s=0;for(const{color:o}of e)this.gl.setFillColor(_$(o)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,s/2,60),s+=t}}function D$(){const e=jm(),t=Ay(),n=C.useRef(null),i=C.useRef(!1),s=C.useRef();C.useEffect((()=>{try{const i=new O$(e,n.current,t);return s.current=i,s.current.close}catch(i){e.annotateError(i,{origin:"minimap",willCrashApp:!1}),e.timers.setTimeout((()=>{throw i}))}}),[e,t]);const r=C.useCallback((t=>{if(!e.getCurrentPageShapeIds().size)return;if(!s.current)return;const n=s.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),i=s.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);s.current.originPagePoint.setTo(i),s.current.originPageCenter.setTo(e.getViewportPageBounds().center),e.centerOnPoint(n,{animation:{duration:e.options.animationMediumMs}})}),[e]),o=C.useCallback((t=>{if(!s.current)return;const n=t.currentTarget;if(_y(n,t),!e.getCurrentPageShapeIds().size)return;i.current=!0,s.current.isInViewport=!1;const r=s.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),o=e.getViewportPageBounds(),a=s.current.getContentPageBounds();if(new Ux(a.x-o.width/2,a.y-o.height/2,a.width+o.width,a.height+o.height).containsPoint(r)&&!o.containsPoint(r)){s.current.isInViewport=o.containsPoint(r);const t=Am.Sub(o.center,o.point),n=Am.Add(r,t);s.current.originPagePoint.setTo(n),s.current.originPageCenter.setTo(r),e.centerOnPoint(r,{animation:{duration:e.options.animationMediumMs}})}else{const e=s.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);s.current.isInViewport=o.containsPoint(e),s.current.originPagePoint.setTo(e),s.current.originPageCenter.setTo(o.center)}document.body.addEventListener("pointerup",(function e(t){n&&Py(n,t),i.current=!1,document.body.removeEventListener("pointerup",e)}))}),[e]),a=C.useCallback((t=>{if(!s.current)return;const n=s.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,t.shiftKey,!0);if(i.current){if(s.current.isInViewport){const t=s.current.originPagePoint.clone().sub(s.current.originPageCenter);return void e.centerOnPoint(Am.Sub(n,t))}e.centerOnPoint(n)}const r=s.current.getMinimapPagePoint(t.clientX,t.clientY),o=e.pageToScreen(r),a={type:"pointer",target:"canvas",name:"pointer_move",...Ey(t),point:o,isPen:e.getInstanceState().isPenMode};e.dispatch(a)}),[e]),l=C.useCallback((t=>{const n=Rx(t);e.dispatch({type:"wheel",name:"wheel",delta:n,point:new Am(t.clientX,t.clientY),shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey})}),[e]),c=mS();return C.useEffect((()=>{e.timers.setTimeout((()=>{var e,t;null==(e=s.current)||e.updateColors(),null==(t=s.current)||t.render()}))}),[c,e]),k.jsx("div",{className:"tlui-minimap",children:k.jsx("canvas",{role:"img","aria-label":"minimap",ref:n,className:"tlui-minimap__canvas",onDoubleClick:r,onPointerMove:a,onPointerDown:o,onWheel:l})})}A$([ju],O$.prototype,"getDpr"),A$([ju],O$.prototype,"getContentPageBounds"),A$([ju],O$.prototype,"getContentScreenBounds"),A$([ju],O$.prototype,"getCanvasSize"),A$([ju],O$.prototype,"getCanvasClientPosition"),A$([ju],O$.prototype,"getCanvasPageBounds"),A$([ju],O$.prototype,"getZoom"),A$([ju],O$.prototype,"getCanvasPageBoundsArray");const R$=C.memo((function(){const e=cD(),t=oj(),n=uO(),[i,s]=function(e,t){const[n,i]=P.useState(t);return P.useLayoutEffect((()=>{const t=xh(e);if(t)try{i(JSON.parse(t))}catch(n){console.error(`Could not restore value ${e} from local storage.`)}}),[e]),[n,P.useCallback((t=>{i((n=>{const i="function"==typeof t?t(n):t;return wh(e,JSON.stringify(i)),i}))}),[e])]}("minimap",!0),r=C.useCallback((()=>{s((e=>!e))}),[s]),{ZoomMenu:o,Minimap:a}=ZU();return n<GA.MOBILE?null:k.jsxs("div",{className:"tlui-navigation-panel",children:[k.jsx("div",{className:"tlui-buttons__horizontal",children:o&&n<GA.TABLET?k.jsx(o,{}):i?k.jsxs(k.Fragment,{children:[o&&k.jsx(o,{}),a&&k.jsx(NA,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:r,children:k.jsx(WA,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):k.jsxs(k.Fragment,{children:[k.jsx(NA,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(dD(e["zoom-out"].label))} ${Qz(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:k.jsx(WA,{icon:"minus"})}),o&&k.jsx(o,{}),k.jsx(NA,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(dD(e["zoom-in"].label))} ${Qz(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:k.jsx(WA,{icon:"plus"})}),a&&k.jsx(NA,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:r,children:k.jsx(WA,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),a&&n>=GA.TABLET&&!i&&k.jsx(a,{})]})})),L$=function({name:e,id:t,isCurrentPage:n}){const i=jm(),s=C.useRef(null),r=C.useCallback((()=>{i.mark("rename page")}),[i]),o=C.useCallback((e=>{i.renamePage(t,e||"New Page")}),[i,t]);return k.jsx(sO,{className:"tlui-page-menu__item__input",ref:e=>s.current=e,defaultValue:e,onValueChange:o,onFocus:r,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:n,autoSelect:!0})},z$=(e,t,n,i)=>{let s;const r=e.getPages(),o=n>i?r[i-1]:r[i],a=n>i?r[i]:r[i+1];s=o&&!a?gh(o.index):!o&&a?function(e){return ch(void 0,e,1)[0]}(r[0].index):ph(o.index,a.index),s!==r[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:s}))},F$=Ou((function({index:e,listSize:t,item:n,onRename:i}){const s=jm(),r=oj(),o=s.getPages(),a=C.useCallback((()=>{s.mark("creating page");const e=Lg.createId();s.duplicatePage(n.id,e)}),[s,n]),l=C.useCallback((()=>{z$(s,n.id,e,e-1)}),[s,n,e]),c=C.useCallback((()=>{z$(s,n.id,e,e+1)}),[s,n,e]),d=C.useCallback((()=>{s.mark("deleting page"),s.deletePage(n.id)}),[s,n]);return k.jsxs(jF,{id:`page item submenu ${e}`,children:[k.jsx(EF,{children:k.jsx(NA,{type:"icon",title:r("page-menu.submenu.title"),children:k.jsx(WA,{icon:"dots-vertical"})})}),k.jsx(TF,{alignOffset:0,side:"right",sideOffset:-4,children:k.jsxs(PR,{type:"menu",sourceId:"page-menu",children:[k.jsxs(QF,{id:"modify",children:[i&&k.jsx(zF,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),k.jsx(zF,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:a,disabled:o.length>=s.options.maxPages}),e>0&&k.jsx(zF,{id:"move-up",onSelect:l,label:"page-menu.submenu.move-up"}),e<t-1&&k.jsx(zF,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:c})]}),t>1&&k.jsx(QF,{id:"delete",children:k.jsx(zF,{id:"delete",onSelect:d,label:"page-menu.submenu.delete"})})]})})]})})),N$=C.memo((function(){const e=jm(),t=oj(),n=uO(),i=C.useCallback((()=>f(!1)),[]),[s,r]=vR("page-menu",i),o=36,a=C.useRef(null),l=Ru("pages",(()=>e.getPages()),[e]),c=Ru("currentPage",(()=>e.getCurrentPage()),[e]),d=Ru("currentPageId",(()=>e.getCurrentPageId()),[e]),h=Vk(),u=Ru("maxPageCountReached",(()=>e.getPages().length>=e.options.maxPages),[e]),p=Ru("isCoarsePointer",(()=>e.getInstanceState().isCoarsePointer),[e]),[g,f]=C.useState(!1),m=C.useCallback((()=>{h||f((e=>!e))}),[h]),y=C.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[x,w]=C.useState(Object.fromEntries(l.map(((e,t)=>[e.id,{y:t*o,offsetY:0,isSelected:!1}]))));C.useLayoutEffect((()=>{w(Object.fromEntries(l.map(((e,t)=>[e.id,{y:t*o,offsetY:0,isSelected:!1}]))))}),[o,l]),C.useEffect((()=>{s&&e.timers.requestAnimationFrame((()=>{const e=document.querySelector(`[data-testid="page-menu-item-${d}"]`);if(e){const t=a.current;if(!t)return;const n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});const i=n+o;i>t.scrollTop+t.offsetHeight&&t.scrollTo({top:i-t.offsetHeight})}}))}),[o,d,s,e]);const v=C.useCallback((e=>{const{clientY:t,currentTarget:n}=e,{dataset:{id:i,index:s}}=n;if(!i||!s)return;const r=y.current;_y(e.currentTarget,e),r.status="pointing",r.pointing={id:i,index:+s};const a=x[i].y;r.startY=t,r.startIndex=Math.max(0,Math.min(Math.round(a/o),l.length-1))}),[o,l.length,x]),b=C.useCallback((e=>{const t=y.current;if("pointing"===t.status){const{clientY:n}=e,i=n-t.startY;Math.abs(i)>5&&(t.status="dragging")}if("dragging"===t.status){const{clientY:n}=e,i=n-t.startY,s=x[t.pointing.id],{startIndex:r,pointing:a}=t,c=s.y+i,d=Math.max(0,Math.min(Math.round(c/o),l.length-1)),h={...x};if(h[a.id]={y:s.y,offsetY:i,isSelected:!0},d!==t.dragIndex){t.dragIndex=d;for(let e=0;e<l.length;e++){const n=l[e];if(n.id===t.pointing.id)continue;let{y:i}=h[n.id];d===r?i=e*o:d<r?i=d<=e&&e<r?(e+1)*o:e*o:d>r&&(i=d>=e&&e>r?(e-1)*o:e*o),i!==h[n.id].y&&(h[n.id]={y:i,offsetY:0,isSelected:!0})}}w(h)}}),[o,l,x]),S=C.useCallback((t=>{const n=y.current;if("dragging"===n.status){const{id:t,index:i}=n.pointing;z$(e,t,i,n.dragIndex)}Py(t.currentTarget,t),n.status="idle"}),[e]),_=C.useCallback((e=>{const t=y.current;"Escape"===e.key&&("dragging"===t.status&&w(Object.fromEntries(l.map(((e,t)=>[e.id,{y:t*o,offsetY:0,isSelected:!1}])))),t.status="idle")}),[o,l]),P=C.useCallback((()=>{h||e.batch((()=>{e.mark("creating page");const n=Lg.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:n}),e.setCurrentPage(n),f(!0)}))}),[e,t,h]);return k.jsxs(bR,{id:"pages",onOpenChange:r,open:s,children:[k.jsx(SR,{"data-testid":"main.page-menu",children:k.jsxs(NA,{type:"menu",title:c.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[k.jsx("div",{className:"tlui-page-menu__name",children:c.name}),k.jsx(WA,{icon:"chevron-down",small:!0})]})}),k.jsx(kR,{side:"bottom",align:"start",sideOffset:6,children:k.jsxs("div",{className:"tlui-page-menu__wrapper",children:[k.jsxs("div",{className:"tlui-page-menu__header",children:[k.jsx("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!h&&k.jsxs("div",{className:"tlui-buttons__horizontal",children:[k.jsx(NA,{type:"icon","data-testid":"page-menu.edit",title:t(g?"page-menu.edit-done":"page-menu.edit-start"),onClick:m,children:k.jsx(WA,{icon:g?"check":"edit"})}),k.jsx(NA,{type:"icon","data-testid":"page-menu.create",title:t(u?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:u,onClick:P,children:k.jsx(WA,{icon:"plus"})})]})]}),k.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:o*l.length+4},ref:a,children:l.map(((i,s)=>{const r=x[i.id]??{position:40*s,offsetY:0};return g?k.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:i.id===c.id?888:s,transform:`translate(0px, ${r.y+r.offsetY}px)`},children:[k.jsx(NA,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:v,onPointerUp:S,onPointerMove:b,onKeyDown:_,"data-id":i.id,"data-index":s,children:k.jsx(WA,{icon:"drag-handle-dots"})}),n<GA.TABLET_SM&&p?k.jsxs(NA,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const t=window.prompt("Rename page",i.name);t&&t!==i.name&&e.renamePage(i.id,t)},onDoubleClick:m,children:[k.jsx(KN,{checked:i.id===c.id}),k.jsx($A,{children:i.name})]}):k.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:o},children:k.jsx(L$,{id:i.id,name:i.name,isCurrentPage:i.id===c.id})}),!h&&k.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:k.jsx(F$,{index:s,item:i,listSize:l.length})})]},i.id+"_editing"):k.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[k.jsxs(NA,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>e.setCurrentPage(i.id),onDoubleClick:m,title:t("page-menu.go-to-page"),children:[k.jsx(KN,{checked:i.id===c.id}),k.jsx($A,{children:i.name})]}),!h&&k.jsx("div",{className:"tlui-page_menu__item__submenu",children:k.jsx(F$,{index:s,item:i,listSize:l.length,onRename:()=>{if(e.environment.isIos){const t=window.prompt("Rename page",i.name);t&&t!==i.name&&e.renamePage(i.id,t)}else e.batch((()=>{f(!0),e.setCurrentPage(i.id)}))}})})]},i.id)}))})]})})]})}));function $$(){const e=cD(),t=jm(),n=RR(),i=DR(),s=AR(1),r=Vk(),o=Ru("should display quick actions",(()=>t.isInAny("select","hand","zoom")),[t]),a=jR(),l=s&&a;if(!r||o)return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e.undo,disabled:!n}),k.jsx(zF,{...e.redo,disabled:!i}),k.jsx(zF,{...e.delete,disabled:!l}),k.jsx(zF,{...e.duplicate,disabled:!l})]})}const B$=C.memo((function({children:e}){const t=e??k.jsx($$,{});return k.jsx(PR,{type:"small-icons",sourceId:"quick-actions",children:t})})),U$=Object.freeze([cg,hg,ug,fg]);function K$(e=U$){const t=jm();return Ru("getRelevantStyles",(()=>{var n;const i=new db(t.getSharedStyles()),s=!!(null==(n=t.root.getCurrent())?void 0:n.shapeType),r=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(0===i.size&&t.isIn("select")&&0===t.getSelectedShapeIds().length)for(const o of e)i.applyValue(o,t.getStyleForNextShape(o));return s||r||i.size>0?i:null}),[t])}const H$={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},V$=C.memo((function(e){const{uiType:t,items:n,title:i,style:s,value:r,onValueChange:o,theme:a}=e,l=jm(),c=oj(),d=C.useRef(!1),h=C.useRef(null),{handleButtonClick:u,handleButtonPointerDown:p,handleButtonPointerEnter:g,handleButtonPointerUp:f}=C.useMemo((()=>{const e=()=>{d.current=!1,window.removeEventListener("pointerup",e);const t=h.current;t&&["TEXTAREA","INPUT"].includes(t.nodeName)&&t.focus(),h.current=null};return{handleButtonClick:e=>{const{id:t}=e.currentTarget.dataset;"shared"===r.type&&r.value===t||(l.mark("point picker item"),o(s,t))},handleButtonPointerDown:t=>{const{id:n}=t.currentTarget.dataset;l.mark("point picker item"),o(s,n),d.current=!0,h.current=document.activeElement,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!d.current)return;const{id:t}=e.currentTarget.dataset;o(s,t)},handleButtonPointerUp:e=>{const{id:t}=e.currentTarget.dataset;"shared"===r.type&&r.value===t||o(s,t)}}}),[r,l,o,s]);return k.jsx("div",{"data-testid":`style.${t}`,className:I("tlui-buttons__grid"),children:n.map((e=>k.jsx(NA,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===r.type&&r.value===e.value?"hinted":void 0,title:i+" â "+c(`${t}-style.${e.value}`),className:I("tlui-button-grid__button"),style:s===cg?{color:a[e.value].solid}:void 0,onPointerEnter:g,onPointerDown:p,onPointerUp:f,onClick:u,children:k.jsx(WA,{icon:e.icon})},e.value)))})}));function W$(e,[t,n]){return Math.min(n,Math.max(t,e))}var Y$=["PageUp","PageDown"],G$=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],X$={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},q$="Slider",[Z$,J$,Q$]=XM(q$),[eB,tB]=CE(q$,[Q$]),[nB,iB]=eB(q$),sB=C.forwardRef(((e,t)=>{const{name:n,min:i=0,max:s=100,step:r=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[i],value:d,onValueChange:h=()=>{},onValueCommit:u=()=>{},inverted:p=!1,...g}=e,f=C.useRef(new Set),m=C.useRef(0),y="horizontal"===o?aB:lB,[x=[],w]=ME({prop:d,defaultProp:c,onChange:e=>{var t;null==(t=[...f.current][m.current])||t.focus(),h(e)}}),v=C.useRef(x);function b(e,t,{commit:n}={commit:!1}){const o=function(e){return(String(e).split(".")[1]||"").length}(r),a=function(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-i)/r)*r+i,o),c=W$(a,[i,s]);w(((e=[])=>{const i=function(e=[],t,n){const i=[...e];return i[n]=t,i.sort(((e,t)=>e-t))}(e,c,t);if(function(e,t){if(t>0){const n=function(e){return e.slice(0,-1).map(((t,n)=>e[n+1]-t))}(e);return Math.min(...n)>=t}return!0}(i,l*r)){m.current=i.indexOf(c);const t=String(i)!==String(e);return t&&n&&u(i),t?i:e}return e}))}return k.jsx(nB,{scope:e.__scopeSlider,name:n,disabled:a,min:i,max:s,valueIndexToChangeRef:m,thumbs:f.current,values:x,orientation:o,children:k.jsx(Z$.Provider,{scope:e.__scopeSlider,children:k.jsx(Z$.Slot,{scope:e.__scopeSlider,children:k.jsx(y,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:t,onPointerDown:bE(g.onPointerDown,(()=>{a||(v.current=x)})),min:i,max:s,inverted:p,onSlideStart:a?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const n=e.map((e=>Math.abs(e-t))),i=Math.min(...n);return n.indexOf(i)}(x,e);b(e,t)},onSlideMove:a?void 0:function(e){b(e,m.current)},onSlideEnd:a?void 0:function(){const e=v.current[m.current];x[m.current]!==e&&u(x)},onHomeKeyDown:()=>!a&&b(i,0,{commit:!0}),onEndKeyDown:()=>!a&&b(s,x.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){const n=Y$.includes(e.key)||e.shiftKey&&G$.includes(e.key)?10:1,i=m.current;b(x[i]+r*n*t,i,{commit:!0})}}})})})})}));sB.displayName=q$;var[rB,oB]=eB(q$,{startEdge:"left",endEdge:"right",size:"width",direction:1}),aB=C.forwardRef(((e,t)=>{const{min:n,max:i,dir:s,inverted:r,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=e,[h,u]=C.useState(null),p=kE(t,(e=>u(e))),g=C.useRef(),f=zR(s),m="ltr"===f,y=m&&!r||!m&&r;function x(e){const t=g.current||h.getBoundingClientRect(),s=wB([0,t.width],y?[n,i]:[i,n]);return g.current=t,s(e-t.left)}return k.jsx(rB,{scope:e.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:k.jsx(cB,{dir:f,"data-orientation":"horizontal",...d,ref:p,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=x(e.clientX);null==o||o(t)},onSlideMove:e=>{const t=x(e.clientX);null==a||a(t)},onSlideEnd:()=>{g.current=void 0,null==l||l()},onStepKeyDown:e=>{const t=X$[y?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})})})),lB=C.forwardRef(((e,t)=>{const{min:n,max:i,inverted:s,onSlideStart:r,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=e,d=C.useRef(null),h=kE(t,d),u=C.useRef(),p=!s;function g(e){const t=u.current||d.current.getBoundingClientRect(),s=wB([0,t.height],p?[i,n]:[n,i]);return u.current=t,s(e-t.top)}return k.jsx(rB,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:k.jsx(cB,{"data-orientation":"vertical",...c,ref:h,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=g(e.clientY);null==r||r(t)},onSlideMove:e=>{const t=g(e.clientY);null==o||o(t)},onSlideEnd:()=>{u.current=void 0,null==a||a()},onStepKeyDown:e=>{const t=X$[p?"from-bottom":"from-top"].includes(e.key);null==l||l({event:e,direction:t?-1:1})}})})})),cB=C.forwardRef(((e,t)=>{const{__scopeSlider:n,onSlideStart:i,onSlideMove:s,onSlideEnd:r,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=e,d=iB(q$,n);return k.jsx(zE.span,{...c,ref:t,onKeyDown:bE(e.onKeyDown,(e=>{"Home"===e.key?(o(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):Y$.concat(G$).includes(e.key)&&(l(e),e.preventDefault())})),onPointerDown:bE(e.onPointerDown,(e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),d.thumbs.has(t)?t.focus():i(e)})),onPointerMove:bE(e.onPointerMove,(e=>{e.target.hasPointerCapture(e.pointerId)&&s(e)})),onPointerUp:bE(e.onPointerUp,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),r(e))}))})})),dB="SliderTrack",hB=C.forwardRef(((e,t)=>{const{__scopeSlider:n,...i}=e,s=iB(dB,n);return k.jsx(zE.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...i,ref:t})}));hB.displayName=dB;var uB="SliderRange",pB=C.forwardRef(((e,t)=>{const{__scopeSlider:n,...i}=e,s=iB(uB,n),r=oB(uB,n),o=kE(t,C.useRef(null)),a=s.values.length,l=s.values.map((e=>xB(e,s.min,s.max))),c=a>1?Math.min(...l):0,d=100-Math.max(...l);return k.jsx(zE.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...i,ref:o,style:{...e.style,[r.startEdge]:c+"%",[r.endEdge]:d+"%"}})}));pB.displayName=uB;var gB="SliderThumb",fB=C.forwardRef(((e,t)=>{const n=J$(e.__scopeSlider),[i,s]=C.useState(null),r=kE(t,(e=>s(e))),o=C.useMemo((()=>i?n().findIndex((e=>e.ref.current===i)):-1),[n,i]);return k.jsx(mB,{...e,ref:r,index:o})})),mB=C.forwardRef(((e,t)=>{const{__scopeSlider:n,index:i,name:s,...r}=e,o=iB(gB,n),a=oB(gB,n),[l,c]=C.useState(null),d=kE(t,(e=>c(e))),h=!l||Boolean(l.closest("form")),u=PD(l),p=o.values[i],g=void 0===p?0:xB(p,o.min,o.max),f=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(i,o.values.length),m=null==u?void 0:u[a.size],y=m?function(e,t,n){const i=e/2,s=wB([0,50],[0,i]);return(i-s(t)*n)*n}(m,g,a.direction):0;return C.useEffect((()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}}),[l,o.thumbs]),k.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${g}% + ${y}px)`},children:[k.jsx(Z$.ItemSlot,{scope:e.__scopeSlider,children:k.jsx(zE.span,{role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...r,ref:d,style:void 0===p?{display:"none"}:e.style,onFocus:bE(e.onFocus,(()=>{o.valueIndexToChangeRef.current=i}))})}),h&&k.jsx(yB,{name:s??(o.name?o.name+(o.values.length>1?"[]":""):void 0),value:p},i)]})}));fB.displayName=gB;var yB=e=>{const{value:t,...n}=e,i=C.useRef(null),s=function(e){const t=C.useRef({value:e,previous:e});return C.useMemo((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}(t);return C.useEffect((()=>{const e=i.current,n=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(n,"value").set;if(s!==t&&r){const n=new Event("input",{bubbles:!0});r.call(e,t),e.dispatchEvent(n)}}),[s,t]),k.jsx("input",{style:{display:"none"},...n,ref:i,defaultValue:t})};function xB(e,t,n){return W$(100/(n-t)*(e-t),[0,100])}function wB(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const i=(t[1]-t[0])/(e[1]-e[0]);return t[0]+i*(n-e[0])}}var vB=sB,bB=hB,SB=pB,kB=fB;const CB=C.memo((function(e){const{title:t,steps:n,value:i,label:s,onValueChange:r}=e,o=jm(),a=oj(),l=C.useCallback((e=>{r(e[0])}),[r]),c=C.useCallback((()=>{o.mark("click slider")}),[o]),d=C.useCallback((()=>{i&&r(i)}),[i,r]);return k.jsx("div",{className:"tlui-slider__container",children:k.jsxs(vB,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:i?[i]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:d,title:t+" â "+a(s),children:[k.jsx(bB,{className:"tlui-slider__track",dir:"ltr",children:null!==i&&k.jsx(SB,{className:"tlui-slider__range",dir:"ltr"})}),null!==i&&k.jsx(kB,{className:"tlui-slider__thumb",dir:"ltr"})]})})}));const _B=C.memo((function({label:e,uiTypeA:t,uiTypeB:n,labelA:i,labelB:s,itemsA:r,itemsB:o,styleA:a,styleB:l,valueA:c,valueB:d,onValueChange:h}){const u=oj(),p=C.useMemo((()=>{var e;return(null==(e=r.find((e=>"shared"===c.type&&c.value===e.value)))?void 0:e.icon)??"mixed"}),[r,c]),g=C.useMemo((()=>{var e;return(null==(e=o.find((e=>"shared"===d.type&&d.value===e.value)))?void 0:e.icon)??"mixed"}),[o,d]);return void 0===c&&void 0===d?null:k.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[k.jsx("div",{title:u(e),className:"tlui-style-panel__double-select-picker-label",children:u(e)}),k.jsxs("div",{className:"tlui-buttons__horizontal",children:[k.jsxs(jF,{id:`style panel ${t} A`,children:[k.jsx(EF,{children:k.jsx(NA,{type:"icon","data-testid":`style.${t}`,title:u(i)+" â "+(null===c||"mixed"===c.type?u("style-panel.mixed"):u(`${t}-style.${c.value}`)),children:k.jsx(WA,{icon:p,small:!0,invertIcon:!0})})}),k.jsx(TF,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:k.jsx("div",{className:"tlui-buttons__grid",children:r.map(((e,n)=>k.jsx(RF,{"data-testid":`style.${t}.${e.value}`,children:k.jsx(NA,{type:"icon",onClick:()=>h(a,e.value),title:`${u(i)} â ${u(`${t}-style.${e.value}`)}`,children:k.jsx(WA,{icon:e.icon,invertIcon:!0})},e.value)},n)))})})]}),k.jsxs(jF,{id:`style panel ${n}`,children:[k.jsx(EF,{children:k.jsx(NA,{type:"icon","data-testid":`style.${n}`,title:u(s)+" â "+(null===d||"mixed"===d.type?u("style-panel.mixed"):u(`${n}-style.${d.value}`)),children:k.jsx(WA,{icon:g,small:!0})})}),k.jsx(TF,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:k.jsx("div",{className:"tlui-buttons__grid",children:o.map((e=>k.jsx(RF,{children:k.jsx(NA,{type:"icon",title:`${u(s)} â ${u(`${n}-style.${e.value}`)}`,"data-testid":`style.${n}.${e.value}`,onClick:()=>h(l,e.value),children:k.jsx(WA,{icon:e.icon})})},e.value)))})})]})]})]})}));const PB=C.memo((function({id:e,label:t,uiType:n,style:i,items:s,type:r,value:o,onValueChange:a}){const l=oj(),c=jm(),d=C.useMemo((()=>{var e;return null==(e=s.find((e=>"shared"===o.type&&e.value===o.value)))?void 0:e.icon}),[s,o]),h="mixed"===o.type?l("style-panel.mixed"):l(`${n}-style.${o.value}`),u=t?l(t):"";return k.jsxs(jF,{id:`style panel ${e}`,children:[k.jsx(EF,{children:k.jsxs(NA,{type:r,"data-testid":`style.${n}`,title:h,children:[k.jsx($A,{children:u}),k.jsx(WA,{icon:d??"mixed"})]})}),k.jsx(TF,{side:"left",align:"center",alignOffset:0,children:k.jsx("div",{className:"tlui-buttons__grid",children:s.map((e=>k.jsx(RF,{children:k.jsx(NA,{type:"icon","data-testid":`style.${n}.${e.value}`,title:l(`${n}-style.${e.value}`),onClick:()=>{c.mark("select style dropdown item"),a(i,e.value)},children:k.jsx(WA,{icon:e.icon})})},e.value)))})})]})}));function IB({styles:e}){const t=mS();if(!e)return null;const n=e.get(Kf),i=e.get(xg),s=e.get(yg),r=void 0===n,o=void 0===i&&void 0===s,a=void 0===e.get(tm),l=void 0===e.get(pg),c=lg({isDarkMode:t});return k.jsxs(k.Fragment,{children:[k.jsx(EB,{theme:c,styles:e}),!l&&k.jsx(TB,{theme:c,styles:e}),!(r&&o&&a)&&k.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[k.jsx(MB,{styles:e}),k.jsx(OB,{styles:e}),k.jsx(AB,{styles:e})]})]})}function jB(){const e=jm(),t=BM();return P.useMemo((()=>function(n,i){e.batch((()=>{e.isIn("select")&&e.setStyleForSelectedShapes(n,i),e.setStyleForNextShapes(n,i),e.updateInstanceState({isChangingStyle:!0})})),t("set-style",{source:"style-panel",id:n.id,value:i})}),[e,t])}function EB({styles:e,theme:t}){const n=oj(),i=jm(),s=jB(),r=e.get(cg),o=e.get(ug),a=e.get(hg),l=e.get(fg),c=void 0!==o||void 0!==a||void 0!==l;return k.jsxs(k.Fragment,{children:[k.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[void 0===r?null:k.jsx(V$,{title:n("style-panel.color"),uiType:"color",style:cg,items:H$.color,value:r,onValueChange:s,theme:t}),k.jsx(RB,{})]}),c&&k.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===o?null:k.jsx(V$,{title:n("style-panel.fill"),uiType:"fill",style:ug,items:H$.fill,value:o,onValueChange:s,theme:t}),void 0===a?null:k.jsx(V$,{title:n("style-panel.dash"),uiType:"dash",style:hg,items:H$.dash,value:a,onValueChange:s,theme:t}),void 0===l?null:k.jsx(V$,{title:n("style-panel.size"),uiType:"size",style:fg,items:H$.size,value:l,onValueChange:(e,t)=>{s(e,t);const n=i.getSelectedShapeIds();n.length>0&&I_(i,n)},theme:t})]})]})}function TB({theme:e,styles:t}){const n=oj(),i=jB(),s=t.get(pg),r=t.get(cm),o=t.get(Bf),a=t.get(Uf);return void 0===s&&void 0===o?null:k.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===s?null:k.jsx(V$,{title:n("style-panel.font"),uiType:"font",style:pg,items:H$.font,value:s,onValueChange:i,theme:e}),void 0===r?null:k.jsxs("div",{className:"tlui-style-panel__row",children:[k.jsx(V$,{title:n("style-panel.align"),uiType:"align",style:cm,items:H$.textAlign,value:r,onValueChange:i,theme:e}),k.jsx("div",{className:"tlui-style-panel__row__extra-button",children:k.jsx(NA,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:k.jsx(WA,{icon:"vertical-align-middle"})})})]}),void 0===o?null:k.jsxs("div",{className:"tlui-style-panel__row",children:[k.jsx(V$,{title:n("style-panel.align"),uiType:"align",style:Bf,items:H$.horizontalAlign,value:o,onValueChange:i,theme:e}),k.jsx("div",{className:"tlui-style-panel__row__extra-button",children:void 0===a?k.jsx(NA,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:k.jsx(WA,{icon:"vertical-align-middle"})}):k.jsx(PB,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Uf,items:H$.verticalAlign,value:a,onValueChange:i})})]})]})}function MB({styles:e}){const t=jB(),n=e.get(Kf);return void 0===n?null:k.jsx(PB,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Kf,items:H$.geo,value:n,onValueChange:t})}function AB({styles:e}){const t=jB(),n=e.get(tm);return void 0===n?null:k.jsx(PB,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:tm,items:H$.spline,value:n,onValueChange:t})}function OB({styles:e}){const t=jB(),n=e.get(xg),i=e.get(yg);return n&&i?k.jsx(_B,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:yg,itemsA:H$.arrowheadStart,valueA:i,uiTypeB:"arrowheadEnd",styleB:xg,itemsB:H$.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}const DB=[.1,.25,.5,.75,1];function RB(){const e=jm(),t=Ru("opacity",(()=>e.getSharedOpacity()),[e]),n=BM(),i=oj(),s=P.useCallback((t=>{const i=DB[t];e.batch((()=>{e.isIn("select")&&e.setOpacityForSelectedShapes(i),e.setOpacityForNextShapes(i),e.updateInstanceState({isChangingStyle:!0})})),n("set-style",{source:"style-panel",id:"opacity",value:t})}),[e,n]);if(void 0===t)return null;const r="mixed"===t.type?-1:DB.indexOf(function(e,t){let n,i=1/0;for(const s of e){const e=t(s);e<i&&(n=s,i=e)}return n}(DB,(e=>Math.abs(e-t.value))));return k.jsx(CB,{"data-testid":"style.opacity",value:r>=0?r:DB.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:s,steps:DB.length-1,title:i("style-panel.opacity")})}const LB=C.memo((function({isMobile:e,children:t}){const n=jm(),i=K$(),s=C.useCallback((()=>{e||n.updateInstanceState({isChangingStyle:!1})}),[n,e]),r=t??k.jsx(IB,{styles:i});return k.jsx("div",{className:I("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:s,children:r})}));function zB(){const e=jm(),t=oj(),n=K$(),i=null==n?void 0:n.get(cg),s=lg({isDarkMode:e.user.getIsDarkMode()}),r=("shared"===(null==i?void 0:i.type)?s[i.value]:s.black).solid,o=Ru("disable style panel",(()=>e.isInAny("hand","zoom","eraser","laser")),[e]),a=C.useCallback((t=>{t||e.updateInstanceState({isChangingStyle:!1})}),[e]),{StylePanel:l}=ZU();return l?k.jsxs(bR,{id:"mobile style menu",onOpenChange:a,children:[k.jsx(SR,{children:k.jsx(NA,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":r},title:t("style-panel.title"),disabled:o,children:k.jsx(WA,{icon:o?"blob":"mixed"===(null==i?void 0:i.type)?"mixed":"blob"})})}),k.jsx(kR,{side:"top",align:"end",children:l&&k.jsx(l,{isMobile:!0})})]}):null}function FB(){return k.jsxs(k.Fragment,{children:[k.jsx($B,{}),k.jsx(BB,{}),k.jsx(UB,{}),k.jsx(KB,{}),k.jsx(HB,{}),k.jsx(VB,{}),k.jsx(WB,{}),k.jsx(YB,{}),k.jsx(GB,{}),k.jsx(XB,{}),k.jsx(ZB,{}),k.jsx(qB,{}),k.jsx(eU,{}),k.jsx(iU,{}),k.jsx(JB,{}),k.jsx(nU,{}),k.jsx(tU,{}),k.jsx(QB,{}),k.jsx(sU,{}),k.jsx(rU,{}),k.jsx(oU,{}),k.jsx(aU,{}),k.jsx(lU,{}),k.jsx(cU,{}),k.jsx(dU,{}),k.jsx(hU,{}),k.jsx(pU,{}),k.jsx(uU,{})]})}function NB({tool:e}){const t=cO(),n=function(e){var t;const n=jm(),i=null==(t=e.meta)?void 0:t.geo;return Ru("is tool selected",(()=>{const t=n.getCurrentToolId(),s=n.getSharedStyles().getAsKnownValue(Kf);return i?"geo"===t&&s===i:t===e.id}),[n,e.id,i])}(t[e]);return k.jsx(zF,{...t[e],isSelected:n})}function $B(){return k.jsx(NB,{tool:"select"})}function BB(){return k.jsx(NB,{tool:"hand"})}function UB(){return k.jsx(NB,{tool:"draw"})}function KB(){return k.jsx(NB,{tool:"eraser"})}function HB(){return k.jsx(NB,{tool:"arrow"})}function VB(){return k.jsx(NB,{tool:"text"})}function WB(){return k.jsx(NB,{tool:"note"})}function YB(){const e=cO();return k.jsx(zF,{...e.asset})}function GB(){return k.jsx(NB,{tool:"rectangle"})}function XB(){return k.jsx(NB,{tool:"ellipse"})}function qB(){return k.jsx(NB,{tool:"diamond"})}function ZB(){return k.jsx(NB,{tool:"triangle"})}function JB(){return k.jsx(NB,{tool:"rhombus"})}function QB(){return k.jsx(NB,{tool:"heart"})}function eU(){return k.jsx(NB,{tool:"hexagon"})}function tU(){return k.jsx(NB,{tool:"cloud"})}function nU(){return k.jsx(NB,{tool:"star"})}function iU(){return k.jsx(NB,{tool:"oval"})}function sU(){return k.jsx(NB,{tool:"x-box"})}function rU(){return k.jsx(NB,{tool:"check-box"})}function oU(){return k.jsx(NB,{tool:"arrow-left"})}function aU(){return k.jsx(NB,{tool:"arrow-up"})}function lU(){return k.jsx(NB,{tool:"arrow-down"})}function cU(){return k.jsx(NB,{tool:"arrow-right"})}function dU(){return k.jsx(NB,{tool:"line"})}function hU(){return k.jsx(NB,{tool:"highlight"})}function uU(){return k.jsx(NB,{tool:"frame"})}function pU(){return k.jsx(NB,{tool:"laser"})}const gU="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function fU(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on".concat(t),n)}function mU(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on".concat(t),n)}function yU(e,t){const n=t.slice(0,t.length-1);for(let i=0;i<n.length;i++)n[i]=e[n[i].toLowerCase()];return n}function xU(e){"string"!=typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}const wU={backspace:8,"â«":8,tab:9,clear:12,enter:13,"â©":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"âª":20,",":188,".":190,"/":191,"`":192,"-":gU?173:189,"=":gU?61:187,";":gU?59:186,"'":222,"[":219,"]":221,"\\":220},vU={"â§":16,shift:16,"â¥":18,alt:18,option:18,"â":17,ctrl:17,control:17,"â":91,cmd:91,command:91},bU={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},SU={16:!1,18:!1,17:!1,91:!1},kU={};for(let KX=1;KX<20;KX++)wU["f".concat(KX)]=111+KX;let CU=[],_U=null,PU="all";const IU=new Map,jU=e=>wU[e.toLowerCase()]||vU[e.toLowerCase()]||e.toUpperCase().charCodeAt(0);function EU(e){PU=e||"all"}function TU(){return PU||"all"}function MU(e){if(void 0===e)Object.keys(kU).forEach((e=>{Array.isArray(kU[e])&&kU[e].forEach((e=>AU(e))),delete kU[e]})),LU(null);else if(Array.isArray(e))e.forEach((e=>{e.key&&AU(e)}));else if("object"==typeof e)e.key&&AU(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let[s,r]=n;"function"==typeof s&&(r=s,s=""),AU({key:e,scope:s,method:r,splitKey:"+"})}}const AU=e=>{let{key:t,scope:n,method:i,splitKey:s="+"}=e;xU(t).forEach((e=>{const t=e.split(s),r=t.length,o=t[r-1],a="*"===o?"*":jU(o);if(!kU[a])return;n||(n=TU());const l=r>1?yU(vU,t):[],c=[];kU[a]=kU[a].filter((e=>{const t=(!i||e.method===i)&&e.scope===n&&function(e,t){const n=e.length>=t.length?e:t,i=e.length>=t.length?t:e;let s=!0;for(let r=0;r<n.length;r++)-1===i.indexOf(n[r])&&(s=!1);return s}(e.mods,l);return t&&c.push(e.element),!t})),c.forEach((e=>LU(e)))}))};function OU(e,t,n,i){if(t.element!==i)return;let s;if(t.scope===n||"all"===t.scope){s=t.mods.length>0;for(const e in SU)Object.prototype.hasOwnProperty.call(SU,e)&&(!SU[e]&&t.mods.indexOf(+e)>-1||SU[e]&&-1===t.mods.indexOf(+e))&&(s=!1);(0!==t.mods.length||SU[16]||SU[18]||SU[17]||SU[91])&&!s&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(CU),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function DU(e,t){const n=kU["*"];let i=e.keyCode||e.which||e.charCode;if(!RU.filter.call(this,e))return;if(93!==i&&224!==i||(i=91),-1===CU.indexOf(i)&&229!==i&&CU.push(i),["ctrlKey","altKey","shiftKey","metaKey"].forEach((t=>{const n=bU[t];e[t]&&-1===CU.indexOf(n)?CU.push(n):!e[t]&&CU.indexOf(n)>-1?CU.splice(CU.indexOf(n),1):"metaKey"===t&&e[t]&&3===CU.length&&(e.ctrlKey||e.shiftKey||e.altKey||(CU=CU.slice(CU.indexOf(n))))})),i in SU){SU[i]=!0;for(const e in vU)vU[e]===i&&(RU[e]=!0);if(!n)return}for(const a in SU)Object.prototype.hasOwnProperty.call(SU,a)&&(SU[a]=e[bU[a]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===CU.indexOf(17)&&CU.push(17),-1===CU.indexOf(18)&&CU.push(18),SU[17]=!0,SU[18]=!0);const s=TU();if(n)for(let a=0;a<n.length;a++)n[a].scope===s&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&OU(e,n[a],s,t);if(!(i in kU))return;const r=kU[i],o=r.length;for(let a=0;a<o;a++)if(("keydown"===e.type&&r[a].keydown||"keyup"===e.type&&r[a].keyup)&&r[a].key){const n=r[a],{splitKey:i}=n,o=n.key.split(i),l=[];for(let e=0;e<o.length;e++)l.push(jU(o[e]));l.sort().join("")===CU.sort().join("")&&OU(e,n,s,t)}}function RU(e,t,n){CU=[];const i=xU(e);let s=[],r="all",o=document,a=0,l=!1,c=!0,d="+",h=!1,u=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(r=t.scope),t.element&&(o=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(h=t.capture),"string"==typeof t.splitKey&&(d=t.splitKey),!0===t.single&&(u=!0)),"string"==typeof t&&(r=t),u&&MU(e,r);a<i.length;a++)s=[],(e=i[a].split(d)).length>1&&(s=yU(vU,e)),(e="*"===(e=e[e.length-1])?"*":jU(e))in kU||(kU[e]=[]),kU[e].push({keyup:l,keydown:c,scope:r,mods:s,shortcut:i[a],method:n,key:i[a],splitKey:d,element:o});if(void 0!==o&&window){if(!IU.has(o)){const e=function(){return DU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,o)},t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;DU(e,o),function(e){let t=e.keyCode||e.which||e.charCode;const n=CU.indexOf(t);if(n>=0&&CU.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&CU.splice(0,CU.length),93!==t&&224!==t||(t=91),t in SU){SU[t]=!1;for(const e in vU)vU[e]===t&&(RU[e]=!1)}}(e)};IU.set(o,{keydownListener:e,keyupListenr:t,capture:h}),fU(o,"keydown",e,h),fU(o,"keyup",t,h)}if(!_U){const e=()=>{CU=[]};_U={listener:e,capture:h},fU(window,"focus",e,h)}}}function LU(e){const t=Object.values(kU).flat();if(t.findIndex((t=>{let{element:n}=t;return n===e}))<0){const{keydownListener:t,keyupListenr:n,capture:i}=IU.get(e)||{};t&&n&&(mU(e,"keyup",n,i),mU(e,"keydown",t,i),IU.delete(e))}if(t.length<=0||IU.size<=0){if(Object.keys(IU).forEach((e=>{const{keydownListener:t,keyupListenr:n,capture:i}=IU.get(e)||{};t&&n&&(mU(e,"keyup",n,i),mU(e,"keydown",t,i),IU.delete(e))})),IU.clear(),Object.keys(kU).forEach((e=>delete kU[e])),_U){const{listener:e,capture:t}=_U;mU(window,"focus",e,t),_U=null}}}const zU={getPressedKeyString:function(){return CU.map((e=>{return t=e,Object.keys(wU).find((e=>wU[e]===t))||(e=>Object.keys(vU).find((t=>vU[t]===e)))(e)||String.fromCharCode(e);var t}))},setScope:EU,getScope:TU,deleteScope:function(e,t){let n,i;e||(e=TU());for(const s in kU)if(Object.prototype.hasOwnProperty.call(kU,s))for(n=kU[s],i=0;i<n.length;)if(n[i].scope===e){n.splice(i,1).forEach((e=>{let{element:t}=e;return LU(t)}))}else i++;TU()===e&&EU(t||"all")},getPressedKeyCodes:function(){return CU.slice(0)},getAllKeyCodes:function(){const e=[];return Object.keys(kU).forEach((t=>{kU[t].forEach((t=>{let{key:n,scope:i,mods:s,shortcut:r}=t;e.push({scope:i,shortcut:r,mods:s,keys:n.split("+").map((e=>jU(e)))})}))})),e},isPressed:function(e){return"string"==typeof e&&(e=jU(e)),-1!==CU.indexOf(e)},filter:function(e){const t=e.target||e.srcElement,{tagName:n}=t;let i=!0;const s="INPUT"===n&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(s||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(i=!1),i},trigger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(kU).forEach((n=>{kU[n].filter((n=>n.scope===t&&n.shortcut===e)).forEach((e=>{e&&e.method&&e.method()}))}))},unbind:MU,keyMap:wU,modifier:vU,modifierMap:bU};for(const KX in zU)Object.prototype.hasOwnProperty.call(zU,KX)&&(RU[KX]=zU[KX]);if("undefined"!=typeof window){const e=window.hotkeys;RU.noConflict=t=>(t&&window.hotkeys===RU&&(window.hotkeys=e),RU),window.hotkeys=RU}const FU=["copy","cut","paste","asset"];function NU(e){return function(e){"string"!=typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}(e).map((e=>{let t="";const n=e.split("");return t=1===n.length?n[0]:"!"===n[0]?`shift+${n[1]}`:"?"===n[0]?3===n.length&&"!"===n[1]?`alt+shift+${n[2]}`:`alt+${n[1]}`:"$"===n[0]?"!"===n[1]?`cmd+shift+${n[2]},ctrl+shift+${n[2]}`:"?"===n[1]?`cmd+â¥+${n[2]},ctrl+alt+${n[2]}`:`cmd+${n[1]},ctrl+${n[1]}`:e,t})).join(",")}function $U(e){return e.getIsMenuOpen()||null!==e.getEditingShapeId()||e.getCrashingError()}const BU=C.createContext(!1);function UU({children:e}){const t=jm(),n=C.useId().replace(/:/g,"_"),i=uO(),s=oj(),r=Math.min(8,5+i),[o,a]=C.useState(0),l=C.useRef(null),[c,d]=C.useState(null),h=C.useMemo((()=>`\n\t\t\t#${n}_main > *:nth-child(n + ${r+(c?1:2)})${c?`:not([data-value="${c}"])`:""} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#${n}_more > *:nth-child(-n + ${r}) {\n\t\t\t\tdisplay: none;\n\t\t\t}\n        `),[c,n,r]),u=CS((()=>{if(!l.current)return;const e=Array.from(l.current.children);a(e.length);e.findIndex((e=>e.getAttribute("data-value")===c))<=r&&d(null);const t=Array.from(l.current.children).findIndex((e=>"true"===e.getAttribute("aria-checked")));-1!==t&&t>=r&&d(e[t].getAttribute("data-value"))}));return C.useLayoutEffect((()=>{u()})),C.useLayoutEffect((()=>{if(!l.current)return;const e=new MutationObserver(u);return e.observe(l.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{e.disconnect()}}),[u]),C.useEffect((()=>{const e=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[n,i]of e)RU(n,(e=>{var n;if($U(t))return;Cy(e);const s=Array.from((null==(n=l.current)?void 0:n.children)??[]).filter((e=>e instanceof HTMLElement&&("button"===e.tagName.toLowerCase()&&!(!e.offsetWidth&&!e.offsetHeight))))[i];s&&s.click()}));return()=>{RU.unbind("1,2,3,4,5,6,7,8,9,0")}}),[t]),k.jsxs(k.Fragment,{children:[k.jsx("style",{children:h}),k.jsxs("div",{className:I("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":i<GA.TABLET_SM}),role:"radiogroup",children:[k.jsx("div",{id:`${n}_main`,ref:l,className:"tlui-toolbar__tools__list",children:k.jsx(PR,{type:"toolbar",sourceId:"toolbar",children:e})}),o>r+1&&k.jsx(BU.Provider,{value:!0,children:k.jsxs(jF,{id:"toolbar overflow",modal:!1,children:[k.jsx(EF,{children:k.jsx(NA,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:k.jsx(WA,{icon:"chevron-up"})})}),k.jsx(TF,{side:"top",align:"center",children:k.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${n}_more`,children:k.jsx(PR,{type:"toolbar-overflow",sourceId:"toolbar",children:e})})})]})})]})]})}const KU=["select","hand","draw","eraser","text","zoom","laser","highlight"];function HU({activeToolId:e}){const t=jm(),n=uO(),i=oj(),s=Ru("is tool locked",(()=>t.getInstanceState().isToolLocked),[t]);return!e||KU.includes(e)?null:k.jsx(NA,{type:"normal",title:i("action.toggle-tool-lock"),"data-testid":"tool-lock",className:I("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<GA.TABLET_SM}),onClick:()=>t.updateInstanceState({isToolLocked:!s}),children:k.jsx(WA,{icon:s?"lock":"unlock",small:!0})})}const VU=C.memo((function({children:e}){const t=jm(),n=uO(),i=Vk(),s=Ru("current tool id",(()=>t.getCurrentToolId()),[t]),{ActionsMenu:r,QuickActions:o}=ZU();return k.jsx("div",{className:"tlui-toolbar",children:k.jsxs("div",{className:"tlui-toolbar__inner",children:[k.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&k.jsxs("div",{className:"tlui-toolbar__extras",children:[n<GA.TABLET&&k.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[o&&k.jsx(o,{}),r&&k.jsx(r,{})]}),k.jsx(HU,{activeToolId:s})]}),k.jsx(UU,{children:e??k.jsx(FB,{})})]}),n<GA.TABLET_SM&&!i&&k.jsx("div",{className:"tlui-toolbar__tools",children:k.jsx(zB,{})})]})})}));function WU(){const e=cD();return k.jsxs(k.Fragment,{children:[k.jsx(zF,{...e["zoom-in"],noClose:!0}),k.jsx(zF,{...e["zoom-out"],noClose:!0}),k.jsx(pN,{}),k.jsx(gN,{}),k.jsx(fN,{})]})}const YU=C.memo((function({children:e}){const t=Ay(),[n,i]=vR("zoom menu"),s=e??k.jsx(WU,{});return k.jsxs(xF,{dir:"ltr",open:n,onOpenChange:i,modal:!1,children:[k.jsx(wF,{asChild:!0,dir:"ltr",children:k.jsx(GU,{})}),k.jsx(vF,{container:t,children:k.jsx(bF,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:k.jsx(PR,{type:"menu",sourceId:"zoom-menu",children:s})})})]})})),GU=C.forwardRef((function(e,t){const n=jm(),i=uO(),s=Ru("zoom",(()=>n.getZoomLevel()),[n]),r=oj(),o=C.useCallback((()=>{n.resetZoom(n.getViewportScreenCenter(),{animation:{duration:n.options.animationMediumMs}})}),[n]);return k.jsx(NA,{ref:t,...e,type:"icon",title:`${r("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<GA.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:o,icon:i<GA.MOBILE?"zoom-in":void 0,children:i<GA.MOBILE?null:k.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*s),"%"]})})})),XU=C.createContext(null);function qU({overrides:e={},children:t}){const n=Zw(e);return k.jsx(XU.Provider,{value:C.useMemo((()=>({ContextMenu:UN,ActionsMenu:ZF,HelpMenu:i$,ZoomMenu:YU,MainMenu:S$,Minimap:D$,StylePanel:LB,PageMenu:N$,NavigationPanel:R$,Toolbar:VU,KeyboardShortcutsDialog:d$,QuickActions:B$,HelperButtons:l$,DebugPanel:ZN,DebugMenu:qN,MenuPanel:k$,...n})),[n]),children:t})}function ZU(){const e=C.useContext(XU);if(!e)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return e}function JU({overrides:e,components:t,assetUrls:n,onUiEvent:i,forceMobile:s,children:r}){return k.jsx(JI,{assetUrls:JA(n),children:k.jsx(rj,{overrides:gO(e),children:k.jsx($M,{onEvent:i,children:k.jsx(zA,{children:k.jsx(KM,{children:k.jsx(hO,{forceMobile:s,children:k.jsx(qU,{overrides:t,children:k.jsx(QU,{overrides:e,children:r})})})})})})})})}function QU({overrides:e,children:t}){const n=fO(e);return k.jsx(lD,{overrides:n.actions,children:k.jsx(lO,{overrides:n.tools,children:t})})}const eK=P.memo((function({renderDebugMenuItems:e,children:t,hideUi:n,components:i,...s}){return k.jsx(JU,{...s,components:i,children:k.jsx(tK,{hideUi:n,renderDebugMenuItems:e,children:t})})})),tK=P.memo((function({children:e,hideUi:t,...n}){return k.jsxs(k.Fragment,{children:[e,t?null:k.jsx(iK,{...n}),k.jsx(nK,{})]})}));function nK(){const{InFrontOfTheCanvas:e}=ev();return e?k.jsx("div",{className:"tl-front",children:k.jsx(e,{})}):null}const iK=P.memo((function(){const e=jm(),t=oj(),n=uO(),i=Vk(),s=Ru("focus",(()=>e.getInstanceState().isFocusMode),[e]),r=Ru("debug",(()=>e.getInstanceState().isDebugMode),[e]),{SharePanel:o,TopPanel:a,MenuPanel:l,StylePanel:c,Toolbar:d,HelpMenu:h,NavigationPanel:u,HelperButtons:p,DebugPanel:g}=ZU();!function(){const e=jm(),t=Vk(),n=cD(),i=cO(),s=Ru("is focused",(()=>e.getInstanceState().isFocused),[e]);C.useEffect((()=>{if(!s)return;const r=new Array,o=(e,t)=>{RU(e,{element:document.body},t),r.push((()=>{RU.unbind(e,t)}))};for(const i of Object.values(n))i.kbd&&(t&&!i.readonlyOk||FU.includes(i.id)||o(NU(i.kbd),(t=>{$U(e)||(Cy(t),i.onSelect("kbd"))})));for(const t of Object.values(i))!t.kbd||!t.readonlyOk&&e.getInstanceState().isReadonly||FU.includes(t.id)||o(NU(t.kbd),(n=>{$U(e)||(Cy(n),t.onSelect("kbd"))}));return o(",",(t=>{if($U(e))return;if(e.inputs.keys.has("Comma"))return;Cy(t),e.focus(),e.inputs.keys.add("Comma");const{x:n,y:i,z:s}=e.inputs.currentScreenPoint,r={type:"pointer",name:"pointer_down",point:{x:n,y:i,z:s},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(r)})),((e,t)=>{RU(e,{element:document.body,keyup:!0,keydown:!1},t),r.push((()=>{RU.unbind(e,t)}))})(",",(t=>{if($U(e))return;if(!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");const{x:n,y:i,z:s}=e.inputs.currentScreenPoint,r={type:"pointer",name:"pointer_up",point:{x:n,y:i,z:s},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(r)})),()=>{r.forEach((e=>e()))}}),[n,i,t,e,s])}(),qO(),function(){const e=jm(),{addToast:t}=FA();C.useEffect((()=>{function n({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}}),[e,t])}();const{"toggle-focus-mode":f}=cD();return k.jsxs("div",{className:I("tlui-layout",{"tlui-layout__mobile":n<GA.TABLET_SM}),"data-breakpoint":n,children:[s?k.jsx("div",{className:"tlui-layout__top",children:k.jsx(NA,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>f.onSelect("menu"),children:k.jsx(WA,{icon:"dot"})})}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"tlui-layout__top",children:[k.jsxs("div",{className:"tlui-layout__top__left",children:[l&&k.jsx(l,{}),p&&k.jsx(p,{})]}),k.jsx("div",{className:"tlui-layout__top__center",children:a&&k.jsx(a,{})}),k.jsxs("div",{className:"tlui-layout__top__right",children:[o&&k.jsx(o,{}),c&&n>=GA.TABLET_SM&&!i&&k.jsx(c,{})]})]}),k.jsxs("div",{className:"tlui-layout__bottom",children:[k.jsxs("div",{className:"tlui-layout__bottom__main",children:[u&&k.jsx(u,{}),d&&k.jsx(d,{}),h&&k.jsx(h,{})]}),r&&g&&k.jsx(g,{})]})]}),k.jsx(HA,{}),k.jsx(WM,{}),k.jsx(VA,{}),k.jsx(YM,{})]})}));const sK=(e,t)=>{const[n,i]=C.useState(2);return C.useEffect((()=>{let n=!1;return i(2),async function(e,t){const{url:n,style:i="normal",weight:s="500",display:r,featureSettings:o,stretch:a,unicodeRange:l,variant:c,format:d}=t,h=new FontFace(e,`url(${n})`,{style:i,weight:s,display:r,featureSettings:o,stretch:a,unicodeRange:l,variant:c});return await h.load(),document.fonts.add(h),h.$$_url=n,h.$$_fontface=`\n@font-face {\n\tfont-family: ${h.family};\n\tfont-stretch: ${h.stretch};\n\tfont-weight: ${h.weight};\n\tfont-style: ${h.style};\n\tsrc: url("${n}") format("${d}")\n}`,h}(e,t).then((()=>{n||i(0)})).catch((e=>{n||(console.error(e),i(1))})),()=>{n=!0}}),[e,t]),n};function rK(e){const t=C.useMemo((()=>function(e){return{draw:{url:e.fonts.draw,format:e.fonts.draw.split(".").pop()},serif:{url:e.fonts.serif,format:e.fonts.serif.split(".").pop()},sansSerif:{url:e.fonts.sansSerif,format:e.fonts.sansSerif.split(".").pop()},monospace:{url:e.fonts.monospace,format:e.fonts.monospace.split(".").pop()}}}(e)),[e]),n=[sK("tldraw_draw",t.draw),sK("tldraw_serif",t.serif),sK("tldraw_sans",t.sansSerif),sK("tldraw_mono",t.monospace)];return{error:n.some((e=>1===e)),done:!n.some((e=>2===e))}}function oK(e){const{children:t,maxImageDimension:n,maxAssetSize:i,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:r,onMount:o,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:d=[],...h}=e,u=Zw(a),p=C.useMemo((()=>({Scribble:Kk,CollaboratorScribble:Kk,SelectionForeground:Yk,SelectionBackground:Hk,Handles:Ak,...u})),[u]),g=qw(l),f=C.useMemo((()=>[...wj,...g]),[g]),m=qw(c),y=C.useMemo((()=>[...xC,...m]),[m]),x=qw(d),w=C.useMemo((()=>[...vE,...Y_,...x]),[x]),v="persistenceKey"in h?h.persistenceKey:void 0,b=qA(h.assetUrls),S=C.useMemo((()=>({onResolveAsset:h_(v),...h.assetOptions})),[v,h.assetOptions]),{done:_,error:P}=rK(b);return P?k.jsx(uk,{children:"Could not load assets. Please refresh the page."}):_?k.jsx(rk,{initialState:"select",...h,components:p,shapeUtils:f,bindingUtils:y,tools:w,assetOptions:S,children:k.jsxs(eK,{...h,components:p,children:[k.jsx(aK,{maxImageDimension:n,maxAssetSize:i,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:r,persistenceKey:v,onMount:o}),t]})}):k.jsx(hk,{children:k.jsx(Yw,{})})}function aK({maxImageDimension:e=1e3,maxAssetSize:t=10485760,acceptedImageMimeTypes:n=Ld,acceptedVideoMimeTypes:i=zd,onMount:s,persistenceKey:r}){const o=jm(),a=FA(),l=oj(),c=CS((o=>{const c=[];return c.push(...function(e){return[e.sideEffects.registerAfterChangeHandler("instance_page_state",((t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){const i=e.isIn("select.crop");!t.croppingShapeId&&n.croppingShapeId?i||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&i&&e.setCurrentTool("select.idle")}t.editingShapeId!==n.editingShapeId&&(!t.editingShapeId&&n.editingShapeId?e.isIn("select.editing_shape")||e.setCurrentTool("select.editing_shape"):t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle"))}))]}(o)),a_(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:i},{toasts:a,msg:l},r),c.push(null==s?void 0:s(o)),()=>{c.forEach((e=>null==e?void 0:e()))}}));C.useLayoutEffect((()=>{if(o)return null==c?void 0:c(o)}),[o,c]);const{Canvas:d}=ev(),{ContextMenu:h}=ZU();return h?k.jsx(h,{}):d?k.jsx(d,{}):null}C.memo((function(e){const[t,n]=C.useState(null),[i,s]=C.useState(null),r=qw(e.shapeUtils??[]),o=C.useMemo((()=>[...wj,...r]),[r]),a=qw(e.bindingUtils??[]),l=C.useMemo((()=>[...xC,...a]),[a]),c=tk({snapshot:e.snapshot,shapeUtils:o}),d=qA(),{done:h,error:u}=rK(d),{pageId:p,bounds:g,scale:f,background:m,padding:y,darkMode:x,preserveAspectRatio:w,format:v="svg"}=e;return C.useLayoutEffect((()=>{if(!i)return;if(!c)return;if(!h)return;let e=!1;const t=document.createElement("div");i.appendChild(t),i.classList.add("tl-container","tl-theme__light");const s=new dS({store:c,shapeUtils:o,bindingUtils:l,tools:[],getContainer:()=>t});p&&s.setCurrentPage(p);const r=s.getCurrentPageShapeIds();return async function(){const t=await s.getSvgString([...r],{bounds:g,scale:f,background:m,padding:y,darkMode:x,preserveAspectRatio:w});if(t&&!e)if("svg"===v){if(!e){const e=new Blob([t.svg],{type:"image/svg+xml"}),i=URL.createObjectURL(e);n(i)}}else if("png"===v){const i=await ZO(s,t.svg,{type:v,quality:1,scale:2,width:t.width,height:t.height});if(i&&!e){const e=URL.createObjectURL(i);n(e)}}s.dispose()}(),()=>{e=!0}}),[v,i,c,o,l,p,g,f,m,y,x,w,h,u]),u?k.jsx(uk,{children:"Could not load assets."}):h?k.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&k.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):k.jsx(hk,{children:k.jsx(Yw,{})})}));const lK=bp({schemaVersion:xp(1),storeVersion:fp,recordVersions:_p(dp,bp({version:fp,subTypeVersions:_p(dp,fp).optional(),subTypeKey:dp.optional()}))}),cK=bp({schemaVersion:xp(2),sequences:_p(dp,fp)});var dK,hK;bp({tldrawFileFormatVersion:mp,schema:(dK="schemaVersion",hK={1:lK,2:cK},new op(dK,hK,((e,t)=>{throw new ep(`Expected one of ${Object.keys(hK).map((e=>JSON.stringify(e))).join(" or ")}, got ${JSON.stringify(t)}`,[dK])}),!0)),records:vp(bp({id:dp,typeName:dp}).allowUnknownProperties())});var uK={exports:{}};function pK(){}function gK(){}gK.resetWarningCache=pK;uK.exports=function(){function e(e,t,n,i,s,r){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==r){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:gK,resetWarningCache:pK};return n.PropTypes=n,n}();const fK=S(uK.exports);var mK,yK=C,xK=(mK=yK)&&"object"==typeof mK&&"default"in mK?mK.default:mK;function wK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vK=!("undefined"==typeof window||!window.document||!window.document.createElement);const bK=S((function(e,t,n){if("function"!=typeof e)throw new Error("Expected reducePropsToState to be a function.");if("function"!=typeof t)throw new Error("Expected handleStateChangeOnClient to be a function.");if(void 0!==n&&"function"!=typeof n)throw new Error("Expected mapStateOnServer to either be undefined or a function.");return function(i){if("function"!=typeof i)throw new Error("Expected WrappedComponent to be a React component.");var s,r=[];function o(){s=e(r.map((function(e){return e.props}))),a.canUseDOM?t(s):n&&(s=n(s))}var a=function(e){var t,n;function a(){return e.apply(this,arguments)||this}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,a.peek=function(){return s},a.rewind=function(){if(a.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var e=s;return s=void 0,r=[],e};var l=a.prototype;return l.UNSAFE_componentWillMount=function(){r.push(this),o()},l.componentDidUpdate=function(){o()},l.componentWillUnmount=function(){var e=r.indexOf(this);r.splice(e,1),o()},l.render=function(){return xK.createElement(i,this.props)},a}(yK.PureComponent);return wK(a,"displayName","SideEffect("+function(e){return e.displayName||e.name||"Component"}(i)+")"),wK(a,"canUseDOM",vK),a}}));
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var SK=Object.getOwnPropertySymbols,kK=Object.prototype.hasOwnProperty,CK=Object.prototype.propertyIsEnumerable;var _K=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(BX){return!1}}()?Object.assign:function(e,t){for(var n,i,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),r=1;r<arguments.length;r++){for(var o in n=Object(arguments[r]))kK.call(n,o)&&(s[o]=n[o]);if(SK){i=SK(n);for(var a=0;a<i.length;a++)CK.call(n,i[a])&&(s[i[a]]=n[i[a]])}}return s};const PK=S(_K);var IK="bodyAttributes",jK="htmlAttributes",EK="titleAttributes",TK={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(TK).map((function(e){return TK[e]}));var MK,AK,OK,DK,RK="charset",LK="cssText",zK="href",FK="http-equiv",NK="innerHTML",$K="itemprop",BK="name",UK="property",KK="rel",HK="src",VK="target",WK={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},YK="defaultTitle",GK="defer",XK="encodeSpecialCharacters",qK="onChangeClientState",ZK="titleTemplate",JK=Object.keys(WK).reduce((function(e,t){return e[WK[t]]=t,e}),{}),QK=[TK.NOSCRIPT,TK.SCRIPT,TK.STYLE],eH="data-react-helmet",tH="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nH=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),iH=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},sH=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},rH=function(e){return!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},oH=function(e){var t=hH(e,TK.TITLE),n=hH(e,ZK);if(n&&t)return n.replace(/%s/g,(function(){return Array.isArray(t)?t.join(""):t}));var i=hH(e,YK);return t||i||void 0},aH=function(e){return hH(e,qK)||function(){}},lH=function(e,t){return t.filter((function(t){return void 0!==t[e]})).map((function(t){return t[e]})).reduce((function(e,t){return iH({},e,t)}),{})},cH=function(e,t){return t.filter((function(e){return void 0!==e[TK.BASE]})).map((function(e){return e[TK.BASE]})).reverse().reduce((function(t,n){if(!t.length)for(var i=Object.keys(n),s=0;s<i.length;s++){var r=i[s].toLowerCase();if(-1!==e.indexOf(r)&&n[r])return t.concat(n)}return t}),[])},dH=function(e,t,n){var i={};return n.filter((function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&mH("Helmet: "+e+' should be of type "Array". Instead found type "'+tH(t[e])+'"'),!1)})).map((function(t){return t[e]})).reverse().reduce((function(e,n){var s={};n.filter((function(e){for(var n=void 0,r=Object.keys(e),o=0;o<r.length;o++){var a=r[o],l=a.toLowerCase();-1===t.indexOf(l)||n===KK&&"canonical"===e[n].toLowerCase()||l===KK&&"stylesheet"===e[l].toLowerCase()||(n=l),-1===t.indexOf(a)||a!==NK&&a!==LK&&a!==$K||(n=a)}if(!n||!e[n])return!1;var c=e[n].toLowerCase();return i[n]||(i[n]={}),s[n]||(s[n]={}),!i[n][c]&&(s[n][c]=!0,!0)})).reverse().forEach((function(t){return e.push(t)}));for(var r=Object.keys(s),o=0;o<r.length;o++){var a=r[o],l=PK({},i[a],s[a]);i[a]=l}return e}),[]).reverse()},hH=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e[n];if(i.hasOwnProperty(t))return i[t]}return null},uH=(MK=Date.now(),function(e){var t=Date.now();t-MK>16?(MK=t,e(t)):setTimeout((function(){uH(e)}),0)}),pH=function(e){return clearTimeout(e)},gH="undefined"!=typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||uH:global.requestAnimationFrame||uH,fH="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||pH:global.cancelAnimationFrame||pH,mH=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},yH=null,xH=function(e,t){var n=e.baseTag,i=e.bodyAttributes,s=e.htmlAttributes,r=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.onChangeClientState,c=e.scriptTags,d=e.styleTags,h=e.title,u=e.titleAttributes;bH(TK.BODY,i),bH(TK.HTML,s),vH(h,u);var p={baseTag:SH(TK.BASE,n),linkTags:SH(TK.LINK,r),metaTags:SH(TK.META,o),noscriptTags:SH(TK.NOSCRIPT,a),scriptTags:SH(TK.SCRIPT,c),styleTags:SH(TK.STYLE,d)},g={},f={};Object.keys(p).forEach((function(e){var t=p[e],n=t.newTags,i=t.oldTags;n.length&&(g[e]=n),i.length&&(f[e]=p[e].oldTags)})),t&&t(),l(e,g,f)},wH=function(e){return Array.isArray(e)?e.join(""):e},vH=function(e,t){void 0!==e&&document.title!==e&&(document.title=wH(e)),bH(TK.TITLE,t)},bH=function(e,t){var n=document.getElementsByTagName(e)[0];if(n){for(var i=n.getAttribute(eH),s=i?i.split(","):[],r=[].concat(s),o=Object.keys(t),a=0;a<o.length;a++){var l=o[a],c=t[l]||"";n.getAttribute(l)!==c&&n.setAttribute(l,c),-1===s.indexOf(l)&&s.push(l);var d=r.indexOf(l);-1!==d&&r.splice(d,1)}for(var h=r.length-1;h>=0;h--)n.removeAttribute(r[h]);s.length===r.length?n.removeAttribute(eH):n.getAttribute(eH)!==o.join(",")&&n.setAttribute(eH,o.join(","))}},SH=function(e,t){var n=document.head||document.querySelector(TK.HEAD),i=n.querySelectorAll(e+"["+eH+"]"),s=Array.prototype.slice.call(i),r=[],o=void 0;return t&&t.length&&t.forEach((function(t){var n=document.createElement(e);for(var i in t)if(t.hasOwnProperty(i))if(i===NK)n.innerHTML=t.innerHTML;else if(i===LK)n.styleSheet?n.styleSheet.cssText=t.cssText:n.appendChild(document.createTextNode(t.cssText));else{var a=void 0===t[i]?"":t[i];n.setAttribute(i,a)}n.setAttribute(eH,"true"),s.some((function(e,t){return o=t,n.isEqualNode(e)}))?s.splice(o,1):r.push(n)})),s.forEach((function(e){return e.parentNode.removeChild(e)})),r.forEach((function(e){return n.appendChild(e)})),{oldTags:s,newTags:r}},kH=function(e){return Object.keys(e).reduce((function(t,n){var i=void 0!==e[n]?n+'="'+e[n]+'"':""+n;return t?t+" "+i:i}),"")},CH=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce((function(t,n){return t[WK[n]||n]=e[n],t}),t)},_H=function(e,t,n){switch(e){case TK.TITLE:return{toComponent:function(){return e=t.title,n=t.titleAttributes,(i={key:e})[eH]=!0,s=CH(n,i),[P.createElement(TK.TITLE,s,e)];var e,n,i,s},toString:function(){return function(e,t,n,i){var s=kH(n),r=wH(t);return s?"<"+e+" "+eH+'="true" '+s+">"+rH(r,i)+"</"+e+">":"<"+e+" "+eH+'="true">'+rH(r,i)+"</"+e+">"}(e,t.title,t.titleAttributes,n)}};case IK:case jK:return{toComponent:function(){return CH(t)},toString:function(){return kH(t)}};default:return{toComponent:function(){return function(e,t){return t.map((function(t,n){var i,s=((i={key:n})[eH]=!0,i);return Object.keys(t).forEach((function(e){var n=WK[e]||e;if(n===NK||n===LK){var i=t.innerHTML||t.cssText;s.dangerouslySetInnerHTML={__html:i}}else s[n]=t[e]})),P.createElement(e,s)}))}(e,t)},toString:function(){return function(e,t,n){return t.reduce((function(t,i){var s=Object.keys(i).filter((function(e){return!(e===NK||e===LK)})).reduce((function(e,t){var s=void 0===i[t]?t:t+'="'+rH(i[t],n)+'"';return e?e+" "+s:s}),""),r=i.innerHTML||i.cssText||"",o=-1===QK.indexOf(e);return t+"<"+e+" "+eH+'="true" '+s+(o?"/>":">"+r+"</"+e+">")}),"")}(e,t,n)}}}},PH=function(e){var t=e.baseTag,n=e.bodyAttributes,i=e.encode,s=e.htmlAttributes,r=e.linkTags,o=e.metaTags,a=e.noscriptTags,l=e.scriptTags,c=e.styleTags,d=e.title,h=void 0===d?"":d,u=e.titleAttributes;return{base:_H(TK.BASE,t,i),bodyAttributes:_H(IK,n,i),htmlAttributes:_H(jK,s,i),link:_H(TK.LINK,r,i),meta:_H(TK.META,o,i),noscript:_H(TK.NOSCRIPT,a,i),script:_H(TK.SCRIPT,l,i),style:_H(TK.STYLE,c,i),title:_H(TK.TITLE,{title:h,titleAttributes:u},i)}},IH=bK((function(e){return{baseTag:cH([zK,VK],e),bodyAttributes:lH(IK,e),defer:hH(e,GK),encode:hH(e,XK),htmlAttributes:lH(jK,e),linkTags:dH(TK.LINK,[KK,zK],e),metaTags:dH(TK.META,[BK,RK,FK,UK,$K],e),noscriptTags:dH(TK.NOSCRIPT,[NK],e),onChangeClientState:aH(e),scriptTags:dH(TK.SCRIPT,[HK,NK],e),styleTags:dH(TK.STYLE,[LK],e),title:oH(e),titleAttributes:lH(EK,e)}}),(function(e){yH&&fH(yH),e.defer?yH=gH((function(){xH(e,(function(){yH=null}))})):(xH(e),yH=null)}),PH)((function(){return null})),jH=(AK=IH,DK=OK=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.shouldComponentUpdate=function(e){return!te(this.props,e)},t.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case TK.SCRIPT:case TK.NOSCRIPT:return{innerHTML:t};case TK.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},t.prototype.flattenArrayTypeChildren=function(e){var t,n=e.child,i=e.arrayTypeChildren,s=e.newChildProps,r=e.nestedChildren;return iH({},i,((t={})[n.type]=[].concat(i[n.type]||[],[iH({},s,this.mapNestedChildrenToProps(n,r))]),t))},t.prototype.mapObjectTypeChildren=function(e){var t,n,i=e.child,s=e.newProps,r=e.newChildProps,o=e.nestedChildren;switch(i.type){case TK.TITLE:return iH({},s,((t={})[i.type]=o,t.titleAttributes=iH({},r),t));case TK.BODY:return iH({},s,{bodyAttributes:iH({},r)});case TK.HTML:return iH({},s,{htmlAttributes:iH({},r)})}return iH({},s,((n={})[i.type]=iH({},r),n))},t.prototype.mapArrayTypeChildrenToProps=function(e,t){var n=iH({},t);return Object.keys(e).forEach((function(t){var i;n=iH({},n,((i={})[t]=e[t],i))})),n},t.prototype.warnOnInvalidChildren=function(e,t){return!0},t.prototype.mapChildrenToProps=function(e,t){var n=this,i={};return P.Children.forEach(e,(function(e){if(e&&e.props){var s=e.props,r=s.children,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce((function(t,n){return t[JK[n]||n]=e[n],t}),t)}(sH(s,["children"]));switch(n.warnOnInvalidChildren(e,r),e.type){case TK.LINK:case TK.META:case TK.NOSCRIPT:case TK.SCRIPT:case TK.STYLE:i=n.flattenArrayTypeChildren({child:e,arrayTypeChildren:i,newChildProps:o,nestedChildren:r});break;default:t=n.mapObjectTypeChildren({child:e,newProps:t,newChildProps:o,nestedChildren:r})}}})),t=this.mapArrayTypeChildrenToProps(i,t)},t.prototype.render=function(){var e=this.props,t=e.children,n=sH(e,["children"]),i=iH({},n);return t&&(i=this.mapChildrenToProps(t,i)),P.createElement(AK,i)},nH(t,null,[{key:"canUseDOM",set:function(e){AK.canUseDOM=e}}]),t}(P.Component),OK.propTypes={base:fK.object,bodyAttributes:fK.object,children:fK.oneOfType([fK.arrayOf(fK.node),fK.node]),defaultTitle:fK.string,defer:fK.bool,encodeSpecialCharacters:fK.bool,htmlAttributes:fK.object,link:fK.arrayOf(fK.object),meta:fK.arrayOf(fK.object),noscript:fK.arrayOf(fK.object),onChangeClientState:fK.func,script:fK.arrayOf(fK.object),style:fK.arrayOf(fK.object),title:fK.string,titleAttributes:fK.object,titleTemplate:fK.string},OK.defaultProps={defer:!0,encodeSpecialCharacters:!0},OK.peek=AK.peek,OK.rewind=function(){var e=AK.rewind();return e||(e=PH({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),e},DK);jH.renderStatic=jH.rewind;const EH=()=>k.jsxs(jH,{children:[k.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap",rel:"stylesheet"}),k.jsx("style",{children:"\n              html,\n              body {\n                height: 100% !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                font-family: Inter, sans-serif !important;\n                font-size: 16px !important;\n                overscroll-behavior: none !important;\n                touch-action: none !important;\n                min-height: 100vh !important;\n                min-height: -webkit-fill-available !important; /* mobile viewport bug fix */\n              }\n\n              .tldraw__editor {\n                position: fixed;\n                inset: 0;\n                overflow: hidden;\n              }\n "})]}),TH=()=>new Map,MH=e=>{const t=TH();return e.forEach(((e,n)=>{t.set(n,e)})),t},AH=(e,t,n)=>{let i=e.get(t);return void 0===i&&e.set(t,i=n()),i},OH=()=>new Set,DH=e=>e[e.length-1],RH=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},LH=Array.from,zH=Array.isArray;class FH{constructor(){this._observers=TH()}on(e,t){return AH(this._observers,e,OH).add(t),t}once(e,t){const n=(...i)=>{this.off(e,n),t(...i)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return LH((this._observers.get(e)||TH()).values()).forEach((e=>e(...t)))}destroy(){this._observers=TH()}}class NH{constructor(){this._observers=TH()}on(e,t){AH(this._observers,e,OH).add(t)}once(e,t){const n=(...i)=>{this.off(e,n),t(...i)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return LH((this._observers.get(e)||TH()).values()).forEach((e=>e(...t)))}destroy(){this._observers=TH()}}const $H=Math.floor,BH=Math.abs,UH=(e,t)=>e<t?e:t,KH=(e,t)=>e>t?e:t,HH=Math.pow,VH=e=>0!==e?e<0:1/e<0,WH=64,YH=128,GH=127,XH=Number.MAX_SAFE_INTEGER,qH=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&$H(e)===e),ZH=String.fromCharCode,JH=/^\s*/g,QH=/([A-Z])/g,eV=(e,t)=>(e=>e.replace(JH,""))(e.replace(QH,(e=>`${t}${(e=>e.toLowerCase())(e)}`))),tV="undefined"!=typeof TextEncoder?new TextEncoder:null,nV=tV?e=>tV.encode(e):e=>{const t=unescape(encodeURIComponent(e)),n=t.length,i=new Uint8Array(n);for(let s=0;s<n;s++)i[s]=t.codePointAt(s);return i};let iV="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});iV&&1===iV.decode(new Uint8Array).length&&(iV=null);class sV{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rV=()=>new sV,oV=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},aV=e=>{const t=new Uint8Array(oV(e));let n=0;for(let i=0;i<e.bufs.length;i++){const s=e.bufs[i];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},lV=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},cV=lV,dV=(e,t)=>{for(;t>GH;)lV(e,YH|GH&t),t=$H(t/128);lV(e,GH&t)},hV=(e,t)=>{const n=VH(t);for(n&&(t=-t),lV(e,(t>63?YH:0)|(n?WH:0)|63&t),t=$H(t/64);t>0;)lV(e,(t>GH?YH:0)|GH&t),t=$H(t/128)},uV=new Uint8Array(3e4),pV=uV.length/3,gV=tV&&tV.encodeInto?(e,t)=>{if(t.length<pV){const n=tV.encodeInto(t,uV).written||0;dV(e,n);for(let t=0;t<n;t++)lV(e,uV[t])}else mV(e,nV(t))}:(e,t)=>{const n=unescape(encodeURIComponent(t)),i=n.length;dV(e,i);for(let s=0;s<i;s++)lV(e,n.codePointAt(s))},fV=(e,t)=>{const n=e.cbuf.length,i=e.cpos,s=UH(n-i,t.length),r=t.length-s;e.cbuf.set(t.subarray(0,s),i),e.cpos+=s,r>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(KH(2*n,r)),e.cbuf.set(t.subarray(s)),e.cpos=r)},mV=(e,t)=>{dV(e,t.byteLength),fV(e,t)},yV=(e,t)=>{((e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*KH(n,t)),e.cpos=0)})(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},xV=new DataView(new ArrayBuffer(4)),wV=(e,t)=>{switch(typeof t){case"string":lV(e,119),gV(e,t);break;case"number":qH(t)&&BH(t)<=2147483647?(lV(e,125),hV(e,t)):(n=t,xV.setFloat32(0,n),xV.getFloat32(0)===n?(lV(e,124),((e,t)=>{yV(e,4).setFloat32(0,t,!1)})(e,t)):(lV(e,123),((e,t)=>{yV(e,8).setFloat64(0,t,!1)})(e,t)));break;case"bigint":lV(e,122),((e,t)=>{yV(e,8).setBigInt64(0,t,!1)})(e,t);break;case"object":if(null===t)lV(e,126);else if(zH(t)){lV(e,117),dV(e,t.length);for(let n=0;n<t.length;n++)wV(e,t[n])}else if(t instanceof Uint8Array)lV(e,116),mV(e,t);else{lV(e,118);const n=Object.keys(t);dV(e,n.length);for(let i=0;i<n.length;i++){const s=n[i];gV(e,s),wV(e,t[s])}}break;case"boolean":lV(e,t?120:121);break;default:lV(e,127)}var n};class vV extends sV{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&dV(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const bV=e=>{e.count>0&&(hV(e.encoder,1===e.count?e.s:-e.s),e.count>1&&dV(e.encoder,e.count-2))};class SV{constructor(){this.encoder=new sV,this.s=0,this.count=0}write(e){this.s===e?this.count++:(bV(this),this.count=1,this.s=e)}toUint8Array(){return bV(this),aV(this.encoder)}}const kV=e=>{if(e.count>0){const t=2*e.diff+(1===e.count?0:1);hV(e.encoder,t),e.count>1&&dV(e.encoder,e.count-2)}};class CV{constructor(){this.encoder=new sV,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(kV(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return kV(this),aV(this.encoder)}}class _V{constructor(){this.sarr=[],this.s="",this.lensE=new SV}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new sV;return this.sarr.push(this.s),this.s="",gV(e,this.sarr.join("")),fV(e,this.lensE.toUint8Array()),aV(e)}}const PV=e=>new Error(e),IV=()=>{throw PV("Method unimplemented")},jV=()=>{throw PV("Unexpected case")},EV=PV("Unexpected end of array"),TV=PV("Integer out of Range");class MV{constructor(e){this.arr=e,this.pos=0}}const AV=e=>new MV(e),OV=e=>((e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,RV(e)),DV=e=>e.arr[e.pos++],RV=e=>{let t=0,n=1;const i=e.arr.length;for(;e.pos<i;){const i=e.arr[e.pos++];if(t+=(i&GH)*n,n*=128,i<YH)return t;if(t>XH)throw TV}throw EV},LV=e=>{let t=e.arr[e.pos++],n=63&t,i=64;const s=(t&WH)>0?-1:1;if(!(t&YH))return s*n;const r=e.arr.length;for(;e.pos<r;){if(t=e.arr[e.pos++],n+=(t&GH)*i,i*=128,t<YH)return s*n;if(n>XH)throw TV}throw EV},zV=iV?e=>iV.decode(OV(e)):e=>{let t=RV(e);if(0===t)return"";{let n=String.fromCodePoint(DV(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(DV(e));else for(;t>0;){const i=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+i);e.pos+=i,n+=String.fromCodePoint.apply(null,s),t-=i}return decodeURIComponent(escape(n))}},FV=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},NV=[e=>{},e=>null,LV,e=>FV(e,4).getFloat32(0,!1),e=>FV(e,8).getFloat64(0,!1),e=>FV(e,8).getBigInt64(0,!1),e=>!1,e=>!0,zV,e=>{const t=RV(e),n={};for(let i=0;i<t;i++){n[zV(e)]=$V(e)}return n},e=>{const t=RV(e),n=[];for(let i=0;i<t;i++)n.push($V(e));return n},OV],$V=e=>NV[127-DV(e)](e);class BV extends MV{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){var e;return 0===this.count&&(this.s=this.reader(this),(e=this).pos!==e.arr.length?this.count=RV(this)+1:this.count=-1),this.count--,this.s}}class UV extends MV{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=LV(this);const e=VH(this.s);this.count=1,e&&(this.s=-this.s,this.count=RV(this)+2)}return this.count--,this.s}}class KV extends MV{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const e=LV(this),t=1&e;this.diff=$H(e/2),this.count=1,t&&(this.count=RV(this)+2)}return this.s+=this.diff,this.count--,this.s}}class HV{constructor(e){this.decoder=new UV(e),this.str=zV(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const VV=crypto.getRandomValues.bind(crypto),WV=()=>VV(new Uint32Array(1))[0],YV="10000000-1000-4000-8000-100000000000",GV=()=>YV.replace(/[018]/g,(e=>(e^WV()&15>>e/4).toString(16))),XV=Date.now,qV=e=>new Promise(e);Promise.all.bind(Promise);const ZV=e=>void 0===e?null:e;let JV=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},QV=!0;try{"undefined"!=typeof localStorage&&localStorage&&(JV=localStorage,QV=!1)}catch(UX){}const eW=JV,tW=Object.assign,nW=Object.keys,iW=e=>nW(e).length,sW=e=>nW(e).length,rW=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),oW=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&oW(e,t,n+1)}},aW=e=>e,lW=(e,t)=>{if(null==e||null==t)return((e,t)=>e===t)(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!lW(e.get(n),t.get(n)))return!1;break;case Object:if(iW(e)!==iW(t))return!1;for(const n in e)if(!rW(e,n)||!lW(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!lW(e[n],t[n]))return!1;break;default:return!1}return!0};var cW={};const dW="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),hW="undefined"!=typeof window&&"undefined"!=typeof document&&!dW;let uW;const pW=e=>(()=>{if(void 0===uW)if(dW){uW=TH();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const i=e[n];"-"===i[0]?(null!==t&&uW.set(t,""),t=i):null!==t&&(uW.set(t,i),t=null)}null!==t&&uW.set(t,"")}else"object"==typeof location?(uW=TH(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,n]=e.split("=");uW.set(`--${eV(t,"-")}`,n),uW.set(`-${eV(t,"-")}`,n)}}))):uW=TH();return uW})().has(e),gW=e=>ZV(dW?cW[e.toUpperCase().replaceAll("-","_")]:eW.getItem(e));var fW;pW("--"+(fW="production"))||gW(fW);const mW=dW&&((e,t)=>t.includes(e))(cW.FORCE_COLOR,["true","1","2"]),yW=!pW("--no-colors")&&(!dW||process.stdout.isTTY||mW)&&(!dW||pW("--color")||mW||null!==gW("COLORTERM")||(gW("TERM")||"").includes("color")),xW=e=>new Uint8Array(e),wW=hW?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=ZH(e[n]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),vW=hW?e=>{const t=atob(e),n=xW(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}:e=>{const t=Buffer.from(e,"base64");return n=t.buffer,i=t.byteOffset,s=t.byteLength,new Uint8Array(n,i,s);var n,i,s};class bW{constructor(e,t){this.left=e,this.right=t}}const SW=(e,t)=>new bW(e,t);"undefined"!=typeof DOMParser&&new DOMParser;const kW=Symbol,CW=kW(),_W=kW(),PW=kW(),IW=kW(),jW=kW(),EW=kW(),TW=kW(),MW=kW(),AW=kW(),OW={[CW]:SW("font-weight","bold"),[_W]:SW("font-weight","normal"),[PW]:SW("color","blue"),[jW]:SW("color","green"),[IW]:SW("color","grey"),[EW]:SW("color","red"),[TW]:SW("color","purple"),[MW]:SW("color","orange"),[AW]:SW("color","black")},DW=yW?e=>{var t;1===e.length&&(null==(t=e[0])?void 0:t.constructor)===Function&&(e=e[0]());const n=[],i=[],s=TH();let r=[],o=0;for(;o<e.length;o++){const t=e[o],r=OW[t];if(void 0!==r)s.set(r.left,r.right);else{if(void 0===t)break;if(t.constructor!==String&&t.constructor!==Number)break;{const e=((e,t)=>{const n=[];for(const[i,s]of e)n.push(t(s,i));return n})(s,((e,t)=>`${t}:${e};`)).join("");o>0||e.length>0?(n.push("%c"+t),i.push(e)):n.push(t)}}}for(o>0&&(r=i,r.unshift(n.join("")));o<e.length;o++){const t=e[o];t instanceof Symbol||r.push(t)}return r}:e=>{var t;1===e.length&&(null==(t=e[0])?void 0:t.constructor)===Function&&(e=e[0]());const n=[];let i=0;for(;i<e.length;i++){const t=e[i];void 0===t||t.constructor===String||t.constructor===Number||t.constructor===Object&&n.push(JSON.stringify(t))}return n},RW=OH(),LW=e=>({[Symbol.iterator](){return this},next:e}),zW=(e,t)=>LW((()=>{const{done:n,value:i}=e.next();return{done:n,value:n?void 0:t(i)}}));class FW{constructor(e,t){this.clock=e,this.len=t}}class NW{constructor(){this.clients=new Map}}const $W=(e,t,n)=>t.clients.forEach(((t,i)=>{const s=e.doc.store.clients.get(i);for(let r=0;r<t.length;r++){const i=t[r];TY(e,s,i.clock,i.len,n)}})),BW=(e,t)=>{const n=e.clients.get(t.client);return void 0!==n&&null!==((e,t)=>{let n=0,i=e.length-1;for(;n<=i;){const s=$H((n+i)/2),r=e[s],o=r.clock;if(o<=t){if(t<o+r.len)return s;n=s+1}else i=s-1}return null})(n,t.clock)},UW=e=>{e.clients.forEach((e=>{let t,n;for(e.sort(((e,t)=>e.clock-t.clock)),t=1,n=1;t<e.length;t++){const i=e[n-1],s=e[t];i.clock+i.len>=s.clock?i.len=KH(i.len,s.clock+s.len-i.clock):(n<t&&(e[n]=s),n++)}e.length=n}))},KW=(e,t,n,i)=>{AH(e.clients,t,(()=>[])).push(new FW(n,i))},HW=e=>{const t=new NW;return e.clients.forEach(((e,n)=>{const i=[];for(let t=0;t<e.length;t++){const n=e[t];if(n.deleted){const s=n.id.clock;let r=n.length;if(t+1<e.length)for(let n=e[t+1];t+1<e.length&&n.deleted;n=e[1+ ++t])r+=n.length;i.push(new FW(s,r))}}i.length>0&&t.clients.set(n,i)})),t},VW=(e,t)=>{dV(e.restEncoder,t.clients.size),LH(t.clients.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{e.resetDsCurVal(),dV(e.restEncoder,t);const i=n.length;dV(e.restEncoder,i);for(let s=0;s<i;s++){const t=n[s];e.writeDsClock(t.clock),e.writeDsLen(t.len)}}))},WW=e=>{const t=new NW,n=RV(e.restDecoder);for(let i=0;i<n;i++){e.resetDsCurVal();const n=RV(e.restDecoder),i=RV(e.restDecoder);if(i>0){const s=AH(t.clients,n,(()=>[]));for(let t=0;t<i;t++)s.push(new FW(e.readDsClock(),e.readDsLen()))}}return t},YW=(e,t,n)=>{const i=new NW,s=RV(e.restDecoder);for(let r=0;r<s;r++){e.resetDsCurVal();const s=RV(e.restDecoder),r=RV(e.restDecoder),o=n.clients.get(s)||[],a=kY(n,s);for(let n=0;n<r;n++){const n=e.readDsClock(),r=n+e.readDsLen();if(n<a){a<r&&KW(i,s,a,r-a);let e=_Y(o,n),l=o[e];for(!l.deleted&&l.id.clock<n&&(o.splice(e+1,0,hX(t,l,n-l.id.clock)),e++);e<o.length&&(l=o[e++],l.id.clock<r);)l.deleted||(r<l.id.clock+l.length&&o.splice(e,0,hX(t,l,r-l.id.clock)),l.delete(t))}else KW(i,s,n,r-n)}}if(i.clients.size>0){const e=new iY;return dV(e.restEncoder,0),VW(e,i),e.toUint8Array()}return null},GW=WV;class XW extends FH{constructor({guid:e=GV(),collectionid:t=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:r=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=GW(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new bY,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=r,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=qV((e=>{this.on("load",(()=>{this.isLoaded=!0,e(this)}))}));const a=()=>qV((e=>{const t=n=>{void 0!==n&&!0!==n||(this.off("sync",t),e())};this.on("sync",t)}));this.on("sync",(e=>{!1===e&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===e||!0===e,this.isSynced&&!this.isLoaded&&this.emit("load",[this])})),this.whenSynced=a()}load(){const e=this._item;null===e||this.shouldLoad||LY(e.parent.doc,(e=>{e.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(LH(this.subdocs).map((e=>e.guid)))}transact(e,t=null){return LY(this,e,t)}get(e,t=nG){const n=AH(this.share,e,(()=>{const e=new t;return e._integrate(this,null),e})),i=n.constructor;if(t!==nG&&i!==t){if(i===nG){const i=new t;i._map=n._map,n._map.forEach((e=>{for(;null!==e;e=e.left)e.parent=i})),i._start=n._start;for(let e=i._start;null!==e;e=e.right)e.parent=i;return i._length=n._length,this.share.set(e,i),i._integrate(this,null),i}throw new Error(`Type with the name ${e} has already been defined with a different constructor`)}return n}getArray(e=""){return this.get(e,vG)}getText(e=""){return this.get(e,FG)}getMap(e=""){return this.get(e,SG)}getXmlElement(e=""){return this.get(e,BG)}getXmlFragment(e=""){return this.get(e,$G)}toJSON(){const e={};return this.share.forEach(((t,n)=>{e[n]=t.toJSON()})),e}destroy(){LH(this.subdocs).forEach((e=>e.destroy()));const e=this._item;if(null!==e){this._item=null;const t=e.content;t.doc=new XW({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,LY(e.parent.doc,(n=>{const i=t.doc;e.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class qW{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return RV(this.restDecoder)}readDsLen(){return RV(this.restDecoder)}}class ZW extends qW{readLeftID(){return xY(RV(this.restDecoder),RV(this.restDecoder))}readRightID(){return xY(RV(this.restDecoder),RV(this.restDecoder))}readClient(){return RV(this.restDecoder)}readInfo(){return DV(this.restDecoder)}readString(){return zV(this.restDecoder)}readParentInfo(){return 1===RV(this.restDecoder)}readTypeRef(){return RV(this.restDecoder)}readLen(){return RV(this.restDecoder)}readAny(){return $V(this.restDecoder)}readBuf(){return(e=>{const t=xW(e.byteLength);return t.set(e),t})(OV(this.restDecoder))}readJSON(){return JSON.parse(zV(this.restDecoder))}readKey(){return zV(this.restDecoder)}}class JW{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=RV(this.restDecoder),this.dsCurrVal}readDsLen(){const e=RV(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class QW extends JW{constructor(e){super(e),this.keys=[],RV(e),this.keyClockDecoder=new KV(OV(e)),this.clientDecoder=new UV(OV(e)),this.leftClockDecoder=new KV(OV(e)),this.rightClockDecoder=new KV(OV(e)),this.infoDecoder=new BV(OV(e),DV),this.stringDecoder=new HV(OV(e)),this.parentInfoDecoder=new BV(OV(e),DV),this.typeRefDecoder=new UV(OV(e)),this.lenDecoder=new UV(OV(e))}readLeftID(){return new mY(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new mY(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $V(this.restDecoder)}readBuf(){return OV(this.restDecoder)}readJSON(){return $V(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class eY{constructor(){this.restEncoder=rV()}toUint8Array(){return aV(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){dV(this.restEncoder,e)}writeDsLen(e){dV(this.restEncoder,e)}}class tY extends eY{writeLeftID(e){dV(this.restEncoder,e.client),dV(this.restEncoder,e.clock)}writeRightID(e){dV(this.restEncoder,e.client),dV(this.restEncoder,e.clock)}writeClient(e){dV(this.restEncoder,e)}writeInfo(e){cV(this.restEncoder,e)}writeString(e){gV(this.restEncoder,e)}writeParentInfo(e){dV(this.restEncoder,e?1:0)}writeTypeRef(e){dV(this.restEncoder,e)}writeLen(e){dV(this.restEncoder,e)}writeAny(e){wV(this.restEncoder,e)}writeBuf(e){mV(this.restEncoder,e)}writeJSON(e){gV(this.restEncoder,JSON.stringify(e))}writeKey(e){gV(this.restEncoder,e)}}class nY{constructor(){this.restEncoder=rV(),this.dsCurrVal=0}toUint8Array(){return aV(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,dV(this.restEncoder,t)}writeDsLen(e){0===e&&jV(),dV(this.restEncoder,e-1),this.dsCurrVal+=e}}class iY extends nY{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new CV,this.clientEncoder=new SV,this.leftClockEncoder=new CV,this.rightClockEncoder=new CV,this.infoEncoder=new vV(cV),this.stringEncoder=new _V,this.parentInfoEncoder=new vV(cV),this.typeRefEncoder=new SV,this.lenEncoder=new SV}toUint8Array(){const e=rV();return dV(e,0),mV(e,this.keyClockEncoder.toUint8Array()),mV(e,this.clientEncoder.toUint8Array()),mV(e,this.leftClockEncoder.toUint8Array()),mV(e,this.rightClockEncoder.toUint8Array()),mV(e,aV(this.infoEncoder)),mV(e,this.stringEncoder.toUint8Array()),mV(e,aV(this.parentInfoEncoder)),mV(e,this.typeRefEncoder.toUint8Array()),mV(e,this.lenEncoder.toUint8Array()),fV(e,aV(this.restEncoder)),aV(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){wV(this.restEncoder,e)}writeBuf(e){mV(this.restEncoder,e)}writeJSON(e){wV(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const sY=(e,t,n)=>{const i=new Map;n.forEach(((e,n)=>{kY(t,n)>e&&i.set(n,e)})),SY(t).forEach(((e,t)=>{n.has(t)||i.set(t,0)})),dV(e.restEncoder,i.size),LH(i.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([n,i])=>{((e,t,n,i)=>{i=KH(i,t[0].id.clock);const s=_Y(t,i);dV(e.restEncoder,t.length-s),e.writeClient(n),dV(e.restEncoder,i);const r=t[s];r.write(e,i-r.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)})(e,t.clients.get(n),n,i)}))},rY=(e,t,n,i=new QW(e))=>LY(t,(e=>{e.local=!1;let t=!1;const n=e.doc,s=n.store,r=((e,t)=>{const n=TH(),i=RV(e.restDecoder);for(let s=0;s<i;s++){const i=RV(e.restDecoder),s=new Array(i),r=e.readClient();let o=RV(e.restDecoder);n.set(r,{i:0,refs:s});for(let n=0;n<i;n++){const i=e.readInfo();switch(31&i){case 0:{const t=e.readLen();s[n]=new WG(xY(r,o),t),o+=t;break}case 10:{const t=RV(e.restDecoder);s[n]=new fX(xY(r,o),t),o+=t;break}default:{const a=!(192&i),l=new uX(xY(r,o),null,(i&YH)===YH?e.readLeftID():null,null,(i&WH)===WH?e.readRightID():null,a?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,!a||32&~i?null:e.readString(),pX(e,i));s[n]=l,o+=l.length}}}}return n})(i,n),o=((e,t,n)=>{const i=[];let s=LH(n.keys()).sort(((e,t)=>e-t));if(0===s.length)return null;const r=()=>{if(0===s.length)return null;let e=n.get(s[s.length-1]);for(;e.refs.length===e.i;){if(s.pop(),!(s.length>0))return null;e=n.get(s[s.length-1])}return e};let o=r();if(null===o)return null;const a=new bY,l=new Map,c=(e,t)=>{const n=l.get(e);(null==n||n>t)&&l.set(e,t)};let d=o.refs[o.i++];const h=new Map,u=()=>{for(const e of i){const t=e.id.client,i=n.get(t);i?(i.i--,a.clients.set(t,i.refs.slice(i.i)),n.delete(t),i.i=0,i.refs=[]):a.clients.set(t,[e]),s=s.filter((e=>e!==t))}i.length=0};for(;;){if(d.constructor!==fX){const s=AH(h,d.id.client,(()=>kY(t,d.id.client)))-d.id.clock;if(s<0)i.push(d),c(d.id.client,d.id.clock-1),u();else{const r=d.getMissing(e,t);if(null!==r){i.push(d);const e=n.get(r)||{refs:[],i:0};if(e.refs.length!==e.i){d=e.refs[e.i++];continue}c(r,kY(t,r)),u()}else(0===s||s<d.length)&&(d.integrate(e,s),h.set(d.id.client,d.id.clock+d.length))}}if(i.length>0)d=i.pop();else if(null!==o&&o.i<o.refs.length)d=o.refs[o.i++];else{if(o=r(),null===o)break;d=o.refs[o.i++]}}if(a.clients.size>0){const e=new iY;return sY(e,a,new Map),dV(e.restEncoder,0),{missing:l,update:e.toUint8Array()}}return null})(e,s,r),a=s.pendingStructs;if(a){for(const[e,n]of a.missing)if(n<kY(s,e)){t=!0;break}if(o){for(const[e,t]of o.missing){const n=a.missing.get(e);(null==n||n>t)&&a.missing.set(e,t)}a.update=BY([a.update,o.update])}}else s.pendingStructs=o;const l=YW(i,e,s);if(s.pendingDs){const t=new QW(AV(s.pendingDs));RV(t.restDecoder);const n=YW(t,e,s);s.pendingDs=l&&n?BY([l,n]):l||n}else s.pendingDs=l;if(t){const t=s.pendingStructs.update;s.pendingStructs=null,oY(e.doc,t)}}),n,!1),oY=(e,t,n,i=QW)=>{const s=AV(t);rY(s,e,n,new i(s))},aY=(e,t=new Uint8Array([0]),n=new iY)=>{((e,t,n=new Map)=>{sY(e,t.store,n),VW(e,HW(t.store))})(n,e,lY(t));const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(UY(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===tY)return NY(i.map(((e,t)=>0===t?e:WY(e))));if(n.constructor===iY)return BY(i)}return i[0]},lY=e=>(e=>{const t=new Map,n=RV(e.restDecoder);for(let i=0;i<n;i++){const n=RV(e.restDecoder),i=RV(e.restDecoder);t.set(n,i)}return t})(new qW(AV(e))),cY=(e,t)=>(dV(e.restEncoder,t.size),LH(t.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{dV(e.restEncoder,t),dV(e.restEncoder,n)})),e),dY=(e,t=new nY)=>(e instanceof Map?cY(t,e):((e,t)=>{cY(e,SY(t.store))})(t,e),t.toUint8Array());class hY{constructor(){this.l=[]}}const uY=()=>new hY,pY=(e,t)=>e.l.push(t),gY=(e,t)=>{const n=e.l,i=n.length;e.l=n.filter((e=>t!==e)),i===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fY=(e,t,n)=>oW(e.l,[t,n]);class mY{constructor(e,t){this.client=e,this.clock=t}}const yY=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,xY=(e,t)=>new mY(e,t),wY=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!BW(t.ds,e.id),vY=(e,t)=>{const n=AH(e.meta,vY,OH),i=e.doc.store;n.has(t)||(t.sv.forEach(((t,n)=>{t<kY(i,n)&&jY(e,xY(n,t))})),$W(e,t.ds,(e=>{})),n.add(t))};class bY{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const SY=e=>{const t=new Map;return e.clients.forEach(((e,n)=>{const i=e[e.length-1];t.set(n,i.id.clock+i.length)})),t},kY=(e,t)=>{const n=e.clients.get(t);if(void 0===n)return 0;const i=n[n.length-1];return i.id.clock+i.length},CY=(e,t)=>{let n=e.clients.get(t.id.client);if(void 0===n)n=[],e.clients.set(t.id.client,n);else{const e=n[n.length-1];if(e.id.clock+e.length!==t.id.clock)throw jV()}n.push(t)},_Y=(e,t)=>{let n=0,i=e.length-1,s=e[i],r=s.id.clock;if(r===t)return i;let o=$H(t/(r+s.length-1)*i);for(;n<=i;){if(s=e[o],r=s.id.clock,r<=t){if(t<r+s.length)return o;n=o+1}else i=o-1;o=$H((n+i)/2)}throw jV()},PY=(e,t)=>{const n=e.clients.get(t.client);return n[_Y(n,t.clock)]},IY=(e,t,n)=>{const i=_Y(t,n),s=t[i];return s.id.clock<n&&s instanceof uX?(t.splice(i+1,0,hX(e,s,n-s.id.clock)),i+1):i},jY=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[IY(e,n,t.clock)]},EY=(e,t,n)=>{const i=t.clients.get(n.client),s=_Y(i,n.clock),r=i[s];return n.clock!==r.id.clock+r.length-1&&r.constructor!==WG&&i.splice(s+1,0,hX(e,r,n.clock-r.id.clock+1)),r},TY=(e,t,n,i,s)=>{if(0===i)return;const r=n+i;let o,a=IY(e,t,n);do{o=t[a++],r<o.id.clock+o.length&&IY(e,t,r),s(o)}while(a<t.length&&t[a].id.clock<r)};class MY{constructor(e,t,n){this.doc=e,this.deleteSet=new NW,this.beforeState=SY(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const AY=(e,t)=>!(0===t.deleteSet.clients.size&&!((e,t)=>{for(const[n,i]of e)if(t(i,n))return!0;return!1})(t.afterState,((e,n)=>t.beforeState.get(n)!==e)))&&(UW(t.deleteSet),((e,t)=>{sY(e,t.doc.store,t.beforeState)})(e,t),VW(e,t.deleteSet),!0),OY=(e,t,n)=>{const i=t._item;(null===i||i.id.clock<(e.beforeState.get(i.id.client)||0)&&!i.deleted)&&AH(e.changed,t,OH).add(n)},DY=(e,t)=>{let n=e[t],i=e[t-1],s=t;for(;s>0&&(i.deleted===n.deleted&&i.constructor===n.constructor&&i.mergeWith(n));n=i,i=e[--s-1])n instanceof uX&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,i);const r=t-s;return r&&e.splice(t+1-r,r),r},RY=(e,t)=>{if(t<e.length){const n=e[t],i=n.doc,s=i.store,r=n.deleteSet,o=n._mergeStructs;try{UW(r),n.afterState=SY(n.doc.store),i.emit("beforeObserverCalls",[n,i]);const e=[];n.changed.forEach(((t,i)=>e.push((()=>{null!==i._item&&i._item.deleted||i._callObserver(n,t)})))),e.push((()=>{n.changedParentTypes.forEach(((e,t)=>{t._dEH.l.length>0&&(null===t._item||!t._item.deleted)&&((e=e.filter((e=>null===e.target._item||!e.target._item.deleted))).forEach((e=>{e.currentTarget=t,e._path=null})),e.sort(((e,t)=>e.path.length-t.path.length)),fY(t._dEH,e,n))}))})),e.push((()=>i.emit("afterTransaction",[n,i]))),oW(e,[]),n._needFormattingCleanup&&RG(n)}finally{i.gc&&((e,t,n)=>{for(const[i,s]of e.clients.entries()){const e=t.clients.get(i);for(let i=s.length-1;i>=0;i--){const r=s[i],o=r.clock+r.len;for(let i=_Y(e,r.clock),s=e[i];i<e.length&&s.id.clock<o;s=e[++i]){const s=e[i];if(r.clock+r.len<=s.id.clock)break;s instanceof uX&&s.deleted&&!s.keep&&n(s)&&s.gc(t,!1)}}}})(r,s,i.gcFilter),((e,t)=>{e.clients.forEach(((e,n)=>{const i=t.clients.get(n);for(let t=e.length-1;t>=0;t--){const n=e[t];for(let e=UH(i.length-1,1+_Y(i,n.clock+n.len-1)),t=i[e];e>0&&t.id.clock>=n.clock;t=i[e])e-=1+DY(i,e)}}))})(r,s),n.afterState.forEach(((e,t)=>{const i=n.beforeState.get(t)||0;if(i!==e){const e=s.clients.get(t),n=KH(_Y(e,i),1);for(let t=e.length-1;t>=n;)t-=1+DY(e,t)}}));for(let e=o.length-1;e>=0;e--){const{client:t,clock:n}=o[e].id,i=s.clients.get(t),r=_Y(i,n);r+1<i.length&&DY(i,r+1)>1||r>0&&DY(i,r)}if(n.local||n.afterState.get(i.clientID)===n.beforeState.get(i.clientID)||(((...e)=>{DW(e),RW.forEach((t=>t.print(e)))})(MW,CW,"[yjs] ",_W,EW,"Changed the client-id because another client seems to be using it."),i.clientID=GW()),i.emit("afterTransactionCleanup",[n,i]),i._observers.has("update")){const e=new tY;AY(e,n)&&i.emit("update",[e.toUint8Array(),n.origin,i,n])}if(i._observers.has("updateV2")){const e=new iY;AY(e,n)&&i.emit("updateV2",[e.toUint8Array(),n.origin,i,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=n;(a.size>0||c.size>0||l.size>0)&&(a.forEach((e=>{e.clientID=i.clientID,null==e.collectionid&&(e.collectionid=i.collectionid),i.subdocs.add(e)})),c.forEach((e=>i.subdocs.delete(e))),i.emit("subdocs",[{loaded:l,added:a,removed:c},i,n]),c.forEach((e=>e.destroy()))),e.length<=t+1?(i._transactionCleanups=[],i.emit("afterAllTransactions",[i,e])):RY(e,t+1)}}},LY=(e,t,n=null,i=!0)=>{const s=e._transactionCleanups;let r=!1,o=null;null===e._transaction&&(r=!0,e._transaction=new MY(e,n,i),s.push(e._transaction),1===s.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(r){const t=e._transaction===s[0];e._transaction=null,t&&RY(s,0)}}return o};class zY{constructor(e,t){this.gen=function*(e){const t=RV(e.restDecoder);for(let n=0;n<t;n++){const t=RV(e.restDecoder),n=e.readClient();let i=RV(e.restDecoder);for(let s=0;s<t;s++){const t=e.readInfo();if(10===t){const t=RV(e.restDecoder);yield new fX(xY(n,i),t),i+=t}else if(31&t){const s=!(192&t),r=new uX(xY(n,i),null,(t&YH)===YH?e.readLeftID():null,null,(t&WH)===WH?e.readRightID():null,s?e.readParentInfo()?e.readString():e.readLeftID():null,!s||32&~t?null:e.readString(),pX(e,t));yield r,i+=r.length}else{const t=e.readLen();yield new WG(xY(n,i),t),i+=t}}}}(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===fX);return this.curr}}class FY{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const NY=e=>BY(e,ZW,tY),$Y=(e,t)=>{if(e.constructor===WG){const{client:n,clock:i}=e.id;return new WG(xY(n,i+t),e.length-t)}if(e.constructor===fX){const{client:n,clock:i}=e.id;return new fX(xY(n,i+t),e.length-t)}{const n=e,{client:i,clock:s}=n.id;return new uX(xY(i,s+t),null,xY(i,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},BY=(e,t=QW,n=iY)=>{if(1===e.length)return e[0];const i=e.map((e=>new t(AV(e))));let s=i.map((e=>new zY(e,!0))),r=null;const o=new n,a=new FY(o);for(;s=s.filter((e=>null!==e.curr)),s.sort(((e,t)=>{if(e.curr.id.client===t.curr.id.client){const n=e.curr.id.clock-t.curr.id.clock;return 0===n?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===fX?1:-1:n}return t.curr.id.client-e.curr.id.client})),0!==s.length;){const e=s[0],t=e.curr.id.client;if(null!==r){let n=e.curr,i=!1;for(;null!==n&&n.id.clock+n.length<=r.struct.id.clock+r.struct.length&&n.id.client>=r.struct.id.client;)n=e.next(),i=!0;if(null===n||n.id.client!==t||i&&n.id.clock>r.struct.id.clock+r.struct.length)continue;if(t!==r.struct.id.client)HY(a,r.struct,r.offset),r={struct:n,offset:0},e.next();else if(r.struct.id.clock+r.struct.length<n.id.clock)if(r.struct.constructor===fX)r.struct.length=n.id.clock+n.length-r.struct.id.clock;else{HY(a,r.struct,r.offset);const e=n.id.clock-r.struct.id.clock-r.struct.length;r={struct:new fX(xY(t,r.struct.id.clock+r.struct.length),e),offset:0}}else{const t=r.struct.id.clock+r.struct.length-n.id.clock;t>0&&(r.struct.constructor===fX?r.struct.length-=t:n=$Y(n,t)),r.struct.mergeWith(n)||(HY(a,r.struct,r.offset),r={struct:n,offset:0},e.next())}}else r={struct:e.curr,offset:0},e.next();for(let n=e.curr;null!==n&&n.id.client===t&&n.id.clock===r.struct.id.clock+r.struct.length&&n.constructor!==fX;n=e.next())HY(a,r.struct,r.offset),r={struct:n,offset:0}}null!==r&&(HY(a,r.struct,r.offset),r=null),VY(a);const l=(e=>{const t=new NW;for(let n=0;n<e.length;n++)e[n].clients.forEach(((i,s)=>{if(!t.clients.has(s)){const r=i.slice();for(let t=n+1;t<e.length;t++)RH(r,e[t].clients.get(s)||[]);t.clients.set(s,r)}}));return UW(t),t})(i.map((e=>WW(e))));return VW(o,l),o.toUint8Array()},UY=(e,t,n=QW,i=iY)=>{const s=lY(t),r=new i,o=new FY(r),a=new n(AV(e)),l=new zY(a,!1);for(;l.curr;){const e=l.curr,t=e.id.client,n=s.get(t)||0;if(l.curr.constructor!==fX)if(e.id.clock+e.length>n)for(HY(o,e,KH(n-e.id.clock,0)),l.next();l.curr&&l.curr.id.client===t;)HY(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===t&&l.curr.id.clock+l.curr.length<=n;)l.next();else l.next()}VY(o);const c=WW(a);return VW(r,c),r.toUint8Array()},KY=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:aV(e.encoder.restEncoder)}),e.encoder.restEncoder=rV(),e.written=0)},HY=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&KY(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),dV(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},VY=e=>{KY(e);const t=e.encoder.restEncoder;dV(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const i=e.clientStructs[n];dV(t,i.written),fV(t,i.restEncoder)}},WY=e=>((e,t,n,i)=>{const s=new n(AV(e)),r=new zY(s,!1),o=new i,a=new FY(o);for(let c=r.curr;null!==c;c=r.next())HY(a,t(c),0);VY(a);const l=WW(s);return VW(o,l),o.toUint8Array()})(e,aW,QW,tY),YY="You must not compute changes after the event-handler fired.";class GY{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=XY(this.currentTarget,this.target))}deletes(e){return BW(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw PV(YY);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach((n=>{if(null!==n){const i=t._map.get(n);let s,r;if(this.adds(i)){let e=i.left;for(;null!==e&&this.adds(e);)e=e.left;if(this.deletes(i)){if(null===e||!this.deletes(e))return;s="delete",r=DH(e.content.getContent())}else null!==e&&this.deletes(e)?(s="update",r=DH(e.content.getContent())):(s="add",r=void 0)}else{if(!this.deletes(i))return;s="delete",r=DH(i.content.getContent())}e.set(n,{action:s,oldValue:r})}})),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){if(0===this.transaction.doc._transactionCleanups.length)throw PV(YY);const t=this.target,n=OH(),i=OH(),s=[];e={added:n,deleted:i,delta:s,keys:this.keys};if(this.transaction.changed.get(t).has(null)){let e=null;const r=()=>{e&&s.push(e)};for(let s=t._start;null!==s;s=s.right)s.deleted?this.deletes(s)&&!this.adds(s)&&(null!==e&&void 0!==e.delete||(r(),e={delete:0}),e.delete+=s.length,i.add(s)):this.adds(s)?(null!==e&&void 0!==e.insert||(r(),e={insert:[]}),e.insert=e.insert.concat(s.content.getContent()),n.add(s)):(null!==e&&void 0!==e.retain||(r(),e={retain:0}),e.retain+=s.length);null!==e&&void 0===e.retain&&r()}this._changes=e}return e}}const XY=(e,t)=>{const n=[];for(;null!==t._item&&t!==e;){if(null!==t._item.parentSub)n.unshift(t._item.parentSub);else{let e=0,i=t._item.parent._start;for(;i!==t._item&&null!==i;)!i.deleted&&i.countable&&(e+=i.length),i=i.right;n.unshift(e)}t=t._item.parent}return n};let qY=0;class ZY{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=qY++}}const JY=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=qY++},QY=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;const n=0===e._searchMarker.length?null:e._searchMarker.reduce(((e,n)=>BH(t-e.index)<BH(t-n.index)?e:n));let i=e._start,s=0;for(null!==n&&(i=n.p,s=n.index,(e=>{e.timestamp=qY++})(n));null!==i.right&&s<t;){if(!i.deleted&&i.countable){if(t<s+i.length)break;s+=i.length}i=i.right}for(;null!==i.left&&s>t;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);for(;null!==i.left&&i.left.id.client===i.id.client&&i.left.id.clock+i.left.length===i.id.clock;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);return null!==n&&BH(n.index-s)<i.parent.length/80?(JY(n,i,s),n):((e,t,n)=>{if(e.length>=80){const i=e.reduce(((e,t)=>e.timestamp<t.timestamp?e:t));return JY(i,t,n),i}{const i=new ZY(t,n);return e.push(i),i}})(e._searchMarker,i,s)},eG=(e,t,n)=>{for(let i=e.length-1;i>=0;i--){const s=e[i];if(n>0){let t=s.p;for(t.marker=!1;t&&(t.deleted||!t.countable);)t=t.left,t&&!t.deleted&&t.countable&&(s.index-=t.length);if(null===t||!0===t.marker){e.splice(i,1);continue}s.p=t,t.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=KH(t,s.index+n))}},tG=(e,t,n)=>{const i=e,s=t.changedParentTypes;for(;AH(s,e,(()=>[])).push(n),null!==e._item;)e=e._item.parent;fY(i._eH,n,t)};class nG{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=uY(),this._dEH=uY(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw IV()}clone(){throw IV()}_write(e){}get _first(){let e=this._start;for(;null!==e&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){pY(this._eH,e)}observeDeep(e){pY(this._dEH,e)}unobserve(e){gY(this._eH,e)}unobserveDeep(e){gY(this._dEH,e)}toJSON(){}}const iG=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let i=n-t;const s=[];let r=e._start;for(;null!==r&&i>0;){if(r.countable&&!r.deleted){const e=r.content.getContent();if(e.length<=t)t-=e.length;else{for(let n=t;n<e.length&&i>0;n++)s.push(e[n]),i--;t=0}}r=r.right}return s},sG=e=>{const t=[];let n=e._start;for(;null!==n;){if(n.countable&&!n.deleted){const e=n.content.getContent();for(let n=0;n<e.length;n++)t.push(e[n])}n=n.right}return t},rG=(e,t)=>{let n=0,i=e._start;for(;null!==i;){if(i.countable&&!i.deleted){const s=i.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}i=i.right}},oG=(e,t)=>{const n=[];return rG(e,((i,s)=>{n.push(t(i,s,e))})),n},aG=e=>{let t=e._start,n=null,i=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==t&&t.deleted;)t=t.right;if(null===t)return{done:!0,value:void 0};n=t.content.getContent(),i=0,t=t.right}const e=n[i++];return n.length<=i&&(n=null),{done:!1,value:e}}}},lG=(e,t)=>{const n=QY(e,t);let i=e._start;for(null!==n&&(i=n.p,t-=n.index);null!==i;i=i.right)if(!i.deleted&&i.countable){if(t<i.length)return i.content.getContent()[t];t-=i.length}},cG=(e,t,n,i)=>{let s=n;const r=e.doc,o=r.clientID,a=r.store,l=null===n?t._start:n.right;let c=[];const d=()=>{c.length>0&&(s=new uX(xY(o,kY(a,o)),s,s&&s.lastId,l,l&&l.id,t,null,new eX(c)),s.integrate(e,0),c=[])};i.forEach((n=>{if(null===n)c.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(n);break;default:switch(d(),n.constructor){case Uint8Array:case ArrayBuffer:s=new uX(xY(o,kY(a,o)),s,s&&s.lastId,l,l&&l.id,t,null,new YG(new Uint8Array(n))),s.integrate(e,0);break;case XW:s=new uX(xY(o,kY(a,o)),s,s&&s.lastId,l,l&&l.id,t,null,new qG(n)),s.integrate(e,0);break;default:if(!(n instanceof nG))throw new Error("Unexpected content type in insert operation");s=new uX(xY(o,kY(a,o)),s,s&&s.lastId,l,l&&l.id,t,null,new dX(n)),s.integrate(e,0)}}})),d()},dG=()=>PV("Length exceeded!"),hG=(e,t,n,i)=>{if(n>t._length)throw dG();if(0===n)return t._searchMarker&&eG(t._searchMarker,n,i.length),cG(e,t,null,i);const s=n,r=QY(t,n);let o=t._start;for(null!==r&&(o=r.p,0===(n-=r.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&jY(e,xY(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&eG(t._searchMarker,s,i.length),cG(e,t,o,i)},uG=(e,t,n,i)=>{if(0===i)return;const s=n,r=i,o=QY(t,n);let a=t._start;for(null!==o&&(a=o.p,n-=o.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&jY(e,xY(a.id.client,a.id.clock+n)),n-=a.length);for(;i>0&&null!==a;)a.deleted||(i<a.length&&jY(e,xY(a.id.client,a.id.clock+i)),a.delete(e),i-=a.length),a=a.right;if(i>0)throw dG();t._searchMarker&&eG(t._searchMarker,s,-r+i)},pG=(e,t,n)=>{const i=t._map.get(n);void 0!==i&&i.delete(e)},gG=(e,t,n,i)=>{const s=t._map.get(n)||null,r=e.doc,o=r.clientID;let a;if(null==i)a=new eX([i]);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:a=new eX([i]);break;case Uint8Array:a=new YG(i);break;case XW:a=new qG(i);break;default:if(!(i instanceof nG))throw new Error("Unexpected content type");a=new dX(i)}new uX(xY(o,kY(r.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},fG=(e,t)=>{const n=e._map.get(t);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},mG=e=>{const t={};return e._map.forEach(((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])})),t},yG=(e,t)=>{const n=e._map.get(t);return void 0!==n&&!n.deleted},xG=e=>{return t=e.entries(),n=e=>!e[1].deleted,LW((()=>{let e;do{e=t.next()}while(!e.done&&!n(e.value));return e}));var t,n};class wG extends GY{}class vG extends nG{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new vG;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new vG}clone(){const e=new vG;return e.insert(0,this.toArray().map((e=>e instanceof nG?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),tG(this,e,new wG(this,e))}insert(e,t){null!==this.doc?LY(this.doc,(n=>{hG(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?LY(this.doc,(t=>{((e,t,n)=>{let i=(t._searchMarker||[]).reduce(((e,t)=>t.index>e.index?t:e),{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;cG(e,t,i,n)})(t,this,e)})):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?LY(this.doc,(n=>{uG(n,this,e,t)})):this._prelimContent.splice(e,t)}get(e){return lG(this,e)}toArray(){return sG(this)}slice(e=0,t=this.length){return iG(this,e,t)}toJSON(){return this.map((e=>e instanceof nG?e.toJSON():e))}map(e){return oG(this,e)}forEach(e){rG(this,e)}[Symbol.iterator](){return aG(this)}_write(e){e.writeTypeRef(iX)}}class bG extends GY{constructor(e,t,n){super(e,t),this.keysChanged=n}}class SG extends nG{constructor(e){super(),this._prelimContent=null,this._prelimContent=void 0===e?new Map:new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach(((e,t)=>{this.set(t,e)})),this._prelimContent=null}_copy(){return new SG}clone(){const e=new SG;return this.forEach(((t,n)=>{e.set(n,t instanceof nG?t.clone():t)})),e}_callObserver(e,t){tG(this,e,new bG(this,e,t))}toJSON(){const e={};return this._map.forEach(((t,n)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[n]=i instanceof nG?i.toJSON():i}})),e}get size(){return[...xG(this._map)].length}keys(){return zW(xG(this._map),(e=>e[0]))}values(){return zW(xG(this._map),(e=>e[1].content.getContent()[e[1].length-1]))}entries(){return zW(xG(this._map),(e=>[e[0],e[1].content.getContent()[e[1].length-1]]))}forEach(e){this._map.forEach(((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?LY(this.doc,(t=>{pG(t,this,e)})):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?LY(this.doc,(n=>{gG(n,this,e,t)})):this._prelimContent.set(e,t),t}get(e){return fG(this,e)}has(e){return yG(this,e)}clear(){null!==this.doc?LY(this.doc,(e=>{this.forEach((function(t,n,i){pG(e,i,n)}))})):this._prelimContent.clear()}_write(e){e.writeTypeRef(sX)}}const kG=(e,t)=>e===t||"object"==typeof e&&"object"==typeof t&&e&&t&&((e,t)=>e===t||sW(e)===sW(t)&&((e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0})(e,((e,n)=>(void 0!==e||rW(t,n))&&t[n]===e)))(e,t);class CG{constructor(e,t,n,i){this.left=e,this.right=t,this.index=n,this.currentAttributes=i}forward(){if(null===this.right&&jV(),this.right.content.constructor===JG)this.right.deleted||jG(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const _G=(e,t,n)=>{for(;null!==t.right&&n>0;){if(t.right.content.constructor===JG)t.right.deleted||jG(t.currentAttributes,t.right.content);else t.right.deleted||(n<t.right.length&&jY(e,xY(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);t.left=t.right,t.right=t.right.right}return t},PG=(e,t,n,i)=>{const s=new Map,r=i?QY(t,n):null;if(r){const t=new CG(r.p.left,r.p,r.index,s);return _G(e,t,n-r.index)}{const i=new CG(null,t._start,0,s);return _G(e,i,n)}},IG=(e,t,n,i)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===JG&&kG(i.get(n.right.content.key),n.right.content.value));)n.right.deleted||i.delete(n.right.content.key),n.forward();const s=e.doc,r=s.clientID;i.forEach(((i,o)=>{const a=n.left,l=n.right,c=new uX(xY(r,kY(s.store,r)),a,a&&a.lastId,l,l&&l.id,t,null,new JG(o,i));c.integrate(e,0),n.right=c,n.forward()}))},jG=(e,t)=>{const{key:n,value:i}=t;null===i?e.delete(n):e.set(n,i)},EG=(e,t)=>{for(;null!==e.right&&(e.right.deleted||e.right.content.constructor===JG&&kG(t[e.right.content.key]??null,e.right.content.value));)e.forward()},TG=(e,t,n,i)=>{const s=e.doc,r=s.clientID,o=new Map;for(const a in i){const l=i[a],c=n.currentAttributes.get(a)??null;if(!kG(c,l)){o.set(a,c);const{left:i,right:d}=n;n.right=new uX(xY(r,kY(s.store,r)),i,i&&i.lastId,d,d&&d.id,t,null,new JG(a,l)),n.right.integrate(e,0),n.forward()}}return o},MG=(e,t,n,i,s)=>{n.currentAttributes.forEach(((e,t)=>{void 0===s[t]&&(s[t]=null)}));const r=e.doc,o=r.clientID;EG(n,s);const a=TG(e,t,n,s),l=i.constructor===String?new tX(i):i instanceof nG?new dX(i):new ZG(i);let{left:c,right:d,index:h}=n;t._searchMarker&&eG(t._searchMarker,n.index,l.getLength()),d=new uX(xY(o,kY(r.store,o)),c,c&&c.lastId,d,d&&d.id,t,null,l),d.integrate(e,0),n.right=d,n.index=h,n.forward(),IG(e,t,n,a)},AG=(e,t,n,i,s)=>{const r=e.doc,o=r.clientID;EG(n,s);const a=TG(e,t,n,s);e:for(;null!==n.right&&(i>0||a.size>0&&(n.right.deleted||n.right.content.constructor===JG));){if(!n.right.deleted)switch(n.right.content.constructor){case JG:{const{key:t,value:r}=n.right.content,o=s[t];if(void 0!==o){if(kG(o,r))a.delete(t);else{if(0===i)break e;a.set(t,r)}n.right.delete(e)}else n.currentAttributes.set(t,r);break}default:i<n.right.length&&jY(e,xY(n.right.id.client,n.right.id.clock+i)),i-=n.right.length}n.forward()}if(i>0){let s="";for(;i>0;i--)s+="\n";n.right=new uX(xY(o,kY(r.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new tX(s)),n.right.integrate(e,0),n.forward()}IG(e,t,n,a)},OG=(e,t,n,i,s)=>{let r=t;const o=TH();for(;r&&(!r.countable||r.deleted);){if(!r.deleted&&r.content.constructor===JG){const e=r.content;o.set(e.key,e)}r=r.right}let a=0,l=!1;for(;t!==r;){if(n===t&&(l=!0),!t.deleted){const n=t.content;switch(n.constructor){case JG:{const{key:r,value:c}=n,d=i.get(r)??null;o.get(r)===n&&d!==c||(t.delete(e),a++,l||(s.get(r)??null)!==c||d===c||(null===d?s.delete(r):s.set(r,d))),l||t.deleted||jG(s,n);break}}}t=t.right}return a},DG=e=>{let t=0;return LY(e.doc,(n=>{let i=e._start,s=e._start,r=TH();const o=MH(r);for(;s;){if(!1===s.deleted)if(s.content.constructor===JG)jG(o,s.content);else t+=OG(n,i,s,r,o),r=MH(o),i=s;s=s.right}})),t},RG=e=>{const t=new Set,n=e.doc;for(const[i,s]of e.afterState.entries()){const r=e.beforeState.get(i)||0;s!==r&&TY(e,n.store.clients.get(i),r,s,(e=>{e.deleted||e.content.constructor!==JG||e.constructor===WG||t.add(e.parent)}))}LY(n,(n=>{$W(e,e.deleteSet,(e=>{if(e instanceof WG||!e.parent._hasFormatting||t.has(e.parent))return;const i=e.parent;e.content.constructor===JG?t.add(i):((e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===JG){const i=t.content.key;n.has(i)?t.delete(e):n.add(i)}t=t.left}})(n,e)}));for(const e of t)DG(e)}))},LG=(e,t,n)=>{const i=n,s=MH(t.currentAttributes),r=t.right;for(;n>0&&null!==t.right;){if(!1===t.right.deleted)switch(t.right.content.constructor){case dX:case ZG:case tX:n<t.right.length&&jY(e,xY(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e)}t.forward()}r&&OG(e,r,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&eG(o._searchMarker,t.index,-i+n),t};class zG extends GY{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)}))}get changes(){if(null===this._changes){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){const e=this.target.doc,t=[];LY(e,(e=>{const n=new Map,i=new Map;let s=this.target._start,r=null;const o={};let a="",l=0,c=0;const d=()=>{if(null!==r){let e=null;switch(r){case"delete":c>0&&(e={delete:c}),c=0;break;case"insert":("object"==typeof a||a.length>0)&&(e={insert:a},n.size>0&&(e.attributes={},n.forEach(((t,n)=>{null!==t&&(e.attributes[n]=t)})))),a="";break;case"retain":l>0&&(e={retain:l},(e=>{for(const t in e)return!1;return!0})(o)||(e.attributes=tW({},o))),l=0}e&&t.push(e),r=null}};for(;null!==s;){switch(s.content.constructor){case dX:case ZG:this.adds(s)?this.deletes(s)||(d(),r="insert",a=s.content.getContent()[0],d()):this.deletes(s)?("delete"!==r&&(d(),r="delete"),c+=1):s.deleted||("retain"!==r&&(d(),r="retain"),l+=1);break;case tX:this.adds(s)?this.deletes(s)||("insert"!==r&&(d(),r="insert"),a+=s.content.str):this.deletes(s)?("delete"!==r&&(d(),r="delete"),c+=s.length):s.deleted||("retain"!==r&&(d(),r="retain"),l+=s.length);break;case JG:{const{key:t,value:a}=s.content;if(this.adds(s)){if(!this.deletes(s)){const l=n.get(t)??null;kG(l,a)?null!==a&&s.delete(e):("retain"===r&&d(),kG(a,i.get(t)??null)?delete o[t]:o[t]=a)}}else if(this.deletes(s)){i.set(t,a);const e=n.get(t)??null;kG(e,a)||("retain"===r&&d(),o[t]=e)}else if(!s.deleted){i.set(t,a);const n=o[t];void 0!==n&&(kG(n,a)?null!==n&&s.delete(e):("retain"===r&&d(),null===a?delete o[t]:o[t]=a))}s.deleted||("insert"===r&&d(),jG(n,s.content));break}}s=s.right}for(d();t.length>0;){const e=t[t.length-1];if(void 0===e.retain||void 0!==e.attributes)break;t.pop()}})),this._delta=t}return this._delta}}class FG extends nG{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach((e=>e()))}catch(UX){console.error(UX)}this._pending=null}_copy(){return new FG}clone(){const e=new FG;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new zG(this,e,t);tG(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;null!==t;)!t.deleted&&t.countable&&t.content.constructor===tX&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?LY(this.doc,(n=>{const i=new CG(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const r=e[s];if(void 0!==r.insert){const o=t||"string"!=typeof r.insert||s!==e.length-1||null!==i.right||"\n"!==r.insert.slice(-1)?r.insert:r.insert.slice(0,-1);("string"!=typeof o||o.length>0)&&MG(n,this,i,o,r.attributes||{})}else void 0!==r.retain?AG(n,this,i,r.retain,r.attributes||{}):void 0!==r.delete&&LG(n,i,r.delete)}})):this._pending.push((()=>this.applyDelta(e)))}toDelta(e,t,n){const i=[],s=new Map,r=this.doc;let o="",a=this._start;function l(){if(o.length>0){const e={};let t=!1;s.forEach(((n,i)=>{t=!0,e[i]=n}));const n={insert:o};t&&(n.attributes=e),i.push(n),o=""}}const c=()=>{for(;null!==a;){if(wY(a,e)||void 0!==t&&wY(a,t))switch(a.content.constructor){case tX:{const i=s.get("ychange");void 0===e||wY(a,e)?void 0===t||wY(a,t)?void 0!==i&&(l(),s.delete("ychange")):void 0!==i&&i.user===a.id.client&&"added"===i.type||(l(),s.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==i&&i.user===a.id.client&&"removed"===i.type||(l(),s.set("ychange",n?n("removed",a.id):{type:"removed"})),o+=a.content.str;break}case dX:case ZG:{l();const e={insert:a.content.getContent()[0]};if(s.size>0){const t={};e.attributes=t,s.forEach(((e,n)=>{t[n]=e}))}i.push(e);break}case JG:wY(a,e)&&(l(),jG(s,a.content))}a=a.right}l()};return e||t?LY(r,(n=>{e&&vY(n,e),t&&vY(n,t),c()}),"cleanup"):c(),i}insert(e,t,n){if(t.length<=0)return;const i=this.doc;null!==i?LY(i,(i=>{const s=PG(i,this,e,!n);n||(n={},s.currentAttributes.forEach(((e,t)=>{n[t]=e}))),MG(i,this,s,t,n)})):this._pending.push((()=>this.insert(e,t,n)))}insertEmbed(e,t,n){const i=this.doc;null!==i?LY(i,(i=>{const s=PG(i,this,e,!n);MG(i,this,s,t,n||{})})):this._pending.push((()=>this.insertEmbed(e,t,n||{})))}delete(e,t){if(0===t)return;const n=this.doc;null!==n?LY(n,(n=>{LG(n,PG(n,this,e,!0),t)})):this._pending.push((()=>this.delete(e,t)))}format(e,t,n){if(0===t)return;const i=this.doc;null!==i?LY(i,(i=>{const s=PG(i,this,e,!1);null!==s.right&&AG(i,this,s,t,n)})):this._pending.push((()=>this.format(e,t,n)))}removeAttribute(e){null!==this.doc?LY(this.doc,(t=>{pG(t,this,e)})):this._pending.push((()=>this.removeAttribute(e)))}setAttribute(e,t){null!==this.doc?LY(this.doc,(n=>{gG(n,this,e,t)})):this._pending.push((()=>this.setAttribute(e,t)))}getAttribute(e){return fG(this,e)}getAttributes(){return mG(this)}_write(e){e.writeTypeRef(rX)}}class NG{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do{if(t=e.content.type,e.deleted||t.constructor!==BG&&t.constructor!==$G||null===t._start)for(;null!==e;){if(null!==e.right){e=e.right;break}e=e.parent===this._root?null:e.parent._item}else e=t._start}while(null!==e&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,null===e?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $G extends nG{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $G}clone(){const e=new $G;return e.insert(0,this.toArray().map((e=>e instanceof nG?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new NG(this,e)}querySelector(e){e=e.toUpperCase();const t=new NG(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),LH(new NG(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)))}_callObserver(e,t){tG(this,e,new UG(this,t,e))}toString(){return oG(this,(e=>e.toString())).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const i=e.createDocumentFragment();return void 0!==n&&n._createAssociation(i,this),rG(this,(s=>{i.insertBefore(s.toDOM(e,t,n),null)})),i}insert(e,t){null!==this.doc?LY(this.doc,(n=>{hG(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)LY(this.doc,(n=>{const i=e&&e instanceof nG?e._item:e;cG(n,this,i,t)}));else{const n=this._prelimContent,i=null===e?0:n.findIndex((t=>t===e))+1;if(0===i&&null!==e)throw PV("Reference item not found");n.splice(i,0,...t)}}delete(e,t=1){null!==this.doc?LY(this.doc,(n=>{uG(n,this,e,t)})):this._prelimContent.splice(e,t)}toArray(){return sG(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return lG(this,e)}slice(e=0,t=this.length){return iG(this,e,t)}forEach(e){rG(this,e)}_write(e){e.writeTypeRef(aX)}}class BG extends $G{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach(((e,t)=>{this.setAttribute(t,e)})),this._prelimAttrs=null}_copy(){return new BG(this.nodeName)}clone(){const e=new BG(this.nodeName);return((e,t)=>{for(const n in e)t(e[n],n)})(this.getAttributes(),((t,n)=>{"string"==typeof t&&e.setAttribute(n,t)})),e.insert(0,this.toArray().map((e=>e instanceof nG?e.clone():e))),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const r in e)n.push(r);n.sort();const i=n.length;for(let r=0;r<i;r++){const i=n[r];t.push(i+'="'+e[i]+'"')}const s=this.nodeName.toLocaleLowerCase();return`<${s}${t.length>0?" "+t.join(" "):""}>${super.toString()}</${s}>`}removeAttribute(e){null!==this.doc?LY(this.doc,(t=>{pG(t,this,e)})):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?LY(this.doc,(n=>{gG(n,this,e,t)})):this._prelimAttrs.set(e,t)}getAttribute(e){return fG(this,e)}hasAttribute(e){return yG(this,e)}getAttributes(e){return e?((e,t)=>{const n={};return e._map.forEach(((e,i)=>{let s=e;for(;null!==s&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;null!==s&&wY(s,t)&&(n[i]=s.content.getContent()[s.length-1])})),n})(this,e):mG(this)}toDOM(e=document,t={},n){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const r in s){const e=s[r];"string"==typeof e&&i.setAttribute(r,e)}return rG(this,(s=>{i.appendChild(s.toDOM(e,t,n))})),void 0!==n&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(oX),e.writeKey(this.nodeName)}}class UG extends GY{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach((e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)}))}}class KG extends SG{constructor(e){super(),this.hookName=e}_copy(){return new KG(this.hookName)}clone(){const e=new KG(this.hookName);return this.forEach(((t,n)=>{e.set(n,t)})),e}toDOM(e=document,t={},n){const i=t[this.hookName];let s;return s=void 0!==i?i.createDom(this):document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(lX),e.writeKey(this.hookName)}}class HG extends FG{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new HG}clone(){const e=new HG;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const i=e.createTextNode(this.toString());return void 0!==n&&n._createAssociation(i,this),i}toString(){return this.toDelta().map((e=>{const t=[];for(const i in e.attributes){const n=[];for(const t in e.attributes[i])n.push({key:t,value:e.attributes[i][t]});n.sort(((e,t)=>e.key<t.key?-1:1)),t.push({nodeName:i,attrs:n})}t.sort(((e,t)=>e.nodeName<t.nodeName?-1:1));let n="";for(let i=0;i<t.length;i++){const e=t[i];n+=`<${e.nodeName}`;for(let t=0;t<e.attrs.length;t++){const i=e.attrs[t];n+=` ${i.key}="${i.value}"`}n+=">"}n+=e.insert;for(let i=t.length-1;i>=0;i--)n+=`</${t[i].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(cX)}}class VG{constructor(e,t){this.id=e,this.length=t}get deleted(){throw IV()}mergeWith(e){return!1}write(e,t,n){throw IV()}integrate(e,t){throw IV()}}class WG extends VG{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),CY(e.doc.store,this)}write(e,t){e.writeInfo(0),e.writeLen(this.length-t)}getMissing(e,t){return null}}class YG{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new YG(this.content)}splice(e){throw IV()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class GG{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new GG(this.len)}splice(e){const t=new GG(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){KW(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const XG=(e,t)=>new XW({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class qG{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new qG(XG(this.doc.guid,this.opts))}splice(e){throw IV()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class ZG{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ZG(this.embed)}splice(e){throw IV()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class JG{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new JG(this.key,this.value)}splice(e){throw IV()}mergeWith(e){return!1}integrate(e,t){const n=t.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}class QG{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new QG(this.arr)}splice(e){const t=new QG(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let i=t;i<n;i++){const t=this.arr[i];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}class eX{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new eX(this.arr)}splice(e){const t=new eX(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let i=t;i<n;i++){const t=this.arr[i];e.writeAny(t)}}getRef(){return 8}}class tX{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new tX(this.str)}splice(e){const t=new tX(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"ï¿½",t.str="ï¿½"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}const nX=[e=>new vG,e=>new SG,e=>new FG,e=>new BG(e.readKey()),e=>new $G,e=>new KG(e.readKey()),e=>new HG],iX=0,sX=1,rX=2,oX=3,aX=4,lX=5,cX=6;class dX{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new dX(this.type._copy())}splice(e){throw IV()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;null!==t;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach((t=>{t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e)})),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;null!==t;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach((t=>{for(;null!==t;)t.gc(e,!0),t=t.left})),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const hX=(e,t,n)=>{const{client:i,clock:s}=t.id,r=new uX(xY(i,s+n),t,xY(i,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&r.markDeleted(),t.keep&&(r.keep=!0),null!==t.redone&&(r.redone=xY(t.redone.client,t.redone.clock+n)),t.right=r,null!==r.right&&(r.right.left=r),e._mergeStructs.push(r),null!==r.parentSub&&null===r.right&&r.parent._map.set(r.parentSub,r),t.length=n,r};class uX extends VG{constructor(e,t,n,i,s,r,o,a){super(e,a.getLength()),this.origin=n,this.left=t,this.right=i,this.rightOrigin=s,this.parent=r,this.parentSub=o,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(e){(8&this.info)>0!==e&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=kY(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=kY(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===mY&&this.id.client!==this.parent.client&&this.parent.clock>=kY(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=EY(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=jY(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===WG||this.right&&this.right.constructor===WG)this.parent=null;else if(this.parent){if(this.parent.constructor===mY){const e=PY(t,this.parent);e.constructor===WG?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===uX&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===uX&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=EY(e,e.doc.store,xY(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,n=this.left;if(null!==n)t=n.right;else if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start;const i=new Set,s=new Set;for(;null!==t&&t!==this.right;){if(s.add(t),i.add(t),yY(this.origin,t.origin)){if(t.id.client<this.id.client)n=t,i.clear();else if(yY(this.rightOrigin,t.rightOrigin))break}else{if(null===t.origin||!s.has(PY(e.doc.store,t.origin)))break;i.has(PY(e.doc.store,t.origin))||(n=t,i.clear())}t=t.right}this.left=n}if(null!==this.left){const e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),CY(e.doc.store,this),this.content.integrate(e,this),OY(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new WG(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;null!==e&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;null!==e&&e.deleted;)e=e.left;return e}get lastId(){return 1===this.length?this.id:xY(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&yY(e.origin,this.lastId)&&this.right===e&&yY(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach((t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))})),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),KW(e.deleteSet,this.id.client,this.id.clock,this.length),OY(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw jV();this.content.gc(e),t?((e,t,n)=>{const i=e.clients.get(t.id.client);i[_Y(i,t.id.clock)]=n})(e,this,new WG(this.id,this.length)):this.content=new GG(this.length)}write(e,t){const n=t>0?xY(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,r=31&this.content.getRef()|(null===n?0:YH)|(null===i?0:WH)|(null===s?0:32);if(e.writeInfo(r),null!==n&&e.writeLeftID(n),null!==i&&e.writeRightID(i),null===n&&null===i){const t=this.parent;if(void 0!==t._item){const n=t._item;if(null===n){const n=(e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw jV()})(t);e.writeParentInfo(!0),e.writeString(n)}else e.writeParentInfo(!1),e.writeLeftID(n.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===mY?(e.writeParentInfo(!1),e.writeLeftID(t)):jV();null!==s&&e.writeString(s)}this.content.write(e,t)}}const pX=(e,t)=>gX[31&t](e),gX=[()=>{jV()},e=>new GG(e.readLen()),e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++){const t=e.readString();"undefined"===t?n.push(void 0):n.push(JSON.parse(t))}return new QG(n)},e=>new YG(e.readBuf()),e=>new tX(e.readString()),e=>new ZG(e.readJSON()),e=>new JG(e.readKey(),e.readJSON()),e=>new dX(nX[e.readTypeRef()](e)),e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++)n.push(e.readAny());return new eX(n)},e=>new qG(XG(e.readString(),e.readAny())),()=>{jV()}];class fX extends VG{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){jV()}write(e,t){e.writeInfo(10),dV(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const mX="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},yX="__ $YJS$ __";!0===mX[yX]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),mX[yX]=!0;class xX extends NH{constructor(e){super(),this.yarray=e,this.doc=e.doc,this.map=new Map;{const t=e.toArray();this.doc.transact((()=>{for(let n=t.length-1;n>=0;n--){const i=t[n];this.map.has(i.key)?e.delete(n):this.map.set(i.key,i)}}))}e.observe(((t,n)=>{const i=new Map,s=Array.from(t.changes.added);t.changes.deleted.forEach((e=>{e.content.getContent().forEach((e=>{this.map.get(e.key)===e&&(this.map.delete(e.key),i.set(e.key,{action:"delete",oldValue:e.val}))}))}));const r=new Map;s.map((e=>e.content.getContent())).flat().forEach((e=>{r.set(e.key,e)}));const o=new Set,a=e.toArray();this.doc.transact((t=>{for(let n=a.length-1;n>=0&&(r.size>0||o.size>0);n--){const t=a[n];if(o.has(t.key))o.delete(t.key),e.delete(n,1);else if(r.get(t.key)===t){const e=this.map.get(t.key);if(e)o.add(t.key),i.set(t.key,{action:"update",oldValue:e.val,newValue:t.val});else{const e=i.get(t.key);e&&"delete"===e.action?i.set(t.key,{action:"update",newValue:t.val,oldValue:e.oldValue}):i.set(t.key,{action:"add",newValue:t.val})}r.delete(t.key),this.map.set(t.key,t)}else r.has(t.key)&&(o.add(t.key),r.delete(t.key))}})),i.size>0&&this.emit("change",[i,n])}))}set(e,t){this.doc.transact((n=>{this.map.has(e)&&this.delete(e),this.yarray.push([{key:e,val:t}])}))}delete(e){let t=0;for(const n of this.yarray){if(n.key===e){this.yarray.delete(t);break}t++}}get(e){const t=this.map.get(e);return t&&t.val}has(e){return this.map.has(e)}}const wX=new Map;const vX="undefined"==typeof BroadcastChannel?class{constructor(e){var t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:vW(t.newValue||"")}),t=this._onChange,QV||addEventListener("storage",t)}postMessage(e){eW.setItem(this.room,wW(new Uint8Array(e)))}close(){var e;e=this._onChange,QV||removeEventListener("storage",e)}}:BroadcastChannel,bX=e=>AH(wX,e,(()=>{const t=OH(),n=new vX(e);return n.onmessage=e=>t.forEach((t=>t(e.data,"broadcastchannel"))),{bc:n,subs:t}})),SX=(e,t,n=null)=>{const i=bX(e);i.bc.postMessage(t),i.subs.forEach((e=>e(t,n)))},kX=(e,t)=>{dV(e,0);const n=(e=>dY(e,new eY))(t);mV(e,n)},CX=(e,t,n)=>{dV(e,1),mV(e,((e,t)=>aY(e,t,new tY))(t,n))},_X=(e,t,n)=>{try{((e,t,n)=>{oY(e,t,n,ZW)})(t,OV(e),n)}catch(i){console.error("Caught error while handling a Yjs update",i)}},PX=_X,IX=(e,t,n,i)=>{const s=RV(e);switch(s){case 0:((e,t,n)=>{CX(t,n,OV(e))})(e,t,n);break;case 1:_X(e,n,i);break;case 2:PX(e,n,i);break;default:throw new Error("Unknown message type")}return s},jX=3e4;class EX extends NH{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=XV();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((n,i)=>{i!==this.clientID&&jX<=e-n.lastUpdated&&this.states.has(i)&&t.push(i)})),t.length>0&&TX(this,t,"timeout")}),$H(3e3)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),i=void 0===n?0:n.clock+1,s=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:i,lastUpdated:XV()});const r=[],o=[],a=[],l=[];null===e?l.push(t):null==s?null!=e&&r.push(t):(o.push(t),lW(s,e)||a.push(t)),(r.length>0||a.length>0||l.length>0)&&this.emit("change",[{added:r,updated:a,removed:l},"local"]),this.emit("update",[{added:r,updated:o,removed:l},"local"])}setLocalStateField(e,t){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const TX=(e,t,n)=>{const i=[];for(let s=0;s<t.length;s++){const n=t[s];if(e.states.has(n)){if(e.states.delete(n),n===e.clientID){const t=e.meta.get(n);e.meta.set(n,{clock:t.clock+1,lastUpdated:XV()})}i.push(n)}}i.length>0&&(e.emit("change",[{added:[],updated:[],removed:i},n]),e.emit("update",[{added:[],updated:[],removed:i},n]))},MX=(e,t,n=e.states)=>{const i=t.length,s=rV();dV(s,i);for(let r=0;r<i;r++){const i=t[r],o=n.get(i)||null,a=e.meta.get(i).clock;dV(s,i),dV(s,a),gV(s,JSON.stringify(o))}return aV(s)},AX=[];AX[0]=(e,t,n,i,s)=>{dV(e,0);const r=IX(t,e,n.doc,n);i&&1===r&&!n.synced&&(n.synced=!0)},AX[3]=(e,t,n,i,s)=>{dV(e,1),mV(e,MX(n.awareness,Array.from(n.awareness.getStates().keys())))},AX[1]=(e,t,n,i,s)=>{((e,t,n)=>{const i=AV(t),s=XV(),r=[],o=[],a=[],l=[],c=RV(i);for(let d=0;d<c;d++){const t=RV(i);let n=RV(i);const c=JSON.parse(zV(i)),d=e.meta.get(t),h=e.states.get(t),u=void 0===d?0:d.clock;(u<n||u===n&&null===c&&e.states.has(t))&&(null===c?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,c),e.meta.set(t,{clock:n,lastUpdated:s}),void 0===d&&null!==c?r.push(t):void 0!==d&&null===c?l.push(t):null!==c&&(lW(c,h)||a.push(t),o.push(t)))}(r.length>0||a.length>0||l.length>0)&&e.emit("change",[{added:r,updated:a,removed:l},n]),(r.length>0||o.length>0||l.length>0)&&e.emit("update",[{added:r,updated:o,removed:l},n])})(n.awareness,OV(t),n)},AX[2]=(e,t,n,i,s)=>{((e,t,n)=>{0===RV(e)&&n(t,zV(e))})(t,n.doc,((e,t)=>OX(n,t)))};const OX=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),DX=(e,t,n)=>{const i=AV(t),s=rV(),r=RV(i),o=e.messageHandlers[r];return o?o(s,i,e,n,r):console.error("Unable to compute message"),s},RX=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=XV();const i=DX(e,new Uint8Array(n.data),!0);oV(i)>1&&t.send(aV(i))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=t=>{e.emit("connection-close",[t,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,TX(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(RX,UH(100*HH(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},t.onopen=()=>{e.wsLastMessageReceived=XV(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=rV();if(dV(n,0),kX(n,e.doc),t.send(aV(n)),null!==e.awareness.getLocalState()){const n=rV();dV(n,1),mV(n,MX(e.awareness,[e.doc.clientID])),t.send(aV(n))}},e.emit("status",[{status:"connecting"}])}},LX=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&SX(e.bcChannel,t,e)};class zX extends NH{constructor(e,t,n,{connect:i=!0,awareness:s=new EX(n),params:r={},WebSocketPolyfill:o=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=l,this.params=r,this.roomname=t,this.doc=n,this._WS=o,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=AX.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=i,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval((()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=rV();dV(e,0),kX(e,n),this.ws.send(aV(e))}}),a)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=DX(this,new Uint8Array(e),!1);oV(t)>1&&SX(this.bcChannel,aV(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=rV();dV(t,0),((e,t)=>{dV(e,2),mV(e,t)})(t,e),LX(this,aV(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:n},i)=>{const r=e.concat(t).concat(n),o=rV();dV(o,1),mV(o,MX(s,r)),LX(this,aV(o))},this._exitHandler=()=>{TX(this.awareness,[n.clientID],"app closed")},dW&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<XV()-this.wsLastMessageReceived&&this.ws.close()}),3e3),i&&this.connect()}get url(){const e=((e,t)=>{const n=[];for(const i in e)n.push(t(e[i],i));return n})(this.params,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&");return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),dW&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,bX(e).subs.add(t),this.bcconnected=!0);const n=rV();dV(n,0),kX(n,this.doc),SX(this.bcChannel,aV(n),this);const i=rV();dV(i,0),CX(i,this.doc),SX(this.bcChannel,aV(i),this);const s=rV();dV(s,3),SX(this.bcChannel,aV(s),this);const r=rV();dV(r,1),mV(r,MX(this.awareness,[this.doc.clientID])),SX(this.bcChannel,aV(r),this)}disconnectBc(){const e=rV();dV(e,1),mV(e,MX(this.awareness,[this.doc.clientID],new Map)),LX(this,aV(e)),this.bcconnected&&(((e,t)=>{const n=bX(e),i=n.subs.delete(t);i&&0===n.subs.size&&(n.bc.close(),wX.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(RX(this),this.connectBc())}}function FX({roomId:e="example",hostUrl:t="ws://localhost:1234",shapeUtils:n=[]}){const[i]=C.useState((()=>JS({shapeUtils:[...wj,...n]}))),[s,r]=C.useState({status:"loading"}),{yDoc:o,yStore:a,meta:l,room:c}=C.useMemo((()=>{const n=new XW({gc:!0}),i=n.getArray(`tl_${e}`),s=new xX(i),r=n.getMap("meta");return{yDoc:n,yStore:s,meta:r,room:new zX(t,e,n,{connect:!0})}}),[t,e]);return C.useEffect((()=>{const e=[];function t(){const t=(e,t)=>{if(t.local)return;const n=[],s=[];e.forEach(((e,t)=>{switch(e.action){case"add":case"update":{const e=a.get(t);s.push(e);break}case"delete":n.push(t)}})),i.mergeRemoteChanges((()=>{n.length&&i.remove(n),s.length&&i.put(s)}))};a.on("change",t),e.push((()=>a.off("change",t)));const n=e=>{const t=c.awareness.getStates(),n=[],s=[];for(const i of e.added){const e=t.get(i);(null==e?void 0:e.presence)&&e.presence.id!==u&&s.push(e.presence)}for(const i of e.updated){const e=t.get(i);(null==e?void 0:e.presence)&&e.presence.id!==u&&s.push(e.presence)}for(const i of e.removed)n.push(ef.createId(i.toString()));i.mergeRemoteChanges((()=>{n.length&&i.remove(n),s.length&&i.put(s)}))},s=()=>{const e=l.get("schema");if(!e)throw new Error("No schema found in the yjs doc");const t=i.schema.getMigrationsSince(e);(!t.ok||t.value.length>0)&&(window.alert("The schema has been updated. Please refresh the page."),o.destroy())};if(l.observe(s),e.push((()=>l.unobserve(s))),c.awareness.on("update",n),e.push((()=>c.awareness.off("update",n))),a.yarray.length){const e=i.schema.serialize(),t=l.get("schema");t||(()=>{const e=i.schema.serialize(),t=i.allRecords();o.transact((()=>{t.forEach((e=>a.set(e.id,e))),l.set("schema",e)})),i.loadSnapshot({store:Object.fromEntries(t.map((e=>[e.id,e]))),schema:e})})();const n=a.yarray.toJSON().map((({val:e})=>e)),s=i.schema.migrateStoreSnapshot({schema:t,store:Object.fromEntries(n.map((e=>[e.id,e])))});if("error"===s.type)return console.error(s.reason),void window.alert("The schema has been updated. Please refresh the page.");o.transact((()=>{for(const e of n)s.value[e.id]||a.delete(e.id);for(const e of Object.values(s.value))a.set(e.id,e);l.set("schema",e)})),i.loadSnapshot({store:s.value,schema:e})}else o.transact((()=>{for(const e of i.allRecords())a.set(e.id,e);l.set("schema",i.schema.serialize())}));r({store:i,status:"synced-remote",connectionStatus:"online"})}r({status:"loading"});let n=!1;function s({status:s}){if("disconnected"!==s){if(c.off("synced",t),"connected"===s){if(n)return;n=!0,c.on("synced",t),e.push((()=>c.off("synced",t)))}}else r({store:i,status:"synced-remote",connectionStatus:"offline"})}c.on("status",s);const d=ju("userPreferences",(()=>{const e=Sv();return{id:e.id,color:e.color??dv.color,name:e.name??dv.name}})),h=c.awareness.clientID.toString();mv({id:h});const u=ef.createId(h),p=tf(d,u)(i);return c.awareness.setLocalStateField("presence",p.get()),e.push(i.listen((async function({changes:e}){o.transact((()=>{Object.values(e.added).forEach((e=>{a.set(e.id,e)})),Object.values(e.updated).forEach((([e,t])=>{a.set(t.id,t)})),Object.values(e.removed).forEach((e=>{a.delete(e.id)}))}))}),{source:"user",scope:"document"})),e.push((()=>c.off("status",s))),e.push(cu("when presence changes",(()=>{const e=p.get();requestAnimationFrame((()=>{c.awareness.setLocalStateField("presence",e)}))}))),()=>{e.forEach((e=>e())),e.length=0}}),[c,o,i,a,l]),s}function NX(){re("/normalize.css");const{roomId:e}=X(),[t,n]=C.useState(!1),i=R(),s=FX({roomId:e,hostUrl:"wss://yws.win-gavin.top"});return C.useEffect((()=>{(async()=>{try{await Y(e),n(!0)}catch(t){setTimeout((()=>{i("/")}),2e3)}})()}),[e]),t?k.jsxs("div",{className:"tldraw__editor",children:[k.jsx(EH,{}),k.jsx(oK,{autoFocus:!0,store:s,components:{SharePanel:$X}})]}):k.jsx("div",{children:"Loading..."})}const $X=Ou((()=>{const[e,t]=C.useState(!1);BM();const n=jm();rD();const i=R(),s=async()=>{try{t(!0);const{roomId:e}=X();let s=n.getSelectedShapeIds();if(0===s.length&&(s=Array.from(n.getCurrentPageShapeIds().values())),0===s.length)return i("/");const r=await eD({editor:n,ids:s,format:"png"}),a=new File([r],o,{type:r.type});let l=new FormData;l.append("file",a),l.append("roomId",e),await G(l),i("/")}catch(e){}finally{t(!1)}},{color:r,name:o}=n.user.getUserPreferences();return k.jsxs("div",{style:{pointerEvents:"all",display:"flex"},children:[k.jsx(se,{className:"ml5 mr10",onClick:()=>{s()},children:"< Back"}),k.jsx("input",{type:"color",value:r,onChange:e=>{n.user.updateUserPreferences({color:e.currentTarget.value})}}),k.jsx("input",{value:o,onChange:e=>{n.user.updateUserPreferences({name:e.currentTarget.value})}}),k.jsx(L,{visible:e,opacity:"thick",children:k.jsx("div",{style:{fontSize:30,textAlign:"center"},children:k.jsx(z,{color:"#60a9f4"})})})]})}));export{NX as default};
